var v=r=>{throw TypeError(r)};var A=(r,t,n)=>t.has(r)||v("Cannot "+n);var m=(r,t,n)=>(A(r,t,"read from private field"),n?n.call(r):t.get(r)),p=(r,t,n)=>t.has(r)?v("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,n),y=(r,t,n,e)=>(A(r,t,"write to private field"),e?e.call(r,n):t.set(r,n),n);import{strip_prefix as j,fetch_range as k,merge_init as $,uri2href as O}from"./vizarr-_pnmL1Ez.js";function E(r,t=/{{(.*?)}}/){let n=t.exec(r);const e=[];let o;for(;n;)o=n.index,o!==0&&(e.push({match:!1,str:r.substring(0,o)}),r=r.slice(o)),e.push({match:!0,str:n[0]}),r=r.slice(n[0].length),n=t.exec(r);return r&&e.push({match:!1,str:r}),e}function U(r){const t=r.match(/(?<fname>[A-Z_][A-Z_1-9]*)\((?<args>[^)]+)\)/i);if(!(t!=null&&t.groups))return;const{fname:n,args:e}=t.groups,o=Object.fromEntries(e.split(",").map(f=>{var a;const{key:i,num:s,str:c}=((a=f.match(/(?<key>[a-z_0-9]*)\s*=\s*((?<num>[0-9.]+)|('|")(?<str>.*)('|"))/i))==null?void 0:a.groups)??{};if(!i||!(s||c))throw Error(`Failed to match fn kwarg: ${f}`);return[i,s?Number(s):c]}));return{fname:n,ctx:o}}const x="abcdefghijklmnopqrstuvwxyz",_="01234569789",z="()*/+-",M=" ",Z=new Set(x+x.toUpperCase()+_+z+M);function F(r){for(let t=0;t<r.length;t++)if(!Z.has(r.charAt(t)))return;return E(r,/[A-Za-z_][A-Za-z0-9_]*/gi)}function I(r,t){return E(r).map(e=>{if(!e.match)return e.str;let o=e.str.split(/{{|}}/).filter(Boolean)[0].trim();if(o in t)return t[o];const f=U(o);if(f){const{fname:s,ctx:c}=f,a=t[s];if(typeof a=="function")return a(c);throw Error(`Cannot find function named ${s} in rendering context.`)}const i=F(o);if(i){const s=i.map(c=>{if(!c.match)return c.str;const a=t[c.str];if(a==null)throw Error(`Cannot find number named ${c.str} in rendering context.`);if(typeof a!="number")throw Error(`The provided value for ${c.str} must be a number.`);return a});return Function('"use strict";return ('+s.join("")+")")()}throw new Error(`Unable to match ${e.str}`)}).join("")}function N(r,t=I){return"version"in r?S(r,t):P(r)}function P(r){return new Map(Object.entries(r))}function S(r,t){var f;const n={};for(const[i,s]of Object.entries(r.templates??{}))s.includes("{{")?n[i]=c=>t(s,c):n[i]=s;const e=(i,s)=>t(i,{...n,...s}),o=new Map;for(const[i,s]of Object.entries(r.refs??{}))if(typeof s=="string")o.set(i,s);else{const c=(f=s[0])!=null&&f.includes("{{")?e(s[0]):s[0];o.set(i,s.length===1?[c]:[c,s[1],s[2]])}for(const i of r.gen??[])for(const s of T(i.dimensions)){const c=e(i.key,s),a=e(i.url,s);if("offset"in i&&"length"in i){const w=e(i.offset,s),C=e(i.length,s);o.set(c,[a,parseInt(w),parseInt(C)])}else o.set(c,[a])}return o}function*T(r){const t=Object.keys(r),n=Object.values(r).map(e=>Array.isArray(e)?e:[...B(e)]);for(const e of q(...n))yield Object.fromEntries(t.map((o,f)=>[o,e[f]]))}function*q(...r){if(r.length===0)return;const t=r.map(e=>e[Symbol.iterator]()),n=t.map(e=>e.next());if(n.some(e=>e.done))throw new Error("Input contains an empty iterator.");for(let e=0;;){if(n[e].done){if(t[e]=r[e][Symbol.iterator](),n[e]=t[e].next(),++e>=t.length)return}else yield n.map(({value:o})=>o),e=0;n[e]=t[e].next()}}function*B({stop:r,start:t=0,step:n=1}){for(let e=t;e<r;e+=n)yield e}(()=>{for(var r=new Uint8Array(128),t=0;t<64;t++)r[t<26?t+65:t<52?t+71:t<62?t-4:t*4-205]=t;return n=>{for(var e=n.length,o=new Uint8Array((e-(n[e-1]=="=")-(n[e-2]=="="))*3/4|0),f=0,i=0;f<e;){var s=r[n.charCodeAt(f++)],c=r[n.charCodeAt(f++)],a=r[n.charCodeAt(f++)],w=r[n.charCodeAt(f++)];o[i++]=s<<2|c>>4,o[i++]=c<<4|a>>2,o[i++]=a<<6|w}return o}})();new TextEncoder;let u=new Uint8Array(128);for(let r=0;r<64;r++)u[r<26?r+65:r<52?r+71:r<62?r-4:r*4-205]=r;function V(r){const t=r.length,n=new Uint8Array((t-(r[t-1]==="=")-(r[t-2]==="="))*3/4|0);for(let e=0,o=0;e<t;){const f=u[r.charCodeAt(e++)],i=u[r.charCodeAt(e++)],s=u[r.charCodeAt(e++)],c=u[r.charCodeAt(e++)];n[o++]=f<<2|i>>4,n[o++]=i<<4|s>>2,n[o++]=s<<6|c}return n}var l,h,d;const g=class g{constructor(t,n={}){p(this,l);p(this,h);p(this,d);y(this,l,Promise.resolve(t)),y(this,h,n),y(this,d,n.overrides||{})}async get(t,n={}){let e=(await m(this,l)).get(j(t));if(!e)return;if(typeof e=="string")return e.startsWith("base64:")?V(e.slice(7)):new TextEncoder().encode(e);let[o,f,i]=e,s=o??m(this,h).target;if(!s)throw Error(`No url for key ${t}, and no target url provided.`);let c=await k(O(s),f,i,$(m(this,d),n));if(c.status===200||c.status===206)return new Uint8Array(await c.arrayBuffer());throw new Error(`Request unsuccessful for key ${t}. Response status: ${c.status}.`)}static fromSpec(t,n){let e=Promise.resolve(t).then(o=>N(o));return new g(e,n)}static fromUrl(t,n){let e=fetch(t,n==null?void 0:n.overrides).then(o=>o.json());return g.fromSpec(e,n)}};l=new WeakMap,h=new WeakMap,d=new WeakMap;let b=g;export{b as default,V as to_binary};
//# sourceMappingURL=ref-DtbwQEnP.js.map
