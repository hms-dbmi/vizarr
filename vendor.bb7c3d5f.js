var CF=Object.defineProperty,cF=Object.defineProperties;var AF=Object.getOwnPropertyDescriptors;var da=Object.getOwnPropertySymbols;var Nm=Object.prototype.hasOwnProperty,wm=Object.prototype.propertyIsEnumerable;var _c=(t,e,n)=>e in t?CF(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,S=(t,e)=>{for(var n in e||(e={}))Nm.call(e,n)&&_c(t,n,e[n]);if(da)for(var n of da(e))wm.call(e,n)&&_c(t,n,e[n]);return t},J=(t,e)=>cF(t,AF(e));var Hc=(t,e)=>{var n={};for(var i in t)Nm.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&da)for(var i of da(t))e.indexOf(i)<0&&wm.call(t,i)&&(n[i]=t[i]);return n};var ua=(t,e,n)=>(_c(t,typeof e!="symbol"?e+"":e,n),n);function Tm(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),e}var G={exports:{}},Fe={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Em=Object.getOwnPropertySymbols,dF=Object.prototype.hasOwnProperty,uF=Object.prototype.propertyIsEnumerable;function hF(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function mF(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;var i=Object.getOwnPropertyNames(e).map(function(s){return e[s]});if(i.join("")!=="0123456789")return!1;var g={};return"abcdefghijklmnopqrst".split("").forEach(function(s){g[s]=s}),Object.keys(Object.assign({},g)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var Qm=mF()?Object.assign:function(t,e){for(var n,i=hF(t),g,s=1;s<arguments.length;s++){n=Object(arguments[s]);for(var o in n)dF.call(n,o)&&(i[o]=n[o]);if(Em){g=Em(n);for(var r=0;r<g.length;r++)uF.call(n,g[r])&&(i[g[r]]=n[g[r]])}}return i};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kc=Qm,Zs=60103,Xm=60106;Fe.Fragment=60107;Fe.StrictMode=60108;Fe.Profiler=60114;var Ym=60109,_m=60110,Hm=60112;Fe.Suspense=60113;var km=60115,Km=60116;if(typeof Symbol=="function"&&Symbol.for){var wn=Symbol.for;Zs=wn("react.element"),Xm=wn("react.portal"),Fe.Fragment=wn("react.fragment"),Fe.StrictMode=wn("react.strict_mode"),Fe.Profiler=wn("react.profiler"),Ym=wn("react.provider"),_m=wn("react.context"),Hm=wn("react.forward_ref"),Fe.Suspense=wn("react.suspense"),km=wn("react.memo"),Km=wn("react.lazy")}var Lm=typeof Symbol=="function"&&Symbol.iterator;function fF(t){return t===null||typeof t!="object"?null:(t=Lm&&t[Lm]||t["@@iterator"],typeof t=="function"?t:null)}function jo(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Mm={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Pm={};function Rs(t,e,n){this.props=t,this.context=e,this.refs=Pm,this.updater=n||Mm}Rs.prototype.isReactComponent={};Rs.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error(jo(85));this.updater.enqueueSetState(this,t,e,"setState")};Rs.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Jm(){}Jm.prototype=Rs.prototype;function Kc(t,e,n){this.props=t,this.context=e,this.refs=Pm,this.updater=n||Mm}var Lc=Kc.prototype=new Jm;Lc.constructor=Kc;kc(Lc,Rs.prototype);Lc.isPureReactComponent=!0;var Mc={current:null},Dm=Object.prototype.hasOwnProperty,zm={key:!0,ref:!0,__self:!0,__source:!0};function Om(t,e,n){var i,g={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Dm.call(e,i)&&!zm.hasOwnProperty(i)&&(g[i]=e[i]);var r=arguments.length-2;if(r===1)g.children=n;else if(1<r){for(var I=Array(r),a=0;a<r;a++)I[a]=arguments[a+2];g.children=I}if(t&&t.defaultProps)for(i in r=t.defaultProps,r)g[i]===void 0&&(g[i]=r[i]);return{$$typeof:Zs,type:t,key:s,ref:o,props:g,_owner:Mc.current}}function pF(t,e){return{$$typeof:Zs,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Pc(t){return typeof t=="object"&&t!==null&&t.$$typeof===Zs}function BF(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var jm=/\/+/g;function Jc(t,e){return typeof t=="object"&&t!==null&&t.key!=null?BF(""+t.key):e.toString(36)}function ha(t,e,n,i,g){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Zs:case Xm:o=!0}}if(o)return o=t,g=g(o),t=i===""?"."+Jc(o,0):i,Array.isArray(g)?(n="",t!=null&&(n=t.replace(jm,"$&/")+"/"),ha(g,e,n,"",function(a){return a})):g!=null&&(Pc(g)&&(g=pF(g,n+(!g.key||o&&o.key===g.key?"":(""+g.key).replace(jm,"$&/")+"/")+t)),e.push(g)),1;if(o=0,i=i===""?".":i+":",Array.isArray(t))for(var r=0;r<t.length;r++){s=t[r];var I=i+Jc(s,r);o+=ha(s,e,n,I,g)}else if(I=fF(t),typeof I=="function")for(t=I.call(t),r=0;!(s=t.next()).done;)s=s.value,I=i+Jc(s,r++),o+=ha(s,e,n,I,g);else if(s==="object")throw e=""+t,Error(jo(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e));return o}function ma(t,e,n){if(t==null)return t;var i=[],g=0;return ha(t,i,"","",function(s){return e.call(n,s,g++)}),i}function bF(t){if(t._status===-1){var e=t._result;e=e(),t._status=0,t._result=e,e.then(function(n){t._status===0&&(n=n.default,t._status=1,t._result=n)},function(n){t._status===0&&(t._status=2,t._result=n)})}if(t._status===1)return t._result;throw t._result}var qm={current:null};function ui(){var t=qm.current;if(t===null)throw Error(jo(321));return t}var yF={ReactCurrentDispatcher:qm,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:Mc,IsSomeRendererActing:{current:!1},assign:kc};Fe.Children={map:ma,forEach:function(t,e,n){ma(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ma(t,function(){e++}),e},toArray:function(t){return ma(t,function(e){return e})||[]},only:function(t){if(!Pc(t))throw Error(jo(143));return t}};Fe.Component=Rs;Fe.PureComponent=Kc;Fe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yF;Fe.cloneElement=function(t,e,n){if(t==null)throw Error(jo(267,t));var i=kc({},t.props),g=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Mc.current),e.key!==void 0&&(g=""+e.key),t.type&&t.type.defaultProps)var r=t.type.defaultProps;for(I in e)Dm.call(e,I)&&!zm.hasOwnProperty(I)&&(i[I]=e[I]===void 0&&r!==void 0?r[I]:e[I])}var I=arguments.length-2;if(I===1)i.children=n;else if(1<I){r=Array(I);for(var a=0;a<I;a++)r[a]=arguments[a+2];i.children=r}return{$$typeof:Zs,type:t.type,key:g,ref:s,props:i,_owner:o}};Fe.createContext=function(t,e){return e===void 0&&(e=null),t={$$typeof:_m,_calculateChangedBits:e,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider={$$typeof:Ym,_context:t},t.Consumer=t};Fe.createElement=Om;Fe.createFactory=function(t){var e=Om.bind(null,t);return e.type=t,e};Fe.createRef=function(){return{current:null}};Fe.forwardRef=function(t){return{$$typeof:Hm,render:t}};Fe.isValidElement=Pc;Fe.lazy=function(t){return{$$typeof:Km,_payload:{_status:-1,_result:t},_init:bF}};Fe.memo=function(t,e){return{$$typeof:km,type:t,compare:e===void 0?null:e}};Fe.useCallback=function(t,e){return ui().useCallback(t,e)};Fe.useContext=function(t,e){return ui().useContext(t,e)};Fe.useDebugValue=function(){};Fe.useEffect=function(t,e){return ui().useEffect(t,e)};Fe.useImperativeHandle=function(t,e,n){return ui().useImperativeHandle(t,e,n)};Fe.useLayoutEffect=function(t,e){return ui().useLayoutEffect(t,e)};Fe.useMemo=function(t,e){return ui().useMemo(t,e)};Fe.useReducer=function(t,e,n){return ui().useReducer(t,e,n)};Fe.useRef=function(t){return ui().useRef(t)};Fe.useState=function(t){return ui().useState(t)};Fe.version="17.0.2";G.exports=Fe;var we=G.exports,hi={exports:{}},fn={},$m={exports:{}},ef={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){var e,n,i,g;if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,r=o.now();t.unstable_now=function(){return o.now()-r}}if(typeof window=="undefined"||typeof MessageChannel!="function"){var I=null,a=null,l=function(){if(I!==null)try{var F=t.unstable_now();I(!0,F),I=null}catch(W){throw setTimeout(l,0),W}};e=function(F){I!==null?setTimeout(e,0,F):(I=F,setTimeout(l,0))},n=function(F,W){a=setTimeout(F,W)},i=function(){clearTimeout(a)},t.unstable_shouldYield=function(){return!1},g=t.unstable_forceFrameRate=function(){}}else{var C=window.setTimeout,c=window.clearTimeout;if(typeof console!="undefined"){var A=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof A!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var d=!1,m=null,u=-1,h=5,f=0;t.unstable_shouldYield=function(){return t.unstable_now()>=f},g=function(){},t.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):h=0<F?Math.floor(1e3/F):5};var p=new MessageChannel,b=p.port2;p.port1.onmessage=function(){if(m!==null){var F=t.unstable_now();f=F+h;try{m(!0,F)?b.postMessage(null):(d=!1,m=null)}catch(W){throw b.postMessage(null),W}}else d=!1},e=function(F){m=F,d||(d=!0,b.postMessage(null))},n=function(F,W){u=C(function(){F(t.unstable_now())},W)},i=function(){c(u),u=-1}}function Z(F,W){var T=F.length;F.push(W);e:for(;;){var Y=T-1>>>1,Q=F[Y];if(Q!==void 0&&0<x(Q,W))F[Y]=W,F[T]=Q,T=Y;else break e}}function v(F){return F=F[0],F===void 0?null:F}function N(F){var W=F[0];if(W!==void 0){var T=F.pop();if(T!==W){F[0]=T;e:for(var Y=0,Q=F.length;Y<Q;){var H=2*(Y+1)-1,P=F[H],oe=H+1,ne=F[oe];if(P!==void 0&&0>x(P,T))ne!==void 0&&0>x(ne,P)?(F[Y]=ne,F[oe]=T,Y=oe):(F[Y]=P,F[H]=T,Y=H);else if(ne!==void 0&&0>x(ne,T))F[Y]=ne,F[oe]=T,Y=oe;else break e}}return W}return null}function x(F,W){var T=F.sortIndex-W.sortIndex;return T!==0?T:F.id-W.id}var V=[],E=[],D=1,_=null,k=3,z=!1,ee=!1,Ie=!1;function he(F){for(var W=v(E);W!==null;){if(W.callback===null)N(E);else if(W.startTime<=F)N(E),W.sortIndex=W.expirationTime,Z(V,W);else break;W=v(E)}}function ge(F){if(Ie=!1,he(F),!ee)if(v(V)!==null)ee=!0,e(Ae);else{var W=v(E);W!==null&&n(ge,W.startTime-F)}}function Ae(F,W){ee=!1,Ie&&(Ie=!1,i()),z=!0;var T=k;try{for(he(W),_=v(V);_!==null&&(!(_.expirationTime>W)||F&&!t.unstable_shouldYield());){var Y=_.callback;if(typeof Y=="function"){_.callback=null,k=_.priorityLevel;var Q=Y(_.expirationTime<=W);W=t.unstable_now(),typeof Q=="function"?_.callback=Q:_===v(V)&&N(V),he(W)}else N(V);_=v(V)}if(_!==null)var H=!0;else{var P=v(E);P!==null&&n(ge,P.startTime-W),H=!1}return H}finally{_=null,k=T,z=!1}}var U=g;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(F){F.callback=null},t.unstable_continueExecution=function(){ee||z||(ee=!0,e(Ae))},t.unstable_getCurrentPriorityLevel=function(){return k},t.unstable_getFirstCallbackNode=function(){return v(V)},t.unstable_next=function(F){switch(k){case 1:case 2:case 3:var W=3;break;default:W=k}var T=k;k=W;try{return F()}finally{k=T}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=U,t.unstable_runWithPriority=function(F,W){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var T=k;k=F;try{return W()}finally{k=T}},t.unstable_scheduleCallback=function(F,W,T){var Y=t.unstable_now();switch(typeof T=="object"&&T!==null?(T=T.delay,T=typeof T=="number"&&0<T?Y+T:Y):T=Y,F){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=T+Q,F={id:D++,callback:W,priorityLevel:F,startTime:T,expirationTime:Q,sortIndex:-1},T>Y?(F.sortIndex=T,Z(E,F),v(V)===null&&F===v(E)&&(Ie?i():Ie=!0,n(ge,T-Y))):(F.sortIndex=Q,Z(V,F),ee||z||(ee=!0,e(Ae))),F},t.unstable_wrapCallback=function(F){var W=k;return function(){var T=k;k=W;try{return F.apply(this,arguments)}finally{k=T}}}})(ef);$m.exports=ef;/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fa=G.exports,ze=Qm,ut=$m.exports;function M(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!fa)throw Error(M(227));var tf=new Set,qo={};function Qg(t,e){Fs(t,e),Fs(t+"Capture",e)}function Fs(t,e){for(qo[t]=e,t=0;t<e.length;t++)tf.add(e[t])}var mi=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),vF=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,nf=Object.prototype.hasOwnProperty,gf={},sf={};function GF(t){return nf.call(sf,t)?!0:nf.call(gf,t)?!1:vF.test(t)?sf[t]=!0:(gf[t]=!0,!1)}function ZF(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function RF(t,e,n,i){if(e===null||typeof e=="undefined"||ZF(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function kt(t,e,n,i,g,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=g,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var yt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){yt[t]=new kt(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];yt[e]=new kt(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){yt[t]=new kt(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){yt[t]=new kt(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){yt[t]=new kt(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){yt[t]=new kt(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){yt[t]=new kt(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){yt[t]=new kt(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){yt[t]=new kt(t,5,!1,t.toLowerCase(),null,!1,!1)});var Dc=/[\-:]([a-z])/g;function zc(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Dc,zc);yt[e]=new kt(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Dc,zc);yt[e]=new kt(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Dc,zc);yt[e]=new kt(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){yt[t]=new kt(t,1,!1,t.toLowerCase(),null,!1,!1)});yt.xlinkHref=new kt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){yt[t]=new kt(t,1,!1,t.toLowerCase(),null,!0,!0)});function Oc(t,e,n,i){var g=yt.hasOwnProperty(e)?yt[e]:null,s=g!==null?g.type===0:i?!1:!(!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N");s||(RF(e,n,g,i)&&(n=null),i||g===null?GF(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):g.mustUseProperty?t[g.propertyName]=n===null?g.type===3?!1:"":n:(e=g.attributeName,i=g.attributeNamespace,n===null?t.removeAttribute(e):(g=g.type,n=g===3||g===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Xg=fa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$o=60103,Yg=60106,Ki=60107,jc=60108,er=60114,qc=60109,$c=60110,pa=60112,tr=60113,Ba=60120,ba=60115,eA=60116,tA=60121,nA=60128,of=60129,iA=60130,gA=60131;if(typeof Symbol=="function"&&Symbol.for){var ht=Symbol.for;$o=ht("react.element"),Yg=ht("react.portal"),Ki=ht("react.fragment"),jc=ht("react.strict_mode"),er=ht("react.profiler"),qc=ht("react.provider"),$c=ht("react.context"),pa=ht("react.forward_ref"),tr=ht("react.suspense"),Ba=ht("react.suspense_list"),ba=ht("react.memo"),eA=ht("react.lazy"),tA=ht("react.block"),ht("react.scope"),nA=ht("react.opaque.id"),of=ht("react.debug_trace_mode"),iA=ht("react.offscreen"),gA=ht("react.legacy_hidden")}var rf=typeof Symbol=="function"&&Symbol.iterator;function nr(t){return t===null||typeof t!="object"?null:(t=rf&&t[rf]||t["@@iterator"],typeof t=="function"?t:null)}var sA;function ir(t){if(sA===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);sA=e&&e[1]||""}return`
`+sA+t}var oA=!1;function ya(t,e){if(!t||oA)return"";oA=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(I){var i=I}Reflect.construct(t,[],e)}else{try{e.call()}catch(I){i=I}t.call(e.prototype)}else{try{throw Error()}catch(I){i=I}t()}}catch(I){if(I&&i&&typeof I.stack=="string"){for(var g=I.stack.split(`
`),s=i.stack.split(`
`),o=g.length-1,r=s.length-1;1<=o&&0<=r&&g[o]!==s[r];)r--;for(;1<=o&&0<=r;o--,r--)if(g[o]!==s[r]){if(o!==1||r!==1)do if(o--,r--,0>r||g[o]!==s[r])return`
`+g[o].replace(" at new "," at ");while(1<=o&&0<=r);break}}}finally{oA=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ir(t):""}function FF(t){switch(t.tag){case 5:return ir(t.type);case 16:return ir("Lazy");case 13:return ir("Suspense");case 19:return ir("SuspenseList");case 0:case 2:case 15:return t=ya(t.type,!1),t;case 11:return t=ya(t.type.render,!1),t;case 22:return t=ya(t.type._render,!1),t;case 1:return t=ya(t.type,!0),t;default:return""}}function Ss(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ki:return"Fragment";case Yg:return"Portal";case er:return"Profiler";case jc:return"StrictMode";case tr:return"Suspense";case Ba:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case $c:return(t.displayName||"Context")+".Consumer";case qc:return(t._context.displayName||"Context")+".Provider";case pa:var e=t.render;return e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case ba:return Ss(t.type);case tA:return Ss(t._render);case eA:e=t._payload,t=t._init;try{return Ss(t(e))}catch{}}return null}function Li(t){switch(typeof t){case"boolean":case"number":case"object":case"string":case"undefined":return t;default:return""}}function If(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function SF(t){var e=If(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n!="undefined"&&typeof n.get=="function"&&typeof n.set=="function"){var g=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return g.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function va(t){t._valueTracker||(t._valueTracker=SF(t))}function af(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=If(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Ga(t){if(t=t||(typeof document!="undefined"?document:void 0),typeof t=="undefined")return null;try{return t.activeElement||t.body}catch{return t.body}}function rA(t,e){var n=e.checked;return ze({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n!=null?n:t._wrapperState.initialChecked})}function lf(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Li(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Cf(t,e){e=e.checked,e!=null&&Oc(t,"checked",e,!1)}function IA(t,e){Cf(t,e);var n=Li(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?aA(t,e.type,n):e.hasOwnProperty("defaultValue")&&aA(t,e.type,Li(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function cf(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function aA(t,e,n){(e!=="number"||Ga(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}function VF(t){var e="";return fa.Children.forEach(t,function(n){n!=null&&(e+=n)}),e}function lA(t,e){return t=ze({children:void 0},e),(e=VF(e.children))&&(t.children=e),t}function Vs(t,e,n,i){if(t=t.options,e){e={};for(var g=0;g<n.length;g++)e["$"+n[g]]=!0;for(n=0;n<t.length;n++)g=e.hasOwnProperty("$"+t[n].value),t[n].selected!==g&&(t[n].selected=g),g&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Li(n),e=null,g=0;g<t.length;g++){if(t[g].value===n){t[g].selected=!0,i&&(t[g].defaultSelected=!0);return}e!==null||t[g].disabled||(e=t[g])}e!==null&&(e.selected=!0)}}function CA(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(M(91));return ze({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Af(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(M(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(M(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Li(n)}}function df(t,e){var n=Li(e.value),i=Li(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function uf(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}var cA={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function hf(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function AA(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?hf(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Za,mf=function(t){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(e,n,i,g){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,g)})}:t}(function(t,e){if(t.namespaceURI!==cA.svg||"innerHTML"in t)t.innerHTML=e;else{for(Za=Za||document.createElement("div"),Za.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Za.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function gr(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var sr={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},UF=["Webkit","ms","Moz","O"];Object.keys(sr).forEach(function(t){UF.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),sr[e]=sr[t]})});function ff(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||sr.hasOwnProperty(t)&&sr[t]?(""+e).trim():e+"px"}function pf(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,g=ff(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,g):t[n]=g}}var xF=ze({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function dA(t,e){if(e){if(xF[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(M(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(M(60));if(!(typeof e.dangerouslySetInnerHTML=="object"&&"__html"in e.dangerouslySetInnerHTML))throw Error(M(61))}if(e.style!=null&&typeof e.style!="object")throw Error(M(62))}}function uA(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function hA(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var mA=null,Us=null,xs=null;function Bf(t){if(t=Gr(t)){if(typeof mA!="function")throw Error(M(280));var e=t.stateNode;e&&(e=Ka(e),mA(t.stateNode,t.type,e))}}function bf(t){Us?xs?xs.push(t):xs=[t]:Us=t}function yf(){if(Us){var t=Us,e=xs;if(xs=Us=null,Bf(t),e)for(t=0;t<e.length;t++)Bf(e[t])}}function fA(t,e){return t(e)}function vf(t,e,n,i,g){return t(e,n,i,g)}function pA(){}var Gf=fA,_g=!1,BA=!1;function bA(){(Us!==null||xs!==null)&&(pA(),yf())}function WF(t,e,n){if(BA)return t(e,n);BA=!0;try{return Gf(t,e,n)}finally{BA=!1,bA()}}function or(t,e){var n=t.stateNode;if(n===null)return null;var i=Ka(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(M(231,e,typeof n));return n}var yA=!1;if(mi)try{var rr={};Object.defineProperty(rr,"passive",{get:function(){yA=!0}}),window.addEventListener("test",rr,rr),window.removeEventListener("test",rr,rr)}catch{yA=!1}function NF(t,e,n,i,g,s,o,r,I){var a=Array.prototype.slice.call(arguments,3);try{e.apply(n,a)}catch(l){this.onError(l)}}var Ir=!1,Ra=null,Fa=!1,vA=null,wF={onError:function(t){Ir=!0,Ra=t}};function TF(t,e,n,i,g,s,o,r,I){Ir=!1,Ra=null,NF.apply(wF,arguments)}function EF(t,e,n,i,g,s,o,r,I){if(TF.apply(this,arguments),Ir){if(Ir){var a=Ra;Ir=!1,Ra=null}else throw Error(M(198));Fa||(Fa=!0,vA=a)}}function Hg(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&1026)!=0&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Zf(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Rf(t){if(Hg(t)!==t)throw Error(M(188))}function QF(t){var e=t.alternate;if(!e){if(e=Hg(t),e===null)throw Error(M(188));return e!==t?null:t}for(var n=t,i=e;;){var g=n.return;if(g===null)break;var s=g.alternate;if(s===null){if(i=g.return,i!==null){n=i;continue}break}if(g.child===s.child){for(s=g.child;s;){if(s===n)return Rf(g),t;if(s===i)return Rf(g),e;s=s.sibling}throw Error(M(188))}if(n.return!==i.return)n=g,i=s;else{for(var o=!1,r=g.child;r;){if(r===n){o=!0,n=g,i=s;break}if(r===i){o=!0,i=g,n=s;break}r=r.sibling}if(!o){for(r=s.child;r;){if(r===n){o=!0,n=s,i=g;break}if(r===i){o=!0,i=s,n=g;break}r=r.sibling}if(!o)throw Error(M(189))}}if(n.alternate!==i)throw Error(M(190))}if(n.tag!==3)throw Error(M(188));return n.stateNode.current===n?t:e}function Ff(t){if(t=QF(t),!t)return null;for(var e=t;;){if(e.tag===5||e.tag===6)return e;if(e.child)e.child.return=e,e=e.child;else{if(e===t)break;for(;!e.sibling;){if(!e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}}return null}function Sf(t,e){for(var n=t.alternate;e!==null;){if(e===t||e===n)return!0;e=e.return}return!1}var Vf,GA,Uf,xf,ZA=!1,Dn=[],Mi=null,Pi=null,Ji=null,ar=new Map,lr=new Map,Cr=[],Wf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function RA(t,e,n,i,g){return{blockedOn:t,domEventName:e,eventSystemFlags:n|16,nativeEvent:g,targetContainers:[i]}}function Nf(t,e){switch(t){case"focusin":case"focusout":Mi=null;break;case"dragenter":case"dragleave":Pi=null;break;case"mouseover":case"mouseout":Ji=null;break;case"pointerover":case"pointerout":ar.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":lr.delete(e.pointerId)}}function cr(t,e,n,i,g,s){return t===null||t.nativeEvent!==s?(t=RA(e,n,i,g,s),e!==null&&(e=Gr(e),e!==null&&GA(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,g!==null&&e.indexOf(g)===-1&&e.push(g),t)}function XF(t,e,n,i,g){switch(e){case"focusin":return Mi=cr(Mi,t,e,n,i,g),!0;case"dragenter":return Pi=cr(Pi,t,e,n,i,g),!0;case"mouseover":return Ji=cr(Ji,t,e,n,i,g),!0;case"pointerover":var s=g.pointerId;return ar.set(s,cr(ar.get(s)||null,t,e,n,i,g)),!0;case"gotpointercapture":return s=g.pointerId,lr.set(s,cr(lr.get(s)||null,t,e,n,i,g)),!0}return!1}function YF(t){var e=kg(t.target);if(e!==null){var n=Hg(e);if(n!==null){if(e=n.tag,e===13){if(e=Zf(n),e!==null){t.blockedOn=e,xf(t.lanePriority,function(){ut.unstable_runWithPriority(t.priority,function(){Uf(n)})});return}}else if(e===3&&n.stateNode.hydrate){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Sa(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=WA(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n!==null)return e=Gr(n),e!==null&&GA(e),t.blockedOn=n,!1;e.shift()}return!0}function wf(t,e,n){Sa(t)&&n.delete(e)}function _F(){for(ZA=!1;0<Dn.length;){var t=Dn[0];if(t.blockedOn!==null){t=Gr(t.blockedOn),t!==null&&Vf(t);break}for(var e=t.targetContainers;0<e.length;){var n=WA(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n!==null){t.blockedOn=n;break}e.shift()}t.blockedOn===null&&Dn.shift()}Mi!==null&&Sa(Mi)&&(Mi=null),Pi!==null&&Sa(Pi)&&(Pi=null),Ji!==null&&Sa(Ji)&&(Ji=null),ar.forEach(wf),lr.forEach(wf)}function Ar(t,e){t.blockedOn===e&&(t.blockedOn=null,ZA||(ZA=!0,ut.unstable_scheduleCallback(ut.unstable_NormalPriority,_F)))}function Tf(t){function e(g){return Ar(g,t)}if(0<Dn.length){Ar(Dn[0],t);for(var n=1;n<Dn.length;n++){var i=Dn[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Mi!==null&&Ar(Mi,t),Pi!==null&&Ar(Pi,t),Ji!==null&&Ar(Ji,t),ar.forEach(e),lr.forEach(e),n=0;n<Cr.length;n++)i=Cr[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Cr.length&&(n=Cr[0],n.blockedOn===null);)YF(n),n.blockedOn===null&&Cr.shift()}function Va(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ws={animationend:Va("Animation","AnimationEnd"),animationiteration:Va("Animation","AnimationIteration"),animationstart:Va("Animation","AnimationStart"),transitionend:Va("Transition","TransitionEnd")},FA={},Ef={};mi&&(Ef=document.createElement("div").style,"AnimationEvent"in window||(delete Ws.animationend.animation,delete Ws.animationiteration.animation,delete Ws.animationstart.animation),"TransitionEvent"in window||delete Ws.transitionend.transition);function Ua(t){if(FA[t])return FA[t];if(!Ws[t])return t;var e=Ws[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Ef)return FA[t]=e[n];return t}var Qf=Ua("animationend"),Xf=Ua("animationiteration"),Yf=Ua("animationstart"),_f=Ua("transitionend"),Hf=new Map,SA=new Map,HF=["abort","abort",Qf,"animationEnd",Xf,"animationIteration",Yf,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",_f,"transitionEnd","waiting","waiting"];function VA(t,e){for(var n=0;n<t.length;n+=2){var i=t[n],g=t[n+1];g="on"+(g[0].toUpperCase()+g.slice(1)),SA.set(i,e),Hf.set(i,g),Qg(g,[i])}}var kF=ut.unstable_now;kF();var Ye=8;function Ns(t){if((1&t)!=0)return Ye=15,1;if((2&t)!=0)return Ye=14,2;if((4&t)!=0)return Ye=13,4;var e=24&t;return e!==0?(Ye=12,e):(t&32)!=0?(Ye=11,32):(e=192&t,e!==0?(Ye=10,e):(t&256)!=0?(Ye=9,256):(e=3584&t,e!==0?(Ye=8,e):(t&4096)!=0?(Ye=7,4096):(e=4186112&t,e!==0?(Ye=6,e):(e=62914560&t,e!==0?(Ye=5,e):t&67108864?(Ye=4,67108864):(t&134217728)!=0?(Ye=3,134217728):(e=805306368&t,e!==0?(Ye=2,e):(1073741824&t)!=0?(Ye=1,1073741824):(Ye=8,t))))))}function KF(t){switch(t){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function LF(t){switch(t){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(M(358,t))}}function dr(t,e){var n=t.pendingLanes;if(n===0)return Ye=0;var i=0,g=0,s=t.expiredLanes,o=t.suspendedLanes,r=t.pingedLanes;if(s!==0)i=s,g=Ye=15;else if(s=n&134217727,s!==0){var I=s&~o;I!==0?(i=Ns(I),g=Ye):(r&=s,r!==0&&(i=Ns(r),g=Ye))}else s=n&~o,s!==0?(i=Ns(s),g=Ye):r!==0&&(i=Ns(r),g=Ye);if(i===0)return 0;if(i=31-Di(i),i=n&((0>i?0:1<<i)<<1)-1,e!==0&&e!==i&&(e&o)==0){if(Ns(e),g<=Ye)return e;Ye=g}if(e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Di(e),g=1<<n,i|=t[n],e&=~g;return i}function kf(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function xa(t,e){switch(t){case 15:return 1;case 14:return 2;case 12:return t=ws(24&~e),t===0?xa(10,e):t;case 10:return t=ws(192&~e),t===0?xa(8,e):t;case 8:return t=ws(3584&~e),t===0&&(t=ws(4186112&~e),t===0&&(t=512)),t;case 2:return e=ws(805306368&~e),e===0&&(e=268435456),e}throw Error(M(358,t))}function ws(t){return t&-t}function UA(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Wa(t,e,n){t.pendingLanes|=e;var i=e-1;t.suspendedLanes&=i,t.pingedLanes&=i,t=t.eventTimes,e=31-Di(e),t[e]=n}var Di=Math.clz32?Math.clz32:JF,MF=Math.log,PF=Math.LN2;function JF(t){return t===0?32:31-(MF(t)/PF|0)|0}var DF=ut.unstable_UserBlockingPriority,zF=ut.unstable_runWithPriority,Na=!0;function OF(t,e,n,i){_g||pA();var g=xA,s=_g;_g=!0;try{vf(g,t,e,n,i)}finally{(_g=s)||bA()}}function jF(t,e,n,i){zF(DF,xA.bind(null,t,e,n,i))}function xA(t,e,n,i){if(Na){var g;if((g=(e&4)==0)&&0<Dn.length&&-1<Wf.indexOf(t))t=RA(null,t,e,n,i),Dn.push(t);else{var s=WA(t,e,n,i);if(s===null)g&&Nf(t,i);else{if(g){if(-1<Wf.indexOf(t)){t=RA(s,t,e,n,i),Dn.push(t);return}if(XF(s,t,e,n,i))return;Nf(t,i)}fp(t,e,i,null,n)}}}}function WA(t,e,n,i){var g=hA(i);if(g=kg(g),g!==null){var s=Hg(g);if(s===null)g=null;else{var o=s.tag;if(o===13){if(g=Zf(s),g!==null)return g;g=null}else if(o===3){if(s.stateNode.hydrate)return s.tag===3?s.stateNode.containerInfo:null;g=null}else s!==g&&(g=null)}}return fp(t,e,i,g,n),null}var zi=null,NA=null,wa=null;function Kf(){if(wa)return wa;var t,e=NA,n=e.length,i,g="value"in zi?zi.value:zi.textContent,s=g.length;for(t=0;t<n&&e[t]===g[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===g[s-i];i++);return wa=g.slice(t,1<i?1-i:void 0)}function Ta(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ea(){return!0}function Lf(){return!1}function en(t){function e(n,i,g,s,o){this._reactName=n,this._targetInst=g,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var r in t)t.hasOwnProperty(r)&&(n=t[r],this[r]=n?n(s):s[r]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Ea:Lf,this.isPropagationStopped=Lf,this}return ze(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ea)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ea)},persist:function(){},isPersistent:Ea}),e}var Ts={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wA=en(Ts),ur=ze({},Ts,{view:0,detail:0}),qF=en(ur),TA,EA,hr,Qa=ze({},ur,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:XA,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==hr&&(hr&&t.type==="mousemove"?(TA=t.screenX-hr.screenX,EA=t.screenY-hr.screenY):EA=TA=0,hr=t),TA)},movementY:function(t){return"movementY"in t?t.movementY:EA}}),Mf=en(Qa),$F=ze({},Qa,{dataTransfer:0}),eS=en($F),tS=ze({},ur,{relatedTarget:0}),QA=en(tS),nS=ze({},Ts,{animationName:0,elapsedTime:0,pseudoElement:0}),iS=en(nS),gS=ze({},Ts,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),sS=en(gS),oS=ze({},Ts,{data:0}),Pf=en(oS),rS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},IS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},aS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function lS(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=aS[t])?!!e[t]:!1}function XA(){return lS}var CS=ze({},ur,{key:function(t){if(t.key){var e=rS[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Ta(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?IS[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:XA,charCode:function(t){return t.type==="keypress"?Ta(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Ta(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),cS=en(CS),AS=ze({},Qa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Jf=en(AS),dS=ze({},ur,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:XA}),uS=en(dS),hS=ze({},Ts,{propertyName:0,elapsedTime:0,pseudoElement:0}),mS=en(hS),fS=ze({},Qa,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),pS=en(fS),BS=[9,13,27,32],YA=mi&&"CompositionEvent"in window,mr=null;mi&&"documentMode"in document&&(mr=document.documentMode);var bS=mi&&"TextEvent"in window&&!mr,Df=mi&&(!YA||mr&&8<mr&&11>=mr),zf=String.fromCharCode(32),Of=!1;function jf(t,e){switch(t){case"keyup":return BS.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qf(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Es=!1;function yS(t,e){switch(t){case"compositionend":return qf(e);case"keypress":return e.which!==32?null:(Of=!0,zf);case"textInput":return t=e.data,t===zf&&Of?null:t;default:return null}}function vS(t,e){if(Es)return t==="compositionend"||!YA&&jf(t,e)?(t=Kf(),wa=NA=zi=null,Es=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Df&&e.locale!=="ko"?null:e.data;default:return null}}var GS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $f(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!GS[t.type]:e==="textarea"}function ep(t,e,n,i){bf(i),e=Ya(e,"onChange"),0<e.length&&(n=new wA("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var fr=null,pr=null;function ZS(t){Ap(t,0)}function Xa(t){var e=Hs(t);if(af(e))return t}function RS(t,e){if(t==="change")return e}var tp=!1;if(mi){var _A;if(mi){var HA="oninput"in document;if(!HA){var np=document.createElement("div");np.setAttribute("oninput","return;"),HA=typeof np.oninput=="function"}_A=HA}else _A=!1;tp=_A&&(!document.documentMode||9<document.documentMode)}function ip(){fr&&(fr.detachEvent("onpropertychange",gp),pr=fr=null)}function gp(t){if(t.propertyName==="value"&&Xa(pr)){var e=[];if(ep(e,pr,t,hA(t)),t=ZS,_g)t(e);else{_g=!0;try{fA(t,e)}finally{_g=!1,bA()}}}}function FS(t,e,n){t==="focusin"?(ip(),fr=e,pr=n,fr.attachEvent("onpropertychange",gp)):t==="focusout"&&ip()}function SS(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Xa(pr)}function VS(t,e){if(t==="click")return Xa(e)}function US(t,e){if(t==="input"||t==="change")return Xa(e)}function xS(t,e){return t===e&&(t!==0||1/t==1/e)||t!==t&&e!==e}var pn=typeof Object.is=="function"?Object.is:xS,WS=Object.prototype.hasOwnProperty;function Br(t,e){if(pn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++)if(!WS.call(e,n[i])||!pn(t[n[i]],e[n[i]]))return!1;return!0}function sp(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function op(t,e){var n=sp(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=sp(n)}}function rp(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?rp(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Ip(){for(var t=window,e=Ga();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ga(t.document)}return e}function kA(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}var NS=mi&&"documentMode"in document&&11>=document.documentMode,Qs=null,KA=null,br=null,LA=!1;function ap(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;LA||Qs==null||Qs!==Ga(i)||(i=Qs,"selectionStart"in i&&kA(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),br&&Br(br,i)||(br=i,i=Ya(KA,"onSelect"),0<i.length&&(e=new wA("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Qs)))}VA("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);VA("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);VA(HF,2);for(var lp="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),MA=0;MA<lp.length;MA++)SA.set(lp[MA],0);Fs("onMouseEnter",["mouseout","mouseover"]);Fs("onMouseLeave",["mouseout","mouseover"]);Fs("onPointerEnter",["pointerout","pointerover"]);Fs("onPointerLeave",["pointerout","pointerover"]);Qg("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Qg("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Qg("onBeforeInput",["compositionend","keypress","textInput","paste"]);Qg("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Qg("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Qg("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Cp=new Set("cancel close invalid load scroll toggle".split(" ").concat(yr));function cp(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,EF(i,e,void 0,t),t.currentTarget=null}function Ap(t,e){e=(e&4)!=0;for(var n=0;n<t.length;n++){var i=t[n],g=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var r=i[o],I=r.instance,a=r.currentTarget;if(r=r.listener,I!==s&&g.isPropagationStopped())break e;cp(g,r,a),s=I}else for(o=0;o<i.length;o++){if(r=i[o],I=r.instance,a=r.currentTarget,r=r.listener,I!==s&&g.isPropagationStopped())break e;cp(g,r,a),s=I}}}if(Fa)throw t=vA,Fa=!1,vA=null,t}function ke(t,e){var n=Gp(e),i=t+"__bubble";n.has(i)||(mp(e,t,2,!1),n.add(i))}var dp="_reactListening"+Math.random().toString(36).slice(2);function up(t){t[dp]||(t[dp]=!0,tf.forEach(function(e){Cp.has(e)||hp(e,!1,t,null),hp(e,!0,t,null)}))}function hp(t,e,n,i){var g=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,s=n;if(t==="selectionchange"&&n.nodeType!==9&&(s=n.ownerDocument),i!==null&&!e&&Cp.has(t)){if(t!=="scroll")return;g|=2,s=i}var o=Gp(s),r=t+"__"+(e?"capture":"bubble");o.has(r)||(e&&(g|=4),mp(s,t,g,e),o.add(r))}function mp(t,e,n,i){var g=SA.get(e);switch(g===void 0?2:g){case 0:g=OF;break;case 1:g=jF;break;default:g=xA}n=g.bind(null,e,n,t),g=void 0,!yA||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(g=!0),i?g!==void 0?t.addEventListener(e,n,{capture:!0,passive:g}):t.addEventListener(e,n,!0):g!==void 0?t.addEventListener(e,n,{passive:g}):t.addEventListener(e,n,!1)}function fp(t,e,n,i,g){var s=i;if((e&1)==0&&(e&2)==0&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var r=i.stateNode.containerInfo;if(r===g||r.nodeType===8&&r.parentNode===g)break;if(o===4)for(o=i.return;o!==null;){var I=o.tag;if((I===3||I===4)&&(I=o.stateNode.containerInfo,I===g||I.nodeType===8&&I.parentNode===g))return;o=o.return}for(;r!==null;){if(o=kg(r),o===null)return;if(I=o.tag,I===5||I===6){i=s=o;continue e}r=r.parentNode}}i=i.return}WF(function(){var a=s,l=hA(n),C=[];e:{var c=Hf.get(t);if(c!==void 0){var A=wA,d=t;switch(t){case"keypress":if(Ta(n)===0)break e;case"keydown":case"keyup":A=cS;break;case"focusin":d="focus",A=QA;break;case"focusout":d="blur",A=QA;break;case"beforeblur":case"afterblur":A=QA;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":A=Mf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":A=eS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":A=uS;break;case Qf:case Xf:case Yf:A=iS;break;case _f:A=mS;break;case"scroll":A=qF;break;case"wheel":A=pS;break;case"copy":case"cut":case"paste":A=sS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":A=Jf}var m=(e&4)!=0,u=!m&&t==="scroll",h=m?c!==null?c+"Capture":null:c;m=[];for(var f=a,p;f!==null;){p=f;var b=p.stateNode;if(p.tag===5&&b!==null&&(p=b,h!==null&&(b=or(f,h),b!=null&&m.push(vr(f,b,p)))),u)break;f=f.return}0<m.length&&(c=new A(c,d,null,n,l),C.push({event:c,listeners:m}))}}if((e&7)==0){e:{if(c=t==="mouseover"||t==="pointerover",A=t==="mouseout"||t==="pointerout",c&&(e&16)==0&&(d=n.relatedTarget||n.fromElement)&&(kg(d)||d[_s]))break e;if((A||c)&&(c=l.window===l?l:(c=l.ownerDocument)?c.defaultView||c.parentWindow:window,A?(d=n.relatedTarget||n.toElement,A=a,d=d?kg(d):null,d!==null&&(u=Hg(d),d!==u||d.tag!==5&&d.tag!==6)&&(d=null)):(A=null,d=a),A!==d)){if(m=Mf,b="onMouseLeave",h="onMouseEnter",f="mouse",(t==="pointerout"||t==="pointerover")&&(m=Jf,b="onPointerLeave",h="onPointerEnter",f="pointer"),u=A==null?c:Hs(A),p=d==null?c:Hs(d),c=new m(b,f+"leave",A,n,l),c.target=u,c.relatedTarget=p,b=null,kg(l)===a&&(m=new m(h,f+"enter",d,n,l),m.target=p,m.relatedTarget=u,b=m),u=b,A&&d)t:{for(m=A,h=d,f=0,p=m;p;p=Xs(p))f++;for(p=0,b=h;b;b=Xs(b))p++;for(;0<f-p;)m=Xs(m),f--;for(;0<p-f;)h=Xs(h),p--;for(;f--;){if(m===h||h!==null&&m===h.alternate)break t;m=Xs(m),h=Xs(h)}m=null}else m=null;A!==null&&pp(C,c,A,m,!1),d!==null&&u!==null&&pp(C,u,d,m,!0)}}e:{if(c=a?Hs(a):window,A=c.nodeName&&c.nodeName.toLowerCase(),A==="select"||A==="input"&&c.type==="file")var Z=RS;else if($f(c))if(tp)Z=US;else{Z=SS;var v=FS}else(A=c.nodeName)&&A.toLowerCase()==="input"&&(c.type==="checkbox"||c.type==="radio")&&(Z=VS);if(Z&&(Z=Z(t,a))){ep(C,Z,n,l);break e}v&&v(t,c,a),t==="focusout"&&(v=c._wrapperState)&&v.controlled&&c.type==="number"&&aA(c,"number",c.value)}switch(v=a?Hs(a):window,t){case"focusin":($f(v)||v.contentEditable==="true")&&(Qs=v,KA=a,br=null);break;case"focusout":br=KA=Qs=null;break;case"mousedown":LA=!0;break;case"contextmenu":case"mouseup":case"dragend":LA=!1,ap(C,n,l);break;case"selectionchange":if(NS)break;case"keydown":case"keyup":ap(C,n,l)}var N;if(YA)e:{switch(t){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Es?jf(t,n)&&(x="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(x="onCompositionStart");x&&(Df&&n.locale!=="ko"&&(Es||x!=="onCompositionStart"?x==="onCompositionEnd"&&Es&&(N=Kf()):(zi=l,NA="value"in zi?zi.value:zi.textContent,Es=!0)),v=Ya(a,x),0<v.length&&(x=new Pf(x,t,null,n,l),C.push({event:x,listeners:v}),N?x.data=N:(N=qf(n),N!==null&&(x.data=N)))),(N=bS?yS(t,n):vS(t,n))&&(a=Ya(a,"onBeforeInput"),0<a.length&&(l=new Pf("onBeforeInput","beforeinput",null,n,l),C.push({event:l,listeners:a}),l.data=N))}Ap(C,e)})}function vr(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ya(t,e){for(var n=e+"Capture",i=[];t!==null;){var g=t,s=g.stateNode;g.tag===5&&s!==null&&(g=s,s=or(t,n),s!=null&&i.unshift(vr(t,s,g)),s=or(t,e),s!=null&&i.push(vr(t,s,g))),t=t.return}return i}function Xs(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function pp(t,e,n,i,g){for(var s=e._reactName,o=[];n!==null&&n!==i;){var r=n,I=r.alternate,a=r.stateNode;if(I!==null&&I===i)break;r.tag===5&&a!==null&&(r=a,g?(I=or(n,s),I!=null&&o.unshift(vr(n,I,r))):g||(I=or(n,s),I!=null&&o.push(vr(n,I,r)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}function _a(){}var PA=null,JA=null;function Bp(t,e){switch(t){case"button":case"input":case"select":case"textarea":return!!e.autoFocus}return!1}function DA(t,e){return t==="textarea"||t==="option"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var bp=typeof setTimeout=="function"?setTimeout:void 0,wS=typeof clearTimeout=="function"?clearTimeout:void 0;function zA(t){t.nodeType===1?t.textContent="":t.nodeType===9&&(t=t.body,t!=null&&(t.textContent=""))}function Ys(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break}return t}function yp(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var OA=0;function TS(t){return{$$typeof:nA,toString:t,valueOf:t}}var Ha=Math.random().toString(36).slice(2),Oi="__reactFiber$"+Ha,ka="__reactProps$"+Ha,_s="__reactContainer$"+Ha,vp="__reactEvents$"+Ha;function kg(t){var e=t[Oi];if(e)return e;for(var n=t.parentNode;n;){if(e=n[_s]||n[Oi]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=yp(t);t!==null;){if(n=t[Oi])return n;t=yp(t)}return e}t=n,n=t.parentNode}return null}function Gr(t){return t=t[Oi]||t[_s],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Hs(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(M(33))}function Ka(t){return t[ka]||null}function Gp(t){var e=t[vp];return e===void 0&&(e=t[vp]=new Set),e}var jA=[],ks=-1;function ji(t){return{current:t}}function Ke(t){0>ks||(t.current=jA[ks],jA[ks]=null,ks--)}function tt(t,e){ks++,jA[ks]=t.current,t.current=e}var qi={},xt=ji(qi),Ot=ji(!1),Kg=qi;function Ks(t,e){var n=t.type.contextTypes;if(!n)return qi;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var g={},s;for(s in n)g[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=g),g}function jt(t){return t=t.childContextTypes,t!=null}function La(){Ke(Ot),Ke(xt)}function Zp(t,e,n){if(xt.current!==qi)throw Error(M(168));tt(xt,e),tt(Ot,n)}function Rp(t,e,n){var i=t.stateNode;if(t=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var g in i)if(!(g in t))throw Error(M(108,Ss(e)||"Unknown",g));return ze({},n,i)}function Ma(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||qi,Kg=xt.current,tt(xt,t),tt(Ot,Ot.current),!0}function Fp(t,e,n){var i=t.stateNode;if(!i)throw Error(M(169));n?(t=Rp(t,e,Kg),i.__reactInternalMemoizedMergedChildContext=t,Ke(Ot),Ke(xt),tt(xt,t)):Ke(Ot),tt(Ot,n)}var qA=null,Lg=null,ES=ut.unstable_runWithPriority,$A=ut.unstable_scheduleCallback,ed=ut.unstable_cancelCallback,QS=ut.unstable_shouldYield,Sp=ut.unstable_requestPaint,td=ut.unstable_now,XS=ut.unstable_getCurrentPriorityLevel,Pa=ut.unstable_ImmediatePriority,Vp=ut.unstable_UserBlockingPriority,Up=ut.unstable_NormalPriority,xp=ut.unstable_LowPriority,Wp=ut.unstable_IdlePriority,nd={},YS=Sp!==void 0?Sp:function(){},fi=null,Ja=null,id=!1,Np=td(),Wt=1e4>Np?td:function(){return td()-Np};function Ls(){switch(XS()){case Pa:return 99;case Vp:return 98;case Up:return 97;case xp:return 96;case Wp:return 95;default:throw Error(M(332))}}function wp(t){switch(t){case 99:return Pa;case 98:return Vp;case 97:return Up;case 96:return xp;case 95:return Wp;default:throw Error(M(332))}}function Mg(t,e){return t=wp(t),ES(t,e)}function Zr(t,e,n){return t=wp(t),$A(t,e,n)}function zn(){if(Ja!==null){var t=Ja;Ja=null,ed(t)}Tp()}function Tp(){if(!id&&fi!==null){id=!0;var t=0;try{var e=fi;Mg(99,function(){for(;t<e.length;t++){var n=e[t];do n=n(!0);while(n!==null)}}),fi=null}catch(n){throw fi!==null&&(fi=fi.slice(t+1)),$A(Pa,zn),n}finally{id=!1}}}var _S=Xg.ReactCurrentBatchConfig;function Tn(t,e){if(t&&t.defaultProps){e=ze({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Da=ji(null),za=null,Ms=null,Oa=null;function gd(){Oa=Ms=za=null}function sd(t){var e=Da.current;Ke(Da),t.type._context._currentValue=e}function Ep(t,e){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)===e){if(n===null||(n.childLanes&e)===e)break;n.childLanes|=e}else t.childLanes|=e,n!==null&&(n.childLanes|=e);t=t.return}}function Ps(t,e){za=t,Oa=Ms=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!=0&&(En=!0),t.firstContext=null)}function Bn(t,e){if(Oa!==t&&e!==!1&&e!==0)if((typeof e!="number"||e===1073741823)&&(Oa=t,e=1073741823),e={context:t,observedBits:e,next:null},Ms===null){if(za===null)throw Error(M(308));Ms=e,za.dependencies={lanes:0,firstContext:e,responders:null}}else Ms=Ms.next=e;return t._currentValue}var $i=!1;function od(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function Qp(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function eg(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function tg(t,e){if(t=t.updateQueue,t!==null){t=t.shared;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}}function Xp(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var g=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?g=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?g=s=e:s=s.next=e}else g=s=e;n={baseState:i.baseState,firstBaseUpdate:g,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Rr(t,e,n,i){var g=t.updateQueue;$i=!1;var s=g.firstBaseUpdate,o=g.lastBaseUpdate,r=g.shared.pending;if(r!==null){g.shared.pending=null;var I=r,a=I.next;I.next=null,o===null?s=a:o.next=a,o=I;var l=t.alternate;if(l!==null){l=l.updateQueue;var C=l.lastBaseUpdate;C!==o&&(C===null?l.firstBaseUpdate=a:C.next=a,l.lastBaseUpdate=I)}}if(s!==null){C=g.baseState,o=0,l=a=I=null;do{r=s.lane;var c=s.eventTime;if((i&r)===r){l!==null&&(l=l.next={eventTime:c,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var A=t,d=s;switch(r=e,c=n,d.tag){case 1:if(A=d.payload,typeof A=="function"){C=A.call(c,C,r);break e}C=A;break e;case 3:A.flags=A.flags&-4097|64;case 0:if(A=d.payload,r=typeof A=="function"?A.call(c,C,r):A,r==null)break e;C=ze({},C,r);break e;case 2:$i=!0}}s.callback!==null&&(t.flags|=32,r=g.effects,r===null?g.effects=[s]:r.push(s))}else c={eventTime:c,lane:r,tag:s.tag,payload:s.payload,callback:s.callback,next:null},l===null?(a=l=c,I=C):l=l.next=c,o|=r;if(s=s.next,s===null){if(r=g.shared.pending,r===null)break;s=r.next,r.next=null,g.lastBaseUpdate=r,g.shared.pending=null}}while(1);l===null&&(I=C),g.baseState=I,g.firstBaseUpdate=a,g.lastBaseUpdate=l,Xr|=o,t.lanes=o,t.memoizedState=C}}function Yp(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],g=i.callback;if(g!==null){if(i.callback=null,i=n,typeof g!="function")throw Error(M(191,g));g.call(i)}}}var _p=new fa.Component().refs;function ja(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:ze({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var qa={isMounted:function(t){return(t=t._reactInternals)?Hg(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=tn(),g=gg(t),s=eg(i,g);s.payload=e,n!=null&&(s.callback=n),tg(t,s),sg(t,g,i)},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=tn(),g=gg(t),s=eg(i,g);s.tag=1,s.payload=e,n!=null&&(s.callback=n),tg(t,s),sg(t,g,i)},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=tn(),i=gg(t),g=eg(n,i);g.tag=2,e!=null&&(g.callback=e),tg(t,g),sg(t,i,n)}};function Hp(t,e,n,i,g,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Br(n,i)||!Br(g,s):!0}function kp(t,e,n){var i=!1,g=qi,s=e.contextType;return typeof s=="object"&&s!==null?s=Bn(s):(g=jt(e)?Kg:xt.current,i=e.contextTypes,s=(i=i!=null)?Ks(t,g):qi),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=qa,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=g,t.__reactInternalMemoizedMaskedChildContext=s),e}function Kp(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&qa.enqueueReplaceState(e,e.state,null)}function rd(t,e,n,i){var g=t.stateNode;g.props=n,g.state=t.memoizedState,g.refs=_p,od(t);var s=e.contextType;typeof s=="object"&&s!==null?g.context=Bn(s):(s=jt(e)?Kg:xt.current,g.context=Ks(t,s)),Rr(t,n,g,i),g.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(ja(t,e,s,n),g.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(e=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),e!==g.state&&qa.enqueueReplaceState(g,g.state,null),Rr(t,n,g,i),g.state=t.memoizedState),typeof g.componentDidMount=="function"&&(t.flags|=4)}var $a=Array.isArray;function Fr(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(M(309));var i=n.stateNode}if(!i)throw Error(M(147,t));var g=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===g?e.ref:(e=function(s){var o=i.refs;o===_p&&(o=i.refs={}),s===null?delete o[g]:o[g]=s},e._stringRef=g,e)}if(typeof t!="string")throw Error(M(284));if(!n._owner)throw Error(M(290,t))}return t}function el(t,e){if(t.type!=="textarea")throw Error(M(31,Object.prototype.toString.call(e)==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":e))}function Lp(t){function e(u,h){if(t){var f=u.lastEffect;f!==null?(f.nextEffect=h,u.lastEffect=h):u.firstEffect=u.lastEffect=h,h.nextEffect=null,h.flags=8}}function n(u,h){if(!t)return null;for(;h!==null;)e(u,h),h=h.sibling;return null}function i(u,h){for(u=new Map;h!==null;)h.key!==null?u.set(h.key,h):u.set(h.index,h),h=h.sibling;return u}function g(u,h){return u=Ig(u,h),u.index=0,u.sibling=null,u}function s(u,h,f){return u.index=f,t?(f=u.alternate,f!==null?(f=f.index,f<h?(u.flags=2,h):f):(u.flags=2,h)):h}function o(u){return t&&u.alternate===null&&(u.flags=2),u}function r(u,h,f,p){return h===null||h.tag!==6?(h=Kd(f,u.mode,p),h.return=u,h):(h=g(h,f),h.return=u,h)}function I(u,h,f,p){return h!==null&&h.elementType===f.type?(p=g(h,f.props),p.ref=Fr(u,h,f),p.return=u,p):(p=fl(f.type,f.key,f.props,null,u.mode,p),p.ref=Fr(u,h,f),p.return=u,p)}function a(u,h,f,p){return h===null||h.tag!==4||h.stateNode.containerInfo!==f.containerInfo||h.stateNode.implementation!==f.implementation?(h=Ld(f,u.mode,p),h.return=u,h):(h=g(h,f.children||[]),h.return=u,h)}function l(u,h,f,p,b){return h===null||h.tag!==7?(h=eo(f,u.mode,p,b),h.return=u,h):(h=g(h,f),h.return=u,h)}function C(u,h,f){if(typeof h=="string"||typeof h=="number")return h=Kd(""+h,u.mode,f),h.return=u,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case $o:return f=fl(h.type,h.key,h.props,null,u.mode,f),f.ref=Fr(u,null,h),f.return=u,f;case Yg:return h=Ld(h,u.mode,f),h.return=u,h}if($a(h)||nr(h))return h=eo(h,u.mode,f,null),h.return=u,h;el(u,h)}return null}function c(u,h,f,p){var b=h!==null?h.key:null;if(typeof f=="string"||typeof f=="number")return b!==null?null:r(u,h,""+f,p);if(typeof f=="object"&&f!==null){switch(f.$$typeof){case $o:return f.key===b?f.type===Ki?l(u,h,f.props.children,p,b):I(u,h,f,p):null;case Yg:return f.key===b?a(u,h,f,p):null}if($a(f)||nr(f))return b!==null?null:l(u,h,f,p,null);el(u,f)}return null}function A(u,h,f,p,b){if(typeof p=="string"||typeof p=="number")return u=u.get(f)||null,r(h,u,""+p,b);if(typeof p=="object"&&p!==null){switch(p.$$typeof){case $o:return u=u.get(p.key===null?f:p.key)||null,p.type===Ki?l(h,u,p.props.children,b,p.key):I(h,u,p,b);case Yg:return u=u.get(p.key===null?f:p.key)||null,a(h,u,p,b)}if($a(p)||nr(p))return u=u.get(f)||null,l(h,u,p,b,null);el(h,p)}return null}function d(u,h,f,p){for(var b=null,Z=null,v=h,N=h=0,x=null;v!==null&&N<f.length;N++){v.index>N?(x=v,v=null):x=v.sibling;var V=c(u,v,f[N],p);if(V===null){v===null&&(v=x);break}t&&v&&V.alternate===null&&e(u,v),h=s(V,h,N),Z===null?b=V:Z.sibling=V,Z=V,v=x}if(N===f.length)return n(u,v),b;if(v===null){for(;N<f.length;N++)v=C(u,f[N],p),v!==null&&(h=s(v,h,N),Z===null?b=v:Z.sibling=v,Z=v);return b}for(v=i(u,v);N<f.length;N++)x=A(v,u,N,f[N],p),x!==null&&(t&&x.alternate!==null&&v.delete(x.key===null?N:x.key),h=s(x,h,N),Z===null?b=x:Z.sibling=x,Z=x);return t&&v.forEach(function(E){return e(u,E)}),b}function m(u,h,f,p){var b=nr(f);if(typeof b!="function")throw Error(M(150));if(f=b.call(f),f==null)throw Error(M(151));for(var Z=b=null,v=h,N=h=0,x=null,V=f.next();v!==null&&!V.done;N++,V=f.next()){v.index>N?(x=v,v=null):x=v.sibling;var E=c(u,v,V.value,p);if(E===null){v===null&&(v=x);break}t&&v&&E.alternate===null&&e(u,v),h=s(E,h,N),Z===null?b=E:Z.sibling=E,Z=E,v=x}if(V.done)return n(u,v),b;if(v===null){for(;!V.done;N++,V=f.next())V=C(u,V.value,p),V!==null&&(h=s(V,h,N),Z===null?b=V:Z.sibling=V,Z=V);return b}for(v=i(u,v);!V.done;N++,V=f.next())V=A(v,u,N,V.value,p),V!==null&&(t&&V.alternate!==null&&v.delete(V.key===null?N:V.key),h=s(V,h,N),Z===null?b=V:Z.sibling=V,Z=V);return t&&v.forEach(function(D){return e(u,D)}),b}return function(u,h,f,p){var b=typeof f=="object"&&f!==null&&f.type===Ki&&f.key===null;b&&(f=f.props.children);var Z=typeof f=="object"&&f!==null;if(Z)switch(f.$$typeof){case $o:e:{for(Z=f.key,b=h;b!==null;){if(b.key===Z){switch(b.tag){case 7:if(f.type===Ki){n(u,b.sibling),h=g(b,f.props.children),h.return=u,u=h;break e}break;default:if(b.elementType===f.type){n(u,b.sibling),h=g(b,f.props),h.ref=Fr(u,b,f),h.return=u,u=h;break e}}n(u,b);break}else e(u,b);b=b.sibling}f.type===Ki?(h=eo(f.props.children,u.mode,p,f.key),h.return=u,u=h):(p=fl(f.type,f.key,f.props,null,u.mode,p),p.ref=Fr(u,h,f),p.return=u,u=p)}return o(u);case Yg:e:{for(b=f.key;h!==null;){if(h.key===b)if(h.tag===4&&h.stateNode.containerInfo===f.containerInfo&&h.stateNode.implementation===f.implementation){n(u,h.sibling),h=g(h,f.children||[]),h.return=u,u=h;break e}else{n(u,h);break}else e(u,h);h=h.sibling}h=Ld(f,u.mode,p),h.return=u,u=h}return o(u)}if(typeof f=="string"||typeof f=="number")return f=""+f,h!==null&&h.tag===6?(n(u,h.sibling),h=g(h,f),h.return=u,u=h):(n(u,h),h=Kd(f,u.mode,p),h.return=u,u=h),o(u);if($a(f))return d(u,h,f,p);if(nr(f))return m(u,h,f,p);if(Z&&el(u,f),typeof f=="undefined"&&!b)switch(u.tag){case 1:case 22:case 0:case 11:case 15:throw Error(M(152,Ss(u.type)||"Component"))}return n(u,h)}}var tl=Lp(!0),Mp=Lp(!1),Sr={},On=ji(Sr),Vr=ji(Sr),Ur=ji(Sr);function Pg(t){if(t===Sr)throw Error(M(174));return t}function Id(t,e){switch(tt(Ur,e),tt(Vr,t),tt(On,Sr),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:AA(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=AA(e,t)}Ke(On),tt(On,e)}function Js(){Ke(On),Ke(Vr),Ke(Ur)}function Pp(t){Pg(Ur.current);var e=Pg(On.current),n=AA(e,t.type);e!==n&&(tt(Vr,t),tt(On,n))}function ad(t){Vr.current===t&&(Ke(On),Ke(Vr))}var nt=ji(0);function nl(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&64)!=0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var pi=null,ng=null,jn=!1;function Jp(t,e){var n=vn(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=e,n.return=t,n.flags=8,t.lastEffect!==null?(t.lastEffect.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n}function Dp(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,!0):!1;case 13:return!1;default:return!1}}function ld(t){if(jn){var e=ng;if(e){var n=e;if(!Dp(t,e)){if(e=Ys(n.nextSibling),!e||!Dp(t,e)){t.flags=t.flags&-1025|2,jn=!1,pi=t;return}Jp(pi,n)}pi=t,ng=Ys(e.firstChild)}else t.flags=t.flags&-1025|2,jn=!1,pi=t}}function zp(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;pi=t}function il(t){if(t!==pi)return!1;if(!jn)return zp(t),jn=!0,!1;var e=t.type;if(t.tag!==5||e!=="head"&&e!=="body"&&!DA(e,t.memoizedProps))for(e=ng;e;)Jp(t,e),e=Ys(e.nextSibling);if(zp(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(M(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ng=Ys(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ng=null}}else ng=pi?Ys(t.stateNode.nextSibling):null;return!0}function Cd(){ng=pi=null,jn=!1}var Ds=[];function cd(){for(var t=0;t<Ds.length;t++)Ds[t]._workInProgressVersionPrimary=null;Ds.length=0}var xr=Xg.ReactCurrentDispatcher,bn=Xg.ReactCurrentBatchConfig,Wr=0,ot=null,Nt=null,vt=null,gl=!1,Nr=!1;function qt(){throw Error(M(321))}function Ad(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!pn(t[n],e[n]))return!1;return!0}function dd(t,e,n,i,g,s){if(Wr=s,ot=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,xr.current=t===null||t.memoizedState===null?kS:KS,t=n(i,g),Nr){s=0;do{if(Nr=!1,!(25>s))throw Error(M(301));s+=1,vt=Nt=null,e.updateQueue=null,xr.current=LS,t=n(i,g)}while(Nr)}if(xr.current=Il,e=Nt!==null&&Nt.next!==null,Wr=0,vt=Nt=ot=null,gl=!1,e)throw Error(M(300));return t}function Jg(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vt===null?ot.memoizedState=vt=t:vt=vt.next=t,vt}function Dg(){if(Nt===null){var t=ot.alternate;t=t!==null?t.memoizedState:null}else t=Nt.next;var e=vt===null?ot.memoizedState:vt.next;if(e!==null)vt=e,Nt=t;else{if(t===null)throw Error(M(310));Nt=t,t={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},vt===null?ot.memoizedState=vt=t:vt=vt.next=t}return vt}function qn(t,e){return typeof e=="function"?e(t):e}function wr(t){var e=Dg(),n=e.queue;if(n===null)throw Error(M(311));n.lastRenderedReducer=t;var i=Nt,g=i.baseQueue,s=n.pending;if(s!==null){if(g!==null){var o=g.next;g.next=s.next,s.next=o}i.baseQueue=g=s,n.pending=null}if(g!==null){g=g.next,i=i.baseState;var r=o=s=null,I=g;do{var a=I.lane;if((Wr&a)===a)r!==null&&(r=r.next={lane:0,action:I.action,eagerReducer:I.eagerReducer,eagerState:I.eagerState,next:null}),i=I.eagerReducer===t?I.eagerState:t(i,I.action);else{var l={lane:a,action:I.action,eagerReducer:I.eagerReducer,eagerState:I.eagerState,next:null};r===null?(o=r=l,s=i):r=r.next=l,ot.lanes|=a,Xr|=a}I=I.next}while(I!==null&&I!==g);r===null?s=i:r.next=o,pn(i,e.memoizedState)||(En=!0),e.memoizedState=i,e.baseState=s,e.baseQueue=r,n.lastRenderedState=i}return[e.memoizedState,n.dispatch]}function Tr(t){var e=Dg(),n=e.queue;if(n===null)throw Error(M(311));n.lastRenderedReducer=t;var i=n.dispatch,g=n.pending,s=e.memoizedState;if(g!==null){n.pending=null;var o=g=g.next;do s=t(s,o.action),o=o.next;while(o!==g);pn(s,e.memoizedState)||(En=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function Op(t,e,n){var i=e._getVersion;i=i(e._source);var g=e._workInProgressVersionPrimary;if(g!==null?t=g===i:(t=t.mutableReadLanes,(t=(Wr&t)===t)&&(e._workInProgressVersionPrimary=i,Ds.push(e))),t)return n(e._source);throw Ds.push(e),Error(M(350))}function jp(t,e,n,i){var g=Kt;if(g===null)throw Error(M(349));var s=e._getVersion,o=s(e._source),r=xr.current,I=r.useState(function(){return Op(g,e,n)}),a=I[1],l=I[0];I=vt;var C=t.memoizedState,c=C.refs,A=c.getSnapshot,d=C.source;C=C.subscribe;var m=ot;return t.memoizedState={refs:c,source:e,subscribe:i},r.useEffect(function(){c.getSnapshot=n,c.setSnapshot=a;var u=s(e._source);if(!pn(o,u)){u=n(e._source),pn(l,u)||(a(u),u=gg(m),g.mutableReadLanes|=u&g.pendingLanes),u=g.mutableReadLanes,g.entangledLanes|=u;for(var h=g.entanglements,f=u;0<f;){var p=31-Di(f),b=1<<p;h[p]|=u,f&=~b}}},[n,e,i]),r.useEffect(function(){return i(e._source,function(){var u=c.getSnapshot,h=c.setSnapshot;try{h(u(e._source));var f=gg(m);g.mutableReadLanes|=f&g.pendingLanes}catch(p){h(function(){throw p})}})},[e,i]),pn(A,n)&&pn(d,e)&&pn(C,i)||(t={pending:null,dispatch:null,lastRenderedReducer:qn,lastRenderedState:l},t.dispatch=a=fd.bind(null,ot,t),I.queue=t,I.baseQueue=null,l=Op(g,e,n),I.memoizedState=I.baseState=l),l}function qp(t,e,n){var i=Dg();return jp(i,t,e,n)}function Er(t){var e=Jg();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t=e.queue={pending:null,dispatch:null,lastRenderedReducer:qn,lastRenderedState:t},t=t.dispatch=fd.bind(null,ot,t),[e.memoizedState,t]}function sl(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=ot.updateQueue,e===null?(e={lastEffect:null},ot.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function $p(t){var e=Jg();return t={current:t},e.memoizedState=t}function ol(){return Dg().memoizedState}function ud(t,e,n,i){var g=Jg();ot.flags|=t,g.memoizedState=sl(1|e,n,void 0,i===void 0?null:i)}function hd(t,e,n,i){var g=Dg();i=i===void 0?null:i;var s=void 0;if(Nt!==null){var o=Nt.memoizedState;if(s=o.destroy,i!==null&&Ad(i,o.deps)){sl(e,n,s,i);return}}ot.flags|=t,g.memoizedState=sl(1|e,n,s,i)}function eB(t,e){return ud(516,4,t,e)}function rl(t,e){return hd(516,4,t,e)}function tB(t,e){return hd(4,2,t,e)}function nB(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function iB(t,e,n){return n=n!=null?n.concat([t]):null,hd(4,2,nB.bind(null,e,t),n)}function md(){}function gB(t,e){var n=Dg();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Ad(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function sB(t,e){var n=Dg();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Ad(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function HS(t,e){var n=Ls();Mg(98>n?98:n,function(){t(!0)}),Mg(97<n?97:n,function(){var i=bn.transition;bn.transition=1;try{t(!1),e()}finally{bn.transition=i}})}function fd(t,e,n){var i=tn(),g=gg(t),s={lane:g,action:n,eagerReducer:null,eagerState:null,next:null},o=e.pending;if(o===null?s.next=s:(s.next=o.next,o.next=s),e.pending=s,o=t.alternate,t===ot||o!==null&&o===ot)Nr=gl=!0;else{if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var r=e.lastRenderedState,I=o(r,n);if(s.eagerReducer=o,s.eagerState=I,pn(I,r))return}catch{}finally{}sg(t,g,i)}}var Il={readContext:Bn,useCallback:qt,useContext:qt,useEffect:qt,useImperativeHandle:qt,useLayoutEffect:qt,useMemo:qt,useReducer:qt,useRef:qt,useState:qt,useDebugValue:qt,useDeferredValue:qt,useTransition:qt,useMutableSource:qt,useOpaqueIdentifier:qt,unstable_isNewReconciler:!1},kS={readContext:Bn,useCallback:function(t,e){return Jg().memoizedState=[t,e===void 0?null:e],t},useContext:Bn,useEffect:eB,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ud(4,2,nB.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ud(4,2,t,e)},useMemo:function(t,e){var n=Jg();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=Jg();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t=i.queue={pending:null,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},t=t.dispatch=fd.bind(null,ot,t),[i.memoizedState,t]},useRef:$p,useState:Er,useDebugValue:md,useDeferredValue:function(t){var e=Er(t),n=e[0],i=e[1];return eB(function(){var g=bn.transition;bn.transition=1;try{i(t)}finally{bn.transition=g}},[t]),n},useTransition:function(){var t=Er(!1),e=t[0];return t=HS.bind(null,t[1]),$p(t),[t,e]},useMutableSource:function(t,e,n){var i=Jg();return i.memoizedState={refs:{getSnapshot:e,setSnapshot:null},source:t,subscribe:n},jp(i,t,e,n)},useOpaqueIdentifier:function(){if(jn){var t=!1,e=TS(function(){throw t||(t=!0,n("r:"+(OA++).toString(36))),Error(M(355))}),n=Er(e)[1];return(ot.mode&2)==0&&(ot.flags|=516,sl(5,function(){n("r:"+(OA++).toString(36))},void 0,null)),e}return e="r:"+(OA++).toString(36),Er(e),e},unstable_isNewReconciler:!1},KS={readContext:Bn,useCallback:gB,useContext:Bn,useEffect:rl,useImperativeHandle:iB,useLayoutEffect:tB,useMemo:sB,useReducer:wr,useRef:ol,useState:function(){return wr(qn)},useDebugValue:md,useDeferredValue:function(t){var e=wr(qn),n=e[0],i=e[1];return rl(function(){var g=bn.transition;bn.transition=1;try{i(t)}finally{bn.transition=g}},[t]),n},useTransition:function(){var t=wr(qn)[0];return[ol().current,t]},useMutableSource:qp,useOpaqueIdentifier:function(){return wr(qn)[0]},unstable_isNewReconciler:!1},LS={readContext:Bn,useCallback:gB,useContext:Bn,useEffect:rl,useImperativeHandle:iB,useLayoutEffect:tB,useMemo:sB,useReducer:Tr,useRef:ol,useState:function(){return Tr(qn)},useDebugValue:md,useDeferredValue:function(t){var e=Tr(qn),n=e[0],i=e[1];return rl(function(){var g=bn.transition;bn.transition=1;try{i(t)}finally{bn.transition=g}},[t]),n},useTransition:function(){var t=Tr(qn)[0];return[ol().current,t]},useMutableSource:qp,useOpaqueIdentifier:function(){return Tr(qn)[0]},unstable_isNewReconciler:!1},MS=Xg.ReactCurrentOwner,En=!1;function $t(t,e,n,i){e.child=t===null?Mp(e,null,n,i):tl(e,t.child,n,i)}function oB(t,e,n,i,g){n=n.render;var s=e.ref;return Ps(e,g),i=dd(t,e,n,i,s,g),t!==null&&!En?(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~g,Bi(t,e,g)):(e.flags|=1,$t(t,e,i,g),e.child)}function rB(t,e,n,i,g,s){if(t===null){var o=n.type;return typeof o=="function"&&!Hd(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,IB(t,e,o,i,g,s)):(t=fl(n.type,null,i,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}return o=t.child,(g&s)==0&&(g=o.memoizedProps,n=n.compare,n=n!==null?n:Br,n(g,i)&&t.ref===e.ref)?Bi(t,e,s):(e.flags|=1,t=Ig(o,i),t.ref=e.ref,t.return=e,e.child=t)}function IB(t,e,n,i,g,s){if(t!==null&&Br(t.memoizedProps,i)&&t.ref===e.ref)if(En=!1,(s&g)!=0)(t.flags&16384)!=0&&(En=!0);else return e.lanes=t.lanes,Bi(t,e,s);return Bd(t,e,n,i,s)}function pd(t,e,n){var i=e.pendingProps,g=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden"||i.mode==="unstable-defer-without-hiding")if((e.mode&4)==0)e.memoizedState={baseLanes:0},ml(e,n);else if((n&1073741824)!=0)e.memoizedState={baseLanes:0},ml(e,s!==null?s.baseLanes:n);else return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t},ml(e,t),null;else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,ml(e,i);return $t(t,e,g,n),e.child}function aB(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=128)}function Bd(t,e,n,i,g){var s=jt(n)?Kg:xt.current;return s=Ks(e,s),Ps(e,g),n=dd(t,e,n,i,s,g),t!==null&&!En?(e.updateQueue=t.updateQueue,e.flags&=-517,t.lanes&=~g,Bi(t,e,g)):(e.flags|=1,$t(t,e,n,g),e.child)}function lB(t,e,n,i,g){if(jt(n)){var s=!0;Ma(e)}else s=!1;if(Ps(e,g),e.stateNode===null)t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),kp(e,n,i),rd(e,n,i,g),i=!0;else if(t===null){var o=e.stateNode,r=e.memoizedProps;o.props=r;var I=o.context,a=n.contextType;typeof a=="object"&&a!==null?a=Bn(a):(a=jt(n)?Kg:xt.current,a=Ks(e,a));var l=n.getDerivedStateFromProps,C=typeof l=="function"||typeof o.getSnapshotBeforeUpdate=="function";C||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(r!==i||I!==a)&&Kp(e,o,i,a),$i=!1;var c=e.memoizedState;o.state=c,Rr(e,i,o,g),I=e.memoizedState,r!==i||c!==I||Ot.current||$i?(typeof l=="function"&&(ja(e,n,l,i),I=e.memoizedState),(r=$i||Hp(e,n,r,i,c,I,a))?(C||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4)):(typeof o.componentDidMount=="function"&&(e.flags|=4),e.memoizedProps=i,e.memoizedState=I),o.props=i,o.state=I,o.context=a,i=r):(typeof o.componentDidMount=="function"&&(e.flags|=4),i=!1)}else{o=e.stateNode,Qp(t,e),r=e.memoizedProps,a=e.type===e.elementType?r:Tn(e.type,r),o.props=a,C=e.pendingProps,c=o.context,I=n.contextType,typeof I=="object"&&I!==null?I=Bn(I):(I=jt(n)?Kg:xt.current,I=Ks(e,I));var A=n.getDerivedStateFromProps;(l=typeof A=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(r!==C||c!==I)&&Kp(e,o,i,I),$i=!1,c=e.memoizedState,o.state=c,Rr(e,i,o,g);var d=e.memoizedState;r!==C||c!==d||Ot.current||$i?(typeof A=="function"&&(ja(e,n,A,i),d=e.memoizedState),(a=$i||Hp(e,n,a,i,c,d,I))?(l||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,d,I),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,d,I)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=256)):(typeof o.componentDidUpdate!="function"||r===t.memoizedProps&&c===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||r===t.memoizedProps&&c===t.memoizedState||(e.flags|=256),e.memoizedProps=i,e.memoizedState=d),o.props=i,o.state=d,o.context=I,i=a):(typeof o.componentDidUpdate!="function"||r===t.memoizedProps&&c===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||r===t.memoizedProps&&c===t.memoizedState||(e.flags|=256),i=!1)}return bd(t,e,n,i,s,g)}function bd(t,e,n,i,g,s){aB(t,e);var o=(e.flags&64)!=0;if(!i&&!o)return g&&Fp(e,n,!1),Bi(t,e,s);i=e.stateNode,MS.current=e;var r=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=tl(e,t.child,null,s),e.child=tl(e,null,r,s)):$t(t,e,r,s),e.memoizedState=i.state,g&&Fp(e,n,!0),e.child}function CB(t){var e=t.stateNode;e.pendingContext?Zp(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Zp(t,e.context,!1),Id(t,e.containerInfo)}var al={dehydrated:null,retryLane:0};function cB(t,e,n){var i=e.pendingProps,g=nt.current,s=!1,o;return(o=(e.flags&64)!=0)||(o=t!==null&&t.memoizedState===null?!1:(g&2)!=0),o?(s=!0,e.flags&=-65):t!==null&&t.memoizedState===null||i.fallback===void 0||i.unstable_avoidThisFallback===!0||(g|=1),tt(nt,g&1),t===null?(i.fallback!==void 0&&ld(e),t=i.children,g=i.fallback,s?(t=AB(e,t,g,n),e.child.memoizedState={baseLanes:n},e.memoizedState=al,t):typeof i.unstable_expectedLoadTime=="number"?(t=AB(e,t,g,n),e.child.memoizedState={baseLanes:n},e.memoizedState=al,e.lanes=33554432,t):(n=kd({mode:"visible",children:t},e.mode,n,null),n.return=e,e.child=n)):t.memoizedState!==null?s?(i=uB(t,e,i.children,i.fallback,n),s=e.child,g=t.child.memoizedState,s.memoizedState=g===null?{baseLanes:n}:{baseLanes:g.baseLanes|n},s.childLanes=t.childLanes&~n,e.memoizedState=al,i):(n=dB(t,e,i.children,n),e.memoizedState=null,n):s?(i=uB(t,e,i.children,i.fallback,n),s=e.child,g=t.child.memoizedState,s.memoizedState=g===null?{baseLanes:n}:{baseLanes:g.baseLanes|n},s.childLanes=t.childLanes&~n,e.memoizedState=al,i):(n=dB(t,e,i.children,n),e.memoizedState=null,n)}function AB(t,e,n,i){var g=t.mode,s=t.child;return e={mode:"hidden",children:e},(g&2)==0&&s!==null?(s.childLanes=0,s.pendingProps=e):s=kd(e,g,0,null),n=eo(n,g,i,null),s.return=t,n.return=t,s.sibling=n,t.child=s,n}function dB(t,e,n,i){var g=t.child;return t=g.sibling,n=Ig(g,{mode:"visible",children:n}),(e.mode&2)==0&&(n.lanes=i),n.return=e,n.sibling=null,t!==null&&(t.nextEffect=null,t.flags=8,e.firstEffect=e.lastEffect=t),e.child=n}function uB(t,e,n,i,g){var s=e.mode,o=t.child;t=o.sibling;var r={mode:"hidden",children:n};return(s&2)==0&&e.child!==o?(n=e.child,n.childLanes=0,n.pendingProps=r,o=n.lastEffect,o!==null?(e.firstEffect=n.firstEffect,e.lastEffect=o,o.nextEffect=null):e.firstEffect=e.lastEffect=null):n=Ig(o,r),t!==null?i=Ig(t,i):(i=eo(i,s,g,null),i.flags|=2),i.return=e,n.return=e,n.sibling=i,e.child=n,i}function hB(t,e){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),Ep(t.return,e)}function yd(t,e,n,i,g,s){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:g,lastEffect:s}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=g,o.lastEffect=s)}function mB(t,e,n){var i=e.pendingProps,g=i.revealOrder,s=i.tail;if($t(t,e,i.children,n),i=nt.current,(i&2)!=0)i=i&1|2,e.flags|=64;else{if(t!==null&&(t.flags&64)!=0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&hB(t,n);else if(t.tag===19)hB(t,n);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(tt(nt,i),(e.mode&2)==0)e.memoizedState=null;else switch(g){case"forwards":for(n=e.child,g=null;n!==null;)t=n.alternate,t!==null&&nl(t)===null&&(g=n),n=n.sibling;n=g,n===null?(g=e.child,e.child=null):(g=n.sibling,n.sibling=null),yd(e,!1,g,n,s,e.lastEffect);break;case"backwards":for(n=null,g=e.child,e.child=null;g!==null;){if(t=g.alternate,t!==null&&nl(t)===null){e.child=g;break}t=g.sibling,g.sibling=n,n=g,g=t}yd(e,!0,n,null,s,e.lastEffect);break;case"together":yd(e,!1,null,null,void 0,e.lastEffect);break;default:e.memoizedState=null}return e.child}function Bi(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Xr|=e.lanes,(n&e.childLanes)!=0){if(t!==null&&e.child!==t.child)throw Error(M(153));if(e.child!==null){for(t=e.child,n=Ig(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ig(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}return null}var fB,vd,pB,BB;fB=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};vd=function(){};pB=function(t,e,n,i){var g=t.memoizedProps;if(g!==i){t=e.stateNode,Pg(On.current);var s=null;switch(n){case"input":g=rA(t,g),i=rA(t,i),s=[];break;case"option":g=lA(t,g),i=lA(t,i),s=[];break;case"select":g=ze({},g,{value:void 0}),i=ze({},i,{value:void 0}),s=[];break;case"textarea":g=CA(t,g),i=CA(t,i),s=[];break;default:typeof g.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=_a)}dA(n,i);var o;n=null;for(a in g)if(!i.hasOwnProperty(a)&&g.hasOwnProperty(a)&&g[a]!=null)if(a==="style"){var r=g[a];for(o in r)r.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else a!=="dangerouslySetInnerHTML"&&a!=="children"&&a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(qo.hasOwnProperty(a)?s||(s=[]):(s=s||[]).push(a,null));for(a in i){var I=i[a];if(r=g!=null?g[a]:void 0,i.hasOwnProperty(a)&&I!==r&&(I!=null||r!=null))if(a==="style")if(r){for(o in r)!r.hasOwnProperty(o)||I&&I.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in I)I.hasOwnProperty(o)&&r[o]!==I[o]&&(n||(n={}),n[o]=I[o])}else n||(s||(s=[]),s.push(a,n)),n=I;else a==="dangerouslySetInnerHTML"?(I=I?I.__html:void 0,r=r?r.__html:void 0,I!=null&&r!==I&&(s=s||[]).push(a,I)):a==="children"?typeof I!="string"&&typeof I!="number"||(s=s||[]).push(a,""+I):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&(qo.hasOwnProperty(a)?(I!=null&&a==="onScroll"&&ke("scroll",t),s||r===I||(s=[])):typeof I=="object"&&I!==null&&I.$$typeof===nA?I.toString():(s=s||[]).push(a,I))}n&&(s=s||[]).push("style",n);var a=s;(e.updateQueue=a)&&(e.flags|=4)}};BB=function(t,e,n,i){n!==i&&(e.flags|=4)};function Qr(t,e){if(!jn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function PS(t,e,n){var i=e.pendingProps;switch(e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return jt(e.type)&&La(),null;case 3:return Js(),Ke(Ot),Ke(xt),cd(),i=e.stateNode,i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(il(e)?e.flags|=4:i.hydrate||(e.flags|=256)),vd(e),null;case 5:ad(e);var g=Pg(Ur.current);if(n=e.type,t!==null&&e.stateNode!=null)pB(t,e,n,i,g),t.ref!==e.ref&&(e.flags|=128);else{if(!i){if(e.stateNode===null)throw Error(M(166));return null}if(t=Pg(On.current),il(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Oi]=e,i[ka]=s,n){case"dialog":ke("cancel",i),ke("close",i);break;case"iframe":case"object":case"embed":ke("load",i);break;case"video":case"audio":for(t=0;t<yr.length;t++)ke(yr[t],i);break;case"source":ke("error",i);break;case"img":case"image":case"link":ke("error",i),ke("load",i);break;case"details":ke("toggle",i);break;case"input":lf(i,s),ke("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},ke("invalid",i);break;case"textarea":Af(i,s),ke("invalid",i)}dA(n,s),t=null;for(var o in s)s.hasOwnProperty(o)&&(g=s[o],o==="children"?typeof g=="string"?i.textContent!==g&&(t=["children",g]):typeof g=="number"&&i.textContent!==""+g&&(t=["children",""+g]):qo.hasOwnProperty(o)&&g!=null&&o==="onScroll"&&ke("scroll",i));switch(n){case"input":va(i),cf(i,s,!0);break;case"textarea":va(i),uf(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=_a)}i=t,e.updateQueue=i,i!==null&&(e.flags|=4)}else{switch(o=g.nodeType===9?g:g.ownerDocument,t===cA.html&&(t=hf(n)),t===cA.html?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Oi]=e,t[ka]=i,fB(t,e,!1,!1),e.stateNode=t,o=uA(n,i),n){case"dialog":ke("cancel",t),ke("close",t),g=i;break;case"iframe":case"object":case"embed":ke("load",t),g=i;break;case"video":case"audio":for(g=0;g<yr.length;g++)ke(yr[g],t);g=i;break;case"source":ke("error",t),g=i;break;case"img":case"image":case"link":ke("error",t),ke("load",t),g=i;break;case"details":ke("toggle",t),g=i;break;case"input":lf(t,i),g=rA(t,i),ke("invalid",t);break;case"option":g=lA(t,i);break;case"select":t._wrapperState={wasMultiple:!!i.multiple},g=ze({},i,{value:void 0}),ke("invalid",t);break;case"textarea":Af(t,i),g=CA(t,i),ke("invalid",t);break;default:g=i}dA(n,g);var r=g;for(s in r)if(r.hasOwnProperty(s)){var I=r[s];s==="style"?pf(t,I):s==="dangerouslySetInnerHTML"?(I=I?I.__html:void 0,I!=null&&mf(t,I)):s==="children"?typeof I=="string"?(n!=="textarea"||I!=="")&&gr(t,I):typeof I=="number"&&gr(t,""+I):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(qo.hasOwnProperty(s)?I!=null&&s==="onScroll"&&ke("scroll",t):I!=null&&Oc(t,s,I,o))}switch(n){case"input":va(t),cf(t,i,!1);break;case"textarea":va(t),uf(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Li(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?Vs(t,!!i.multiple,s,!1):i.defaultValue!=null&&Vs(t,!!i.multiple,i.defaultValue,!0);break;default:typeof g.onClick=="function"&&(t.onclick=_a)}Bp(n,i)&&(e.flags|=4)}e.ref!==null&&(e.flags|=128)}return null;case 6:if(t&&e.stateNode!=null)BB(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(M(166));n=Pg(Ur.current),Pg(On.current),il(e)?(i=e.stateNode,n=e.memoizedProps,i[Oi]=e,i.nodeValue!==n&&(e.flags|=4)):(i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Oi]=e,e.stateNode=i)}return null;case 13:return Ke(nt),i=e.memoizedState,(e.flags&64)!=0?(e.lanes=n,e):(i=i!==null,n=!1,t===null?e.memoizedProps.fallback!==void 0&&il(e):n=t.memoizedState!==null,i&&!n&&(e.mode&2)!=0&&(t===null&&e.memoizedProps.unstable_avoidThisFallback!==!0||(nt.current&1)!=0?Gt===0&&(Gt=3):((Gt===0||Gt===3)&&(Gt=4),Kt===null||(Xr&134217727)==0&&(Os&134217727)==0||qs(Kt,wt))),(i||n)&&(e.flags|=4),null);case 4:return Js(),vd(e),t===null&&up(e.stateNode.containerInfo),null;case 10:return sd(e),null;case 17:return jt(e.type)&&La(),null;case 19:if(Ke(nt),i=e.memoizedState,i===null)return null;if(s=(e.flags&64)!=0,o=i.rendering,o===null)if(s)Qr(i,!1);else{if(Gt!==0||t!==null&&(t.flags&64)!=0)for(t=e.child;t!==null;){if(o=nl(t),o!==null){for(e.flags|=64,Qr(i,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),i.lastEffect===null&&(e.firstEffect=null),e.lastEffect=i.lastEffect,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return tt(nt,nt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Wt()>wd&&(e.flags|=64,s=!0,Qr(i,!1),e.lanes=33554432)}else{if(!s)if(t=nl(o),t!==null){if(e.flags|=64,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Qr(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!jn)return e=e.lastEffect=i.lastEffect,e!==null&&(e.nextEffect=null),null}else 2*Wt()-i.renderingStartTime>wd&&n!==1073741824&&(e.flags|=64,s=!0,Qr(i,!1),e.lanes=33554432);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(n=i.tail,i.rendering=n,i.tail=n.sibling,i.lastEffect=e.lastEffect,i.renderingStartTime=Wt(),n.sibling=null,e=nt.current,tt(nt,s?e&1|2:e&1),n):null;case 23:case 24:return _d(),t!==null&&t.memoizedState!==null!=(e.memoizedState!==null)&&i.mode!=="unstable-defer-without-hiding"&&(e.flags|=4),null}throw Error(M(156,e.tag))}function JS(t){switch(t.tag){case 1:jt(t.type)&&La();var e=t.flags;return e&4096?(t.flags=e&-4097|64,t):null;case 3:if(Js(),Ke(Ot),Ke(xt),cd(),e=t.flags,(e&64)!=0)throw Error(M(285));return t.flags=e&-4097|64,t;case 5:return ad(t),null;case 13:return Ke(nt),e=t.flags,e&4096?(t.flags=e&-4097|64,t):null;case 19:return Ke(nt),null;case 4:return Js(),null;case 10:return sd(t),null;case 23:case 24:return _d(),null;default:return null}}function Gd(t,e){try{var n="",i=e;do n+=FF(i),i=i.return;while(i);var g=n}catch(s){g=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:g}}function Zd(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var DS=typeof WeakMap=="function"?WeakMap:Map;function bB(t,e,n){n=eg(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){cl||(cl=!0,Td=i),Zd(t,e)},n}function yB(t,e,n){n=eg(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var g=e.value;n.payload=function(){return Zd(t,e),i(g)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){typeof i!="function"&&($n===null?$n=new Set([this]):$n.add(this),Zd(t,e));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}var zS=typeof WeakSet=="function"?WeakSet:Set;function vB(t){var e=t.ref;if(e!==null)if(typeof e=="function")try{e(null)}catch(n){rg(t,n)}else e.current=null}function OS(t,e){switch(e.tag){case 0:case 11:case 15:case 22:return;case 1:if(e.flags&256&&t!==null){var n=t.memoizedProps,i=t.memoizedState;t=e.stateNode,e=t.getSnapshotBeforeUpdate(e.elementType===e.type?n:Tn(e.type,n),i),t.__reactInternalSnapshotBeforeUpdate=e}return;case 3:e.flags&256&&zA(e.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(M(163))}function jS(t,e,n){switch(n.tag){case 0:case 11:case 15:case 22:if(e=n.updateQueue,e=e!==null?e.lastEffect:null,e!==null){t=e=e.next;do{if((t.tag&3)==3){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}if(e=n.updateQueue,e=e!==null?e.lastEffect:null,e!==null){t=e=e.next;do{var g=t;i=g.next,g=g.tag,(g&4)!=0&&(g&1)!=0&&(XB(n,t),sV(n,t)),t=i}while(t!==e)}return;case 1:t=n.stateNode,n.flags&4&&(e===null?t.componentDidMount():(i=n.elementType===n.type?e.memoizedProps:Tn(n.type,e.memoizedProps),t.componentDidUpdate(i,e.memoizedState,t.__reactInternalSnapshotBeforeUpdate))),e=n.updateQueue,e!==null&&Yp(n,e,t);return;case 3:if(e=n.updateQueue,e!==null){if(t=null,n.child!==null)switch(n.child.tag){case 5:t=n.child.stateNode;break;case 1:t=n.child.stateNode}Yp(n,e,t)}return;case 5:t=n.stateNode,e===null&&n.flags&4&&Bp(n.type,n.memoizedProps)&&t.focus();return;case 6:return;case 4:return;case 12:return;case 13:n.memoizedState===null&&(n=n.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&Tf(n))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(M(163))}function GB(t,e){for(var n=t;;){if(n.tag===5){var i=n.stateNode;if(e)i=i.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none";else{i=n.stateNode;var g=n.memoizedProps.style;g=g!=null&&g.hasOwnProperty("display")?g.display:null,i.style.display=ff("display",g)}}else if(n.tag===6)n.stateNode.nodeValue=e?"":n.memoizedProps;else if((n.tag!==23&&n.tag!==24||n.memoizedState===null||n===t)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function ZB(t,e){if(Lg&&typeof Lg.onCommitFiberUnmount=="function")try{Lg.onCommitFiberUnmount(qA,e)}catch{}switch(e.tag){case 0:case 11:case 14:case 15:case 22:if(t=e.updateQueue,t!==null&&(t=t.lastEffect,t!==null)){var n=t=t.next;do{var i=n,g=i.destroy;if(i=i.tag,g!==void 0)if((i&4)!=0)XB(e,n);else{i=e;try{g()}catch(s){rg(i,s)}}n=n.next}while(n!==t)}break;case 1:if(vB(e),t=e.stateNode,typeof t.componentWillUnmount=="function")try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(s){rg(e,s)}break;case 5:vB(e);break;case 4:VB(t,e)}}function RB(t){t.alternate=null,t.child=null,t.dependencies=null,t.firstEffect=null,t.lastEffect=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.return=null,t.updateQueue=null}function FB(t){return t.tag===5||t.tag===3||t.tag===4}function SB(t){e:{for(var e=t.return;e!==null;){if(FB(e))break e;e=e.return}throw Error(M(160))}var n=e;switch(e=n.stateNode,n.tag){case 5:var i=!1;break;case 3:e=e.containerInfo,i=!0;break;case 4:e=e.containerInfo,i=!0;break;default:throw Error(M(161))}n.flags&16&&(gr(e,""),n.flags&=-17);e:t:for(n=t;;){for(;n.sibling===null;){if(n.return===null||FB(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue t;n.child.return=n,n=n.child}if(!(n.flags&2)){n=n.stateNode;break e}}i?Rd(t,n,e):Fd(t,n,e)}function Rd(t,e,n){var i=t.tag,g=i===5||i===6;if(g)t=g?t.stateNode:t.stateNode.instance,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=_a));else if(i!==4&&(t=t.child,t!==null))for(Rd(t,e,n),t=t.sibling;t!==null;)Rd(t,e,n),t=t.sibling}function Fd(t,e,n){var i=t.tag,g=i===5||i===6;if(g)t=g?t.stateNode:t.stateNode.instance,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Fd(t,e,n),t=t.sibling;t!==null;)Fd(t,e,n),t=t.sibling}function VB(t,e){for(var n=e,i=!1,g,s;;){if(!i){i=n.return;e:for(;;){if(i===null)throw Error(M(160));switch(g=i.stateNode,i.tag){case 5:s=!1;break e;case 3:g=g.containerInfo,s=!0;break e;case 4:g=g.containerInfo,s=!0;break e}i=i.return}i=!0}if(n.tag===5||n.tag===6){e:for(var o=t,r=n,I=r;;)if(ZB(o,I),I.child!==null&&I.tag!==4)I.child.return=I,I=I.child;else{if(I===r)break e;for(;I.sibling===null;){if(I.return===null||I.return===r)break e;I=I.return}I.sibling.return=I.return,I=I.sibling}s?(o=g,r=n.stateNode,o.nodeType===8?o.parentNode.removeChild(r):o.removeChild(r)):g.removeChild(n.stateNode)}else if(n.tag===4){if(n.child!==null){g=n.stateNode.containerInfo,s=!0,n.child.return=n,n=n.child;continue}}else if(ZB(t,n),n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return,n.tag===4&&(i=!1)}n.sibling.return=n.return,n=n.sibling}}function Sd(t,e){switch(e.tag){case 0:case 11:case 14:case 15:case 22:var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do(i.tag&3)==3&&(t=i.destroy,i.destroy=void 0,t!==void 0&&t()),i=i.next;while(i!==n)}return;case 1:return;case 5:if(n=e.stateNode,n!=null){i=e.memoizedProps;var g=t!==null?t.memoizedProps:i;t=e.type;var s=e.updateQueue;if(e.updateQueue=null,s!==null){for(n[ka]=i,t==="input"&&i.type==="radio"&&i.name!=null&&Cf(n,i),uA(t,g),e=uA(t,i),g=0;g<s.length;g+=2){var o=s[g],r=s[g+1];o==="style"?pf(n,r):o==="dangerouslySetInnerHTML"?mf(n,r):o==="children"?gr(n,r):Oc(n,o,r,e)}switch(t){case"input":IA(n,i);break;case"textarea":df(n,i);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!i.multiple,s=i.value,s!=null?Vs(n,!!i.multiple,s,!1):t!==!!i.multiple&&(i.defaultValue!=null?Vs(n,!!i.multiple,i.defaultValue,!0):Vs(n,!!i.multiple,i.multiple?[]:"",!1))}}}return;case 6:if(e.stateNode===null)throw Error(M(162));e.stateNode.nodeValue=e.memoizedProps;return;case 3:n=e.stateNode,n.hydrate&&(n.hydrate=!1,Tf(n.containerInfo));return;case 12:return;case 13:e.memoizedState!==null&&(Nd=Wt(),GB(e.child,!0)),UB(e);return;case 19:UB(e);return;case 17:return;case 23:case 24:GB(e,e.memoizedState!==null);return}throw Error(M(163))}function UB(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new zS),e.forEach(function(i){var g=IV.bind(null,t,i);n.has(i)||(n.add(i),i.then(g,g))})}}function qS(t,e){return t!==null&&(t=t.memoizedState,t===null||t.dehydrated!==null)?(e=e.memoizedState,e!==null&&e.dehydrated===null):!1}var $S=Math.ceil,ll=Xg.ReactCurrentDispatcher,Vd=Xg.ReactCurrentOwner,de=0,Kt=null,lt=null,wt=0,zg=0,Ud=ji(0),Gt=0,Cl=null,zs=0,Xr=0,Os=0,xd=0,Wd=null,Nd=0,wd=1/0;function js(){wd=Wt()+500}var ie=null,cl=!1,Td=null,$n=null,ig=!1,Yr=null,_r=90,Ed=[],Qd=[],bi=null,Hr=0,Xd=null,Al=-1,yi=0,dl=0,kr=null,ul=!1;function tn(){return(de&48)!=0?Wt():Al!==-1?Al:Al=Wt()}function gg(t){if(t=t.mode,(t&2)==0)return 1;if((t&4)==0)return Ls()===99?1:2;if(yi===0&&(yi=zs),_S.transition!==0){dl!==0&&(dl=Wd!==null?Wd.pendingLanes:0),t=yi;var e=4186112&~dl;return e&=-e,e===0&&(t=4186112&~t,e=t&-t,e===0&&(e=8192)),e}return t=Ls(),(de&4)!=0&&t===98?t=xa(12,yi):(t=KF(t),t=xa(t,yi)),t}function sg(t,e,n){if(50<Hr)throw Hr=0,Xd=null,Error(M(185));if(t=hl(t,e),t===null)return null;Wa(t,e,n),t===Kt&&(Os|=e,Gt===4&&qs(t,wt));var i=Ls();e===1?(de&8)!=0&&(de&48)==0?Yd(t):(yn(t,n),de===0&&(js(),zn())):((de&4)==0||i!==98&&i!==99||(bi===null?bi=new Set([t]):bi.add(t)),yn(t,n)),Wd=t}function hl(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}function yn(t,e){for(var n=t.callbackNode,i=t.suspendedLanes,g=t.pingedLanes,s=t.expirationTimes,o=t.pendingLanes;0<o;){var r=31-Di(o),I=1<<r,a=s[r];if(a===-1){if((I&i)==0||(I&g)!=0){a=e,Ns(I);var l=Ye;s[r]=10<=l?a+250:6<=l?a+5e3:-1}}else a<=e&&(t.expiredLanes|=I);o&=~I}if(i=dr(t,t===Kt?wt:0),e=Ye,i===0)n!==null&&(n!==nd&&ed(n),t.callbackNode=null,t.callbackPriority=0);else{if(n!==null){if(t.callbackPriority===e)return;n!==nd&&ed(n)}e===15?(n=Yd.bind(null,t),fi===null?(fi=[n],Ja=$A(Pa,Tp)):fi.push(n),n=nd):e===14?n=Zr(99,Yd.bind(null,t)):(n=LF(e),n=Zr(n,xB.bind(null,t))),t.callbackPriority=e,t.callbackNode=n}}function xB(t){if(Al=-1,dl=yi=0,(de&48)!=0)throw Error(M(327));var e=t.callbackNode;if(og()&&t.callbackNode!==e)return null;var n=dr(t,t===Kt?wt:0);if(n===0)return null;var i=n,g=de;de|=16;var s=TB();(Kt!==t||wt!==i)&&(js(),$s(t,i));do try{nV();break}catch(r){wB(t,r)}while(1);if(gd(),ll.current=s,de=g,lt!==null?i=0:(Kt=null,wt=0,i=Gt),(zs&Os)!=0)$s(t,0);else if(i!==0){if(i===2&&(de|=64,t.hydrate&&(t.hydrate=!1,zA(t.containerInfo)),n=kf(t),n!==0&&(i=Kr(t,n))),i===1)throw e=Cl,$s(t,0),qs(t,n),yn(t,Wt()),e;switch(t.finishedWork=t.current.alternate,t.finishedLanes=n,i){case 0:case 1:throw Error(M(345));case 2:Og(t);break;case 3:if(qs(t,n),(n&62914560)===n&&(i=Nd+500-Wt(),10<i)){if(dr(t,0)!==0)break;if(g=t.suspendedLanes,(g&n)!==n){tn(),t.pingedLanes|=t.suspendedLanes&g;break}t.timeoutHandle=bp(Og.bind(null,t),i);break}Og(t);break;case 4:if(qs(t,n),(n&4186112)===n)break;for(i=t.eventTimes,g=-1;0<n;){var o=31-Di(n);s=1<<o,o=i[o],o>g&&(g=o),n&=~s}if(n=g,n=Wt()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*$S(n/1960))-n,10<n){t.timeoutHandle=bp(Og.bind(null,t),n);break}Og(t);break;case 5:Og(t);break;default:throw Error(M(329))}}return yn(t,Wt()),t.callbackNode===e?xB.bind(null,t):null}function qs(t,e){for(e&=~xd,e&=~Os,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Di(e),i=1<<n;t[n]=-1,e&=~i}}function Yd(t){if((de&48)!=0)throw Error(M(327));if(og(),t===Kt&&(t.expiredLanes&wt)!=0){var e=wt,n=Kr(t,e);(zs&Os)!=0&&(e=dr(t,e),n=Kr(t,e))}else e=dr(t,0),n=Kr(t,e);if(t.tag!==0&&n===2&&(de|=64,t.hydrate&&(t.hydrate=!1,zA(t.containerInfo)),e=kf(t),e!==0&&(n=Kr(t,e))),n===1)throw n=Cl,$s(t,0),qs(t,e),yn(t,Wt()),n;return t.finishedWork=t.current.alternate,t.finishedLanes=e,Og(t),yn(t,Wt()),null}function eV(){if(bi!==null){var t=bi;bi=null,t.forEach(function(e){e.expiredLanes|=24&e.pendingLanes,yn(e,Wt())})}zn()}function WB(t,e){var n=de;de|=1;try{return t(e)}finally{de=n,de===0&&(js(),zn())}}function NB(t,e){var n=de;de&=-2,de|=8;try{return t(e)}finally{de=n,de===0&&(js(),zn())}}function ml(t,e){tt(Ud,zg),zg|=e,zs|=e}function _d(){zg=Ud.current,Ke(Ud)}function $s(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,wS(n)),lt!==null)for(n=lt.return;n!==null;){var i=n;switch(i.tag){case 1:i=i.type.childContextTypes,i!=null&&La();break;case 3:Js(),Ke(Ot),Ke(xt),cd();break;case 5:ad(i);break;case 4:Js();break;case 13:Ke(nt);break;case 19:Ke(nt);break;case 10:sd(i);break;case 23:case 24:_d()}n=n.return}Kt=t,lt=Ig(t.current,null),wt=zg=zs=e,Gt=0,Cl=null,xd=Os=Xr=0}function wB(t,e){do{var n=lt;try{if(gd(),xr.current=Il,gl){for(var i=ot.memoizedState;i!==null;){var g=i.queue;g!==null&&(g.pending=null),i=i.next}gl=!1}if(Wr=0,vt=Nt=ot=null,Nr=!1,Vd.current=null,n===null||n.return===null){Gt=1,Cl=e,lt=null;break}e:{var s=t,o=n.return,r=n,I=e;if(e=wt,r.flags|=2048,r.firstEffect=r.lastEffect=null,I!==null&&typeof I=="object"&&typeof I.then=="function"){var a=I;if((r.mode&2)==0){var l=r.alternate;l?(r.updateQueue=l.updateQueue,r.memoizedState=l.memoizedState,r.lanes=l.lanes):(r.updateQueue=null,r.memoizedState=null)}var C=(nt.current&1)!=0,c=o;do{var A;if(A=c.tag===13){var d=c.memoizedState;if(d!==null)A=d.dehydrated!==null;else{var m=c.memoizedProps;A=m.fallback===void 0?!1:m.unstable_avoidThisFallback!==!0?!0:!C}}if(A){var u=c.updateQueue;if(u===null){var h=new Set;h.add(a),c.updateQueue=h}else u.add(a);if((c.mode&2)==0){if(c.flags|=64,r.flags|=16384,r.flags&=-2981,r.tag===1)if(r.alternate===null)r.tag=17;else{var f=eg(-1,1);f.tag=2,tg(r,f)}r.lanes|=1;break e}I=void 0,r=e;var p=s.pingCache;if(p===null?(p=s.pingCache=new DS,I=new Set,p.set(a,I)):(I=p.get(a),I===void 0&&(I=new Set,p.set(a,I))),!I.has(r)){I.add(r);var b=rV.bind(null,s,a,r);a.then(b,b)}c.flags|=4096,c.lanes=e;break e}c=c.return}while(c!==null);I=Error((Ss(r.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}Gt!==5&&(Gt=2),I=Gd(I,r),c=o;do{switch(c.tag){case 3:s=I,c.flags|=4096,e&=-e,c.lanes|=e;var Z=bB(c,s,e);Xp(c,Z);break e;case 1:s=I;var v=c.type,N=c.stateNode;if((c.flags&64)==0&&(typeof v.getDerivedStateFromError=="function"||N!==null&&typeof N.componentDidCatch=="function"&&($n===null||!$n.has(N)))){c.flags|=4096,e&=-e,c.lanes|=e;var x=yB(c,s,e);Xp(c,x);break e}}c=c.return}while(c!==null)}QB(n)}catch(V){e=V,lt===n&&n!==null&&(lt=n=n.return);continue}break}while(1)}function TB(){var t=ll.current;return ll.current=Il,t===null?Il:t}function Kr(t,e){var n=de;de|=16;var i=TB();Kt===t&&wt===e||$s(t,e);do try{tV();break}catch(g){wB(t,g)}while(1);if(gd(),de=n,ll.current=i,lt!==null)throw Error(M(261));return Kt=null,wt=0,Gt}function tV(){for(;lt!==null;)EB(lt)}function nV(){for(;lt!==null&&!QS();)EB(lt)}function EB(t){var e=_B(t.alternate,t,zg);t.memoizedProps=t.pendingProps,e===null?QB(t):lt=e,Vd.current=null}function QB(t){var e=t;do{var n=e.alternate;if(t=e.return,(e.flags&2048)==0){if(n=PS(n,e,zg),n!==null){lt=n;return}if(n=e,n.tag!==24&&n.tag!==23||n.memoizedState===null||(zg&1073741824)!=0||(n.mode&4)==0){for(var i=0,g=n.child;g!==null;)i|=g.lanes|g.childLanes,g=g.sibling;n.childLanes=i}t!==null&&(t.flags&2048)==0&&(t.firstEffect===null&&(t.firstEffect=e.firstEffect),e.lastEffect!==null&&(t.lastEffect!==null&&(t.lastEffect.nextEffect=e.firstEffect),t.lastEffect=e.lastEffect),1<e.flags&&(t.lastEffect!==null?t.lastEffect.nextEffect=e:t.firstEffect=e,t.lastEffect=e))}else{if(n=JS(e),n!==null){n.flags&=2047,lt=n;return}t!==null&&(t.firstEffect=t.lastEffect=null,t.flags|=2048)}if(e=e.sibling,e!==null){lt=e;return}lt=e=t}while(e!==null);Gt===0&&(Gt=5)}function Og(t){var e=Ls();return Mg(99,iV.bind(null,t,e)),null}function iV(t,e){do og();while(Yr!==null);if((de&48)!=0)throw Error(M(327));var n=t.finishedWork;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(M(177));t.callbackNode=null;var i=n.lanes|n.childLanes,g=i,s=t.pendingLanes&~g;t.pendingLanes=g,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=g,t.mutableReadLanes&=g,t.entangledLanes&=g,g=t.entanglements;for(var o=t.eventTimes,r=t.expirationTimes;0<s;){var I=31-Di(s),a=1<<I;g[I]=0,o[I]=-1,r[I]=-1,s&=~a}if(bi!==null&&(i&24)==0&&bi.has(t)&&bi.delete(t),t===Kt&&(lt=Kt=null,wt=0),1<n.flags?n.lastEffect!==null?(n.lastEffect.nextEffect=n,i=n.firstEffect):i=n:i=n.firstEffect,i!==null){if(g=de,de|=32,Vd.current=null,PA=Na,o=Ip(),kA(o)){if("selectionStart"in o)r={start:o.selectionStart,end:o.selectionEnd};else e:if(r=(r=o.ownerDocument)&&r.defaultView||window,(a=r.getSelection&&r.getSelection())&&a.rangeCount!==0){r=a.anchorNode,s=a.anchorOffset,I=a.focusNode,a=a.focusOffset;try{r.nodeType,I.nodeType}catch{r=null;break e}var l=0,C=-1,c=-1,A=0,d=0,m=o,u=null;t:for(;;){for(var h;m!==r||s!==0&&m.nodeType!==3||(C=l+s),m!==I||a!==0&&m.nodeType!==3||(c=l+a),m.nodeType===3&&(l+=m.nodeValue.length),(h=m.firstChild)!==null;)u=m,m=h;for(;;){if(m===o)break t;if(u===r&&++A===s&&(C=l),u===I&&++d===a&&(c=l),(h=m.nextSibling)!==null)break;m=u,u=m.parentNode}m=h}r=C===-1||c===-1?null:{start:C,end:c}}else r=null;r=r||{start:0,end:0}}else r=null;JA={focusedElem:o,selectionRange:r},Na=!1,kr=null,ul=!1,ie=i;do try{gV()}catch(V){if(ie===null)throw Error(M(330));rg(ie,V),ie=ie.nextEffect}while(ie!==null);kr=null,ie=i;do try{for(o=t;ie!==null;){var f=ie.flags;if(f&16&&gr(ie.stateNode,""),f&128){var p=ie.alternate;if(p!==null){var b=p.ref;b!==null&&(typeof b=="function"?b(null):b.current=null)}}switch(f&1038){case 2:SB(ie),ie.flags&=-3;break;case 6:SB(ie),ie.flags&=-3,Sd(ie.alternate,ie);break;case 1024:ie.flags&=-1025;break;case 1028:ie.flags&=-1025,Sd(ie.alternate,ie);break;case 4:Sd(ie.alternate,ie);break;case 8:r=ie,VB(o,r);var Z=r.alternate;RB(r),Z!==null&&RB(Z)}ie=ie.nextEffect}}catch(V){if(ie===null)throw Error(M(330));rg(ie,V),ie=ie.nextEffect}while(ie!==null);if(b=JA,p=Ip(),f=b.focusedElem,o=b.selectionRange,p!==f&&f&&f.ownerDocument&&rp(f.ownerDocument.documentElement,f)){for(o!==null&&kA(f)&&(p=o.start,b=o.end,b===void 0&&(b=p),"selectionStart"in f?(f.selectionStart=p,f.selectionEnd=Math.min(b,f.value.length)):(b=(p=f.ownerDocument||document)&&p.defaultView||window,b.getSelection&&(b=b.getSelection(),r=f.textContent.length,Z=Math.min(o.start,r),o=o.end===void 0?Z:Math.min(o.end,r),!b.extend&&Z>o&&(r=o,o=Z,Z=r),r=op(f,Z),s=op(f,o),r&&s&&(b.rangeCount!==1||b.anchorNode!==r.node||b.anchorOffset!==r.offset||b.focusNode!==s.node||b.focusOffset!==s.offset)&&(p=p.createRange(),p.setStart(r.node,r.offset),b.removeAllRanges(),Z>o?(b.addRange(p),b.extend(s.node,s.offset)):(p.setEnd(s.node,s.offset),b.addRange(p)))))),p=[],b=f;b=b.parentNode;)b.nodeType===1&&p.push({element:b,left:b.scrollLeft,top:b.scrollTop});for(typeof f.focus=="function"&&f.focus(),f=0;f<p.length;f++)b=p[f],b.element.scrollLeft=b.left,b.element.scrollTop=b.top}Na=!!PA,JA=PA=null,t.current=n,ie=i;do try{for(f=t;ie!==null;){var v=ie.flags;if(v&36&&jS(f,ie.alternate,ie),v&128){p=void 0;var N=ie.ref;if(N!==null){var x=ie.stateNode;switch(ie.tag){case 5:p=x;break;default:p=x}typeof N=="function"?N(p):N.current=p}}ie=ie.nextEffect}}catch(V){if(ie===null)throw Error(M(330));rg(ie,V),ie=ie.nextEffect}while(ie!==null);ie=null,YS(),de=g}else t.current=n;if(ig)ig=!1,Yr=t,_r=e;else for(ie=i;ie!==null;)e=ie.nextEffect,ie.nextEffect=null,ie.flags&8&&(v=ie,v.sibling=null,v.stateNode=null),ie=e;if(i=t.pendingLanes,i===0&&($n=null),i===1?t===Xd?Hr++:(Hr=0,Xd=t):Hr=0,n=n.stateNode,Lg&&typeof Lg.onCommitFiberRoot=="function")try{Lg.onCommitFiberRoot(qA,n,void 0,(n.current.flags&64)==64)}catch{}if(yn(t,Wt()),cl)throw cl=!1,t=Td,Td=null,t;return(de&8)!=0||zn(),null}function gV(){for(;ie!==null;){var t=ie.alternate;ul||kr===null||((ie.flags&8)!=0?Sf(ie,kr)&&(ul=!0):ie.tag===13&&qS(t,ie)&&Sf(ie,kr)&&(ul=!0));var e=ie.flags;(e&256)!=0&&OS(t,ie),(e&512)==0||ig||(ig=!0,Zr(97,function(){return og(),null})),ie=ie.nextEffect}}function og(){if(_r!==90){var t=97<_r?97:_r;return _r=90,Mg(t,oV)}return!1}function sV(t,e){Ed.push(e,t),ig||(ig=!0,Zr(97,function(){return og(),null}))}function XB(t,e){Qd.push(e,t),ig||(ig=!0,Zr(97,function(){return og(),null}))}function oV(){if(Yr===null)return!1;var t=Yr;if(Yr=null,(de&48)!=0)throw Error(M(331));var e=de;de|=32;var n=Qd;Qd=[];for(var i=0;i<n.length;i+=2){var g=n[i],s=n[i+1],o=g.destroy;if(g.destroy=void 0,typeof o=="function")try{o()}catch(I){if(s===null)throw Error(M(330));rg(s,I)}}for(n=Ed,Ed=[],i=0;i<n.length;i+=2){g=n[i],s=n[i+1];try{var r=g.create;g.destroy=r()}catch(I){if(s===null)throw Error(M(330));rg(s,I)}}for(r=t.current.firstEffect;r!==null;)t=r.nextEffect,r.nextEffect=null,r.flags&8&&(r.sibling=null,r.stateNode=null),r=t;return de=e,zn(),!0}function YB(t,e,n){e=Gd(n,e),e=bB(t,e,1),tg(t,e),e=tn(),t=hl(t,1),t!==null&&(Wa(t,1,e),yn(t,e))}function rg(t,e){if(t.tag===3)YB(t,t,e);else for(var n=t.return;n!==null;){if(n.tag===3){YB(n,t,e);break}else if(n.tag===1){var i=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&($n===null||!$n.has(i))){t=Gd(e,t);var g=yB(n,t,1);if(tg(n,g),g=tn(),n=hl(n,1),n!==null)Wa(n,1,g),yn(n,g);else if(typeof i.componentDidCatch=="function"&&($n===null||!$n.has(i)))try{i.componentDidCatch(e,t)}catch{}break}}n=n.return}}function rV(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=tn(),t.pingedLanes|=t.suspendedLanes&n,Kt===t&&(wt&n)===n&&(Gt===4||Gt===3&&(wt&62914560)===wt&&500>Wt()-Nd?$s(t,0):xd|=n),yn(t,e)}function IV(t,e){var n=t.stateNode;n!==null&&n.delete(e),e=0,e===0&&(e=t.mode,(e&2)==0?e=1:(e&4)==0?e=Ls()===99?1:2:(yi===0&&(yi=zs),e=ws(62914560&~yi),e===0&&(e=4194304))),n=tn(),t=hl(t,e),t!==null&&(Wa(t,e,n),yn(t,n))}var _B;_B=function(t,e,n){var i=e.lanes;if(t!==null)if(t.memoizedProps!==e.pendingProps||Ot.current)En=!0;else if((n&i)!=0)En=(t.flags&16384)!=0;else{switch(En=!1,e.tag){case 3:CB(e),Cd();break;case 5:Pp(e);break;case 1:jt(e.type)&&Ma(e);break;case 4:Id(e,e.stateNode.containerInfo);break;case 10:i=e.memoizedProps.value;var g=e.type._context;tt(Da,g._currentValue),g._currentValue=i;break;case 13:if(e.memoizedState!==null)return(n&e.child.childLanes)!=0?cB(t,e,n):(tt(nt,nt.current&1),e=Bi(t,e,n),e!==null?e.sibling:null);tt(nt,nt.current&1);break;case 19:if(i=(n&e.childLanes)!=0,(t.flags&64)!=0){if(i)return mB(t,e,n);e.flags|=64}if(g=e.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),tt(nt,nt.current),i)break;return null;case 23:case 24:return e.lanes=0,pd(t,e,n)}return Bi(t,e,n)}else En=!1;switch(e.lanes=0,e.tag){case 2:if(i=e.type,t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,g=Ks(e,xt.current),Ps(e,n),g=dd(null,e,i,t,g,n),e.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0){if(e.tag=1,e.memoizedState=null,e.updateQueue=null,jt(i)){var s=!0;Ma(e)}else s=!1;e.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,od(e);var o=i.getDerivedStateFromProps;typeof o=="function"&&ja(e,i,o,t),g.updater=qa,e.stateNode=g,g._reactInternals=e,rd(e,i,t,n),e=bd(null,e,i,!0,s,n)}else e.tag=0,$t(null,e,g,n),e=e.child;return e;case 16:g=e.elementType;e:{switch(t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),t=e.pendingProps,s=g._init,g=s(g._payload),e.type=g,s=e.tag=lV(g),t=Tn(g,t),s){case 0:e=Bd(null,e,g,t,n);break e;case 1:e=lB(null,e,g,t,n);break e;case 11:e=oB(null,e,g,t,n);break e;case 14:e=rB(null,e,g,Tn(g.type,t),i,n);break e}throw Error(M(306,g,""))}return e;case 0:return i=e.type,g=e.pendingProps,g=e.elementType===i?g:Tn(i,g),Bd(t,e,i,g,n);case 1:return i=e.type,g=e.pendingProps,g=e.elementType===i?g:Tn(i,g),lB(t,e,i,g,n);case 3:if(CB(e),i=e.updateQueue,t===null||i===null)throw Error(M(282));if(i=e.pendingProps,g=e.memoizedState,g=g!==null?g.element:null,Qp(t,e),Rr(e,i,null,n),i=e.memoizedState.element,i===g)Cd(),e=Bi(t,e,n);else{if(g=e.stateNode,(s=g.hydrate)&&(ng=Ys(e.stateNode.containerInfo.firstChild),pi=e,s=jn=!0),s){if(t=g.mutableSourceEagerHydrationData,t!=null)for(g=0;g<t.length;g+=2)s=t[g],s._workInProgressVersionPrimary=t[g+1],Ds.push(s);for(n=Mp(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|1024,n=n.sibling}else $t(t,e,i,n),Cd();e=e.child}return e;case 5:return Pp(e),t===null&&ld(e),i=e.type,g=e.pendingProps,s=t!==null?t.memoizedProps:null,o=g.children,DA(i,g)?o=null:s!==null&&DA(i,s)&&(e.flags|=16),aB(t,e),$t(t,e,o,n),e.child;case 6:return t===null&&ld(e),null;case 13:return cB(t,e,n);case 4:return Id(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=tl(e,null,i,n):$t(t,e,i,n),e.child;case 11:return i=e.type,g=e.pendingProps,g=e.elementType===i?g:Tn(i,g),oB(t,e,i,g,n);case 7:return $t(t,e,e.pendingProps,n),e.child;case 8:return $t(t,e,e.pendingProps.children,n),e.child;case 12:return $t(t,e,e.pendingProps.children,n),e.child;case 10:e:{i=e.type._context,g=e.pendingProps,o=e.memoizedProps,s=g.value;var r=e.type._context;if(tt(Da,r._currentValue),r._currentValue=s,o!==null)if(r=o.value,s=pn(r,s)?0:(typeof i._calculateChangedBits=="function"?i._calculateChangedBits(r,s):1073741823)|0,s===0){if(o.children===g.children&&!Ot.current){e=Bi(t,e,n);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var I=r.dependencies;if(I!==null){o=r.child;for(var a=I.firstContext;a!==null;){if(a.context===i&&(a.observedBits&s)!=0){r.tag===1&&(a=eg(-1,n&-n),a.tag=2,tg(r,a)),r.lanes|=n,a=r.alternate,a!==null&&(a.lanes|=n),Ep(r.return,n),I.lanes|=n;break}a=a.next}}else o=r.tag===10&&r.type===e.type?null:r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===e){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}$t(t,e,g.children,n),e=e.child}return e;case 9:return g=e.type,s=e.pendingProps,i=s.children,Ps(e,n),g=Bn(g,s.unstable_observedBits),i=i(g),e.flags|=1,$t(t,e,i,n),e.child;case 14:return g=e.type,s=Tn(g,e.pendingProps),s=Tn(g.type,s),rB(t,e,g,s,i,n);case 15:return IB(t,e,e.type,e.pendingProps,i,n);case 17:return i=e.type,g=e.pendingProps,g=e.elementType===i?g:Tn(i,g),t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2),e.tag=1,jt(i)?(t=!0,Ma(e)):t=!1,Ps(e,n),kp(e,i,g),rd(e,i,g,n),bd(null,e,i,!0,t,n);case 19:return mB(t,e,n);case 23:return pd(t,e,n);case 24:return pd(t,e,n)}throw Error(M(156,e.tag))};function aV(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function vn(t,e,n,i){return new aV(t,e,n,i)}function Hd(t){return t=t.prototype,!(!t||!t.isReactComponent)}function lV(t){if(typeof t=="function")return Hd(t)?1:0;if(t!=null){if(t=t.$$typeof,t===pa)return 11;if(t===ba)return 14}return 2}function Ig(t,e){var n=t.alternate;return n===null?(n=vn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function fl(t,e,n,i,g,s){var o=2;if(i=t,typeof t=="function")Hd(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Ki:return eo(n.children,g,s,e);case of:o=8,g|=16;break;case jc:o=8,g|=1;break;case er:return t=vn(12,n,e,g|8),t.elementType=er,t.type=er,t.lanes=s,t;case tr:return t=vn(13,n,e,g),t.type=tr,t.elementType=tr,t.lanes=s,t;case Ba:return t=vn(19,n,e,g),t.elementType=Ba,t.lanes=s,t;case iA:return kd(n,g,s,e);case gA:return t=vn(24,n,e,g),t.elementType=gA,t.lanes=s,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case qc:o=10;break e;case $c:o=9;break e;case pa:o=11;break e;case ba:o=14;break e;case eA:o=16,i=null;break e;case tA:o=22;break e}throw Error(M(130,t==null?t:typeof t,""))}return e=vn(o,n,e,g),e.elementType=t,e.type=i,e.lanes=s,e}function eo(t,e,n,i){return t=vn(7,t,i,e),t.lanes=n,t}function kd(t,e,n,i){return t=vn(23,t,i,e),t.elementType=iA,t.lanes=n,t}function Kd(t,e,n){return t=vn(6,t,null,e),t.lanes=n,t}function Ld(t,e,n){return e=vn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function CV(t,e,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=UA(0),this.expirationTimes=UA(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=UA(0),this.mutableSourceEagerHydrationData=null}function cV(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Yg,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function pl(t,e,n,i){var g=e.current,s=tn(),o=gg(g);e:if(n){n=n._reactInternals;t:{if(Hg(n)!==n||n.tag!==1)throw Error(M(170));var r=n;do{switch(r.tag){case 3:r=r.stateNode.context;break t;case 1:if(jt(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break t}}r=r.return}while(r!==null);throw Error(M(171))}if(n.tag===1){var I=n.type;if(jt(I)){n=Rp(n,I,r);break e}}n=r}else n=qi;return e.context===null?e.context=n:e.pendingContext=n,e=eg(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),tg(g,e),sg(g,o,s),o}function Md(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function HB(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Pd(t,e){HB(t,e),(t=t.alternate)&&HB(t,e)}function AV(){return null}function Jd(t,e,n){var i=n!=null&&n.hydrationOptions!=null&&n.hydrationOptions.mutableSources||null;if(n=new CV(t,e,n!=null&&n.hydrate===!0),e=vn(3,null,null,e===2?7:e===1?3:0),n.current=e,e.stateNode=n,od(e),t[_s]=n.current,up(t.nodeType===8?t.parentNode:t),i)for(t=0;t<i.length;t++){e=i[t];var g=e._getVersion;g=g(e._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[e,g]:n.mutableSourceEagerHydrationData.push(e,g)}this._internalRoot=n}Jd.prototype.render=function(t){pl(t,this._internalRoot,null,null)};Jd.prototype.unmount=function(){var t=this._internalRoot,e=t.containerInfo;pl(null,t,null,function(){e[_s]=null})};function Lr(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function dV(t,e){if(e||(e=t?t.nodeType===9?t.documentElement:t.firstChild:null,e=!(!e||e.nodeType!==1||!e.hasAttribute("data-reactroot"))),!e)for(var n;n=t.lastChild;)t.removeChild(n);return new Jd(t,0,e?{hydrate:!0}:void 0)}function Bl(t,e,n,i,g){var s=n._reactRootContainer;if(s){var o=s._internalRoot;if(typeof g=="function"){var r=g;g=function(){var a=Md(o);r.call(a)}}pl(e,o,t,g)}else{if(s=n._reactRootContainer=dV(n,i),o=s._internalRoot,typeof g=="function"){var I=g;g=function(){var a=Md(o);I.call(a)}}NB(function(){pl(e,o,t,g)})}return Md(o)}Vf=function(t){if(t.tag===13){var e=tn();sg(t,4,e),Pd(t,4)}};GA=function(t){if(t.tag===13){var e=tn();sg(t,67108864,e),Pd(t,67108864)}};Uf=function(t){if(t.tag===13){var e=tn(),n=gg(t);sg(t,n,e),Pd(t,n)}};xf=function(t,e){return e()};mA=function(t,e,n){switch(e){case"input":if(IA(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var g=Ka(i);if(!g)throw Error(M(90));af(i),IA(i,g)}}}break;case"textarea":df(t,n);break;case"select":e=n.value,e!=null&&Vs(t,!!n.multiple,e,!1)}};fA=WB;vf=function(t,e,n,i,g){var s=de;de|=4;try{return Mg(98,t.bind(null,e,n,i,g))}finally{de=s,de===0&&(js(),zn())}};pA=function(){(de&49)==0&&(eV(),og())};Gf=function(t,e){var n=de;de|=2;try{return t(e)}finally{de=n,de===0&&(js(),zn())}};function kB(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Lr(e))throw Error(M(200));return cV(t,e,null,n)}var uV={Events:[Gr,Hs,Ka,bf,yf,og,{current:!1}]},Mr={findFiberByHostInstance:kg,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},hV={bundleType:Mr.bundleType,version:Mr.version,rendererPackageName:Mr.rendererPackageName,rendererConfig:Mr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Xg.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Ff(t),t===null?null:t.stateNode},findFiberByHostInstance:Mr.findFiberByHostInstance||AV,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var bl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bl.isDisabled&&bl.supportsFiber)try{qA=bl.inject(hV),Lg=bl}catch{}}fn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uV;fn.createPortal=kB;fn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(M(188)):Error(M(268,Object.keys(t)));return t=Ff(e),t=t===null?null:t.stateNode,t};fn.flushSync=function(t,e){var n=de;if((n&48)!=0)return t(e);de|=1;try{if(t)return Mg(99,t.bind(null,e))}finally{de=n,zn()}};fn.hydrate=function(t,e,n){if(!Lr(e))throw Error(M(200));return Bl(null,t,e,!0,n)};fn.render=function(t,e,n){if(!Lr(e))throw Error(M(200));return Bl(null,t,e,!1,n)};fn.unmountComponentAtNode=function(t){if(!Lr(t))throw Error(M(40));return t._reactRootContainer?(NB(function(){Bl(null,null,t,!1,function(){t._reactRootContainer=null,t[_s]=null})}),!0):!1};fn.unstable_batchedUpdates=WB;fn.unstable_createPortal=function(t,e){return kB(t,e,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};fn.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!Lr(n))throw Error(M(200));if(t==null||t._reactInternals===void 0)throw Error(M(38));return Bl(t,e,n,!1,i)};fn.version="17.0.2";function KB(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(KB)}catch(t){console.error(t)}}KB(),hi.exports=fn;var Dd=hi.exports;const to=Symbol(),LB=t=>!!t[to],mV=t=>!t[to].c,yl=t=>{var e,n;(n=(e=t[to]).c)==null||n.call(e)},vl=(t,e)=>{const n=t[to].o,i=e[to].o;return n===i||t===i||LB(n)&&vl(n,e)},MB=t=>{const e={o:t,c:null},n=new Promise(i=>{e.c=()=>{e.c=null,i()},t.then(e.c,e.c)});return n[to]=e,n};var fV=Object.defineProperty,pV=Object.defineProperties,BV=Object.getOwnPropertyDescriptors,PB=Object.getOwnPropertySymbols,bV=Object.prototype.hasOwnProperty,yV=Object.prototype.propertyIsEnumerable,JB=(t,e,n)=>e in t?fV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,vV=(t,e)=>{for(var n in e||(e={}))bV.call(e,n)&&JB(t,n,e[n]);if(PB)for(var n of PB(e))yV.call(e,n)&&JB(t,n,e[n]);return t},GV=(t,e)=>pV(t,BV(e));const zd=t=>"init"in t,DB="r",zB="w",Od="c",OB="s",ZV="h";const RV=t=>{const e=new WeakMap,n=new WeakMap,i=new Map;let g,s;if(t)for(const[U,F]of t){const W={v:F,r:0,d:new Map};e.set(U,W)}const o=new WeakMap,r=(U,F,W)=>{let T=o.get(F);T||(T=new Map,o.set(F,T)),W.then(()=>{T.get(U)===W&&(T.delete(U),T.size||o.delete(F))}),T.set(U,W)},I=U=>{const F=new Set,W=o.get(U);return W&&(o.delete(U),W.forEach((T,Y)=>{yl(T),F.add(Y)})),F},a=new WeakMap,l=U=>{let F=a.get(U);return F||(F=new Map,a.set(U,F)),F},C=(U,F)=>{if(U){const W=l(U);let T=W.get(F);return T||(T=C(U.p,F),T&&("p"in T&&T.p.then(()=>W.delete(F)),W.set(F,T))),T}return e.get(F)},c=(U,F,W)=>{if(U)l(U).set(F,W);else{const T=e.get(F);e.set(F,W),i.has(F)||i.set(F,T)}},A=(U,F=new Map,W)=>{if(!W)return F;const T=new Map;let Y=!1;return W.forEach(Q=>{var H;const P=((H=C(U,Q))==null?void 0:H.r)||0;T.set(Q,P),F.get(Q)!==P&&(Y=!0)}),F.size===T.size&&!Y?F:T},d=(U,F,W,T,Y)=>{const Q=C(U,F);if(Q){if(Y&&(!("p"in Q)||!vl(Q.p,Y)))return Q;"p"in Q&&yl(Q.p)}const H={v:W,r:(Q==null?void 0:Q.r)||0,d:A(U,Q==null?void 0:Q.d,T)};return!Q||!("v"in Q)||!Object.is(Q.v,W)?(++H.r,H.d.has(F)&&(H.d=new Map(H.d).set(F,H.r))):H.d!==Q.d&&(H.d.size!==Q.d.size||!Array.from(H.d.keys()).every(P=>Q.d.has(P)))&&Promise.resolve().then(()=>{ee(U)}),c(U,F,H),H},m=(U,F,W,T,Y)=>{const Q=C(U,F);if(Q){if(Y&&(!("p"in Q)||!vl(Q.p,Y)))return Q;"p"in Q&&yl(Q.p)}const H={e:W,r:(Q==null?void 0:Q.r)||0,d:A(U,Q==null?void 0:Q.d,T)};return c(U,F,H),H},u=(U,F,W,T)=>{const Y=C(U,F);if(Y&&"p"in Y){if(vl(Y.p,W))return Y;yl(Y.p)}r(U,F,W);const Q={p:W,r:(Y==null?void 0:Y.r)||0,d:A(U,Y==null?void 0:Y.d,T)};return c(U,F,Q),Q},h=(U,F,W,T)=>{if(W instanceof Promise){const Y=MB(W.then(Q=>{d(U,F,Q,T,Y),ee(U)}).catch(Q=>{if(Q instanceof Promise)return LB(Q)?Q.then(()=>{p(U,F,!0)}):Q;m(U,F,Q,T,Y),ee(U)}));return u(U,F,Y,T)}return d(U,F,W,T)},f=(U,F)=>{const W=C(U,F);if(W){const T=GV(vV({},W),{i:W.r});c(U,F,T)}},p=(U,F,W)=>{if(!W){const Y=C(U,F);if(Y&&(Y.r!==Y.i&&"p"in Y&&!mV(Y.p)||(Y.d.forEach((Q,H)=>{if(H!==F)if(!n.has(H))p(U,H);else{const P=C(U,H);P&&P.r===P.i&&p(U,H)}}),Array.from(Y.d).every(([Q,H])=>{const P=C(U,Q);return P&&"v"in P&&P.r===H}))))return Y}const T=new Set;try{const Y=F.read(Q=>{T.add(Q);const H=Q===F?C(U,Q):p(U,Q);if(H){if("e"in H)throw H.e;if("p"in H)throw H.p;return H.v}if(zd(Q))return Q.init;throw new Error("no atom init")});return h(U,F,Y,T)}catch(Y){if(Y instanceof Promise){const Q=MB(Y);return u(U,F,Q,T)}return m(U,F,Y,T)}},b=(U,F)=>p(F,U),Z=U=>{let F=n.get(U);return F||(F=_(U)),F},v=(U,F)=>!F.l.size&&(!F.t.size||F.t.size===1&&F.t.has(U)),N=U=>{const F=n.get(U);F&&v(U,F)&&k(U)},x=(U,F)=>{const W=n.get(F);W==null||W.t.forEach(T=>{T!==F&&(f(U,T),x(U,T))})},V=(U,F,W)=>{let T=!0;const Y=(P,oe)=>{typeof oe=="boolean"&&(console.warn("[DEPRECATED] Please use { unstable_promise: true }"),oe={unstable_promise:oe});const ne=p(U,P);if("e"in ne)throw ne.e;if("p"in ne){if(oe==null?void 0:oe.unstable_promise)return ne.p.then(()=>Y(P,oe));throw ne.p}if("v"in ne)return ne.v;throw new Error("no value found")},Q=(P,oe)=>{let ne;if(P===F){if(!zd(P))throw new Error("atom not writable");I(P).forEach(ae=>{ae!==U&&h(ae,P,oe)}),h(U,P,oe),x(U,P)}else ne=V(U,P,oe);return T||ee(U),ne},H=F.write(Y,Q,W);return T=!1,U=void 0,H},E=(U,F,W)=>{const T=V(W,U,F);return ee(W),T},D=U=>!!U.write,_=(U,F)=>{const W={t:new Set(F&&[F]),l:new Set};if(n.set(U,W),p(void 0,U).d.forEach((Y,Q)=>{const H=n.get(Q);H?H.t.add(U):Q!==U&&_(Q,U)}),D(U)&&U.onMount){const Y=H=>E(U,H),Q=U.onMount(Y);Q&&(W.u=Q)}return W},k=U=>{var F;const W=(F=n.get(U))==null?void 0:F.u;W&&W(),n.delete(U);const T=C(void 0,U);T&&T.d.forEach((Y,Q)=>{if(Q!==U){const H=n.get(Q);H&&(H.t.delete(U),v(Q,H)&&k(Q))}})},z=(U,F,W)=>{const T=new Set(F.d.keys());W==null||W.forEach((Y,Q)=>{if(T.has(Q)){T.delete(Q);return}const H=n.get(Q);H&&(H.t.delete(U),v(Q,H)&&k(Q))}),T.forEach(Y=>{const Q=n.get(Y);Q?Q.t.add(U):n.has(U)&&_(Y,U)})},ee=U=>{if(U){l(U).forEach((W,T)=>{if(W!==e.get(T)){const Y=n.get(T);Y==null||Y.l.forEach(Q=>Q(U))}});return}for(;i.size;){const F=Array.from(i);i.clear(),F.forEach(([W,T])=>{const Y=C(void 0,W);Y&&Y.d!==(T==null?void 0:T.d)&&z(W,Y,T==null?void 0:T.d);const Q=n.get(W);Q==null||Q.l.forEach(H=>H())})}},Ie=U=>{l(U).forEach((W,T)=>{const Y=e.get(T);(W.r>((Y==null?void 0:Y.r)||0)||"v"in W&&W.r===(Y==null?void 0:Y.r)&&W.d!==(Y==null?void 0:Y.d))&&(e.set(T,W),W.d!==(Y==null?void 0:Y.d)&&z(T,W,Y==null?void 0:Y.d))})},he=(U,F)=>{F&&Ie(F),ee(void 0)},ge=(U,F)=>{const T=Z(U).l;return T.add(F),()=>{T.delete(F),N(U)}},Ae=(U,F)=>{for(const[W,T]of U)zd(W)&&(h(F,W,T),x(F,W));ee(F)};return{[DB]:b,[zB]:E,[Od]:he,[OB]:ge,[ZV]:Ae}},jB=t=>({s:RV(t)}),jd=new Map,qd=t=>(jd.has(t)||jd.set(t,G.exports.createContext(jB())),jd.get(t));const ED=({children:t,initialValues:e,scope:n,unstable_enableVersionedWrite:i})=>{const[g,s]=G.exports.useState();G.exports.useEffect(()=>{g&&(o.current.s[Od](null,g),delete g.p)},[g]);const o=G.exports.useRef();o.current||(o.current=jB(e),i&&(o.current.w=I=>{s(a=>{const l=a?{p:a}:{};return I(l),l})}));const r=qd(n);return G.exports.createElement(r.Provider,{value:o.current},t)};let FV=0;function jg(t,e){const n=`atom${++FV}`,i={toString:()=>n};return typeof t=="function"?i.read=t:(i.init=t,i.read=g=>g(i),i.write=(g,s,o)=>s(i,typeof o=="function"?o(g(i)):o)),e&&(i.write=e),i}const SV=t=>!!t.write;function VV(t,e){"scope"in t&&(console.warn("atom.scope is deprecated. Please do useAtom(atom, scope) instead."),e=t.scope);const n=qd(e),{s:i,w:g}=G.exports.useContext(n),s=G.exports.useCallback(C=>{const c=i[DB](t,C);if("e"in c)throw c.e;if("p"in c)throw c.p;if("v"in c)return c.v;throw new Error("no atom value")},[i,t]),[[o,r,I],a]=G.exports.useReducer(G.exports.useCallback((C,c)=>{const A=s(c);return Object.is(C[1],A)&&C[2]===t?C:[c,A,t]},[s,t]),void 0,()=>{const C=void 0,c=s(C);return[C,c,t]});I!==t&&a(void 0),G.exports.useEffect(()=>{const C=i[OB](t,a);return a(void 0),C},[i,t]),G.exports.useEffect(()=>{i[Od](t,o)});const l=G.exports.useCallback(C=>{if(SV(t)){const c=A=>i[zB](t,C,A);return g?g(c):c()}else throw new Error("not writable atom")},[i,g,t]);return G.exports.useDebugValue(r),[r,l]}function L(){return L=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},L.apply(this,arguments)}function $d(t){return $d=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$d(t)}function eu(t){return t&&$d(t)==="object"&&t.constructor===Object}function no(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{clone:!0},i=n.clone?L({},t):t;return eu(t)&&eu(e)&&Object.keys(e).forEach(function(g){g!=="__proto__"&&(eu(e[g])&&g in t?i[g]=no(t[g],e[g],n):i[g]=e[g])}),i}var qB={exports:{}},UV="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",xV=UV,WV=xV;function $B(){}function eb(){}eb.resetWarningCache=$B;var NV=function(){function t(i,g,s,o,r,I){if(I!==WV){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:eb,resetWarningCache:$B};return n.PropTypes=n,n};qB.exports=NV();var wV=qB.exports;function te(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Pr(t){for(var e="https://material-ui.com/production-error/?code="+t,n=1;n<arguments.length;n+=1)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified Material-UI error #"+t+"; visit "+e+" for the full message."}var _e={};/** @license React v17.0.2
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gl=60103,Zl=60106,Jr=60107,Dr=60108,zr=60114,Or=60109,jr=60110,qr=60112,$r=60113,tu=60120,eI=60115,tI=60116,tb=60121,nb=60122,ib=60117,gb=60129,sb=60131;if(typeof Symbol=="function"&&Symbol.for){var Zt=Symbol.for;Gl=Zt("react.element"),Zl=Zt("react.portal"),Jr=Zt("react.fragment"),Dr=Zt("react.strict_mode"),zr=Zt("react.profiler"),Or=Zt("react.provider"),jr=Zt("react.context"),qr=Zt("react.forward_ref"),$r=Zt("react.suspense"),tu=Zt("react.suspense_list"),eI=Zt("react.memo"),tI=Zt("react.lazy"),tb=Zt("react.block"),nb=Zt("react.server.block"),ib=Zt("react.fundamental"),gb=Zt("react.debug_trace_mode"),sb=Zt("react.legacy_hidden")}function Qn(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case Gl:switch(t=t.type,t){case Jr:case zr:case Dr:case $r:case tu:return t;default:switch(t=t&&t.$$typeof,t){case jr:case qr:case tI:case eI:case Or:return t;default:return e}}case Zl:return e}}}var TV=Or,EV=Gl,QV=qr,XV=Jr,YV=tI,_V=eI,HV=Zl,kV=zr,KV=Dr,LV=$r;_e.ContextConsumer=jr;_e.ContextProvider=TV;_e.Element=EV;_e.ForwardRef=QV;_e.Fragment=XV;_e.Lazy=YV;_e.Memo=_V;_e.Portal=HV;_e.Profiler=kV;_e.StrictMode=KV;_e.Suspense=LV;_e.isAsyncMode=function(){return!1};_e.isConcurrentMode=function(){return!1};_e.isContextConsumer=function(t){return Qn(t)===jr};_e.isContextProvider=function(t){return Qn(t)===Or};_e.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===Gl};_e.isForwardRef=function(t){return Qn(t)===qr};_e.isFragment=function(t){return Qn(t)===Jr};_e.isLazy=function(t){return Qn(t)===tI};_e.isMemo=function(t){return Qn(t)===eI};_e.isPortal=function(t){return Qn(t)===Zl};_e.isProfiler=function(t){return Qn(t)===zr};_e.isStrictMode=function(t){return Qn(t)===Dr};_e.isSuspense=function(t){return Qn(t)===$r};_e.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===Jr||t===zr||t===gb||t===Dr||t===$r||t===tu||t===sb||typeof t=="object"&&t!==null&&(t.$$typeof===tI||t.$$typeof===eI||t.$$typeof===Or||t.$$typeof===jr||t.$$typeof===qr||t.$$typeof===ib||t.$$typeof===tb||t[0]===nb)};_e.typeOf=Qn;var MV=typeof Symbol=="function"&&Symbol.for,ob=MV?Symbol.for("mui.nested"):"__THEME_NESTED__",PV=["checked","disabled","error","focused","focusVisible","required","expanded","selected"];function JV(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.disableGlobal,n=e===void 0?!1:e,i=t.productionPrefix,g=i===void 0?"jss":i,s=t.seed,o=s===void 0?"":s,r=o===""?"":"".concat(o,"-"),I=0,a=function(){return I+=1,I};return function(l,C){var c=C.options.name;if(c&&c.indexOf("Mui")===0&&!C.options.link&&!n){if(PV.indexOf(l.key)!==-1)return"Mui-".concat(l.key);var A="".concat(r).concat(c,"-").concat(l.key);return!C.options.theme[ob]||o!==""?A:"".concat(A,"-").concat(a())}return"".concat(r).concat(g).concat(a())}}function rb(t){var e=t.theme,n=t.name,i=t.props;if(!e||!e.props||!e.props[n])return i;var g=e.props[n],s;for(s in g)i[s]===void 0&&(i[s]=g[s]);return i}var Ib=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nI=(typeof window=="undefined"?"undefined":Ib(window))==="object"&&(typeof document=="undefined"?"undefined":Ib(document))==="object"&&document.nodeType===9;function ab(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function nu(t,e,n){return e&&ab(t.prototype,e),n&&ab(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function iu(t,e){return iu=Object.setPrototypeOf||function(i,g){return i.__proto__=g,i},iu(t,e)}function Rl(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,iu(t,e)}function gu(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Fl(t,e){if(t==null)return{};var n={},i=Object.keys(t),g,s;for(s=0;s<i.length;s++)g=i[s],!(e.indexOf(g)>=0)&&(n[g]=t[g]);return n}var DV={}.constructor;function su(t){if(t==null||typeof t!="object")return t;if(Array.isArray(t))return t.map(su);if(t.constructor!==DV)return t;var e={};for(var n in t)e[n]=su(t[n]);return e}function ou(t,e,n){t===void 0&&(t="unnamed");var i=n.jss,g=su(e),s=i.plugins.onCreateRule(t,g,n);return s||(t[0]==="@",null)}var lb=function(e,n){for(var i="",g=0;g<e.length&&e[g]!=="!important";g++)i&&(i+=n),i+=e[g];return i},qg=function(e,n){if(n===void 0&&(n=!1),!Array.isArray(e))return e;var i="";if(Array.isArray(e[0]))for(var g=0;g<e.length&&e[g]!=="!important";g++)i&&(i+=", "),i+=lb(e[g]," ");else i=lb(e,", ");return!n&&e[e.length-1]==="!important"&&(i+=" !important"),i};function io(t){return t&&t.format===!1?{linebreak:"",space:""}:{linebreak:`
`,space:" "}}function iI(t,e){for(var n="",i=0;i<e;i++)n+="  ";return n+t}function gI(t,e,n){n===void 0&&(n={});var i="";if(!e)return i;var g=n,s=g.indent,o=s===void 0?0:s,r=e.fallbacks;n.format===!1&&(o=-1/0);var I=io(n),a=I.linebreak,l=I.space;if(t&&o++,r)if(Array.isArray(r))for(var C=0;C<r.length;C++){var c=r[C];for(var A in c){var d=c[A];d!=null&&(i&&(i+=a),i+=iI(A+":"+l+qg(d)+";",o))}}else for(var m in r){var u=r[m];u!=null&&(i&&(i+=a),i+=iI(m+":"+l+qg(u)+";",o))}for(var h in e){var f=e[h];f!=null&&h!=="fallbacks"&&(i&&(i+=a),i+=iI(h+":"+l+qg(f)+";",o))}return!i&&!n.allowEmpty||!t?i:(o--,i&&(i=""+a+i+a),iI(""+t+l+"{"+i,o)+iI("}",o))}var zV=/([[\].#*$><+~=|^:(),"'`\s])/g,Cb=typeof CSS!="undefined"&&CSS.escape,ru=function(t){return Cb?Cb(t):t.replace(zV,"\\$1")},cb=function(){function t(n,i,g){this.type="style",this.isProcessed=!1;var s=g.sheet,o=g.Renderer;this.key=n,this.options=g,this.style=i,s?this.renderer=s.renderer:o&&(this.renderer=new o)}var e=t.prototype;return e.prop=function(i,g,s){if(g===void 0)return this.style[i];var o=s?s.force:!1;if(!o&&this.style[i]===g)return this;var r=g;(!s||s.process!==!1)&&(r=this.options.jss.plugins.onChangeValue(g,i,this));var I=r==null||r===!1,a=i in this.style;if(I&&!a&&!o)return this;var l=I&&a;if(l?delete this.style[i]:this.style[i]=r,this.renderable&&this.renderer)return l?this.renderer.removeProperty(this.renderable,i):this.renderer.setProperty(this.renderable,i,r),this;var C=this.options.sheet;return C&&C.attached,this},t}(),Iu=function(t){Rl(e,t);function e(i,g,s){var o;o=t.call(this,i,g,s)||this;var r=s.selector,I=s.scoped,a=s.sheet,l=s.generateId;return r?o.selectorText=r:I!==!1&&(o.id=l(gu(gu(o)),a),o.selectorText="."+ru(o.id)),o}var n=e.prototype;return n.applyTo=function(g){var s=this.renderer;if(s){var o=this.toJSON();for(var r in o)s.setProperty(g,r,o[r])}return this},n.toJSON=function(){var g={};for(var s in this.style){var o=this.style[s];typeof o!="object"?g[s]=o:Array.isArray(o)&&(g[s]=qg(o))}return g},n.toString=function(g){var s=this.options.sheet,o=s?s.options.link:!1,r=o?L({},g,{allowEmpty:!0}):g;return gI(this.selectorText,this.style,r)},nu(e,[{key:"selector",set:function(g){if(g!==this.selectorText){this.selectorText=g;var s=this.renderer,o=this.renderable;if(!(!o||!s)){var r=s.setSelector(o,g);r||s.replaceRule(o,this)}}},get:function(){return this.selectorText}}]),e}(cb),OV={onCreateRule:function(e,n,i){return e[0]==="@"||i.parent&&i.parent.type==="keyframes"?null:new Iu(e,n,i)}},au={indent:1,children:!0},jV=/@([\w-]+)/,qV=function(){function t(n,i,g){this.type="conditional",this.isProcessed=!1,this.key=n;var s=n.match(jV);this.at=s?s[1]:"unknown",this.query=g.name||"@"+this.at,this.options=g,this.rules=new Sl(L({},g,{parent:this}));for(var o in i)this.rules.add(o,i[o]);this.rules.process()}var e=t.prototype;return e.getRule=function(i){return this.rules.get(i)},e.indexOf=function(i){return this.rules.indexOf(i)},e.addRule=function(i,g,s){var o=this.rules.add(i,g,s);return o?(this.options.jss.plugins.onProcessRule(o),o):null},e.replaceRule=function(i,g,s){var o=this.rules.replace(i,g,s);return o&&this.options.jss.plugins.onProcessRule(o),o},e.toString=function(i){i===void 0&&(i=au);var g=io(i),s=g.linebreak;if(i.indent==null&&(i.indent=au.indent),i.children==null&&(i.children=au.children),i.children===!1)return this.query+" {}";var o=this.rules.toString(i);return o?this.query+" {"+s+o+s+"}":""},t}(),$V=/@media|@supports\s+/,e3={onCreateRule:function(e,n,i){return $V.test(e)?new qV(e,n,i):null}},lu={indent:1,children:!0},t3=/@keyframes\s+([\w-]+)/,Cu=function(){function t(n,i,g){this.type="keyframes",this.at="@keyframes",this.isProcessed=!1;var s=n.match(t3);s&&s[1]?this.name=s[1]:this.name="noname",this.key=this.type+"-"+this.name,this.options=g;var o=g.scoped,r=g.sheet,I=g.generateId;this.id=o===!1?this.name:ru(I(this,r)),this.rules=new Sl(L({},g,{parent:this}));for(var a in i)this.rules.add(a,i[a],L({},g,{parent:this}));this.rules.process()}var e=t.prototype;return e.toString=function(i){i===void 0&&(i=lu);var g=io(i),s=g.linebreak;if(i.indent==null&&(i.indent=lu.indent),i.children==null&&(i.children=lu.children),i.children===!1)return this.at+" "+this.id+" {}";var o=this.rules.toString(i);return o&&(o=""+s+o+s),this.at+" "+this.id+" {"+o+"}"},t}(),n3=/@keyframes\s+/,i3=/\$([\w-]+)/g,cu=function(e,n){return typeof e=="string"?e.replace(i3,function(i,g){return g in n?n[g]:i}):e},Ab=function(e,n,i){var g=e[n],s=cu(g,i);s!==g&&(e[n]=s)},g3={onCreateRule:function(e,n,i){return typeof e=="string"&&n3.test(e)?new Cu(e,n,i):null},onProcessStyle:function(e,n,i){return n.type!=="style"||!i||("animation-name"in e&&Ab(e,"animation-name",i.keyframes),"animation"in e&&Ab(e,"animation",i.keyframes)),e},onChangeValue:function(e,n,i){var g=i.options.sheet;if(!g)return e;switch(n){case"animation":return cu(e,g.keyframes);case"animation-name":return cu(e,g.keyframes);default:return e}}},s3=function(t){Rl(e,t);function e(){return t.apply(this,arguments)||this}var n=e.prototype;return n.toString=function(g){var s=this.options.sheet,o=s?s.options.link:!1,r=o?L({},g,{allowEmpty:!0}):g;return gI(this.key,this.style,r)},e}(cb),o3={onCreateRule:function(e,n,i){return i.parent&&i.parent.type==="keyframes"?new s3(e,n,i):null}},r3=function(){function t(n,i,g){this.type="font-face",this.at="@font-face",this.isProcessed=!1,this.key=n,this.style=i,this.options=g}var e=t.prototype;return e.toString=function(i){var g=io(i),s=g.linebreak;if(Array.isArray(this.style)){for(var o="",r=0;r<this.style.length;r++)o+=gI(this.at,this.style[r]),this.style[r+1]&&(o+=s);return o}return gI(this.at,this.style,i)},t}(),I3=/@font-face/,a3={onCreateRule:function(e,n,i){return I3.test(e)?new r3(e,n,i):null}},l3=function(){function t(n,i,g){this.type="viewport",this.at="@viewport",this.isProcessed=!1,this.key=n,this.style=i,this.options=g}var e=t.prototype;return e.toString=function(i){return gI(this.key,this.style,i)},t}(),C3={onCreateRule:function(e,n,i){return e==="@viewport"||e==="@-ms-viewport"?new l3(e,n,i):null}},c3=function(){function t(n,i,g){this.type="simple",this.isProcessed=!1,this.key=n,this.value=i,this.options=g}var e=t.prototype;return e.toString=function(i){if(Array.isArray(this.value)){for(var g="",s=0;s<this.value.length;s++)g+=this.key+" "+this.value[s]+";",this.value[s+1]&&(g+=`
`);return g}return this.key+" "+this.value+";"},t}(),A3={"@charset":!0,"@import":!0,"@namespace":!0},d3={onCreateRule:function(e,n,i){return e in A3?new c3(e,n,i):null}},db=[OV,e3,g3,o3,a3,C3,d3],u3={process:!0},ub={force:!0,process:!0},Sl=function(){function t(n){this.map={},this.raw={},this.index=[],this.counter=0,this.options=n,this.classes=n.classes,this.keyframes=n.keyframes}var e=t.prototype;return e.add=function(i,g,s){var o=this.options,r=o.parent,I=o.sheet,a=o.jss,l=o.Renderer,C=o.generateId,c=o.scoped,A=L({classes:this.classes,parent:r,sheet:I,jss:a,Renderer:l,generateId:C,scoped:c,name:i,keyframes:this.keyframes,selector:void 0},s),d=i;i in this.raw&&(d=i+"-d"+this.counter++),this.raw[d]=g,d in this.classes&&(A.selector="."+ru(this.classes[d]));var m=ou(d,g,A);if(!m)return null;this.register(m);var u=A.index===void 0?this.index.length:A.index;return this.index.splice(u,0,m),m},e.replace=function(i,g,s){var o=this.get(i),r=this.index.indexOf(o);o&&this.remove(o);var I=s;return r!==-1&&(I=L({},s,{index:r})),this.add(i,g,I)},e.get=function(i){return this.map[i]},e.remove=function(i){this.unregister(i),delete this.raw[i.key],this.index.splice(this.index.indexOf(i),1)},e.indexOf=function(i){return this.index.indexOf(i)},e.process=function(){var i=this.options.jss.plugins;this.index.slice(0).forEach(i.onProcessRule,i)},e.register=function(i){this.map[i.key]=i,i instanceof Iu?(this.map[i.selector]=i,i.id&&(this.classes[i.key]=i.id)):i instanceof Cu&&this.keyframes&&(this.keyframes[i.name]=i.id)},e.unregister=function(i){delete this.map[i.key],i instanceof Iu?(delete this.map[i.selector],delete this.classes[i.key]):i instanceof Cu&&delete this.keyframes[i.name]},e.update=function(){var i,g,s;if(typeof(arguments.length<=0?void 0:arguments[0])=="string"?(i=arguments.length<=0?void 0:arguments[0],g=arguments.length<=1?void 0:arguments[1],s=arguments.length<=2?void 0:arguments[2]):(g=arguments.length<=0?void 0:arguments[0],s=arguments.length<=1?void 0:arguments[1],i=null),i)this.updateOne(this.get(i),g,s);else for(var o=0;o<this.index.length;o++)this.updateOne(this.index[o],g,s)},e.updateOne=function(i,g,s){s===void 0&&(s=u3);var o=this.options,r=o.jss.plugins,I=o.sheet;if(i.rules instanceof t){i.rules.update(g,s);return}var a=i.style;if(r.onUpdate(g,i,I,s),s.process&&a&&a!==i.style){r.onProcessStyle(i.style,i,I);for(var l in i.style){var C=i.style[l],c=a[l];C!==c&&i.prop(l,C,ub)}for(var A in a){var d=i.style[A],m=a[A];d==null&&d!==m&&i.prop(A,null,ub)}}},e.toString=function(i){for(var g="",s=this.options.sheet,o=s?s.options.link:!1,r=io(i),I=r.linebreak,a=0;a<this.index.length;a++){var l=this.index[a],C=l.toString(i);!C&&!o||(g&&(g+=I),g+=C)}return g},t}(),hb=function(){function t(n,i){this.attached=!1,this.deployed=!1,this.classes={},this.keyframes={},this.options=L({},i,{sheet:this,parent:this,classes:this.classes,keyframes:this.keyframes}),i.Renderer&&(this.renderer=new i.Renderer(this)),this.rules=new Sl(this.options);for(var g in n)this.rules.add(g,n[g]);this.rules.process()}var e=t.prototype;return e.attach=function(){return this.attached?this:(this.renderer&&this.renderer.attach(),this.attached=!0,this.deployed||this.deploy(),this)},e.detach=function(){return this.attached?(this.renderer&&this.renderer.detach(),this.attached=!1,this):this},e.addRule=function(i,g,s){var o=this.queue;this.attached&&!o&&(this.queue=[]);var r=this.rules.add(i,g,s);return r?(this.options.jss.plugins.onProcessRule(r),this.attached?(this.deployed&&(o?o.push(r):(this.insertRule(r),this.queue&&(this.queue.forEach(this.insertRule,this),this.queue=void 0))),r):(this.deployed=!1,r)):null},e.replaceRule=function(i,g,s){var o=this.rules.get(i);if(!o)return this.addRule(i,g,s);var r=this.rules.replace(i,g,s);return r&&this.options.jss.plugins.onProcessRule(r),this.attached?(this.deployed&&this.renderer&&(r?o.renderable&&this.renderer.replaceRule(o.renderable,r):this.renderer.deleteRule(o)),r):(this.deployed=!1,r)},e.insertRule=function(i){this.renderer&&this.renderer.insertRule(i)},e.addRules=function(i,g){var s=[];for(var o in i){var r=this.addRule(o,i[o],g);r&&s.push(r)}return s},e.getRule=function(i){return this.rules.get(i)},e.deleteRule=function(i){var g=typeof i=="object"?i:this.rules.get(i);return!g||this.attached&&!g.renderable?!1:(this.rules.remove(g),this.attached&&g.renderable&&this.renderer?this.renderer.deleteRule(g.renderable):!0)},e.indexOf=function(i){return this.rules.indexOf(i)},e.deploy=function(){return this.renderer&&this.renderer.deploy(),this.deployed=!0,this},e.update=function(){var i;return(i=this.rules).update.apply(i,arguments),this},e.updateOne=function(i,g,s){return this.rules.updateOne(i,g,s),this},e.toString=function(i){return this.rules.toString(i)},t}(),h3=function(){function t(){this.plugins={internal:[],external:[]},this.registry={}}var e=t.prototype;return e.onCreateRule=function(i,g,s){for(var o=0;o<this.registry.onCreateRule.length;o++){var r=this.registry.onCreateRule[o](i,g,s);if(r)return r}return null},e.onProcessRule=function(i){if(!i.isProcessed){for(var g=i.options.sheet,s=0;s<this.registry.onProcessRule.length;s++)this.registry.onProcessRule[s](i,g);i.style&&this.onProcessStyle(i.style,i,g),i.isProcessed=!0}},e.onProcessStyle=function(i,g,s){for(var o=0;o<this.registry.onProcessStyle.length;o++)g.style=this.registry.onProcessStyle[o](g.style,g,s)},e.onProcessSheet=function(i){for(var g=0;g<this.registry.onProcessSheet.length;g++)this.registry.onProcessSheet[g](i)},e.onUpdate=function(i,g,s,o){for(var r=0;r<this.registry.onUpdate.length;r++)this.registry.onUpdate[r](i,g,s,o)},e.onChangeValue=function(i,g,s){for(var o=i,r=0;r<this.registry.onChangeValue.length;r++)o=this.registry.onChangeValue[r](o,g,s);return o},e.use=function(i,g){g===void 0&&(g={queue:"external"});var s=this.plugins[g.queue];s.indexOf(i)===-1&&(s.push(i),this.registry=[].concat(this.plugins.external,this.plugins.internal).reduce(function(o,r){for(var I in r)I in o&&o[I].push(r[I]);return o},{onCreateRule:[],onProcessRule:[],onProcessStyle:[],onProcessSheet:[],onChangeValue:[],onUpdate:[]}))},t}(),m3=function(){function t(){this.registry=[]}var e=t.prototype;return e.add=function(i){var g=this.registry,s=i.options.index;if(g.indexOf(i)===-1){if(g.length===0||s>=this.index){g.push(i);return}for(var o=0;o<g.length;o++)if(g[o].options.index>s){g.splice(o,0,i);return}}},e.reset=function(){this.registry=[]},e.remove=function(i){var g=this.registry.indexOf(i);this.registry.splice(g,1)},e.toString=function(i){for(var g=i===void 0?{}:i,s=g.attached,o=Fl(g,["attached"]),r=io(o),I=r.linebreak,a="",l=0;l<this.registry.length;l++){var C=this.registry[l];s!=null&&C.attached!==s||(a&&(a+=I),a+=C.toString(o))}return a},nu(t,[{key:"index",get:function(){return this.registry.length===0?0:this.registry[this.registry.length-1].options.index}}]),t}(),sI=new m3,Au=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"&&window.Math===Math?window:typeof self!="undefined"&&self.Math===Math?self:Function("return this")(),du="2f1acc6c3a606b082e5eef5e54414ffb";Au[du]==null&&(Au[du]=0);var mb=Au[du]++,fb=function(e){e===void 0&&(e={});var n=0,i=function(s,o){n+=1;var r="",I="";return o&&(o.options.classNamePrefix&&(I=o.options.classNamePrefix),o.options.jss.id!=null&&(r=String(o.options.jss.id))),e.minify?""+(I||"c")+mb+r+n:I+s.key+"-"+mb+(r?"-"+r:"")+"-"+n};return i},pb=function(e){var n;return function(){return n||(n=e()),n}},f3=function(e,n){try{return e.attributeStyleMap?e.attributeStyleMap.get(n):e.style.getPropertyValue(n)}catch{return""}},p3=function(e,n,i){try{var g=i;if(Array.isArray(i)&&(g=qg(i,!0),i[i.length-1]==="!important"))return e.style.setProperty(n,g,"important"),!0;e.attributeStyleMap?e.attributeStyleMap.set(n,g):e.style.setProperty(n,g)}catch{return!1}return!0},B3=function(e,n){try{e.attributeStyleMap?e.attributeStyleMap.delete(n):e.style.removeProperty(n)}catch{}},b3=function(e,n){return e.selectorText=n,e.selectorText===n},Bb=pb(function(){return document.querySelector("head")});function y3(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i.attached&&i.options.index>e.index&&i.options.insertionPoint===e.insertionPoint)return i}return null}function v3(t,e){for(var n=t.length-1;n>=0;n--){var i=t[n];if(i.attached&&i.options.insertionPoint===e.insertionPoint)return i}return null}function G3(t){for(var e=Bb(),n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(i.nodeType===8&&i.nodeValue.trim()===t)return i}return null}function Z3(t){var e=sI.registry;if(e.length>0){var n=y3(e,t);if(n&&n.renderer)return{parent:n.renderer.element.parentNode,node:n.renderer.element};if(n=v3(e,t),n&&n.renderer)return{parent:n.renderer.element.parentNode,node:n.renderer.element.nextSibling}}var i=t.insertionPoint;if(i&&typeof i=="string"){var g=G3(i);if(g)return{parent:g.parentNode,node:g.nextSibling}}return!1}function R3(t,e){var n=e.insertionPoint,i=Z3(e);if(i!==!1&&i.parent){i.parent.insertBefore(t,i.node);return}if(n&&typeof n.nodeType=="number"){var g=n,s=g.parentNode;s&&s.insertBefore(t,g.nextSibling);return}Bb().appendChild(t)}var F3=pb(function(){var t=document.querySelector('meta[property="csp-nonce"]');return t?t.getAttribute("content"):null}),bb=function(e,n,i){try{"insertRule"in e?e.insertRule(n,i):"appendRule"in e&&e.appendRule(n)}catch{return!1}return e.cssRules[i]},yb=function(e,n){var i=e.cssRules.length;return n===void 0||n>i?i:n},S3=function(){var e=document.createElement("style");return e.textContent=`
`,e},V3=function(){function t(n){this.getPropertyValue=f3,this.setProperty=p3,this.removeProperty=B3,this.setSelector=b3,this.hasInsertedRules=!1,this.cssRules=[],n&&sI.add(n),this.sheet=n;var i=this.sheet?this.sheet.options:{},g=i.media,s=i.meta,o=i.element;this.element=o||S3(),this.element.setAttribute("data-jss",""),g&&this.element.setAttribute("media",g),s&&this.element.setAttribute("data-meta",s);var r=F3();r&&this.element.setAttribute("nonce",r)}var e=t.prototype;return e.attach=function(){if(!(this.element.parentNode||!this.sheet)){R3(this.element,this.sheet.options);var i=Boolean(this.sheet&&this.sheet.deployed);this.hasInsertedRules&&i&&(this.hasInsertedRules=!1,this.deploy())}},e.detach=function(){if(!!this.sheet){var i=this.element.parentNode;i&&i.removeChild(this.element),this.sheet.options.link&&(this.cssRules=[],this.element.textContent=`
`)}},e.deploy=function(){var i=this.sheet;if(!!i){if(i.options.link){this.insertRules(i.rules);return}this.element.textContent=`
`+i.toString()+`
`}},e.insertRules=function(i,g){for(var s=0;s<i.index.length;s++)this.insertRule(i.index[s],s,g)},e.insertRule=function(i,g,s){if(s===void 0&&(s=this.element.sheet),i.rules){var o=i,r=s;if(i.type==="conditional"||i.type==="keyframes"){var I=yb(s,g);if(r=bb(s,o.toString({children:!1}),I),r===!1)return!1;this.refCssRule(i,I,r)}return this.insertRules(o.rules,r),r}var a=i.toString();if(!a)return!1;var l=yb(s,g),C=bb(s,a,l);return C===!1?!1:(this.hasInsertedRules=!0,this.refCssRule(i,l,C),C)},e.refCssRule=function(i,g,s){i.renderable=s,i.options.parent instanceof hb&&this.cssRules.splice(g,0,s)},e.deleteRule=function(i){var g=this.element.sheet,s=this.indexOf(i);return s===-1?!1:(g.deleteRule(s),this.cssRules.splice(s,1),!0)},e.indexOf=function(i){return this.cssRules.indexOf(i)},e.replaceRule=function(i,g){var s=this.indexOf(i);return s===-1?!1:(this.element.sheet.deleteRule(s),this.cssRules.splice(s,1),this.insertRule(g,s))},e.getRules=function(){return this.element.sheet.cssRules},t}(),U3=0,x3=function(){function t(n){this.id=U3++,this.version="10.9.0",this.plugins=new h3,this.options={id:{minify:!1},createGenerateId:fb,Renderer:nI?V3:null,plugins:[]},this.generateId=fb({minify:!1});for(var i=0;i<db.length;i++)this.plugins.use(db[i],{queue:"internal"});this.setup(n)}var e=t.prototype;return e.setup=function(i){return i===void 0&&(i={}),i.createGenerateId&&(this.options.createGenerateId=i.createGenerateId),i.id&&(this.options.id=L({},this.options.id,i.id)),(i.createGenerateId||i.id)&&(this.generateId=this.options.createGenerateId(this.options.id)),i.insertionPoint!=null&&(this.options.insertionPoint=i.insertionPoint),"Renderer"in i&&(this.options.Renderer=i.Renderer),i.plugins&&this.use.apply(this,i.plugins),this},e.createStyleSheet=function(i,g){g===void 0&&(g={});var s=g,o=s.index;typeof o!="number"&&(o=sI.index===0?0:sI.index+1);var r=new hb(i,L({},g,{jss:this,generateId:g.generateId||this.generateId,insertionPoint:this.options.insertionPoint,Renderer:this.options.Renderer,index:o}));return this.plugins.onProcessSheet(r),r},e.removeStyleSheet=function(i){return i.detach(),sI.remove(i),this},e.createRule=function(i,g,s){if(g===void 0&&(g={}),s===void 0&&(s={}),typeof i=="object")return this.createRule(void 0,i,g);var o=L({},s,{name:i,jss:this,Renderer:this.options.Renderer});o.generateId||(o.generateId=this.generateId),o.classes||(o.classes={}),o.keyframes||(o.keyframes={});var r=ou(i,g,o);return r&&this.plugins.onProcessRule(r),r},e.use=function(){for(var i=this,g=arguments.length,s=new Array(g),o=0;o<g;o++)s[o]=arguments[o];return s.forEach(function(r){i.plugins.use(r)}),this},t}(),vb=function(e){return new x3(e)},uu=typeof CSS=="object"&&CSS!=null&&"number"in CSS;function Gb(t){var e=null;for(var n in t){var i=t[n],g=typeof i;if(g==="function")e||(e={}),e[n]=i;else if(g==="object"&&i!==null&&!Array.isArray(i)){var s=Gb(i);s&&(e||(e={}),e[n]=s)}}return e}/**
 * A better abstraction over CSS.
 *
 * @copyright Oleg Isonen (Slobodskoi) / Isonen 2014-present
 * @website https://github.com/cssinjs/jss
 * @license MIT
 */vb();var Zb=Date.now(),hu="fnValues"+Zb,mu="fnStyle"+ ++Zb,W3=function(){return{onCreateRule:function(n,i,g){if(typeof i!="function")return null;var s=ou(n,{},g);return s[mu]=i,s},onProcessStyle:function(n,i){if(hu in i||mu in i)return n;var g={};for(var s in n){var o=n[s];typeof o=="function"&&(delete n[s],g[s]=o)}return i[hu]=g,n},onUpdate:function(n,i,g,s){var o=i,r=o[mu];r&&(o.style=r(n)||{});var I=o[hu];if(I)for(var a in I)o.prop(a,I[a](n),s)}}},N3=W3,ag="@global",fu="@global ",w3=function(){function t(n,i,g){this.type="global",this.at=ag,this.isProcessed=!1,this.key=n,this.options=g,this.rules=new Sl(L({},g,{parent:this}));for(var s in i)this.rules.add(s,i[s]);this.rules.process()}var e=t.prototype;return e.getRule=function(i){return this.rules.get(i)},e.addRule=function(i,g,s){var o=this.rules.add(i,g,s);return o&&this.options.jss.plugins.onProcessRule(o),o},e.replaceRule=function(i,g,s){var o=this.rules.replace(i,g,s);return o&&this.options.jss.plugins.onProcessRule(o),o},e.indexOf=function(i){return this.rules.indexOf(i)},e.toString=function(i){return this.rules.toString(i)},t}(),T3=function(){function t(n,i,g){this.type="global",this.at=ag,this.isProcessed=!1,this.key=n,this.options=g;var s=n.substr(fu.length);this.rule=g.jss.createRule(s,i,L({},g,{parent:this}))}var e=t.prototype;return e.toString=function(i){return this.rule?this.rule.toString(i):""},t}(),E3=/\s*,\s*/g;function Rb(t,e){for(var n=t.split(E3),i="",g=0;g<n.length;g++)i+=e+" "+n[g].trim(),n[g+1]&&(i+=", ");return i}function Q3(t,e){var n=t.options,i=t.style,g=i?i[ag]:null;if(!!g){for(var s in g)e.addRule(s,g[s],L({},n,{selector:Rb(s,t.selector)}));delete i[ag]}}function X3(t,e){var n=t.options,i=t.style;for(var g in i)if(!(g[0]!=="@"||g.substr(0,ag.length)!==ag)){var s=Rb(g.substr(ag.length),t.selector);e.addRule(s,i[g],L({},n,{selector:s})),delete i[g]}}function Y3(){function t(n,i,g){if(!n)return null;if(n===ag)return new w3(n,i,g);if(n[0]==="@"&&n.substr(0,fu.length)===fu)return new T3(n,i,g);var s=g.parent;return s&&(s.type==="global"||s.options.parent&&s.options.parent.type==="global")&&(g.scoped=!1),!g.selector&&g.scoped===!1&&(g.selector=n),null}function e(n,i){n.type!=="style"||!i||(Q3(n,i),X3(n,i))}return{onCreateRule:t,onProcessRule:e}}var Fb=/\s*,\s*/g,_3=/&/g,H3=/\$([\w-]+)/g;function k3(){function t(g,s){return function(o,r){var I=g.getRule(r)||s&&s.getRule(r);return I?I.selector:r}}function e(g,s){for(var o=s.split(Fb),r=g.split(Fb),I="",a=0;a<o.length;a++)for(var l=o[a],C=0;C<r.length;C++){var c=r[C];I&&(I+=", "),I+=c.indexOf("&")!==-1?c.replace(_3,l):l+" "+c}return I}function n(g,s,o){if(o)return L({},o,{index:o.index+1});var r=g.options.nestingLevel;r=r===void 0?1:r+1;var I=L({},g.options,{nestingLevel:r,index:s.indexOf(g)+1});return delete I.name,I}function i(g,s,o){if(s.type!=="style")return g;var r=s,I=r.options.parent,a,l;for(var C in g){var c=C.indexOf("&")!==-1,A=C[0]==="@";if(!(!c&&!A)){if(a=n(r,I,a),c){var d=e(C,r.selector);l||(l=t(I,o)),d=d.replace(H3,l);var m=r.key+"-"+C;"replaceRule"in I?I.replaceRule(m,g[C],L({},a,{selector:d})):I.addRule(m,g[C],L({},a,{selector:d}))}else A&&I.addRule(C,{},a).addRule(r.key,g[C],{selector:r.selector});delete g[C]}}return g}return{onProcessStyle:i}}var K3=/[A-Z]/g,L3=/^ms-/,pu={};function M3(t){return"-"+t.toLowerCase()}function Sb(t){if(pu.hasOwnProperty(t))return pu[t];var e=t.replace(K3,M3);return pu[t]=L3.test(e)?"-"+e:e}function Vl(t){var e={};for(var n in t){var i=n.indexOf("--")===0?n:Sb(n);e[i]=t[n]}return t.fallbacks&&(Array.isArray(t.fallbacks)?e.fallbacks=t.fallbacks.map(Vl):e.fallbacks=Vl(t.fallbacks)),e}function P3(){function t(n){if(Array.isArray(n)){for(var i=0;i<n.length;i++)n[i]=Vl(n[i]);return n}return Vl(n)}function e(n,i,g){if(i.indexOf("--")===0)return n;var s=Sb(i);return i===s?n:(g.prop(s,n),null)}return{onProcessStyle:t,onChangeValue:e}}var X=uu&&CSS?CSS.px:"px",Ul=uu&&CSS?CSS.ms:"ms",go=uu&&CSS?CSS.percent:"%",J3={"animation-delay":Ul,"animation-duration":Ul,"background-position":X,"background-position-x":X,"background-position-y":X,"background-size":X,border:X,"border-bottom":X,"border-bottom-left-radius":X,"border-bottom-right-radius":X,"border-bottom-width":X,"border-left":X,"border-left-width":X,"border-radius":X,"border-right":X,"border-right-width":X,"border-top":X,"border-top-left-radius":X,"border-top-right-radius":X,"border-top-width":X,"border-width":X,"border-block":X,"border-block-end":X,"border-block-end-width":X,"border-block-start":X,"border-block-start-width":X,"border-block-width":X,"border-inline":X,"border-inline-end":X,"border-inline-end-width":X,"border-inline-start":X,"border-inline-start-width":X,"border-inline-width":X,"border-start-start-radius":X,"border-start-end-radius":X,"border-end-start-radius":X,"border-end-end-radius":X,margin:X,"margin-bottom":X,"margin-left":X,"margin-right":X,"margin-top":X,"margin-block":X,"margin-block-end":X,"margin-block-start":X,"margin-inline":X,"margin-inline-end":X,"margin-inline-start":X,padding:X,"padding-bottom":X,"padding-left":X,"padding-right":X,"padding-top":X,"padding-block":X,"padding-block-end":X,"padding-block-start":X,"padding-inline":X,"padding-inline-end":X,"padding-inline-start":X,"mask-position-x":X,"mask-position-y":X,"mask-size":X,height:X,width:X,"min-height":X,"max-height":X,"min-width":X,"max-width":X,bottom:X,left:X,top:X,right:X,inset:X,"inset-block":X,"inset-block-end":X,"inset-block-start":X,"inset-inline":X,"inset-inline-end":X,"inset-inline-start":X,"box-shadow":X,"text-shadow":X,"column-gap":X,"column-rule":X,"column-rule-width":X,"column-width":X,"font-size":X,"font-size-delta":X,"letter-spacing":X,"text-decoration-thickness":X,"text-indent":X,"text-stroke":X,"text-stroke-width":X,"word-spacing":X,motion:X,"motion-offset":X,outline:X,"outline-offset":X,"outline-width":X,perspective:X,"perspective-origin-x":go,"perspective-origin-y":go,"transform-origin":go,"transform-origin-x":go,"transform-origin-y":go,"transform-origin-z":go,"transition-delay":Ul,"transition-duration":Ul,"vertical-align":X,"flex-basis":X,"shape-margin":X,size:X,gap:X,grid:X,"grid-gap":X,"row-gap":X,"grid-row-gap":X,"grid-column-gap":X,"grid-template-rows":X,"grid-template-columns":X,"grid-auto-rows":X,"grid-auto-columns":X,"box-shadow-x":X,"box-shadow-y":X,"box-shadow-blur":X,"box-shadow-spread":X,"font-line-height":X,"text-shadow-x":X,"text-shadow-y":X,"text-shadow-blur":X};function Vb(t){var e=/(-[a-z])/g,n=function(o){return o[1].toUpperCase()},i={};for(var g in t)i[g]=t[g],i[g.replace(e,n)]=t[g];return i}var D3=Vb(J3);function oI(t,e,n){if(e==null)return e;if(Array.isArray(e))for(var i=0;i<e.length;i++)e[i]=oI(t,e[i],n);else if(typeof e=="object")if(t==="fallbacks")for(var g in e)e[g]=oI(g,e[g],n);else for(var s in e)e[s]=oI(t+"-"+s,e[s],n);else if(typeof e=="number"&&isNaN(e)===!1){var o=n[t]||D3[t];return o&&!(e===0&&o===X)?typeof o=="function"?o(e).toString():""+e+o:e.toString()}return e}function z3(t){t===void 0&&(t={});var e=Vb(t);function n(g,s){if(s.type!=="style")return g;for(var o in g)g[o]=oI(o,g[o],e);return g}function i(g,s){return oI(s,g,e)}return{onProcessStyle:n,onChangeValue:i}}function Bu(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function O3(t){if(Array.isArray(t))return Bu(t)}function Ub(t){if(typeof Symbol!="undefined"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function bu(t,e){if(!!t){if(typeof t=="string")return Bu(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Bu(t,e)}}function j3(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xl(t){return O3(t)||Ub(t)||bu(t)||j3()}var rI="",yu="",xb="",Wb="",q3=nI&&"ontouchstart"in document.documentElement;if(nI){var vu={Moz:"-moz-",ms:"-ms-",O:"-o-",Webkit:"-webkit-"},$3=document.createElement("p"),Gu=$3.style,eU="Transform";for(var Zu in vu)if(Zu+eU in Gu){rI=Zu,yu=vu[Zu];break}rI==="Webkit"&&"msHyphens"in Gu&&(rI="ms",yu=vu.ms,Wb="edge"),rI==="Webkit"&&"-apple-trailing-word"in Gu&&(xb="apple")}var fe={js:rI,css:yu,vendor:xb,browser:Wb,isTouch:q3};function tU(t){return t[1]==="-"||fe.js==="ms"?t:"@"+fe.css+"keyframes"+t.substr(10)}var nU={noPrefill:["appearance"],supportedProperty:function(e){return e!=="appearance"?!1:fe.js==="ms"?"-webkit-"+e:fe.css+e}},iU={noPrefill:["color-adjust"],supportedProperty:function(e){return e!=="color-adjust"?!1:fe.js==="Webkit"?fe.css+"print-"+e:e}},gU=/[-\s]+(.)?/g;function sU(t,e){return e?e.toUpperCase():""}function Ru(t){return t.replace(gU,sU)}function lg(t){return Ru("-"+t)}var oU={noPrefill:["mask"],supportedProperty:function(e,n){if(!/^mask/.test(e))return!1;if(fe.js==="Webkit"){var i="mask-image";if(Ru(i)in n)return e;if(fe.js+lg(i)in n)return fe.css+e}return e}},rU={noPrefill:["text-orientation"],supportedProperty:function(e){return e!=="text-orientation"?!1:fe.vendor==="apple"&&!fe.isTouch?fe.css+e:e}},IU={noPrefill:["transform"],supportedProperty:function(e,n,i){return e!=="transform"?!1:i.transform?e:fe.css+e}},aU={noPrefill:["transition"],supportedProperty:function(e,n,i){return e!=="transition"?!1:i.transition?e:fe.css+e}},lU={noPrefill:["writing-mode"],supportedProperty:function(e){return e!=="writing-mode"?!1:fe.js==="Webkit"||fe.js==="ms"&&fe.browser!=="edge"?fe.css+e:e}},CU={noPrefill:["user-select"],supportedProperty:function(e){return e!=="user-select"?!1:fe.js==="Moz"||fe.js==="ms"||fe.vendor==="apple"?fe.css+e:e}},cU={supportedProperty:function(e,n){if(!/^break-/.test(e))return!1;if(fe.js==="Webkit"){var i="WebkitColumn"+lg(e);return i in n?fe.css+"column-"+e:!1}if(fe.js==="Moz"){var g="page"+lg(e);return g in n?"page-"+e:!1}return!1}},AU={supportedProperty:function(e,n){if(!/^(border|margin|padding)-inline/.test(e))return!1;if(fe.js==="Moz")return e;var i=e.replace("-inline","");return fe.js+lg(i)in n?fe.css+i:!1}},dU={supportedProperty:function(e,n){return Ru(e)in n?e:!1}},uU={supportedProperty:function(e,n){var i=lg(e);return e[0]==="-"||e[0]==="-"&&e[1]==="-"?e:fe.js+i in n?fe.css+e:fe.js!=="Webkit"&&"Webkit"+i in n?"-webkit-"+e:!1}},hU={supportedProperty:function(e){return e.substring(0,11)!=="scroll-snap"?!1:fe.js==="ms"?""+fe.css+e:e}},mU={supportedProperty:function(e){return e!=="overscroll-behavior"?!1:fe.js==="ms"?fe.css+"scroll-chaining":e}},fU={"flex-grow":"flex-positive","flex-shrink":"flex-negative","flex-basis":"flex-preferred-size","justify-content":"flex-pack",order:"flex-order","align-items":"flex-align","align-content":"flex-line-pack"},pU={supportedProperty:function(e,n){var i=fU[e];return i&&fe.js+lg(i)in n?fe.css+i:!1}},Nb={flex:"box-flex","flex-grow":"box-flex","flex-direction":["box-orient","box-direction"],order:"box-ordinal-group","align-items":"box-align","flex-flow":["box-orient","box-direction"],"justify-content":"box-pack"},BU=Object.keys(Nb),bU=function(e){return fe.css+e},yU={supportedProperty:function(e,n,i){var g=i.multiple;if(BU.indexOf(e)>-1){var s=Nb[e];if(!Array.isArray(s))return fe.js+lg(s)in n?fe.css+s:!1;if(!g)return!1;for(var o=0;o<s.length;o++)if(!(fe.js+lg(s[0])in n))return!1;return s.map(bU)}return!1}},wb=[nU,iU,oU,rU,IU,aU,lU,CU,cU,AU,dU,uU,hU,mU,pU,yU],Tb=wb.filter(function(t){return t.supportedProperty}).map(function(t){return t.supportedProperty}),vU=wb.filter(function(t){return t.noPrefill}).reduce(function(t,e){return t.push.apply(t,xl(e.noPrefill)),t},[]),II,$g={};if(nI){II=document.createElement("p");var Fu=window.getComputedStyle(document.documentElement,"");for(var Su in Fu)isNaN(Su)||($g[Fu[Su]]=Fu[Su]);vU.forEach(function(t){return delete $g[t]})}function Vu(t,e){if(e===void 0&&(e={}),!II)return t;if($g[t]!=null)return $g[t];(t==="transition"||t==="transform")&&(e[t]=t in II.style);for(var n=0;n<Tb.length&&($g[t]=Tb[n](t,II.style,e),!$g[t]);n++);try{II.style[t]=""}catch{return!1}return $g[t]}var so={},GU={transition:1,"transition-property":1,"-webkit-transition":1,"-webkit-transition-property":1},ZU=/(^\s*[\w-]+)|, (\s*[\w-]+)(?![^()]*\))/g,Cg;function RU(t,e,n){if(e==="var")return"var";if(e==="all")return"all";if(n==="all")return", all";var i=e?Vu(e):", "+Vu(n);return i||e||n}nI&&(Cg=document.createElement("p"));function Eb(t,e){var n=e;if(!Cg||t==="content")return e;if(typeof n!="string"||!isNaN(parseInt(n,10)))return n;var i=t+n;if(so[i]!=null)return so[i];try{Cg.style[t]=n}catch{return so[i]=!1,!1}if(GU[t])n=n.replace(ZU,RU);else if(Cg.style[t]===""&&(n=fe.css+n,n==="-ms-flex"&&(Cg.style[t]="-ms-flexbox"),Cg.style[t]=n,Cg.style[t]===""))return so[i]=!1,!1;return Cg.style[t]="",so[i]=n,so[i]}function FU(){function t(g){if(g.type==="keyframes"){var s=g;s.at=tU(s.at)}}function e(g){for(var s in g){var o=g[s];if(s==="fallbacks"&&Array.isArray(o)){g[s]=o.map(e);continue}var r=!1,I=Vu(s);I&&I!==s&&(r=!0);var a=!1,l=Eb(I,qg(o));l&&l!==o&&(a=!0),(r||a)&&(r&&delete g[s],g[I||s]=l||o)}return g}function n(g,s){return s.type!=="style"?g:e(g)}function i(g,s){return Eb(s,qg(g))||g}return{onProcessRule:t,onProcessStyle:n,onChangeValue:i}}function SU(){var t=function(n,i){return n.length===i.length?n>i?1:-1:n.length-i.length};return{onProcessStyle:function(n,i){if(i.type!=="style")return n;for(var g={},s=Object.keys(n).sort(t),o=0;o<s.length;o++)g[s[o]]=n[s[o]];return g}}}function VU(){return{plugins:[N3(),Y3(),k3(),P3(),z3(),typeof window=="undefined"?null:FU(),SU()]}}function Ve(t,e){if(t==null)return{};var n=Fl(t,e),i,g;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(g=0;g<s.length;g++)i=s[g],!(e.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(t,i)||(n[i]=t[i]))}return n}function Qb(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.baseClasses,n=t.newClasses;if(t.Component,!n)return e;var i=L({},e);return Object.keys(n).forEach(function(g){n[g]&&(i[g]="".concat(e[g]," ").concat(n[g]))}),i}var UU={set:function(e,n,i,g){var s=e.get(n);s||(s=new Map,e.set(n,s)),s.set(i,g)},get:function(e,n,i){var g=e.get(n);return g?g.get(i):void 0},delete:function(e,n,i){var g=e.get(n);g.delete(i)}},oo=UU,xU=we.createContext(null),Xb=xU;function aI(){var t=we.useContext(Xb);return t}var WU=vb(VU()),NU=JV(),wU=new Map,TU={disableGeneration:!1,generateClassName:NU,jss:WU,sheetsCache:null,sheetsManager:wU,sheetsRegistry:null},EU=we.createContext(TU),Yb=-1e9;function QU(){return Yb+=1,Yb}var XU={},YU=XU;function _U(t){var e=typeof t=="function";return{create:function(i,g){var s;try{s=e?t(i):t}catch(I){throw I}if(!g||!i.overrides||!i.overrides[g])return s;var o=i.overrides[g],r=L({},s);return Object.keys(o).forEach(function(I){r[I]=no(r[I],o[I])}),r},options:{}}}function HU(t,e,n){var i=t.state,g=t.stylesOptions;if(g.disableGeneration)return e||{};i.cacheClasses||(i.cacheClasses={value:null,lastProp:null,lastJSS:{}});var s=!1;return i.classes!==i.cacheClasses.lastJSS&&(i.cacheClasses.lastJSS=i.classes,s=!0),e!==i.cacheClasses.lastProp&&(i.cacheClasses.lastProp=e,s=!0),s&&(i.cacheClasses.value=Qb({baseClasses:i.cacheClasses.lastJSS,newClasses:e,Component:n})),i.cacheClasses.value}function kU(t,e){var n=t.state,i=t.theme,g=t.stylesOptions,s=t.stylesCreator,o=t.name;if(!g.disableGeneration){var r=oo.get(g.sheetsManager,s,i);r||(r={refs:0,staticSheet:null,dynamicStyles:null},oo.set(g.sheetsManager,s,i,r));var I=L({},s.options,g,{theme:i,flip:typeof g.flip=="boolean"?g.flip:i.direction==="rtl"});I.generateId=I.serverGenerateClassName||I.generateClassName;var a=g.sheetsRegistry;if(r.refs===0){var l;g.sheetsCache&&(l=oo.get(g.sheetsCache,s,i));var C=s.create(i,o);l||(l=g.jss.createStyleSheet(C,L({link:!1},I)),l.attach(),g.sheetsCache&&oo.set(g.sheetsCache,s,i,l)),a&&a.add(l),r.staticSheet=l,r.dynamicStyles=Gb(C)}if(r.dynamicStyles){var c=g.jss.createStyleSheet(r.dynamicStyles,L({link:!0},I));c.update(e),c.attach(),n.dynamicSheet=c,n.classes=Qb({baseClasses:r.staticSheet.classes,newClasses:c.classes}),a&&a.add(c)}else n.classes=r.staticSheet.classes;r.refs+=1}}function KU(t,e){var n=t.state;n.dynamicSheet&&n.dynamicSheet.update(e)}function LU(t){var e=t.state,n=t.theme,i=t.stylesOptions,g=t.stylesCreator;if(!i.disableGeneration){var s=oo.get(i.sheetsManager,g,n);s.refs-=1;var o=i.sheetsRegistry;s.refs===0&&(oo.delete(i.sheetsManager,g,n),i.jss.removeStyleSheet(s.staticSheet),o&&o.remove(s.staticSheet)),e.dynamicSheet&&(i.jss.removeStyleSheet(e.dynamicSheet),o&&o.remove(e.dynamicSheet))}}function MU(t,e){var n=we.useRef([]),i,g=we.useMemo(function(){return{}},e);n.current!==g&&(n.current=g,i=t()),we.useEffect(function(){return function(){i&&i()}},[g])}function PU(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.name,i=e.classNamePrefix,g=e.Component,s=e.defaultTheme,o=s===void 0?YU:s,r=Ve(e,["name","classNamePrefix","Component","defaultTheme"]),I=_U(t),a=n||i||"makeStyles";I.options={index:QU(),name:n,meta:a,classNamePrefix:a};var l=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},A=aI()||o,d=L({},we.useContext(EU),r),m=we.useRef(),u=we.useRef();MU(function(){var f={name:n,state:{},stylesCreator:I,stylesOptions:d,theme:A};return kU(f,c),u.current=!1,m.current=f,function(){LU(f)}},[A,I]),we.useEffect(function(){u.current&&KU(m.current,c),u.current=!0});var h=HU(m.current,c.classes,g);return h};return l}function JU(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _b(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(n=_b(t[e]))&&(i&&(i+=" "),i+=n);else for(e in t)t[e]&&(i&&(i+=" "),i+=e);return i}function Ue(){for(var t=0,e,n,i="";t<arguments.length;)(e=arguments[t++])&&(n=_b(e))&&(i&&(i+=" "),i+=n);return i}var Hb={exports:{}},We={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mt=typeof Symbol=="function"&&Symbol.for,Uu=mt?Symbol.for("react.element"):60103,xu=mt?Symbol.for("react.portal"):60106,Wl=mt?Symbol.for("react.fragment"):60107,Nl=mt?Symbol.for("react.strict_mode"):60108,wl=mt?Symbol.for("react.profiler"):60114,Tl=mt?Symbol.for("react.provider"):60109,El=mt?Symbol.for("react.context"):60110,Wu=mt?Symbol.for("react.async_mode"):60111,Ql=mt?Symbol.for("react.concurrent_mode"):60111,Xl=mt?Symbol.for("react.forward_ref"):60112,Yl=mt?Symbol.for("react.suspense"):60113,DU=mt?Symbol.for("react.suspense_list"):60120,_l=mt?Symbol.for("react.memo"):60115,Hl=mt?Symbol.for("react.lazy"):60116,zU=mt?Symbol.for("react.block"):60121,OU=mt?Symbol.for("react.fundamental"):60117,jU=mt?Symbol.for("react.responder"):60118,qU=mt?Symbol.for("react.scope"):60119;function nn(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case Uu:switch(t=t.type,t){case Wu:case Ql:case Wl:case wl:case Nl:case Yl:return t;default:switch(t=t&&t.$$typeof,t){case El:case Xl:case Hl:case _l:case Tl:return t;default:return e}}case xu:return e}}}function kb(t){return nn(t)===Ql}We.AsyncMode=Wu;We.ConcurrentMode=Ql;We.ContextConsumer=El;We.ContextProvider=Tl;We.Element=Uu;We.ForwardRef=Xl;We.Fragment=Wl;We.Lazy=Hl;We.Memo=_l;We.Portal=xu;We.Profiler=wl;We.StrictMode=Nl;We.Suspense=Yl;We.isAsyncMode=function(t){return kb(t)||nn(t)===Wu};We.isConcurrentMode=kb;We.isContextConsumer=function(t){return nn(t)===El};We.isContextProvider=function(t){return nn(t)===Tl};We.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===Uu};We.isForwardRef=function(t){return nn(t)===Xl};We.isFragment=function(t){return nn(t)===Wl};We.isLazy=function(t){return nn(t)===Hl};We.isMemo=function(t){return nn(t)===_l};We.isPortal=function(t){return nn(t)===xu};We.isProfiler=function(t){return nn(t)===wl};We.isStrictMode=function(t){return nn(t)===Nl};We.isSuspense=function(t){return nn(t)===Yl};We.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===Wl||t===Ql||t===wl||t===Nl||t===Yl||t===DU||typeof t=="object"&&t!==null&&(t.$$typeof===Hl||t.$$typeof===_l||t.$$typeof===Tl||t.$$typeof===El||t.$$typeof===Xl||t.$$typeof===OU||t.$$typeof===jU||t.$$typeof===qU||t.$$typeof===zU)};We.typeOf=nn;Hb.exports=We;var Nu=Hb.exports,$U={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},e9={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},t9={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Kb={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},wu={};wu[Nu.ForwardRef]=t9;wu[Nu.Memo]=Kb;function Lb(t){return Nu.isMemo(t)?Kb:wu[t.$$typeof]||$U}var n9=Object.defineProperty,i9=Object.getOwnPropertyNames,Mb=Object.getOwnPropertySymbols,g9=Object.getOwnPropertyDescriptor,s9=Object.getPrototypeOf,Pb=Object.prototype;function Jb(t,e,n){if(typeof e!="string"){if(Pb){var i=s9(e);i&&i!==Pb&&Jb(t,i,n)}var g=i9(e);Mb&&(g=g.concat(Mb(e)));for(var s=Lb(t),o=Lb(e),r=0;r<g.length;++r){var I=g[r];if(!e9[I]&&!(n&&n[I])&&!(o&&o[I])&&!(s&&s[I])){var a=g9(e,I);try{n9(t,I,a)}catch{}}}}return t}var o9=Jb;function r9(t,e){if(typeof e=="function"){var n=e(t);return n}return L({},t,e)}function QD(t){var e=t.children,n=t.theme,i=aI(),g=we.useMemo(function(){var s=i===null?n:r9(i,n);return s!=null&&(s[ob]=i!==null),s},[n,i]);return we.createElement(Xb.Provider,{value:g},e)}var I9=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function(i){var g=n.defaultTheme,s=n.withTheme,o=s===void 0?!1:s,r=n.name,I=Ve(n,["defaultTheme","withTheme","name"]),a=r,l=PU(e,L({defaultTheme:g,Component:i,name:r||i.displayName,classNamePrefix:a},I)),C=we.forwardRef(function(A,d){A.classes;var m=A.innerRef,u=Ve(A,["classes","innerRef"]),h=l(L({},i.defaultProps,A)),f,p=u;return(typeof r=="string"||o)&&(f=aI()||g,r&&(p=rb({theme:f,name:r,props:u})),o&&!p.theme&&(p.theme=f)),we.createElement(i,L({ref:m||d,classes:h},p))});return o9(C,i),C}},a9=I9;const l9="w";function XD(t,e){const n=qd(e),{s:i,w:g}=G.exports.useContext(n);return G.exports.useCallback(o=>{const r=I=>i[l9](t,o,I);return g?g(r):r()},[i,g,t])}function YD(t,e){return VV(t,e)[0]}function _D(t,e){let n=null;const i=new Map,g=s=>{let o;if(e===void 0)o=i.get(s);else for(const[I,a]of i)if(e(I,s)){o=a;break}if(o!==void 0)if(n==null?void 0:n(o[1],s))i.delete(s);else return o[0];const r=t(s);return i.set(s,[r,Date.now()]),r};return g.remove=s=>{if(e===void 0)i.delete(s);else for(const[o]of i)if(e(o,s)){i.delete(o);break}},g.setShouldRemove=s=>{if(n=s,!!n)for(const[o,r]of i)n(r[1],o)&&i.delete(o)},g}const C9=(t,e)=>{do{const[n,...i]=e,g=t.get(n);if(!g)return;if(!i.length)return g[1];t=g[0],e=i}while(e.length)},c9=(t,e,n)=>{do{const[i,...g]=e;let s=t.get(i);if(s||(s=[new WeakMap],t.set(i,s)),!g.length){s[1]=n;return}t=s[0],e=g}while(e.length)},Db=()=>{const t=new WeakMap;return(n,i)=>{const g=C9(t,i);if(g)return g;const s=n();return c9(t,i,s),s}},A9=Db(),zb=t=>!!t.write,d9=t=>typeof t=="function";function HD(t,e){return A9(()=>{const n=new WeakMap,i=(I,a)=>{let l=n.get(I);if(l)return l;const C=a&&n.get(a),c=[],A=[];return I.forEach((d,m)=>{const u=e?e(d):m;A[m]=u;const h=C&&C.atomList[C.keyList.indexOf(u)];if(h){c[m]=h;return}const f=jg(()=>({})),p=Z=>{const v=Z(f),N=Z(g),x=Z(t),E=i(x,N.prev).keyList.indexOf(u);if(E<0||E>=x.length){if("prev"in v)return v.prev;throw new Error("splitAtom: index out of bounds for read")}return v.prev=x[E],x[E]},b=(Z,v,N)=>{const x=Z(g),V=Z(t),D=i(V,x.prev).keyList.indexOf(u);if(D<0||D>=V.length)throw new Error("splitAtom: index out of bounds for write");const _=d9(N)?N(V[D]):N;v(t,[...V.slice(0,D),_,...V.slice(D+1)])};c[m]=zb(t)?jg(p,b):jg(p)}),C&&C.keyList.length===A.length&&C.keyList.every((d,m)=>d===A[m])?l=C:l={atomList:c,keyList:A},n.set(I,l),l},g=jg(()=>({})),s=I=>{const a=I(g),l=I(t),C=i(l,a.prev);return a.prev=l,C.atomList},o=(I,a,l)=>{const C=I(r).indexOf(l);if(C>=0){const c=I(t);a(t,[...c.slice(0,C),...c.slice(C+1)])}},r=zb(t)?jg(s,o):jg(s);return r},e?[t,e]:[t])}var u9=Object.defineProperty,h9=Object.defineProperties,m9=Object.getOwnPropertyDescriptors,Ob=Object.getOwnPropertySymbols,f9=Object.prototype.hasOwnProperty,p9=Object.prototype.propertyIsEnumerable,jb=(t,e,n)=>e in t?u9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,B9=(t,e)=>{for(var n in e||(e={}))f9.call(e,n)&&jb(t,n,e[n]);if(Ob)for(var n of Ob(e))p9.call(e,n)&&jb(t,n,e[n]);return t},b9=(t,e)=>h9(t,m9(e));const y9=Db();function kD(t){const e=()=>{const n=v9(t);return jg(g=>{const s=[],o=n.map((r,I)=>{try{return g(r)}catch(a){if(a instanceof Promise)s[I]=a;else throw a}});if(s.length)throw Promise.all(s);return G9(t,o)})};return Array.isArray(t)?y9(e,t):e()}const v9=t=>Array.isArray(t)?t:Object.getOwnPropertyNames(t).map(e=>t[e]),G9=(t,e)=>Array.isArray(t)?e:Object.getOwnPropertyNames(t).reduce((n,i,g)=>b9(B9({},n),{[i]:e[g]}),{});function Z9(t){try{t().removeItem||console.warn("Missing removeItem. In the next version, it will be required.")}catch{}return{getItem:e=>{const n=t().getItem(e);return n instanceof Promise?n.then(i=>JSON.parse(i||"")):JSON.parse(n||"")},setItem:(e,n)=>t().setItem(e,JSON.stringify(n)),removeItem:e=>{var n,i;return(i=(n=t()).removeItem)==null?void 0:i.call(n,e)}}}Z9(()=>localStorage);function kl(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const qb=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),$b=typeof process!="undefined"&&process.version&&/v([0-9]*)/.exec(process.version);$b&&parseFloat($b[1]);const R9="3.1.7";function vi(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}typeof process!="object"||String(process)!=="[object process]"||process.browser;const F9=typeof window!="undefined"&&typeof window.orientation!="undefined",ey=typeof process!="undefined"&&process.version&&/v([0-9]*)/.exec(process.version);ey&&parseFloat(ey[1]);class S9{constructor(e,n){te(this,"name",void 0),te(this,"workerThread",void 0),te(this,"isRunning",void 0),te(this,"result",void 0),te(this,"_resolve",void 0),te(this,"_reject",void 0),this.name=e,this.workerThread=n,this.isRunning=!0,this._resolve=()=>{},this._reject=()=>{},this.result=new Promise((i,g)=>{this._resolve=i,this._reject=g})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){vi(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){vi(this.isRunning),this.isRunning=!1,this._reject(e)}}const Tu=new Map;function V9(t){vi(t.source&&!t.url||!t.source&&t.url);let e=Tu.get(t.source||t.url);return e||(t.url&&(e=U9(t.url),Tu.set(t.url,e)),t.source&&(e=ty(t.source),Tu.set(t.source,e))),vi(e),e}function U9(t){if(!t.startsWith("http"))return t;const e=x9(t);return ty(e)}function ty(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function x9(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function ny(t,e=!0,n){const i=n||new Set;if(t){if(iy(t))i.add(t);else if(iy(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const g in t)ny(t[g],e,i)}}return n===void 0?Array.from(i):[]}function iy(t){return t?t instanceof ArrayBuffer||typeof MessagePort!="undefined"&&t instanceof MessagePort||typeof ImageBitmap!="undefined"&&t instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&t instanceof OffscreenCanvas:!1}const Eu=()=>{};class gy{static isSupported(){return typeof Worker!="undefined"}constructor(e){te(this,"name",void 0),te(this,"source",void 0),te(this,"url",void 0),te(this,"terminated",!1),te(this,"worker",void 0),te(this,"onMessage",void 0),te(this,"onError",void 0),te(this,"_loadableURL","");const{name:n,source:i,url:g}=e;vi(i||g),this.name=n,this.source=i,this.url=g,this.onMessage=Eu,this.onError=s=>console.log(s),this.worker=this._createBrowserWorker()}destroy(){this.onMessage=Eu,this.onError=Eu,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,n){n=n||ny(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=V9({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}}class W9{constructor(e){te(this,"name","unnamed"),te(this,"source",void 0),te(this,"url",void 0),te(this,"maxConcurrency",1),te(this,"maxMobileConcurrency",1),te(this,"onDebug",()=>{}),te(this,"reuseWorkers",!0),te(this,"props",{}),te(this,"jobQueue",[]),te(this,"idleQueue",[]),te(this,"count",0),te(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props=S(S({},this.props),e),e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(g,s,o)=>g.done(o),i=(g,s)=>g.error(s)){const g=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:s}),this));return this._startQueuedJob(),await g}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new S9(n.name,e);e.onMessage=g=>n.onMessage(i,g.type,g.payload),e.onError=g=>n.onError(i,g),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new gy({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return F9?this.maxMobileConcurrency:this.maxConcurrency}}const N9={maxConcurrency:3,maxMobileConcurrency:1,onDebug:()=>{},reuseWorkers:!0};class Gi{static isSupported(){return gy.isSupported()}static getWorkerFarm(e={}){return Gi._workerFarm=Gi._workerFarm||new Gi({}),Gi._workerFarm.setProps(e),Gi._workerFarm}constructor(e){te(this,"props",void 0),te(this,"workerPools",new Map),this.props=S({},N9),this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy()}setProps(e){this.props=S(S({},this.props),e);for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:g}=e;let s=this.workerPools.get(n);return s||(s=new W9({name:n,source:i,url:g}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}te(Gi,"_workerFarm",void 0);const w9="latest";function T9(t,e={}){const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let g=n.workerUrl;if(!g&&t.id==="compression"&&(g=e.workerUrl),e._workerType==="test"&&(g="modules/".concat(t.module,"/dist/").concat(i)),!g){let s=t.version;s==="latest"&&(s=w9);const o=s?"@".concat(s):"";g="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(i)}return vi(g),g}function E9(t,e=R9){vi(t,"no worker provided");const n=t.version;return!(!e||!n)}var Q9={},X9=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Q9});function Y9(t,e){return Gi.isSupported()?t.worker&&(e==null?void 0:e.worker):!1}async function _9(t,e,n,i,g){const s=t.id,o=T9(t,n),I=Gi.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n));const a=await I.startJob("process-on-worker",H9.bind(null,g));return a.postMessage("process",{input:e,options:n}),await(await a.result).result}async function H9(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:g,input:s,options:o}=i;try{const r=await t(s,o);e.postMessage("done",{id:g,result:r})}catch(r){const I=r instanceof Error?r.message:"unknown error";e.postMessage("error",{id:g,error:I})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function sy(t){return t&&typeof t=="object"&&t.isBuffer}function k9(t){return sy(t)?new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer:t}function oy(t){if(sy(t))return k9(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function K9(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),g=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==g[s])return!1;return!0}function L9(...t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),i=new Uint8Array(n);let g=0;for(const s of e)i.set(s,g),g+=s.byteLength;return i.buffer}async function M9(t){const e=[];for await(const n of t)e.push(n);return L9(...e)}function ry(){let t;if(typeof window!="undefined"&&window.performance)t=window.performance.now();else if(typeof process!="undefined"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class Iy{constructor(e,n){te(this,"name",void 0),te(this,"type",void 0),te(this,"sampleSize",1),te(this,"time",void 0),te(this,"count",void 0),te(this,"samples",void 0),te(this,"lastTiming",void 0),te(this,"lastSampleTime",void 0),te(this,"lastSampleCount",void 0),te(this,"_count",0),te(this,"_time",0),te(this,"_samples",0),te(this,"_startTime",0),te(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ry(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ry()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Kl{constructor(e){te(this,"id",void 0),te(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof Iy?this.stats[n]=e:this.stats[n]=new Iy(n,i)),this.stats[n]}}const P9="Queued Requests",J9="Active Requests",D9="Cancelled Requests",z9="Queued Requests Ever",O9="Active Requests Ever",j9={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class q9{constructor(e={}){te(this,"props",void 0),te(this,"stats",void 0),te(this,"activeRequestCount",0),te(this,"requestQueue",[]),te(this,"requestMap",new Map),te(this,"deferredUpdate",null),this.props=S(S({},j9),e),this.stats=new Kl({id:this.props.id}),this.stats.get(P9),this.stats.get(J9),this.stats.get(D9),this.stats.get(z9),this.stats.get(O9)}scheduleRequest(e,n=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:n},g=new Promise(s=>(i.resolve=s,i));return this.requestQueue.push(i),this.requestMap.set(e,g),this._issueNewRequests(),g}_issueRequest(e){const{handle:n,resolve:i}=e;let g=!1;const s=()=>{g||(g=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const i=e[n];this._updateRequest(i)||(e.splice(n,1),this.requestMap.delete(i.handle),n--)}e.sort((n,i)=>n.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let $9="";const ay={};function ex(t){for(const e in ay)if(t.startsWith(e)){const n=ay[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat($9).concat(t)),t}function tx(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}const nx=t=>typeof t=="boolean",lI=t=>typeof t=="function",CI=t=>t!==null&&typeof t=="object",ly=t=>CI(t)&&t.constructor==={}.constructor,ix=t=>t&&typeof t[Symbol.iterator]=="function",gx=t=>t&&typeof t[Symbol.asyncIterator]=="function",cI=t=>typeof Response!="undefined"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,ro=t=>typeof Blob!="undefined"&&t instanceof Blob,sx=t=>t&&typeof t=="object"&&t.isBuffer,ox=t=>typeof ReadableStream!="undefined"&&t instanceof ReadableStream||CI(t)&&lI(t.tee)&&lI(t.cancel)&&lI(t.getReader),rx=t=>CI(t)&&lI(t.read)&&lI(t.pipe)&&nx(t.readable),Cy=t=>ox(t)||rx(t),Ix=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,ax=/^([-\w.]+\/[-\w.+]+)/;function lx(t){const e=ax.exec(t);return e?e[1]:t}function cy(t){const e=Ix.exec(t);return e?e[1]:""}const Cx=/\?.*/;function Ll(t){if(cI(t)){const e=Qu(t.url||""),n=t.headers.get("content-type")||"";return{url:e,type:lx(n)||cy(e)}}return ro(t)?{url:Qu(t.name||""),type:t.type||""}:typeof t=="string"?{url:Qu(t),type:cy(t)}:{url:"",type:""}}function cx(t){return cI(t)?t.headers["content-length"]||-1:ro(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function Qu(t){return t.replace(Cx,"")}async function Ay(t){if(cI(t))return t;const e={},n=cx(t);n>=0&&(e["content-length"]=String(n));const{url:i,type:g}=Ll(t);g&&(e["content-type"]=g);const s=await ux(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function Ax(t){if(!t.ok){const e=await dx(t);throw new Error(e)}}async function dx(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(60),"..."):e}catch{}return e}async function ux(t){const e=5;if(typeof t=="string")return"data:,".concat(t.slice(0,e));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const g=new FileReader;g.onload=s=>{var o;return i(s==null||(o=s.target)===null||o===void 0?void 0:o.result)},g.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,e),i=hx(n);return"data:base64,".concat(i)}return null}function hx(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function dy(t,e){if(typeof t=="string"){t=ex(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await Ay(t)}function Xu(t){if(typeof window!="undefined"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process!="undefined"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function cg(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Xu()}function mx(){return cg()&&typeof document!="undefined"}const Ag={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,global:typeof global!="undefined"&&global,document:typeof document!="undefined"&&document,process:typeof process=="object"&&process},fx=globalThis,px=Ag.self||Ag.window||Ag.global,AI=Ag.window||Ag.self||Ag.global,Bx=Ag.document||{},Io=Ag.process||{},bx=console,Yu=typeof __VERSION__!="undefined"?__VERSION__:"untranspiled source";cg();const Ml=globalThis;function yx(){return typeof Ml.orientation!="undefined"}function uy(t){if(!t&&!cg())return"Node";if(Xu(t))return"Electron";const n=t||(typeof navigator!="undefined"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,g=n.indexOf("Trident/")!==-1;return i||g?"IE":Ml.chrome?"Chrome":Ml.safari?"Safari":Ml.mozInnerScreenX?"Firefox":"Unknown"}function vx(t,e){if(!t)throw new Error(e||"Assertion failed")}var Gx=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",VERSION:Yu,self:px,window:AI,global:fx,document:Bx,process:Io,console:bx,isBrowser:cg,isBrowserMainThread:mx,getBrowser:uy,isMobile:yx,isElectron:Xu,assert:vx});function Zx(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class Rx{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";te(this,"storage",void 0),te(this,"id",void 0),te(this,"config",{}),this.storage=Zx(i),this.id=e,this.config={},Object.assign(this.config,n),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}return this}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function Fx(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function Sx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function _u(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const g=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const s=t.width*n,o=t.height*n,r=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(g,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),r]}let Pl;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Pl||(Pl={}));function hy(t){return typeof t=="string"?Pl[t.toUpperCase()]||Pl.WHITE:t}function Vx(t,e,n){return!cg&&typeof t=="string"&&(e&&(e=hy(e),t="[".concat(e,"m").concat(t,"[39m")),n&&(e=hy(n),t="[".concat(n+10,"m").concat(t,"[49m"))),t}function Ux(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const g of i)typeof t[g]=="function"&&(e.find(s=>g===s)||(t[g]=t[g].bind(t)))}function Jl(t,e){if(!t)throw new Error(e||"Assertion failed")}function ao(){let t;if(cg&&"performance"in AI){var e,n;t=AI==null||(e=AI.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in Io){var i;const g=Io==null||(i=Io.hrtime)===null||i===void 0?void 0:i.call(Io);t=g[0]*1e3+g[1]/1e6}else t=Date.now();return t}const lo={debug:cg&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},xx={enabled:!0,level:0};function Gn(){}const my={},fy={once:!0};class dI{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};te(this,"id",void 0),te(this,"VERSION",Yu),te(this,"_startTs",ao()),te(this,"_deltaTs",ao()),te(this,"_storage",void 0),te(this,"userData",{}),te(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new Rx("__probe-".concat(this.id,"__"),xx),this.userData={},this.timeStamp("".concat(this.id," started")),Ux(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ao()-this._startTs).toPrecision(10))}getDelta(){return Number((ao()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.updateConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){Jl(e,n)}warn(e){return this._getLogFunction(0,e,lo.warn,arguments,fy)}error(e){return this._getLogFunction(0,e,lo.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,lo.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,lo.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,g=new Array(i>2?i-2:0),s=2;s<i;s++)g[s-2]=arguments[s];return this._getLogFunction(e,n,lo.debug||lo.info,arguments,fy)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||Gn,i&&[i],{tag:Tx(n)}):Gn}image(e){let{logLevel:n,priority:i,image:g,message:s="",scale:o=1}=e;return this._shouldLog(n||i)?cg?wx({image:g,message:s,scale:o}):Nx({image:g,message:s,scale:o}):Gn}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Gn)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const g=By({logLevel:e,message:n,opts:i}),{collapsed:s}=i;return g.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(g)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Gn)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=py(e)}_getLogFunction(e,n,i,g,s){if(this._shouldLog(e)){s=By({logLevel:e,message:n,args:g,opts:s}),i=i||s.method,Jl(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=ao();const o=s.tag||s.message;if(s.once)if(!my[o])my[o]=ao();else return Gn;return n=Wx(this.id,s.message,s),i.bind(console,n,...s.args)}return Gn}}te(dI,"VERSION",Yu);function py(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Jl(Number.isFinite(e)&&e>=0),e}function By(t){const{logLevel:e,message:n}=t;t.logLevel=py(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const g=typeof t.message;return Jl(g==="string"||g==="object"),Object.assign(t,{args:i},t.opts)}function Wx(t,e,n){if(typeof e=="string"){const i=n.time?Sx(Fx(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=Vx(e,n.color,n.background)}return e}function Nx(t){let{image:e,message:n="",scale:i=1}=t,g=null;try{g=module.require("asciify-image")}catch{}return g?()=>g(e,{fit:"box",width:"".concat(Math.round(80*i),"%")}).then(s=>console.log(s)):Gn}function wx(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=_u(s,n,i);console.log(...o)},s.src=e,Gn}const g=e.nodeName||"";if(g.toLowerCase()==="img")return console.log(..._u(e,n,i)),Gn;if(g.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(..._u(s,n,i)),s.src=e.toDataURL(),Gn}return Gn}function Tx(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const by=new dI({id:"loaders.gl"});class Ex{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Qx{constructor(){te(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const yy={fetch:null,mimeType:void 0,nothrow:!1,log:new Qx,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Xx={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function vy(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const Gy=()=>{const t=vy();return t.globalOptions=t.globalOptions||S({},yy),t.globalOptions};function Yx(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],_x(t,n),kx(e,t,i)}function Zy(t,e){const n=Gy(),i=t||n;return typeof i.fetch=="function"?i.fetch:CI(i.fetch)?g=>dy(g,i):e!=null&&e.fetch?e==null?void 0:e.fetch:dy}function _x(t,e){Ry(t,null,yy,Xx,e);for(const n of e){const i=t&&t[n.id]||{},g=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Ry(i,n.id,g,s,e)}}function Ry(t,e,n,i,g){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const r in t){const I=!e&&CI(t[r]),a=r==="baseUri"&&!e,l=r==="workerUrl"&&e;if(!(r in n)&&!a&&!l){if(r in i)by.warn("".concat(s," loader option '").concat(o).concat(r,"' no longer supported, use '").concat(i[r],"'"))();else if(!I){const C=Hx(r,g);by.warn("".concat(s," loader option '").concat(o).concat(r,"' not recognized. ").concat(C))()}}}}function Hx(t,e){const n=t.toLowerCase();let i="";for(const g of e)for(const s in g.options){if(t===s)return"Did you mean '".concat(g.id,".").concat(s,"'?");const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||"Did you mean '".concat(g.id,".").concat(s,"'?"))}return i}function kx(t,e,n){const i=t.options||{},g=S({},i);return Kx(g,n),g.log===null&&(g.log=new Ex),Fy(g,Gy()),Fy(g,e),g}function Fy(t,e){for(const n in e)if(n in e){const i=e[n];ly(i)&&ly(t[n])?t[n]=S(S({},t[n]),e[n]):t[n]=e[n]}}function Kx(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Hu(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function ku(t){var e,n;kl(t,"null loader"),kl(Hu(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t=J(S({},t),{options:S(S({},t.options),i)})),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Sy=()=>{const t=vy();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function Lx(t){const e=Sy();t=Array.isArray(t)?t:[t];for(const n of t){const i=ku(n);e.find(g=>i===g)||e.unshift(i)}}function Mx(){return Sy()}const Px=new dI({id:"loaders.gl"}),Jx=/\.([^.]+)$/;async function Dx(t,e=[],n,i){if(!Uy(t))return null;let g=Vy(t,e,J(S({},n),{nothrow:!0}),i);if(g)return g;if(ro(t)&&(t=await t.slice(0,10).arrayBuffer(),g=Vy(t,e,n,i)),!g&&!(n!=null&&n.nothrow))throw new Error(xy(t));return g}function Vy(t,e=[],n,i){if(!Uy(t))return null;if(e&&!Array.isArray(e))return ku(e);let g=[];e&&(g=g.concat(e)),n!=null&&n.ignoreRegisteredLoaders||g.push(...Mx()),Ox(g);const s=zx(t,g,n,i);if(!s&&!(n!=null&&n.nothrow))throw new Error(xy(t));return s}function zx(t,e,n,i){const{url:g,type:s}=Ll(t),o=g||(i==null?void 0:i.url);let r=null,I="";if(n!=null&&n.mimeType&&(r=Ku(e,n==null?void 0:n.mimeType),I="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),r=r||jx(e,o),I=I||(r?"matched url ".concat(o):""),r=r||Ku(e,s),I=I||(r?"matched MIME type ".concat(s):""),r=r||$x(e,t),I=I||(r?"matched initial data ".concat(Ny(t)):""),r=r||Ku(e,n==null?void 0:n.fallbackMimeType),I=I||(r?"matched fallback MIME type ".concat(s):""),I){var a;Px.log(1,"selectLoader selected ".concat((a=r)===null||a===void 0?void 0:a.name,": ").concat(I,"."))}return r}function Uy(t){return!(t instanceof Response&&t.status===204)}function xy(t){const{url:e,type:n}=Ll(t);let i="No valid loader found (";i+=e?"".concat(tx(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const g=t?Ny(t):"";return i+=g?' first bytes: "'.concat(g,'"'):"first bytes: not available",i+=")",i}function Ox(t){for(const e of t)ku(e)}function jx(t,e){const n=e&&Jx.exec(e),i=n&&n[1];return i?qx(t,i):null}function qx(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function Ku(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function $x(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(eW(e,n))return n}else if(ArrayBuffer.isView(e)){if(Wy(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Wy(e,0,n))return n;return null}function eW(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function Wy(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(g=>tW(t,e,n,g))}function tW(t,e,n,i){if(i instanceof ArrayBuffer)return K9(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const g=Lu(t,e,i.length);return i===g;default:return!1}}function Ny(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Lu(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Lu(t,0,e):""}function Lu(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let g="";for(let s=0;s<n;s++)g+=String.fromCharCode(i.getUint8(e+s));return g}const nW=256*1024;function*iW(t,e){const n=(e==null?void 0:e.chunkSize)||nW;let i=0;const g=new TextEncoder;for(;i<t.length;){const s=Math.min(t.length-i,n),o=t.slice(i,i+s);i+=s,yield g.encode(o)}}const gW=256*1024;function*sW(t,e={}){const{chunkSize:n=gW}=e;let i=0;for(;i<t.byteLength;){const g=Math.min(t.byteLength-i,n),s=new ArrayBuffer(g),o=new Uint8Array(t,i,g);new Uint8Array(s).set(o),i+=g,yield s}}const oW=1024*1024;async function*rW(t,e){const n=(e==null?void 0:e.chunkSize)||oW;let i=0;for(;i<t.size;){const g=i+n,s=await t.slice(i,g).arrayBuffer();i=g,yield s}}function wy(t,e){return qb?IW(t,e):aW(t)}async function*IW(t,e){const n=t.getReader();let i;try{for(;;){const g=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:s,value:o}=await g;if(s)return;yield oy(o)}}catch{n.releaseLock()}}async function*aW(t,e){for await(const n of t)yield oy(n)}function lW(t,e){if(typeof t=="string")return iW(t,e);if(t instanceof ArrayBuffer)return sW(t,e);if(ro(t))return rW(t,e);if(Cy(t))return wy(t,e);if(cI(t))return wy(t.body,e);throw new Error("makeIterator")}const Ty="Cannot convert supplied data type";function CW(t,e,n){if(e.text&&typeof t=="string")return t;if(sx(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const g=t.byteLength||t.length;return(t.byteOffset!==0||g!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+g)),i}throw new Error(Ty)}async function cW(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return CW(t,e);if(ro(t)&&(t=await Ay(t)),cI(t)){const g=t;return await Ax(g),e.binary?await g.arrayBuffer():await g.text()}if(Cy(t)&&(t=lW(t,n)),ix(t)||gx(t))return M9(t);throw new Error(Ty)}function AW(t,e,n=null){if(n)return n;const i=S({fetch:Zy(e,t)},t);return Array.isArray(i.loaders)||(i.loaders=null),i}function dW(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function Mu(t,e,n,i){vi(!i||typeof i=="object"),e&&!Array.isArray(e)&&!Hu(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const{url:g}=Ll(t),o=dW(e,i),r=await Dx(t,o,n);return r?(n=Yx(n,r,o,g),i=AW({url:g,parse:Mu,loaders:o},n,i),await uW(r,t,n,i)):null}async function uW(t,e,n,i){if(E9(t),e=await cW(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(Y9(t,n))return await _9(t,e,n,i,Mu);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw vi(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function Dl(t,e,n,i){!Array.isArray(e)&&!Hu(e)&&(n=e,e=void 0);const g=Zy(n);let s=t;return typeof t=="string"&&(s=await g(t)),ro(t)&&(s=await g(t)),await Mu(s,e,n)}const hW="3.1.7",{_parseImageNode:mW}=globalThis,Pu=typeof Image!="undefined",Ju=typeof ImageBitmap!="undefined",fW=Boolean(mW),Du=qb?!0:fW;function pW(t){switch(t){case"auto":return Ju||Pu||Du;case"imagebitmap":return Ju;case"image":return Pu;case"data":return Du;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function BW(){if(Ju)return"imagebitmap";if(Pu)return"image";if(Du)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function bW(t){const e=vW(t);if(!e)throw new Error("Not an image");return e}function yW(t){switch(bW(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function vW(t){return typeof ImageBitmap!="undefined"&&t instanceof ImageBitmap?"imagebitmap":typeof Image!="undefined"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const GW=/^data:image\/svg\+xml/,ZW=/\.svg((\?|#).*)?$/;function zu(t){return t&&(GW.test(t)||ZW.test(t))}function RW(t,e){if(zu(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return Ey(t,e)}function Ey(t,e){if(zu(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Qy(t,e,n){const i=RW(t,n),g=self.URL||self.webkitURL,s=typeof i!="string"&&g.createObjectURL(i);try{return await FW(s||i,e)}finally{s&&g.revokeObjectURL(s)}}async function FW(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,g)=>{try{n.onload=()=>i(n),n.onerror=s=>g(new Error("Could not load image ".concat(t,": ").concat(s)))}catch(s){g(s)}})}const SW={};let Xy=!0;async function VW(t,e,n){let i;zu(n)?i=await Qy(t,e,n):i=Ey(t,n);const g=e&&e.imagebitmap;return await UW(i,g)}async function UW(t,e=null){if((xW(e)||!Xy)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),Xy=!1}return await createImageBitmap(t)}function xW(t){for(const e in t||SW)return!1;return!0}const ei=!1,uI=!0;function Yy(t){const e=hI(t);return WW(e)||TW(e)||NW(e)||wW(e)}function WW(t){const e=hI(t);return e.byteLength>=24&&e.getUint32(0,ei)===2303741511?{mimeType:"image/png",width:e.getUint32(16,ei),height:e.getUint32(20,ei)}:null}function NW(t){const e=hI(t);return e.byteLength>=10&&e.getUint32(0,ei)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,uI),height:e.getUint16(8,uI)}:null}function wW(t){const e=hI(t);return e.byteLength>=14&&e.getUint16(0,ei)===16973&&e.getUint32(2,uI)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,uI),height:e.getUint32(22,uI)}:null}function TW(t){const e=hI(t);if(!(e.byteLength>=3&&e.getUint16(0,ei)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:g}=EW();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,ei);if(g.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,ei),width:e.getUint16(s+7,ei)};if(!i.has(o))return null;s+=2,s+=e.getUint16(s,ei)}return null}function EW(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);const e=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:t,sofMarkers:e}}function hI(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function QW(t,e){const{mimeType:n}=Yy(t)||{},i=globalThis._parseImageNode;return kl(i),await i(t,n)}async function XW(t,e,n){e=e||{};const g=(e.image||{}).type||"auto",{url:s}=n||{},o=YW(g);let r;switch(o){case"imagebitmap":r=await VW(t,e,s);break;case"image":r=await Qy(t,e,s);break;case"data":r=await QW(t);break;default:kl(!1)}return g==="data"&&(r=yW(r)),r}function YW(t){switch(t){case"auto":case"data":return BW();default:return pW(t),t}}const _W=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],HW=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],kW={image:{type:"auto",decode:!0}},_y={id:"image",module:"images",name:"Images",version:hW,mimeTypes:HW,extensions:_W,parse:XW,tests:[t=>Boolean(Yy(new DataView(t)))],options:kW};var KW=Tm(Gx),Le=KW,pe=new dI({id:"deck"});let Ou={};function LW(t){Ou=t}function Tt(t){pe.level>0&&Ou[t]&&Ou[t].call(...arguments)}function MW(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}var PW={name:"JSON",extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:MW,parseTextSync:JSON.parse};const mI="8.6.7",zl=Le.global.deck&&Le.global.deck.VERSION;if(zl&&zl!==mI)throw new Error("deck.gl - multiple versions detected: ".concat(zl," vs ").concat(mI));zl||(pe.log(1,"deck.gl ".concat(mI))(),Le.global.deck=Object.assign(Le.global.deck||{},{VERSION:mI,version:mI,log:pe,_registerLoggers:LW}),Lx([PW,[_y,{imagebitmap:{premultiplyAlpha:"none"}}]]));var JW=Le.global.deck;const se=new dI({id:"luma.gl"});function Lt(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const DW="Invalid WebGLRenderingContext",zW="Requires WebGL2";function Ol(t){return typeof WebGLRenderingContext!="undefined"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function ye(t){return typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function OW(t){return ye(t)?t:null}function jl(t){return Lt(Ol(t),DW),t}function Et(t){return Lt(ye(t),zW),t}const fI={};function jW(t){Le.global.console&&Le.global.console.error&&Le.global.console.error(t)}function qW(t){Le.global.console&&Le.global.console.log&&Le.global.console.log(t)}function $W(t,e){fI[t]=!0,e!==void 0&&jW(e)}function eN(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(fI[i]=!0);while(i!==0);for(i in fI)if(fI[i])return delete fI[i],parseInt(i,10);return 0}}const pI=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const g=new t.VertexAttrib(n);this.attribs[i]=g}this.maxAttrib=0};pI.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};pI.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const es=function(e){const n=this;this.gl=e,eN(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(s){return s===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const r=o.attribs[s];return r.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const r=o.attribs[s];return r.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(s,o){switch(s){case 34962:n.currentArrayBuffer=o;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=o;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(s,o){const I=n.currentVertexArrayObject.attribs[s];switch(o){case 34975:return I.buffer;case 34338:return I.enabled;case 34339:return I.size;case 34340:return I.stride;case 34341:return I.type;case 34922:return I.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(s,o,r,I,a,l){const C=n.currentVertexArrayObject;C.maxAttrib=Math.max(C.maxAttrib,s);const c=C.attribs[s];return c.buffer=n.currentArrayBuffer,c.size=o,c.type=r,c.normalized=I,c.stride=a,c.offset=l,c.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{qW("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};es.prototype.VERTEX_ARRAY_BINDING_OES=34229;es.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new pI(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};es.prototype.createVertexArrayOES=function(){const e=new pI(this);return this.vertexArrayObjects.push(e),e};es.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};es.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof pI&&e.hasBeenBound&&e.ext===this)};es.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){$W(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,g=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(g===s)return;(!g||s.elementArrayBuffer!==g.elementArrayBuffer)&&i.bindBuffer.call(n,34963,s.elementArrayBuffer);let o=this.currentArrayBuffer;const r=Math.max(g?g.maxAttrib:0,s.maxAttrib);for(let I=0;I<=r;I++){const a=s.attribs[I],l=g?g.attribs[I]:null;if((!g||a.enabled!==l.enabled)&&(a.enabled?i.enableVertexAttribArray.call(n,I):i.disableVertexAttribArray.call(n,I)),a.enabled){let C=!1;(!g||a.buffer!==l.buffer)&&(o!==a.buffer&&(i.bindBuffer.call(n,34962,a.buffer),o=a.buffer),C=!0),(C||a.cached!==l.cached)&&i.vertexAttribPointer.call(n,I,a.size,a.type,a.normalized,a.stride,a.offset)}}this.currentArrayBuffer!==o&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function tN(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const g=e.call(this)||[];return g.indexOf("OES_vertex_array_object")<0&&g.push("OES_vertex_array_object"),g};const n=t.getExtension;t.getExtension=function(g){const s=n.call(this,g);return s||(g!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new es(this)),this.__OESVertexArrayObject))}}const Hy="OES_element_index",ky="WEBGL_draw_buffers",nN="EXT_disjoint_timer_query",iN="EXT_disjoint_timer_query_webgl2",gN="EXT_texture_filter_anisotropic",Ky="WEBGL_debug_renderer_info",sN=35723,oN=4352,rN=36795,IN=34047,aN=37445,lN=37446,He=t=>ye(t)?void 0:0,CN={[3074]:t=>ye(t)?void 0:36064,[sN]:t=>ye(t)?void 0:oN,[35977]:He,[32937]:He,[rN]:(t,e)=>{const n=ye(t)?t.getExtension(iN):t.getExtension(nN);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[aN]:(t,e)=>{const n=t.getExtension(Ky);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[lN]:(t,e)=>{const n=t.getExtension(Ky);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[IN]:(t,e)=>{const n=t.luma.extensions[gN];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:He,[35071]:He,[37447]:He,[36063]:(t,e)=>{if(!ye(t)){const n=t.getExtension(ky);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:He,[35374]:He,[35377]:He,[34852]:t=>{if(!ye(t)){const e=t.getExtension(ky);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(Hy)?2147483647:65535,[33001]:t=>t.getExtension(Hy)?16777216:65535,[33e3]:t=>16777216,[37157]:He,[35373]:He,[35657]:He,[36183]:He,[37137]:He,[34045]:He,[35978]:He,[35979]:He,[35968]:He,[35376]:He,[35375]:He,[35659]:He,[37154]:He,[35371]:He,[35658]:He,[35076]:He,[35077]:He,[35380]:He};function cN(t,e,n){const i=CN[n],g=typeof i=="function"?i(t,e,n):i;return g!==void 0?g:e(n)}const AN="OES_vertex_array_object",Ly="ANGLE_instanced_arrays",dN="WEBGL_draw_buffers",uN="EXT_disjoint_timer_query",hN="EXT_texture_filter_anisotropic",mN="VertexArray requires WebGL2 or OES_vertex_array_object extension";function fN(t,e){return{webgl2:ye(t),ext:t.getExtension(e)}}const My={[AN]:{meta:{suffix:"OES"},createVertexArray:()=>{Lt(!1,mN)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[Ly]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){Lt(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[dN]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Lt(!1)}},[uN]:{meta:{suffix:"EXT"},createQuery:()=>{Lt(!1)},deleteQuery:()=>{Lt(!1)},beginQuery:()=>{Lt(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},ju={readBuffer:(t,e,n)=>{ye(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:g,ext:s}=fN(t,Ly);let o;switch(i){case 35069:o=g?void 0:!1;break;case 35070:o=!g&&!s?0:void 0;break}return o!==void 0?o:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!ye(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,g)=>{if(!ye(t))switch(g){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,g)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:g}=t.luma,s=g[hN];i=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:cN,hint(t,e,n,i){return e(n,i)}};function pN(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(tN(t),bN(t),vN(t,My),yN(t,{target:e,target2:t}),e.polyfilled=!0),t}const BN=typeof global!="undefined"?global:window;BN.polyfillContext=pN;function bN(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function yN(t,{target:e,target2:n}){Object.keys(ju).forEach(i=>{if(typeof ju[i]=="function"){const g=t[i]?t[i].bind(t):()=>{},s=ju[i].bind(null,t,g);e[i]=s,n[i]=s}})}function vN(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&GN(t,{extension:n,target:t.luma,target2:t})}function GN(t,{extension:e,target:n,target2:i}){const g=My[e];Lt(g);const{meta:s={}}=g,{suffix:o=""}=s,r=t.getExtension(e);for(const I of Object.keys(g)){const a=`${I}${o}`;let l=null;I==="meta"||typeof t[I]=="function"||(r&&typeof r[a]=="function"?l=(...C)=>r[a](...C):typeof g[I]=="function"&&(l=g[I].bind(n))),l&&(n[I]=l,i[I]=l)}}const qu={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},dg=(t,e,n)=>e?t.enable(n):t.disable(n),Py=(t,e,n)=>t.hint(n,e),gn=(t,e,n)=>t.pixelStorei(n,e),ZN=(t,e)=>{const n=ye(t)?36009:36160;return t.bindFramebuffer(n,e)},RN=(t,e)=>t.bindFramebuffer(36008,e);function BI(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const FN={[3042]:dg,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:dg,[2885]:(t,e)=>t.cullFace(e),[2929]:dg,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:dg,[35723]:Py,[36006]:ZN,[2886]:(t,e)=>t.frontFace(e),[33170]:Py,[2849]:(t,e)=>t.lineWidth(e),[32823]:dg,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:dg,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:dg,[3088]:(t,e)=>t.scissor(...e),[2960]:dg,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:gn,[3317]:gn,[37440]:gn,[37441]:gn,[37443]:gn,[3330]:gn,[3332]:gn,[3331]:gn,[36010]:RN,[3314]:gn,[32878]:gn,[3316]:gn,[3315]:gn,[32877]:gn,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=BI(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=BI(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=BI(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=BI(e)&&e.length===3?[...e,...e]:e;const[n,i,g,s,o,r]=e;t.stencilFuncSeparate(1028,n,i,g),t.stencilFuncSeparate(1029,s,o,r)},stencilOp:(t,e)=>{e=BI(e)&&e.length===3?[...e,...e]:e;const[n,i,g,s,o,r]=e;t.stencilOpSeparate(1028,n,i,g),t.stencilOpSeparate(1029,s,o,r)},viewport:(t,e)=>t.viewport(...e)};function it(t,e,n){return e[t]!==void 0?e[t]:n[t]}const SN={blendEquation:(t,e,n)=>t.blendEquationSeparate(it(32777,e,n),it(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(it(32969,e,n),it(32968,e,n),it(32971,e,n),it(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(it(32824,e,n),it(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(it(32938,e,n),it(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,it(2962,e,n),it(2967,e,n),it(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,it(34816,e,n),it(36003,e,n),it(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,it(2964,e,n),it(2965,e,n),it(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,it(34817,e,n),it(34818,e,n),it(34819,e,n))},Jy={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({[36006]:n,[36010]:n});case 36009:return t({[36006]:n});case 36008:return t({[36010]:n});default:return null}},blendColor:(t,e,n,i,g)=>t({[32773]:new Float32Array([e,n,i,g])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,n)=>t({[32777]:e,[34877]:n}),blendFunc:(t,e,n)=>t({[32969]:e,[32968]:n,[32971]:e,[32970]:n}),blendFuncSeparate:(t,e,n,i,g)=>t({[32969]:e,[32968]:n,[32971]:i,[32970]:g}),clearColor:(t,e,n,i,g)=>t({[3106]:new Float32Array([e,n,i,g])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,n,i,g)=>t({[3107]:[e,n,i,g]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,n)=>t({[2928]:new Float32Array([e,n])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,n)=>t({[32824]:e,[10752]:n}),sampleCoverage:(t,e,n)=>t({[32938]:e,[32939]:n}),scissor:(t,e,n,i,g)=>t({[3088]:new Int32Array([e,n,i,g])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({[2962]:e,[2967]:n,[2963]:i,[34816]:e,[36003]:n,[36004]:i}),stencilFuncSeparate:(t,e,n,i,g)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:g}),stencilOp:(t,e,n,i)=>t({[2964]:e,[2965]:n,[2966]:i,[34817]:e,[34818]:n,[34819]:i}),stencilOpSeparate:(t,e,n,i,g)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:g}),viewport:(t,e,n,i,g)=>t({[2978]:[e,n,i,g]})},ti=(t,e)=>t.isEnabled(e),Dy={[3042]:ti,[2884]:ti,[2929]:ti,[3024]:ti,[32823]:ti,[32926]:ti,[32928]:ti,[3089]:ti,[2960]:ti,[35977]:ti};function zy(t){for(const e in t)return!1;return!0}function VN(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let g=0;g<t.length;++g)if(t[g]!==e[g])return!1;return!0}return!1}function Oy(t,e){const n=t[e].bind(t);t[e]=function(...g){const s=g[0];return s in t.state.cache?t.state.enable?t.state.cache[s]:n(...g):n(...g)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function UN(t,e,n){const i=t[e].bind(t);t[e]=function(...s){const{valueChanged:o,oldValue:r}=n(t.state._updateCache,...s);return o&&i(...s),r},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function xN(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class WN{constructor(e,{copyState:n=!1,log:i=()=>{}}={}){this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?wN(e):Object.assign({},qu),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){Lt(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Zi(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const g=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in e){Lt(s!==void 0);const o=e[s],r=this.cache[s];VN(o,r)||(n=!0,i=r,g&&!(s in g)&&(g[s]=r),this.cache[s]=o)}return{valueChanged:n,oldValue:i}}}function jy(t,e={}){const{enable:n=!0,copyState:i}=e;if(Lt(i!==void 0),!t.state){const g=typeof global!="undefined"?global:window,{polyfillContext:s}=g;s&&s(t),t.state=new WN(t,{copyState:i}),xN(t);for(const o in Jy){const r=Jy[o];UN(t,o,r)}Oy(t,"getParameter"),Oy(t,"isEnabled")}return t.state.enable=n,t}function NN(t){t.state||jy(t,{copyState:!1}),t.state.push()}function qy(t){Lt(t.state),t.state.pop()}function Zi(t,e){if(Lt(Ol(t),"setParameters requires a WebGL context"),zy(e))return;const n={};for(const g in e){const s=Number(g),o=FN[g];o&&(typeof o=="string"?n[o]=!0:o(t,e[g],s))}const i=t.state&&t.state.cache;if(i)for(const g in n)SN[g](t,e,i)}function wN(t,e){if(e=e||qu,typeof e=="number"){const g=e,s=Dy[g];return s?s(t,g):t.getParameter(g)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const g of n){const s=Dy[g];i[g]=s?s(t,Number(g)):t.getParameter(Number(g))}return i}function TN(t){Zi(t,qu)}function Xn(t,e,n){if(zy(e))return n(t);const{nocatch:i=!0}=e;NN(t),Zi(t,e);let g;if(i)g=n(t),qy(t);else try{g=n(t)}finally{qy(t)}return g}function Co(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:n}=e.canvasSizeInfo;return n?t.drawingBufferWidth/n:1}return 1}function $u(t,e,n=!0){const i=Co(t),g=t.drawingBufferWidth,s=t.drawingBufferHeight;return QN(e,i,g,s,n)}function EN(t){const e=typeof window=="undefined"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function QN(t,e,n,i,g){const s=$y(t[0],e,n);let o=ev(t[1],e,i,g),r=$y(t[0]+1,e,n);const I=r===n-1?r:r-1;r=ev(t[1]+1,e,i,g);let a;return g?(r=r===0?r:r+1,a=o,o=r):a=r===i-1?r:r-1,{x:s,y:o,width:Math.max(I-s+1,1),height:Math.max(a-o+1,1)}}function $y(t,e,n){return Math.min(Math.round(t*e),n-1)}function ev(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const e0=Le.isBrowser(),XN=e0&&typeof document!="undefined",tv={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function nv(t={}){Lt(e0,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},tv,t);const{width:e,height:n}=t;function i(r){if(t.throwOnError)throw new Error(r);return console.error(r),null}t.onError=i;let g;const{canvas:s}=t,o=kN({canvas:s,width:e,height:n,onError:i});return g=HN(o,t),g?(g=t0(g,t),KN(g),g):null}function t0(t,e={}){if(!t||t._instrumented)return t;t._version=t._version||LN(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},tv,e);const{manageState:n,debug:i}=e;return n&&jy(t,{copyState:!1,log:(...g)=>se.log(1,...g)()}),e0&&i&&(Le.global.makeDebugContext?(t=Le.global.makeDebugContext(t,e),se.level=Math.max(se.level,1)):se.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function YN(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),g=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),s=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:g||e,renderer:s||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function _N(t,e={}){if(t.canvas){const i=EN(e.useDevicePixels);MN(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function HN(t,e){const{onError:n}=e;let i=null;const g=I=>i=I.statusMessage||i;t.addEventListener("webglcontextcreationerror",g,!1);const{webgl1:s=!0,webgl2:o=!0}=e;let r=null;return o&&(r=r||t.getContext("webgl2",e),r=r||t.getContext("experimental-webgl2",e)),s&&(r=r||t.getContext("webgl",e),r=r||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",g,!1),r?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),r):n(`Failed to create ${o&&!s?"WebGL2":"WebGL"} context: ${i||"Unknown error"}`)}function kN({canvas:t,width:e=800,height:n=600,onError:i}){let g;return typeof t=="string"?(XN&&document.readyState==="complete"||i(`createGLContext called on canvas '${t}' before page was loaded`),g=document.getElementById(t)):t?g=t:(g=document.createElement("canvas"),g.id="lumagl-canvas",g.style.width=Number.isFinite(e)?`${e}px`:"100%",g.style.height=Number.isFinite(n)?`${n}px`:"100%",document.body.insertBefore(g,document.body.firstChild)),g}function KN(t){const e=ye(t)?"WebGL2":"WebGL1",n=YN(t),i=n?`(${n.vendor},${n.renderer})`:"",g=t.debug?" debug":"";se.info(1,`${e}${g} context ${i}`)()}function LN(t){return typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext?2:1}function MN(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,g="height"in n?n.height:t.canvas.clientHeight;(!i||!g)&&(se.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,g=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const s=t.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==g||s.devicePixelRatio!==e){let o=e;const r=Math.floor(i*o),I=Math.floor(g*o);t.canvas.width=r,t.canvas.height=I,(t.drawingBufferWidth!==r||t.drawingBufferHeight!==I)&&(se.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/g),t.canvas.width=Math.floor(i*o),t.canvas.height=Math.floor(g*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:g,devicePixelRatio:e})}}const bI="8.5.10",PN="set luma.log.level=1 (or higher) to trace rendering";class JN{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Kl({id:e})),this.stats.get(e)}}const ts=new JN;if(Le.global.luma&&Le.global.luma.VERSION!==bI)throw new Error(`luma.gl - multiple VERSIONs detected: ${Le.global.luma.VERSION} vs ${bI}`);Le.global.luma||(Le.isBrowser()&&se.log(1,`luma.gl ${bI} - ${PN}`)(),Le.global.luma=Le.global.luma||{VERSION:bI,version:bI,log:se,stats:ts,globals:{modules:{},nodeIO:{}}});Le.global.luma;function DN(t){return typeof window!="undefined"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function zN(t){return typeof window!="undefined"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function O(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function n0(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return O(i!==void 0,`Accessing undefined constant GL.${e}`),i}function ug(t,e){e=Number(e);for(const n in t)if(t[n]===e)return`GL.${n}`;return String(e)}const i0={};function hg(t="id"){i0[t]=i0[t]||1;const e=i0[t]++;return`${t}-${e}`}function iv(t){return O(typeof t=="number","Input must be a number"),t&&(t&t-1)==0}function co(t){let e=!0;for(const n in t){e=!1;break}return e}function gv(t,e,n,i){const g=`See luma.gl ${n} Upgrade Guide at https://luma.gl/docs/upgrade-guide`,s=Object.getPrototypeOf(t);i.forEach(o=>{s.methodName||(s[o]=()=>{throw se.removed(`Calling removed method ${e}.${o}: `,g)(),new Error(o)})})}const Ao="Resource subclass must define virtual methods";class Ri{constructor(e,n={}){jl(e);const{id:i,userData:g={}}=n;this.gl=e,this.gl2=e,this.id=i||hg(this.constructor.name),this.userData=g,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return`${this.constructor.name}(${this.id})`}get handle(){return this._handle}delete({deleteChildren:e=!1}={}){const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(e=this.handle){if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e,n={}){e=n0(this.gl,e),O(e);const g=(this.constructor.PARAMETERS||{})[e];if(g){const s=ye(this.gl);if(!((!("webgl2"in g)||s)&&(!("extension"in g)||this.gl.getExtension(g.extension)))){const r=g.webgl1,I="webgl2"in g?g.webgl2:g.webgl1;return s?I:r}}return this._getParameter(e,n)}getParameters(e={}){const{parameters:n,keys:i}=e,g=this.constructor.PARAMETERS||{},s=ye(this.gl),o={},r=n||Object.keys(g);for(const I of r){const a=g[I];if(a&&(!("webgl2"in a)||s)&&(!("extension"in a)||this.gl.getExtension(a.extension))){const C=i?ug(this.gl,I):I;o[C]=this.getParameter(I,e),i&&a.type==="GLenum"&&(o[C]=ug(this.gl,o[C]))}}return o}setParameter(e,n){e=n0(this.gl,e),O(e);const g=(this.constructor.PARAMETERS||{})[e];if(g){const s=ye(this.gl);if(!((!("webgl2"in g)||s)&&(!("extension"in g)||this.gl.getExtension(g.extension))))throw new Error("Parameter not available on this platform");g.type==="GLenum"&&(n=n0(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return gv(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(Ao)}_deleteHandle(){throw new Error(Ao)}_bindHandle(e){throw new Error(Ao)}_getOptsFromHandle(){throw new Error(Ao)}_getParameter(e,n){throw new Error(Ao)}_setParameter(e,n){throw new Error(Ao)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this.constructor.name,n=ts.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get(`${e}s Created`).incrementCount(),n.get(`${e}s Active`).incrementCount()}_removeStats(){const e=this.constructor.name;ts.get("Resource Counts").get(`${e}s Active`).decrementCount()}_trackAllocatedMemory(e,n=this.constructor.name){const i=ts.get("Memory Usage");i.get("GPU Memory").addCount(e),i.get(`${n} Memory`).addCount(e),this.byteLength=e}_trackDeallocatedMemory(e=this.constructor.name){const n=ts.get("Memory Usage");n.get("GPU Memory").subtractCount(this.byteLength),n.get(`${e} Memory`).subtractCount(this.byteLength),this.byteLength=0}}const ON="Failed to deduce GL constant from typed array";function g0(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(ON)}}function yI(t,{clamped:e=!0}={}){switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function jN({data:t,width:e,height:n,bytesPerPixel:i=4,temp:g}){const s=e*i;g=g||new Uint8Array(s);for(let o=0;o<n/2;++o){const r=o*s,I=(n-o-1)*s;g.set(t.subarray(r,r+s)),t.copyWithin(r,I,I+s),t.set(g,I)}}function qN({data:t,width:e,height:n}){const i=Math.round(e/2),g=Math.round(n/2),s=new Uint8Array(i*g*4);for(let o=0;o<g;o++)for(let r=0;r<i;r++)for(let I=0;I<4;I++)s[(o*i+r)*4+I]=t[(o*2*e+r*2)*4+I];return{data:s,width:i,height:g}}function s0(t,e,n){const{removedProps:i={},deprecatedProps:g={},replacedProps:s={}}=n;for(const r in i)if(r in e){const a=i[r]?`${t}.${i[r]}`:"N/A";se.removed(`${t}.${r}`,a)()}for(const r in g)if(r in e){const I=g[r];se.deprecated(`${t}.${r}`,`${t}.${I}`)()}let o=null;for(const r in s)if(r in e){const I=s[r];se.deprecated(`${t}.${r}`,`${t}.${I}`)(),o=o||Object.assign({},e),o[I]=e[r],delete o[r]}return o||e}const $N={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},ew={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class sn{static getBytesPerElement(e){return yI(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return O(e.size),yI(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new sn(...[$N,...e])}constructor(...e){e.forEach(n=>this._assign(n)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return sn.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return sn.getBytesPerVertex(this)}_assign(e={}){return e=s0("Accessor",e,ew),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const sv=10,ov={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},tw={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:ov},nw={removedProps:ov};class Te extends Ri{constructor(e,n={}){super(e,n);this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(e=this.accessor){return Math.round(this.byteLength/sn.getBytesPerElement(e))}getVertexCount(e=this.accessor){return Math.round(this.byteLength/sn.getBytesPerVertex(e))}initialize(e={}){return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=s0("Buffer",e,tw),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=s0("Buffer",e,nw),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new sn(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:g=0}=e,s=e.byteLength||e.length;O(n);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),g!==0||s!==void 0?(Et(this.gl),this.gl.bufferSubData(this.target,i,n,g,s)):this.gl.bufferSubData(o,i,n),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(n),this}copyData({sourceBuffer:e,readOffset:n=0,writeOffset:i=0,size:g}){const{gl:s}=this;return Et(s),s.bindBuffer(36662,e.handle),s.bindBuffer(36663,this.handle),s.copyBufferSubData(36662,36663,n,i,g),s.bindBuffer(36662,null),s.bindBuffer(36663,null),this.debugData=null,this}getData({dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:g=0}={}){Et(this.gl);const s=yI(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(n),r=i;let I,a;e?(a=e.length,I=a-r):(I=Math.min(o,g||o),a=r+I);const l=Math.min(o,I);return g=g||l,O(g<=l),e=e||new s(a),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,g),this.gl.bindBuffer(36662,null),e}bind({target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:g}={}){return e===35345||e===35982?g!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,g):(O(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind({target:e=this.target,index:n=this.accessor&&this.accessor.index}={}){return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(sv,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e,n=0,i=e.byteLength+n){O(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const g=this._getTarget();this.gl.bindBuffer(g,this.handle),this.gl.bufferData(g,i,this.usage),this.gl.bufferSubData(g,n,e),this.gl.bindBuffer(g,null),this.debugData=e.slice(0,sv),this.bytesUsed=i,this._trackAllocatedMemory(i);const s=g0(e);return O(s),this.setAccessor(new sn(this.accessor,{type:s})),this}_setByteLength(e,n=this.usage){O(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const g=this._getTarget();return this.gl.bindBuffer(g,this.handle),this.gl.bufferData(g,i,n),this.gl.bindBuffer(g,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=yI(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new sn(this.accessor,{type:g0(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return se.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return se.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return se.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return se.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new sn(this.accessor,e),this}}const o0={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},rv={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},Iv={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function iw(t,e){const n=o0[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=ye(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function gw(t,e){const n=o0[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const sw=[9729,9728],av=Le.global.WebGLBuffer||function(){};class ns extends Ri{static isSupported(e,n={}){const{format:i,linearFiltering:g}=n;let s=!0;return i&&(s=s&&iw(e,i),s=s&&(!g||gw(e,i))),s}constructor(e,n){const{id:i=hg("texture"),handle:g,target:s}=n;super(e,{id:i,handle:g});this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return`Texture(${this.id},${this.width}x${this.height})`}initialize(e={}){let n=e.data;if(n instanceof Promise)return n.then(f=>this.initialize(Object.assign({},e,{pixels:f,data:f}))),this;const i=typeof HTMLVideoElement!="undefined"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:g=null,format:s=6408,border:o=0,recreate:r=!1,parameters:I={},pixelStore:a={},textureUnit:l=void 0}=e;n||(n=g);let{width:C,height:c,dataFormat:A,type:d,compressed:m=!1,mipmaps:u=!0}=e;const{depth:h=0}=e;return{width:C,height:c,compressed:m,dataFormat:A,type:d}=this._deduceParameters({format:s,type:d,dataFormat:A,compressed:m,data:n,width:C,height:c}),this.width=C,this.height=c,this.depth=h,this.format=s,this.type=d,this.dataFormat=A,this.border=o,this.textureUnit=l,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),u&&this._isNPOT()&&(se.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),u=!1,this._updateForNPOT(I)),this.mipmaps=u,this.setImageData({data:n,width:C,height:c,depth:h,format:s,type:d,dataFormat:A,border:o,mipmaps:u,parameters:a,compressed:m}),u&&this.generateMipmap(),this.setParameters(I),r&&(this.data=n),i&&(this._video={video:n,parameters:I,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize({height:e,width:n,mipmaps:i=!1}){return n!==this.width||e!==this.height?this.initialize({width:n,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(e={}){return this._isNPOT()?(se.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Xn(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:g=0,format:s=this.format,border:o=this.border,offset:r=0,parameters:I={}}=e;let{data:a=null,type:l=this.type,width:C=this.width,height:c=this.height,dataFormat:A=this.dataFormat,compressed:d=!1}=e;a||(a=i),{type:l,dataFormat:A,compressed:d,width:C,height:c}=this._deduceParameters({format:s,type:l,dataFormat:A,compressed:d,data:a,width:C,height:c});const{gl:m}=this;m.bindTexture(this.target,this.handle);let u=null;({data:a,dataType:u}=this._getDataType({data:a,compressed:d}));let h;if(Xn(this.gl,I,()=>{switch(u){case"null":m.texImage2D(n,g,s,C,c,o,A,l,a);break;case"typed-array":m.texImage2D(n,g,s,C,c,o,A,l,a,r);break;case"buffer":h=Et(m),h.bindBuffer(35052,a.handle||a),h.texImage2D(n,g,s,C,c,o,A,l,r),h.bindBuffer(35052,null);break;case"browser-object":ye(m)?m.texImage2D(n,g,s,C,c,o,A,l,a):m.texImage2D(n,g,s,A,l,a);break;case"compressed":for(const[f,p]of a.entries())m.compressedTexImage2D(n,f,p.format,p.width,p.height,o,p.data);break;default:O(!1,"Unknown image data type")}}),a&&a.byteLength)this._trackAllocatedMemory(a.byteLength,"Texture");else{const f=rv[this.dataFormat]||4,p=Iv[this.type]||1;this._trackAllocatedMemory(this.width*this.height*f*p,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:n=null,data:i=null,x:g=0,y:s=0,width:o=this.width,height:r=this.height,level:I=0,format:a=this.format,type:l=this.type,dataFormat:C=this.dataFormat,compressed:c=!1,offset:A=0,border:d=this.border,parameters:m={}}){if({type:l,dataFormat:C,compressed:c,width:o,height:r}=this._deduceParameters({format:a,type:l,dataFormat:C,compressed:c,data:i,width:o,height:r}),O(this.depth===0,"texSubImage not supported for 3D textures"),i||(i=n),i&&i.data){const u=i;i=u.data,o=u.shape[0],r=u.shape[1]}i instanceof Te&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Xn(this.gl,m,()=>{if(c)this.gl.compressedTexSubImage2D(e,I,g,s,o,r,a,i);else if(i===null)this.gl.texSubImage2D(e,I,g,s,o,r,C,l,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(e,I,g,s,o,r,C,l,i,A);else if(i instanceof av){const u=Et(this.gl);u.bindBuffer(35052,i),u.texSubImage2D(e,I,g,s,o,r,C,l,A),u.bindBuffer(35052,null)}else ye(this.gl)?Et(this.gl).texSubImage2D(e,I,g,s,o,r,C,l,i):this.gl.texSubImage2D(e,I,g,s,C,l,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return se.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e=this.textureUnit){const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType({data:e,compressed:n=!1}){return n?{data:e,dataType:"compressed"}:e===null?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof Te?{data:e.handle,dataType:"buffer"}:e instanceof av?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:g,height:s,dataFormat:o,type:r,compressed:I}=e;const a=o0[n];return o=o||a&&a.dataFormat,r=r||a&&a.types[0],I=I||a&&a.compressed,{width:g,height:s}=this._deduceImageSize(i,g,s),{dataFormat:o,type:r,compressed:I,width:g,height:s,format:n,data:i}}_deduceImageSize(e,n,i){let g;return typeof ImageData!="undefined"&&e instanceof ImageData?g={width:e.width,height:e.height}:typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement?g={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement?g={width:e.width,height:e.height}:typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap?g={width:e.width,height:e.height}:typeof HTMLVideoElement!="undefined"&&e instanceof HTMLVideoElement?g={width:e.videoWidth,height:e.videoHeight}:e?g={width:n,height:i}:g={width:n>=0?n:1,height:i>=0?i:1},O(g,"Could not deduced texture size"),O(n===void 0||g.width===n,"Deduced texture width does not match supplied width"),O(i===void 0||g.height===i,"Deduced texture height does not match supplied height"),g}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:O(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return ye(this.gl)||!this.width||!this.height?!1:!iv(this.width)||!iv(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:sw.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let ow="";function rw(t,e){return O(typeof t=="string"),t=ow+t,new Promise((n,i)=>{try{const g=new Image;g.onload=()=>n(g),g.onerror=()=>i(new Error(`Could not load image ${t}.`)),g.crossOrigin=e&&e.crossOrigin||"anonymous",g.src=t}catch(g){i(g)}})}class on extends ns{static isSupported(e,n){return ns.isSupported(e,n)}constructor(e,n={}){jl(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:rw(n.data)}));super(e,Object.assign({},n,{target:3553}));this.initialize(n),Object.seal(this)}}const r0=[34069,34070,34071,34072,34073,34074];class lv extends ns{constructor(e,n={}){jl(e);super(e,Object.assign({},n,{target:34067}));this.initialize(n),Object.seal(this)}initialize(e={}){const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage({face:e,data:n,x:i=0,y:g=0,mipmapLevel:s=0}){return this._subImage({target:e,data:n,x:i,y:g,mipmapLevel:s})}async setCubeMapImageData({width:e,height:n,pixels:i,data:g,border:s=0,format:o=6408,type:r=5121}){const{gl:I}=this,a=i||g,l=await Promise.all(r0.map(C=>{const c=a[C];return Promise.all(Array.isArray(c)?c:[c])}));this.bind(),r0.forEach((C,c)=>{l[c].length>1&&this.opts.mipmaps!==!1&&se.warn(`${this.id} has mipmap and multiple LODs.`)(),l[c].forEach((A,d)=>{e&&n?I.texImage2D(C,d,o,e,n,s,o,r,A):I.texImage2D(C,d,o,o,r,A)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:g,pixels:s,data:o,border:r=0,format:I=6408,type:a=5121}=e,{gl:l}=this,C=s||o;return this.bind(),C instanceof Promise?C.then(c=>this.setImageDataForFace(Object.assign({},e,{face:n,data:c,pixels:c}))):this.width||this.height?l.texImage2D(n,0,I,i,g,r,I,a,C):l.texImage2D(n,0,I,I,a,C),this}}lv.FACES=r0;class Cv extends ns{static isSupported(e){return ye(e)}constructor(e,n={}){Et(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1});super(e,n);this.initialize(n),Object.seal(this)}setImageData({level:e=0,dataFormat:n=6408,width:i,height:g,depth:s=1,border:o=0,format:r,type:I=5121,offset:a=0,data:l,parameters:C={}}){if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Xn(this.gl,C,()=>{ArrayBuffer.isView(l)&&this.gl.texImage3D(this.target,e,n,i,g,s,o,r,I,l),l instanceof Te&&(this.gl.bindBuffer(35052,l.handle),this.gl.texImage3D(this.target,e,n,i,g,s,o,r,I,a))}),l&&l.byteLength)this._trackAllocatedMemory(l.byteLength,"Texture");else{const c=rv[this.dataFormat]||4,A=Iv[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*c*A,"Texture")}return this.loaded=!0,this}}const is="EXT_color_buffer_float";var cv={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:is,bpp:2},[33327]:{gl2:is,bpp:4},[34842]:{gl2:is,bpp:8},[33326]:{gl2:is,bpp:4},[33328]:{gl2:is,bpp:8},[34836]:{gl2:is,bpp:16},[35898]:{gl2:is,bpp:4}};function Iw(t,e,n){const i=n[e];if(!i)return!1;const g=ye(t)&&i.gl2||i.gl1;return typeof g=="string"?t.getExtension(g):g}class uo extends Ri{static isSupported(e,{format:n}={format:null}){return!n||Iw(e,n,cv)}static getSamplesForFormat(e,{format:n}){return e.getInternalformatParameter(36161,n,32937)}constructor(e,n={}){super(e,n);this.initialize(n),Object.seal(this)}initialize({format:e,width:n=1,height:i=1,samples:g=0}){return O(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),g!==0&&ye(this.gl)?this.gl.renderbufferStorageMultisample(36161,g,e,n,i):this.gl.renderbufferStorage(36161,e,n,i),this.format=e,this.width=n,this.height=i,this.samples=g,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*cv[this.format].bpp),this}resize({width:e,height:n}){return e!==this.width||n!==this.height?this.initialize({width:e,height:n,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const aw=256,lw=1024,Cw=16384,Av=6144,dv=6145,uv=6146,hv=34041,mv="clear: bad arguments";function I0(t,{framebuffer:e=null,color:n=null,depth:i=null,stencil:g=null}={}){const s={};e&&(s.framebuffer=e);let o=0;n&&(o|=Cw,n!==!0&&(s.clearColor=n)),i&&(o|=aw,i!==!0&&(s.clearDepth=i)),g&&(o|=lw,i!==!0&&(s.clearStencil=i)),O(o!==0,mv),Xn(t,s,()=>{t.clear(o)})}function cw(t,{framebuffer:e=null,buffer:n=Av,drawBuffer:i=0,value:g=[0,0,0,0]}={}){Et(t),Xn(t,{framebuffer:e},()=>{switch(n){case Av:switch(g.constructor){case Int32Array:t.clearBufferiv(n,i,g);break;case Uint32Array:t.clearBufferuiv(n,i,g);break;case Float32Array:default:t.clearBufferfv(n,i,g)}break;case dv:t.clearBufferfv(dv,0,[g]);break;case uv:t.clearBufferiv(uv,0,[g]);break;case hv:const[s,o]=g;t.clearBufferfi(hv,0,s,o);break;default:O(!1,mv)}})}function Aw(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return O(!1),0}}function ql(t,e={}){const{sourceX:n=0,sourceY:i=0,sourceFormat:g=6408}=e;let{sourceAttachment:s=36064,target:o=null,sourceWidth:r,sourceHeight:I,sourceType:a}=e;const{framebuffer:l,deleteFramebuffer:C}=pv(t);O(l);const{gl:c,handle:A,attachments:d}=l;r=r||l.width,I=I||l.height,s===36064&&A===null&&(s=1028),O(d[s]),a=a||d[s].type,o=uw(o,a,g,r,I),a=a||g0(o);const m=c.bindFramebuffer(36160,A);return c.readPixels(n,i,r,I,g,a,o),c.bindFramebuffer(36160,m||null),C&&l.delete(),o}function fv(t,{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}={}){let i=ql(t,{sourceAttachment:e}),{width:g,height:s}=t;for(;s>n;)({data:i,width:g,height:s}=qN({data:i,width:g,height:s}));jN({data:i,width:g,height:s});const o=document.createElement("canvas");o.width=g,o.height=s;const r=o.getContext("2d"),I=r.createImageData(g,s);return I.data.set(i),r.putImageData(I,0,0),o.toDataURL()}function dw(t,e,n={}){const{sourceX:i=0,sourceY:g=0,targetMipmaplevel:s=0,targetInternalFormat:o=6408}=n;let{targetX:r,targetY:I,targetZ:a,width:l,height:C}=n;const{framebuffer:c,deleteFramebuffer:A}=pv(t);O(c);const{gl:d,handle:m}=c,u=typeof r!="undefined"||typeof I!="undefined"||typeof a!="undefined";r=r||0,I=I||0,a=a||0;const h=d.bindFramebuffer(36160,m);O(e);let f=null;if(e instanceof ns&&(f=e,l=Number.isFinite(l)?l:f.width,C=Number.isFinite(C)?C:f.height,f.bind(0),e=f.target),!u)d.copyTexImage2D(e,s,o,i,g,l,C,0);else switch(e){case 3553:case 34067:d.copyTexSubImage2D(e,s,r,I,i,g,l,C);break;case 35866:case 32879:Et(d).copyTexSubImage3D(e,s,r,I,a,i,g,l,C);break}return f&&f.unbind(),d.bindFramebuffer(36160,h||null),A&&c.delete(),f}function pv(t){return t instanceof Ct?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:vw(t),deleteFramebuffer:!0}}function uw(t,e,n,i,g){if(t)return t;e=e||5121;const s=yI(e,{clamped:!1}),o=Aw(n);return new s(i*g*o)}const Ee={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function hw(t){const e=new on(t,{format:6408,type:5126,dataFormat:6408}),n=new Ct(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}var Bv={[Ee.WEBGL2]:[!1,!0],[Ee.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Ee.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Ee.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Ee.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Ee.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Ee.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Ee.FLOAT_BLEND]:["EXT_float_blend"],[Ee.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Ee.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Ee.TEXTURE_FLOAT]:["OES_texture_float",!0],[Ee.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Ee.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Ee.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Ee.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Ee.COLOR_ATTACHMENT_RGBA32F]:[hw,"EXT_color_buffer_float"],[Ee.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Ee.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Ee.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Ee.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Ee.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Ee.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]};const mw=2;function a0(t,e){return l0(t,e)}function l0(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>bv(t,n))}function fw(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in Bv)t.luma.caps[e]===void 0&&(t.luma.caps[e]=bv(t,e));return t.luma.caps}function bv(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=pw(t,e)),t.luma.caps[e]||se.log(mw,`Feature: ${e} not supported`)(),t.luma.caps[e]}function pw(t,e){const n=Bv[e];O(n,e);let i;const g=ye(t)&&n[1]||n[0];if(typeof g=="function")i=g(t);else if(Array.isArray(g)){i=!0;for(const s of g)i=i&&Boolean(t.getExtension(s))}else typeof g=="string"?i=Boolean(t.getExtension(g)):typeof g=="boolean"?i=g:O(!1);return i}const yv="Multiple render targets not supported";class Ct extends Ri{static isSupported(e,n={}){const{colorBufferFloat:i,colorBufferHalfFloat:g}=n;let s=!0;return i&&(s=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),g&&(s=s&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Ct(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Et(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Et(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e,n={}){super(e,n);this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize({width:e=1,height:n=1,attachments:i=null,color:g=!0,depth:s=!0,stencil:o=!1,check:r=!0,readBuffer:I=void 0,drawBuffers:a=void 0}){if(O(e>=0&&n>=0,"Width and height need to be integers"),this.width=e,this.height=n,i)for(const l in i){const C=i[l];(Array.isArray(C)?C[0]:C).resize({width:e,height:n})}else i=this._createDefaultAttachments(g,s,o,e,n);this.update({clearAttachments:!0,attachments:i,readBuffer:I,drawBuffers:a}),i&&r&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update({attachments:e={},readBuffer:n,drawBuffers:i,clearAttachments:g=!1,resizeAttachments:s=!0}){this.attach(e,{clearAttachments:g,resizeAttachments:s});const{gl:o}=this,r=o.bindFramebuffer(36160,this.handle);return n&&this._setReadBuffer(n),i&&this._setDrawBuffers(i),o.bindFramebuffer(36160,r||null),this}resize(e={}){let{width:n,height:i}=e;if(this.handle===null)return O(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&se.log(2,`Resizing framebuffer ${this.id} to ${n}x${i}`)();for(const g in this.attachments)this.attachments[g].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e,{clearAttachments:n=!1,resizeAttachments:i=!0}={}){const g={};n&&Object.keys(this.attachments).forEach(o=>{g[o]=null}),Object.assign(g,e);const s=this.gl.bindFramebuffer(36160,this.handle);for(const o in g){O(o!==void 0,"Misspelled framebuffer binding point?");const r=Number(o),I=g[r];let a=I;if(!a)this._unattach(r);else if(a instanceof uo)this._attachRenderbuffer({attachment:r,renderbuffer:a});else if(Array.isArray(I)){const[l,C=0,c=0]=I;a=l,this._attachTexture({attachment:r,texture:l,layer:C,level:c})}else this._attachTexture({attachment:r,texture:a,layer:0,level:0});i&&a&&a.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(o=>!this.attachments[o]).forEach(o=>{delete this.attachments[o]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(bw(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(e={}){const{color:n,depth:i,stencil:g,drawBuffers:s=[]}=e,o=this.gl.bindFramebuffer(36160,this.handle);return(n||i||g)&&I0(this.gl,{color:n,depth:i,stencil:g}),s.forEach((r,I)=>{cw(this.gl,{drawBuffer:I,value:r})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(e={}){return se.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(e={}){return se.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(e={}){return se.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(e={}){return se.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(e={}){return se.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(e={}){return se.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate({attachments:e=[],x:n=0,y:i=0,width:g,height:s}){const o=Et(this.gl),r=o.bindFramebuffer(36008,this.handle);return n===0&&i===0&&g===void 0&&s===void 0?o.invalidateFramebuffer(36008,e):o.invalidateFramebuffer(36008,e,n,i,g,s),o.bindFramebuffer(36008,r),this}getAttachmentParameter(e,n,i){let g=this._getAttachmentParameterFallback(n);return g===null&&(this.gl.bindFramebuffer(36160,this.handle),g=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&g>1e3&&(g=ug(this.gl,g)),g}getAttachmentParameters(e=36064,n,i=this.constructor.ATTACHMENT_PARAMETERS||[]){const g={};for(const s of i){const o=n?ug(this.gl,s):s;g[o]=this.getAttachmentParameter(e,s,n)}return g}getParameters(e=!0){const n=Object.keys(this.attachments),i={};for(const g of n){const s=Number(g),o=e?ug(this.gl,s):s;i[o]=this.getAttachmentParameters(s,e)}return i}show(){return typeof window!="undefined"&&window.open(fv(this),"luma-debug-texture"),this}log(e=0,n=""){if(e>se.level||typeof window=="undefined")return this;n=n||`Framebuffer ${this.id}`;const i=fv(this,{targetMaxHeight:100});return se.image({logLevel:e,message:n,image:i},n)(),this}bind({target:e=36160}={}){return this.gl.bindFramebuffer(e,this.handle),this}unbind({target:e=36160}={}){return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,g,s){let o=null;return e&&(o=o||{},o[36064]=new on(this.gl,{id:`${this.id}-color0`,pixels:null,format:6408,type:5121,width:g,height:s,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(o[36064])),n&&i?(o=o||{},o[33306]=new uo(this.gl,{id:`${this.id}-depth-stencil`,format:35056,width:g,height:111}),this.ownResources.push(o[33306])):n?(o=o||{},o[36096]=new uo(this.gl,{id:`${this.id}-depth`,format:33189,width:g,height:s}),this.ownResources.push(o[36096])):i&&O(!1),o}_unattach(e){const n=this.attachments[e];!n||(n instanceof uo?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer({attachment:e=36064,renderbuffer:n}){const{gl:i}=this;i.framebufferRenderbuffer(36160,e,36161,n.handle),this.attachments[e]=n}_attachTexture({attachment:e=36064,texture:n,layer:i,level:g}){const{gl:s}=this;switch(s.bindTexture(n.target,n.handle),n.target){case 35866:case 32879:Et(s).framebufferTextureLayer(36160,e,n.target,g,i);break;case 34067:const r=Bw(i);s.framebufferTexture2D(36160,e,r,n.handle,g);break;case 3553:s.framebufferTexture2D(36160,e,3553,n.handle,g);break;default:O(!1,"Illegal texture type")}s.bindTexture(n.target,null),this.attachments[e]=n}_setReadBuffer(e){const n=OW(this.gl);n?n.readBuffer(e):O(e===36064||e===1029,yv),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=Et(n);if(i)i.drawBuffers(e);else{const g=n.getExtension("WEBGL_draw_buffers");g?g.drawBuffersWEBGL(e):O(e.length===1&&(e[0]===36064||e[0]===1029),yv)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=fw(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function Bw(t){return t<34069?t+34069:t}function bw(t){return(Ct.STATUS||{})[t]||`Framebuffer error ${t}`}const yw=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Ct.ATTACHMENT_PARAMETERS=yw;function vv(t,e){O(t instanceof on||t instanceof lv||t instanceof Cv);const n=t.constructor,{gl:i,width:g,height:s,format:o,type:r,dataFormat:I,border:a,mipmaps:l}=t,C=Object.assign({width:g,height:s,format:o,type:r,dataFormat:I,border:a,mipmaps:l},e);return new n(i,C)}function vw(t,e){const{gl:n,width:i,height:g,id:s}=t;return new Ct(n,Object.assign({},e,{id:`framebuffer-for-${s}`,width:i,height:g,attachments:{[36064]:t}}))}function $l(t,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const Gw=35632,Zw=35633;function Rw(t){switch(t){case Gw:return"fragment";case Zw:return"vertex";default:return"unknown type"}}function Fw(t,e,n,i){const g=t.split(/\r?\n/),s={},o={},r=i||$l(e)||"(unnamed)",I=`${Rw(n)} shader ${r}`;for(let l=0;l<g.length;l++){const C=g[l];if(C.length<=1)continue;const c=C.split(":"),A=c[0],d=parseInt(c[2],10);if(isNaN(d))throw new Error(`GLSL compilation error in ${I}: ${t}`);A!=="WARNING"?s[d]=C:o[d]=C}const a=Sw(e);return{shaderName:I,errors:Gv(s,a),warnings:Gv(o,a)}}function Gv(t,e){let n="";for(let i=0;i<e.length;i++){const g=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+=`${g}
`,t[i+1])){const s=t[i+1],o=s.split(":",3),r=o[0],I=parseInt(o[1],10)||0,a=s.substring(o.join(":").length+1).trim();n+=Zv(`^^^ ${r}: ${a}

`,I)}}return n}function Sw(t,e=1,n=": "){const i=t.split(/\r?\n/),g=String(i.length+e-1).length;return i.map((s,o)=>{const r=String(o+e),I=r.length;return Zv(r,g-I)+n+s})}function Zv(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return`${n}${t}`}function Rv(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const Vw="Shader: GLSL source code must be a JavaScript string";class vI extends Ri{static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return O(!1),"unknown"}}constructor(e,n){jl(e),O(typeof n.source=="string",Vw);const i=$l(n.source,null)||n.id||hg(`unnamed ${vI.getTypeName(n.shaderType)}`);super(e,{id:i});this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize({source:e}){const n=$l(e,null);n&&(this.id=hg(n)),this._compile(e)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return`${vI.getTypeName(this.shaderType)}:${this.id}`}getName(){return $l(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(e=this.source){if(e.startsWith("#version ")||(e=`#version 100
${e}`),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:g,errors:s,warnings:o}=Fw(i,this.source,this.shaderType,this.id);throw se.error(`GLSL compilation errors in ${g}
${s}`)(),se.warn(`GLSL compilation warnings in ${g}
${o}`)(),new Error(`GLSL compilation errors in ${g}`)}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class C0 extends vI{constructor(e,n){typeof n=="string"&&(n={source:n});super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class c0 extends vI{constructor(e,n){typeof n=="string"&&(n={source:n});super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const Uw={[5126]:Me.bind(null,"uniform1fv",rn,1,Qt),[35664]:Me.bind(null,"uniform2fv",rn,2,Qt),[35665]:Me.bind(null,"uniform3fv",rn,3,Qt),[35666]:Me.bind(null,"uniform4fv",rn,4,Qt),[5124]:Me.bind(null,"uniform1iv",mg,1,Qt),[35667]:Me.bind(null,"uniform2iv",mg,2,Qt),[35668]:Me.bind(null,"uniform3iv",mg,3,Qt),[35669]:Me.bind(null,"uniform4iv",mg,4,Qt),[35670]:Me.bind(null,"uniform1iv",mg,1,Qt),[35671]:Me.bind(null,"uniform2iv",mg,2,Qt),[35672]:Me.bind(null,"uniform3iv",mg,3,Qt),[35673]:Me.bind(null,"uniform4iv",mg,4,Qt),[35674]:Me.bind(null,"uniformMatrix2fv",rn,4,Fi),[35675]:Me.bind(null,"uniformMatrix3fv",rn,9,Fi),[35676]:Me.bind(null,"uniformMatrix4fv",rn,16,Fi),[35678]:Rt,[35680]:Rt,[5125]:Me.bind(null,"uniform1uiv",eC,1,Qt),[36294]:Me.bind(null,"uniform2uiv",eC,2,Qt),[36295]:Me.bind(null,"uniform3uiv",eC,3,Qt),[36296]:Me.bind(null,"uniform4uiv",eC,4,Qt),[35685]:Me.bind(null,"uniformMatrix2x3fv",rn,6,Fi),[35686]:Me.bind(null,"uniformMatrix2x4fv",rn,8,Fi),[35687]:Me.bind(null,"uniformMatrix3x2fv",rn,6,Fi),[35688]:Me.bind(null,"uniformMatrix3x4fv",rn,12,Fi),[35689]:Me.bind(null,"uniformMatrix4x2fv",rn,8,Fi),[35690]:Me.bind(null,"uniformMatrix4x3fv",rn,12,Fi),[35678]:Rt,[35680]:Rt,[35679]:Rt,[35682]:Rt,[36289]:Rt,[36292]:Rt,[36293]:Rt,[36298]:Rt,[36299]:Rt,[36300]:Rt,[36303]:Rt,[36306]:Rt,[36307]:Rt,[36308]:Rt,[36311]:Rt},xw={},Ww={},Nw={},Fv=[0];function A0(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(Fv[0]=t,t=Fv);const g=t.length;if(g%e&&se.warn(`Uniform size should be multiples of ${e}`,t)(),t instanceof n)return t;let s=i[g];s||(s=new n(g),i[g]=s);for(let o=0;o<g;o++)s[o]=t[o];return s}function rn(t,e){return A0(t,e,Float32Array,xw)}function mg(t,e){return A0(t,e,Int32Array,Ww)}function eC(t,e){return A0(t,e,Uint32Array,Nw)}function Sv(t,e,n){const i=Uw[n.type];if(!i)throw new Error(`Unknown GLSL uniform type ${n.type}`);return i().bind(null,t,e)}function ww(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]||1,isArray:Boolean(n[2])}}function Tw(t,e,n){for(const i in t){const g=t[i];if((!n||Boolean(n[i]))&&!Ew(g))throw e=e?`${e} `:"",console.error(`${e} Bad uniform ${i}`,g),new Error(`${e} Bad uniform ${i}`)}return!0}function Ew(t){return Array.isArray(t)||ArrayBuffer.isView(t)?Xw(t):isFinite(t)||t===!0||t===!1||t instanceof ns||t instanceof uo?!0:t instanceof Ct?Boolean(t.texture):!1}function Qw(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let g=0,s=n.length;g<s;++g)i[g]=n[g]}else t[e]=n.slice();else t[e]=n}function Xw(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Rt(){let t=null;return(e,n,i)=>{const g=t!==i;return g&&(e.uniform1i(n,i),t=i),g}}function Me(t,e,n,i){let g=null,s=null;return(o,r,I)=>{const a=e(I,n),l=a.length;let C=!1;if(g===null)g=new Float32Array(l),s=l,C=!0;else{O(s===l,"Uniform length cannot change.");for(let c=0;c<l;++c)if(a[c]!==g[c]){C=!0;break}}return C&&(i(o,t,r,a),g.set(a)),C}}function Qt(t,e,n,i){t[e](n,i)}function Fi(t,e,n,i){t[e](n,!1,i)}const Yw=5120,_w=5121,Hw=5122,kw=5123,Vv=0,tC=1,Kw=2,Lw=3,nC=4,Mw=5,Pw=6,ct=5126,Jw=35664,Dw=35665,zw=35666,GI=5124,Ow=35667,jw=35668,qw=35669,ZI=5125,$w=36294,eT=36295,tT=36296,nT=35670,iT=35671,gT=35672,sT=35673,oT=35674,rT=35675,IT=35676,aT=35685,lT=35686,CT=35687,cT=35688,AT=35689,dT=35690,d0={[ct]:[ct,1,"float"],[Jw]:[ct,2,"vec2"],[Dw]:[ct,3,"vec3"],[zw]:[ct,4,"vec4"],[GI]:[GI,1,"int"],[Ow]:[GI,2,"ivec2"],[jw]:[GI,3,"ivec3"],[qw]:[GI,4,"ivec4"],[ZI]:[ZI,1,"uint"],[$w]:[ZI,2,"uvec2"],[eT]:[ZI,3,"uvec3"],[tT]:[ZI,4,"uvec4"],[nT]:[ct,1,"bool"],[iT]:[ct,2,"bvec2"],[gT]:[ct,3,"bvec3"],[sT]:[ct,4,"bvec4"],[oT]:[ct,8,"mat2"],[aT]:[ct,8,"mat2x3"],[lT]:[ct,8,"mat2x4"],[rT]:[ct,12,"mat3"],[CT]:[ct,12,"mat3x2"],[cT]:[ct,12,"mat3x4"],[IT]:[ct,16,"mat4"],[AT]:[ct,16,"mat4x2"],[dT]:[ct,16,"mat4x3"]};function uT(t){switch(t){case Vv:return Vv;case tC:return tC;case Lw:return tC;case Kw:return tC;case nC:return nC;case Mw:return nC;case Pw:return nC;default:return O(!1),0}}function Uv(t){const e=d0[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function xv(t,e){switch(t){case Yw:case _w:case Hw:case kw:t=ct;break}for(const n in d0){const[i,g,s]=d0[n];if(i===t&&g===e)return{glType:n,name:s}}return null}class hT{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let g=0;g<i;g++){const{name:s,type:o,size:r}=n.getActiveAttrib(e.handle,g),I=n.getAttribLocation(e.handle,s);I>=0&&this._addAttribute(I,s,o,r)}this.attributeInfos.sort((g,s)=>g.location-s.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!ye(n))return;const i=n.getProgramParameter(e.handle,35971);for(let g=0;g<i;g++){const{name:s,type:o,size:r}=n.getTransformFeedbackVarying(e.handle,g);this._addVarying(g,s,o,r)}this.varyingInfos.sort((g,s)=>g.location-s.location)}_addAttribute(e,n,i,g){const{type:s,components:o}=Uv(i),r={type:s,size:g*o};this._inferProperties(e,n,r);const I={location:e,name:n,accessor:new sn(r)};this.attributeInfos.push(I),this.attributeInfosByLocation[e]=I,this.attributeInfosByName[I.name]=I}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,g){const{type:s,components:o}=Uv(i),r=new sn({type:s,size:g*o}),I={location:e,name:n,accessor:r};this.varyingInfos.push(I),this.varyingInfosByName[I.name]=I}}const Wv=4,mT=35981,fT=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class Nv extends Ri{constructor(e,n={}){super(e,n);this.stubRemovedMethods("Program","v6.0",fT),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(e={}){const{hash:n,vs:i,fs:g,varyings:s,bufferMode:o=mT}=e;return this.hash=n||"",this.vs=typeof i=="string"?new C0(this.gl,{id:`${e.id}-vs`,source:i}):i,this.fs=typeof g=="string"?new c0(this.gl,{id:`${e.id}-fs`,source:g}):g,O(this.vs instanceof C0),O(this.fs instanceof c0),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(Et(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new hT(this),this.setProps(e)}delete(e={}){return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw({logPriority:e,drawMode:n=4,vertexCount:i,offset:g=0,start:s,end:o,isIndexed:r=!1,indexType:I=5123,instanceCount:a=0,isInstanced:l=a>0,vertexArray:C=null,transformFeedback:c,framebuffer:A,parameters:d={},uniforms:m,samplers:u}){if((m||u)&&(se.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(m||{})),se.priority>=e){const h=A?A.id:"default",f=`mode=${ug(this.gl,n)} verts=${i} instances=${a} indexType=${ug(this.gl,I)} isInstanced=${l} isIndexed=${r} Framebuffer=${h}`;se.log(e,f)()}return O(C),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||i===0||l&&a===0?!1:(C.bindForDraw(i,a,()=>{if(A!==void 0&&(d=Object.assign({},d,{framebuffer:A})),c){const h=uT(n);c.begin(h)}this._bindTextures(),Xn(this.gl,d,()=>{r&&l?this.gl2.drawElementsInstanced(n,i,I,g,a):r&&ye(this.gl)&&!isNaN(s)&&!isNaN(o)?this.gl2.drawRangeElements(n,s,o,i,I,g):r?this.gl.drawElements(n,i,I,g):l?this.gl2.drawArraysInstanced(n,g,i,a):this.gl.drawArrays(n,g,i)}),c&&c.end()}),!0)}setUniforms(e={}){se.priority>=2&&Tw(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],g=this._uniformSetters[n];if(g){let s=i,o=!1;if(s instanceof Ct&&(s=s.texture),s instanceof ns)if(o=this.uniforms[n]!==i,o){g.textureIndex===void 0&&(g.textureIndex=this._textureIndexCounter++);const r=s,{textureIndex:I}=g;r.bind(I),s=I,this._textureUniforms[n]=r}else s=g.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(g(s)||o)&&Qw(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const g of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new C0({handle:g});break;case 35632:i.fs=new c0({handle:g});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=hg(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?`${e}-program`:"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),se.time(Wv,`linkProgram for ${this._getName()}`)(),e.linkProgram(this.handle),se.timeEnd(Wv,`linkProgram for ${this._getName()}`)(),e.debug||se.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error(`Error linking: ${e.getProgramInfoLog(this.handle)}`);if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error(`Error validating: ${e.getProgramInfoLog(this.handle)}`)}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:g}=ww(i.name);let s=e.getUniformLocation(this.handle,g);if(this._uniformSetters[g]=Sv(e,s,i),i.size>1)for(let o=0;o<i.size;o++)s=e.getUniformLocation(this.handle,`${g}[${o}]`),this._uniformSetters[`${g}[${o}]`]=Sv(e,s,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const pT=34918,BT=34919,bT=35007,yT=36795,vT=35976,GT=35887,ZT=36202;class iC extends Ri{static isSupported(e,n=[]){const i=ye(e),g=l0(e,Ee.TIMER_QUERY);let s=i||g;for(const o of n)switch(o){case"queries":s=s&&i;break;case"timers":s=s&&g;break;default:O(!1)}return s}constructor(e,n={}){super(e,n);this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(bT)}beginOcclusionQuery({conservative:e=!1}={}){return this.begin(e?ZT:GT)}beginTransformFeedbackQuery(){return this.begin(vT)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,BT);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(yT)}getResult(){return this.gl2.getQueryParameter(this.handle,pT)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,g)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(g("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return iC.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class wv extends Ri{static isSupported(e){return ye(e)}constructor(e,n={}){Et(e);super(e,n);this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(e={}){return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,co(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(e={}){return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:g,byteSize:s,byteOffset:o}=this._getBufferParams(n);return i<0?(this.unused[e]=g,se.warn(()=>`${this.id} unused varying buffer ${e}`)(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,g,o,s),this)}begin(e=0){return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,g;return e instanceof Te?g=e:(g=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||g.byteLength-n),{buffer:g,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:g}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,g,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n,i=0,g){const s=n&&n.handle;return!s||g===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,i,g),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let gC=null;function RT(t){return(!gC||gC.byteLength<t)&&(gC=new ArrayBuffer(t)),gC}function FT(t,e){const n=RT(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function ST({target:t,source:e,start:n=0,count:i=1}){const g=e.length,s=i*g;let o=0;for(let r=n;o<g;o++)t[r++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}const VT="elements must be GL.ELEMENT_ARRAY_BUFFER";class In extends Ri{static isSupported(e,n={}){return n.constantAttributeZero?ye(e)||uy()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new In(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return In.MAX_ATTRIBUTES=In.MAX_ATTRIBUTES||e.getParameter(34921),In.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:In._setConstantFloatArray(e,n,i);break;case Int32Array:In._setConstantIntArray(e,n,i);break;case Uint32Array:In._setConstantUintArray(e,n,i);break;default:O(!1)}}constructor(e,n={}){const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i}));this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return In.getMaxAttributes(this.gl)}initialize(e={}){return this.setProps(e)}setProps(e){return this}setElementBuffer(e=null,n={}){return O(!e||e.target===34963,VT),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:g,type:s,stride:o,offset:r,normalized:I,integer:a,divisor:l}=i,{gl:C,gl2:c}=this;return e=Number(e),this.bind(()=>{C.bindBuffer(34962,n.handle),a?(O(ye(C)),c.vertexAttribIPointer(e,g,s,o,r)):C.vertexAttribPointer(e,g,s,I,o,r),C.enableVertexAttribArray(e),c.vertexAttribDivisor(e,l||0)}),this}enable(e,n=!0){return!n&&e===0&&!In.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),g=i.byteLength*e,s=i.length*e;let o=!this.buffer;if(this.buffer=this.buffer||new Te(this.gl,g),o=o||this.buffer.reallocate(g),o=o||!this._compareConstantArrayValues(i,this.bufferValue),o){const r=FT(n.constructor,s);ST({target:r,source:i,start:0,count:s}),this.buffer.subData(r),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:O(!1)}}static _setConstantIntArray(e,n,i){switch(O(ye(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:O(!1)}}static _setConstantUintArray(e,n,i){switch(O(ye(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:O(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,{location:n}){return O(Number.isFinite(n)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(n,e);default:return this.gl.getVertexAttrib(n,e)}})}}const UT="VertexArray: attributes must be Buffers or constants (i.e. typed array)",xT=/^(.+)__LOCATION_([0-9]+)$/,WT=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class NT{constructor(e,n={}){const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new In(e),gv(this,"VertexArray","v6.0",WT),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(e={}){return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(e=null,n={}){return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n,i={}){if(n.target===34963)return this.setElementBuffer(n,i);const{location:g,accessor:s}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return g>=0&&(this.values[g]=n,this.accessors[g]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(g,n,s)),this}setConstant(e,n,i={}){const{location:g,accessor:s}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return g>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[g]=n,this.accessors[g]=s,this.clearDrawParams(),this.vertexArrayObject.enable(g,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Te(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof Te&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof Te&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let g;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),g=i()}),g}_resolveLocationAndAccessor(e,n,i,g){const s={location:-1,accessor:null},{location:o,name:r}=this._getAttributeIndex(e);if(!Number.isFinite(o)||o<0)return this.unused[e]=n,se.once(3,()=>`unused value ${e} in ${this.id}`)(),s;const I=this._getAttributeInfo(r||o);if(!I)return s;const a=this.accessors[o]||{},l=sn.resolve(I.accessor,a,i,g),{size:C,type:c}=l;return O(Number.isFinite(C)&&Number.isFinite(c)),{location:o,accessor:l}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=xT.exec(e),g=i?i[1]:e,s=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(g)+s,name:g}:{location:-1}}_setAttribute(e,n){if(n instanceof Te)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof Te){const i=n[0],g=n[1];this.setBuffer(e,i,g)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof Te){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(UT)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let g=this.values[0];ArrayBuffer.isView(g)&&this._setConstantAttributeZero(g,i);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)g=this.values[s],ArrayBuffer.isView(g)&&this._setConstantAttribute(s,g)}_setConstantAttributeZero(e,n){if(In.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){In.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],g=this.accessors[n];if(!i)return;const{divisor:s}=g,o=s>0;if(e.isInstanced=e.isInstanced||o,i instanceof Te){const r=i;if(o){const I=r.getVertexCount(g);e.instanceCount=Math.min(e.instanceCount,I)}else{const I=r.getVertexCount(g);e.vertexCount=Math.min(e.vertexCount,I)}}}setElements(e=null,n={}){return se.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function wT(t,e){const{maxElts:n=16,size:i=1}=e;let g="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(g+=`,${o%i==0?" ":""}`),g+=RI(t[o],e);const s=t.length>n?"...":"]";return`${g}${s}`}function RI(t,e={}){const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return wT(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const g=t.toPrecision(2);return g.indexOf(".0")===g.length-2?g.slice(0,-1):g}function Tv({header:t="Uniforms",program:e,uniforms:n,undefinedOnly:i=!1}){O(e);const g=".*_.*",s=".*Matrix",o=e._uniformSetters,r={},I=Object.keys(o).sort();let a=0;for(const c of I)!c.match(g)&&!c.match(s)&&u0({table:r,header:t,uniforms:n,uniformName:c,undefinedOnly:i})&&a++;for(const c of I)c.match(s)&&u0({table:r,header:t,uniforms:n,uniformName:c,undefinedOnly:i})&&a++;for(const c of I)r[c]||u0({table:r,header:t,uniforms:n,uniformName:c,undefinedOnly:i})&&a++;let l=0;const C={};if(!i)for(const c in n){const A=n[c];r[c]||(l++,C[c]={Type:`NOT USED: ${A}`,[t]:RI(A)})}return{table:r,count:a,unusedTable:C,unusedCount:l}}function u0({table:t,header:e,uniforms:n,uniformName:i,undefinedOnly:g}){const s=n[i],o=TT(s);return!g||!o?(t[i]={[e]:o?RI(s):"N/A","Uniform Type":o?s:"NOT PROVIDED"},!0):!1}function TT(t){return t!=null}function ET({vertexArray:t,header:e="Attributes"}){if(!t.configuration)return{};const n={};t.elements&&(n.ELEMENT_ARRAY_BUFFER=Ev(t,t.elements,null,e));const i=t.values;for(const g in i){const s=t._getAttributeInfo(g);if(s){let o=`${g}: ${s.name}`;const r=t.accessors[s.location];r&&(o=`${g}: ${QT(s.name,r)}`),n[o]=Ev(t,i[g],r,e)}}return n}function Ev(t,e,n,i){const{gl:g}=t;if(!e)return{[i]:"null","Format ":"N/A"};let s="NOT PROVIDED",o=1,r=0,I=0,a,l,C;if(n&&(s=n.type,o=n.size,s=String(s).replace("Array",""),a=s.indexOf("nt")!==-1),e instanceof Te){const c=e,{data:A,changed:d}=c.getDebugData();l=d?"*":"",C=A,I=c.byteLength,r=I/A.BYTES_PER_ELEMENT/o;let m;return n?m=`${n.divisor>0?"I ":"P "} ${r} (x${o}=${I} bytes ${ug(g,s)})`:(a=!0,m=`${I} bytes`),{[i]:`${l}${RI(C,{size:o,isInteger:a})}`,"Format ":m}}return C=e,o=e.length,s=String(e.constructor.name).replace("Array",""),a=s.indexOf("nt")!==-1,{[i]:`${RI(C,{size:o,isInteger:a})} (constant)`,"Format ":`${o}x${s} (constant)`}}function QT(t,e){const{type:n,size:i}=e,g=xv(n,i);return g?`${t} (${g.name})`:t}function XT(t){const e={},n=`Accessors for ${t.id}`;for(const i of t.attributeInfos)if(i){const g=Qv(i);e[`in ${g}`]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const g=Qv(i);e[`out ${g}`]={[n]:JSON.stringify(i.accessor)}}return e}function Qv(t){const{type:e,size:n}=t.accessor,i=xv(e,n);return i?`${i.name} ${t.name}`:t.name}const Xv=Le.isBrowser()&&typeof document!="undefined";let YT=0;class _T{constructor(e={}){const{onCreateContext:n=u=>nv(u),onAddHTML:i=null,onInitialize:g=()=>{},onRender:s=()=>{},onFinalize:o=()=>{},onError:r,gl:I=null,glOptions:a={},debug:l=!1,createFramebuffer:C=!1,autoResizeViewport:c=!0,autoResizeDrawingBuffer:A=!0,stats:d=ts.get(`animation-loop-${YT++}`)}=e;let{useDevicePixels:m=!0}=e;"useDevicePixelRatio"in e&&(se.deprecated("useDevicePixelRatio","useDevicePixels")(),m=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:g,onRender:s,onFinalize:o,onError:r,gl:I,glOptions:a,debug:l,createFramebuffer:C},this.gl=I,this.needsRedraw=null,this.timeline=null,this.stats=d,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:c,autoResizeDrawingBuffer:A,useDevicePixels:m}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return O(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(e={}){if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=iC.isSupported(this.gl,["timers"])?new iC(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(...e){return this.props.onCreateContext(...e)}onInitialize(...e){return this.props.onInitialize(...e)}onRender(...e){return this.props.onRender(...e)}onFinalize(...e){return this.props.onFinalize(...e)}getHTMLControlValue(e,n=1){const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return se.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{!this._running||(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=Xv?new Promise((e,n)=>{if(Xv&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):zN(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):DN(e)}_renderFrame(...e){if(this.display){this.display._renderFrame(...e);return}this.onRender(...e)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas!="undefined"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?t0(this.props.gl,e):this.onCreateContext(e),!Ol(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");TN(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:g}=this.gl;return g&&g.clientHeight?i=g.clientWidth/g.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&_N(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Ct(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const FI="vs",h0="fs";function an(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const m0={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function HT(t){const e={};for(const n in t){const i=t[n],g=kT(i);e[n]=g}return e}function kT(t){let e=Yv(t);return e==="object"?t?"type"in t?Object.assign({},t,m0[t.type]):"value"in t?(e=Yv(t.value),Object.assign({type:e},t,m0[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},m0[e])}function Yv(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const KT="vs",LT="fs";class _v{constructor({name:e,vs:n,fs:i,dependencies:g=[],uniforms:s,getUniforms:o,deprecations:r=[],defines:I={},inject:a={},vertexShader:l,fragmentShader:C}){an(typeof e=="string"),this.name=e,this.vs=n||l,this.fs=i||C,this.getModuleUniforms=o,this.dependencies=g,this.deprecations=this._parseDeprecationDefinitions(r),this.defines=I,this.injections=MT(a),s&&(this.uniforms=HT(s))}getModuleSource(e){let n;switch(e){case KT:n=this.vs||"";break;case LT:n=this.fs||"";break;default:an(!1)}return`#define MODULE_${this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_")}
${n}// END MODULE_${this.name}

`}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp(`\\b${n.old}\\(`);break;default:n.regex=new RegExp(`${n.type} ${n.old};`)}}),e}_defaultGetUniforms(e={}){const n={},i=this.uniforms;for(const g in i){const s=i[g];g in e&&!s.private?(s.validate&&an(s.validate(e[g],s),`${this.name}: invalid ${g}`),n[g]=e[g]):n[g]=s.value}return n}}function MT(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const g=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[g][n]=i}return e}function PT(t){return JT(kv(t))}function JT(t){const e={},n={};return Hv({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,g)=>n[g]-n[i]).map(i=>e[i])}function Hv({modules:t,level:e,moduleMap:n,moduleDepth:i}){if(e>=5)throw new Error("Possible loop in shader dependency graph");for(const g of t)n[g.name]=g,(i[g.name]===void 0||i[g.name]<e)&&(i[g.name]=e);for(const g of t)g.dependencies&&Hv({modules:g.dependencies,level:e+1,moduleMap:n,moduleDepth:i})}function kv(t,e){return t.map(n=>(n instanceof _v||(an(typeof n!="string",`Shader module use by name is deprecated. Import shader module '${n}' and use it directly.`),an(n.name,"shader module has no name"),n=new _v(n),n.dependencies=kv(n.dependencies)),n))}function DT(t={}){const e=typeof window!="undefined"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,g=n.indexOf("Trident/")!==-1;return i||g}const zT=7936,OT=7937,jT=7938,qT=35724,f0={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},gs={};Object.keys(f0).forEach(t=>{gs[t]=t});function $T(t){return typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function e5(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||zT),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||OT);return{gpuVendor:t5(n,i),vendor:n,renderer:i,version:t.getParameter(jT),shadingLanguageVersion:t.getParameter(qT)}}function t5(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const p0={};function Kv(t,e,n={}){const i=f0[e];if(an(i,e),!DT(n))return!0;if(e in p0)return p0[e];const g=i[0],s=n.behavior||"enable",o=`#extension GL_${g} : ${s}
void main(void) {}`,r=t.createShader(35633);t.shaderSource(r,o),t.compileShader(r);const I=t.getShaderParameter(r,35713);return t.deleteShader(r),p0[e]=I,I}function n5(t,e){const n=f0[e];an(n,e);const i=$T(t)&&n[1]||n[0],g=typeof i=="string"?Boolean(t.getExtension(i)):i;return an(g===!1||g===!0),g}function sC(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>n5(t,n))}function i5(t){switch(e5(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function g5(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return sC(t,gs.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),sC(t,gs.GLSL_DERIVATIVES)&&Kv(t,gs.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),sC(t,gs.GLSL_FRAG_DATA)&&Kv(t,gs.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),sC(t,gs.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const s5=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,o5=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,r5={[FI]:s5,[h0]:o5},oC="__LUMA_INJECT_DECLARATIONS__",Lv=/void\s+main\s*\([^)]*\)\s*\{\n?/,Mv=/}\n?[^{}]*$/,B0=[];function Pv(t,e,n,i=!1){const g=e===FI;for(const s in n){const o=n[s];o.sort((I,a)=>I.order-a.order),B0.length=o.length;for(let I=0,a=o.length;I<a;++I)B0[I]=o[I].injection;const r=`${B0.join(`
`)}
`;switch(s){case"vs:#decl":g&&(t=t.replace(oC,r));break;case"vs:#main-start":g&&(t=t.replace(Lv,I=>I+r));break;case"vs:#main-end":g&&(t=t.replace(Mv,I=>r+I));break;case"fs:#decl":g||(t=t.replace(oC,r));break;case"fs:#main-start":g||(t=t.replace(Lv,I=>I+r));break;case"fs:#main-end":g||(t=t.replace(Mv,I=>r+I));break;default:t=t.replace(s,I=>I+r)}}return t=t.replace(oC,""),i&&(t=t.replace(/\}\s*$/,s=>s+r5[e])),t}function b0(t){const e={};return an(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?`${e[i]}
${n[i]}`:n[i]}),e}function ho(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}const Jv=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],I5=[...Jv,[ho("attribute"),"in $1"],[ho("varying"),"out $1"]],a5=[...Jv,[ho("varying"),"in $1"]],Dv=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],l5=[...Dv,[ho("in"),"attribute $1"],[ho("out"),"varying $1"]],C5=[...Dv,[ho("in"),"varying $1"]],y0="gl_FragColor",v0=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,c5=/void\s+main\s*\([^)]*\)\s*\{\n?/;function A5(t,e,n){switch(e){case 300:return n?rC(t,I5):d5(t);case 100:return n?rC(t,l5):u5(t);default:throw new Error(`unknown GLSL version ${e}`)}}function rC(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function d5(t){t=rC(t,a5);const e=t.match(v0);if(e){const n=e[1];t=t.replace(new RegExp(`\\b${y0}\\b`,"g"),n)}else{const n="fragmentColor";t=t.replace(c5,i=>`out vec4 ${n};
${i}`).replace(new RegExp(`\\b${y0}\\b`,"g"),n)}return t}function u5(t){t=rC(t,C5);const e=t.match(v0);if(e){const n=e[1];t=t.replace(v0,"").replace(new RegExp(`\\b${n}\\b`,"g"),y0)}return t}const h5=`

${oC}

`,zv={[FI]:"vertex",[h0]:"fragment"},m5=`precision highp float;

`;function f5(t,e){const{vs:n,fs:i}=e,g=PT(e.modules||[]);return{gl:t,vs:Ov(t,Object.assign({},e,{source:n,type:FI,modules:g})),fs:Ov(t,Object.assign({},e,{source:i,type:h0,modules:g})),getUniforms:p5(g)}}function Ov(t,{id:e,source:n,type:i,modules:g,defines:s={},hookFunctions:o=[],inject:r={},transpileToGLSL100:I=!1,prologue:a=!0,log:l}){an(typeof n=="string","shader source must be a string");const C=i===FI,c=n.split(`
`);let A=100,d="",m=n;c[0].indexOf("#version ")===0?(A=300,d=c[0],m=c.slice(1).join(`
`)):d=`#version ${A}`;const u={};g.forEach(v=>{Object.assign(u,v.getDefines())}),Object.assign(u,s);let h=a?`${d}
${b5({id:e,source:n,type:i})}
${B5({type:i})}
${i5(t)}
${g5(t)}
${y5(u)}
${C?"":m5}
`:`${d}
`;const f=G5(o),p={},b={},Z={};for(const v in r){const N=typeof r[v]=="string"?{injection:r[v],order:0}:r[v],x=v.match(/^(v|f)s:(#)?([\w-]+)$/);if(x){const V=x[2],E=x[3];V?E==="decl"?b[v]=[N]:Z[v]=[N]:p[v]=[N]}else Z[v]=[N]}for(const v of g){l&&v.checkDeprecations(m,l),h+=v.getModuleSource(i,A);const x=v.injections[i];for(const V in x){const E=V.match(/^(v|f)s:#([\w-]+)$/);if(E){const _=E[2]==="decl"?b:Z;_[V]=_[V]||[],_[V].push(x[V])}else p[V]=p[V]||[],p[V].push(x[V])}}return h+=h5,h=Pv(h,i,b),h+=v5(f[i],p),h+=m,h=Pv(h,i,Z),h=A5(h,I?100:A,C),h}function p5(t){return function(n){const i={};for(const g of t){const s=g.getUniforms(n,i);Object.assign(i,s)}return i}}function B5({type:t}){return`
#define SHADER_TYPE_${zv[t].toUpperCase()}
`}function b5({id:t,source:e,type:n}){return t&&typeof t=="string"&&e.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${t}_${zv[n]}

`:""}function y5(t={}){let e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const g=t[i];(g||Number.isFinite(g))&&(n+=`#define ${i.toUpperCase()} ${t[i]}
`)}return e===0&&(n+=`
`),n}function v5(t,e){let n="";for(const i in t){const g=t[i];if(n+=`void ${g.signature} {
`,g.header&&(n+=`  ${g.header}`),e[i]){const s=e[i];s.sort((o,r)=>o.order-r.order);for(const o of s)n+=`  ${o.injection}
`}g.footer&&(n+=`  ${g.footer}`),n+=`}
`}return n}function G5(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[g,s]=n.split(":"),o=n.replace(/\(.+/,"");e[g][o]=Object.assign(i,{signature:s})}),e}const Z5="void main() {gl_FragColor = vec4(0);}",jv=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,R5=`#version 300 es
${jv}`;function qv(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,g,s]=n;if(!e.includes(i)||!g||!s)return null;const o=s.split(";")[0];return{qualifier:i,type:g,name:o}}function $v(t={}){const{version:e=100,input:n,inputType:i,output:g}=t;if(!n)return e===300?R5:e>300?`#version ${e}
${jv}`:Z5;const s=V5(n,i);return e>=300?`#version ${e} ${e===300?"es":""}
in ${i} ${n};
out vec4 ${g};
void main() {
  ${g} = ${s};
}`:`varying ${i} ${n};
void main() {
  gl_FragColor = ${s};
}`}function F5(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return an(!1),null}}function S5(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return an(!1),null}}function V5(t,e){switch(e){case"float":return`vec4(${t}, 0.0, 0.0, 1.0)`;case"vec2":return`vec4(${t}, 0.0, 1.0)`;case"vec3":return`vec4(${t}, 1.0)`;case"vec4":return t;default:return an(!1),null}}const U5=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,x5={name:"fp32",vs:U5,fs:null};function Mt(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const At={};At.EPSILON=1e-12;At.debug=!1;At.precision=4;At.printTypes=!1;At.printDegrees=!1;At.printRowMajor=!0;function W5(t){return Math.round(t/At.EPSILON)*At.EPSILON}function N5(t,{precision:e=At.precision||4}={}){return t=W5(t),"".concat(parseFloat(t.toPrecision(e)))}function mo(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function w5(t){return t.clone?t.clone():new Array(t.length)}function T5(t,e,n){if(mo(t)){n=n||w5(t);for(let i=0;i<n.length&&i<t.length;++i)n[i]=e(t[i],i,n);return n}return e(t)}function ln(t,e,n){return T5(t,i=>Math.max(e,Math.min(n,i)))}function ss(t,e,n){return mo(t)?t.map((i,g)=>ss(i,e[g],n)):n*e+(1-n)*t}function fg(t,e,n){const i=At.EPSILON;n&&(At.EPSILON=n);try{if(t===e)return!0;if(mo(t)&&mo(e)){if(t.length!==e.length)return!1;for(let g=0;g<t.length;++g)if(!fg(t[g],e[g]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):Number.isFinite(t)&&Number.isFinite(e)?Math.abs(t-e)<=At.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{At.EPSILON=i}}function E5(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class G0 extends E5(Array){get ELEMENTS(){return Mt(!1),0}clone(){return new this.constructor().copy(this)}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}to(e){return e===this?this:mo(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(At)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+N5(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!fg(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){i===void 0&&(i=n,n=e,e=this);for(let g=0;g<this.ELEMENTS;++g){const s=e[g];this[g]=s+i*(n[g]-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(Array.isArray(e))return this.multiply(e);for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.scale(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}multiplyByScalar(e){return this.scale(e)}get elements(){return this}check(){if(At.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}}function Q5(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Ft(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function SI(t,e,n=""){if(At.debug&&!Q5(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}const eG={};function fo(t,e){eG[t]||(eG[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}class X5 extends G0{get ELEMENTS(){return Mt(!1),0}copy(e){return Mt(!1),this}get x(){return this[0]}set x(e){this[0]=Ft(e)}get y(){return this[1]}set y(e){this[1]=Ft(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const g=this[i]-e[i];n+=g*g}return Ft(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return Ft(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Mt(e>=0&&e<this.ELEMENTS,"index is out of range"),Ft(this[e])}setComponent(e,n){return Mt(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var VI=1e-6,Yn=typeof Float32Array!="undefined"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function Y5(){var t=new Yn(2);return Yn!=Float32Array&&(t[0]=0,t[1]=0),t}function IC(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function tG(t,e){return t[0]=-e[0],t[1]=-e[1],t}function nG(t,e,n,i){var g=e[0],s=e[1];return t[0]=g+i*(n[0]-g),t[1]=s+i*(n[1]-s),t}function _5(t,e,n){var i=e[0],g=e[1];return t[0]=n[0]*i+n[3]*g+n[6],t[1]=n[1]*i+n[4]*g+n[7],t}function H5(t,e,n){var i=e[0],g=e[1];return t[0]=n[0]*i+n[4]*g+n[12],t[1]=n[1]*i+n[5]*g+n[13],t}(function(){var t=Y5();return function(e,n,i,g,s,o){var r,I;for(n||(n=2),i||(i=0),g?I=Math.min(g*n+i,e.length):I=e.length,r=i;r<I;r+=n)t[0]=e[r],t[1]=e[r+1],s(t,t,o),e[r]=t[0],e[r+1]=t[1];return e}})();function k5(t,e,n){const i=e[0],g=e[1],s=n[3]*i+n[7]*g||1;return t[0]=(n[0]*i+n[4]*g)/s,t[1]=(n[1]*i+n[5]*g)/s,t}function iG(t,e,n){const i=e[0],g=e[1],s=e[2],o=n[3]*i+n[7]*g+n[11]*s||1;return t[0]=(n[0]*i+n[4]*g+n[8]*s)/o,t[1]=(n[1]*i+n[5]*g+n[9]*s)/o,t[2]=(n[2]*i+n[6]*g+n[10]*s)/o,t}function K5(t,e,n){const i=e[0],g=e[1];return t[0]=n[0]*i+n[2]*g,t[1]=n[1]*i+n[3]*g,t[2]=e[2],t}function L5(t,e,n){const i=e[0],g=e[1],s=e[2];return t[0]=n[0]*i+n[3]*g+n[6]*s,t[1]=n[1]*i+n[4]*g+n[7]*s,t[2]=n[2]*i+n[5]*g+n[8]*s,t[3]=e[3],t}function gG(){var t=new Yn(3);return Yn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function M5(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function sG(t,e,n){var i=new Yn(3);return i[0]=t,i[1]=e,i[2]=n,i}function P5(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function J5(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function D5(t,e){var n=e[0],i=e[1],g=e[2],s=n*n+i*i+g*g;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function oG(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function aC(t,e,n){var i=e[0],g=e[1],s=e[2],o=n[0],r=n[1],I=n[2];return t[0]=g*I-s*r,t[1]=s*o-i*I,t[2]=i*r-g*o,t}function rG(t,e,n){var i=e[0],g=e[1],s=e[2],o=n[3]*i+n[7]*g+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*g+n[8]*s+n[12])/o,t[1]=(n[1]*i+n[5]*g+n[9]*s+n[13])/o,t[2]=(n[2]*i+n[6]*g+n[10]*s+n[14])/o,t}function IG(t,e,n){var i=e[0],g=e[1],s=e[2];return t[0]=i*n[0]+g*n[3]+s*n[6],t[1]=i*n[1]+g*n[4]+s*n[7],t[2]=i*n[2]+g*n[5]+s*n[8],t}function z5(t,e,n){var i=n[0],g=n[1],s=n[2],o=n[3],r=e[0],I=e[1],a=e[2],l=g*a-s*I,C=s*r-i*a,c=i*I-g*r,A=g*c-s*C,d=s*l-i*c,m=i*C-g*l,u=o*2;return l*=u,C*=u,c*=u,A*=2,d*=2,m*=2,t[0]=r+l+A,t[1]=I+C+d,t[2]=a+c+m,t}function O5(t,e,n,i){var g=[],s=[];return g[0]=e[0]-n[0],g[1]=e[1]-n[1],g[2]=e[2]-n[2],s[0]=g[0],s[1]=g[1]*Math.cos(i)-g[2]*Math.sin(i),s[2]=g[1]*Math.sin(i)+g[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function j5(t,e,n,i){var g=[],s=[];return g[0]=e[0]-n[0],g[1]=e[1]-n[1],g[2]=e[2]-n[2],s[0]=g[2]*Math.sin(i)+g[0]*Math.cos(i),s[1]=g[1],s[2]=g[2]*Math.cos(i)-g[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function q5(t,e,n,i){var g=[],s=[];return g[0]=e[0]-n[0],g[1]=e[1]-n[1],g[2]=e[2]-n[2],s[0]=g[0]*Math.cos(i)-g[1]*Math.sin(i),s[1]=g[0]*Math.sin(i)+g[1]*Math.cos(i),s[2]=g[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function $5(t,e){var n=t[0],i=t[1],g=t[2],s=e[0],o=e[1],r=e[2],I=Math.sqrt(n*n+i*i+g*g),a=Math.sqrt(s*s+o*o+r*r),l=I*a,C=l&&oG(t,e)/l;return Math.acos(Math.min(Math.max(C,-1),1))}var eE=P5,tE=M5;(function(){var t=gG();return function(e,n,i,g,s,o){var r,I;for(n||(n=3),i||(i=0),g?I=Math.min(g*n+i,e.length):I=e.length,r=i;r<I;r+=n)t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2],s(t,t,o),e[r]=t[0],e[r+1]=t[1],e[r+2]=t[2];return e}})();const Z0=[0,0,0],aG={};class j extends X5{static get ZERO(){return aG.ZERO=aG.ZERO||Object.freeze(new j(0,0,0,0))}constructor(e=0,n=0,i=0){super(-0,-0,-0);arguments.length===1&&mo(e)?this.copy(e):(At.debug&&(Ft(e),Ft(n),Ft(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return At.debug&&(Ft(e.x),Ft(e.y),Ft(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Ft(e)}angle(e){return $5(this,e)}cross(e){return aC(this,this,e),this.check()}rotateX({radians:e,origin:n=Z0}){return O5(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Z0}){return j5(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Z0}){return q5(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return rG(this,this,e),this.check()}transformAsVector(e){return iG(this,this,e),this.check()}transformByMatrix3(e){return IG(this,this,e),this.check()}transformByMatrix2(e){return K5(this,this,e),this.check()}transformByQuaternion(e){return z5(this,this,e),this.check()}}class lG extends G0{get ELEMENTS(){return Mt(!1),0}get RANK(){return Mt(!1),0}toString(){let e="[";if(At.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=Ft(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let g=0;g<this.RANK;++g)n[g]=this[i+g];return n}setColumn(e,n){const i=e*this.RANK;for(let g=0;g<this.RANK;++g)this[i+g]=n[g];return this}}function nE(){var t=new Yn(9);return Yn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function iE(t,e){if(t===e){var n=e[1],i=e[2],g=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=g}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function gE(t,e){var n=e[0],i=e[1],g=e[2],s=e[3],o=e[4],r=e[5],I=e[6],a=e[7],l=e[8],C=l*o-r*a,c=-l*s+r*I,A=a*s-o*I,d=n*C+i*c+g*A;return d?(d=1/d,t[0]=C*d,t[1]=(-l*i+g*a)*d,t[2]=(r*i-g*o)*d,t[3]=c*d,t[4]=(l*n-g*I)*d,t[5]=(-r*n+g*s)*d,t[6]=A*d,t[7]=(-a*n+i*I)*d,t[8]=(o*n-i*s)*d,t):null}function sE(t){var e=t[0],n=t[1],i=t[2],g=t[3],s=t[4],o=t[5],r=t[6],I=t[7],a=t[8];return e*(a*s-o*I)+n*(-a*g+o*r)+i*(I*g-s*r)}function CG(t,e,n){var i=e[0],g=e[1],s=e[2],o=e[3],r=e[4],I=e[5],a=e[6],l=e[7],C=e[8],c=n[0],A=n[1],d=n[2],m=n[3],u=n[4],h=n[5],f=n[6],p=n[7],b=n[8];return t[0]=c*i+A*o+d*a,t[1]=c*g+A*r+d*l,t[2]=c*s+A*I+d*C,t[3]=m*i+u*o+h*a,t[4]=m*g+u*r+h*l,t[5]=m*s+u*I+h*C,t[6]=f*i+p*o+b*a,t[7]=f*g+p*r+b*l,t[8]=f*s+p*I+b*C,t}function oE(t,e,n){var i=e[0],g=e[1],s=e[2],o=e[3],r=e[4],I=e[5],a=e[6],l=e[7],C=e[8],c=n[0],A=n[1];return t[0]=i,t[1]=g,t[2]=s,t[3]=o,t[4]=r,t[5]=I,t[6]=c*i+A*o+a,t[7]=c*g+A*r+l,t[8]=c*s+A*I+C,t}function rE(t,e,n){var i=e[0],g=e[1],s=e[2],o=e[3],r=e[4],I=e[5],a=e[6],l=e[7],C=e[8],c=Math.sin(n),A=Math.cos(n);return t[0]=A*i+c*o,t[1]=A*g+c*r,t[2]=A*s+c*I,t[3]=A*o-c*i,t[4]=A*r-c*g,t[5]=A*I-c*s,t[6]=a,t[7]=l,t[8]=C,t}function cG(t,e,n){var i=n[0],g=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=g*e[3],t[4]=g*e[4],t[5]=g*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function IE(t,e){var n=e[0],i=e[1],g=e[2],s=e[3],o=n+n,r=i+i,I=g+g,a=n*o,l=i*o,C=i*r,c=g*o,A=g*r,d=g*I,m=s*o,u=s*r,h=s*I;return t[0]=1-C-d,t[3]=l-h,t[6]=c+u,t[1]=l+h,t[4]=1-a-d,t[7]=A-m,t[2]=c-u,t[5]=A+m,t[8]=1-a-C,t}const AG=Object.freeze([1,0,0,0,1,0,0,0,1]),aE=Object.freeze([0,0,0,0,0,0,0,0,0]),lE=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),po={};class ft extends lG{static get IDENTITY(){return po.IDENTITY=po.IDENTITY||Object.freeze(new ft(AG)),po.IDENTITY}static get ZERO(){return po.ZERO=po.ZERO||Object.freeze(new ft(aE)),po.ZERO}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return lE}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0);arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}set(e,n,i,g,s,o,r,I,a){return this[0]=e,this[1]=n,this[2]=i,this[3]=g,this[4]=s,this[5]=o,this[6]=r,this[7]=I,this[8]=a,this.check()}setRowMajor(e,n,i,g,s,o,r,I,a){return this[0]=e,this[1]=g,this[2]=r,this[3]=n,this[4]=s,this[5]=I,this[6]=i,this[7]=o,this[8]=a,this.check()}determinant(){return sE(this)}identity(){return this.copy(AG)}fromQuaternion(e){return IE(this,e),this.check()}transpose(){return iE(this,this),this.check()}invert(){return gE(this,this),this.check()}multiplyLeft(e){return CG(this,e,this),this.check()}multiplyRight(e){return CG(this,this,e),this.check()}rotate(e){return rE(this,this,e),this.check()}scale(e){return Array.isArray(e)?cG(this,this,e):cG(this,this,[e,e,e]),this.check()}translate(e){return oE(this,this,e),this.check()}transform(e,n){switch(e.length){case 2:n=_5(n||[-0,-0],e,this);break;case 3:n=IG(n||[-0,-0,-0],e,this);break;case 4:n=L5(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return SI(n,e.length),n}transformVector(e,n){return fo("Matrix3.transformVector"),this.transform(e,n)}transformVector2(e,n){return fo("Matrix3.transformVector"),this.transform(e,n)}transformVector3(e,n){return fo("Matrix3.transformVector"),this.transform(e,n)}}function CE(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cE(t,e){if(t===e){var n=e[1],i=e[2],g=e[3],s=e[6],o=e[7],r=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=g,t[13]=o,t[14]=r}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function R0(t,e){var n=e[0],i=e[1],g=e[2],s=e[3],o=e[4],r=e[5],I=e[6],a=e[7],l=e[8],C=e[9],c=e[10],A=e[11],d=e[12],m=e[13],u=e[14],h=e[15],f=n*r-i*o,p=n*I-g*o,b=n*a-s*o,Z=i*I-g*r,v=i*a-s*r,N=g*a-s*I,x=l*m-C*d,V=l*u-c*d,E=l*h-A*d,D=C*u-c*m,_=C*h-A*m,k=c*h-A*u,z=f*k-p*_+b*D+Z*E-v*V+N*x;return z?(z=1/z,t[0]=(r*k-I*_+a*D)*z,t[1]=(g*_-i*k-s*D)*z,t[2]=(m*N-u*v+h*Z)*z,t[3]=(c*v-C*N-A*Z)*z,t[4]=(I*E-o*k-a*V)*z,t[5]=(n*k-g*E+s*V)*z,t[6]=(u*b-d*N-h*p)*z,t[7]=(l*N-c*b+A*p)*z,t[8]=(o*_-r*E+a*x)*z,t[9]=(i*E-n*_-s*x)*z,t[10]=(d*v-m*b+h*f)*z,t[11]=(C*b-l*v-A*f)*z,t[12]=(r*V-o*D-I*x)*z,t[13]=(n*D-i*V+g*x)*z,t[14]=(m*p-d*Z-u*f)*z,t[15]=(l*Z-C*p+c*f)*z,t):null}function AE(t){var e=t[0],n=t[1],i=t[2],g=t[3],s=t[4],o=t[5],r=t[6],I=t[7],a=t[8],l=t[9],C=t[10],c=t[11],A=t[12],d=t[13],m=t[14],u=t[15],h=e*o-n*s,f=e*r-i*s,p=e*I-g*s,b=n*r-i*o,Z=n*I-g*o,v=i*I-g*r,N=a*d-l*A,x=a*m-C*A,V=a*u-c*A,E=l*m-C*d,D=l*u-c*d,_=C*u-c*m;return h*_-f*D+p*E+b*V-Z*x+v*N}function os(t,e,n){var i=e[0],g=e[1],s=e[2],o=e[3],r=e[4],I=e[5],a=e[6],l=e[7],C=e[8],c=e[9],A=e[10],d=e[11],m=e[12],u=e[13],h=e[14],f=e[15],p=n[0],b=n[1],Z=n[2],v=n[3];return t[0]=p*i+b*r+Z*C+v*m,t[1]=p*g+b*I+Z*c+v*u,t[2]=p*s+b*a+Z*A+v*h,t[3]=p*o+b*l+Z*d+v*f,p=n[4],b=n[5],Z=n[6],v=n[7],t[4]=p*i+b*r+Z*C+v*m,t[5]=p*g+b*I+Z*c+v*u,t[6]=p*s+b*a+Z*A+v*h,t[7]=p*o+b*l+Z*d+v*f,p=n[8],b=n[9],Z=n[10],v=n[11],t[8]=p*i+b*r+Z*C+v*m,t[9]=p*g+b*I+Z*c+v*u,t[10]=p*s+b*a+Z*A+v*h,t[11]=p*o+b*l+Z*d+v*f,p=n[12],b=n[13],Z=n[14],v=n[15],t[12]=p*i+b*r+Z*C+v*m,t[13]=p*g+b*I+Z*c+v*u,t[14]=p*s+b*a+Z*A+v*h,t[15]=p*o+b*l+Z*d+v*f,t}function lC(t,e,n){var i=n[0],g=n[1],s=n[2],o,r,I,a,l,C,c,A,d,m,u,h;return e===t?(t[12]=e[0]*i+e[4]*g+e[8]*s+e[12],t[13]=e[1]*i+e[5]*g+e[9]*s+e[13],t[14]=e[2]*i+e[6]*g+e[10]*s+e[14],t[15]=e[3]*i+e[7]*g+e[11]*s+e[15]):(o=e[0],r=e[1],I=e[2],a=e[3],l=e[4],C=e[5],c=e[6],A=e[7],d=e[8],m=e[9],u=e[10],h=e[11],t[0]=o,t[1]=r,t[2]=I,t[3]=a,t[4]=l,t[5]=C,t[6]=c,t[7]=A,t[8]=d,t[9]=m,t[10]=u,t[11]=h,t[12]=o*i+l*g+d*s+e[12],t[13]=r*i+C*g+m*s+e[13],t[14]=I*i+c*g+u*s+e[14],t[15]=a*i+A*g+h*s+e[15]),t}function CC(t,e,n){var i=n[0],g=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*g,t[5]=e[5]*g,t[6]=e[6]*g,t[7]=e[7]*g,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function dE(t,e,n,i){var g=i[0],s=i[1],o=i[2],r=Math.hypot(g,s,o),I,a,l,C,c,A,d,m,u,h,f,p,b,Z,v,N,x,V,E,D,_,k,z,ee;return r<VI?null:(r=1/r,g*=r,s*=r,o*=r,I=Math.sin(n),a=Math.cos(n),l=1-a,C=e[0],c=e[1],A=e[2],d=e[3],m=e[4],u=e[5],h=e[6],f=e[7],p=e[8],b=e[9],Z=e[10],v=e[11],N=g*g*l+a,x=s*g*l+o*I,V=o*g*l-s*I,E=g*s*l-o*I,D=s*s*l+a,_=o*s*l+g*I,k=g*o*l+s*I,z=s*o*l-g*I,ee=o*o*l+a,t[0]=C*N+m*x+p*V,t[1]=c*N+u*x+b*V,t[2]=A*N+h*x+Z*V,t[3]=d*N+f*x+v*V,t[4]=C*E+m*D+p*_,t[5]=c*E+u*D+b*_,t[6]=A*E+h*D+Z*_,t[7]=d*E+f*D+v*_,t[8]=C*k+m*z+p*ee,t[9]=c*k+u*z+b*ee,t[10]=A*k+h*z+Z*ee,t[11]=d*k+f*z+v*ee,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function dG(t,e,n){var i=Math.sin(n),g=Math.cos(n),s=e[4],o=e[5],r=e[6],I=e[7],a=e[8],l=e[9],C=e[10],c=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*g+a*i,t[5]=o*g+l*i,t[6]=r*g+C*i,t[7]=I*g+c*i,t[8]=a*g-s*i,t[9]=l*g-o*i,t[10]=C*g-r*i,t[11]=c*g-I*i,t}function uE(t,e,n){var i=Math.sin(n),g=Math.cos(n),s=e[0],o=e[1],r=e[2],I=e[3],a=e[8],l=e[9],C=e[10],c=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*g-a*i,t[1]=o*g-l*i,t[2]=r*g-C*i,t[3]=I*g-c*i,t[8]=s*i+a*g,t[9]=o*i+l*g,t[10]=r*i+C*g,t[11]=I*i+c*g,t}function uG(t,e,n){var i=Math.sin(n),g=Math.cos(n),s=e[0],o=e[1],r=e[2],I=e[3],a=e[4],l=e[5],C=e[6],c=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*g+a*i,t[1]=o*g+l*i,t[2]=r*g+C*i,t[3]=I*g+c*i,t[4]=a*g-s*i,t[5]=l*g-o*i,t[6]=C*g-r*i,t[7]=c*g-I*i,t}function hE(t,e){var n=e[0],i=e[1],g=e[2],s=e[4],o=e[5],r=e[6],I=e[8],a=e[9],l=e[10];return t[0]=Math.hypot(n,i,g),t[1]=Math.hypot(s,o,r),t[2]=Math.hypot(I,a,l),t}function mE(t,e){var n=e[0],i=e[1],g=e[2],s=e[3],o=n+n,r=i+i,I=g+g,a=n*o,l=i*o,C=i*r,c=g*o,A=g*r,d=g*I,m=s*o,u=s*r,h=s*I;return t[0]=1-C-d,t[1]=l+h,t[2]=c-u,t[3]=0,t[4]=l-h,t[5]=1-a-d,t[6]=A+m,t[7]=0,t[8]=c+u,t[9]=A-m,t[10]=1-a-C,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fE(t,e,n,i,g,s,o){var r=1/(n-e),I=1/(g-i),a=1/(s-o);return t[0]=s*2*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*I,t[6]=0,t[7]=0,t[8]=(n+e)*r,t[9]=(g+i)*I,t[10]=(o+s)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*a,t[15]=0,t}function pE(t,e,n,i,g){var s=1/Math.tan(e/2),o;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,g!=null&&g!==1/0?(o=1/(i-g),t[10]=(g+i)*o,t[14]=2*g*i*o):(t[10]=-1,t[14]=-2*i),t}function BE(t,e,n,i,g,s,o){var r=1/(e-n),I=1/(i-g),a=1/(s-o);return t[0]=-2*r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*I,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*a,t[11]=0,t[12]=(e+n)*r,t[13]=(g+i)*I,t[14]=(o+s)*a,t[15]=1,t}function bE(t,e,n,i){var g,s,o,r,I,a,l,C,c,A,d=e[0],m=e[1],u=e[2],h=i[0],f=i[1],p=i[2],b=n[0],Z=n[1],v=n[2];return Math.abs(d-b)<VI&&Math.abs(m-Z)<VI&&Math.abs(u-v)<VI?CE(t):(l=d-b,C=m-Z,c=u-v,A=1/Math.hypot(l,C,c),l*=A,C*=A,c*=A,g=f*c-p*C,s=p*l-h*c,o=h*C-f*l,A=Math.hypot(g,s,o),A?(A=1/A,g*=A,s*=A,o*=A):(g=0,s=0,o=0),r=C*o-c*s,I=c*g-l*o,a=l*s-C*g,A=Math.hypot(r,I,a),A?(A=1/A,r*=A,I*=A,a*=A):(r=0,I=0,a=0),t[0]=g,t[1]=r,t[2]=l,t[3]=0,t[4]=s,t[5]=I,t[6]=C,t[7]=0,t[8]=o,t[9]=a,t[10]=c,t[11]=0,t[12]=-(g*d+s*m+o*u),t[13]=-(r*d+I*m+a*u),t[14]=-(l*d+C*m+c*u),t[15]=1,t)}function yE(){var t=new Yn(4);return Yn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function vE(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function hG(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function GE(t){var e=t[0],n=t[1],i=t[2],g=t[3];return Math.hypot(e,n,i,g)}function ZE(t){var e=t[0],n=t[1],i=t[2],g=t[3];return e*e+n*n+i*i+g*g}function RE(t,e){var n=e[0],i=e[1],g=e[2],s=e[3],o=n*n+i*i+g*g+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=i*o,t[2]=g*o,t[3]=s*o,t}function FE(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function SE(t,e,n,i){var g=e[0],s=e[1],o=e[2],r=e[3];return t[0]=g+i*(n[0]-g),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t[3]=r+i*(n[3]-r),t}function UI(t,e,n){var i=e[0],g=e[1],s=e[2],o=e[3];return t[0]=n[0]*i+n[4]*g+n[8]*s+n[12]*o,t[1]=n[1]*i+n[5]*g+n[9]*s+n[13]*o,t[2]=n[2]*i+n[6]*g+n[10]*s+n[14]*o,t[3]=n[3]*i+n[7]*g+n[11]*s+n[15]*o,t}function VE(t,e,n){var i=e[0],g=e[1],s=e[2],o=n[0],r=n[1],I=n[2],a=n[3],l=a*i+r*s-I*g,C=a*g+I*i-o*s,c=a*s+o*g-r*i,A=-o*i-r*g-I*s;return t[0]=l*a+A*-o+C*-I-c*-r,t[1]=C*a+A*-r+c*-o-l*-I,t[2]=c*a+A*-I+l*-r-C*-o,t[3]=e[3],t}(function(){var t=yE();return function(e,n,i,g,s,o){var r,I;for(n||(n=4),i||(i=0),g?I=Math.min(g*n+i,e.length):I=e.length,r=i;r<I;r+=n)t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2],t[3]=e[r+3],s(t,t,o),e[r]=t[0],e[r+1]=t[1],e[r+2]=t[2],e[r+3]=t[3];return e}})();const mG=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),UE=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),xE=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),Bo={};class Pe extends lG{static get IDENTITY(){return Bo.IDENTITY=Bo.IDENTITY||Object.freeze(new Pe(mG)),Bo.IDENTITY}static get ZERO(){return Bo.ZERO=Bo.ZERO||Object.freeze(new Pe(UE)),Bo.ZERO}get INDICES(){return xE}get ELEMENTS(){return 16}get RANK(){return 4}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0);arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,g,s,o,r,I,a,l,C,c,A,d,m,u){return this[0]=e,this[1]=n,this[2]=i,this[3]=g,this[4]=s,this[5]=o,this[6]=r,this[7]=I,this[8]=a,this[9]=l,this[10]=C,this[11]=c,this[12]=A,this[13]=d,this[14]=m,this[15]=u,this.check()}setRowMajor(e,n,i,g,s,o,r,I,a,l,C,c,A,d,m,u){return this[0]=e,this[1]=s,this[2]=a,this[3]=A,this[4]=n,this[5]=o,this[6]=l,this[7]=d,this[8]=i,this[9]=r,this[10]=C,this[11]=m,this[12]=g,this[13]=I,this[14]=c,this[15]=u,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(mG)}fromQuaternion(e){return mE(this,e),this.check()}frustum({left:e,right:n,bottom:i,top:g,near:s,far:o}){return o===1/0?Pe._computeInfinitePerspectiveOffCenter(this,e,n,i,g,s):fE(this,e,n,i,g,s,o),this.check()}static _computeInfinitePerspectiveOffCenter(e,n,i,g,s,o){const r=2*o/(i-n),I=2*o/(s-g),a=(i+n)/(i-n),l=(s+g)/(s-g),C=-1,c=-1,A=-2*o;return e[0]=r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=I,e[6]=0,e[7]=0,e[8]=a,e[9]=l,e[10]=C,e[11]=c,e[12]=0,e[13]=0,e[14]=A,e[15]=0,e}lookAt(e,n,i){return arguments.length===1&&({eye:e,center:n,up:i}=e),n=n||[0,0,0],i=i||[0,1,0],bE(this,e,n,i),this.check()}ortho({left:e,right:n,bottom:i,top:g,near:s=.1,far:o=500}){return BE(this,e,n,i,g,s,o),this.check()}orthographic({fovy:e=45*Math.PI/180,aspect:n=1,focalDistance:i=1,near:g=.1,far:s=500}){if(e>Math.PI*2)throw Error("radians");const o=e/2,r=i*Math.tan(o),I=r*n;return new Pe().ortho({left:-I,right:I,bottom:-r,top:r,near:g,far:s})}perspective({fovy:e=void 0,fov:n=45*Math.PI/180,aspect:i=1,near:g=.1,far:s=500}={}){if(e=e||n,e>Math.PI*2)throw Error("radians");return pE(this,e,i,g,s),this.check()}determinant(){return AE(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e=[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=null){const i=this.getScale(n||[-0,-0,-0]),g=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*g,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*g,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*g,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e=[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=null){const i=this.getScale(n||[-0,-0,-0]),g=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*g,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*g,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*g,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return cE(this,this),this.check()}invert(){return R0(this,this),this.check()}multiplyLeft(e){return os(this,e,this),this.check()}multiplyRight(e){return os(this,this,e),this.check()}rotateX(e){return dG(this,this,e),this.check()}rotateY(e){return uE(this,this,e),this.check()}rotateZ(e){return uG(this,this,e),this.check()}rotateXYZ([e,n,i]){return this.rotateX(e).rotateY(n).rotateZ(i)}rotateAxis(e,n){return dE(this,this,e,n),this.check()}scale(e){return Array.isArray(e)?CC(this,this,e):CC(this,this,[e,e,e]),this.check()}translate(e){return lC(this,this,e),this.check()}transform(e,n){return e.length===4?(n=UI(n||[-0,-0,-0,-0],e,this),SI(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;switch(i){case 2:n=H5(n||[-0,-0],e,this);break;case 3:n=rG(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return SI(n,e.length),n}transformAsVector(e,n){switch(e.length){case 2:n=k5(n||[-0,-0],e,this);break;case 3:n=iG(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return SI(n,e.length),n}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}transformPoint(e,n){return fo("Matrix4.transformPoint","3.0"),this.transformAsPoint(e,n)}transformVector(e,n){return fo("Matrix4.transformVector","3.0"),this.transformAsPoint(e,n)}transformDirection(e,n){return fo("Matrix4.transformDirection","3.0"),this.transformAsVector(e,n)}}function fG(){var t=new Yn(4);return Yn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function WE(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function pG(t,e,n){n=n*.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function BG(t,e,n){var i=e[0],g=e[1],s=e[2],o=e[3],r=n[0],I=n[1],a=n[2],l=n[3];return t[0]=i*l+o*r+g*a-s*I,t[1]=g*l+o*I+s*r-i*a,t[2]=s*l+o*a+i*I-g*r,t[3]=o*l-i*r-g*I-s*a,t}function NE(t,e,n){n*=.5;var i=e[0],g=e[1],s=e[2],o=e[3],r=Math.sin(n),I=Math.cos(n);return t[0]=i*I+o*r,t[1]=g*I+s*r,t[2]=s*I-g*r,t[3]=o*I-i*r,t}function wE(t,e,n){n*=.5;var i=e[0],g=e[1],s=e[2],o=e[3],r=Math.sin(n),I=Math.cos(n);return t[0]=i*I-s*r,t[1]=g*I+o*r,t[2]=s*I+i*r,t[3]=o*I-g*r,t}function TE(t,e,n){n*=.5;var i=e[0],g=e[1],s=e[2],o=e[3],r=Math.sin(n),I=Math.cos(n);return t[0]=i*I+g*r,t[1]=g*I-i*r,t[2]=s*I+o*r,t[3]=o*I-s*r,t}function EE(t,e){var n=e[0],i=e[1],g=e[2];return t[0]=n,t[1]=i,t[2]=g,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-g*g)),t}function cC(t,e,n,i){var g=e[0],s=e[1],o=e[2],r=e[3],I=n[0],a=n[1],l=n[2],C=n[3],c,A,d,m,u;return A=g*I+s*a+o*l+r*C,A<0&&(A=-A,I=-I,a=-a,l=-l,C=-C),1-A>VI?(c=Math.acos(A),d=Math.sin(c),m=Math.sin((1-i)*c)/d,u=Math.sin(i*c)/d):(m=1-i,u=i),t[0]=m*g+u*I,t[1]=m*s+u*a,t[2]=m*o+u*l,t[3]=m*r+u*C,t}function QE(t,e){var n=e[0],i=e[1],g=e[2],s=e[3],o=n*n+i*i+g*g+s*s,r=o?1/o:0;return t[0]=-n*r,t[1]=-i*r,t[2]=-g*r,t[3]=s*r,t}function XE(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function bG(t,e){var n=e[0]+e[4]+e[8],i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var g=0;e[4]>e[0]&&(g=1),e[8]>e[g*3+g]&&(g=2);var s=(g+1)%3,o=(g+2)%3;i=Math.sqrt(e[g*3+g]-e[s*3+s]-e[o*3+o]+1),t[g]=.5*i,i=.5/i,t[3]=(e[s*3+o]-e[o*3+s])*i,t[s]=(e[s*3+g]+e[g*3+s])*i,t[o]=(e[o*3+g]+e[g*3+o])*i}return t}var YE=vE,_E=hG,HE=FE,kE=SE,KE=GE,LE=ZE,yG=RE,ME=function(){var t=gG(),e=sG(1,0,0),n=sG(0,1,0);return function(i,g,s){var o=oG(g,s);return o<-.999999?(aC(t,e,g),tE(t)<1e-6&&aC(t,n,g),D5(t,t),pG(i,t,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(aC(t,g,s),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+o,yG(i,i))}}();(function(){var t=fG(),e=fG();return function(n,i,g,s,o,r){return cC(t,i,o,r),cC(e,g,s,r),cC(n,t,e,2*r*(1-r)),n}})();(function(){var t=nE();return function(e,n,i,g){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=g[0],t[4]=g[1],t[7]=g[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],yG(e,bG(e,t))}})();const PE=[0,0,0,1];class vG extends G0{constructor(e=0,n=0,i=0,g=1){super(-0,-0,-0,-0);Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,i,g)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,i,g){return this[0]=e,this[1]=n,this[2]=i,this[3]=g,this.check()}fromMatrix3(e){return bG(this,e),this.check()}identity(){return WE(this),this.check()}fromAxisRotation(e,n){return pG(this,e,n),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Ft(e)}get y(){return this[1]}set y(e){this[1]=Ft(e)}get z(){return this[2]}set z(e){this[2]=Ft(e)}get w(){return this[3]}set w(e){this[3]=Ft(e)}len(){return KE(this)}lengthSquared(){return LE(this)}dot(e,n){if(n!==void 0)throw new Error("Quaternion.dot only takes one argument");return HE(this,e)}rotationTo(e,n){return ME(this,e,n),this.check()}add(e,n){if(n!==void 0)throw new Error("Quaternion.add only takes one argument");return YE(this,this,e),this.check()}calculateW(){return EE(this,this),this.check()}conjugate(){return XE(this,this),this.check()}invert(){return QE(this,this),this.check()}lerp(e,n,i){return kE(this,e,n,i),this.check()}multiplyRight(e,n){return Mt(!n),BG(this,this,e),this.check()}multiplyLeft(e,n){return Mt(!n),BG(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return NE(this,this,e),this.check()}rotateY(e){return wE(this,this,e),this.check()}rotateZ(e){return TE(this,this,e),this.check()}scale(e){return _E(this,this,e),this.check()}slerp(e,n,i){switch(arguments.length){case 1:({start:e=PE,target:n,ratio:i}=arguments[0]);break;case 2:[n,i]=arguments,e=this;break}return cC(this,e,n,i),this.check()}transformVector4(e,n=e){return VE(n,e,this),SI(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e,n){return this.multiplyLeft(e,n)}multiply(e,n){return this.multiplyRight(e,n)}}var GG={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},ZG=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`;const JE={lightSources:{}};function F0({color:t=[0,0,0],intensity:e=1}={}){return t.map(n=>n*e/255)}function DE({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const i={};return t?i["lighting_uAmbientLight.color"]=F0(t):i["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((g,s)=>{i[`lighting_uPointLight[${s}].color`]=F0(g),i[`lighting_uPointLight[${s}].position`]=g.position,i[`lighting_uPointLight[${s}].attenuation`]=g.attenuation||[1,0,0]}),i.lighting_uPointLightCount=e.length,n.forEach((g,s)=>{i[`lighting_uDirectionalLight[${s}].color`]=F0(g),i[`lighting_uDirectionalLight[${s}].direction`]=g.direction}),i.lighting_uDirectionalLightCount=n.length,i}function RG(t=JE){if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},DE({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return RG({lightSources:e})}return{}}const zE={name:"lights",vs:ZG,fs:ZG,getUniforms:RG,defines:{MAX_LIGHTS:3}},OE=new Uint8Array([0,255,255,255]),jE={pickingSelectedColor:null,pickingHighlightColor:OE,pickingActive:!1,pickingAttribute:!1};function qE(t=jE){const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}const $E=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,eQ=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,tQ={name:"picking",vs:$E,fs:eQ,getUniforms:qE};var nQ=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`;const iQ={};function gQ(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:g=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:g.map(s=>s/255)}}function sQ(t=iQ){if(!("material"in t))return{};const{material:e}=t;return e?gQ(e):{lighting_uEnabled:!1}}const oQ={name:"gouraud-lighting",dependencies:[zE],vs:nQ,defines:{LIGHTING_VERTEX:1},getUniforms:sQ},rQ=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,IQ={name:"transform",vs:rQ,fs:null};class rs{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new rs(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(e={}){const{vs:n="",fs:i="",defines:g={},inject:s={},varyings:o=[],bufferMode:r=35981,transpileToGLSL100:I=!1}=e,a=this._getModuleList(e.modules),l=this._getHash(n),C=this._getHash(i),c=a.map(p=>this._getHash(p.name)).sort(),A=o.map(p=>this._getHash(p)),d=Object.keys(g).sort(),m=Object.keys(s).sort(),u=[],h=[];for(const p of d)u.push(this._getHash(p)),u.push(this._getHash(g[p]));for(const p of m)h.push(this._getHash(p)),h.push(this._getHash(s[p]));const f=`${l}/${C}D${u.join("/")}M${c.join("/")}I${h.join("/")}V${A.join("/")}H${this.stateHash}B${r}${I?"T":""}`;if(!this._programCache[f]){const p=f5(this.gl,{vs:n,fs:i,modules:a,inject:s,defines:g,hookFunctions:this._hookFunctions,transpileToGLSL100:I});this._programCache[f]=new Nv(this.gl,{hash:f,vs:p.vs,fs:p.fs,varyings:o,bufferMode:r}),this._getUniforms[f]=p.getUniforms||(b=>{}),this._useCounts[f]=0}return this._useCounts[f]++,this._programCache[f]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),i={};let g=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const r=this._defaultModules[s],I=r.name;n[g++]=r,i[I]=!0}for(let s=0,o=e.length;s<o;++s){const r=e[s],I=r.name;i[I]||(n[g++]=r,i[I]=!0)}return n.length=g,n}}const aQ={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function lQ(t,e,n){const i={};let g=e.indices;for(const s in e.attributes){const o=e.attributes[s],r=CQ(s,n);if(s==="indices")g=o;else if(o.constant)i[r]=o.value;else{const I=o.value,a=S({},o);delete a.value,i[r]=[new Te(t,I),a],cQ(s,a)}}if(g){const s=g.value||g;O(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const o={size:1,isIndexed:g.isIndexed===void 0?!0:g.isIndexed};i.indices=[new Te(t,{data:s,target:34963}),o]}return i}function CQ(t,e){const{attributeMap:n=aQ}=e||{};return n&&n[t]||t}function cQ(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}O(Number.isFinite(e.size),`attribute ${t} needs size`)}const bo=2,AQ=1e4,dQ="Model needs drawMode and vertexCount",FG=()=>{},uQ={};class Zn{constructor(e,n={}){const{id:i=hg("model")}=n;O(Ol(e)),this.id=i,this.gl=e,this.id=n.id||hg("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||rs.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:g,modules:s,defines:o,inject:r,varyings:I,bufferMode:a,transpileToGLSL100:l}=e;this.programProps={program:n,vs:i,fs:g,modules:s,defines:o,inject:r,varyings:I,bufferMode:a,transpileToGLSL100:l},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},O(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),dQ)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:g,modules:s,defines:o,inject:r,varyings:I,bufferMode:a,transpileToGLSL100:l}=e;this.programProps={program:n,vs:i,fs:g,modules:s,defines:o,inject:r,varyings:I,bufferMode:a,transpileToGLSL100:l},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return O(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return O(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=lQ(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(e={}){if(co(e))return this;const n={};for(const i in e){const g=e[i];n[i]=g.getValue?g.getValue():g}return this.vertexArray.setAttributes(n),this}setUniforms(e={}){return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return I0(this.program.gl,e),this}draw(e={}){this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:g={},attributes:s={},transformFeedback:o=this.transformFeedback,parameters:r={},vertexArray:I=this.vertexArray}=e;this.setAttributes(s),this.updateModuleSettings(n),this.setUniforms(g);let a;se.priority>=bo&&(a=this._logDrawCallStart(bo));const l=this.vertexArray.getDrawParams(),{isIndexed:C=l.isIndexed,indexType:c=l.indexType,indexOffset:A=l.indexOffset,vertexArrayInstanced:d=l.isInstanced}=this.props;d&&!this.isInstanced&&se.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:m,instanceCount:u}=this,{onBeforeRender:h=FG,onAfterRender:f=FG}=this.props;h(),this.program.setUniforms(this.uniforms);const p=this.program.draw(Object.assign(uQ,e,{logPriority:a,uniforms:null,framebuffer:i,parameters:r,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:I,transformFeedback:o,isIndexed:C,indexType:c,isInstanced:m,instanceCount:u,offset:C?A:0}));return f(),se.priority>=bo&&this._logDrawCallEnd(a,I,i),p}transform(e={}){const{discard:n=!0,feedbackBuffers:i,unbindModels:g=[]}=e;let{parameters:s}=e;i&&this._setFeedbackBuffers(i),n&&(s=Object.assign({},s,{[35977]:n})),g.forEach(o=>o.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:s}))}finally{g.forEach(o=>o.vertexArray.bindBuffers())}return this}render(e={}){return se.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:g,modules:s,inject:o,defines:r,varyings:I,bufferMode:a,transpileToGLSL100:l}=this.programProps;n=this.programManager.get({vs:i,fs:g,modules:s,inject:o,defines:r,varyings:I,bufferMode:a,transpileToGLSL100:l}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}O(n instanceof Nv,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new NT(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof Te&&n.delete()}}_setAnimationProps(e){this.animated&&O(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(e={}){if(co(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new wv(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:AQ;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),se.group(bo,`>>> DRAWING MODEL ${this.id}`,{collapsed:se.level<=2})(),e}_logDrawCallEnd(e,n,i,g){if(e===void 0)return;const s=ET({vertexArray:n,header:`${this.id} attributes`,attributes:this._attributes}),{table:o,unusedTable:r,unusedCount:I}=Tv({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:a,count:l}=Tv({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});l>0&&se.log("MISSING UNIFORMS",Object.keys(a))(),I>0&&se.log("UNUSED UNIFORMS",Object.keys(r))();const C=XT(this.vertexArray.configuration);se.table(e,s)(),se.table(e,o)(),se.table(e+1,C)(),g&&g.log({logLevel:bo,message:`Rendered to ${g.id}`}),se.groupEnd(bo,`>>> DRAWING MODEL ${this.id}`)()}}class hQ{constructor(e,n={}){this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(e={}){const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(e={}){const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:g}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:g}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(e={}){this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof Te?i:i.buffer:null}getData(e={}){const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(e={}){this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&O(ye(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const g in this.feedbackMap){const s=this.feedbackMap[g];g in n&&(i[s]=g)}Object.assign(i,e.feedbackBuffers);for(const g in i){const s=i[g];if(typeof s=="string"){const o=n[s],{byteLength:r,usage:I,accessor:a}=o;i[g]=this._createNewBuffer(g,{byteLength:r,usage:I,accessor:a})}}return i}_setupBuffers(e={}){const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,{model:n}){const{program:i}=n;e.transformFeedback=new wv(this.gl,{program:i,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),g=this._getNextIndex();this.bindings[g]=this._updateBinding(this.bindings[g],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const g in this.feedbackMap){const s=this.feedbackMap[g];n[g]=e.feedbackBuffers[s],i[s]=e.sourceBuffers[g],O(i[s]instanceof Te)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new Te(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const mQ="transform_uSampler_",AC="transform_uSize_",SG="transform_position";function fQ({vs:t,sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}){let s=Object.keys(e).length,o=null;const r={};let I=t,a={};if(s>0||n){const l=I.split(`
`),C=l.slice();if(l.forEach((c,A,d)=>{if(s>0){const m=vQ(c,e);if(m){const{updatedLine:u,inject:h}=m;C[A]=u,a=b0([a,h]),Object.assign(r,m.samplerTextureMap),s--}}n&&!o&&(o=yQ(c,n))}),n){O(i);const c=`${AC}${n}`,A=`uniform vec2 ${c};
`,d=`     vec2 ${SG} = transform_getPos(${c});
     gl_Position = vec4(${SG}, 0, 1.);
`;a=b0([a,{"vs:#decl":A,"vs:#main-start":d}])}I=C.join(`
`)}return{vs:I,targetTextureType:o,inject:a,samplerTextureMap:r}}function pQ({sourceTextureMap:t,targetTextureVarying:e,targetTexture:n}){const i={};let g,s;e&&({width:g,height:s}=n,i[`${AC}${e}`]=[g,s]);for(const o in t)({width:g,height:s}=t[o]),i[`${AC}${o}`]=[g,s];return i}function BQ(t){return qv(t,["attribute","in"])}function bQ(t){const e=`${mQ}${t}`,n=`${AC}${t}`,i=`  uniform sampler2D ${e};
  uniform vec2 ${n};`;return{samplerName:e,sizeName:n,uniformDeclerations:i}}function yQ(t,e){const n=qv(t,["varying","out"]);return n&&n.name===e?n.type:null}function vQ(t,e){const n={},i=BQ(t);if(!i)return null;const{type:g,name:s}=i;if(s&&e[s]){const o=`// ${t} => Replaced by Transform with a sampler`,{samplerName:r,sizeName:I,uniformDeclerations:a}=bQ(s),l=F5(g),C=`  ${g} ${s} = transform_getInput(${r}, ${I}).${l};
`;return n[r]=s,{updatedLine:o,inject:{"vs:#decl":a,"vs:#main-start":C},samplerTextureMap:n}}return null}const GQ={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},ZQ="transform_output";class RQ{constructor(e,n={}){this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(e={}){const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(e={}){const{sourceBuffers:n,sourceTextures:i,framebuffer:g,targetTexture:s}=this.bindings[this.currentIndex],o=Object.assign({},n,e.attributes),r=Object.assign({},e.uniforms),I=Object.assign({},e.parameters);let a=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const C in this.samplerTextureMap){const c=this.samplerTextureMap[C];r[C]=i[c]}this._setSourceTextureParameters();const l=pQ({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(r,l)}return this.hasTargetTexture&&(a=!1,I.viewport=[0,0,g.width,g.height]),{attributes:o,framebuffer:g,uniforms:r,discard:a,parameters:I}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(e={}){this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData({packed:e=!1}={}){const{framebuffer:n}=this.bindings[this.currentIndex],i=ql(n);if(!e)return i;const g=i.constructor,s=S5(this.targetTextureType),o=new g(i.length*s/4);let r=0;for(let I=0;I<i.length;I+=4)for(let a=0;a<s;a++)o[r++]=i[I+a];return o}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(e={}){const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof on)return i;const g=n[i];return g?(this._targetRefTexName=i,this._createNewTexture(g)):null}_setupTextures(e={}){const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:g}=e,s=this._createTargetTexture({sourceTextures:i,textureOrReference:g});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,g,s)=>{s[g]=g}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new Te(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),g=this._getNextIndex();this.bindings[g]=this._updateBinding(this.bindings[g],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:g,targetTexture:s}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,g),Object.assign(e.sourceBuffers,i),s){e.targetTexture=s;const{width:o,height:r}=s,{framebuffer:I}=e;I?(I.update({attachments:{[36064]:s},resizeAttachments:!1}),I.resize({width:o,height:r})):e.framebuffer=new Ct(this.gl,{id:"transform-framebuffer",width:o,height:r,attachments:{[36064]:s}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(GQ)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=vv(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(e={}){const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:g,uniforms:s,targetTextureType:o,inject:r,samplerTextureMap:I}=fQ({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),a=b0([e.inject||{},r]);this.targetTextureType=o,this.samplerTextureMap=I;const l=e._fs||$v({version:Rv(g),input:this.targetTextureVarying,inputType:o,output:ZQ}),C=this.hasSourceTextures||this.targetTextureVarying?[IQ].concat(e.modules||[]):e.modules;return{vs:g,fs:l,modules:C,uniforms:s,inject:a}}}class S0{static isSupported(e){return ye(e)}constructor(e,n={}){this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(e={}){const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();O(e,"Nothing to swap")}getBuffer(e=null){return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(e={}){const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const g=i.getData(e);if(g)return g}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(e={}){"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(e={}){const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Zn(n,Object.assign({},e,{fs:e.fs||$v({version:Rv(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const g of i)n=g.updateModelProps(n);return n}_buildResourceTransforms(e,n){FQ(n)&&(this.bufferTransform=new hQ(e,n)),SQ(n)&&(this.textureTransform=new RQ(e,n)),O(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const g of i)n=Object.assign(n,g.getDrawOptions(n));return n}}function FQ(t){return!!(!co(t.feedbackBuffers)||!co(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function SQ(t){return!!(!co(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const VG={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class ni{static get DRAW_MODE(){return VG}constructor(e={}){const{id:n=hg("geometry"),drawMode:i=VG.TRIANGLES,attributes:g={},indices:s=null,vertexCount:o=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(g,s),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?S({indices:this.indices},this.attributes):this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let g=e[i];g=ArrayBuffer.isView(g)?{value:g}:g,O(ArrayBuffer.isView(g.value),`${this._print(i)}: must be typed array or object with value as typed array`),(i==="POSITION"||i==="positions")&&!g.size&&(g.size=3),i==="indices"?(O(!this.indices),this.indices=g):this.attributes[i]=g}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const g in e){const s=e[g],{value:o,size:r,constant:I}=s;!I&&o&&r>=1&&(i=Math.min(i,o.length/r))}return O(Number.isFinite(i)),i}}let VQ=1,UQ=1;class UG{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:g=1,repeat:s=1}=e,o=VQ++,r={time:0,delay:n,duration:i,rate:g,repeat:s};return this._setChannelTime(r,this.time),this.channels.set(o,r),o}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const g of n)this._setChannelTime(g,this.time);const i=this.animations.values();for(const g of i){const{animation:s,channel:o}=g;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=UQ++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,g=e.duration*e.repeat;i>=g?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const xQ=`
struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,WQ=`
#define SMOOTH_EDGE_RADIUS 0.5

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`;var NQ={name:"geometry",vs:xQ,fs:WQ};const ce={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ce,"IDENTITY",{get:()=>pe.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")()||0});const ii={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},pg={common:0,meters:1,pixels:2},xG={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},wQ=Object.keys(ce).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(ce[t],";")).join(""),TQ=Object.keys(ii).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(ii[t],";")).join(""),EQ=Object.keys(pg).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(pg[t],";")).join("");var QQ="".concat(wQ,`
`).concat(TQ,`
`).concat(EQ,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      float y = clamp(geometry.worldPosition.y, -89.9, 89.9);
      return 1.0 / cos(radians(y));
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  return normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size(position_world.z),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
`);function XQ(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function dC(t){let e={},n;return i=>{for(const g in i)if(!XQ(i[g],e[g])){n=t(i),e=i;break}return n}}const WG=[0,0,0,0],YQ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],_Q=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],HQ=[0,0,0],kQ=[0,0,0],KQ=dC(PQ);function NG(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:kQ;n.length<3&&(n=[n[0],n[1],0]);let i=n,g,s=!0;switch(e===ce.LNGLAT_OFFSETS||e===ce.METER_OFFSETS?g=n:g=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case ii.WEB_MERCATOR:(e===ce.LNGLAT||e===ce.CARTESIAN)&&(g=[0,0,0],s=!1);break;case ii.WEB_MERCATOR_AUTO_OFFSET:e===ce.LNGLAT?i=g:e===ce.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],g=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case ii.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case ii.GLOBE:s=!1,g=null;break;default:s=!1}return{geospatialOrigin:g,shaderCoordinateOrigin:i,offsetMode:s}}function LQ(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:g}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,r=WG,I=WG,a=t.cameraPosition;const{geospatialOrigin:l,shaderCoordinateOrigin:C,offsetMode:c}=NG(t,e,n);return c&&(I=t.projectPosition(l||C),a=[a[0]-I[0],a[1]-I[1],a[2]-I[2]],I[3]=1,r=UI([],I,o),s=i||s,o=os([],g,s),o=os([],o,YQ)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:r,originCommon:I,cameraPosCommon:a,shaderCoordinateOrigin:C,geospatialOrigin:l}}function MQ(){let{viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=ce.DEFAULT,coordinateOrigin:g,autoWrapLongitude:s=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};i===ce.DEFAULT&&(i=t.isGeospatial?ce.LNGLAT:ce.CARTESIAN);const o=KQ({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:g});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||_Q,o}function PQ(t){let{viewport:e,devicePixelRatio:n,coordinateSystem:i,coordinateOrigin:g}=t;const{projectionCenter:s,viewProjectionMatrix:o,originCommon:r,cameraPosCommon:I,shaderCoordinateOrigin:a,geospatialOrigin:l}=LQ(e,i,g),C=e.getDistanceScales(),c=[e.width*n,e.height*n],A=UI([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,d={project_uCoordinateSystem:i,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:a,project_uCommonOrigin:r.slice(0,3),project_uCenter:s,project_uPseudoMeters:Boolean(e._pseudoMeters),project_uViewportSize:c,project_uDevicePixelRatio:n,project_uFocalDistance:A,project_uCommonUnitsPerMeter:C.unitsPerMeter,project_uCommonUnitsPerWorldUnit:C.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:HQ,project_uScale:e.scale,project_uViewProjectionMatrix:o,project_uCameraPosition:I};if(l){const m=e.getDistanceScales(l);switch(i){case ce.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=m.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=m.unitsPerMeter2;break;case ce.LNGLAT:case ce.LNGLAT_OFFSETS:e._pseudoMeters||(d.project_uCommonUnitsPerMeter=m.unitsPerMeter),d.project_uCommonUnitsPerWorldUnit=m.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=m.unitsPerDegree2;break;case ce.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,m.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,m.unitsPerMeter2[2]];break}}return d}const JQ={};function DQ(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:JQ;return t.viewport?MQ(t):{}}var V0={name:"project",dependencies:[x5,NQ],vs:QQ,getUniforms:DQ};const zQ=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    mat3 rotation = project_get_orientation_matrix(projectedPosition);
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`;var Bg={name:"project32",dependencies:[V0],vs:zQ};function OQ(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function yo(t,e){const n=UI([],e,t);return hG(n,n,1/n[3]),n}function wG(t,e){const n=t%e;return n<0?e+n:n}function TG(t,e,n){return t<e?e:t>n?n:t}function jQ(t){return Math.log(t)*Math.LOG2E}const U0=Math.log2||jQ;function Si(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const _n=Math.PI,EG=_n/4,Hn=_n/180,x0=180/_n,xI=512,W0=4003e4,uC=85.051129,qQ=1.5;function $Q(t){return U0(t)}function bg([t,e]){Si(Number.isFinite(t)),Si(Number.isFinite(e)&&e>=-90&&e<=90,"invalid latitude");const n=t*Hn,i=e*Hn,g=xI*(n+_n)/(2*_n),s=xI*(_n+Math.log(Math.tan(EG+i*.5)))/(2*_n);return[g,s]}function vo([t,e]){const n=t/xI*(2*_n)-_n,i=2*(Math.atan(Math.exp(e/xI*(2*_n)-_n))-EG);return[n*x0,i*x0]}function eX({latitude:t}){Si(Number.isFinite(t));const e=Math.cos(t*Hn);return $Q(W0*e)-9}function N0({latitude:t,longitude:e,highPrecision:n=!1}){Si(Number.isFinite(t)&&Number.isFinite(e));const i={},g=xI,s=Math.cos(t*Hn),o=g/360,r=o/s,I=g/W0/s;if(i.unitsPerMeter=[I,I,I],i.metersPerUnit=[1/I,1/I,1/I],i.unitsPerDegree=[o,r,I],i.degreesPerUnit=[1/o,1/r,1/I],n){const a=Hn*Math.tan(t*Hn)/s,l=o*a/2,C=g/W0*a,c=C/r*I;i.unitsPerDegree2=[0,l,C],i.unitsPerMeter2=[c,0,c]}return i}function QG(t,e){const[n,i,g]=t,[s,o,r]=e,{unitsPerMeter:I,unitsPerMeter2:a}=N0({longitude:n,latitude:i,highPrecision:!0}),l=bg(t);l[0]+=s*(I[0]+a[0]*o),l[1]+=o*(I[1]+a[1]*o);const C=vo(l),c=(g||0)+(r||0);return Number.isFinite(g)||Number.isFinite(r)?[C[0],C[1],c]:C}function tX({height:t,pitch:e,bearing:n,altitude:i,scale:g,center:s=null}){const o=OQ();return lC(o,o,[0,0,-i]),dG(o,o,-e*Hn),uG(o,o,n*Hn),g/=t,CC(o,o,[g,g,g]),s&&lC(o,o,J5([],s)),o}function nX({width:t,height:e,fovy:n=hC(qQ),altitude:i,pitch:g=0,nearZMultiplier:s=1,farZMultiplier:o=1}){i!==void 0&&(n=hC(i));const r=.5*n*Hn,I=XG(n),a=g*Hn,l=Math.sin(r)*I/Math.sin(Math.min(Math.max(Math.PI/2-a-r,.01),Math.PI-.01)),C=Math.sin(a)*l+I;return{fov:2*r,aspect:t/e,focalDistance:I,near:s,far:C*o}}function hC(t){return 2*Math.atan(.5/t)*x0}function XG(t){return .5/Math.tan(.5*t*Hn)}function YG(t,e){const[n,i,g=0]=t;return Si(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(g)),yo(e,[n,i,g,1])}function mC(t,e,n=0){const[i,g,s]=t;if(Si(Number.isFinite(i)&&Number.isFinite(g),"invalid pixel coordinate"),Number.isFinite(s))return yo(e,[i,g,s,1]);const o=yo(e,[i,g,0,1]),r=yo(e,[i,g,1,1]),I=o[2],a=r[2],l=I===a?0:((n||0)-I)/(a-I);return nG([],o,r,l)}function iX({width:t,height:e,bounds:n,minExtent:i=0,maxZoom:g=24,padding:s=0,offset:o=[0,0]}){const[[r,I],[a,l]]=n;if(Number.isFinite(s)){const v=s;s={top:v,bottom:v,left:v,right:v}}else Si(Number.isFinite(s.top)&&Number.isFinite(s.bottom)&&Number.isFinite(s.left)&&Number.isFinite(s.right));const C=bg([r,TG(l,-uC,uC)]),c=bg([a,TG(I,-uC,uC)]),A=[Math.max(Math.abs(c[0]-C[0]),i),Math.max(Math.abs(c[1]-C[1]),i)],d=[t-s.left-s.right-Math.abs(o[0])*2,e-s.top-s.bottom-Math.abs(o[1])*2];Si(d[0]>0&&d[1]>0);const m=d[0]/A[0],u=d[1]/A[1],h=(s.right-s.left)/2/m,f=(s.bottom-s.top)/2/u,p=[(c[0]+C[0])/2+h,(c[1]+C[1])/2+f],b=vo(p),Z=Math.min(g,U0(Math.abs(Math.min(m,u))));return Si(Number.isFinite(Z)),{longitude:b[0],latitude:b[1],zoom:Z}}const _G=Math.PI/180;function gX(t,e=0){const{width:n,height:i,unproject:g}=t,s={targetZ:e},o=g([0,i],s),r=g([n,i],s);let I,a;const l=t.fovy?.5*t.fovy*_G:Math.atan(.5/t.altitude),C=(90-t.pitch)*_G;return l>C-.01?(I=HG(t,0,e),a=HG(t,n,e)):(I=g([0,0],s),a=g([n,0],s)),[o,r,a,I]}function HG(t,e,n){const{pixelUnprojectionMatrix:i}=t,g=yo(i,[e,0,1,1]),s=yo(i,[e,t.height,1,1]),r=(n*t.distanceScales.unitsPerMeter[2]-g[2])/(s[2]-g[2]),I=nG([],g,s,r),a=vo(I);return a[2]=n,a}const kG=512;function sX({width:t,height:e,longitude:n,latitude:i,zoom:g,pitch:s=0,bearing:o=0}){(n<-180||n>180)&&(n=wG(n+180,360)-180),(o<-180||o>180)&&(o=wG(o+180,360)-180);const r=U0(e/kG);if(g<=r)g=r,i=0;else{const I=e/2/Math.pow(2,g),a=vo([0,I])[1];if(i<a)i=a;else{const l=vo([0,kG-I])[1];i>l&&(i=l)}}return{width:t,height:e,longitude:n,latitude:i,zoom:g,pitch:s,bearing:o}}const oX=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,rX=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,IX=dC(AX),aX=dC(dX),lX=[0,0,0,1],CX=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function cX(t,e){const[n,i,g]=t,s=mC([n,i,g],e);return Number.isFinite(g)?s:[s[0],s[1],0]}function AX(t){let{viewport:e,center:n}=t;return new Pe(e.viewProjectionMatrix).invert().transform(n)}function dX(t){let{viewport:e,shadowMatrices:n}=t;const i=[],g=e.pixelUnprojectionMatrix,s=e.isGeospatial?void 0:1,o=[[0,0,s],[e.width,0,s],[0,e.height,s],[e.width,e.height,s],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(r=>cX(r,g));for(const r of n){const I=r.clone().translate(new j(e.center).negate()),a=o.map(C=>I.transform(C)),l=new Pe().ortho({left:Math.min(...a.map(C=>C[0])),right:Math.max(...a.map(C=>C[0])),bottom:Math.min(...a.map(C=>C[1])),top:Math.max(...a.map(C=>C[1])),near:Math.min(...a.map(C=>-C[2])),far:Math.max(...a.map(C=>-C[2]))});i.push(l.multiplyRight(r))}return i}function uX(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||lX,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},i=IX({viewport:t.viewport,center:e.project_uCenter}),g=[],s=aX({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let o=0;o<t.shadowMatrices.length;o++){const r=s[o],I=r.clone().translate(new j(t.viewport.center).negate());e.project_uCoordinateSystem===ce.LNGLAT&&e.project_uProjectionMode===ii.WEB_MERCATOR?(s[o]=I,g[o]=i):(s[o]=r.clone().multiplyRight(CX),g[o]=I.transform(i))}for(let o=0;o<s.length;o++)n["shadow_uViewProjectionMatrices[".concat(o,"]")]=s[o],n["shadow_uProjectCenters[".concat(o,"]")]=g[o],t.shadowMaps&&t.shadowMaps.length>0?n["shadow_uShadowMap".concat(o)]=t.shadowMaps[o]:n["shadow_uShadowMap".concat(o)]=t.dummyShadowMap;return n}var w0={name:"shadow",dependencies:[V0],vs:oX,fs:rX,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0){const{shadowEnabled:n=!0}=t;return n&&t.shadowMatrices&&t.shadowMatrices.length>0?uX(t,e):{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1}}return{}}},yg=S({inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},tQ);const hX=[V0],mX=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function fX(t){const e=rs.getDefaultProgramManager(t);for(const n of hX)e.addDefaultModule(n);for(const n of mX)e.addShaderHook(n);return e}const pX=[255,255,255],BX=1;let bX=0;class yX{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n=pX}=e,{intensity:i=BX}=e;this.id=e.id||"ambient-".concat(bX++),this.color=n,this.intensity=i,this.type="ambient"}}const vX=[255,255,255],GX=1,ZX=[0,0,-1];let RX=0;class KG{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n=vX}=e,{intensity:i=GX}=e,{direction:g=ZX}=e,{_shadow:s=!1}=e;this.id=e.id||"directional-".concat(RX++),this.color=n,this.intensity=i,this.type="directional",this.direction=new j(g).normalize().toArray(),this.shadow=s}getProjectedLight(){return this}}class LG{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n="effect"}=e;this.id=n,this.props=S({},e)}preRender(){}getModuleParameters(){}cleanup(){}}class FX{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i="pass"}=n;this.id=i,this.gl=e,this.props=S({},n)}setProps(e){Object.assign(this.props,e)}render(){}cleanup(){}}class T0 extends FX{render(e){const n=this.gl;return Zi(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{viewports:n,views:i,onViewportActive:g,clearCanvas:s=!0}=e;e.pass=e.pass||"unknown";const o=this.gl;s&&VX(o);const r=[];for(const I of n){const a=I.viewport||I,l=i&&i[a.id];g(a);const C=this._getDrawLayerParams(a,e);e.view=l;const c=a.subViewports||[a];for(const A of c){e.viewport=A;const d=this._drawLayersInViewport(o,e,C);r.push(d)}}return r}_getDrawLayerParams(e,n){let{layers:i,pass:g,layerFilter:s,effects:o,moduleParameters:r}=n;const I=[],a=MG(),l={viewport:e,isPicking:g.startsWith("picking"),renderPass:g},C={};for(let c=0;c<i.length;c++){const A=i[c],d=this._shouldDrawLayer(A,l,s,C),m=a(A,d),u={shouldDrawLayer:d,layerRenderIndex:m};d&&(u.moduleParameters=this._getModuleParameters(A,o,g,r),u.layerParameters=this.getLayerParameters(A,c,e)),I[c]=u}return I}_drawLayersInViewport(e,n,i){let{layers:g,pass:s,viewport:o,view:r}=n;const I=SX(e,{viewport:o});if(r&&r.props.clear){const l=r.props.clear===!0?{color:!0,depth:!0}:r.props.clear;Xn(e,{scissorTest:!0,scissor:I},()=>I0(e,l))}const a={totalCount:g.length,visibleCount:0,compositeCount:0,pickableCount:0};Zi(e,{viewport:I});for(let l=0;l<g.length;l++){const C=g[l],{shouldDrawLayer:c,layerRenderIndex:A,moduleParameters:d,layerParameters:m}=i[l];if(c&&C.props.pickable&&a.pickableCount++,C.isComposite)a.compositeCount++;else if(c){a.visibleCount++,d.viewport=o;try{C.drawLayer({moduleParameters:d,uniforms:{layerIndex:A},parameters:m})}catch(u){C.raiseError(u,"drawing ".concat(C," to ").concat(s))}}}return a}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n){return e.props.parameters}_shouldDrawLayer(e,n,i,g){if(!(this.shouldDrawLayer(e)&&e.props.visible))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(i){const r=n.layer.id;if(r in g||(g[r]=i(n)),!g[r])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,g){const s=Object.assign(Object.create(e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Co(this.gl)});if(n)for(const o of n)Object.assign(s,o.getModuleParameters(e));return Object.assign(s,this.getModuleParameters(e,n),g)}}function MG(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={},i=(g,s)=>{const o=g.props._offset,r=g.id,I=g.parent&&g.parent.id;let a;if(I&&!(I in e)&&i(g.parent,!1),I in n){const l=n[I]=n[I]||MG(e[I],e);a=l(g,s),n[r]=l}else Number.isFinite(o)?(a=o+(e[I]||0),n[r]=null):a=t;return s&&a>=t&&(t=a+1),e[r]=a,a};return i}function SX(t,e){let{viewport:n}=e;const i=t.canvas?t.canvas.clientHeight||t.canvas.height:100,g=n,s=Co(t);return[g.x*s,(i-g.y-g.height)*s,g.width*s,g.height*s]}function VX(t){const e=t.drawingBufferWidth,n=t.drawingBufferHeight;Zi(t,{viewport:[0,0,e,n]}),t.clear(16384|256)}class UX extends T0{constructor(e,n){super(e,n);this.shadowMap=new on(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new uo(e,{format:33189,width:1,height:1}),this.fbo=new Ct(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const n=this.fbo;Xn(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],g=Co(this.gl),s=i.width*g,o=i.height*g;(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render(J(S({},e),{target:n,pass:"shadow"}))})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const xX={color:[255,255,255],intensity:1},PG=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],WX=[0,0,0,200/255];class JG extends LG{constructor(e){super(e);this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowColor=WX,this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.shadow=!1,this.programManager=null;for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow)}preRender(e,n){let{layers:i,layerFilter:g,viewports:s,onViewportActive:o,views:r}=n;if(!!this.shadow){this.shadowMatrices=this._createLightMatrix(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=rs.getDefaultProgramManager(e),w0&&this.programManager.addDefaultModule(w0)),this.dummyShadowMap||(this.dummyShadowMap=new on(e,{width:1,height:1}));for(let I=0;I<this.shadowPasses.length;I++)this.shadowPasses[I].render({layers:i,layerFilter:g,viewports:s,onViewportActive:o,views:r,moduleParameters:{shadowLightId:I,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(w0),this.programManager=null)}_createLightMatrix(){const e=[];for(const n of this.directionalLights){const i=new Pe().lookAt({eye:new j(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new UX(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new yX(xX),this.directionalLights.push(new KG(PG[0]),new KG(PG[1])))}}class NX{constructor(e){this._pool=[],this.props={overAlloc:2,poolSize:100},this.setProps(e)}setProps(e){Object.assign(this.props,e)}allocate(e,n,i){let{size:g=1,type:s,padding:o=0,copy:r=!1,initialize:I=!1,maxCount:a}=i;const l=s||e&&e.constructor||Float32Array,C=n*g+o;if(ArrayBuffer.isView(e)){if(C<=e.length)return e;if(C*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,C)}let c;a&&(c=a*g+o);const A=this._allocate(l,C,I,c);return e&&r?A.set(e):I||A.fill(0,0,4),this._release(e),A}release(e){this._release(e)}_allocate(e,n,i,g){let s=Math.max(Math.ceil(n*this.props.overAlloc),1);s>g&&(s=g);const o=this._pool,r=e.BYTES_PER_ELEMENT*s,I=o.findIndex(a=>a.byteLength>=r);if(I>=0){const a=new e(o.splice(I,1)[0],0,s);return i&&a.fill(0),a}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:g}=i,s=n.findIndex(o=>o.byteLength>=g);s<0?n.push(i):(s>0||n.length<this.props.poolSize)&&n.splice(s,0,i),n.length>this.props.poolSize&&n.shift()}}var Go=new NX;function WI(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function wX(t,e){const n=t%e;return n<0?e+n:n}function TX(t){return[t[12],t[13],t[14]]}function EX(t){const e={};return e.left=Zo(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),e.right=Zo(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),e.bottom=Zo(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),e.top=Zo(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),e.near=Zo(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),e.far=Zo(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14]),e}const DG=new j;function Zo(t,e,n,i){DG.set(t,e,n);const g=DG.len();return{distance:i/g,normal:new j(-t/g,-e/g,-n/g)}}function QX(t){return t-Math.fround(t)}let NI;function E0(t,e){let{size:n=1,startIndex:i=0,endIndex:g}=e;Number.isFinite(g)||(g=t.length);const s=(g-i)/n;NI=Go.allocate(NI,s,{type:Float32Array,size:n*2});let o=i,r=0;for(;o<g;){for(let I=0;I<n;I++){const a=t[o++];NI[r+I]=a,NI[r+I+n]=QX(a)}r+=n*2}return NI.subarray(0,s*n*2)}const XX=Math.PI/180,YX=WI(),Q0=[0,0,0],_X=0,HX={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class vg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=null,x:i=0,y:g=0,width:s=1,height:o=1}=e;this.id=n||this.constructor.displayName||"viewport",this.x=i,this.y=g,this.width=s||1,this.height=o||1,this._frustumPlanes={},this._initViewMatrix(e),this._initProjectionMatrix(e),this._initPixelMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?ii.WEB_MERCATOR:ii.WEB_MERCATOR_AUTO_OFFSET:ii.IDENTITY}equals(e){return e instanceof vg?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&fg(e.projectionMatrix,this.projectionMatrix)&&fg(e.viewMatrix,this.viewMatrix):!1}project(e){let{topLeft:n=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=this.projectPosition(e),g=YG(i,this.pixelProjectionMatrix),[s,o]=g,r=n?o:this.height-o;return e.length===2?[s,r]:[s,r,g[2]]}unproject(e){let{topLeft:n=!0,targetZ:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[g,s,o]=e,r=n?s:this.height-s,I=i&&i*this.distanceScales.unitsPerMeter[2],a=mC([g,r,o],this.pixelUnprojectionMatrix,I),[l,C,c]=this.unprojectPosition(a);return Number.isFinite(o)?[l,C,c]:Number.isFinite(i)?[l,C,i]:[l,C]}projectPosition(e){const[n,i]=this.projectFlat(e),g=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,g]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),g=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,g]}projectFlat(e){return this.isGeospatial?bg(e):e}unprojectFlat(e){return this.isGeospatial?vo(e):e}getBounds(){const n={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},i=this.unproject([0,0],n),g=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(i[0],g[0],s[0],o[0]),Math.min(i[1],g[1],s[1],o[1]),Math.max(i[0],g[0],s[0],o[0]),Math.max(i[1],g[1],s[1],o[1])]}getDistanceScales(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return e?N0({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel(e){let{x:n,y:i,width:g=1,height:s=1}=e;return n<this.x+this.width&&this.x<n+g&&i<this.y+this.height&&this.y<i+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,EX(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}getCameraPosition(){return this.cameraPosition}getCameraDirection(){return this.cameraDirection}getCameraUp(){return this.cameraUp}_createProjectionMatrix(e){let{orthographic:n,fovyRadians:i,aspect:g,focalDistance:s,near:o,far:r}=e;return n?new Pe().orthographic({fovy:i,aspect:g,focalDistance:s,near:o,far:r}):new Pe().perspective({fovy:i,aspect:g,near:o,far:r})}_initViewMatrix(e){const{viewMatrix:n=YX,longitude:i=null,latitude:g=null,zoom:s=null,position:o=null,modelMatrix:r=null,focalDistance:I=1,distanceScales:a=null}=e;this.isGeospatial=Number.isFinite(g)&&Number.isFinite(i),this.zoom=s,Number.isFinite(this.zoom)||(this.zoom=this.isGeospatial?eX({latitude:g})+Math.log2(I):_X);const l=Math.pow(2,this.zoom);this.scale=l,this.distanceScales=this.isGeospatial?N0({latitude:g,longitude:i}):a||HX,this.focalDistance=I,this.distanceScales.metersPerUnit=new j(this.distanceScales.metersPerUnit),this.distanceScales.unitsPerMeter=new j(this.distanceScales.unitsPerMeter),this.position=Q0,this.meterOffset=Q0,o&&(this.position=o,this.modelMatrix=r,this.meterOffset=r?r.transformVector(o):o),this.isGeospatial?(this.longitude=i,this.latitude=g,this.center=this._getCenterInWorld({longitude:i,latitude:g})):this.center=o?this.projectPosition(o):[0,0,0],this.viewMatrixUncentered=n,this.viewMatrix=new Pe().multiplyRight(this.viewMatrixUncentered).translate(new j(this.center||Q0).negate())}_getCenterInWorld(e){let{longitude:n,latitude:i}=e;const{meterOffset:g,distanceScales:s}=this,o=new j(this.projectPosition([n,i,0]));if(g){const r=new j(g).scale(s.unitsPerMeter);o.add(r)}return o}_initProjectionMatrix(e){const{projectionMatrix:n=null,orthographic:i=!1,fovyRadians:g,fovy:s=75,near:o=.1,far:r=1e3,focalDistance:I=1}=e;this.projectionMatrix=n||this._createProjectionMatrix({orthographic:i,fovyRadians:g||s*XX,aspect:this.width/this.height,focalDistance:I,near:o,far:r})}_initPixelMatrices(){const e=WI();os(e,e,this.projectionMatrix),os(e,e,this.viewMatrix),this.viewProjectionMatrix=e,this.viewMatrixInverse=R0([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=TX(this.viewMatrixInverse);const n=WI(),i=WI();CC(n,n,[this.width/2,-this.height/2,1]),lC(n,n,[1,-1,0]),os(i,n,this.viewProjectionMatrix),this.pixelProjectionMatrix=i,this.viewportMatrix=n,this.pixelUnprojectionMatrix=R0(WI(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||pe.warn("Pixel project matrix not invertible")()}}vg.displayName="Viewport";const kX=512,KX=4003e4,LX=Math.PI/180;function zG(t){const e=Math.cos(t*LX);return kX/KX/e}class Ro extends vg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:n=0,longitude:i=0,zoom:g=11,pitch:s=0,bearing:o=0,nearZMultiplier:r=.1,farZMultiplier:I=1.01,orthographic:a=!1,projectionMatrix:l,repeat:C=!1,worldOffset:c=0,legacyMeterSizes:A=!1}=e;let{width:d,height:m,altitude:u=1.5}=e;const h=Math.pow(2,g);d=d||1,m=m||1;let f,p=null;l?(u=l[5]/2,f=hC(u)):(e.fovy?(f=e.fovy,u=XG(f)):f=hC(u),p=nX({width:d,height:m,pitch:s,fovy:f,nearZMultiplier:r,farZMultiplier:I}));let b=tX({height:m,pitch:s,bearing:o,scale:h,altitude:u});c&&(b=new Pe().translate([512*c,0,0]).multiplyLeft(b));super(J(S(J(S({},e),{width:d,height:m,viewMatrix:b,longitude:i,latitude:n,zoom:g}),p),{fovy:f,focalDistance:u}));this.latitude=n,this.longitude=i,this.zoom=g,this.pitch=s,this.bearing=o,this.altitude=u,this.fovy=f,this.orthographic=a,this._subViewports=C?[]:null,this._pseudoMeters=A,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let g=n;g<=i;g++){const s=g?new Ro(J(S({},this),{worldOffset:g})):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),g=(e[2]||0)*zG(e[1]);return[n,i,g]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),g=(e[2]||0)/zG(i);return[n,i,g]}addMetersToLngLat(e,n){return QG(e,n)}panByPosition(e,n){const i=mC(n,this.pixelUnprojectionMatrix),g=this.projectFlat(e),s=IC([],g,tG([],i)),o=IC([],this.center,s),[r,I]=this.unprojectFlat(o);return{longitude:r,latitude:I}}getBounds(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=gX(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:i,height:g}=this,{longitude:s,latitude:o,zoom:r}=iX(S({width:i,height:g,bounds:e},n));return new Ro({width:i,height:g,longitude:s,latitude:o,zoom:r})}}Ro.displayName="WebMercatorViewport";function X0(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=e.projectPosition(t);if(n&&e instanceof Ro){const[g,s,o=0]=t,r=e.getDistanceScales([g,s]);i[2]=o*r.unitsPerMeter[2]}return i}function MX(t){const e=S({},t);let{coordinateSystem:n}=t;const{viewport:i,coordinateOrigin:g,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return n===ce.DEFAULT&&(n=i.isGeospatial?ce.LNGLAT:ce.CARTESIAN),s===void 0&&(e.fromCoordinateSystem=n),o===void 0&&(e.fromCoordinateOrigin=g),e.coordinateSystem=n,e}function OG(t,e){let{viewport:n,modelMatrix:i,coordinateSystem:g,coordinateOrigin:s,offsetMode:o}=e,[r,I,a=0]=t;switch(i&&([r,I,a]=UI([],[r,I,a,1],i)),g){case ce.LNGLAT:return X0([r,I,a],n,o);case ce.LNGLAT_OFFSETS:return X0([r+s[0],I+s[1],a+(s[2]||0)],n,o);case ce.METER_OFFSETS:return X0(QG(s,[r,I,a]),n,o);case ce.CARTESIAN:default:return n.isGeospatial?[r+s[0],I+s[1],a+s[2]]:n.projectPosition([r,I,a])}}function PX(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:g,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:r}=MX(e),{geospatialOrigin:I,shaderCoordinateOrigin:a,offsetMode:l}=NG(n,i,g),C=OG(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:r,offsetMode:l});if(l){const c=n.projectPosition(I||a);eE(C,C,c)}return C}const Fo={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},fC={COMPONENT:Symbol.for("component"),ASYNC_DEFAULTS:Symbol.for("asyncPropDefaults"),ASYNC_ORIGINAL:Symbol.for("asyncPropOriginal"),ASYNC_RESOLVED:Symbol.for("asyncPropResolved")};function pC(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(t)?jG(t,e,[]):e(t)?[t]:[]}function jG(t,e,n){let i=-1;for(;++i<t.length;){const g=t[i];Array.isArray(g)?jG(g,e,n):e(g)&&n.push(g)}return n}function JX(t){let{target:e,source:n,start:i=0,count:g=1}=t;const s=n.length,o=g*s;let r=0;for(let I=i;r<s;r++)e[I++]=n[r];for(;r<o;)r<o-r?(e.copyWithin(i+r,i,i+r),r*=2):(e.copyWithin(i+r,i,i+o-r),r=o);return e}class DX{constructor(e,n,i){this.id=e,this.context=i,this._loadCount=0,this._subscribers=new Set,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let g=e;typeof e=="string"&&(g=Dl(e)),g instanceof Promise?(this.isLoaded=!1,this._loader=g.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=null,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=null,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class zX{constructor(e){let{gl:n,protocol:i}=e;this.protocol=i||"resource://",this._context={gl:n,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add(e){let{resourceId:n,data:i,forceUpdate:g=!1,persistent:s=!0}=e,o=this._resources[n];o?o.setData(i,g):(o=new DX(n,i,this._context),this._resources[n]=o),o.persistent=s}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe(e){let{consumerId:n}=e;const i=this._consumers[n];if(i){for(const g in i){const s=i[g];s.resource&&s.resource.unsubscribe(s)}delete this._consumers[n],this.prune()}}subscribe(e){let{resourceId:n,onChange:i,consumerId:g,requestId:s="default"}=e;const{_resources:o,protocol:r}=this;n.startsWith(r)&&(n=n.replace(r,""),o[n]||this.add({resourceId:n,data:null,persistent:!1}));const I=o[n];if(this._track(g,s,I,i),I)return I.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,g){const s=this._consumers,o=s[e]=s[e]||{},r=o[n]||{};r.resource&&(r.resource.unsubscribe(r),r.resource=null,this.prune()),i&&(o[n]=r,r.onChange=g,r.resource=i,i.subscribe(r))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const OX="layerManager.setLayers",jX="layerManager.activateViewport",qX=Object.seal({layerManager:null,resourceManager:null,deck:null,gl:null,stats:null,shaderCache:null,pickingFBO:null,mousePosition:null,userData:{}});class $X{constructor(e){let{deck:n,stats:i,viewport:g,timeline:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.lastRenderedLayers=[],this.layers=[],this.resourceManager=new zX({gl:e,protocol:"deck://"}),this.context=J(S({},qX),{layerManager:this,gl:e,deck:n,programManager:e&&fX(e),stats:i||new Kl({id:"deck.gl"}),viewport:g||new vg({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new UG,resourceManager:this.resourceManager}),this._nextLayers=null,this._needsRedraw="Initial render",this._needsUpdate=!1,this._debug=!1,this.activateViewport=this.activateViewport.bind(this),Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const g=i.getNeedsRedraw(e);n=n||g}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this.lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers(){let{layerIds:e=null}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Tt(OX,this,n,e),this.lastRenderedLayers=e,e=pC(e,Boolean);for(const i of e)i.context=this.context;return this._updateLayers(this.layers,e),this}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this.lastRenderedLayers,e)),this._nextLayers=null}activateViewport(e){return Tt(jX,this,e),e&&(this.context.viewport=e),this}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const o of e)i[o.id]?pe.warn("Multiple old layers with same id ".concat(o.id))():i[o.id]=o;const g=[];this._updateSublayersRecursively(n,i,g),this._finalizeOldLayers(i);let s=!1;for(const o of g)if(o.hasUniformTransition()){s=!0;break}this._needsUpdate=s,this.layers=g}_updateSublayersRecursively(e,n,i){for(const g of e){g.context=this.context;const s=n[g.id];s===null&&pe.warn("Multiple new layers with same id ".concat(g.id))(),n[g.id]=null;let o=null;try{this._debug&&s!==g&&g.validateProps(),s?(this._transferLayerState(s,g),this._updateLayer(g)):this._initializeLayer(g),i.push(g),o=g.isComposite&&g.getSubLayers()}catch(r){this._handleError("matching",r,g)}o&&this._updateSublayersRecursively(o,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Fo.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Fo.MATCHED,n!==e&&(e.lifecycle=Fo.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Fo.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Fo.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function So(t,e){if(t===e)return!0;if(!t||!e)return!1;for(const n in t){const i=t[n],g=e[n];if(!(i===g||Array.isArray(i)&&Array.isArray(g)&&So(i,g)))return!1}return!0}class eY{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="Initial render",this._needsUpdate=!0,this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers)this.controllers[e]&&this.controllers[e].finalize();this.controllers={}}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return typeof e=="string"?this.views.find(n=>n.id===e):e}getViewState(e){const n=this.getView(e),i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),g={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){const o=i[s];if(o.containsPixel(g)){const r=e.slice();return r[0]-=o.x,r[1]-=o.y,o.unproject(r,n)}}return null}setProps(e){"views"in e&&this._setViews(e.views),"viewState"in e&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=pC(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!So(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):pe.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){n.viewId=e,this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange(n)}_createController(e,n){const i=n.type;return new i(S({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>e._getViewport(s,{width:s.width,height:s.height})},n))}_updateController(e,n,i,g){let s=e.controller;return s?(s=J(S(S(S({},n),e.props),s),{id:e.id,x:i.x,y:i.y,width:i.width,height:i.height}),g?g.setProps(s):g=this._createController(e,s),g):null}_rebuildViewports(){const{width:e,height:n,views:i}=this,g=this.controllers;this._viewports=[],this.controllers={};let s=!1;for(let o=i.length;o--;){const r=i[o],I=this.getViewState(r),a=r.makeViewport({width:e,height:n,viewState:I});let l=g[r.id];r.controller&&!l&&(s=!0),(s||!r.controller)&&l&&(l.finalize(),l=null),this.controllers[r.id]=this._updateController(r,I,a,l),this._viewports.unshift(a)}for(const o in g)g[o]&&!this.controllers[o]&&g[o].finalize();this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,g)=>!e[g].equals(n[g]))}}const tY=/([0-9]+\.?[0-9]*)(%|px)/;function BC(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=t.match(tY);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function bC(t,e){return t.relative?Math.round(t.position*e):t.position}function Cn(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Is{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=null,x:i=0,y:g=0,width:s="100%",height:o="100%",viewportInstance:r,type:I=vg}=e;Cn(!r||r instanceof vg),this.viewportInstance=r,this.id=n||this.constructor.displayName||"view",this.type=I,this.props=J(S({},e),{id:this.id}),this._parseDimensions({x:i,y:g,width:s,height:o}),this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance&&this.viewportInstance.equals(e.viewportInstance):So(this.props,e.props)}makeViewport(e){let{width:n,height:i,viewState:g}=e;if(this.viewportInstance)return this.viewportInstance;g=this.filterViewState(g);const s=this.getDimensions({width:n,height:i});return this._getViewport(g,s)}getViewStateId(){switch(typeof this.props.viewState){case"string":return this.props.viewState;case"object":return this.props.viewState&&this.props.viewState.id;default:return this.id}}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n=S({},e);for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions(e){let{width:n,height:i}=e;return{x:bC(this._x,n),y:bC(this._y,i),width:bC(this._width,n),height:bC(this._height,i)}}_getControllerProps(e){let n=this.props.controller;return n?n===!0?e:(typeof n=="function"&&(n={type:n}),S(S({},e),n)):null}_getViewport(e,n){const{type:i}=this;return new i(S(S(S({},e),this.props),n))}_parseDimensions(e){let{x:n,y:i,width:g,height:s}=e;this._x=BC(n),this._y=BC(i),this._width=BC(g),this._height=BC(s)}}function yC(){}const nY={onStart:yC,onUpdate:yC,onInterrupt:yC,onEnd:yC};class wI{constructor(e){this._inProgress=!1,this._handle=null,this.timeline=e,this.settings={}}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=S(S({},nY),e),this._inProgress=!0,this.settings.onStart(this)}end(){this._inProgress&&(this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd(this))}cancel(){this._inProgress&&(this.settings.onInterrupt(this),this.timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{timeline:e,settings:n}=this;this._handle=e.addChannel({delay:e.getTime(),duration:n.duration})}return this.time=this.timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate(this),this.timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const TI=()=>{},vC={BREAK:1,SNAP_TO_END:2,IGNORE:3},qG={transitionEasing:t=>t,transitionInterruption:vC.BREAK,onTransitionStart:TI,onTransitionInterrupt:TI,onTransitionEnd:TI};class iY{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ControllerState=e,this.props=S(S({},qG),n),this.propsInTransition=null,this.transition=new wI(n.timeline),this.onViewStateChange=n.onViewStateChange||TI,this.onStateChange=n.onStateChange||TI,this._onTransitionUpdate=this._onTransitionUpdate.bind(this)}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(e=S(S({},qG),e),this.props=e,this._shouldIgnoreViewportChange(i,e))return n;if(this._isTransitionEnabled(e)){const{interruption:g,endProps:s}=this.transition.settings,o=S(S({},i),g===vC.SNAP_TO_END?s:this.propsInTransition||i);this._triggerTransition(o,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&Boolean(i)}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===vC.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=new this.ControllerState(e),g=new this.ControllerState(n).shortestPathFrom(i),{transitionInterpolator:s}=n,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const r=n.transitionInterpolator.initializeProps(e,g);this.propsInTransition={},this.duration=o,this.transition.start({duration:o,easing:n.transitionEasing,interpolator:n.transitionInterpolator,interruption:n.transitionInterruption,startProps:r.start,endProps:r.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)}),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e(n)}}_onTransitionUpdate(e){const{time:n,settings:{interpolator:i,startProps:g,endProps:s,duration:o,easing:r}}=e,I=r(n/o),a=i.interpolateProps(g,s,I);this.propsInTransition=new this.ControllerState(S(S({},this.props),a)).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}}class gY{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Array.isArray(e)&&(e={compare:e,extract:e,required:e});const{compare:n,extract:i,required:g}=e;this._propsToCompare=n,this._propsToExtract=i,this._requiredProps=g}arePropsEqual(e,n){for(const i of this._propsToCompare||Object.keys(n))if(!(i in e)||!(i in n)||!fg(e[i],n[i]))return!1;return!0}initializeProps(e,n){let i;if(this._propsToExtract){const g={},s={};for(const o of this._propsToExtract)g[o]=e[o],s[o]=n[o];i={start:g,end:s}}else i={start:e,end:n};return this._checkRequiredProps(i.start),this._checkRequiredProps(i.end),i}interpolateProps(e,n,i){return n}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){!this._requiredProps||this._requiredProps.forEach(n=>{const i=e[n];Cn(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const $G=["longitude","latitude","zoom","bearing","pitch"],sY=["longitude","latitude","zoom"];class eZ extends gY{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=Array.isArray(e)?e:e.transitionProps;super(n||{compare:$G,extract:$G,required:sY});this.opts=e}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:g,around:s}=this.opts;if(g&&s){const o=g(e),r=g(n),I=o.unproject(s);i.start.around=s,Object.assign(i.end,{around:r.project(I),aroundPosition:I,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const g={};for(const s of this._propsToExtract)g[s]=ss(e[s]||0,n[s]||0,i);if(n.aroundPosition){const s=this.opts.makeViewport(S(S({},n),g));Object.assign(g,s.panByPosition(n.aroundPosition,ss(e.around,n.around,i)))}return g}}const Gg={transitionDuration:0},oY={transitionDuration:300,transitionEasing:t=>t,transitionInterruption:vC.BREAK},rY=300,GC=t=>1-(1-t)*(1-t),Vo={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]};class tZ{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ControllerState=e,this.controllerState=null,this.controllerStateProps=null,this.eventManager=null,this.transitionManager=new iY(e,J(S({},n),{onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}));const i=this.linearTransitionProps;this._transition=i&&J(S({},oY),{transitionInterpolator:new eZ({transitionProps:i})}),this._events=null,this._interactionState={isDragging:!1},this._customEvents=[],this.onViewStateChange=null,this.onStateChange=null,this.handleEvent=this.handleEvent.bind(this),this.setProps(n)}get linearTransitionProps(){return null}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.setProps(this.controllerStateProps)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){const{ControllerState:n}=this;this.controllerState=new n(S(S({makeViewport:this.makeViewport},this.controllerStateProps),this._state));const i=this._eventStartBlocked;switch(e.type){case"panstart":return i?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return i?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return i?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}getCenter(e){const{x:n,y:i}=this.controllerStateProps,{offsetCenter:g}=e;return[g.x-n,g.y-i]}isPointInBounds(e,n){const{width:i,height:g}=this.controllerStateProps;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=g;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){"onViewStateChange"in e&&(this.onViewStateChange=e.onViewStateChange),"onStateChange"in e&&(this.onStateChange=e.onStateChange),"makeViewport"in e&&(this.makeViewport=e.makeViewport),"dragMode"in e&&(this.dragMode=e.dragMode),this.controllerStateProps=e,"eventManager"in e&&this.eventManager!==e.eventManager&&(this.eventManager=e.eventManager,this._events={},this.toggleEvents(this._customEvents,!0)),"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let{inertia:n}=e;n===!0&&(n=rY),this.inertia=n;const{scrollZoom:i=!0,dragPan:g=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:r=!0,touchRotate:I=!1,keyboard:a=!0}=e,l=Boolean(this.onViewStateChange);this.toggleEvents(Vo.WHEEL,l&&i),this.toggleEvents(Vo.PAN,l&&(g||s)),this.toggleEvents(Vo.PINCH,l&&(r||I)),this.toggleEvents(Vo.TRIPLE_PAN,l&&I),this.toggleEvents(Vo.DOUBLE_TAP,l&&o),this.toggleEvents(Vo.KEYBOARD,l&&a),this.scrollZoom=i,this.dragPan=g,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=r,this.touchRotate=I,this.keyboard=a}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const g=S(S({},e.getViewportProps()),n),s=this.controllerState!==e;if(this._state=e.getState(),this._setInteractionState(i),s){const o=this.controllerState?this.controllerState.getViewportProps():null;this.onViewStateChange&&this.onViewStateChange({viewState:g,interactionState:this._interactionState,oldViewState:o})}}_onTransition(e){this.onViewStateChange&&(e.interactionState=this._interactionState,this.onViewStateChange(e))}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange&&this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton;(this.invertPan||this.dragMode==="pan")&&(i=!i);const g=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(g,Gg,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,Gg,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),g=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:g}).panEnd();this.updateViewport(s,J(S({},this._getTransitionProps()),{transitionDuration:n,transitionEasing:GC}),{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Gg,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),g=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:g}).rotateEnd();this.updateViewport(s,J(S({},this._getTransitionProps()),{transitionDuration:n,transitionEasing:GC}),{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:i=.01,smooth:g=!1}=this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*i)));s<0&&o!==0&&(o=1/o);const r=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(r,J(S({},this._getTransitionProps({around:n})),{transitionDuration:g?250:1}),{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,Gg,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,Gg,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),g=[i[0],i[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:g});this.updateViewport(s,J(S({},this._getTransitionProps()),{transitionDuration:n,transitionEasing:GC}),{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return this._startPinchRotation=e.rotation,this._lastPinchEvent=e,this.updateViewport(i,Gg,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,g=this.getCenter(e);n=n.zoom({pos:g,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:this._startPinchRotation-i})}return this.updateViewport(n,Gg,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),this._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n,_lastPinchEvent:i}=this;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const g=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),r=(o-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),I=Math.pow(2,o+r*n/2);s=s.zoom({pos:g,scale:I}).zoomEnd(),this.updateViewport(s,J(S({},this._getTransitionProps({around:g})),{transitionDuration:n,transitionEasing:GC}),{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const g=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(g,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return this._startPinchRotation=null,this._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),g=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(g,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:g,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard,{controllerState:r}=this;let I;const a={};switch(e.srcEvent.code){case"Minus":I=n?r.zoomOut(i).zoomOut(i):r.zoomOut(i),a.isZooming=!0;break;case"Equal":I=n?r.zoomIn(i).zoomIn(i):r.zoomIn(i),a.isZooming=!0;break;case"ArrowLeft":n?(I=r.rotateLeft(s),a.isRotating=!0):(I=r.moveLeft(g),a.isPanning=!0);break;case"ArrowRight":n?(I=r.rotateRight(s),a.isRotating=!0):(I=r.moveRight(g),a.isPanning=!0);break;case"ArrowUp":n?(I=r.rotateUp(o),a.isRotating=!0):(I=r.moveUp(g),a.isPanning=!0);break;case"ArrowDown":n?(I=r.rotateDown(o),a.isRotating=!0):(I=r.moveDown(g),a.isPanning=!0);break;default:return!1}return this.updateViewport(I,this._getTransitionProps(),a),!0}_getTransitionProps(e){const{_transition:n}=this;return n?e?J(S({},n),{transitionInterpolator:new eZ(J(S({},e),{transitionProps:this.linearTransitionProps,makeViewport:this.controllerState.makeViewport}))}):n:Gg}}class nZ{constructor(e){this._viewportProps=this._applyConstraints(e)}getViewportProps(){return this._viewportProps}getState(){return this._state}shortestPathFrom(e){return this._viewportProps}_applyConstraints(e){return e}}const iZ=5,IY=1.2,as={pitch:0,bearing:0,altitude:1.5,minZoom:0,maxZoom:20,minPitch:0,maxPitch:60};class aY extends nZ{constructor(){let{makeViewport:e,width:n,height:i,latitude:g,longitude:s,zoom:o,bearing:r=as.bearing,pitch:I=as.pitch,altitude:a=as.altitude,maxZoom:l=as.maxZoom,minZoom:C=as.minZoom,maxPitch:c=as.maxPitch,minPitch:A=as.minPitch,startPanLngLat:d,startZoomLngLat:m,startRotatePos:u,startBearing:h,startPitch:f,startZoom:p,normalize:b}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Cn(Number.isFinite(s)),Cn(Number.isFinite(g)),Cn(Number.isFinite(o));super({width:n,height:i,latitude:g,longitude:s,zoom:o,bearing:r,pitch:I,altitude:a,maxZoom:l,minZoom:C,maxPitch:c,minPitch:A,normalize:b});this._state={startPanLngLat:d,startZoomLngLat:m,startRotatePos:u,startBearing:h,startPitch:f,startZoom:p},this.makeViewport=e}panStart(e){let{pos:n}=e;return this._getUpdatedState({startPanLngLat:this._unproject(n)})}pan(e){let{pos:n,startPos:i}=e;const g=this._state.startPanLngLat||this._unproject(i);if(!g)return this;const o=this.makeViewport(this._viewportProps).panByPosition(g,n);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(e){let{pos:n}=e;return this._getUpdatedState({startRotatePos:n,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}rotate(e){let{pos:n,deltaAngleX:i=0,deltaAngleY:g=0}=e;const{startRotatePos:s,startBearing:o,startPitch:r}=this._state;if(!s||!Number.isFinite(o)||!Number.isFinite(r))return this;let I;return n?I=this._calculateNewPitchAndBearing(J(S({},this._getRotationParams(n,s)),{startBearing:o,startPitch:r})):I={bearing:o+i,pitch:r+g},this._getUpdatedState(I)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(e){let{pos:n}=e;return this._getUpdatedState({startZoomLngLat:this._unproject(n),startZoom:this._viewportProps.zoom})}zoom(e){let{pos:n,startPos:i,scale:g}=e,{startZoom:s,startZoomLngLat:o}=this._state;Number.isFinite(s)||(s=this._viewportProps.zoom,o=this._unproject(i)||this._unproject(n));const r=this._calculateNewZoom({scale:g,startZoom:s}),I=this.makeViewport(J(S({},this._viewportProps),{zoom:r}));return this._getUpdatedState(S({zoom:r},I.panByPosition(o,n)))}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(e)}zoomOut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/e)}moveLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([e,0])}moveRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-e,0])}moveUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,e])}moveDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-e])}rotateLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this._viewportProps.bearing-e})}rotateRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this._viewportProps.bearing+e})}rotateUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this._viewportProps.pitch+e})}rotateDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this._viewportProps.pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i=S({},this._viewportProps),{bearing:g,longitude:s}=i;return Math.abs(g-n.bearing)>180&&(i.bearing=g<0?g+360:g-360),Math.abs(s-n.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}_zoomFromCenter(e){const{width:n,height:i}=this._viewportProps;return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this._viewportProps;return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor(S(S(S({makeViewport:this.makeViewport},this._viewportProps),this._state),e))}_applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:g}=e;e.zoom=ln(g,i,n);const{maxPitch:s,minPitch:o,pitch:r}=e;e.pitch=ln(r,o,s);const{normalize:I=!0}=e;return I&&Object.assign(e,sX(e)),e}_unproject(e){const n=this.makeViewport(this._viewportProps);return e&&n.unproject(e)}_calculateNewZoom(e){let{scale:n,startZoom:i}=e;const{maxZoom:g,minZoom:s}=this._viewportProps,o=i+Math.log2(n);return ln(o,s,g)}_calculateNewPitchAndBearing(e){let{deltaScaleX:n,deltaScaleY:i,startBearing:g,startPitch:s}=e;i=ln(i,-1,1);const{minPitch:o,maxPitch:r}=this._viewportProps,I=g+180*n;let a=s;return i>0?a=s+i*(r-s):i<0&&(a=s-i*(o-s)),{pitch:a,bearing:I}}_getRotationParams(e,n){const i=e[0]-n[0],g=e[1]-n[1],s=e[1],o=n[1],{width:r,height:I}=this._viewportProps,a=i/r;let l=0;return g>0?Math.abs(I-o)>iZ&&(l=g/(o-I)*IY):g<0&&o>iZ&&(l=1-s/o),l=Math.min(1,Math.max(-1,l)),{deltaScaleX:a,deltaScaleY:l}}}class lY extends tZ{constructor(e){e.dragMode=e.dragMode||"pan";super(aY,e)}setProps(e){const n=this.controllerStateProps;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState(S(S({makeViewport:this.makeViewport},this.controllerStateProps),this._state)))}get linearTransitionProps(){return["longitude","latitude","zoom","bearing","pitch"]}}class gZ extends Is{constructor(e){super(J(S({},e),{type:Ro}))}get controller(){return this._getControllerProps({type:lY})}}gZ.displayName="MapView";const CY=new JG;class cY{constructor(){this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length!==this.effects.length||!So(e.effects,this.effects))&&(this.setEffects(e.effects),this._needsRedraw="effects changed")}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.cleanup(),this.effects=e,this._createInternalEffects()}cleanup(){for(const e of this.effects)e.cleanup();for(const e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}_createInternalEffects(){this._internalEffects=this.effects.slice(),this.effects.some(e=>e instanceof JG)||this._internalEffects.push(CY)}}class AY extends T0{}const sZ={blendFunc:[1,0,32771,0],blendEquation:32774};class oZ extends T0{render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer(e){let{layers:n,layerFilter:i,views:g,viewports:s,onViewportActive:o,pickingFBO:r,deviceRect:{x:I,y:a,width:l,height:C},pass:c="picking",redrawReason:A,pickZ:d}=e;const m=this.gl;this.pickZ=d;const u=!d&&{byLayer:new Map,byAlpha:[]};this._colors=u;const h=Xn(m,J(S({scissorTest:!0,scissor:[I,a,l,C],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0]},sZ),{blend:!d}),()=>super.render({target:r,layers:n,layerFilter:i,views:g,viewports:s,onViewportActive:o,pass:c,redrawReason:A}));return this._colors=null,{decodePickingColor:u&&uY.bind(null,u),stats:h}}shouldDrawLayer(e){return e.props.pickable}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const g=S({},e.props.parameters);return this.pickZ?g.blend=!1:(Object.assign(g,sZ),g.blend=!0,g.blendColor=dY(this._colors,e,i)),g}}function dY(t,e,n){const{byLayer:i,byAlpha:g}=t;let s;if(i.has(e)){const o=i.get(e);o.viewports.push(n),s=o.a}else if(s=i.size+1,s<=255){const o={a:s,layer:e,viewports:[n]};i.set(e,o),g[s]=o}else pe.warn("Too many pickable layers, only picking the first 255")(),s=0;return[0,0,0,s/255]}function uY(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const hY="deckRenderer.renderLayers";class mY{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new AY(e),this.pickLayersPass=new oZ(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||Ct.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);const i=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,g=n.render(J(S({},e),{target:i}));this._postRender(e.effects,e),this.renderCount++,Tt(hY,this,g,e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){let i=null;for(const g of e)g.preRender(this.gl,n),g.postRender&&(i=g);i&&this._resizeRenderBuffers(),this.lastPostProcessEffect=i}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Ct(this.gl),new Ct(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,g={inputBuffer:i[0],swapBuffer:i[1],target:null};for(const s of e)if(s.postRender){if(s===this.lastPostProcessEffect){g.target=n.target,s.postRender(this.gl,g);break}const o=s.postRender(this.gl,g);g.inputBuffer=o,g.swapBuffer=o===i[0]?i[1]:i[0]}}}const fY={pickedColor:null,pickedLayer:null,pickedObjectIndex:-1};function pY(t){let{pickedColors:e,decodePickingColor:n,deviceX:i,deviceY:g,deviceRadius:s,deviceRect:o}=t;if(e){const{x:r,y:I,width:a,height:l}=o;let C=s*s,c=-1,A=0;for(let d=0;d<l;d++){const m=d+I-g,u=m*m;if(u>C)A+=4*a;else for(let h=0;h<a;h++){if(e[A+3]-1>=0){const p=h+r-i,b=p*p+u;b<=C&&(C=b,c=A)}A+=4}}if(c>=0){const d=e.slice(c,c+4),m=n(d);if(m){const u=Math.floor(c/4/a),h=c/4-u*a;return J(S({},m),{pickedColor:d,pickedX:r+h,pickedY:I+u})}pe.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return fY}function BY(t){let{pickedColors:e,decodePickingColor:n}=t;const i=new Map;if(e){for(let g=0;g<e.length;g+=4)if(e[g+3]-1>=0){const o=e.slice(g,g+4),r=o.join(",");if(!i.has(r)){const I=n(o);I?i.set(r,J(S({},I),{pickedColor:o})):pe.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function rZ(t){let{pickInfo:e,viewports:n,pixelRatio:i,x:g,y:s,z:o}=t,r=n[0];n.length>1&&(r=yY((e==null?void 0:e.pickedViewports)||n,{x:g,y:s}));const I=r&&r.unproject([g-r.x,s-r.y,o]);return{color:null,layer:null,viewport:r,index:-1,picked:!1,x:g,y:s,pixel:[g,s],coordinate:I,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:null,pixelRatio:i}}function bY(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:g}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:r}=e,I=o?[o]:[];if(i==="hover"){const C=n.index,c=n.layerId,A=o&&o.props.id;if(A!==c||r!==C){if(A!==c){const d=g.find(m=>m.props.id===c);d&&I.unshift(d)}n.layerId=A,n.index=r,n.info=null}}const a=rZ(t),l=new Map;return l.set(null,a),I.forEach(C=>{let c=S({},a);C===o&&(c.color=s,c.index=r,c.picked=!0),c=IZ({layer:C,info:c,mode:i}),C===o&&i==="hover"&&(n.info=c),l.set(c.layer.id,c),i==="hover"&&c.layer.updateAutoHighlight(c)}),l}function IZ(t){let{layer:e,info:n,mode:i}=t;for(;e&&n;){const g=n.layer||null;n.sourceLayer=g,n.layer=e,n=e.getPickingInfo({info:n,mode:i,sourceLayer:g}),e=e.parent}return n}function yY(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class vY{constructor(e){this.gl=e,this.pickingFBO=null,this.pickLayersPass=new oZ(e),this.layerFilter=null,this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject(e){let{x:n,y:i,layers:g,viewports:s}=e,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const r=o&&o.layer&&o.layer.id,I=o&&o.viewport&&o.viewport.id,a=r?g.find(A=>A.id===r):null,l=I&&s.find(A=>A.id===I)||s[0],C=l&&l.unproject([n-l.x,i-l.y]),c={x:n,y:i,viewport:l,coordinate:C,layer:a};return S(S({},o),c)}_resizeBuffer(){const{gl:e}=this;return this.pickingFBO||(this.pickingFBO=new Ct(e),Ct.isSupported(e,{colorBufferFloat:!0})&&(this.depthFBO=new Ct(e),this.depthFBO.attach({[36064]:new on(e,{format:ye(e)?34836:6408,type:5126})}))),this.pickingFBO.resize({width:e.canvas.width,height:e.canvas.height}),this.depthFBO&&this.depthFBO.resize({width:e.canvas.width,height:e.canvas.height}),this.pickingFBO}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>i.isPickable()&&!i.isComposite);return n.length?n:null}_pickClosestObject(e){let{layers:n,views:i,viewports:g,x:s,y:o,radius:r=0,depth:I=1,mode:a="query",unproject3D:l,onViewportActive:C}=e;if(n=this._getPickable(n),!n)return{result:[],emptyInfo:rZ({viewports:g,x:s,y:o})};this._resizeBuffer();const c=Co(this.gl),A=$u(this.gl,[s,o],!0),d=[A.x+Math.floor(A.width/2),A.y+Math.floor(A.height/2)],m=Math.round(r*c),{width:u,height:h}=this.pickingFBO,f=this._getPickingRect({deviceX:d[0],deviceY:d[1],deviceRadius:m,deviceWidth:u,deviceHeight:h});let p;const b=[],Z=new Set;for(let v=0;v<I;v++){const N=f&&this._drawAndSample({layers:n,views:i,viewports:g,onViewportActive:C,deviceRect:f,pass:"picking:".concat(a),redrawReason:a}),x=pY(J(S({},N),{deviceX:d[0],deviceY:d[1],deviceRadius:m,deviceRect:f}));let V;x.pickedLayer&&l&&this.depthFBO&&(V=this._drawAndSample({layers:[x.pickedLayer],views:i,viewports:g,onViewportActive:C,deviceRect:{x:x.pickedX,y:x.pickedY,width:1,height:1},pass:"picking:".concat(a),redrawReason:"pick-z",pickZ:!0}).pickedColors[0]),x.pickedLayer&&v+1<I&&(Z.add(x.pickedLayer),x.pickedLayer.disablePickingIndex(x.pickedObjectIndex)),p=bY({pickInfo:x,lastPickedInfo:this.lastPickedInfo,mode:a,layers:n,viewports:g,x:s,y:o,z:V,pixelRatio:c});for(const E of p.values())E.layer&&b.push(E);if(!x.pickedColor)break}for(const v of Z)v.restorePickingColors();return{result:b,emptyInfo:p&&p.get(null)}}_pickVisibleObjects(e){let{layers:n,views:i,viewports:g,x:s,y:o,width:r=1,height:I=1,mode:a="query",maxObjects:l=null,onViewportActive:C}=e;if(n=this._getPickable(n),!n)return[];this._resizeBuffer();const c=Co(this.gl),A=$u(this.gl,[s,o],!0),d=A.x,m=A.y+A.height,u=$u(this.gl,[s+r,o+I],!0),h=u.x+u.width,f=u.y,p={x:d,y:f,width:h-d,height:m-f},b=this._drawAndSample({layers:n,views:i,viewports:g,onViewportActive:C,deviceRect:p,pass:"picking:".concat(a),redrawReason:a}),Z=BY(b),v=new Map,N=Number.isFinite(l);for(let x=0;x<Z.length&&!(N&&v.size>=l);x++){const V=Z[x];let E={color:V.pickedColor,layer:null,index:V.pickedObjectIndex,picked:!0,x:s,y:o,width:r,height:I,pixelRatio:c};E=IZ({layer:V.pickedLayer,info:E,mode:a}),v.has(E.object)||v.set(E.object,E)}return Array.from(v.values())}_drawAndSample(e){let{layers:n,views:i,viewports:g,onViewportActive:s,deviceRect:o,pass:r,redrawReason:I,pickZ:a}=e;const l=a?this.depthFBO:this.pickingFBO,{decodePickingColor:C}=this.pickLayersPass.render({layers:n,layerFilter:this.layerFilter,views:i,viewports:g,onViewportActive:s,pickingFBO:l,deviceRect:o,pass:r,redrawReason:I,pickZ:a}),{x:c,y:A,width:d,height:m}=o,u=new(a?Float32Array:Uint8Array)(d*m*4);return ql(l,{sourceX:c,sourceY:A,sourceWidth:d,sourceHeight:m,target:u}),{pickedColors:u,decodePickingColor:C}}_getPickingRect(e){let{deviceX:n,deviceY:i,deviceRadius:g,deviceWidth:s,deviceHeight:o}=e;const r=Math.max(0,n-g),I=Math.max(0,i-g),a=Math.min(s,n+g+1)-r,l=Math.min(o,i+g+1)-I;return a<=0||l<=0?null:{x:r,y:I,width:a,height:l}}}const GY={zIndex:1,position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:0,left:0,display:"none"};class ZY{constructor(e){const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,GY),n.appendChild(this.el)),this.isVisible=!1}setTooltip(e,n,i){const g=this.el;if(typeof e=="string")g.innerText=e;else if(e)"text"in e&&(g.innerText=e.text),"html"in e&&(g.innerHTML=e.html),"className"in e&&(g.className=e.className),Object.assign(g.style,e.style);else{this.isVisible=!1,g.style.display="none";return}this.isVisible=!0,g.style.display="block",g.style.transform="translate(".concat(n,"px, ").concat(i,"px)")}remove(){this.el&&this.el.remove()}}var aZ={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,g){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),r="function",I=Math.round,a=Math.abs,l=Date.now;function C(B,y,R){return setTimeout(p(B,R),y)}function c(B,y,R){return Array.isArray(B)?(A(B,R[y],R),!0):!1}function A(B,y,R){var w;if(!!B)if(B.forEach)B.forEach(y,R);else if(B.length!==g)for(w=0;w<B.length;)y.call(R,B[w],w,B),w++;else for(w in B)B.hasOwnProperty(w)&&y.call(R,B[w],w,B)}function d(B,y,R){var w="DEPRECATED METHOD: "+y+`
`+R+` AT 
`;return function(){var K=new Error("get-stack-trace"),$=K&&K.stack?K.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ve=e.console&&(e.console.warn||e.console.log);return ve&&ve.call(e.console,w,$),B.apply(this,arguments)}}var m;typeof Object.assign!="function"?m=function(y){if(y===g||y===null)throw new TypeError("Cannot convert undefined or null to object");for(var R=Object(y),w=1;w<arguments.length;w++){var K=arguments[w];if(K!==g&&K!==null)for(var $ in K)K.hasOwnProperty($)&&(R[$]=K[$])}return R}:m=Object.assign;var u=d(function(y,R,w){for(var K=Object.keys(R),$=0;$<K.length;)(!w||w&&y[K[$]]===g)&&(y[K[$]]=R[K[$]]),$++;return y},"extend","Use `assign`."),h=d(function(y,R){return u(y,R,!0)},"merge","Use `assign`.");function f(B,y,R){var w=y.prototype,K;K=B.prototype=Object.create(w),K.constructor=B,K._super=w,R&&m(K,R)}function p(B,y){return function(){return B.apply(y,arguments)}}function b(B,y){return typeof B==r?B.apply(y&&y[0]||g,y):B}function Z(B,y){return B===g?y:B}function v(B,y,R){A(E(y),function(w){B.addEventListener(w,R,!1)})}function N(B,y,R){A(E(y),function(w){B.removeEventListener(w,R,!1)})}function x(B,y){for(;B;){if(B==y)return!0;B=B.parentNode}return!1}function V(B,y){return B.indexOf(y)>-1}function E(B){return B.trim().split(/\s+/g)}function D(B,y,R){if(B.indexOf&&!R)return B.indexOf(y);for(var w=0;w<B.length;){if(R&&B[w][R]==y||!R&&B[w]===y)return w;w++}return-1}function _(B){return Array.prototype.slice.call(B,0)}function k(B,y,R){for(var w=[],K=[],$=0;$<B.length;){var ve=y?B[$][y]:B[$];D(K,ve)<0&&w.push(B[$]),K[$]=ve,$++}return R&&(y?w=w.sort(function(bt,Ht){return bt[y]>Ht[y]}):w=w.sort()),w}function z(B,y){for(var R,w,K=y[0].toUpperCase()+y.slice(1),$=0;$<s.length;){if(R=s[$],w=R?R+K:y,w in B)return w;$++}return g}var ee=1;function Ie(){return ee++}function he(B){var y=B.ownerDocument||B;return y.defaultView||y.parentWindow||e}var ge=/mobile|tablet|ip(ad|hone|od)|android/i,Ae="ontouchstart"in e,U=z(e,"PointerEvent")!==g,F=Ae&&ge.test(navigator.userAgent),W="touch",T="pen",Y="mouse",Q="kinect",H=25,P=1,oe=2,ne=4,me=8,ae=1,be=2,Ze=4,Be=8,rt=16,le=be|Ze,Re=Be|rt,Vt=le|Re,$e=["x","y"],et=["clientX","clientY"];function xe(B,y){var R=this;this.manager=B,this.callback=y,this.element=B.element,this.target=B.options.inputTarget,this.domHandler=function(w){b(B.options.enable,[B])&&R.handler(w)},this.init()}xe.prototype={handler:function(){},init:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(he(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&N(this.element,this.evEl,this.domHandler),this.evTarget&&N(this.target,this.evTarget,this.domHandler),this.evWin&&N(he(this.element),this.evWin,this.domHandler)}};function Ge(B){var y,R=B.options.inputClass;return R?y=R:U?y=xn:F?y=Ce:Ae?y=zt:y=Dt,new y(B,Qe)}function Qe(B,y,R){var w=R.pointers.length,K=R.changedPointers.length,$=y&P&&w-K==0,ve=y&(ne|me)&&w-K==0;R.isFirst=!!$,R.isFinal=!!ve,$&&(B.session={}),R.eventType=y,Je(B,R),B.emit("hammer.input",R),B.recognize(R),B.session.prevInput=R}function Je(B,y){var R=B.session,w=y.pointers,K=w.length;R.firstInput||(R.firstInput=Yi(y)),K>1&&!R.firstMultiple?R.firstMultiple=Yi(y):K===1&&(R.firstMultiple=!1);var $=R.firstInput,ve=R.firstMultiple,dt=ve?ve.center:$.center,bt=y.center=at(w);y.timeStamp=l(),y.deltaTime=y.timeStamp-$.timeStamp,y.angle=Vn(dt,bt),y.distance=gt(dt,bt),_t(R,y),y.offsetDirection=Sn(y.deltaX,y.deltaY);var Ht=Se(y.deltaTime,y.deltaX,y.deltaY);y.overallVelocityX=Ht.x,y.overallVelocityY=Ht.y,y.overallVelocity=a(Ht.x)>a(Ht.y)?Ht.x:Ht.y,y.scale=ve?Ko(ve.pointers,w):1,y.rotation=ve?Un(ve.pointers,w):0,y.maxPointers=R.prevInput?y.pointers.length>R.prevInput.maxPointers?y.pointers.length:R.prevInput.maxPointers:y.pointers.length,Ut(R,y);var Jn=B.element;x(y.srcEvent.target,Jn)&&(Jn=y.srcEvent.target),y.target=Jn}function _t(B,y){var R=y.center,w=B.offsetDelta||{},K=B.prevDelta||{},$=B.prevInput||{};(y.eventType===P||$.eventType===ne)&&(K=B.prevDelta={x:$.deltaX||0,y:$.deltaY||0},w=B.offsetDelta={x:R.x,y:R.y}),y.deltaX=K.x+(R.x-w.x),y.deltaY=K.y+(R.y-w.y)}function Ut(B,y){var R=B.lastInterval||y,w=y.timeStamp-R.timeStamp,K,$,ve,dt;if(y.eventType!=me&&(w>H||R.velocity===g)){var bt=y.deltaX-R.deltaX,Ht=y.deltaY-R.deltaY,Jn=Se(w,bt,Ht);$=Jn.x,ve=Jn.y,K=a(Jn.x)>a(Jn.y)?Jn.x:Jn.y,dt=Sn(bt,Ht),B.lastInterval=y}else K=R.velocity,$=R.velocityX,ve=R.velocityY,dt=R.direction;y.velocity=K,y.velocityX=$,y.velocityY=ve,y.direction=dt}function Yi(B){for(var y=[],R=0;R<B.pointers.length;)y[R]={clientX:I(B.pointers[R].clientX),clientY:I(B.pointers[R].clientY)},R++;return{timeStamp:l(),pointers:y,center:at(y),deltaX:B.deltaX,deltaY:B.deltaY}}function at(B){var y=B.length;if(y===1)return{x:I(B[0].clientX),y:I(B[0].clientY)};for(var R=0,w=0,K=0;K<y;)R+=B[K].clientX,w+=B[K].clientY,K++;return{x:I(R/y),y:I(w/y)}}function Se(B,y,R){return{x:y/B||0,y:R/B||0}}function Sn(B,y){return B===y?ae:a(B)>=a(y)?B<0?be:Ze:y<0?Be:rt}function gt(B,y,R){R||(R=$e);var w=y[R[0]]-B[R[0]],K=y[R[1]]-B[R[1]];return Math.sqrt(w*w+K*K)}function Vn(B,y,R){R||(R=$e);var w=y[R[0]]-B[R[0]],K=y[R[1]]-B[R[1]];return Math.atan2(K,w)*180/Math.PI}function Un(B,y){return Vn(y[1],y[0],et)+Vn(B[1],B[0],et)}function Ko(B,y){return gt(y[0],y[1],et)/gt(B[0],B[1],et)}var Lo={mousedown:P,mousemove:oe,mouseup:ne},Mo="mousedown",ue="mousemove mouseup";function Dt(){this.evEl=Mo,this.evWin=ue,this.pressed=!1,xe.apply(this,arguments)}f(Dt,xe,{handler:function(y){var R=Lo[y.type];R&P&&y.button===0&&(this.pressed=!0),R&oe&&y.which!==1&&(R=ne),!!this.pressed&&(R&ne&&(this.pressed=!1),this.callback(this.manager,R,{pointers:[y],changedPointers:[y],pointerType:Y,srcEvent:y}))}});var Po={pointerdown:P,pointermove:oe,pointerup:ne,pointercancel:me,pointerout:me},wg={2:W,3:T,4:Y,5:Q},hn="pointerdown",Tg="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(hn="MSPointerDown",Tg="MSPointerMove MSPointerUp MSPointerCancel");function xn(){this.evEl=hn,this.evWin=Tg,xe.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}f(xn,xe,{handler:function(y){var R=this.store,w=!1,K=y.type.toLowerCase().replace("ms",""),$=Po[K],ve=wg[y.pointerType]||y.pointerType,dt=ve==W,bt=D(R,y.pointerId,"pointerId");$&P&&(y.button===0||dt)?bt<0&&(R.push(y),bt=R.length-1):$&(ne|me)&&(w=!0),!(bt<0)&&(R[bt]=y,this.callback(this.manager,$,{pointers:R,changedPointers:[y],pointerType:ve,srcEvent:y}),w&&R.splice(bt,1))}});var li={touchstart:P,touchmove:oe,touchend:ne,touchcancel:me},Jo="touchstart",xc="touchstart touchmove touchend touchcancel";function Do(){this.evTarget=Jo,this.evWin=xc,this.started=!1,xe.apply(this,arguments)}f(Do,xe,{handler:function(y){var R=li[y.type];if(R===P&&(this.started=!0),!!this.started){var w=Wc.call(this,y,R);R&(ne|me)&&w[0].length-w[1].length==0&&(this.started=!1),this.callback(this.manager,R,{pointers:w[0],changedPointers:w[1],pointerType:W,srcEvent:y})}}});function Wc(B,y){var R=_(B.touches),w=_(B.changedTouches);return y&(ne|me)&&(R=k(R.concat(w),"identifier",!0)),[R,w]}var Nc={touchstart:P,touchmove:oe,touchend:ne,touchcancel:me},re="touchstart touchmove touchend touchcancel";function Ce(){this.evTarget=re,this.targetIds={},xe.apply(this,arguments)}f(Ce,xe,{handler:function(y){var R=Nc[y.type],w=De.call(this,y,R);!w||this.callback(this.manager,R,{pointers:w[0],changedPointers:w[1],pointerType:W,srcEvent:y})}});function De(B,y){var R=_(B.touches),w=this.targetIds;if(y&(P|oe)&&R.length===1)return w[R[0].identifier]=!0,[R,R];var K,$,ve=_(B.changedTouches),dt=[],bt=this.target;if($=R.filter(function(Ht){return x(Ht.target,bt)}),y===P)for(K=0;K<$.length;)w[$[K].identifier]=!0,K++;for(K=0;K<ve.length;)w[ve[K].identifier]&&dt.push(ve[K]),y&(ne|me)&&delete w[ve[K].identifier],K++;if(!!dt.length)return[k($.concat(dt),"identifier",!0),dt]}var je=2500,Ne=25;function zt(){xe.apply(this,arguments);var B=p(this.handler,this);this.touch=new Ce(this.manager,B),this.mouse=new Dt(this.manager,B),this.primaryTouch=null,this.lastTouches=[]}f(zt,xe,{handler:function(y,R,w){var K=w.pointerType==W,$=w.pointerType==Y;if(!($&&w.sourceCapabilities&&w.sourceCapabilities.firesTouchEvents)){if(K)Xe.call(this,R,w);else if($&&_i.call(this,w))return;this.callback(y,R,w)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Xe(B,y){B&P?(this.primaryTouch=y.changedPointers[0].identifier,bs.call(this,y)):B&(ne|me)&&bs.call(this,y)}function bs(B){var y=B.changedPointers[0];if(y.identifier===this.primaryTouch){var R={x:y.clientX,y:y.clientY};this.lastTouches.push(R);var w=this.lastTouches,K=function(){var $=w.indexOf(R);$>-1&&w.splice($,1)};setTimeout(K,je)}}function _i(B){for(var y=B.srcEvent.clientX,R=B.srcEvent.clientY,w=0;w<this.lastTouches.length;w++){var K=this.lastTouches[w],$=Math.abs(y-K.x),ve=Math.abs(R-K.y);if($<=Ne&&ve<=Ne)return!0}return!1}var ys=z(o.style,"touchAction"),vs=ys!==g,Ia="compute",aa="auto",Ci="manipulation",st="none",Hi="pan-x",Eg="pan-y",Wn=rF();function zo(B,y){this.manager=B,this.set(y)}zo.prototype={set:function(B){B==Ia&&(B=this.compute()),vs&&this.manager.element.style&&Wn[B]&&(this.manager.element.style[ys]=B),this.actions=B.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var B=[];return A(this.manager.recognizers,function(y){b(y.options.enable,[y])&&(B=B.concat(y.getTouchAction()))}),wc(B.join(" "))},preventDefaults:function(B){var y=B.srcEvent,R=B.offsetDirection;if(this.manager.session.prevented){y.preventDefault();return}var w=this.actions,K=V(w,st)&&!Wn[st],$=V(w,Eg)&&!Wn[Eg],ve=V(w,Hi)&&!Wn[Hi];if(K){var dt=B.pointers.length===1,bt=B.distance<2,Ht=B.deltaTime<250;if(dt&&bt&&Ht)return}if(!(ve&&$)&&(K||$&&R&le||ve&&R&Re))return this.preventSrc(y)},preventSrc:function(B){this.manager.session.prevented=!0,B.preventDefault()}};function wc(B){if(V(B,st))return st;var y=V(B,Hi),R=V(B,Eg);return y&&R?st:y||R?y?Hi:Eg:V(B,Ci)?Ci:aa}function rF(){if(!vs)return!1;var B={},y=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(R){B[R]=y?e.CSS.supports("touch-action",R):!0}),B}var la=1,mn=2,Gs=4,ki=8,ci=ki,Oo=16,Pn=32;function Ai(B){this.options=m({},this.defaults,B||{}),this.id=Ie(),this.manager=null,this.options.enable=Z(this.options.enable,!0),this.state=la,this.simultaneous={},this.requireFail=[]}Ai.prototype={defaults:{},set:function(B){return m(this.options,B),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(B){if(c(B,"recognizeWith",this))return this;var y=this.simultaneous;return B=Ca(B,this),y[B.id]||(y[B.id]=B,B.recognizeWith(this)),this},dropRecognizeWith:function(B){return c(B,"dropRecognizeWith",this)?this:(B=Ca(B,this),delete this.simultaneous[B.id],this)},requireFailure:function(B){if(c(B,"requireFailure",this))return this;var y=this.requireFail;return B=Ca(B,this),D(y,B)===-1&&(y.push(B),B.requireFailure(this)),this},dropRequireFailure:function(B){if(c(B,"dropRequireFailure",this))return this;B=Ca(B,this);var y=D(this.requireFail,B);return y>-1&&this.requireFail.splice(y,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(B){return!!this.simultaneous[B.id]},emit:function(B){var y=this,R=this.state;function w(K){y.manager.emit(K,B)}R<ki&&w(y.options.event+Vm(R)),w(y.options.event),B.additionalEvent&&w(B.additionalEvent),R>=ki&&w(y.options.event+Vm(R))},tryEmit:function(B){if(this.canEmit())return this.emit(B);this.state=Pn},canEmit:function(){for(var B=0;B<this.requireFail.length;){if(!(this.requireFail[B].state&(Pn|la)))return!1;B++}return!0},recognize:function(B){var y=m({},B);if(!b(this.options.enable,[this,y])){this.reset(),this.state=Pn;return}this.state&(ci|Oo|Pn)&&(this.state=la),this.state=this.process(y),this.state&(mn|Gs|ki|Oo)&&this.tryEmit(y)},process:function(B){},getTouchAction:function(){},reset:function(){}};function Vm(B){return B&Oo?"cancel":B&ki?"end":B&Gs?"move":B&mn?"start":""}function Um(B){return B==rt?"down":B==Be?"up":B==be?"left":B==Ze?"right":""}function Ca(B,y){var R=y.manager;return R?R.get(B):B}function Nn(){Ai.apply(this,arguments)}f(Nn,Ai,{defaults:{pointers:1},attrTest:function(B){var y=this.options.pointers;return y===0||B.pointers.length===y},process:function(B){var y=this.state,R=B.eventType,w=y&(mn|Gs),K=this.attrTest(B);return w&&(R&me||!K)?y|Oo:w||K?R&ne?y|ki:y&mn?y|Gs:mn:Pn}});function ca(){Nn.apply(this,arguments),this.pX=null,this.pY=null}f(ca,Nn,{defaults:{event:"pan",threshold:10,pointers:1,direction:Vt},getTouchAction:function(){var B=this.options.direction,y=[];return B&le&&y.push(Eg),B&Re&&y.push(Hi),y},directionTest:function(B){var y=this.options,R=!0,w=B.distance,K=B.direction,$=B.deltaX,ve=B.deltaY;return K&y.direction||(y.direction&le?(K=$===0?ae:$<0?be:Ze,R=$!=this.pX,w=Math.abs(B.deltaX)):(K=ve===0?ae:ve<0?Be:rt,R=ve!=this.pY,w=Math.abs(B.deltaY))),B.direction=K,R&&w>y.threshold&&K&y.direction},attrTest:function(B){return Nn.prototype.attrTest.call(this,B)&&(this.state&mn||!(this.state&mn)&&this.directionTest(B))},emit:function(B){this.pX=B.deltaX,this.pY=B.deltaY;var y=Um(B.direction);y&&(B.additionalEvent=this.options.event+y),this._super.emit.call(this,B)}});function Tc(){Nn.apply(this,arguments)}f(Tc,Nn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[st]},attrTest:function(B){return this._super.attrTest.call(this,B)&&(Math.abs(B.scale-1)>this.options.threshold||this.state&mn)},emit:function(B){if(B.scale!==1){var y=B.scale<1?"in":"out";B.additionalEvent=this.options.event+y}this._super.emit.call(this,B)}});function Ec(){Ai.apply(this,arguments),this._timer=null,this._input=null}f(Ec,Ai,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[aa]},process:function(B){var y=this.options,R=B.pointers.length===y.pointers,w=B.distance<y.threshold,K=B.deltaTime>y.time;if(this._input=B,!w||!R||B.eventType&(ne|me)&&!K)this.reset();else if(B.eventType&P)this.reset(),this._timer=C(function(){this.state=ci,this.tryEmit()},y.time,this);else if(B.eventType&ne)return ci;return Pn},reset:function(){clearTimeout(this._timer)},emit:function(B){this.state===ci&&(B&&B.eventType&ne?this.manager.emit(this.options.event+"up",B):(this._input.timeStamp=l(),this.manager.emit(this.options.event,this._input)))}});function Qc(){Nn.apply(this,arguments)}f(Qc,Nn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[st]},attrTest:function(B){return this._super.attrTest.call(this,B)&&(Math.abs(B.rotation)>this.options.threshold||this.state&mn)}});function Xc(){Nn.apply(this,arguments)}f(Xc,Nn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:le|Re,pointers:1},getTouchAction:function(){return ca.prototype.getTouchAction.call(this)},attrTest:function(B){var y=this.options.direction,R;return y&(le|Re)?R=B.overallVelocity:y&le?R=B.overallVelocityX:y&Re&&(R=B.overallVelocityY),this._super.attrTest.call(this,B)&&y&B.offsetDirection&&B.distance>this.options.threshold&&B.maxPointers==this.options.pointers&&a(R)>this.options.velocity&&B.eventType&ne},emit:function(B){var y=Um(B.offsetDirection);y&&this.manager.emit(this.options.event+y,B),this.manager.emit(this.options.event,B)}});function Aa(){Ai.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}f(Aa,Ai,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ci]},process:function(B){var y=this.options,R=B.pointers.length===y.pointers,w=B.distance<y.threshold,K=B.deltaTime<y.time;if(this.reset(),B.eventType&P&&this.count===0)return this.failTimeout();if(w&&K&&R){if(B.eventType!=ne)return this.failTimeout();var $=this.pTime?B.timeStamp-this.pTime<y.interval:!0,ve=!this.pCenter||gt(this.pCenter,B.center)<y.posThreshold;this.pTime=B.timeStamp,this.pCenter=B.center,!ve||!$?this.count=1:this.count+=1,this._input=B;var dt=this.count%y.taps;if(dt===0)return this.hasRequireFailures()?(this._timer=C(function(){this.state=ci,this.tryEmit()},y.interval,this),mn):ci}return Pn},failTimeout:function(){return this._timer=C(function(){this.state=Pn},this.options.interval,this),Pn},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ci&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function di(B,y){return y=y||{},y.recognizers=Z(y.recognizers,di.defaults.preset),new Yc(B,y)}di.VERSION="2.0.7",di.defaults={domEvents:!1,touchAction:Ia,enable:!0,inputTarget:null,inputClass:null,preset:[[Qc,{enable:!1}],[Tc,{enable:!1},["rotate"]],[Xc,{direction:le}],[ca,{direction:le},["swipe"]],[Aa],[Aa,{event:"doubletap",taps:2},["tap"]],[Ec]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var IF=1,xm=2;function Yc(B,y){this.options=m({},di.defaults,y||{}),this.options.inputTarget=this.options.inputTarget||B,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=B,this.input=Ge(this),this.touchAction=new zo(this,this.options.touchAction),Wm(this,!0),A(this.options.recognizers,function(R){var w=this.add(new R[0](R[1]));R[2]&&w.recognizeWith(R[2]),R[3]&&w.requireFailure(R[3])},this)}Yc.prototype={set:function(B){return m(this.options,B),B.touchAction&&this.touchAction.update(),B.inputTarget&&(this.input.destroy(),this.input.target=B.inputTarget,this.input.init()),this},stop:function(B){this.session.stopped=B?xm:IF},recognize:function(B){var y=this.session;if(!y.stopped){this.touchAction.preventDefaults(B);var R,w=this.recognizers,K=y.curRecognizer;(!K||K&&K.state&ci)&&(K=y.curRecognizer=null);for(var $=0;$<w.length;)R=w[$],y.stopped!==xm&&(!K||R==K||R.canRecognizeWith(K))?R.recognize(B):R.reset(),!K&&R.state&(mn|Gs|ki)&&(K=y.curRecognizer=R),$++}},get:function(B){if(B instanceof Ai)return B;for(var y=this.recognizers,R=0;R<y.length;R++)if(y[R].options.event==B)return y[R];return null},add:function(B){if(c(B,"add",this))return this;var y=this.get(B.options.event);return y&&this.remove(y),this.recognizers.push(B),B.manager=this,this.touchAction.update(),B},remove:function(B){if(c(B,"remove",this))return this;if(B=this.get(B),B){var y=this.recognizers,R=D(y,B);R!==-1&&(y.splice(R,1),this.touchAction.update())}return this},on:function(B,y){if(B!==g&&y!==g){var R=this.handlers;return A(E(B),function(w){R[w]=R[w]||[],R[w].push(y)}),this}},off:function(B,y){if(B!==g){var R=this.handlers;return A(E(B),function(w){y?R[w]&&R[w].splice(D(R[w],y),1):delete R[w]}),this}},emit:function(B,y){this.options.domEvents&&aF(B,y);var R=this.handlers[B]&&this.handlers[B].slice();if(!(!R||!R.length)){y.type=B,y.preventDefault=function(){y.srcEvent.preventDefault()};for(var w=0;w<R.length;)R[w](y),w++}},destroy:function(){this.element&&Wm(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Wm(B,y){var R=B.element;if(!!R.style){var w;A(B.options.cssProps,function(K,$){w=z(R.style,$),y?(B.oldCssProps[w]=R.style[w],R.style[w]=K):R.style[w]=B.oldCssProps[w]||""}),y||(B.oldCssProps={})}}function aF(B,y){var R=n.createEvent("Event");R.initEvent(B,!0,!0),R.gesture=y,y.target.dispatchEvent(R)}m(di,{INPUT_START:P,INPUT_MOVE:oe,INPUT_END:ne,INPUT_CANCEL:me,STATE_POSSIBLE:la,STATE_BEGAN:mn,STATE_CHANGED:Gs,STATE_ENDED:ki,STATE_RECOGNIZED:ci,STATE_CANCELLED:Oo,STATE_FAILED:Pn,DIRECTION_NONE:ae,DIRECTION_LEFT:be,DIRECTION_RIGHT:Ze,DIRECTION_UP:Be,DIRECTION_DOWN:rt,DIRECTION_HORIZONTAL:le,DIRECTION_VERTICAL:Re,DIRECTION_ALL:Vt,Manager:Yc,Input:xe,TouchAction:zo,TouchInput:Ce,MouseInput:Dt,PointerEventInput:xn,TouchMouseInput:zt,SingleTouchInput:Do,Recognizer:Ai,AttrRecognizer:Nn,Tap:Aa,Pan:ca,Swipe:Xc,Pinch:Tc,Rotate:Qc,Press:Ec,on:v,off:N,each:A,merge:h,extend:u,assign:m,inherit:f,bindFn:p,prefixed:z});var lF=typeof e!="undefined"?e:typeof self!="undefined"?self:{};lF.Hammer=di,typeof g=="function"&&g.amd?g(function(){return di}):t.exports?t.exports=di:e[i]=di})(window,document,"Hammer")})(aZ);var cn=aZ.exports;const lZ=1,CZ=2,Y0=4,RY={mousedown:lZ,mousemove:CZ,mouseup:Y0};function FY(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function SY(t){const e=t.prototype.handler;t.prototype.handler=function(i){const g=this.store;i.button>0&&i.type==="pointerdown"&&(FY(g,s=>s.pointerId===i.pointerId)||g.push(i)),e.call(this,i)}}function VY(t){t.prototype.handler=function(n){let i=RY[n.type];i&lZ&&n.button>=0&&(this.pressed=!0),i&CZ&&n.which===0&&(i=Y0),!!this.pressed&&(i&Y0&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}SY(cn.PointerEventInput);VY(cn.MouseInput);const UY=cn.Manager,xY=cn?[[cn.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[cn.Rotate,{enable:!1}],[cn.Pinch,{enable:!1}],[cn.Swipe,{enable:!1}],[cn.Pan,{threshold:0,enable:!1}],[cn.Press,{enable:!1}],[cn.Tap,{event:"doubletap",taps:2,enable:!1}],[cn.Tap,{event:"anytap",enable:!1}],[cn.Tap,{enable:!1}]]:null,cZ={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},WY={doubletap:["tap"]},NY={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},_0={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},wY={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},AZ={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},TY=typeof navigator!="undefined"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Uo=typeof window!="undefined"?window:global;let dZ=!1;try{const t={get passive(){return dZ=!0,!0}};Uo.addEventListener("test",t,t),Uo.removeEventListener("test",t,t)}catch{}const EY=TY.indexOf("firefox")!==-1,{WHEEL_EVENTS:QY}=_0,uZ="wheel",hZ=4.000244140625,XY=40,YY=.25;class _Y{constructor(e,n,i={}){this.element=e,this.callback=n,this.options=Object.assign({enable:!0},i),this.events=QY.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(g=>e.addEventListener(g,this.handleEvent,dZ?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===uZ&&(this.options.enable=n)}handleEvent(e){if(!this.options.enable)return;let n=e.deltaY;Uo.WheelEvent&&(EY&&e.deltaMode===Uo.WheelEvent.DOM_DELTA_PIXEL&&(n/=Uo.devicePixelRatio),e.deltaMode===Uo.WheelEvent.DOM_DELTA_LINE&&(n*=XY));const i={x:e.clientX,y:e.clientY};n!==0&&n%hZ==0&&(n=Math.floor(n/hZ)),e.shiftKey&&n&&(n=n*YY),this._onWheel(e,-n,i)}_onWheel(e,n,i){this.callback({type:uZ,center:i,delta:n,srcEvent:e,pointerType:"mouse",target:e.target})}}const{MOUSE_EVENTS:HY}=_0,mZ="pointermove",fZ="pointerover",pZ="pointerout",BZ="pointerleave";class kY{constructor(e,n,i={}){this.element=e,this.callback=n,this.pressed=!1,this.options=Object.assign({enable:!0},i),this.enableMoveEvent=this.options.enable,this.enableLeaveEvent=this.options.enable,this.enableOutEvent=this.options.enable,this.enableOverEvent=this.options.enable,this.events=HY.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),this.events.forEach(g=>e.addEventListener(g,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===mZ&&(this.enableMoveEvent=n),e===fZ&&(this.enableOverEvent=n),e===pZ&&(this.enableOutEvent=n),e===BZ&&(this.enableLeaveEvent=n)}handleEvent(e){this.handleOverEvent(e),this.handleOutEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this.callback({type:fZ,srcEvent:e,pointerType:"mouse",target:e.target})}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this.callback({type:pZ,srcEvent:e,pointerType:"mouse",target:e.target})}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this.callback({type:BZ,srcEvent:e,pointerType:"mouse",target:e.target})}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this.callback({type:mZ,srcEvent:e,pointerType:"mouse",target:e.target});break;case"mouseup":this.pressed=!1;break}}}const{KEY_EVENTS:KY}=_0,bZ="keydown",yZ="keyup";class LY{constructor(e,n,i={}){this.element=e,this.callback=n,this.options=Object.assign({enable:!0},i),this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=KY.concat(i.events||[]),this.handleEvent=this.handleEvent.bind(this),e.tabIndex=i.tabIndex||0,e.style.outline="none",this.events.forEach(g=>e.addEventListener(g,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===bZ&&(this.enableDownEvent=n),e===yZ&&(this.enableUpEvent=n)}handleEvent(e){const n=e.target||e.srcElement;n.tagName==="INPUT"&&n.type==="text"||n.tagName==="TEXTAREA"||(this.enableDownEvent&&e.type==="keydown"&&this.callback({type:bZ,srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&e.type==="keyup"&&this.callback({type:yZ,srcEvent:e,key:e.key,target:e.target}))}}const vZ="contextmenu";class MY{constructor(e,n,i={}){this.element=e,this.callback=n,this.options=Object.assign({enable:!0},i),this.handleEvent=this.handleEvent.bind(this),e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===vZ&&(this.options.enable=n)}handleEvent(e){!this.options.enable||this.callback({type:vZ,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})}}const H0=1,ZC=2,k0=4,PY={pointerdown:H0,pointermove:ZC,pointerup:k0,mousedown:H0,mousemove:ZC,mouseup:k0},JY=1,DY=2,zY=3,OY=0,jY=1,qY=2,$Y=1,e4=2,t4=4;function n4(t){const e=PY[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:g}=t.srcEvent;let s=!1,o=!1,r=!1;return e===k0||e===ZC&&!Number.isFinite(n)?(s=g===JY,o=g===DY,r=g===zY):e===ZC?(s=Boolean(n&$Y),o=Boolean(n&t4),r=Boolean(n&e4)):e===H0&&(s=i===OY,o=i===jY,r=i===qY),{leftButton:s,middleButton:o,rightButton:r}}function i4(t,e){const{srcEvent:n}=t;if(!t.center&&!Number.isFinite(n.clientX))return null;const i=t.center||{x:n.clientX,y:n.clientY},g=e.getBoundingClientRect(),s=g.width/e.offsetWidth||1,o=g.height/e.offsetHeight||1,r={x:(i.x-g.left-e.clientLeft)/s,y:(i.y-g.top-e.clientTop)/o};return{center:i,offsetCenter:r}}const GZ={srcElement:"root",priority:0};class g4{constructor(e){this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this.handleEvent=this.handleEvent.bind(this),this._active=!1}isEmpty(){return!this._active}add(e,n,i,g=!1,s=!1){const{handlers:o,handlersByElement:r}=this;i&&(typeof i!="object"||i.addEventListener)&&(i={srcElement:i}),i=i?Object.assign({},GZ,i):GZ;let I=r.get(i.srcElement);I||(I=[],r.set(i.srcElement,I));const a={type:e,handler:n,srcElement:i.srcElement,priority:i.priority};g&&(a.once=!0),s&&(a.passive=!0),o.push(a),this._active=this._active||!a.passive;let l=I.length-1;for(;l>=0&&!(I[l].priority>=a.priority);)l--;I.splice(l+1,0,a)}remove(e,n){const{handlers:i,handlersByElement:g}=this;for(let s=i.length-1;s>=0;s--){const o=i[s];if(o.type===e&&o.handler===n){i.splice(s,1);const r=g.get(o.srcElement);r.splice(r.indexOf(o),1),r.length===0&&g.delete(o.srcElement)}}this._active=i.some(s=>!s.passive)}handleEvent(e){if(this.isEmpty())return;const n=this._normalizeEvent(e);let i=e.srcEvent.target;for(;i&&i!==n.rootElement;){if(this._emit(n,i),n.handled)return;i=i.parentNode}this._emit(n,"root")}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let g=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,g=!0},r=[];for(let I=0;I<i.length;I++){const{type:a,handler:l,once:C}=i[I];if(l(Object.assign({},e,{type:a,stopPropagation:s,stopImmediatePropagation:o})),C&&r.push(i[I]),g)break}for(let I=0;I<r.length;I++){const{type:a,handler:l}=r[I];this.remove(a,l)}}}_normalizeEvent(e){const n=this.eventManager.element;return Object.assign({},e,n4(e),i4(e,n),{handled:!1,rootElement:n})}}const s4={events:null,recognizers:null,recognizerOptions:{},Manager:UY,touchAction:"none",tabIndex:0};class o4{constructor(e=null,n={}){this.options=Object.assign({},s4,n),this.events=new Map,this._onBasicInput=this._onBasicInput.bind(this),this._onOtherEvent=this._onOtherEvent.bind(this),this.setElement(e);const{events:i}=n;i&&this.on(i)}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||xY}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(cZ).forEach(g=>{const s=this.manager.get(g);s&&cZ[g].forEach(o=>{s.recognizeWith(o)})});for(const g in n.recognizerOptions){const s=this.manager.get(g);if(s){const o=n.recognizerOptions[g];delete o.enable,s.set(o)}}this.wheelInput=new _Y(e,this._onOtherEvent,{enable:!1}),this.moveInput=new kY(e,this._onOtherEvent,{enable:!1}),this.keyInput=new LY(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new MY(e,this._onOtherEvent,{enable:!1});for(const[g,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(g,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const g=i.get(e);if(g&&g.options.enable!==n){g.set({enable:n});const s=WY[e];s&&!this.options.recognizers&&s.forEach(o=>{const r=i.get(o);n?(r.requireFailure(e),g.dropRequireFailure(o)):r.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,g,s){if(typeof e!="string"){i=n;for(const l in e)this._addEventHandler(l,e[l],i,g,s);return}const{manager:o,events:r}=this,I=AZ[e]||e;let a=r.get(I);a||(a=new g4(this),r.set(I,a),a.recognizerName=wY[I]||I,o&&o.on(I,a.handleEvent)),a.add(e,n,i,g,s),a.isEmpty()||this._toggleRecognizer(a.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:i}=this,g=AZ[e]||e,s=i.get(g);if(!!s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let r=!1;for(const I of i.values())if(I.recognizerName===o&&!I.isEmpty()){r=!0;break}r||this._toggleRecognizer(o,!1)}}_onBasicInput(e){const{srcEvent:n}=e,i=NY[n.type];i&&this.manager.emit(i,e)}_onOtherEvent(e){this.manager.emit(e.type,e)}}function ls(){}const r4=t=>{let{isDragging:e}=t;return e?"grabbing":"grab"};function I4(t){return{id:t.string,width:t.oneOfType([t.number,t.string]),height:t.oneOfType([t.number,t.string]),layers:t.oneOfType([t.object,t.array]),layerFilter:t.func,views:t.oneOfType([t.object,t.array]),viewState:t.object,effects:t.arrayOf(t.instanceOf(LG)),controller:t.oneOfType([t.func,t.bool,t.object]),gl:t.object,glOptions:t.object,parameters:t.object,pickingRadius:t.number,useDevicePixels:t.oneOfType([t.bool,t.number]),touchAction:t.string,eventRecognizerOptions:t.object,onWebGLInitialized:t.func,onResize:t.func,onViewStateChange:t.func,onInteractionStateChange:t.func,onBeforeRender:t.func,onAfterRender:t.func,onLoad:t.func,onError:t.func,debug:t.bool,drawPickingColors:t.bool,_framebuffer:t.object,_animate:t.bool,_pickable:t.bool,_typedArrayManagerProps:t.object}}const ZZ={id:"",width:"100%",height:"100%",pickingRadius:0,layerFilter:null,glOptions:{},gl:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},onWebGLInitialized:ls,onResize:ls,onViewStateChange:ls,onInteractionStateChange:ls,onBeforeRender:ls,onAfterRender:ls,onLoad:ls,onError:(t,e)=>pe.error(t)(),_onMetrics:null,getCursor:r4,debug:!1,drawPickingColors:!1};class xo{constructor(e){e=S(S({},ZZ),e),this.props={},this.width=0,this.height=0,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this._needsRedraw=!0,this._pickRequest={},this._lastPointerDownInfo=null,this.viewState=null,this.interactiveState={isHovering:!1,isDragging:!1},this._onEvent=this._onEvent.bind(this),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),e.viewState&&e.initialViewState&&pe.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),Le.getBrowser()==="IE"&&pe.warn("IE 11 support will be deprecated in v8.0")(),e.gl||typeof document!="undefined"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Kl({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Go.setProps(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager&&(this.layerManager.finalize(),this.layerManager=null,this.viewManager.finalize(),this.viewManager=null,this.effectManager.finalize(),this.effectManager=null,this.deckRenderer.finalize(),this.deckRenderer=null,this.deckPicker.finalize(),this.deckPicker=null,this.eventManager.destroy(),this.eventManager=null,this.tooltip.remove(),this.tooltip=null),!this.props.canvas&&!this.props.gl&&this.canvas&&(this.canvas.parentElement.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&pe.removed("onLayerHover","onHover")(),"onLayerClick"in e&&pe.removed("onLayerClick","onClick")(),e.initialViewState&&!So(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),g=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||i||g||s||o,n}redraw(e){if(!this.layerManager)return;const n=e||this.needsRedraw({clearRedrawFlags:!0});!n||(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}getViews(){return this.viewManager.views}getViewports(e){return this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_pick(e,n,i){const{stats:g}=this;g.get("Pick Count").incrementCount(),g.get(n).timeStart();const s=this.deckPicker[e](S({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport},i));return g.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Cn(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;let{width:n,height:i}=e;(n||n===0)&&(n=Number.isFinite(n)?"".concat(n,"px"):n,this.canvas.style.width=n),(i||i===0)&&(i=Number.isFinite(i)?"".concat(i,"px"):i,this.canvas.style.position="absolute",this.canvas.style.height=i)}_updateCanvasSize(){if(this._checkForCanvasSizeChange()){const{width:e,height:n}=this;this.viewManager.setProps({width:e,height:n}),this.props.onResize({width:this.width,height:this.height})}}_checkForCanvasSizeChange(){const{canvas:e}=this;if(!e)return!1;const n=e.clientWidth||e.width,i=e.clientHeight||e.height;return n!==this.width||i!==this.height?(this.width=n,this.height=i,!0):!1}_createAnimationLoop(e){const{width:n,height:i,gl:g,glOptions:s,debug:o,onError:r,onBeforeRender:I,onAfterRender:a,useDevicePixels:l,autoResizeDrawingBuffer:C}=e;return new _T({width:n,height:i,useDevicePixels:l,autoResizeDrawingBuffer:C,autoResizeViewport:!1,gl:g,onCreateContext:c=>nv(J(S(S({},s),c),{canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()})),onInitialize:c=>this._setGLContext(c.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:I,onAfterRender:a,onError:r})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new gZ({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_onPointerMove(e){const{_pickRequest:n}=this;if(e.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(e.leftButton||e.rightButton)return;{const i=e.offsetCenter;if(!i)return;n.x=i.x,n.y=i.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=e,n.mode="hover"}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:n,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.interactiveState.isHovering=n.length>0;let g=i,s=!1;for(const o of n)g=o,s=o.layer.onHover(o,e.event);if(!s&&this.props.onHover&&this.props.onHover(g,e.event),this.props.getTooltip){const o=this.props.getTooltip(g);this.tooltip.setTooltip(o,g.x,g.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.interactiveState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,t0(e,{enable:!0,copyState:!0})),this.tooltip=new ZY(this.canvas),Zi(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new UG;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new o4(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const g in xG)this.eventManager.on(g,this._onEvent);this.viewManager=new eY({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new $X(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new cY,this.deckRenderer=new mY(e),this.deckPicker=new vY(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;Zi(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers(S({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects()},n)),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),pe.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(!1),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState=J(S({},this.viewState),{[e.viewId]:n}),this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.interactiveState.isDragging=e.isDragging,this.props.onInteractionStateChange(e)}_onEvent(e){const n=xG[e.type],i=e.offsetCenter;if(!n||!i)return;const g=this.layerManager.getLayers(),s=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:g,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:o}=s,r=o&&(o[n.handler]||o.props[n.handler]),I=this.props[n.handler];let a=!1;r&&(a=r.call(o,s,e)),!a&&I&&I(s,e)}_onPointerDown(e){const n=e.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=ts.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}xo.getPropTypes=I4;xo.defaultProps=ZZ;xo.VERSION=JW.VERSION;class K0{constructor(e,n){this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:g}=n;let s=i;if(i&&i.length!==g){s=new Float32Array(g);const o=n.elementOffset||0;for(let r=0;r<g;++r)s[r]=i[o+r]}return s}getAccessor(){return S(S({},this.source.getAccessor()),this.opts)}}function a4(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function RC(t){return t.stride||t.size*t.bytesPerElement}function RZ(t,e){e.offset&&pe.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=RC(t),i="vertexOffset"in e?e.vertexOffset:t.vertexOffset||0,g=e.elementOffset||0,s=i*n+g*t.bytesPerElement+(t.offset||0);return J(S({},e),{offset:s,stride:n})}function l4(t,e){const n=RZ(t,e);return{high:n,low:J(S({},n),{offset:n.offset+t.size*4})}}class C4{constructor(e,n){this.gl=e,this.id=n.id,this.size=n.size;const i=n.logicalType||n.type,g=i===5130;let{defaultValue:s}=n;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0),n.defaultValue=s;let o=i;g?o=5126:!o&&n.isIndexed?o=e&&a0(e,Ee.ELEMENT_INDEX_UINT32)?5125:5123:o||(o=5126),n.logicalType=i,n.type=o;let r=a4(i||o||5126);this.shaderAttributes={},this.doublePrecision=g,g&&n.fp64===!1&&(r=Float32Array),n.bytesPerElement=r.BYTES_PER_ELEMENT,this.defaultType=r,this.value=null,this.settings=n,this.state={externalBuffer:null,bufferAccessor:n,allocatedValue:null,constant:!1},this._buffer=null,this.setData(n)}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new Te(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*RC(e):0}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Go.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},g=this.value instanceof Float64Array,s=l4(this.getAccessor(),n||{});return i[e]=new K0(this,s.high),i["".concat(e,"64Low")]=g?new K0(this,s.low):new Float32Array(this.size),i}if(n){const i=RZ(this.getAccessor(),n);return{[e]:new K0(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}setData(e){const{state:n}=this;ArrayBuffer.isView(e)?e={value:e}:e instanceof Te&&(e={buffer:e});const i=S(S({},this.settings),e);if(n.bufferAccessor=i,e.constant){let g=e.value;if(g=this._normalizeValue(g,[],0),this.settings.normalized&&(g=this._normalizeConstant(g)),!(!n.constant||!this._areValuesEqual(g,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=g}else if(e.buffer){const g=e.buffer;n.externalBuffer=g,n.constant=!1,this.value=e.value;const s=e.value instanceof Float64Array;i.type=e.type||g.accessor.type,i.bytesPerElement=g.accessor.BYTES_PER_ELEMENT*(s?2:1),i.stride=RC(i)}else if(e.value){this._checkExternalBuffer(e);let g=e.value;n.externalBuffer=null,n.constant=!1,this.value=g,i.bytesPerElement=g.BYTES_PER_ELEMENT,i.stride=RC(i);const{buffer:s,byteOffset:o}=this;this.doublePrecision&&g instanceof Float64Array&&(g=E0(g,i));const r=g.byteLength+o+i.stride*2;s.byteLength<r&&s.reallocate(r),s.setAccessor(null),s.subData({data:g,offset:o}),i.type=e.type||s.accessor.type}return!0}updateSubBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{value:n}=this,{startOffset:i=0,endOffset:g}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?E0(n,{size:this.size,startIndex:i,endIndex:g}):n.subarray(i,g),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e){let{numInstances:n,copy:i=!1}=e;const{state:g}=this,s=g.allocatedValue,o=Go.allocate(s,n+1,{size:this.size,type:this.defaultType,copy:i});this.value=o;const{buffer:r,byteOffset:I}=this;return r.byteLength<o.byteLength+I&&(r.reallocate(o.byteLength+I),i&&s&&r.subData({data:s instanceof Float64Array?E0(s,this):s,offset:I})),g.allocatedValue=o,g.constant=!1,g.externalBuffer=null,g.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!e.constant&&n){const i=this.defaultType;let g=!1;if(this.doublePrecision&&(g=n.BYTES_PER_ELEMENT<4),g)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&pe.warn("Attribute ".concat(this.id," is normalized"))()}}_normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:g,size:s}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e)return n[i]=g[0],n;switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:g[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:g[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:g[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:g[0];break;default:let o=s;for(;--o>=0;)n[i+o]=Number.isFinite(e[o])?e[o]:g[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let g=0;g<i;g++)if(e[g]!==n[g])return!1;return!0}}const FZ=[],SZ=[];function EI(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,i=FZ;const g={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(SZ.length=t.length,i=SZ):i=FZ,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),g.index=e-1),{iterable:i,objectInfo:g}}function VZ(t){return t&&t[Symbol.asyncIterator]}function UZ(t,e){let{size:n,stride:i,offset:g,startIndices:s,nested:o}=e;const r=t.BYTES_PER_ELEMENT,I=i?i/r:n,a=g?g/r:0,l=Math.floor((t.length-a)/I);return(C,c)=>{let{index:A,target:d}=c;if(!s){const f=A*I+a;for(let p=0;p<n;p++)d[p]=t[f+p];return d}const m=s[A],u=s[A+1]||l;let h;if(o){h=new Array(u-m);for(let f=m;f<u;f++){const p=f*I+a;d=new Array(n);for(let b=0;b<n;b++)d[b]=t[p+b];h[f-m]=d}}else if(I===n)h=t.subarray(m*n+a,u*n+a);else{h=new t.constructor((u-m)*n);let f=0;for(let p=m;p<u;p++){const b=p*I+a;for(let Z=0;Z<n;Z++)h[f++]=t[b+Z]}}return h}}const c4=[],FC=[[0,1/0]];function A4(t,e){if(t===FC||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let g=0;for(let s=0;s<i;s++){const o=t[s];o[1]<e[0]?(n.push(o),g=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(g,0,e),n}function L0(t){let{source:e,target:n,start:i=0,end:g,size:s,getData:o}=t;g=g||n.length;const r=e.length,I=g-i;if(r>I){n.set(e.subarray(0,I),i);return}if(n.set(e,i),!o)return;let a=r;for(;a<I;){const l=o(a,e);for(let C=0;C<s;C++)n[i+a]=l[C]||0,a++}}function d4(t){let{source:e,target:n,size:i,getData:g,sourceStartIndices:s,targetStartIndices:o}=t;if(!Array.isArray(o))return L0({source:e,target:n,size:i,getData:g}),n;let r=0,I=0;const a=g&&((C,c)=>g(C+I,c)),l=Math.min(s.length,o.length);for(let C=1;C<l;C++){const c=s[C]*i,A=o[C]*i;L0({source:e.subarray(r,c),target:n,start:I,end:A,size:i,getData:a}),r=c,I=A}return I<n.length&&L0({source:[],target:n,start:I,size:i,getData:a}),n}const u4={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function xZ(t,e){return t?(Number.isFinite(t)&&(t={duration:t}),t.type=t.type||"interpolation",S(S(S({},u4[t.type]),e),t)):null}function WZ(t,e){return e.getBuffer()?[e.getBuffer(),{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function NZ(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function wZ(t){t.push(t.shift())}function M0(t,e){const{doublePrecision:n,settings:i,value:g,size:s}=t,o=n&&g instanceof Float64Array?2:1;return(i.noAlloc?g.length:e*s)*o}function TZ(t){let{buffer:e,numInstances:n,attribute:i,fromLength:g,fromStartIndices:s,getData:o=f=>f}=t;const r=i.doublePrecision&&i.value instanceof Float64Array?2:1,I=i.size*r,a=i.byteOffset,l=i.startIndices,C=s&&l,c=M0(i,n),A=i.state.constant;if(!C&&g>=c)return;const d=A?i.value:i.getBuffer().getData({srcByteOffset:a});if(i.settings.normalized&&!A){const f=o;o=(p,b)=>i._normalizeConstant(f(p,b))}const m=A?(f,p)=>o(d,p):(f,p)=>o(d.subarray(f,f+I),p),u=e.getData({length:g}),h=new Float32Array(c);d4({source:u,target:h,sourceStartIndices:s,targetStartIndices:l,size:I,getData:m}),e.byteLength<h.byteLength+a&&e.reallocate(h.byteLength+a),e.subData({data:h,offset:a})}class P0 extends C4{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n);const{transition:i=!1,noAlloc:g=!1,update:s=null,accessor:o=null,transform:r=null,startIndices:I=null}=n;Object.assign(this.settings,{transition:i,noAlloc:g,update:s||o&&this._autoUpdater,accessor:o,transform:r}),Object.assign(this.state,{lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:FC,startIndices:I}),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,g=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return xZ(g,i)}setNeedsUpdate(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,n=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:g=1/0}=n;this.state.updateRanges=A4(this.state.updateRanges,[i,g])}else this.state.updateRanges=FC}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=c4}setNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||e}update(e){this.setData(e)}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate({numInstances:e,copy:n.updateRanges!==FC}),!0):!1}updateBuffer(e){let{numInstances:n,data:i,props:g,context:s}=e;if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:r,noAlloc:I}}=this;let a=!0;if(r){for(const[l,C]of o)r.call(s,this,{data:i,startRow:l,endRow:C,props:g,numInstances:n});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[l,C]of o){const c=Number.isFinite(l)?this.getVertexOffset(l):0,A=Number.isFinite(C)?this.getVertexOffset(C):I||!Number.isFinite(n)?this.value.length:n*this.size;super.updateSubBuffer({startOffset:c,endOffset:A})}this._checkAttributeArray()}else a=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),a}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:i,settings:g}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(g.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),ArrayBuffer.isView(e)&&(e={value:e}),g.transform||n!==this.startIndices){Cn(ArrayBuffer.isView(e.value),"invalid ".concat(g.accessor));const o=e.size&&e.size!==this.size;return i.binaryAccessor=UZ(e.value,{size:e.size||this.size,stride:e.stride,offset:e.offset,startIndices:n,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?n[e]:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,n){let{data:i,startRow:g,endRow:s,props:o,numInstances:r}=n;if(e.constant)return;const{settings:I,state:a,value:l,size:C,startIndices:c}=e,{accessor:A,transform:d}=I,m=a.binaryAccessor||(typeof A=="function"?A:o[A]);Cn(typeof m=="function",'accessor "'.concat(A,'" is not a function'));let u=e.getVertexOffset(g);const{iterable:h,objectInfo:f}=EI(i,g,s);for(const p of h){f.index++;let b=m(p,f);if(d&&(b=d.call(this,b)),c){const Z=(f.index<c.length-1?c[f.index+1]:r)-c[f.index];if(b&&Array.isArray(b[0])){let v=u;for(const N of b)e._normalizeValue(N,l,v),v+=C}else b&&b.length>C?l.set(b,u):(e._normalizeValue(b,f.target,0),JX({target:l,source:f.target,start:u,count:Z}));u+=Z*C}else e._normalizeValue(b,l,u),u+=C}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class h4{constructor(e){let{gl:n,attribute:i,timeline:g}=e;this.gl=n,this.type="interpolation",this.transition=new wI(g),this.attribute=i,this.attributeInTransition=new P0(n,i.settings),this.currentStartIndices=i.startIndices,this.currentLength=0,this.transform=f4(n,i);const s={byteLength:0,usage:35050};this.buffers=[new Te(n,s),new Te(n,s)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}const{gl:i,buffers:g,attribute:s}=this;wZ(g);const o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const r of g)TZ(S({buffer:r},o));this.currentStartIndices=s.startIndices,this.currentLength=M0(s,n),this.attributeInTransition.update({buffer:g[1],value:s.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:g[0],aTo:WZ(i,s)},feedbackBuffers:{vCurrent:g[1]}})}update(){const e=this.transition.update();if(e){const{time:n,settings:{duration:i,easing:g}}=this.transition,s=g(n/i);this.transform.run({uniforms:{time:s}})}return e}cancel(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete()}}const m4=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function f4(t,e){const n=NZ(e.size);return new S0(t,{vs:m4,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class p4{constructor(e){let{gl:n,attribute:i,timeline:g}=e;this.gl=n,this.type="spring",this.transition=new wI(g),this.attribute=i,this.attributeInTransition=new P0(n,J(S({},i.settings),{normalized:!1})),this.currentStartIndices=i.startIndices,this.currentLength=0,this.texture=b4(n),this.framebuffer=y4(n,this.texture),this.transform=B4(n,i,this.framebuffer);const s={byteLength:0,usage:35050};this.buffers=[new Te(n,s),new Te(n,s),new Te(n,s)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:g,attribute:s}=this,o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const r of g)TZ(S({buffer:r},o));this.currentStartIndices=s.startIndices,this.currentLength=M0(s,n),this.attributeInTransition.update({buffer:g[1],value:s.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:WZ(i,s)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:g}=this;return g.update()?(n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:g.settings.stiffness,damping:g.settings.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),wZ(e),this.attributeInTransition.update({buffer:e[1],value:this.attribute.value}),ql(i)[0]>0||g.end(),!0):!1}cancel(){for(this.transition.cancel(),this.transform.delete();this.buffers.length;)this.buffers.pop().delete();this.texture.delete(),this.texture=null,this.framebuffer.delete(),this.framebuffer=null}}function B4(t,e,n){const i=NZ(e.size);return new S0(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function b4(t){return new on(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function y4(t,e){return new Ct(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const v4={interpolation:h4,spring:p4};class G4{constructor(e,n){let{id:i,timeline:g}=n;this.id=i,this.gl=e,this.timeline=g,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=S0.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update(e){let{attributes:n,transitions:i,numInstances:g}=e;this.numInstances=g||1;for(const s in n){const o=n[s],r=o.getTransitionSetting(i);!r||this._updateAttribute(s,o,r)}for(const s in this.transitions){const o=n[s];(!o||!o.getTransitionSetting(i))&&this._removeTransition(s)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const g=this.transitions[e];let s=!g||g.type!==i.type;if(s){if(!this.isSupported){pe.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}g&&this._removeTransition(e);const o=v4[i.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,gl:this.gl}):(pe.error("unsupported transition type '".concat(i.type,"'"))(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const EZ="attributeManager.invalidate",Z4="attributeManager.updateStart",R4="attributeManager.updateEnd",F4="attribute.updateStart",S4="attribute.allocate",V4="attribute.updateEnd";class U4{constructor(e){let{id:n="attribute-manager",stats:i,timeline:g}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.accessors={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new G4(e,{id:"".concat(n,"-transitions"),timeline:g}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){return this.needsRedraw=!0,this}add(e,n){this._add(e,n)}addInstanced(e,n){this._add(e,n,{instanced:1})}remove(e){for(let n=0;n<e.length;n++){const i=e[n];this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}}invalidate(e,n){const i=this._invalidateTrigger(e,n);Tt(EZ,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Tt(EZ,this,"all")}update(){let{data:e,numInstances:n,startIndices:i=null,transitions:g,props:s={},buffers:o={},context:r={}}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},I=!1;Tt(Z4,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const a in this.attributes){const l=this.attributes[a],C=l.settings.accessor;l.startIndices=i,s[a]&&pe.removed("props.".concat(a),"data.attributes.".concat(a))(),l.setExternalBuffer(o[a])||l.setBinaryValue(o[C],e.startIndices)||!o[C]&&l.setConstantValue(s[C])||l.needsUpdate()&&(I=!0,this._updateAttribute({attribute:l,numInstances:n,data:e,props:s,context:r})),this.needsRedraw|=l.needsRedraw()}I&&Tt(R4,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:g})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getChangedAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:n,attributeTransitionManager:i}=this,g=S({},i.getAttributes());for(const s in n){const o=n[s];o.needsRedraw(e)&&!i.hasAttribute(s)&&(g[s]=o)}return g}getShaderAttributes(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e||(e=this.getAttributes());const i={};for(const g in e)n[g]||Object.assign(i,e[g].getShaderAttributes());return i}getAccessors(){return this.updateTriggers}_add(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};n&&pe.warn("AttributeManager.add({updaters}) - updater map no longer supported")();for(const g in e){const s=e[g];this.attributes[g]=this._createAttribute(g,s,i)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const g=J(S({},n),{id:e,isIndexed:n.isIndexed||n.elements||!1,constant:n.constant||!1,size:n.elements&&1||n.size||1,value:n.value||null,divisor:n.instanced||i.instanced?1:n.divisor||0});return new P0(this.gl,g)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(g=>{e[g]||(e[g]=[]),e[g].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:g}=this,s=g[e];return s&&s.forEach(o=>{const r=i[o];r&&r.setNeedsUpdate(r.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(Tt(F4,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Tt(S4,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,Tt(V4,n,i))}}class x4 extends wI{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:g,easing:s}}=this,o=s(e/g);this._value=ss(n,i,o)}}const QZ=1e-5;function XZ(t,e,n,i,g){const s=e-t,r=(n-e)*g,I=-s*i;return r+I+s+e}function W4(t,e,n,i,g){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=XZ(t[o],e[o],n[o],i,g);return s}return XZ(t,e,n,i,g)}function YZ(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const g=t[i]-e[i];n+=g*g}return Math.sqrt(n)}return Math.abs(t-e)}class N4 extends wI{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:g}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let r=W4(s,o,n,i,g);const I=YZ(r,n),a=YZ(r,o);I<QZ&&a<QZ&&(r=n,this.end()),this._prevValue=o,this._currValue=r}}const w4={interpolation:x4,spring:N4};class T4{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,g){const{transitions:s}=this;if(s.has(e)){const I=s.get(e),{value:a=I.settings.fromValue}=I;n=a,this.remove(e)}if(g=xZ(g),!g)return;const o=w4[g.type];if(!o){pe.error("unsupported transition type '".concat(g.type,"'"))();return}const r=new o(this.timeline);r.start(J(S({},g),{fromValue:n,toValue:i})),s.set(e,r)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}const{COMPONENT:E4}=fC;function Q4(t){const e=D0(t);for(const n in e){const i=e[n],{validate:g}=i;if(g&&!g(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function X4(t,e){const n=_Z({newProps:t,oldProps:e,propTypes:D0(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=_4(t,e);let g=!1;return i||(g=H4(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:g,extensionsChanged:k4(t,e),transitionsChanged:Y4(t,e)}}function Y4(t,e){if(!t.transitions)return null;const n={},i=D0(t);for(const g in t.transitions){const s=i[g],o=s&&s.type;(o==="number"||o==="color"||o==="array")&&J0(t[g],e[g],s)&&(n[g]=!0)}return n}function _Z(){let{newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:g="props"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(e===t)return null;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(g," changed shallowly");for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return"".concat(g,".").concat(s," added");const o=J0(t[s],e[s],i[s]);if(o)return"".concat(g,".").concat(s," ").concat(o)}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return"".concat(g,".").concat(s," dropped");if(!Object.hasOwnProperty.call(t,s)){const o=J0(t[s],e[s],i[s]);if(o)return"".concat(g,".").concat(s," ").concat(o)}}return null}function J0(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function _4(t,e){if(e===null)return"oldProps is null, initial diff";let n=null;const{dataComparator:i,_dataDiff:g}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&g&&(n=g(t.data,e.data)||n),n}function H4(t,e){if(e===null)return"oldProps is null, initial diff";if("all"in t.updateTriggers&&HZ(t,e,"all"))return{all:!0};const n={};let i=!1;for(const g in t.updateTriggers)g!=="all"&&HZ(t,e,g)&&(n[g]=!0,i=n);return i}function k4(t,e){if(e===null)return"oldProps is null, initial diff";const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let g=0;g<i.length;g++)if(!i[g].equals(n[g]))return!0;return!1}function HZ(t,e,n){let i=t.updateTriggers[n];i=i==null?{}:i;let g=e.updateTriggers[n];return g=g==null?{}:g,_Z({oldProps:g,newProps:i,triggerName:n})}function D0(t){const e=t[E4],n=e&&e.constructor;return n?n._propTypes:{}}const K4="count(): argument not an object",L4="count(): argument not a container";function M4(t){if(!J4(t))throw new Error(K4);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(P4(t))return Object.keys(t).length;throw new Error(L4)}function P4(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function J4(t){return t!==null&&typeof t=="object"}function D4(t,e){if(!e)return t;const n=S(S({},t),e);if("defines"in e&&(n.defines=S(S({},t.defines),e.defines)),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(g=>g.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i=S({},t.inject);for(const g in e.inject)i[g]=(i[g]||"")+e.inject[g];n.inject=i}return n}const z4={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},z0={};function O4(t,e){const n=t.context&&t.context.gl;if(!n||!e)return null;if(e instanceof on)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let i=null;e.compressed&&(i={[10241]:e.data.length>1?9985:9729});const g=new on(n,J(S({},e),{parameters:S(S(S({},z4),i),t.props.textureParameters)}));return z0[g.id]=!0,g}function j4(t){!t||!(t instanceof on)||z0[t.id]&&(t.delete(),delete z0[t.id])}const q4={boolean:{validate(t,e){return!0},equal(t,e,n){return Boolean(t)===Boolean(e)}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||XI(t)&&(t.length===3||t.length===4)},equal(t,e,n){return O0(t,e)}},accessor:{validate(t,e){const n=SC(t);return n==="function"||n===SC(e.value)},equal(t,e,n){return typeof e=="function"?!0:O0(t,e)}},array:{validate(t,e){return e.optional&&!t||XI(t)},equal(t,e,n){return n.compare?O0(t,e):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n?n.props:{};return i&&t?i(t):t}},image:{transform:(t,e,n)=>O4(n,t),release:t=>{j4(t)}}};function O0(t,e){if(t===e)return!0;if(!XI(t)||!XI(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function $4(t){const e={},n={},i={};for(const[g,s]of Object.entries(t))if(s&&s.deprecatedFor)i[g]=Array.isArray(s.deprecatedFor)?s.deprecatedFor:[s.deprecatedFor];else{const o=e_(g,s);e[g]=o,n[g]=o.value}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function e_(t,e){switch(SC(e)){case"object":return QI(t,e);case"array":return QI(t,{type:"array",value:e,compare:!1});case"boolean":return QI(t,{type:"boolean",value:e});case"number":return QI(t,{type:"number",value:e});case"function":return QI(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function QI(t,e){return"type"in e?S(S({name:t},q4[e.type]),e):"value"in e?S({name:t,type:SC(e.value)},e):{name:t,type:"object",value:e}}function XI(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function SC(t){return XI(t)?"array":t===null?"null":typeof t}const{COMPONENT:j0,ASYNC_ORIGINAL:VC,ASYNC_RESOLVED:YI,ASYNC_DEFAULTS:UC}=fC;function t_(){const t=this,e=kZ(t.constructor),n=Object.create(e);n[j0]=t,n[VC]={},n[YI]={};for(let i=0;i<arguments.length;++i){const g=arguments[i];for(const s in g)n[s]=g[s]}return Object.freeze(n),n}function kZ(t){const e=xC(t,"_mergedDefaultProps");return e||(n_(t),t._mergedDefaultProps)}function n_(t){if(!t.prototype)return;const n=Object.getPrototypeOf(t),i=kZ(n),g=xC(t,"defaultProps")||{},s=$4(g),o=i_(s.defaultProps,i,t),r=S(S({},n._propTypes),s.propTypes);s_(o,r);const I=S(S({},n._deprecatedProps),s.deprecatedProps);g_(o,I),t._mergedDefaultProps=o,t._propTypes=r,t._deprecatedProps=I}function i_(t,e,n){const i=Object.create(null);Object.assign(i,e,t);const g=r_(n);return delete t.id,Object.defineProperties(i,{id:{writable:!0,value:g}}),i}function g_(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const g="".concat(this.id,": ").concat(n);for(const s of e[n])KZ(this,s)||(this[s]=i);pe.deprecated(g,e[n].join("/"))()}})}function s_(t,e){const n={},i={};for(const g in e){const s=e[g],{name:o,value:r}=s;s.async&&(n[o]=r,i[o]=o_(o))}t[UC]=n,t[VC]={},Object.defineProperties(t,i)}function o_(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||VZ(e)?this[VC][t]=e:this[YI][t]=e},get(){if(this[YI]){if(t in this[YI])return this[YI][t]||this[UC][t];if(t in this[VC]){const e=this[j0]&&this[j0].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[UC][t]}}return this[UC][t]}}}function KZ(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function xC(t,e){return KZ(t,e)&&t[e]}function r_(t){const e=xC(t,"layerName")||xC(t,"componentName");return e||pe.once(0,"".concat(t.name,".componentName not specified"))(),e||t.name}const{ASYNC_ORIGINAL:I_,ASYNC_RESOLVED:a_,ASYNC_DEFAULTS:l_}=fC,C_=Object.freeze({});class LZ{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=C_,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}freezeAsyncOldProps(){if(!this.oldAsyncProps){this.oldProps=this.oldProps||this.component.props,this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){const n=e[a_]||{},i=e[I_]||e,g=e[l_]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,g[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in i){const o=i[s];this._createAsyncPropData(s,g[s]),this._updateAsyncProp(s,o)}}_updateAsyncProp(e,n){if(!!this._didAsyncInputValueChange(e,n)){if(typeof n=="string"){var i;const g=(i=this.layer)===null||i===void 0?void 0:i.props.fetch;g&&(n=g(n,{propName:e,layer:this.layer}))}if(n instanceof Promise){this._watchPromise(e,n);return}if(VZ(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this.freezeAsyncOldProps();const i=this.asyncProps[e];n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount}_setAsyncPropValue(e,n,i){const g=this.asyncProps[e];g&&i>=g.resolvedLoadCount&&n!==void 0&&(this.freezeAsyncOldProps(),g.resolvedValue=n,g.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];i.pendingLoadCount++;const g=i.pendingLoadCount;n.then(s=>{var o;s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,g);const r=(o=this.layer)===null||o===void 0?void 0:o.props.onDataLoad;e==="data"&&r&&r(s,{propName:e,layer:this.layer})}).catch(s=>{var o;(o=this.layer)===null||o===void 0||o.raiseError(s,"loading ".concat(e," of ").concat(this.layer))})}async _resolveAsyncIterable(e,n){var i;e!=="data"&&this._setPropValue(e,n);const g=this.asyncProps[e];g.pendingLoadCount++;const s=g.pendingLoadCount;let o=[],r=0;for await(const a of n){const{dataTransform:l}=this.component?this.component.props:{};l?o=l(a,o):o=o.concat(a),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:r,endRow:o.length}]}),r=o.length,this._setAsyncPropValue(e,o,s)}const I=(i=this.layer)===null||i===void 0?void 0:i.props.onDataLoad;I&&I(o,{propName:e,layer:this.layer})}_postProcessValue(e,n){const i=e.type;return i&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const g=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:g&&g[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}const{ASYNC_ORIGINAL:MZ,ASYNC_RESOLVED:PZ,ASYNC_DEFAULTS:c_}=fC,A_={};let d_=0;class q0{constructor(){this.props=t_.apply(this,arguments),this.id=this.props.id,this.count=d_++,this.lifecycle=Fo.NO_STATE,this.parent=null,this.context=null,this.state=null,this.internalState=null,Object.seal(this)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}clone(e){const{props:n}=this,i={};for(const g in n[c_])g in n[PZ]?i[g]=n[PZ][g]:g in n[MZ]&&(i[g]=n[MZ][g]);return new this.constructor(S(S(S({},n),i),e))}get stats(){return this.internalState.stats}_initState(){this.internalState=new LZ({})}}q0.componentName="Component";q0.defaultProps=A_;class u_ extends LZ{constructor(e){let{attributeManager:n,layer:i}=e;super(i);this.attributeManager=n,this.model=null,this.needsRedraw=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}}const h_="layer.changeFlag",m_="layer.initialize",f_="layer.update",p_="layer.finalize",B_="layer.matched",JZ=2**24-1,b_=Object.freeze([]),y_=dC(t=>{let{oldViewport:e,viewport:n}=t;return e.equals(n)});let gi=new Uint8ClampedArray(0);const v_={data:{type:"data",value:b_,async:!0},dataComparator:null,_dataDiff:{type:"function",value:t=>t&&t.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(t,e)=>{let{propName:n,layer:i,loaders:g,loadOptions:s,signal:o}=e;const{resourceManager:r}=i.context;if(s=s||i.getLoadOptions(),g=g||i.props.loaders,o){var I;s=J(S({},s),{fetch:J(S({},(I=s)===null||I===void 0?void 0:I.fetch),{signal:o})})}let a=r.contains(t);return!a&&!s&&(r.add({resourceId:t,data:Dl(t,g),persistent:!1}),a=!0),a?r.subscribe({resourceId:t,onChange:l=>i.internalState.reloadAsyncProp(n,l),consumerId:i.id,requestId:n}):Dl(t,g,s)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:ce.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:t=>{let{layerIndex:e}=t;return[0,-e*100]},compare:!1},highlightedObjectIndex:-1,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class An extends q0{toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}raiseError(e,n){var i,g;if(n&&(e.message="".concat(n,": ").concat(e.message)),!((i=(g=this.props).onError)!==null&&i!==void 0&&i.call(g,e))){var s,o;(s=this.context)===null||s===void 0||(o=s.onError)===null||o===void 0||o.call(s,e,this)}}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.internalState&&(this.internalState.needsRedraw=e)}setNeedsUpdate(){this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams())}hasUniformTransition(){return this.internalState.uniformTransitions.active}get isLoaded(){return this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||(this.state.model?[this.state.model]:[]))}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}project(e){const{viewport:n}=this.context,i=OG(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[g,s,o]=YG(i,n.pixelProjectionMatrix);return e.length===2?[g,s]:[g,s,o]}unproject(e){const{viewport:n}=this.context;return n.unproject(e)}projectPosition(e){return PX(e,{viewport:this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem})}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===ce.DEFAULT||e===ce.LNGLAT||e===ce.CARTESIAN}onHover(e,n){return this.props.onHover?this.props.onHover(e,n):!1}onClick(e,n){return this.props.onClick?this.props.onClick(e,n):!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Cn(e instanceof Uint8Array);const[n,i,g]=e;return n+i*256+g*65536-1}initializeState(){throw new Error("Layer ".concat(this," has not defined initializeState"))}getShaders(e){for(const n of this.props.extensions)e=D4(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){let{oldProps:n,props:i,context:g,changeFlags:s}=e;return s.propsOrDataChanged}updateState(e){let{oldProps:n,props:i,context:g,changeFlags:s}=e;const o=this.getAttributeManager();if(s.dataChanged&&o){const{dataChanged:a}=s;if(Array.isArray(a))for(const l of a)o.invalidateAll(l);else o.invalidateAll()}const r=n.highlightedObjectIndex>=0||n.pickable,I=i.highlightedObjectIndex>=0||i.pickable;if(r!==I&&o){const{pickingColors:a,instancePickingColors:l}=o.attributes,C=a||l;C&&(I&&C.constant&&(C.constant=!1,o.invalidate(C.id)),!C.value&&!I&&(C.constant=!0,C.value=[0,0,0]))}}finalizeState(){for(const n of this.getModels())n.delete();const e=this.getAttributeManager();e&&e.finalize(),this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState.uniformTransitions.clear(),this.internalState.finalize()}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo(e){let{info:n,mode:i}=e;const{index:g}=n;return g>=0&&Array.isArray(this.props.data)&&(n.object=this.props.data[g]),n}activateViewport(e){const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!y_({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const n=this.getAttributeManager();!n||(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(e){const n=this.getAttributeManager();if(!n)return;const i=this.getNumInstances(e),g=this.getStartIndices(e);n.update({data:e.data,numInstances:i,startIndices:g,props:e,transitions:e.transitions,buffers:e.data.attributes,context:this,ignoreUnknownAttributes:!0});const s=n.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const g in n)Object.defineProperty(i,g,{value:n[g]});return i}return this.props}calculateInstancePickingColors(e,n){let{numInstances:i}=n;if(e.constant)return;const g=Math.floor(gi.length/3);if(this.internalState.usesPickingColorCache=!0,g<i){i>JZ&&pe.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),gi=Go.allocate(gi,i,{size:3,copy:!0,maxCount:Math.max(i,JZ)});const s=Math.floor(gi.length/3),o=[];for(let r=g;r<s;r++)this.encodePickingColor(r,o),gi[r*3+0]=o[0],gi[r*3+1]=o[1],gi[r*3+2]=o[2]}e.value=gi.subarray(0,i*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),g=e.userData.excludeAttributes||{},s=i.getShaderAttributes(n,g);e.setAttributes(s)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,g=n||i,s=g.getVertexOffset(e),o=g.getVertexOffset(e+1);g.buffer.subData({data:new Uint8Array(o-s),offset:s})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;this.internalState.usesPickingColorCache&&i.value.buffer!==gi.buffer&&(i.value=gi.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0})}getNumInstances(e){return e=e||this.props,e.numInstances!==void 0?e.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:M4(e.data)}getStartIndices(e){return e=e||this.props,e.startIndices!==void 0?e.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}_initialize(){Tt(m_,this),this._initState(),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:!0,propsChanged:!0,viewportChanged:!0,extensionsChanged:!0}),this._updateState()}_update(){const e=this.needsUpdate();Tt(f_,this,e),e&&this._updateState()}_updateState(){const e=this.props,n=this.context.viewport,i=this._updateUniformTransition();this.internalState.propsInTransition=i,this.context.viewport=this.internalState.viewport||n,this.props=i;try{const g=this._getUpdateParams(),s=this.getModels();if(this.context.gl)this.updateState(g);else try{this.updateState(g)}catch{}for(const r of this.props.extensions)r.updateState.call(this,g,r);const o=this.getModels()[0]!==s[0];this._updateModules(g,o),this.isComposite?this._renderLayers(g):(this.setNeedsRedraw(),this._updateAttributes(this.props),this.state.model&&this.state.model.setInstanceCount(this.getNumInstances()))}finally{this.context.viewport=n,this.props=e,this.clearChangeFlags(),this.internalState.needsUpdate=!1,this.internalState.resetOldProps()}}_finalize(){Tt(p_,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}drawLayer(e){let{moduleParameters:n=null,uniforms:i={},parameters:g={}}=e;this._updateAttributeTransition();const s=this.props;this.props=this.internalState.propsInTransition||s;const{opacity:o}=this.props;i.opacity=Math.pow(o,1/2.2);try{n&&this.setModuleParameters(n);const{getPolygonOffset:r}=this.props,I=r&&r(i)||[0,0];Zi(this.context.gl,{polygonOffset:I}),Xn(this.context.gl,g,()=>{const a={moduleParameters:n,uniforms:i,parameters:g,context:this.context};for(const l of this.props.extensions)l.draw.call(this,a,l);this.draw(a)})}finally{this.props=s}}getChangeFlags(){return this.internalState.changeFlags}setChangeFlags(e){const{changeFlags:n}=this.internalState;for(const g in e)if(e[g]){let s=!1;switch(g){case"dataChanged":Array.isArray(n[g])&&(n[g]=Array.isArray(e[g])?n[g].concat(e[g]):e[g],s=!0);default:n[g]||(n[g]=e[g],s=!0)}s&&Tt(h_,this,g,e)}const i=n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged;n.propsOrDataChanged=i,n.somethingChanged=i||e.viewportChanged||e.stateChanged}clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}diffProps(e,n){const i=X4(e,n);if(i.updateTriggersChanged)for(const g in i.updateTriggersChanged)i.updateTriggersChanged[g]&&this.invalidateAttribute(g);if(i.transitionsChanged)for(const g in i.transitionsChanged)this.internalState.uniformTransitions.add(g,n[g],e[g],e.transitions[g]);return this.setChangeFlags(i)}validateProps(){Q4(this.props)}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}updateAutoHighlight(e){this.props.autoHighlight&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_updateModules(e,n){let{props:i,oldProps:g}=e;const{autoHighlight:s,highlightedObjectIndex:o,highlightColor:r}=i;if(n||g.autoHighlight!==s||g.highlightedObjectIndex!==o||g.highlightColor!==r){const I={};s||(I.pickingSelectedColor=null),Array.isArray(r)&&(I.pickingHighlightColor=r),Number.isInteger(o)&&(I.pickingSelectedColor=o>=0?this.encodePickingColor(o):null),this.setModuleParameters(I)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const i=this.getAttributeManager(),g=i&&i.getNeedsRedraw(e);return n=n||g,n}_getAttributeManager(){return new U4(this.context.gl,{id:this.props.id,stats:this.context.stats,timeline:this.context.timeline})}_initState(){Cn(!this.internalState&&!this.state),Cn(isFinite(this.props.coordinateSystem));const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new u_({attributeManager:e,layer:this}),this.clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(pe.deprecated("layer.state.attributeManager","layer.getAttributeManager()"),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new T4(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props)}_transferState(e){Tt(B_,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.internalState.layer=this,this.state=n,this.internalState.setAsyncProps(this.props),this.diffProps(this.props,this.internalState.getOldProps()))}_onAsyncPropUpdated(){this.diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}An.layerName="Layer";An.defaultProps=v_;const G_="compositeLayer.renderLayers";class kn extends An{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo(e){let{info:n}=e;const{object:i}=n;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(n.object=i.__source.object,n.index=i.__source.index),n}renderLayers(){return null}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={data:this.props.data,target:[]};return(i,g)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,g)}return e}getSubLayerProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{opacity:n,pickable:i,visible:g,parameters:s,getPolygonOffset:o,highlightedObjectIndex:r,autoHighlight:I,highlightColor:a,coordinateSystem:l,coordinateOrigin:C,wrapLongitude:c,positionFormat:A,modelMatrix:d,extensions:m,fetch:u,_subLayerProps:h}=this.props,f={opacity:n,pickable:i,visible:g,parameters:s,getPolygonOffset:o,highlightedObjectIndex:r,autoHighlight:I,highlightColor:a,coordinateSystem:l,coordinateOrigin:C,wrapLongitude:c,positionFormat:A,modelMatrix:d,extensions:m,fetch:u},p=h&&h[e.id],b=p&&p.updateTriggers,Z=e.id||"sublayer";if(p){const v=this.constructor._propTypes,N=e.type?e.type._propTypes:{};for(const x in p){const V=N[x]||v[x];V&&V.type==="accessor"&&(p[x]=this.getSubLayerAccessor(p[x]))}}Object.assign(f,e,p),f.id="".concat(this.props.id,"-").concat(Z),f.updateTriggers=S(S({all:this.props.updateTriggers.all},e.updateTriggers),b);for(const v of m){const N=v.getSubLayerProps.call(this,v);N&&Object.assign(f,N,{updateTriggers:Object.assign(f.updateTriggers,N.updateTriggers)})}return f}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_renderLayers(){let{subLayers:e}=this.internalState;const n=!e||this.needsUpdate();n&&(e=this.renderLayers(),e=pC(e,Boolean),this.internalState.subLayers=e),Tt(G_,this,n,e);for(const i of e)i.parent=this}}kn.layerName="CompositeLayer";class $0{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.opts=e}equals(e){return this===e?!0:this.constructor===e.constructor&&So(this.opts,e.opts)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:n={}}=e.constructor,i={updateTriggers:{}};for(const g in n)if(g in this.props){const s=n[g],o=this.props[g];i[g]=o,s&&s.type==="accessor"&&(i.updateTriggers[g]=this.props.updateTriggers[g],typeof o=="function"&&(i[g]=this.getSubLayerAccessor(o,!0)))}return i}initializeState(e,n){}updateState(e,n){}draw(e,n){}finalizeState(e){}}const Zg={rotationX:0,rotationOrbit:0,zoom:0,target:[0,0,0],minRotationX:-90,maxRotationX:90,minZoom:-1/0,maxZoom:1/0};class Z_ extends nZ{constructor(e){let{makeViewport:n,width:i,height:g,rotationX:s=Zg.rotationX,rotationOrbit:o=Zg.rotationOrbit,target:r=Zg.target,zoom:I=Zg.zoom,minRotationX:a=Zg.minRotationX,maxRotationX:l=Zg.maxRotationX,minZoom:C=Zg.minZoom,maxZoom:c=Zg.maxZoom,startPanPosition:A,startRotatePos:d,startRotationX:m,startRotationOrbit:u,startZoomPosition:h,startZoom:f}=e;super({width:i,height:g,rotationX:s,rotationOrbit:o,target:r,zoom:I,minRotationX:a,maxRotationX:l,minZoom:C,maxZoom:c});this._state={startPanPosition:A,startRotatePos:d,startRotationX:m,startRotationOrbit:u,startZoomPosition:h,startZoom:f},this.makeViewport=n}panStart(e){let{pos:n}=e;return this._getUpdatedState({startPanPosition:this._unproject(n)})}pan(e){let{pos:n,startPosition:i}=e;const g=this._state.startPanPosition||i;if(!g)return this;const o=this.makeViewport(this._viewportProps).panByPosition(g,n);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart(e){let{pos:n}=e;return this._getUpdatedState({startRotatePos:n,startRotationX:this._viewportProps.rotationX,startRotationOrbit:this._viewportProps.rotationOrbit})}rotate(e){let{pos:n,deltaAngleX:i=0,deltaAngleY:g=0}=e;const{startRotatePos:s,startRotationX:o,startRotationOrbit:r}=this._state,{width:I,height:a}=this._viewportProps;if(!s||!Number.isFinite(o)||!Number.isFinite(r))return this;let l;if(n){let C=(n[0]-s[0])/I;const c=(n[1]-s[1])/a;(o<-90||o>90)&&(C*=-1),l={rotationX:o+c*180,rotationOrbit:r+C*180}}else l={rotationX:o+g,rotationOrbit:r+i};return this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),i=S({},this._viewportProps),{rotationOrbit:g}=i;return Math.abs(g-n.rotationOrbit)>180&&(i.rotationOrbit=g<0?g+360:g-360),i}zoomStart(e){let{pos:n}=e;return this._getUpdatedState({startZoomPosition:this._unproject(n),startZoom:this._viewportProps.zoom})}zoom(e){let{pos:n,startPos:i,scale:g}=e;const{zoom:s}=this._viewportProps;let{startZoom:o,startZoomPosition:r}=this._state;Number.isFinite(o)||(o=s,r=this._unproject(i)||this._unproject(n));const I=this._calculateNewZoom({scale:g,startZoom:o}),a=this.makeViewport(J(S({},this._viewportProps),{zoom:I}));return this._getUpdatedState(S({zoom:I},a.panByPosition(r,n)))}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([-e,0])}moveRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([e,0])}moveUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([0,-e])}moveDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50;return this._panFromCenter([0,e])}rotateLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit-e})}rotateRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({rotationOrbit:this._viewportProps.rotationOrbit+e})}rotateUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({rotationX:this._viewportProps.rotationX-e})}rotateDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({rotationX:this._viewportProps.rotationX+e})}_unproject(e){const n=this.makeViewport(this._viewportProps);return e&&n.unproject(e)}_calculateNewZoom(e){let{scale:n,startZoom:i}=e;const{maxZoom:g,minZoom:s}=this._viewportProps;Number.isFinite(i)||(i=this._viewportProps.zoom);const o=i+Math.log2(n);return ln(o,s,g)}_panFromCenter(e){const{width:n,height:i,target:g}=this._viewportProps;return this.pan({startPosition:g,pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor(S(S(S({},this._viewportProps),this._state),e))}_applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:g,maxRotationX:s,minRotationX:o,rotationOrbit:r}=e;return e.zoom=ln(g,i,n),e.rotationX=ln(e.rotationX,o,s),(r<-180||r>180)&&(e.rotationOrbit=wX(r+180,360)-180),e}}class R_ extends Z_{constructor(e){super(e);this.zoomAxis=e.zoomAxis||"all"}_applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:g}=e;return e.zoom=Array.isArray(g)?[ln(g[0],i,n),ln(g[1],i,n)]:ln(g,i,n),e}_calculateNewZoom(e){let{scale:n,startZoom:i}=e;const{maxZoom:g,minZoom:s}=this._viewportProps;!i&&i!==0&&(i=this._viewportProps.zoom);let o=Math.log2(n);if(Array.isArray(i)){let[r,I]=i;switch(this.zoomAxis){case"X":r=ln(r+o,s,g);break;case"Y":I=ln(I+o,s,g);break;default:let a=Math.min(r+o,I+o);a<s&&(o+=s-a),a=Math.max(r+o,I+o),a>g&&(o+=g-a),r+=o,I+=o}return[r,I]}return ln(i+o,s,g)}}class F_ extends tZ{constructor(e){e.dragMode=e.dragMode||"pan";super(R_,e)}_onPanRotate(e){return!1}get linearTransitionProps(){return["target","zoom"]}}const S_=new Pe().lookAt({eye:[0,0,1]});function V_(t){let{width:e,height:n,near:i,far:g}=t;return e=e||1,n=n||1,new Pe().ortho({left:-e/2,right:e/2,bottom:-n/2,top:n/2,near:i,far:g})}class U_ extends vg{constructor(e){const{width:n,height:i,near:g=.1,far:s=1e3,zoom:o=0,target:r=[0,0,0],flipY:I=!0}=e,a=Array.isArray(o)?o[0]:o,l=Array.isArray(o)?o[1]:o,C=Math.min(a,l),c=Math.pow(2,C);super(J(S({},e),{longitude:null,position:r,viewMatrix:S_.clone().scale([c,c*(I?-1:1),c]),projectionMatrix:V_({width:n,height:i,near:g,far:s}),zoom:C}));if(a!==l){const A=Math.pow(2,a),d=Math.pow(2,l);this.distanceScales={unitsPerMeter:[A/c,d/c,1],metersPerUnit:[c/A,c/d,1]}}}projectFlat(e){let[n,i]=e;const{unitsPerMeter:g}=this.distanceScales;return[n*g[0],i*g[1]]}unprojectFlat(e){let[n,i]=e;const{metersPerUnit:g}=this.distanceScales;return[n*g[0],i*g[1]]}panByPosition(e,n){const i=mC(n,this.pixelUnprojectionMatrix),g=this.projectFlat(e),s=IC([],g,tG([],i));return{target:IC([],this.center,s)}}}class DZ extends Is{constructor(e){super(J(S({},e),{type:U_}))}get controller(){return this._getControllerProps({type:F_})}}DZ.displayName="OrthographicView";class zZ{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{attributes:n={}}=e;this.typedArrayManager=Go,this.indexStarts=null,this.vertexStarts=null,this.vertexCount=0,this.instanceCount=0,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e),Object.seal(this)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:g,geometryBuffer:s,positionFormat:o,dataChanged:r,normalize:I=!0}=this.opts;if(this.data=n,this.getGeometry=g,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=i,this.normalize=I,s&&(Cn(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),I||(i.positions=s)),this.geometryBuffer=i.positions,Array.isArray(r))for(const a of r)this._rebuildGeometry(a);else this._rebuildGeometry()}updatePartialGeometry(e){let{startRow:n,endRow:i}=e;this._rebuildGeometry({startRow:n,endRow:i})}normalizeGeometry(e){return e}updateGeometryAttributes(e,n,i){throw new Error("Not implemented")}getGeometrySize(e){throw new Error("Not implemented")}getGeometryFromBuffer(e){const n=e.value||e;return Cn(ArrayBuffer.isView(n)),UZ(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices})}_allocate(e,n){const{attributes:i,buffers:g,_attributeDefs:s,typedArrayManager:o}=this;for(const r in s)if(r in g)o.release(i[r]),i[r]=null;else{const I=s[r];I.copy=n,i[r]=o.allocate(i[r],e,I)}}_forEachGeometry(e,n,i){const{data:g,getGeometry:s}=this,{iterable:o,objectInfo:r}=EI(g,n,i);for(const I of o){r.index++;const a=s(I,r);e(a,r.index)}}_rebuildGeometry(e){if(!this.data||!this.getGeometry)return;let{indexStarts:n,vertexStarts:i,instanceCount:g}=this;const{data:s,geometryBuffer:o}=this,{startRow:r=0,endRow:I=1/0}=e||{},a={};if(e||(n=[0],i=[0]),this.normalize||!o)this._forEachGeometry((C,c)=>{C=this.normalizeGeometry(C),a[c]=C,i[c+1]=i[c]+this.getGeometrySize(C)},r,I),g=i[i.length-1];else if(o.buffer instanceof Te){const C=o.stride||this.positionSize*4;i=s.startIndices,g=i[s.length]||o.buffer.byteLength/C}else{const C=o.value||o,c=o.stride/C.BYTES_PER_ELEMENT||this.positionSize;i=s.startIndices,g=i[s.length]||C.length/c}this._allocate(g,Boolean(e)),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=g;const l={};this._forEachGeometry((C,c)=>{C=a[c]||C,l.vertexStart=i[c],l.indexStart=n[c];const A=c<i.length-1?i[c+1]:g;l.geometrySize=A-i[c],l.geometryIndex=c,this.updateGeometryAttributes(C,l)},r,I),this.vertexCount=n[n.length-1]}}var q={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795};const x_=new Uint16Array([0,2,1,0,3,2]),W_=new Float32Array([0,1,0,0,1,0,1,1]);function N_(t,e){if(!e)return w_(t);const n=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),i=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),g=Math.ceil(n/e)+1,s=Math.ceil(i/e)+1,o=(g-1)*(s-1)*6,r=new Uint32Array(o),I=new Float32Array(g*s*2),a=new Float64Array(g*s*3);let l=0,C=0;for(let c=0;c<g;c++){const A=c/(g-1);for(let d=0;d<s;d++){const m=d/(s-1),u=T_(t,A,m);a[l*3+0]=u[0],a[l*3+1]=u[1],a[l*3+2]=u[2]||0,I[l*2+0]=A,I[l*2+1]=1-m,c>0&&d>0&&(r[C++]=l-s,r[C++]=l-s-1,r[C++]=l-1,r[C++]=l-s,r[C++]=l-1,r[C++]=l),l++}}return{vertexCount:o,positions:a,indices:r,texCoords:I}}function w_(t){const e=new Float64Array(12);for(let n=0;n<t.length;n++)e[n*3+0]=t[n][0],e[n*3+1]=t[n][1],e[n*3+2]=t[n][2]||0;return{vertexCount:6,positions:e,indices:x_,texCoords:W_}}function T_(t,e,n){return ss(ss(t[0],t[1],n),ss(t[3],t[2],n),e)}var E_=`
#define SHADER_NAME bitmap-layer-vertex-shader

attribute vec2 texCoords;
attribute vec3 positions;
attribute vec3 positions64Low;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`;const Q_=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`;var X_=`
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  return mix(transparentColor, vec4(color, 1.0), alpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

`.concat(Q_,`

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture2D(bitmapTexture, uv);

  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);

  if (picking_uActive) {
    // Since instance information is not used, we can use picking color for pixel index
    gl_FragColor.rgb = packUVsIntoRGB(uv);
  }
}
`);const Y_={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:ce.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};class WC extends An{getShaders(){return super.getShaders({vs:E_,fs:X_,modules:[Bg,yg]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const n=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:n},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:n},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:n}})}updateState(e){let{props:n,oldProps:i,changeFlags:g}=e;if(g.extensionsChanged){var s;const{gl:r}=this.context;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}const o=this.getAttributeManager();if(n.bounds!==i.bounds){const r=this.state.mesh,I=this._createMesh();this.state.model.setVertexCount(I.vertexCount);for(const a in I)r&&r[a]!==I[a]&&o.invalidate(a);this.setState(S({mesh:I},this._getCoordinateUniforms()))}else n._imageCoordinateSystem!==i._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){let{info:n}=e;const{image:i}=this.props;if(!n.color||!i)return n.bitmap=null,n;const{width:g,height:s}=i;n.index=0;const o=__(n.color),r=[Math.floor(o[0]*g),Math.floor(o[1]*s)];return n.bitmap={size:{width:g,height:s},uv:o,pixel:r},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight(J(S({},e),{color:this.encodePickingColor(0)}))}_createMesh(){const{bounds:e}=this.props;let n=e;return Number.isFinite(e[0])&&(n=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),N_(n,this.context.viewport.resolution)}_getModel(e){return e?new Zn(e,J(S({},this.getShaders()),{id:this.props.id,geometry:new ni({drawMode:4,vertexCount:6}),isInstanced:!1})):null}draw(e){const{uniforms:n,moduleParameters:i}=e,{model:g,coordinateConversion:s,bounds:o,disablePicking:r}=this.state,{image:I,desaturate:a,transparentColor:l,tintColor:C}=this.props;i.pickingActive&&r||I&&g&&g.setUniforms(n).setUniforms({bitmapTexture:I,desaturate:a,transparentColor:l.map(c=>c/255),tintColor:C.slice(0,3).map(c=>c/255),coordinateConversion:s,bounds:o}).draw()}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:n,DEFAULT:i}=ce;let{_imageCoordinateSystem:g}=this.props;if(g!==i){const{bounds:s}=this.props;if(!Number.isFinite(s[0]))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?e:n;if(g=g===e?e:n,g===e&&o===n)return{coordinateConversion:-1,bounds:s};if(g===n&&o===e){const r=bg([s[0],s[1]]),I=bg([s[2],s[3]]);return{coordinateConversion:1,bounds:[r[0],r[1],I[0],I[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}WC.layerName="BitmapLayer";WC.defaultProps=Y_;function __(t){const[e,n,i]=t,g=(i&240)/256,s=(i&15)/16;return[(e+s)/256,(n+g)/256]}var H_=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,k_=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const K_=1024,L_=4,OZ=()=>{},M_={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071};function P_(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function J_(t,e,n,i){return n===e.width&&i===e.height?e:(t.canvas.height=i,t.canvas.width=n,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(e,0,0,e.width,e.height,0,0,n,i),t.canvas)}function _I(t){return t&&(t.id||t.url)}function D_(t,e,n,i){const g=e.width,s=e.height,o=vv(e,{width:n,height:i});return dw(e,o,{targetY:0,width:g,height:s}),e.delete(),o}function jZ(t,e,n){for(let i=0;i<e.length;i++){const{icon:g,xOffset:s}=e[i],o=_I(g);t[o]=J(S({},g),{x:s,y:n})}}function z_(t){let{icons:e,buffer:n,mapping:i={},xOffset:g=0,yOffset:s=0,rowHeight:o=0,canvasWidth:r}=t,I=[];for(let a=0;a<e.length;a++){const l=e[a],C=_I(l);if(!i[C]){const{height:c,width:A}=l;g+A+n>r&&(jZ(i,I,s),g=0,s=o+s+n,o=0,I=[]),I.push({icon:l,xOffset:g}),g=g+A+n,o=Math.max(o,c)}}return I.length>0&&jZ(i,I,s),{mapping:i,rowHeight:o,xOffset:g,yOffset:s,canvasWidth:r,canvasHeight:P_(o+s+n)}}function O_(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:g,objectInfo:s}=EI(t);for(const o of g){s.index++;const r=e(o,s),I=_I(r);if(!r)throw new Error("Icon is missing.");if(!r.url)throw new Error("Icon url is missing.");!i[I]&&(!n[I]||r.url!==n[I].url)&&(i[I]=J(S({},r),{source:o,sourceIndex:s.index}))}return i}class j_{constructor(e,n){let{onUpdate:i=OZ,onError:g=OZ}=n;this.gl=e,this.onUpdate=i,this.onError=g,this._loadOptions=null,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=L_,this._canvasWidth=K_,this._canvasHeight=0,this._canvas=null}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?_I(e):e;return this._mapping[n]||{}}setProps(e){let{loadOptions:n,autoPacking:i,iconAtlas:g,iconMapping:s,data:o,getIcon:r}=e;n&&(this._loadOptions=n),i!==void 0&&(this._autoPacking=i),r&&(this._getIcon=r),s&&(this._mapping=s),g&&this._updateIconAtlas(g),this._autoPacking&&(o||r)&&typeof document!="undefined"&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(o))}get isLoaded(){return this._pendingCount===0}_updateIconAtlas(e){var n;(n=this._texture)===null||n===void 0||n.delete(),this._texture=null,this._externalTexture=e,this.onUpdate()}_updateAutoPacking(e){const n=Object.values(O_(e,this._getIcon,this._mapping)||{});if(n.length>0){const{mapping:i,xOffset:g,yOffset:s,rowHeight:o,canvasHeight:r}=z_({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=o,this._mapping=i,this._xOffset=g,this._yOffset=s,this._canvasHeight=r,this._texture||(this._texture=new on(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:M_})),this._texture.height!==this._canvasHeight&&(this._texture=D_(this.gl,this._texture,this._canvasWidth,this._canvasHeight)),this.onUpdate(),this._loadIcons(n)}}_loadIcons(e){const n=this._canvas.getContext("2d");for(const i of e)this._pendingCount++,Dl(i.url,_y,this._loadOptions).then(g=>{const s=_I(i),{x:o,y:r,width:I,height:a}=this._mapping[s],l=J_(n,g,I,a);this._texture.setSubImageData({data:l,x:o,y:r,width:I,height:a}),this._texture.generateMipmap(),this.onUpdate()}).catch(g=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:g})}).finally(()=>{this._pendingCount--})}}const qZ=[0,0,0,255],q_={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:qZ},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class NC extends An{getShaders(){return super.getShaders({vs:H_,fs:k_,modules:[Bg,yg]})}initializeState(){this.state={iconManager:new j_(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:qZ},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){let{oldProps:n,props:i,changeFlags:g}=e;super.updateState({props:i,oldProps:n,changeFlags:g});const s=this.getAttributeManager(),{iconAtlas:o,iconMapping:r,data:I,getIcon:a}=i,{iconManager:l}=this.state;l.setProps({loadOptions:i.loadOptions});let C=!1;if(o||this.internalState.isAsyncPropLoading("iconAtlas")?(n.iconAtlas!==i.iconAtlas&&l.setProps({iconAtlas:o,autoPacking:!1}),n.iconMapping!==i.iconMapping&&(l.setProps({iconMapping:r}),C=!0)):l.setProps({autoPacking:!0}),(g.dataChanged||g.updateTriggersChanged&&(g.updateTriggersChanged.all||g.updateTriggersChanged.getIcon))&&l.setProps({data:I,getIcon:a}),C&&(s.invalidate("instanceOffsets"),s.invalidate("instanceIconFrames"),s.invalidate("instanceColorModes")),g.extensionsChanged){var A;const{gl:d}=this.context;(A=this.state.model)===null||A===void 0||A.delete(),this.state.model=this._getModel(d),s.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(){super.finalizeState(),this.state.iconManager.finalize()}draw(e){let{uniforms:n}=e;const{sizeScale:i,sizeMinPixels:g,sizeMaxPixels:s,sizeUnits:o,billboard:r,alphaCutoff:I}=this.props,{iconManager:a}=this.state,l=a.getTexture();l&&this.state.model.setUniforms(n).setUniforms({iconsTexture:l,iconsTextureDim:[l.width,l.height],sizeUnits:pg[o],sizeScale:i,sizeMinPixels:g,sizeMaxPixels:s,billboard:r,alphaCutoff:I}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new Zn(e,J(S({},this.getShaders()),{id:this.props.id,geometry:new ni({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0}))}_onUpdate(){this.setNeedsRedraw()}_onError(e){const{onIconError:n}=this.getCurrentLayer().props;n?n(e):pe.error(e.error)()}getInstanceOffset(e){const n=this.state.iconManager.getIconMapping(e);return[n.width/2-n.anchorX||0,n.height/2-n.anchorY||0]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const n=this.state.iconManager.getIconMapping(e);return[n.x||0,n.y||0,n.width||0,n.height||0]}}NC.layerName="IconLayer";NC.defaultProps=q_;var $_=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      gl_Position = vec4(0.);
      return;
    }
  }
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,eH=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const tH=[0,0,0,255],nH={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:tH},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class HI extends An{getShaders(){return super.getShaders({vs:$_,fs:eH,modules:[Bg,yg]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){let{props:n,oldProps:i,changeFlags:g}=e;if(super.updateState({props:n,oldProps:i,changeFlags:g}),g.extensionsChanged){var s;const{gl:o}=this.context;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}draw(e){let{uniforms:n}=e;const{widthUnits:i,widthScale:g,widthMinPixels:s,widthMaxPixels:o,wrapLongitude:r}=this.props;this.state.model.setUniforms(n).setUniforms({widthUnits:pg[i],widthScale:g,widthMinPixels:s,widthMaxPixels:o,useShortestPath:r?1:0}).draw(),r&&this.state.model.setUniforms({useShortestPath:-1}).draw()}_getModel(e){const n=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Zn(e,J(S({},this.getShaders()),{id:this.props.id,geometry:new ni({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0}))}}HI.layerName="LineLayer";HI.defaultProps=nH;var iH=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
  }

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,gH=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const $Z=[0,0,0,255],sH={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:$Z},getLineColor:{type:"accessor",value:$Z},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class eh extends An{getShaders(){return super.getShaders({vs:iH,fs:gH,modules:[Bg,yg]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){let{props:n,oldProps:i,changeFlags:g}=e;if(super.updateState({props:n,oldProps:i,changeFlags:g}),g.extensionsChanged){var s;const{gl:o}=this.context;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}draw(e){let{uniforms:n}=e;const{radiusUnits:i,radiusScale:g,radiusMinPixels:s,radiusMaxPixels:o,stroked:r,filled:I,billboard:a,antialiasing:l,lineWidthUnits:C,lineWidthScale:c,lineWidthMinPixels:A,lineWidthMaxPixels:d}=this.props;this.state.model.setUniforms(n).setUniforms({stroked:r?1:0,filled:I,billboard:a,antialiasing:l,radiusUnits:pg[i],radiusScale:g,radiusMinPixels:s,radiusMaxPixels:o,lineWidthUnits:pg[C],lineWidthScale:c,lineWidthMinPixels:A,lineWidthMaxPixels:d}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Zn(e,J(S({},this.getShaders()),{id:this.props.id,geometry:new ni({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0}))}}eh.layerName="ScatterplotLayer";eh.defaultProps=sH;const e1={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function t1(t,e,n={}){return oH(t,n)!==e?(IH(t,n),!0):!1}function oH(t,e={}){return Math.sign(rH(t,e))}function rH(t,e={}){const{start:n=0,end:i=t.length}=e,g=e.size||2;let s=0;for(let o=n,r=i-g;o<i;o+=g)s+=(t[o]-t[r])*(t[o+1]+t[r+1]),r=o;return s/2}function IH(t,e){const{start:n=0,end:i=t.length,size:g=2}=e,s=(i-n)/g,o=Math.floor(s/2);for(let r=0;r<o;++r){const I=n+r*g,a=n+(s-1-r)*g;for(let l=0;l<g;++l){const C=t[I+l];t[I+l]=t[a+l],t[a+l]=C}}}function Kn(t,e){const n=e.length,i=t.length;if(i>0){let g=!0;for(let s=0;s<n;s++)if(t[i-n+s]!==e[s]){g=!1;break}if(g)return!1}for(let g=0;g<n;g++)t[i+g]=e[g];return!0}function th(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function kI(t,e,n,i,g=[]){const s=i+e*n;for(let o=0;o<n;o++)g[o]=t[s+o];return g}function nh(t,e,n,i,g=[]){let s,o;if(n&8)s=(i[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(i[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(i[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(i[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let r=0;r<t.length;r++)g[r]=(o&1)===r?i[o]:s*(e[r]-t[r])+t[r];return g}function wC(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function n1(t,e={}){const{size:n=2,broken:i=!1,gridResolution:g=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:r=t.length}=e,I=(r-o)/n;let a=[];const l=[a],C=kI(t,0,n,o);let c,A;const d=o1(C,g,s,[]),m=[];Kn(a,C);for(let u=1;u<I;u++){for(c=kI(t,u,n,o,c),A=wC(c,d);A;){nh(C,c,A,d,m);const h=wC(m,d);h&&(nh(C,m,h,d,m),A=h),Kn(a,m),th(C,m),lH(d,g,A),i&&a.length>n&&(a=[],l.push(a),Kn(a,C)),A=wC(c,d)}Kn(a,c),th(C,c)}return i?l:l[0]}const i1=0,aH=1;function TC(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function g1(t,e,n={}){if(!t.length)return[];const{size:i=2,gridResolution:g=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n,r=[],I=[{pos:t,types:o&&new Array(t.length/i).fill(aH),holes:e||[]}],a=[[],[]];let l=[];for(;I.length;){const{pos:C,types:c,holes:A}=I.shift();CH(C,i,A[0]||C.length,a),l=o1(a[0],g,s,l);const d=wC(a[1],l);if(d){let m=s1(C,c,i,0,A[0]||C.length,l,d);const u={pos:m[0].pos,types:m[0].types,holes:[]},h={pos:m[1].pos,types:m[1].types,holes:[]};I.push(u,h);for(let f=0;f<A.length;f++)m=s1(C,c,i,A[f],A[f+1]||C.length,l,d),m[0]&&(u.holes.push(u.pos.length),u.pos=TC(u.pos,m[0].pos),o&&(u.types=TC(u.types,m[0].types))),m[1]&&(h.holes.push(h.pos.length),h.pos=TC(h.pos,m[1].pos),o&&(h.types=TC(h.types,m[1].types)))}else{const m={positions:C};o&&(m.edgeTypes=c),A.length&&(m.holeIndices=A),r.push(m)}}return r}function s1(t,e,n,i,g,s,o){const r=(g-i)/n,I=[],a=[],l=[],C=[],c=[];let A,d,m;const u=kI(t,r-1,n,i);let h=Math.sign(o&8?u[1]-s[3]:u[0]-s[2]),f=e&&e[r-1],p=0,b=0;for(let Z=0;Z<r;Z++)A=kI(t,Z,n,i,A),d=Math.sign(o&8?A[1]-s[3]:A[0]-s[2]),m=e&&e[i/n+Z],d&&h&&h!==d&&(nh(u,A,o,s,c),Kn(I,c)&&l.push(f),Kn(a,c)&&C.push(f)),d<=0?(Kn(I,A)&&l.push(m),p-=d):l.length&&(l[l.length-1]=i1),d>=0?(Kn(a,A)&&C.push(m),b+=d):C.length&&(C[C.length-1]=i1),th(u,A),h=d,f=m;return[p?{pos:I,types:e&&l}:null,b?{pos:a,types:e&&C}:null]}function o1(t,e,n,i){const g=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=g,i[1]=s,i[2]=g+e,i[3]=s+e,i}function lH(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function CH(t,e,n,i){let g=1/0,s=-1/0,o=1/0,r=-1/0;for(let I=0;I<n;I+=e){const a=t[I],l=t[I+1];g=a<g?a:g,s=a>s?a:s,o=l<o?l:o,r=l>r?l:r}return i[0][0]=g,i[0][1]=o,i[1][0]=s,i[1][1]=r,i}const cH=85.051129;function AH(t,e={}){const{size:n=2,startIndex:i=0,endIndex:g=t.length,normalize:s=!0}=e,o=t.slice(i,g);r1(o,n,0,g-i);const r=n1(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const I of r)I1(I,n);return r}function dH(t,e,n={}){const{size:i=2,normalize:g=!0,edgeTypes:s=!1}=n;e=e||[];const o=[],r=[];let I=0,a=0;for(let C=0;C<=e.length;C++){const c=e[C]||t.length,A=a,d=uH(t,i,I,c);for(let m=d;m<c;m++)o[a++]=t[m];for(let m=I;m<d;m++)o[a++]=t[m];r1(o,i,A,a),hH(o,i,A,a,n.maxLatitude),I=c,r[C]=a}r.pop();const l=g1(o,r,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(g)for(const C of l)I1(C.positions,i);return l}function uH(t,e,n,i){let g=-1,s=-1;for(let o=n+1;o<i;o+=e){const r=Math.abs(t[o]);r>g&&(g=r,s=o-1)}return s}function hH(t,e,n,i,g=cH){const s=t[n],o=t[i-e];if(Math.abs(s-o)>180){const r=kI(t,0,e,n);r[0]+=Math.round((o-s)/360)*360,Kn(t,r),r[1]=Math.sign(r[1])*g,Kn(t,r),r[0]=s,Kn(t,r)}}function r1(t,e,n,i){let g=t[0],s;for(let o=n;o<i;o+=e){s=t[o];const r=s-g;(r>180||r<-180)&&(s-=Math.round(r/360)*360),t[o]=g=s}}function I1(t,e){let n;const i=t.length/e;for(let s=0;s<i&&(n=t[s*e],(n+180)%360==0);s++);const g=-Math.round(n/360)*360;if(g!==0)for(let s=0;s<i;s++)t[s*e]+=g}function mH(t,e,n,i){let g=t;if(Array.isArray(t[0])){const s=t.length*e;g=new Array(s);for(let o=0;o<t.length;o++)for(let r=0;r<e;r++)g[o*e+r]=t[o][r]||0}return n?n1(g,{size:e,gridResolution:n}):i?AH(g,{size:e}):g}const fH=1,pH=2,ih=4;class BH extends zZ{constructor(e){super(J(S({},e),{attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}}))}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):()=>null}normalizeGeometry(e){return this.normalize?mH(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}get(e){return this.attributes[e]}getGeometrySize(e){if(Array.isArray(e[0])){let i=0;for(const g of e)i+=this.getGeometrySize(g);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&Array.isArray(e[0]))for(const i of e){const g=this.getGeometrySize(i);n.geometrySize=g,this.updateGeometryAttributes(i,n),n.vertexStart+=g}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const{segmentTypes:i}=this.attributes,g=this.isClosed(e),{vertexStart:s,geometrySize:o}=n;i.fill(0,s,s+o),g?(i[s]=ih,i[s+o-2]=ih):(i[s]+=fH,i[s+o-2]+=pH),i[s+o-1]=ih}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i)return;const{vertexStart:g,geometrySize:s}=n,o=new Array(3);for(let r=g,I=0;I<s;r++,I++)this.getPointOnPath(e,I,o),i[r*3]=o[0],i[r*3+1]=o[1],i[r*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{positionSize:g}=this;n*g>=e.length&&(n+=1-e.length/g);const s=n*g;return i[0]=e[s],i[1]=e[s+1],i[2]=g===3&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return this.opts.loop;const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}var bH=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 lineJoin(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return currPoint + offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 pos = lineJoin(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec4 pos = vec4(
      lineJoin(prevPosition, currPosition, nextPosition, width.xy),
      1.0);
    geometry.position = pos;
    gl_Position = project_common_position_to_clipspace(pos);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,yH=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const a1=[0,0,0,255],vH={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:a1},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},gh={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class EC extends An{getShaders(){return super.getShaders({vs:bH,fs:yH,modules:[Bg,yg]})}get wrapLongitude(){return!1}initializeState(){const e=!0;this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:gh,accessor:"getPath",update:this.calculatePositions,noAlloc:e,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:e},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:gh,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:gh,defaultValue:a1},instancePickingColors:{size:3,type:5121,accessor:(i,g)=>{let{index:s,target:o}=g;return this.encodePickingColor(i&&i.__source?i.__source.index:s,o)}}}),this.setState({pathTesselator:new BH({fp64:this.use64bitPositions()})}),this.props.getDashArray&&!this.props.extensions.length&&pe.removed("getDashArray","PathStyleExtension")()}updateState(e){let{oldProps:n,props:i,changeFlags:g}=e;super.updateState({props:i,oldProps:n,changeFlags:g});const s=this.getAttributeManager();if(g.dataChanged||g.updateTriggersChanged&&(g.updateTriggersChanged.all||g.updateTriggersChanged.getPath)){const{pathTesselator:I}=this.state,a=i.data.attributes||{};I.updateGeometry({data:i.data,geometryBuffer:a.getPath,buffers:a,normalize:!i._pathType,loop:i._pathType==="loop",getGeometry:i.getPath,positionFormat:i.positionFormat,wrapLongitude:i.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:g.dataChanged}),this.setState({numInstances:I.instanceCount,startIndices:I.vertexStarts}),g.dataChanged||s.invalidateAll()}if(g.extensionsChanged){var r;const{gl:I}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(I),s.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:g}=this.props;return g[0]&&g[0].__source&&(n.object=g.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw(e){let{uniforms:n}=e;const{jointRounded:i,capRounded:g,billboard:s,miterLimit:o,widthUnits:r,widthScale:I,widthMinPixels:a,widthMaxPixels:l}=this.props;this.state.model.setUniforms(n).setUniforms({jointType:Number(i),capType:Number(g),billboard:s,widthUnits:pg[r],widthScale:I,miterLimit:o,widthMinPixels:a,widthMaxPixels:l}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Zn(e,J(S({},this.getShaders()),{id:this.props.id,geometry:new ni({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0}))}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}EC.layerName="PathLayer";EC.defaultProps=vH;var sh={exports:{}};sh.exports=QC;sh.exports.default=QC;function QC(t,e,n){n=n||2;var i=e&&e.length,g=i?e[0]*n:t.length,s=l1(t,0,g,n,!0),o=[];if(!s||s.next===s.prev)return o;var r,I,a,l,C,c,A;if(i&&(s=SH(t,e,s,n)),t.length>80*n){r=a=t[0],I=l=t[1];for(var d=n;d<g;d+=n)C=t[d],c=t[d+1],C<r&&(r=C),c<I&&(I=c),C>a&&(a=C),c>l&&(l=c);A=Math.max(a-r,l-I),A=A!==0?1/A:0}return KI(s,o,n,r,I,A),o}function l1(t,e,n,i,g){var s,o;if(g===Ih(t,e,n,i)>0)for(s=e;s<n;s+=i)o=A1(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=A1(s,t[s],t[s+1],o);return o&&XC(o,o.next)&&(MI(o),o=o.next),o}function Rg(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(XC(n,n.next)||qe(n.prev,n,n.next)===0)){if(MI(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function KI(t,e,n,i,g,s,o){if(!!t){!o&&s&&NH(t,i,g,s);for(var r=t,I,a;t.prev!==t.next;){if(I=t.prev,a=t.next,s?ZH(t,i,g,s):GH(t)){e.push(I.i/n),e.push(t.i/n),e.push(a.i/n),MI(t),t=a.next,r=a.next;continue}if(t=a,t===r){o?o===1?(t=RH(Rg(t),e,n),KI(t,e,n,i,g,s,2)):o===2&&FH(t,e,n,i,g,s):KI(Rg(t),e,n,i,g,s,1);break}}}}function GH(t){var e=t.prev,n=t,i=t.next;if(qe(e,n,i)>=0)return!1;for(var g=t.next.next;g!==t.prev;){if(Wo(e.x,e.y,n.x,n.y,i.x,i.y,g.x,g.y)&&qe(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function ZH(t,e,n,i){var g=t.prev,s=t,o=t.next;if(qe(g,s,o)>=0)return!1;for(var r=g.x<s.x?g.x<o.x?g.x:o.x:s.x<o.x?s.x:o.x,I=g.y<s.y?g.y<o.y?g.y:o.y:s.y<o.y?s.y:o.y,a=g.x>s.x?g.x>o.x?g.x:o.x:s.x>o.x?s.x:o.x,l=g.y>s.y?g.y>o.y?g.y:o.y:s.y>o.y?s.y:o.y,C=oh(r,I,e,n,i),c=oh(a,l,e,n,i),A=t.prevZ,d=t.nextZ;A&&A.z>=C&&d&&d.z<=c;){if(A!==t.prev&&A!==t.next&&Wo(g.x,g.y,s.x,s.y,o.x,o.y,A.x,A.y)&&qe(A.prev,A,A.next)>=0||(A=A.prevZ,d!==t.prev&&d!==t.next&&Wo(g.x,g.y,s.x,s.y,o.x,o.y,d.x,d.y)&&qe(d.prev,d,d.next)>=0))return!1;d=d.nextZ}for(;A&&A.z>=C;){if(A!==t.prev&&A!==t.next&&Wo(g.x,g.y,s.x,s.y,o.x,o.y,A.x,A.y)&&qe(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;d&&d.z<=c;){if(d!==t.prev&&d!==t.next&&Wo(g.x,g.y,s.x,s.y,o.x,o.y,d.x,d.y)&&qe(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function RH(t,e,n){var i=t;do{var g=i.prev,s=i.next.next;!XC(g,s)&&C1(g,i,i.next,s)&&LI(g,s)&&LI(s,g)&&(e.push(g.i/n),e.push(i.i/n),e.push(s.i/n),MI(i),MI(i.next),i=t=s),i=i.next}while(i!==t);return Rg(i)}function FH(t,e,n,i,g,s){var o=t;do{for(var r=o.next.next;r!==o.prev;){if(o.i!==r.i&&EH(o,r)){var I=c1(o,r);o=Rg(o,o.next),I=Rg(I,I.next),KI(o,e,n,i,g,s),KI(I,e,n,i,g,s);return}r=r.next}o=o.next}while(o!==t)}function SH(t,e,n,i){var g=[],s,o,r,I,a;for(s=0,o=e.length;s<o;s++)r=e[s]*i,I=s<o-1?e[s+1]*i:t.length,a=l1(t,r,I,i,!1),a===a.next&&(a.steiner=!0),g.push(TH(a));for(g.sort(VH),s=0;s<g.length;s++)n=UH(g[s],n),n=Rg(n,n.next);return n}function VH(t,e){return t.x-e.x}function UH(t,e){var n=xH(t,e);if(!n)return e;var i=c1(n,t),g=Rg(n,n.next);return Rg(i,i.next),e===n?g:e}function xH(t,e){var n=e,i=t.x,g=t.y,s=-1/0,o;do{if(g<=n.y&&g>=n.next.y&&n.next.y!==n.y){var r=n.x+(g-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(r<=i&&r>s){if(s=r,r===i){if(g===n.y)return n;if(g===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(i===s)return o;var I=o,a=o.x,l=o.y,C=1/0,c;n=o;do i>=n.x&&n.x>=a&&i!==n.x&&Wo(g<l?i:s,g,a,l,g<l?s:i,g,n.x,n.y)&&(c=Math.abs(g-n.y)/(i-n.x),LI(n,t)&&(c<C||c===C&&(n.x>o.x||n.x===o.x&&WH(o,n)))&&(o=n,C=c)),n=n.next;while(n!==I);return o}function WH(t,e){return qe(t.prev,t,e.prev)<0&&qe(e.next,t,t.next)<0}function NH(t,e,n,i){var g=t;do g.z===null&&(g.z=oh(g.x,g.y,e,n,i)),g.prevZ=g.prev,g.nextZ=g.next,g=g.next;while(g!==t);g.prevZ.nextZ=null,g.prevZ=null,wH(g)}function wH(t){var e,n,i,g,s,o,r,I,a=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,r=0,e=0;e<a&&(r++,i=i.nextZ,!!i);e++);for(I=a;r>0||I>0&&i;)r!==0&&(I===0||!i||n.z<=i.z)?(g=n,n=n.nextZ,r--):(g=i,i=i.nextZ,I--),s?s.nextZ=g:t=g,g.prevZ=s,s=g;n=i}s.nextZ=null,a*=2}while(o>1);return t}function oh(t,e,n,i,g){return t=32767*(t-n)*g,e=32767*(e-i)*g,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function TH(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Wo(t,e,n,i,g,s,o,r){return(g-o)*(e-r)-(t-o)*(s-r)>=0&&(t-o)*(i-r)-(n-o)*(e-r)>=0&&(n-o)*(s-r)-(g-o)*(i-r)>=0}function EH(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!QH(t,e)&&(LI(t,e)&&LI(e,t)&&XH(t,e)&&(qe(t.prev,t,e.prev)||qe(t,e.prev,e))||XC(t,e)&&qe(t.prev,t,t.next)>0&&qe(e.prev,e,e.next)>0)}function qe(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function XC(t,e){return t.x===e.x&&t.y===e.y}function C1(t,e,n,i){var g=_C(qe(t,e,n)),s=_C(qe(t,e,i)),o=_C(qe(n,i,t)),r=_C(qe(n,i,e));return!!(g!==s&&o!==r||g===0&&YC(t,n,e)||s===0&&YC(t,i,e)||o===0&&YC(n,t,i)||r===0&&YC(n,e,i))}function YC(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function _C(t){return t>0?1:t<0?-1:0}function QH(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&C1(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function LI(t,e){return qe(t.prev,t,t.next)<0?qe(t,e,t.next)>=0&&qe(t,t.prev,e)>=0:qe(t,e,t.prev)<0||qe(t,t.next,e)<0}function XH(t,e){var n=t,i=!1,g=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&g<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function c1(t,e){var n=new rh(t.i,t.x,t.y),i=new rh(e.i,e.x,e.y),g=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=g,g.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function A1(t,e,n,i){var g=new rh(t,e,n);return i?(g.next=i.next,g.prev=i,i.next.prev=g,i.next=g):(g.prev=g,g.next=g),g}function MI(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function rh(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}QC.deviation=function(t,e,n,i){var g=e&&e.length,s=g?e[0]*n:t.length,o=Math.abs(Ih(t,0,s,n));if(g)for(var r=0,I=e.length;r<I;r++){var a=e[r]*n,l=r<I-1?e[r+1]*n:t.length;o-=Math.abs(Ih(t,a,l,n))}var C=0;for(r=0;r<i.length;r+=3){var c=i[r]*n,A=i[r+1]*n,d=i[r+2]*n;C+=Math.abs((t[c]-t[d])*(t[A+1]-t[c+1])-(t[c]-t[A])*(t[d+1]-t[c+1]))}return o===0&&C===0?0:Math.abs((C-o)/o)};function Ih(t,e,n,i){for(var g=0,s=e,o=n-i;s<n;s+=i)g+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return g}QC.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,g=0;g<t.length;g++){for(var s=0;s<t[g].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[g][s][o]);g>0&&(i+=t[g-1].length,n.holes.push(i))}return n};var YH=sh.exports;const HC=e1.CLOCKWISE,d1=e1.COUNTER_CLOCKWISE,Fg={isClosed:!0};function _H(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function HH(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function kH(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function KH(t,e,n,i){for(let g=0;g<e;g++)if(t[n+g]!==t[i-e+g])return!1;return!0}function u1(t,e,n,i,g){let s=e;const o=n.length;for(let r=0;r<o;r++)for(let I=0;I<i;I++)t[s++]=n[r][I]||0;if(!kH(n))for(let r=0;r<i;r++)t[s++]=n[0][r]||0;return Fg.start=e,Fg.end=s,Fg.size=i,t1(t,g,Fg),s}function h1(t,e,n,i){let g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,s=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;s=s||n.length;const r=s-g;if(r<=0)return e;let I=e;for(let a=0;a<r;a++)t[I++]=n[g+a];if(!KH(n,i,g,s))for(let a=0;a<i;a++)t[I++]=n[g+a];return Fg.start=e,Fg.end=I,Fg.size=i,t1(t,o,Fg),I}function m1(t,e){_H(t);const n=[],i=[];if(t.positions){const{positions:g,holeIndices:s}=t;if(s){let o=0;for(let r=0;r<=s.length;r++)o=h1(n,o,g,e,s[r-1],s[r],r===0?HC:d1),i.push(o);return i.pop(),{positions:n,holeIndices:i}}t=g}if(Number.isFinite(t[0]))return h1(n,0,t,e,0,n.length,HC),n;if(!HH(t)){let g=0;for(const[s,o]of t.entries())g=u1(n,g,o,e,s===0?HC:d1),i.push(g);return i.pop(),{positions:n,holeIndices:i}}return u1(n,0,t,e,HC),n}function LH(t,e,n){let i=null;t.holeIndices&&(i=t.holeIndices.map(s=>s/e));let g=t.positions||t;if(n){const s=g.length;g=g.slice();const o=[];for(let r=0;r<s;r+=e){o[0]=g[r],o[1]=g[r+1];const I=n(o);g[r]=I[0],g[r+1]=I[1]}}return YH(g,i,e)}class MH extends zZ{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super(J(S({},e),{attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}}))}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;n&&(this.vertexCount=(n.value||n).length)}normalizeGeometry(e){if(this.normalize){if(e=m1(e,this.positionSize),this.opts.resolution)return g1(e.positions||e,e.holeIndices,{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0});if(this.opts.wrapLongitude)return dH(e.positions||e,e.holeIndices,{size:this.positionSize,maxLatitude:86,edgeTypes:!0})}return e}getGeometrySize(e){if(Array.isArray(e)&&!Number.isFinite(e[0])){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return(e.positions||e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):()=>null}updateGeometryAttributes(e,n){if(Array.isArray(e)&&!Number.isFinite(e[0]))for(const i of e){const g=this.getGeometrySize(i);n.geometrySize=g,this.updateGeometryAttributes(i,n),n.vertexStart+=g,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,n){let{geometryIndex:i,vertexStart:g,indexStart:s}=n;const{attributes:o,indexStarts:r,typedArrayManager:I}=this;let a=o.indices;if(!a)return;let l=s;const C=LH(e,this.positionSize,this.opts.preproject);a=I.allocate(a,s+C.length,{copy:!0});for(let c=0;c<C.length;c++)a[l++]=C[c]+g;r[i+1]=s+C.length,o.indices=a}_updatePositions(e,n){let{vertexStart:i,geometrySize:g}=n;const{attributes:{positions:s},positionSize:o}=this;if(!s)return;const r=e.positions||e;for(let I=i,a=0;a<g;I++,a++){const l=r[a*o],C=r[a*o+1],c=o>2?r[a*o+2]:0;s[I*3]=l,s[I*3+1]=C,s[I*3+2]=c}}_updateVertexValid(e,n){let{vertexStart:i,geometrySize:g}=n;const{attributes:{vertexValid:s},positionSize:o}=this,r=e&&e.holeIndices;if(e&&e.edgeTypes?s.set(e.edgeTypes,i):s.fill(1,i,i+g),r)for(let I=0;I<r.length;I++)s[i+r[I]/o-1]=0;s[i+g-1]=0}}var f1=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;

#ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
    geometry.normal = normal;
  }

  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,PH=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(f1,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),JH=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(f1,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),DH=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const kC=[0,0,0,255],zH={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:kC},getLineColor:{type:"accessor",value:kC},material:!0},KC={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class LC extends An{getShaders(e){return super.getShaders({vs:e==="top"?PH:JH,fs:DH,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Bg,oQ,yg]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:i}=this.props;n.isGeospatial&&i===ce.DEFAULT&&(i=ce.LNGLAT),this.setState({numInstances:0,polygonTesselator:new MH({preproject:i===ce.LNGLAT&&n.projectFlat,fp64:this.use64bitPositions(),IndexType:!e||l0(e,Ee.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const g=this.getAttributeManager(),s=!0;g.remove(["instancePickingColors"]),g.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:KC,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,transition:KC,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:KC,accessor:"getFillColor",defaultValue:kC,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:this.props.colorFormat.length,type:5121,normalized:!0,transition:KC,accessor:"getLineColor",defaultValue:kC,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(o,r)=>{let{index:I,target:a}=r;return this.encodePickingColor(o&&o.__source?o.__source.index:I,a)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:g}=this.props;return g[0]&&g[0].__source&&(n.object=g.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw(e){let{uniforms:n}=e;const{extruded:i,filled:g,wireframe:s,elevationScale:o}=this.props,{topModel:r,sideModel:I,polygonTesselator:a}=this.state,l=J(S({},n),{extruded:Boolean(i),elevationScale:o});I&&(I.setInstanceCount(a.instanceCount-1),I.setUniforms(l),s&&(I.setDrawMode(3),I.setUniforms({isWireframe:!0}).draw()),g&&(I.setDrawMode(6),I.setUniforms({isWireframe:!1}).draw())),r&&(r.setVertexCount(a.vertexCount),r.setUniforms(l).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:g}=e,s=this.getAttributeManager();if(g.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded){var r;(r=this.state.models)===null||r===void 0||r.forEach(I=>I.delete()),this.setState(this._getModels(this.context.gl)),s.invalidateAll()}}updateGeometry(e){let{props:n,oldProps:i,changeFlags:g}=e;if(g.dataChanged||g.updateTriggersChanged&&(g.updateTriggersChanged.all||g.updateTriggersChanged.getPolygon)){const{polygonTesselator:o}=this.state,r=n.data.attributes||{};o.updateGeometry({data:n.data,normalize:n._normalize,geometryBuffer:r.getPolygon,buffers:r,getGeometry:n.getPolygon,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:g.dataChanged}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),g.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:i,extruded:g}=this.props;let s,o;if(i){const r=this.getShaders("top");r.defines.NON_INSTANCED_MODEL=1,s=new Zn(e,J(S({},r),{id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0}))}return g&&(o=new Zn(e,J(S({},this.getShaders("side")),{id:"".concat(n,"-side"),geometry:new ni({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1})),o.userData.excludeAttributes={indices:!0}),{models:[o,s].filter(Boolean),topModel:s,sideModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}LC.layerName="SolidPolygonLayer";LC.defaultProps=zH;function p1(t){let{data:e,getIndex:n,dataRange:i,replace:g}=t;const{startRow:s=0,endRow:o=1/0}=i,r=e.length;let I=r,a=r;for(let A=0;A<r;A++){const d=n(e[A]);if(I>A&&d>=s&&(I=A),d>=o){a=A;break}}let l=I;const C=a-I!==g.length,c=C&&e.slice(a);for(let A=0;A<g.length;A++)e[l++]=g[A];if(C){for(let A=0;A<c.length;A++)e[l++]=c[A];e.length=l}return{startRow:I,endRow:I+g.length}}const B1=[0,0,0,255],OH=[0,0,0,255],jH={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:OH},getLineColor:{type:"accessor",value:B1},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class MC extends kn{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&pe.removed("getLineDashArray","PathStyleExtension")()}updateState(e){let{oldProps:n,props:i,changeFlags:g}=e;const s=g.dataChanged||g.updateTriggersChanged&&(g.updateTriggersChanged.all||g.updateTriggersChanged.getPolygon);if(s&&Array.isArray(g.dataChanged)){const o=this.state.paths.slice(),r=g.dataChanged.map(I=>p1({data:o,getIndex:a=>a.__source.index,dataRange:I,replace:this._getPaths(I)}));this.setState({paths:o,pathsDiff:r})}else s&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{data:n,getPolygon:i,positionFormat:g,_normalize:s}=this.props,o=[],r=g==="XY"?2:3,{startRow:I,endRow:a}=e,{iterable:l,objectInfo:C}=EI(n,I,a);for(const c of l){C.index++;let A=i(c,C);s&&(A=m1(A,r));const{holeIndices:d}=A,m=A.positions||A;if(d)for(let u=0;u<=d.length;u++){const h=m.slice(d[u-1]||0,d[u]||m.length);o.push(this.getSubLayerRow({path:h},c,C.index))}else o.push(this.getSubLayerRow({path:m},c,C.index))}return o}renderLayers(){const{data:e,_dataDiff:n,stroked:i,filled:g,extruded:s,wireframe:o,_normalize:r,_windingOrder:I,elevationScale:a,transitions:l,positionFormat:C}=this.props,{lineWidthUnits:c,lineWidthScale:A,lineWidthMinPixels:d,lineWidthMaxPixels:m,lineJointRounded:u,lineMiterLimit:h,lineDashJustified:f}=this.props,{getFillColor:p,getLineColor:b,getLineWidth:Z,getLineDashArray:v,getElevation:N,getPolygon:x,updateTriggers:V,material:E}=this.props,{paths:D,pathsDiff:_}=this.state,k=this.getSubLayerClass("fill",LC),z=this.getSubLayerClass("stroke",EC),ee=this.shouldRenderSubLayer("fill",D)&&new k({_dataDiff:n,extruded:s,elevationScale:a,filled:g,wireframe:o,_normalize:r,_windingOrder:I,getElevation:N,getFillColor:p,getLineColor:s&&o?b:B1,material:E,transitions:l},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:V.getPolygon,getElevation:V.getElevation,getFillColor:V.getFillColor,lineColors:s&&o,getLineColor:V.getLineColor}}),{data:e,positionFormat:C,getPolygon:x}),Ie=!s&&i&&this.shouldRenderSubLayer("stroke",D)&&new z({_dataDiff:_&&(()=>_),widthUnits:c,widthScale:A,widthMinPixels:d,widthMaxPixels:m,jointRounded:u,miterLimit:h,dashJustified:f,_pathType:"loop",transitions:l&&{getWidth:l.getLineWidth,getColor:l.getLineColor,getPath:l.getPolygon},getColor:this.getSubLayerAccessor(b),getWidth:this.getSubLayerAccessor(Z),getDashArray:this.getSubLayerAccessor(v)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:V.getLineWidth,getColor:V.getLineColor,getDashArray:V.getLineDashArray}}),{data:D,positionFormat:C,getPath:he=>he.path});return[!s&&ee,Ie,s&&ee]}}MC.layerName="PolygonLayer";MC.defaultProps=jH;function qH(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return n!==-1?$H(t,i,n):null}function $H(t,e,n){const i={properties:S({},t.properties[e])};for(const g in t.numericProps)i.properties[g]=t.numericProps[g].value[n];return i}function ek(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const g=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(g.length*3);const s=[];for(let o=0;o<g.length;o++)e(g[o],s),n[i][o*3+0]=s[0],n[i][o*3+1]=s[1],n[i][o*3+2]=s[2]}return n}var tk=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float buffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const b1=192/256,y1=[],nk={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class ah extends NC{getShaders(){return J(S({},super.getShaders()),{fs:tk})}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,i)=>{let{index:g,target:s}=i;return this.encodePickingColor(g,s)}}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:g}=n;g!==i.outlineColor&&(g=g.map(s=>s/255),g[3]=Number.isFinite(g[3])?g[3]:1,this.setState({outlineColor:g})),!n.sdf&&n.outlineWidth&&pe.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:i,outlineWidth:g}=this.props,{outlineColor:s}=this.state;e.uniforms=J(S({},e.uniforms),{buffer:b1,outlineBuffer:g?Math.max(i,b1*(1-g)):-1,gamma:i,sdf:Boolean(n),outlineColor:s}),super.draw(e)}getInstanceOffset(e){return e?Array.from(e).map(n=>super.getInstanceOffset(n)):y1}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).map(n=>super.getInstanceIconFrame(n)):y1}}ah.layerName="MultiIconLayer";ah.defaultProps=nk;var lh={exports:{}};lh.exports=PI;lh.exports.default=PI;var No=1e20;function PI(t,e,n,i,g,s){this.fontSize=t||24,this.buffer=e===void 0?3:e,this.cutoff=i||.25,this.fontFamily=g||"sans-serif",this.fontWeight=s||"normal",this.radius=n||8;var o=this.size=this.fontSize+this.buffer*2,r=o+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(r*r),this.gridInner=new Float64Array(r*r),this.f=new Float64Array(r),this.z=new Float64Array(r+1),this.v=new Uint16Array(r),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ik(t,e,n,i,g,s,o){s.fill(No,0,e*n),o.fill(0,0,e*n);for(var r=(e-i)/2,I=0;I<g;I++)for(var a=0;a<i;a++){var l=(I+r)*e+a+r,C=t.data[4*(I*i+a)+3]/255;if(C===1)s[l]=0,o[l]=No;else if(C===0)s[l]=No,o[l]=0;else{var c=Math.max(0,.5-C),A=Math.max(0,C-.5);s[l]=c*c,o[l]=A*A}}}function gk(t,e,n,i,g,s,o){for(var r=0;r<e*n;r++){var I=Math.sqrt(i[r])-Math.sqrt(g[r]);t[r]=Math.round(255-255*(I/s+o))}}PI.prototype._draw=function(t,e){var n=this.ctx.measureText(t),i=n.width,g=2*this.buffer,s,o,r,I,a,l,C,c;e&&this.useMetrics?(a=Math.floor(n.actualBoundingBoxAscent),c=this.buffer+Math.ceil(n.actualBoundingBoxAscent),l=this.buffer,C=this.buffer,o=Math.min(this.size,Math.ceil(n.actualBoundingBoxRight-n.actualBoundingBoxLeft)),I=Math.min(this.size-l,Math.ceil(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)),s=o+g,r=I+g,this.ctx.textBaseline="alphabetic"):(s=o=this.size,r=I=this.size,a=19*this.fontSize/24,l=C=0,c=this.middle,this.ctx.textBaseline="middle");var A;o&&I&&(this.ctx.clearRect(C,l,o,I),this.ctx.fillText(t,this.buffer,c),A=this.ctx.getImageData(C,l,o,I));var d=new Uint8ClampedArray(s*r);return ik(A,s,r,o,I,this.gridOuter,this.gridInner),v1(this.gridOuter,s,r,this.f,this.v,this.z),v1(this.gridInner,s,r,this.f,this.v,this.z),gk(d,s,r,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:d,metrics:{width:o,height:I,sdfWidth:s,sdfHeight:r,top:a,left:0,advance:i}}};PI.prototype.draw=function(t){return this._draw(t,!1).data};PI.prototype.drawWithMetrics=function(t){return this._draw(t,!0)};function v1(t,e,n,i,g,s){for(var o=0;o<e;o++)G1(t,o,e,n,i,g,s);for(var r=0;r<n;r++)G1(t,r*e,1,e,i,g,s)}function G1(t,e,n,i,g,s,o){var r,I,a,l;for(s[0]=0,o[0]=-No,o[1]=No,r=0;r<i;r++)g[r]=t[e+r*n];for(r=1,I=0,a=0;r<i;r++){do l=s[I],a=(g[r]-g[l]+r*r-l*l)/(r-l)/2;while(a<=o[I]&&--I>-1);I++,s[I]=r,o[I]=a,o[I+1]=No}for(r=0,I=0;r<i;r++){for(;o[I+1]<r;)I++;l=s[I],t[e+r*n]=g[l]+(r-l)*(r-l)}}var sk=lh.exports;const ok=32,rk=[];function Ik(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function ak(t){let{characterSet:e,getFontWidth:n,fontHeight:i,buffer:g,maxCanvasWidth:s,mapping:o={},xOffset:r=0,yOffset:I=0}=t,a=0,l=r,C=0;for(const A of e)if(!o[A]){const d=n(A,C++);l+d+g*2>s&&(l=0,a++),o[A]={x:l+g,y:I+a*(i+g*2)+g,width:d,height:i},l+=d+g*2}const c=i+g*2;return{mapping:o,xOffset:l,yOffset:I+a*c,canvasHeight:Ik(I+(a+1)*c)}}function Z1(t,e,n,i){let g=0;for(let s=e;s<n;s++){const o=t[s];let r=null;const I=i&&i[o];I&&(r=I.width),g+=r}return g}function R1(t,e,n,i,g,s){let o=e,r=0;for(let I=e;I<n;I++){const a=Z1(t,I,I+1,g);r+a>i&&(o<I&&s.push(I),o=I,r=0),r+=a}return r}function lk(t,e,n,i,g,s){let o=e,r=e,I=e,a=0;for(let l=e;l<n;l++)if((t[l]===" "||t[l+1]===" "||l+1===n)&&(I=l+1),I>r){let C=Z1(t,r,I,g);a+C>i&&(o<r&&(s.push(r),o=r,a=0),C>i&&(C=R1(t,r,I,i,g,s),o=s[s.length-1])),r=I,a+=C}return a}function Ck(t,e,n,i){let g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,s=arguments.length>5?arguments[5]:void 0;s===void 0&&(s=t.length);const o=[];return e==="break-all"?R1(t,g,s,n,i,o):lk(t,g,s,n,i,o),o}function ck(t,e,n,i,g,s){let o=0,r=0;for(let I=e;I<n;I++){const a=t[I],l=i[a];l?(r||(r=l.height),g[I]=o+l.width/2,o+=l.width):(pe.warn("Missing character: ".concat(a," (").concat(a.codePointAt(0),")"))(),g[I]=o,o+=ok)}s[0]=o,s[1]=r}function F1(t,e,n,i,g){t=Array.from(t);const s=t.length,o=new Array(s),r=new Array(s),I=new Array(s),a=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,l=[0,0],C=[];let c=0,A=0,d=0;for(let m=0;m<=s;m++){const u=t[m];if((u===`
`||m===s)&&(d=m),d>A){const h=a?Ck(t,n,i,g,A,d):rk;for(let f=0;f<=h.length;f++){const p=f===0?A:h[f-1],b=f<h.length?h[f]:d;ck(t,p,b,g,o,C);for(let Z=p;Z<b;Z++)r[Z]=c+C[1]/2,I[Z]=C[0];c=c+C[1]*e,l[0]=Math.max(l[0],C[0])}A=d}u===`
`&&(o[A]=0,r[A]=0,I[A]=0,A++)}return l[1]=c,{x:o,y:r,rowWidth:I,size:l}}function Ak(t){let{value:e,length:n,stride:i,offset:g,startIndices:s,characterSet:o}=t;const r=e.BYTES_PER_ELEMENT,I=i?i/r:1,a=g?g/r:0,l=s[n]||Math.ceil((e.length-a)/I),C=o&&new Set,c=new Array(n);let A=e;if(I>1||a>0){A=new e.constructor(l);for(let d=0;d<l;d++)A[d]=e[d*I+a]}for(let d=0;d<n;d++){const m=s[d],u=s[d+1]||l,h=A.subarray(m,u);c[d]=String.fromCodePoint.apply(null,h),C&&h.forEach(C.add,C)}if(C)for(const d of C)o.add(String.fromCodePoint(d));return{texts:c,characterCount:l}}class S1{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:5;this.limit=e,this.clear()}clear(){this._cache={},this._order=[]}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(this._deleteCache(e),this._deleteOrder(e))}_deleteCache(e){delete this._cache[e]}_deleteOrder(e){const n=this._order.findIndex(i=>i===e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function dk(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const V1=dk(),U1="Monaco, monospace",x1="normal",W1=64,N1=4,w1=.25,T1=12,E1=1024,uk=.9,Q1=1.2,X1=3;let PC=new S1(X1);const hk=["fontFamily","fontWeight","characterSet","fontSize","sdf","buffer","cutoff","radius"];function mk(t,e){const n=PC.get(t);if(!n)return e;const i=[],g=n.mapping;let s=Object.keys(g);s=new Set(s);let o=e;return o instanceof Array&&(o=new Set(o)),o.forEach(r=>{s.has(r)||i.push(r)}),i}function fk(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function Y1(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="baseline",t.textAlign="left"}function pk(t){pe.assert(Number.isFinite(t)&&t>=X1,"Invalid cache limit"),PC=new S1(t)}class Bk{constructor(){this.props={fontFamily:U1,fontWeight:x1,characterSet:V1,fontSize:W1,buffer:N1,sdf:!1,cutoff:w1,radius:T1},this._key=null,this._atlas=null}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return Q1}setProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};hk.forEach(o=>{o in e&&(this.props[o]=e[o])});const n=this._key;this._key=this._getKey();const i=mk(this._key,this.props.characterSet),g=PC.get(this._key);if(g&&i.length===0){this._key!==n&&(this._atlas=g);return}const s=this._generateFontAtlas(this._key,i,g);this._atlas=s,PC.set(this._key,s)}_generateFontAtlas(e,n,i){const{fontFamily:g,fontWeight:s,fontSize:o,buffer:r,sdf:I,radius:a,cutoff:l}=this.props;let C=i&&i.data;C||(C=document.createElement("canvas"),C.width=E1);const c=C.getContext("2d");Y1(c,g,o,s);const{mapping:A,canvasHeight:d,xOffset:m,yOffset:u}=ak(S({getFontWidth:h=>c.measureText(h).width,fontHeight:o*Q1,buffer:r,characterSet:n,maxCanvasWidth:E1},i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}));if(C.height!==d){const h=c.getImageData(0,0,C.width,C.height);C.height=d,c.putImageData(h,0,0)}if(Y1(c,g,o,s),I){const h=new sk(o,r,a,l,g,s),f=c.getImageData(0,0,h.size,h.size);for(const p of n)fk(h.draw(p),f),c.putImageData(f,A[p].x-r,A[p].y+r)}else for(const h of n)c.fillText(h,A[h].x,A[h].y+o*uk);return{xOffset:m,yOffset:u,mapping:A,data:C,width:C.width,height:C.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:g,sdf:s,radius:o,cutoff:r}=this.props;return s?"".concat(e," ").concat(n," ").concat(i," ").concat(g," ").concat(o," ").concat(r):"".concat(e," ").concat(n," ").concat(i," ").concat(g)}}var bk=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,yk=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const vk={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Ch extends An{getShaders(){return super.getShaders({vs:bk,fs:yk,modules:[Bg,yg]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){let{props:n,oldProps:i,changeFlags:g}=e;if(super.updateState({props:n,oldProps:i,changeFlags:g}),g.extensionsChanged){var s;const{gl:o}=this.context;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}}draw(e){let{uniforms:n}=e;const{billboard:i,sizeScale:g,sizeUnits:s,sizeMinPixels:o,sizeMaxPixels:r,getLineWidth:I}=this.props;let{padding:a}=this.props;a.length<4&&(a=[a[0],a[1],a[0],a[1]]),this.state.model.setUniforms(n).setUniforms({billboard:i,stroked:Boolean(I),padding:a,sizeUnits:pg[s],sizeScale:g,sizeMinPixels:o,sizeMaxPixels:r}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new Zn(e,J(S({},this.getShaders()),{id:this.props.id,geometry:new ni({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0}))}}Ch.layerName="TextBackgroundLayer";Ch.defaultProps=vk;const _1={fontSize:W1,buffer:N1,sdf:!1,radius:T1,cutoff:w1,smoothing:.1},H1={start:1,middle:0,end:-1},k1={top:1,center:0,bottom:-1},ch=[0,0,0,255],Gk=1,Zk=["fontSize","buffer","sdf","radius","cutoff"],Rk={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:ch},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:V1},fontFamily:U1,fontWeight:x1,lineHeight:Gk,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:ch},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:ch},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class JI extends kn{initializeState(){this.state={styleVersion:0,fontAtlasManager:new Bk}}updateState(e){let{props:n,oldProps:i,changeFlags:g}=e;const s=g.dataChanged||g.updateTriggersChanged&&(g.updateTriggersChanged.all||g.updateTriggersChanged.getText),o=this.state.characterSet;s&&this._updateText();const r=o!==this.state.characterSet||this._fontChanged(i,n);r&&this._updateFontAtlas(i,n),(r||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo(e){let{info:n}=e;return n.object=n.index>=0?this.props.data[n.index]:null,n}_updateFontAtlas(e,n){const{fontSettings:i,fontFamily:g,fontWeight:s}=n,{fontAtlasManager:o,characterSet:r}=this.state;o.setProps(J(S(S({},_1),i),{characterSet:r,fontFamily:g,fontWeight:s}))}_fontChanged(e,n){if(e.fontFamily!==n.fontFamily||e.fontWeight!==n.fontWeight)return!0;if(e.fontSettings===n.fontSettings)return!1;const i=e.fontSettings||{},g=n.fontSettings||{};return Zk.some(s=>i[s]!==g[s])}_updateText(){const{data:e,characterSet:n}=this.props,i=e.attributes&&e.attributes.getText;let{getText:g}=this.props,{startIndices:s}=e,o;const r=n==="auto"&&new Set;if(i&&s){const{texts:I,characterCount:a}=Ak(J(S({},ArrayBuffer.isView(i)?{value:i}:i),{length:e.length,startIndices:s,characterSet:r}));o=a,g=(l,C)=>{let{index:c}=C;return I[c]}}else{const{iterable:I,objectInfo:a}=EI(e);s=[0],o=0;for(const l of I){a.index++;const C=Array.from(g(l,a)||"");r&&C.forEach(r.add,r),o+=C.length,s.push(o)}}this.setState({getText:g,startIndices:s,numInstances:o,characterSet:r||n})}getBoundingRect(e,n){const i=this.state.fontAtlasManager.mapping,{getText:g}=this.state,{wordBreak:s,maxWidth:o,lineHeight:r,getTextAnchor:I,getAlignmentBaseline:a}=this.props,l=g(e,n)||"",{size:[C,c]}=F1(l,r,s,o,i),A=H1[typeof I=="function"?I(e,n):I],d=k1[typeof a=="function"?a(e,n):a];return[(A-1)*C/2,(d-1)*c/2,C,c]}getIconOffsets(e,n){const i=this.state.fontAtlasManager.mapping,{getText:g}=this.state,{wordBreak:s,maxWidth:o,lineHeight:r,getTextAnchor:I,getAlignmentBaseline:a}=this.props,l=g(e,n)||"",{x:C,y:c,rowWidth:A,size:[d,m]}=F1(l,r,s,o,i),u=H1[typeof I=="function"?I(e,n):I],h=k1[typeof a=="function"?a(e,n):a],f=C.length,p=new Array(f*2);let b=0;for(let Z=0;Z<f;Z++){const v=(1-u)*(d-A[Z])/2;p[b++]=(u-1)*d/2+v+C[Z],p[b++]=(h-1)*m/2+c[Z]}return p}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:g,texture:s,mapping:o},styleVersion:r}=this.state,{data:I,_dataDiff:a,getPosition:l,getColor:C,getSize:c,getAngle:A,getPixelOffset:d,getBackgroundColor:m,getBorderColor:u,getBorderWidth:h,backgroundPadding:f,background:p,billboard:b,fontSettings:Z,outlineWidth:v,outlineColor:N,sizeScale:x,sizeUnits:V,sizeMinPixels:E,sizeMaxPixels:D,transitions:_,updateTriggers:k}=this.props,z=this.getSubLayerClass("characters",ah),ee=this.getSubLayerClass("background",Ch);return[p&&new ee({getFillColor:m,getLineColor:u,getLineWidth:h,padding:f,getPosition:l,getSize:c,getAngle:A,getPixelOffset:d,billboard:b,sizeScale:x/this.state.fontAtlasManager.props.fontSize,sizeUnits:V,sizeMinPixels:E,sizeMaxPixels:D,transitions:_&&{getPosition:_.getPosition,getAngle:_.getAngle,getSize:_.getSize,getFillColor:_.getBackgroundColor,getLineColor:_.getBorderColor,getLineWidth:_.getBorderWidth,getPixelOffset:_.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:k.getPosition,getAngle:k.getAngle,getSize:k.getSize,getFillColor:k.getBackgroundColor,getLineColor:k.getBorderColor,getLineWidth:k.getBorderWidth,getPixelOffset:k.getPixelOffset,getBoundingRect:{getText:k.getText,getTextAnchor:k.getTextAnchor,getAlignmentBaseline:k.getAlignmentBaseline,styleVersion:r}}}),{data:I.attributes?{length:I.length,attributes:I.attributes.background||{}}:I,_dataDiff:a,autoHighlight:!1,getBoundingRect:this.getBoundingRect.bind(this)}),new z({sdf:Z.sdf,smoothing:Number.isFinite(Z.smoothing)?Z.smoothing:_1.smoothing,outlineWidth:v,outlineColor:N,iconAtlas:s,iconMapping:o,getPosition:l,getColor:C,getSize:c,getAngle:A,getPixelOffset:d,billboard:b,sizeScale:x*g,sizeUnits:V,sizeMinPixels:E*g,sizeMaxPixels:D*g,transitions:_&&{getPosition:_.getPosition,getAngle:_.getAngle,getColor:_.getColor,getSize:_.getSize,getPixelOffset:_.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:k.getText,getPosition:k.getPosition,getAngle:k.getAngle,getColor:k.getColor,getSize:k.getSize,getPixelOffset:k.getPixelOffset,getIconOffsets:{getText:k.getText,getTextAnchor:k.getTextAnchor,getAlignmentBaseline:k.getAlignmentBaseline,styleVersion:r}}}),{data:I,_dataDiff:a,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets.bind(this),getIcon:i})]}static set fontAtlasCacheLimit(e){pk(e)}}JI.layerName="TextLayer";JI.defaultProps=Rk;const JC={circle:{type:eh,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:NC,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:JI,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},DC={type:EC,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Ah={type:LC,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function DI(t){let{type:e,props:n}=t;const i={};for(const g in n)i[g]=e.defaultProps[n[g]];return i}function dh(t,e){const{transitions:n,updateTriggers:i}=t.props,g={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let r=t.props[s];s.startsWith("get")&&(r=t.getSubLayerAccessor(r),g.updateTriggers[o]=i[s],n&&(g.transitions[o]=n[s])),g[o]=r}return g}function Fk(t){if(Array.isArray(t))return t;switch(pe.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return pe.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function K1(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:g=0,endRow:s=t.length}=n;for(let o=g;o<s;o++){const r=t[o];pe.assert(r&&r.geometry,"GeoJSON does not have geometry");const{geometry:I}=r;if(I.type==="GeometryCollection"){pe.assert(Array.isArray(I.geometries),"GeoJSON does not have geometries array");const{geometries:a}=I;for(let l=0;l<a.length;l++){const C=a[l];L1(C,i,e,r,o)}}else L1(I,i,e,r,o)}return i}function L1(t,e,n,i,g){const{type:s,coordinates:o}=t,{pointFeatures:r,lineFeatures:I,polygonFeatures:a,polygonOutlineFeatures:l}=e;if(!Vk(s,o)){pe.warn("".concat(s," coordinates are malformed"))();return}switch(s){case"Point":r.push(n({geometry:t},i,g));break;case"MultiPoint":o.forEach(C=>{r.push(n({geometry:{type:"Point",coordinates:C}},i,g))});break;case"LineString":I.push(n({geometry:t},i,g));break;case"MultiLineString":o.forEach(C=>{I.push(n({geometry:{type:"LineString",coordinates:C}},i,g))});break;case"Polygon":a.push(n({geometry:t},i,g)),o.forEach(C=>{l.push(n({geometry:{type:"LineString",coordinates:C}},i,g))});break;case"MultiPolygon":o.forEach(C=>{a.push(n({geometry:{type:"Polygon",coordinates:C}},i,g)),C.forEach(c=>{l.push(n({geometry:{type:"LineString",coordinates:c}},i,g))})});break}}const Sk={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Vk(t,e){let n=Sk[t];for(pe.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function M1(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function zC(t){return t.geometry.coordinates}function Uk(t,e){const n=M1(),{pointFeatures:i,lineFeatures:g,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=zC,n.lines.data=g,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=zC,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=zC,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=zC,n}function xk(t,e){const n=M1(),{points:i,lines:g,polygons:s}=t,o=ek(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{getPosition:i.positions,instancePickingColors:{size:3,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:g.pathIndices.value.length-1,startIndices:g.pathIndices.value,attributes:{getPath:g.positions,instancePickingColors:{size:3,value:o.lines}},properties:g.properties,numericProps:g.numericProps,featureIds:g.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const Wk=["points","linestrings","polygons"],Nk=J(S(S(S(S(S({},DI(JC.circle)),DI(JC.icon)),DI(JC.text)),DI(DC)),DI(Ah)),{stroked:!0,filled:!0,extruded:!1,wireframe:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}});class uh extends kn{initializeState(){this.state={layerProps:{},features:{}},this.props.getLineDashArray&&pe.removed("getLineDashArray","PathStyleExtension")()}updateState(e){let{props:n,changeFlags:i}=e;if(!i.dataChanged)return;const{data:g}=this.props,s=g&&"points"in g&&"polygons"in g&&"lines"in g;this.setState({binary:s}),s?this._updateStateBinary({props:n,changeFlags:i}):this._updateStateJSON({props:n,changeFlags:i})}_updateStateBinary(e){let{props:n,changeFlags:i}=e;const g=xk(n.data,this.encodePickingColor);this.setState({layerProps:g})}_updateStateJSON(e){let{props:n,changeFlags:i}=e;const g=Fk(n.data),s=this.getSubLayerRow.bind(this);let o={};const r={};if(Array.isArray(i.dataChanged)){const a=this.state.features;for(const l in a)o[l]=a[l].slice(),r[l]=[];for(const l of i.dataChanged){const C=K1(g,s,l);for(const c in a)r[c].push(p1({data:o[c],getIndex:A=>A.__source.index,dataRange:l,replace:C[c]}))}}else o=K1(g,s);const I=Uk(o,r);this.setState({features:o,featuresDiff:r,layerProps:I})}getPickingInfo(e){const n=super.getPickingInfo(e),{sourceLayer:i}=n;return n.featureType=Wk.find(g=>i.id.startsWith("".concat(this.id,"-").concat(g,"-"))),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),i=e.featureType==="points";for(const g of this.getSubLayers())g.id.startsWith(n)===i&&g.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:i}=this.state,g="polygons-fill",s=this.shouldRenderSubLayer(g,i.polygons.data)&&this.getSubLayerClass(g,Ah.type);if(s){const o=dh(this,Ah.props),r=e&&n;return r||delete o.getLineColor,o.updateTriggers.lineColors=r,new s(o,this.getSubLayerProps({id:g,updateTriggers:o.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:i}=this.state,g="polygons-stroke",s="linestrings",o=!e&&n&&this.shouldRenderSubLayer(g,i.polygonsOutline.data)&&this.getSubLayerClass(g,DC.type),r=this.shouldRenderSubLayer(s,i.lines.data)&&this.getSubLayerClass(s,DC.type);if(o||r){const I=dh(this,DC.props);return[o&&new o(I,this.getSubLayerProps({id:g,updateTriggers:I.updateTriggers}),i.polygonsOutline),r&&new r(I,this.getSubLayerProps({id:s,updateTriggers:I.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:g}=this.props;!i&&Number.isFinite(g)&&(g=n.points.data.findIndex(r=>r.__source.index===g));const s=new Set(e.split("+")),o=[];for(const r of s){const I="points-".concat(r),a=JC[r],l=a&&this.shouldRenderSubLayer(I,n.points.data)&&this.getSubLayerClass(I,a.type);if(l){const C=dh(this,a.props);o.push(new l(C,this.getSubLayerProps({id:I,updateTriggers:C.updateTriggers,highlightedObjectIndex:g}),n.points))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),i=this._renderLineLayers(),g=this._renderPointLayers();return[!e&&n,i,g,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(i,g)=>{const{data:s,index:o}=g,r=qH(s,o);return e(r,g)}}}uh.layerName="GeoJsonLayer";uh.defaultProps=Nk;class wk{constructor(e){let{x:n,y:i,z:g}=e;this.x=n,this.y=i,this.z=g,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get data(){return this.isLoading?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return Boolean(this._loader)&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||pe.error("byteLength not defined in tile data")(),e}async _loadData(e){let{getData:n,requestScheduler:i,onLoad:g,onError:s}=e;const{x:o,y:r,z:I,bbox:a}=this,l=this._loaderId;this._abortController=new AbortController;const{signal:C}=this._abortController,c=await i.scheduleRequest(this,m=>m.isSelected?1:-1);if(!c){this._isCancelled=!0;return}if(this._isCancelled){c.done();return}let A=null,d;try{A=await n({x:o,y:r,z:I,bbox:a,signal:C})}catch(m){d=m||!0}finally{c.done()}if(l===this._loaderId){if(this._loader=void 0,this.content=A,this._isCancelled&&!A){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,d?s(d,this):g(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController.abort())}}const Xt=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1}),P1=new j,Tk=new j;class hh{constructor(e=[0,0,0],n=[0,0,0],i=null){i=i||P1.copy(e).add(n).scale(.5),this.center=new j(i),this.halfDiagonal=new j(n).subtract(this.center),this.minimum=new j(e),this.maximum=new j(n)}clone(){return new hh(this.minimum,this.maximum,this.center)}equals(e){return this===e||Boolean(e)&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:n}=this,i=Tk.from(e.normal),g=n.x*Math.abs(i.x)+n.y*Math.abs(i.y)+n.z*Math.abs(i.z),s=this.center.dot(i)+e.distance;return s-g>0?Xt.INSIDE:s+g<0?Xt.OUTSIDE:Xt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=P1.from(e).subtract(this.center),{halfDiagonal:i}=this;let g=0,s;return s=Math.abs(n.x)-i.x,s>0&&(g+=s*s),s=Math.abs(n.y)-i.y,s>0&&(g+=s*s),s=Math.abs(n.z)-i.z,s>0&&(g+=s*s),g}}const zI=new j,J1=new j;class mh{constructor(e=[0,0,0],n=0){this.radius=-0,this.center=new j,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=zI.from(n),this.center=new j().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new mh(this.center,this.radius)}union(e){const n=this.center,i=this.radius,g=e.center,s=e.radius,o=zI.copy(g).subtract(n),r=o.magnitude();if(i>=r+s)return this.clone();if(s>=r+i)return e.clone();const I=(i+r+s)*.5;return J1.copy(o).scale((-i+I)/r).add(n),this.center.copy(J1),this.radius=I,this}expand(e){e=zI.from(e);const n=e.subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(e){this.center.transform(e);const n=hE(zI,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){e=zI.from(e);const n=e.subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(e){const n=this.center,i=this.radius,s=e.normal.dot(n)+e.distance;return s<-i?Xt.OUTSIDE:s<i?Xt.INTERSECTING:Xt.INSIDE}}const Ek=new j,Qk=new j,OC=new j,jC=new j,qC=new j,Xk=new j,Yk=new j,Vi={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class fh{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){this.center=new j().from(e),this.halfAxes=new ft(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new j(e).len(),new j(n).len(),new j(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),g=new j(e).normalize(),s=new j(n).normalize(),o=new j(i).normalize();return new vG().fromMatrix3(new ft([...g,...s,...o]))}fromCenterHalfSizeQuaternion(e,n,i){const g=new vG(i),s=new ft().fromQuaternion(g);return s[0]=s[0]*n[0],s[1]=s[1]*n[0],s[2]=s[2]*n[0],s[3]=s[3]*n[1],s[4]=s[4]*n[1],s[5]=s[5]*n[1],s[6]=s[6]*n[2],s[7]=s[7]*n[2],s[8]=s[8]*n[2],this.center=new j().from(e),this.halfAxes=s,this}clone(){return new fh(this.center,this.halfAxes)}equals(e){return this===e||Boolean(e)&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new mh){const n=this.halfAxes,i=n.getColumn(0,OC),g=n.getColumn(1,jC),s=n.getColumn(2,qC),o=Ek.copy(i).add(g).add(s);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const n=this.center,i=e.normal,g=this.halfAxes,s=i.x,o=i.y,r=i.z,I=Math.abs(s*g[Vi.COLUMN0ROW0]+o*g[Vi.COLUMN0ROW1]+r*g[Vi.COLUMN0ROW2])+Math.abs(s*g[Vi.COLUMN1ROW0]+o*g[Vi.COLUMN1ROW1]+r*g[Vi.COLUMN1ROW2])+Math.abs(s*g[Vi.COLUMN2ROW0]+o*g[Vi.COLUMN2ROW1]+r*g[Vi.COLUMN2ROW2]),a=i.dot(n)+e.distance;return a<=-I?Xt.OUTSIDE:a>=I?Xt.INSIDE:Xt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=Qk.from(e).subtract(this.center),i=this.halfAxes,g=i.getColumn(0,OC),s=i.getColumn(1,jC),o=i.getColumn(2,qC),r=g.magnitude(),I=s.magnitude(),a=o.magnitude();g.normalize(),s.normalize(),o.normalize();let l=0,C;return C=Math.abs(n.dot(g))-r,C>0&&(l+=C*C),C=Math.abs(n.dot(s))-I,C>0&&(l+=C*C),C=Math.abs(n.dot(o))-a,C>0&&(l+=C*C),l}computePlaneDistances(e,n,i=[-0,-0]){let g=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=this.center,r=this.halfAxes,I=r.getColumn(0,OC),a=r.getColumn(1,jC),l=r.getColumn(2,qC),C=Xk.copy(I).add(a).add(l).add(o),c=Yk.copy(C).subtract(e);let A=n.dot(c);return g=Math.min(A,g),s=Math.max(A,s),C.copy(o).add(I).add(a).subtract(l),c.copy(C).subtract(e),A=n.dot(c),g=Math.min(A,g),s=Math.max(A,s),C.copy(o).add(I).subtract(a).add(l),c.copy(C).subtract(e),A=n.dot(c),g=Math.min(A,g),s=Math.max(A,s),C.copy(o).add(I).subtract(a).subtract(l),c.copy(C).subtract(e),A=n.dot(c),g=Math.min(A,g),s=Math.max(A,s),o.copy(C).subtract(I).add(a).add(l),c.copy(C).subtract(e),A=n.dot(c),g=Math.min(A,g),s=Math.max(A,s),o.copy(C).subtract(I).add(a).subtract(l),c.copy(C).subtract(e),A=n.dot(c),g=Math.min(A,g),s=Math.max(A,s),o.copy(C).subtract(I).subtract(a).add(l),c.copy(C).subtract(e),A=n.dot(c),g=Math.min(A,g),s=Math.max(A,s),o.copy(C).subtract(I).subtract(a).subtract(l),c.copy(C).subtract(e),A=n.dot(c),g=Math.min(A,g),s=Math.max(A,s),i[0]=g,i[1]=s,i}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,OC);n.transformAsPoint(e);const i=this.halfAxes.getColumn(1,jC);i.transformAsPoint(e);const g=this.halfAxes.getColumn(2,qC);return g.transformAsPoint(e),this.halfAxes=new ft([...n,...i,...g]),this}getTransform(){throw new Error("not implemented")}}const D1=new j,z1=new j;class Sg{constructor(e=[0,0,1],n=0){this.normal=new j,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return Mt(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=D1.from(e),this.normal.from(n).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,n,i,g){return this.normal.set(e,n,i),Mt(fg(this.normal.len(),1)),this.distance=g,this}clone(e){return new Sg(this.normal,this.distance)}equals(e){return fg(this.distance,e.distance)&&fg(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=z1.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,n)}projectPointOntoPlane(e,n=[0,0,0]){e=D1.from(e);const i=this.getPointDistance(e),g=z1.copy(this.normal).scale(i);return e.subtract(g).to(n)}}const O1=[new j([1,0,0]),new j([0,1,0]),new j([0,0,1])],j1=new j,_k=new j;new Sg(new j(1,0,0),0);class wo{static get MASK_OUTSIDE(){return 4294967295}static get MASK_INSIDE(){return 0}static get MASK_INDETERMINATE(){return 2147483647}constructor(e=[]){this.planes=e,Mt(this.planes.every(n=>n instanceof Sg))}fromBoundingSphere(e){this.planes.length=2*O1.length;const n=e.center,i=e.radius;let g=0;for(const s of O1){let o=this.planes[g],r=this.planes[g+1];o||(o=this.planes[g]=new Sg),r||(r=this.planes[g+1]=new Sg);const I=j1.copy(s).scale(-i).add(n);-s.dot(I),o.fromPointNormal(I,s);const a=j1.copy(s).scale(i).add(n),l=_k.copy(s).negate();-l.dot(a),r.fromPointNormal(a,l),g+=2}return this}computeVisibility(e){Mt(e);let n=Xt.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case Xt.OUTSIDE:return Xt.OUTSIDE;case Xt.INTERSECTING:n=Xt.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(Mt(e,"boundingVolume is required."),Mt(Number.isFinite(n),"parentPlaneMask is required."),n===wo.MASK_OUTSIDE||n===wo.MASK_INSIDE)return n;let i=wo.MASK_INSIDE;const g=this.planes;for(let s=0;s<this.planes.length;++s){const o=s<31?1<<s:0;if(s<31&&(n&o)==0)continue;const r=g[s],I=e.intersectPlane(r);if(I===Xt.OUTSIDE)return wo.MASK_OUTSIDE;I===Xt.INTERSECTING&&(i|=o)}return i}}new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;new j;const si=new ft,Hk=new ft,kk=new ft,$C=new ft,q1=new ft;function Kk(t,e={}){const n=GG.EPSILON20,i=10;let g=0,s=0;const o=Hk,r=kk;o.identity(),r.copy(t);const I=n*Lk(r);for(;s<i&&Mk(r)>I;)Pk(r,$C),q1.copy($C).transpose(),r.multiplyRight($C),r.multiplyLeft(q1),o.multiplyRight($C),++g>2&&(++s,g=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=r.toTarget(e.diagonal),e}function Lk(t){let e=0;for(let n=0;n<9;++n){const i=t[n];e+=i*i}return Math.sqrt(e)}const ph=[1,0,0],Bh=[2,2,1];function Mk(t){let e=0;for(let n=0;n<3;++n){const i=t[si.getElementIndex(Bh[n],ph[n])];e+=2*i*i}return Math.sqrt(e)}function Pk(t,e){const n=GG.EPSILON15;let i=0,g=1;for(let a=0;a<3;++a){const l=Math.abs(t[si.getElementIndex(Bh[a],ph[a])]);l>i&&(g=a,i=l)}const s=ph[g],o=Bh[g];let r=1,I=0;if(Math.abs(t[si.getElementIndex(o,s)])>n){const a=t[si.getElementIndex(o,o)],l=t[si.getElementIndex(s,s)],C=t[si.getElementIndex(o,s)],c=(a-l)/2/C;let A;c<0?A=-1/(-c+Math.sqrt(1+c*c)):A=1/(c+Math.sqrt(1+c*c)),r=1/Math.sqrt(1+A*A),I=A*r}return ft.IDENTITY.to(e),e[si.getElementIndex(s,s)]=e[si.getElementIndex(o,o)]=r,e[si.getElementIndex(o,s)]=I,e[si.getElementIndex(s,o)]=-I,e}const Vg=new j,Jk=new j,Dk=new j,zk=new j,Ok=new j,jk=new ft,qk={diagonal:new ft,unitary:new ft};function $k(t,e=new fh){if(!t||t.length===0)return e.halfAxes=new ft([0,0,0,0,0,0,0,0,0]),e.center=new j,e;const n=t.length,i=new j(0,0,0);for(const V of t)i.add(V);const g=1/n;i.multiplyByScalar(g);let s=0,o=0,r=0,I=0,a=0,l=0;for(const V of t){const E=Vg.copy(V).subtract(i);s+=E.x*E.x,o+=E.x*E.y,r+=E.x*E.z,I+=E.y*E.y,a+=E.y*E.z,l+=E.z*E.z}s*=g,o*=g,r*=g,I*=g,a*=g,l*=g;const C=jk;C[0]=s,C[1]=o,C[2]=r,C[3]=o,C[4]=I,C[5]=a,C[6]=r,C[7]=a,C[8]=l;const{unitary:c}=Kk(C,qk),A=e.halfAxes.copy(c);let d=A.getColumn(0,Dk),m=A.getColumn(1,zk),u=A.getColumn(2,Ok),h=-Number.MAX_VALUE,f=-Number.MAX_VALUE,p=-Number.MAX_VALUE,b=Number.MAX_VALUE,Z=Number.MAX_VALUE,v=Number.MAX_VALUE;for(const V of t)Vg.copy(V),h=Math.max(Vg.dot(d),h),f=Math.max(Vg.dot(m),f),p=Math.max(Vg.dot(u),p),b=Math.min(Vg.dot(d),b),Z=Math.min(Vg.dot(m),Z),v=Math.min(Vg.dot(u),v);d=d.multiplyByScalar(.5*(b+h)),m=m.multiplyByScalar(.5*(Z+f)),u=u.multiplyByScalar(.5*(v+p)),e.center.copy(d).add(m).add(u);const N=Jk.set(h-b,f-Z,p-v).multiplyByScalar(.5),x=new ft([N[0],0,0,0,N[1],0,0,0,N[2]]);return e.halfAxes.multiplyRight(x),e}const To=512,$1=3,e2=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],t2=e2.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),eK=t2.concat([[.25,.5],[.75,.5]]);class Eo{constructor(e,n,i){this.x=e,this.y=n,this.z=i}get children(){if(!this._children){const e=this.x*2,n=this.y*2,i=this.z+1;this._children=[new Eo(e,n,i),new Eo(e,n+1,i),new Eo(e+1,n,i),new Eo(e+1,n+1,i)]}return this._children}update(e){const{viewport:n,cullingVolume:i,elevationBounds:g,minZ:s,maxZ:o,bounds:r,offset:I,project:a}=e,l=this.getBoundingVolume(g,I,a);if(r&&!this.insideBounds(r)||i.computeVisibility(l)<0)return!1;if(!this.childVisible){let{z:c}=this;if(c<o&&c>=s){const A=l.distanceTo(n.cameraPosition)*n.scale/n.height;c+=Math.floor(Math.log2(A))}if(c>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const c of this.children)c.update(e);return!0}getSelected(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(this.selected&&e.push(this),this._children)for(const n of this._children)n.getSelected(e);return e}insideBounds(e){let[n,i,g,s]=e;const o=Math.pow(2,this.z),r=To/o;return this.x*r<g&&this.y*r<s&&(this.x+1)*r>n&&(this.y+1)*r>i}getBoundingVolume(e,n,i){if(i){const I=this.z<1?eK:this.z<2?t2:e2,a=[];for(const l of I){const C=yh(this.x+l[0],this.y+l[1],this.z);C[2]=e[0],a.push(i(C)),e[0]!==e[1]&&(C[2]=e[1],a.push(i(C)))}return $k(a)}const g=Math.pow(2,this.z),s=To/g,o=this.x*s+n*To,r=To-(this.y+1)*s;return new hh([o,r,e[0]],[o+s,r+s,e[1]])}}function tK(t,e,n,i){const g=t.resolution?t.projectPosition:null,s=Object.values(t.getFrustumPlanes()).map(A=>{let{normal:d,distance:m}=A;return new Sg(d.clone().negate(),m)}),o=new wo(s),r=t.distanceScales.unitsPerMeter[2],I=n&&n[0]*r||0,a=n&&n[1]*r||0,l=t.pitch<=60?e:0;if(i){const[A,d,m,u]=i,h=bg([A,u]),f=bg([m,d]);i=[h[0],To-h[1],f[0],To-f[1]]}const C=new Eo(0,0,0),c={viewport:t,project:g,cullingVolume:o,elevationBounds:[I,a],minZ:l,maxZ:e,bounds:i,offset:0};if(C.update(c),t.subViewports&&t.subViewports.length>1){for(c.offset=-1;C.update(c)&&!(--c.offset<-$1););for(c.offset=1;C.update(c)&&!(++c.offset>$1););}return C.getSelected()}const Ui=512,nK=[-1/0,-1/0,1/0,1/0],iK={type:"url",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(n=>typeof n=="string"),equals:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}};function n2(t,e){const n=[e.transformPoint([t[0],t[1]]),e.transformPoint([t[2],t[1]]),e.transformPoint([t[0],t[3]]),e.transformPoint([t[2],t[3]])];return[Math.min(...n.map(g=>g[0])),Math.min(...n.map(g=>g[1])),Math.max(...n.map(g=>g[0])),Math.max(...n.map(g=>g[1]))]}function gK(t,e){if(!t||!t.length)return null;if(Array.isArray(t)){const s=Math.abs(e.x+e.y)%t.length;t=t[s]}const{x:n,y:i,z:g}=e;return t.replace(/\{x\}/g,n).replace(/\{y\}/g,i).replace(/\{z\}/g,g).replace(/\{-y\}/g,Math.pow(2,g)-i-1)}function sK(t,e,n){let i;if(e&&e.length===2){const[g,s]=e,o=t.getBounds({z:g}),r=t.getBounds({z:s});i=[Math.min(o[0],r[0]),Math.min(o[1],r[1]),Math.max(o[2],r[2]),Math.max(o[3],r[3])]}else i=t.getBounds();return t.isGeospatial?[Math.max(i[0],n[0]),Math.max(i[1],n[1]),Math.min(i[2],n[2]),Math.min(i[3],n[3])]:[Math.max(Math.min(i[0],n[2]),n[0]),Math.max(Math.min(i[1],n[3]),n[1]),Math.min(Math.max(i[2],n[0]),n[2]),Math.min(Math.max(i[3],n[1]),n[3])]}function oK(t,e,n){return n?n2(t,n).map(g=>g*e/Ui):t.map(i=>i*e/Ui)}function bh(t,e){return Math.pow(2,t)*Ui/e}function yh(t,e,n){const i=bh(n,Ui),g=t/i*360-180,s=Math.PI-2*Math.PI*e/i,o=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[g,o]}function i2(t,e,n,i){const g=bh(n,i);return[t/g*Ui,e/g*Ui]}function rK(t,e,n,i){let g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Ui;if(t.isGeospatial){const[a,l]=yh(e,n,i),[C,c]=yh(e+1,n+1,i);return{west:a,north:l,east:C,south:c}}const[s,o]=i2(e,n,i,g),[r,I]=i2(e+1,n+1,i,g);return{left:s,top:o,right:r,bottom:I}}function IK(t,e,n,i,g){const s=sK(t,null,i),o=bh(e,n),[r,I,a,l]=oK(s,o,g),C=[];for(let c=Math.floor(r);c<a;c++)for(let A=Math.floor(I);A<l;A++)C.push({x:c,y:A,z:e});return C}function aK(t){let{viewport:e,maxZoom:n,minZoom:i,zRange:g,extent:s,tileSize:o=Ui,modelMatrix:r,modelMatrixInverse:I,zoomOffset:a=0}=t,l=e.isGeospatial?Math.round(e.zoom+Math.log2(Ui/o))+a:Math.ceil(e.zoom)+a;if(Number.isFinite(i)&&l<i){if(!s)return[];l=i}Number.isFinite(n)&&l>n&&(l=n);let C=s;return r&&I&&s&&!e.isGeospatial&&(C=n2(s,r)),e.isGeospatial?tK(e,l,g,s):IK(e,l,o,C||nK,I)}const lK=0,g2=1,s2=3,CK=4,o2=5,cK="never",vh="best-available",AK=5;class dK{constructor(e){this.opts=e,this.onTileLoad=n=>{this.opts.onTileLoad(n),this.opts.maxCacheByteSize&&(this._cacheByteSize+=n.byteLength,this._resizeCache())},this._requestScheduler=new q9({maxRequests:e.maxRequests,throttleRequests:e.maxRequests>0}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Pe,this._modelMatrixInverse=new Pe,this.setOptions(e)}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const n=this._cache.get(e);this._selectedTiles.includes(n)?n.setNeedsReload():this._cache.delete(e)}}update(e){let{zRange:n,modelMatrix:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const g=new Pe(i),s=!g.equals(this._modelMatrix);if(!e.equals(this._viewport)||s){s&&(this._modelMatrixInverse=g.clone().invert(),this._modelMatrix=g),this._viewport=e;const r=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:n,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=r.map(I=>this._getTile(I,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(r=>this._getTile({x:r.x,y:r.y,z:r.z})));const o=this.updateTileStates();return this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}getTileIndices(e){let{viewport:n,maxZoom:i,minZoom:g,zRange:s,modelMatrix:o,modelMatrixInverse:r}=e;const{tileSize:I,extent:a,zoomOffset:l}=this.opts;return aK({viewport:n,maxZoom:i,minZoom:g,zRange:s,tileSize:I,extent:a,modelMatrix:o,modelMatrixInverse:r,zoomOffset:l})}getTileMetadata(e){let{x:n,y:i,z:g}=e;const{tileSize:s}=this.opts;return{bbox:rK(this._viewport,n,i,g,s)}}getParentIndex(e){return e.x=Math.floor(e.x/2),e.y=Math.floor(e.y/2),e.z-=1,e}updateTileStates(){this._updateTileStates(this.selectedTiles);const{maxRequests:e}=this.opts,n=[];let i=0,g=!1;for(const s of this._cache.values()){const o=Boolean(s.state&g2);s.isVisible!==o&&(g=!0,s.isVisible=o),s.isSelected=s.state===o2,s.isLoading&&(i++,s.isSelected||n.push(s))}if(e>0)for(;i>e&&n.length>0;)n.shift().abort(),i--;return g}_rebuildTree(){const{_cache:e}=this;for(const n of e.values())n.parent=null,n.children.length=0;for(const n of e.values()){const i=this._getNearestAncestor(n.x,n.y,n.z);n.parent=i,i&&i.children.push(n)}}_updateTileStates(e){const{_cache:n}=this,i=this.opts.refinementStrategy||vh;for(const g of n.values())g.state=lK;for(const g of e)g.state=o2;if(i!==cK){for(const g of e)hK(g,i);for(const g of e)uK(g)&&r2(g)}}_resizeCache(){const{_cache:e,opts:n}=this,i=n.maxCacheSize||(n.maxCacheByteSize?1/0:AK*this.selectedTiles.length),g=n.maxCacheByteSize||1/0;if(e.size>i||this._cacheByteSize>g){for(const[o,r]of e)if(r.isVisible||(this._cacheByteSize-=n.maxCacheByteSize?r.byteLength:0,e.delete(o),this.opts.onTileUnload(r)),e.size<=i&&this._cacheByteSize<=g)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((o,r)=>o.z-r.z),this._dirty=!1)}_getTile(e,n){let{x:i,y:g,z:s}=e;const o="".concat(i,",").concat(g,",").concat(s);let r=this._cache.get(o),I=!1;return!r&&n?(r=new wk({x:i,y:g,z:s}),Object.assign(r,this.getTileMetadata(r)),I=!0,this._cache.set(o,r),this._dirty=!0):r&&r.needsReload&&(I=!0),I&&r.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),r}_getNearestAncestor(e,n,i){const{_minZoom:g=0}=this;let s={x:e,y:n,z:i};for(;s.z>g;){s=this.getParentIndex(s);const o=this._getTile(s);if(o)return o}return null}}function uK(t){let e=t;for(;e;){if(e.state&g2===0)return!0;if(e.isLoaded)return!1;e=e.parent}return!0}function hK(t,e){let n,i=s2;for(;n=t.parent;){if(t.isLoaded&&(i=CK,e===vh))return;n.state=Math.max(n.state,i),t=n}}function r2(t){for(const e of t.children)e.state=Math.max(e.state,s2),e.isLoaded||r2(e)}const mK={data:[],dataComparator:iK.equals,renderSubLayers:{type:"function",value:t=>new uh(t),compare:!1},getTileData:{type:"function",optional:!0,value:null,compare:!1},onViewportLoad:{type:"function",optional:!0,value:null,compare:!1},onTileLoad:{type:"function",value:t=>{},compare:!1},onTileUnload:{type:"function",value:t=>{},compare:!1},onTileError:{type:"function",value:t=>console.error(t),compare:!1},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:vh,zRange:null,maxRequests:6,zoomOffset:0};class Gh extends kn{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e;(e=this.state.tileset)===null||e===void 0||e.finalize()}get isLoaded(){const{tileset:e}=this.state;return e.selectedTiles.every(n=>n.isLoaded&&n.layers&&n.layers.every(i=>i.isLoaded))}shouldUpdateState(e){let{changeFlags:n}=e;return n.somethingChanged}updateState(e){let{props:n,changeFlags:i}=e,{tileset:g}=this.state;const s=i.propsOrDataChanged||i.updateTriggersChanged,o=i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getTileData);g?s&&(g.setOptions(this._getTilesetOptions(n)),o?g.reloadAll():this.state.tileset.tiles.forEach(r=>{r.layers=null})):(g=new dK(this._getTilesetOptions(n)),this.setState({tileset:g})),this._updateTileset()}_getTilesetOptions(e){const{tileSize:n,maxCacheSize:i,maxCacheByteSize:g,refinementStrategy:s,extent:o,maxZoom:r,minZoom:I,maxRequests:a,zoomOffset:l}=e;return{maxCacheSize:i,maxCacheByteSize:g,maxZoom:r,minZoom:I,tileSize:n,refinementStrategy:s,extent:o,maxRequests:a,zoomOffset:l,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const{tileset:e}=this.state,{zRange:n,modelMatrix:i}=this.props,g=e.update(this.context.viewport,{zRange:n,modelMatrix:i}),{isLoaded:s}=e,o=this.state.isLoaded!==s,r=this.state.frameNumber!==g;s&&(o||r)&&this._onViewportLoad(),r&&this.setState({frameNumber:g}),this.state.isLoaded=s}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:n}=this.props;n&&n(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,e.isVisible&&this.setNeedsUpdate()}_onTileError(e,n){this.props.onTileError(e),n.layers=null,n.isVisible&&this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:n,getTileData:i,fetch:g}=this.props,{signal:s}=e;return e.url=gK(n,e),i?i(e):e.url?g(e.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){let{info:n,sourceLayer:i}=e;return n.tile=i.props.tile,n}_updateAutoHighlight(e){e.sourceLayer&&e.sourceLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const n=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)n&&e.layers[0]&&Object.keys(n).some(i=>e.layers[0].props[i]!==n[i])&&(e.layers=e.layers.map(i=>i.clone(n)));else{const i=this.renderSubLayers(J(S({},this.props),{id:"".concat(this.id,"-").concat(e.x,"-").concat(e.y,"-").concat(e.z),data:e.content,_offset:0,tile:e}));e.layers=pC(i,Boolean).map(g=>g.clone(S({tile:e},n)))}return e.layers})}filterSubLayer(e){let{layer:n}=e;return n.props.tile.isVisible}}Gh.layerName="TileLayer";Gh.defaultProps=mK;const fK=typeof window!="undefined"?G.exports.useLayoutEffect:G.exports.useEffect;var pK=fK;function ec(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}function Zh(t){return t&&(typeof t=="function"?G.exports.createElement(Is,{},t):Array.isArray(t)?t.map(Zh):t.type===we.Fragment?Zh(t.props.children):(ec(t.type,Is),t))}function BK(t){let{children:e,layers:n,views:i}=t;const g=[],s=[],o={};return we.Children.forEach(Zh(e),r=>{if(r){const I=r.type;if(ec(I,An)){const a=bK(I,r.props);s.push(a)}else g.push(r);if(I!==Is&&ec(I,Is)&&r.props.id){const a=new I(r.props);o[a.id]=a}}}),Object.keys(o).length>0&&(Array.isArray(i)?i.forEach(r=>{o[r.id]=r}):i&&(o[i.id]=i),i=Object.values(o)),n=s.length>0?[...s,...n]:n,{layers:n,children:g,views:i}}function bK(t,e){const n={},i=t.defaultProps||{};for(const g in e)i[g]!==e[g]&&(n[g]=e[g]);return new t(n)}const yK={position:"absolute",zIndex:-1};function I2(t,e){return t&&(typeof t=="function"?t(e):Array.isArray(t)?t.map(n=>I2(n,e)):vK(t)?(e.style=yK,G.exports.cloneElement(t,e)):GK(t)?G.exports.cloneElement(t,e):t)}function vK(t){const e=t&&t.type,n=e&&e.defaultProps;return n&&n.mapStyle}function GK(t){const e=t&&t.type;return e&&e.deckGLViewProps}function ZK(t){let{children:e,deck:n,ContextProvider:i}=t;const{viewManager:g}=n||{};if(!g||!g.views.length)return[];const s={},o=g.views[0].id;for(const r of e){let I=o,a=r;ec(r.type,Is)&&(I=r.props.id||o,a=r.props.children);const l=g.getViewport(I),C=g.getViewState(I);if(l){const{x:c,y:A,width:d,height:m}=l;a=I2(a,{x:c,y:A,width:d,height:m,viewport:l,viewState:C}),s[I]||(s[I]={viewport:l,children:[]}),s[I].children.push(a)}}return Object.keys(s).map(r=>{const{viewport:I,children:a}=s[r],{x:l,y:C,width:c,height:A}=I,d={position:"absolute",left:l,top:C,width:c,height:A},m="view-".concat(r),u=G.exports.createElement("div",{key:m,id:m,style:d},...a);if(i){const h={viewport:I,container:n.canvas.offsetParent,eventManager:n.eventManager,onViewStateChange:f=>{f.viewId=r,n._onViewStateChange(f)}};return G.exports.createElement(i,{key:m,value:h},u)}return u})}const RK={mixBlendMode:null};function FK(t){let{width:e,height:n,style:i}=t;const g={position:"absolute",zIndex:0,left:0,top:0,width:e,height:n},s={left:0,top:0};if(i)for(const o in i)o in RK?s[o]=i[o]:g[o]=i[o];return{containerStyle:g,canvasStyle:s}}function SK(t){const e={pickObject:n=>t.deck.pickObject(n),pickMultipleObjects:n=>t.deck.pickMultipleObjects(n),pickObjects:n=>t.deck.pickObjects(n)};return Object.defineProperty(e,"deck",{get:()=>t.deck}),e}function a2(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function VK(t,e){const n=e.Deck||xo,i=new n(J(S({},e),{style:null,width:"100%",height:"100%",_customRender:g=>{t.redrawReason=g;const s=i.viewManager.getViewports();t.lastRenderedViewports!==s?t.forceUpdate(o=>o+1):a2(t)}}));return i}const Rh=G.exports.forwardRef((t,e)=>{const i=G.exports.useRef({}).current,[g,s]=G.exports.useState(0);i.forceUpdate=s;const o=G.exports.useRef(null),r=G.exports.useRef(null),I=G.exports.useMemo(()=>BK(t),[t.layers,t.views,t.children]);let a=!0;const l=v=>a&&t.viewState?(i.viewStateUpdateRequested=v,null):(i.viewStateUpdateRequested=null,t.onViewStateChange(v)),C=v=>{a?i.interactionStateUpdateRequested=v:(i.interactionStateUpdateRequested=null,t.onInteractionStateChange(v))},c=G.exports.useMemo(()=>{const v=J(S({},t),{style:null,width:"100%",height:"100%",layers:I.layers,views:I.views,onViewStateChange:l,onInteractionStateChange:C});return i.deck&&i.deck.setProps(v),v},[t]);G.exports.useEffect(()=>(i.deck=VK(i,J(S({},c),{parent:o.current,canvas:r.current})),()=>i.deck.finalize()),[]),pK(()=>{a2(i);const{viewStateUpdateRequested:v,interactionStateUpdateRequested:N}=i;v&&l(v),N&&C(N)}),G.exports.useImperativeHandle(e,()=>SK(i),[]);const{viewManager:A}=i.deck||{},d=A&&A.getViewports(),{ContextProvider:m,width:u,height:h,id:f,style:p}=t,{containerStyle:b,canvasStyle:Z}=G.exports.useMemo(()=>FK({width:u,height:h,style:p}),[u,h,p]);if(!i.viewStateUpdateRequested&&i.lastRenderedViewports===d||i.version!==g){i.lastRenderedViewports=d,i.version=g;const v=ZK({children:I.children,deck:i.deck,ContextProvider:m}),N=G.exports.createElement("canvas",{key:"canvas",id:f||"deckgl-overlay",ref:r,style:Z});i.control=G.exports.createElement("div",{id:"".concat(f||"deckgl","-wrapper"),ref:o,style:b},[N,v])}return a=!1,i.control});Rh.propTypes=xo.getPropTypes(wV);Rh.defaultProps=xo.defaultProps;var KD=Rh,UK={},l2={},oi={};(function(t){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",i="["+e+"]["+n+"]*",g=new RegExp("^"+i+"$"),s=function(r,I){const a=[];let l=I.exec(r);for(;l;){const C=[];C.startIndex=I.lastIndex-l[0].length;const c=l.length;for(let A=0;A<c;A++)C.push(l[A]);a.push(C),l=I.exec(r)}return a},o=function(r){const I=g.exec(r);return!(I===null||typeof I=="undefined")};t.isExist=function(r){return typeof r!="undefined"},t.isEmptyObject=function(r){return Object.keys(r).length===0},t.merge=function(r,I,a){if(I){const l=Object.keys(I),C=l.length;for(let c=0;c<C;c++)a==="strict"?r[l[c]]=[I[l[c]]]:r[l[c]]=I[l[c]]}},t.getValue=function(r){return t.isExist(r)?r:""},t.buildOptions=function(r,I,a){let l={};if(!r)return I;for(let C=0;C<a.length;C++)r[a[C]]!==void 0?l[a[C]]=r[a[C]]:l[a[C]]=I[a[C]];return l},t.isTagNameInArrayMode=function(r,I,a){return I===!1?!1:I instanceof RegExp?I.test(r):typeof I=="function"?!!I(r,a):I==="strict"},t.isName=o,t.getAllMatches=s,t.nameRegexp=i})(oi);const Cs=oi,Fh=function(t,e,n){const i={};if(!e.alwaysCreateTextNode&&(!t.child||Cs.isEmptyObject(t.child))&&(!t.attrsMap||Cs.isEmptyObject(t.attrsMap)))return Cs.isExist(t.val)?t.val:"";if(Cs.isExist(t.val)&&!(typeof t.val=="string"&&(t.val===""||t.val===e.cdataPositionChar))){const s=Cs.isTagNameInArrayMode(t.tagname,e.arrayMode,n);i[e.textNodeName]=s?[t.val]:t.val}Cs.merge(i,t.attrsMap,e.arrayMode);const g=Object.keys(t.child);for(let s=0;s<g.length;s++){const o=g[s];if(t.child[o]&&t.child[o].length>1){i[o]=[];for(let r in t.child[o])t.child[o].hasOwnProperty(r)&&i[o].push(Fh(t.child[o][r],e,o))}else{const r=Fh(t.child[o][0],e,o),I=e.arrayMode===!0&&typeof r=="object"||Cs.isTagNameInArrayMode(o,e.arrayMode,n);i[o]=I?[r]:r}}return i};l2.convertToJson=Fh;var cs={},xK=function(t,e,n){this.tagname=t,this.parent=e,this.child={},this.attrsMap={},this.val=n,this.addChild=function(i){Array.isArray(this.child[i.tagname])?this.child[i.tagname].push(i):this.child[i.tagname]=[i]}};const WK=/^[-+]?0x[a-fA-F0-9]+$/,NK=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const wK={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function TK(t,e={}){if(e=Object.assign({},wK,e),!t||typeof t!="string")return t;let n=t.trim();if(e.skipLike!==void 0&&e.skipLike.test(n))return t;if(e.hex&&WK.test(n))return Number.parseInt(n,16);{const i=NK.exec(n);if(i){const g=i[1],s=i[2];let o=EK(i[3]);const r=i[4]||i[6];if(!e.leadingZeros&&s.length>0&&g&&n[2]!==".")return t;if(!e.leadingZeros&&s.length>0&&!g&&n[1]!==".")return t;{const I=Number(n),a=""+I;return a.search(/[eE]/)!==-1||r?e.eNotation?I:t:n.indexOf(".")!==-1?a==="0"&&o===""||a===o||g&&a==="-"+o?I:t:s?o===a||g+o===a?I:t:n===a||n===g+a?I:t}}else return t}}function EK(t){return t&&t.indexOf(".")!==-1&&(t=t.replace(/0+$/,""),t==="."?t="0":t[0]==="."?t="0"+t:t[t.length-1]==="."&&(t=t.substr(0,t.length-1))),t}var QK=TK;const As=oi,XK=oi.buildOptions,tc=xK,YK=QK;"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,As.nameRegexp);!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const C2={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,ignoreNameSpace:!1,allowBooleanAttributes:!1,parseNodeValue:!0,parseAttributeValue:!1,arrayMode:!1,trimValues:!0,cdataTagName:!1,cdataPositionChar:"\\c",numParseOptions:{hex:!0,leadingZeros:!0},tagValueProcessor:function(t,e){return t},attrValueProcessor:function(t,e){return t},stopNodes:[],alwaysCreateTextNode:!1};cs.defaultOptions=C2;const c2=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","ignoreNameSpace","allowBooleanAttributes","parseNodeValue","parseAttributeValue","arrayMode","trimValues","cdataTagName","cdataPositionChar","tagValueProcessor","attrValueProcessor","parseTrueNumberOnly","numParseOptions","stopNodes","alwaysCreateTextNode"];cs.props=c2;function nc(t,e,n){return e&&(n.trimValues&&(e=e.trim()),e=n.tagValueProcessor(e,t),e=A2(e,n.parseNodeValue,n.numParseOptions)),e}function _K(t,e){if(e.ignoreNameSpace){const n=t.split(":"),i=t.charAt(0)==="/"?"/":"";if(n[0]==="xmlns")return"";n.length===2&&(t=i+n[1])}return t}function A2(t,e,n){if(e&&typeof t=="string"){const i=t.trim();return i==="true"?!0:i==="false"?!1:YK(t,n)}else return As.isExist(t)?t:""}const HK=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])(.*?)\\3)?`,"g");function d2(t,e){if(!e.ignoreAttributes&&typeof t=="string"){t=t.replace(/\r?\n/g," ");const n=As.getAllMatches(t,HK),i=n.length,g={};for(let s=0;s<i;s++){const o=_K(n[s][1],e);o.length&&(n[s][4]!==void 0?(e.trimValues&&(n[s][4]=n[s][4].trim()),n[s][4]=e.attrValueProcessor(n[s][4],o),g[e.attributeNamePrefix+o]=A2(n[s][4],e.parseAttributeValue,e.numParseOptions)):e.allowBooleanAttributes&&(g[e.attributeNamePrefix+o]=!0))}if(!Object.keys(g).length)return;if(e.attrNodeName){const s={};return s[e.attrNodeName]=g,s}return g}}const kK=function(t,e){t=t.replace(/\r\n?/g,`
`),e=XK(e,C2,c2);const n=new tc("!xml");let i=n,g="";for(let s=0;s<t.length;s++)if(t[s]==="<")if(t[s+1]==="/"){const r=OI(t,">",s,"Closing Tag is not closed.");let I=t.substring(s+2,r).trim();if(e.ignoreNameSpace){const a=I.indexOf(":");a!==-1&&(I=I.substr(a+1))}i&&(i.val?i.val=As.getValue(i.val)+""+nc(I,g,e):i.val=nc(I,g,e)),e.stopNodes.length&&e.stopNodes.includes(i.tagname)&&(i.child=[],i.attrsMap==null&&(i.attrsMap={}),i.val=t.substr(i.startIndex+1,s-i.startIndex-1)),i=i.parent,g="",s=r}else if(t[s+1]==="?")s=OI(t,"?>",s,"Pi Tag is not closed.");else if(t.substr(s+1,3)==="!--")s=OI(t,"-->",s,"Comment is not closed.");else if(t.substr(s+1,2)==="!D"){const r=OI(t,">",s,"DOCTYPE is not closed.");t.substring(s,r).indexOf("[")>=0?s=t.indexOf("]>",s)+1:s=r}else if(t.substr(s+1,2)==="!["){const r=OI(t,"]]>",s,"CDATA is not closed.")-2,I=t.substring(s+9,r);if(g&&(i.val=As.getValue(i.val)+""+nc(i.tagname,g,e),g=""),e.cdataTagName){const a=new tc(e.cdataTagName,i,I);i.addChild(a),i.val=As.getValue(i.val)+e.cdataPositionChar,I&&(a.val=I)}else i.val=(i.val||"")+(I||"");s=r+2}else{const r=KK(t,s+1);let I=r.data;const a=r.index,l=I.indexOf(" ");let C=I,c=!0;if(l!==-1&&(C=I.substr(0,l).replace(/\s\s*$/,""),I=I.substr(l+1)),e.ignoreNameSpace){const A=C.indexOf(":");A!==-1&&(C=C.substr(A+1),c=C!==r.data.substr(A+1))}if(i&&g&&i.tagname!=="!xml"&&(i.val=As.getValue(i.val)+""+nc(i.tagname,g,e)),I.length>0&&I.lastIndexOf("/")===I.length-1){C[C.length-1]==="/"?(C=C.substr(0,C.length-1),I=C):I=I.substr(0,I.length-1);const A=new tc(C,i,"");C!==I&&(A.attrsMap=d2(I,e)),i.addChild(A)}else{const A=new tc(C,i);e.stopNodes.length&&e.stopNodes.includes(A.tagname)&&(A.startIndex=a),C!==I&&c&&(A.attrsMap=d2(I,e)),i.addChild(A),i=A}g="",s=a}else g+=t[s];return n};function KK(t,e){let n,i="";for(let g=e;g<t.length;g++){let s=t[g];if(n)s===n&&(n="");else if(s==='"'||s==="'")n=s;else{if(s===">")return{data:i,index:g};s==="	"&&(s=" ")}i+=s}}function OI(t,e,n,i){const g=t.indexOf(e,n);if(g===-1)throw new Error(i);return g+e.length-1}cs.getTraversalObj=kK;var u2={};const ic=oi,LK={allowBooleanAttributes:!1},MK=["allowBooleanAttributes"];u2.validate=function(t,e){e=ic.buildOptions(e,LK,MK);const n=[];let i=!1,g=!1;t[0]==="\uFEFF"&&(t=t.substr(1));for(let s=0;s<t.length;s++)if(t[s]==="<"&&t[s+1]==="?"){if(s+=2,s=h2(t,s),s.err)return s}else if(t[s]==="<"){let o=s;if(s++,t[s]==="!"){s=m2(t,s);continue}else{let r=!1;t[s]==="/"&&(r=!0,s++);let I="";for(;s<t.length&&t[s]!==">"&&t[s]!==" "&&t[s]!=="	"&&t[s]!==`
`&&t[s]!=="\r";s++)I+=t[s];if(I=I.trim(),I[I.length-1]==="/"&&(I=I.substring(0,I.length-1),s--),!$K(I)){let C;return I.trim().length===0?C="Invalid space after '<'.":C="Tag '"+I+"' is an invalid name.",pt("InvalidTag",C,dn(t,s))}const a=DK(t,s);if(a===!1)return pt("InvalidAttr","Attributes for '"+I+"' have open quote.",dn(t,s));let l=a.value;if(s=a.index,l[l.length-1]==="/"){const C=s-l.length;l=l.substring(0,l.length-1);const c=f2(l,e);if(c===!0)i=!0;else return pt(c.err.code,c.err.msg,dn(t,C+c.err.line))}else if(r)if(a.tagClosed){if(l.trim().length>0)return pt("InvalidTag","Closing tag '"+I+"' can't have attributes or invalid starting.",dn(t,o));{const C=n.pop();if(I!==C.tagName){let c=dn(t,C.tagStartPos);return pt("InvalidTag","Expected closing tag '"+C.tagName+"' (opened in line "+c.line+", col "+c.col+") instead of closing tag '"+I+"'.",dn(t,o))}n.length==0&&(g=!0)}}else return pt("InvalidTag","Closing tag '"+I+"' doesn't have proper closing.",dn(t,s));else{const C=f2(l,e);if(C!==!0)return pt(C.err.code,C.err.msg,dn(t,s-l.length+C.err.line));if(g===!0)return pt("InvalidXml","Multiple possible root nodes found.",dn(t,s));n.push({tagName:I,tagStartPos:o}),i=!0}for(s++;s<t.length;s++)if(t[s]==="<")if(t[s+1]==="!"){s++,s=m2(t,s);continue}else if(t[s+1]==="?"){if(s=h2(t,++s),s.err)return s}else break;else if(t[s]==="&"){const C=jK(t,s);if(C==-1)return pt("InvalidChar","char '&' is not expected.",dn(t,s));s=C}t[s]==="<"&&s--}}else{if(t[s]===" "||t[s]==="	"||t[s]===`
`||t[s]==="\r")continue;return pt("InvalidChar","char '"+t[s]+"' is not expected.",dn(t,s))}if(i){if(n.length==1)return pt("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",dn(t,n[0].tagStartPos));if(n.length>0)return pt("InvalidXml","Invalid '"+JSON.stringify(n.map(s=>s.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return pt("InvalidXml","Start tag expected.",1);return!0};function h2(t,e){const n=e;for(;e<t.length;e++)if(t[e]=="?"||t[e]==" "){const i=t.substr(n,e-n);if(e>5&&i==="xml")return pt("InvalidXml","XML declaration allowed only at the start of the document.",dn(t,e));if(t[e]=="?"&&t[e+1]==">"){e++;break}else continue}return e}function m2(t,e){if(t.length>e+5&&t[e+1]==="-"&&t[e+2]==="-"){for(e+=3;e<t.length;e++)if(t[e]==="-"&&t[e+1]==="-"&&t[e+2]===">"){e+=2;break}}else if(t.length>e+8&&t[e+1]==="D"&&t[e+2]==="O"&&t[e+3]==="C"&&t[e+4]==="T"&&t[e+5]==="Y"&&t[e+6]==="P"&&t[e+7]==="E"){let n=1;for(e+=8;e<t.length;e++)if(t[e]==="<")n++;else if(t[e]===">"&&(n--,n===0))break}else if(t.length>e+9&&t[e+1]==="["&&t[e+2]==="C"&&t[e+3]==="D"&&t[e+4]==="A"&&t[e+5]==="T"&&t[e+6]==="A"&&t[e+7]==="["){for(e+=8;e<t.length;e++)if(t[e]==="]"&&t[e+1]==="]"&&t[e+2]===">"){e+=2;break}}return e}const PK='"',JK="'";function DK(t,e){let n="",i="",g=!1;for(;e<t.length;e++){if(t[e]===PK||t[e]===JK)i===""?i=t[e]:i!==t[e]||(i="");else if(t[e]===">"&&i===""){g=!0;break}n+=t[e]}return i!==""?!1:{value:n,index:e,tagClosed:g}}const zK=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function f2(t,e){const n=ic.getAllMatches(t,zK),i={};for(let g=0;g<n.length;g++){if(n[g][1].length===0)return pt("InvalidAttr","Attribute '"+n[g][2]+"' has no space in starting.",gc(n[g]));if(n[g][3]===void 0&&!e.allowBooleanAttributes)return pt("InvalidAttr","boolean attribute '"+n[g][2]+"' is not allowed.",gc(n[g]));const s=n[g][2];if(!qK(s))return pt("InvalidAttr","Attribute '"+s+"' is an invalid name.",gc(n[g]));if(!i.hasOwnProperty(s))i[s]=1;else return pt("InvalidAttr","Attribute '"+s+"' is repeated.",gc(n[g]))}return!0}function OK(t,e){let n=/\d/;for(t[e]==="x"&&(e++,n=/[\da-fA-F]/);e<t.length;e++){if(t[e]===";")return e;if(!t[e].match(n))break}return-1}function jK(t,e){if(e++,t[e]===";")return-1;if(t[e]==="#")return e++,OK(t,e);let n=0;for(;e<t.length;e++,n++)if(!(t[e].match(/\w/)&&n<20)){if(t[e]===";")break;return-1}return e}function pt(t,e,n){return{err:{code:t,msg:e,line:n.line||n,col:n.col}}}function qK(t){return ic.isName(t)}function $K(t){return ic.isName(t)}function dn(t,e){const n=t.substring(0,e).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function gc(t){return t.startIndex+t[1].length}var p2={};const ri=function(t){return String.fromCharCode(t)},It={nilChar:ri(176),missingChar:ri(201),nilPremitive:ri(175),missingPremitive:ri(200),emptyChar:ri(178),emptyValue:ri(177),boundryChar:ri(179),objStart:ri(198),arrStart:ri(204),arrayEnd:ri(185)},eL=[It.nilChar,It.nilPremitive,It.missingChar,It.missingPremitive,It.boundryChar,It.emptyChar,It.emptyValue,It.arrayEnd,It.objStart,It.arrStart],jI=function(t,e,n){if(typeof e=="string")return t&&t[0]&&t[0].val!==void 0?Sh(t[0].val):Sh(t);{const i=tL(t);if(i===!0){let g="";if(Array.isArray(e)){g+=It.arrStart;const s=e[0],o=t.length;if(typeof s=="string")for(let r=0;r<o;r++){const I=Sh(t[r].val);g=Vh(g,I)}else for(let r=0;r<o;r++){const I=jI(t[r],s,n);g=Vh(g,I)}g+=It.arrayEnd}else{g+=It.objStart;const s=Object.keys(e);Array.isArray(t)&&(t=t[0]);for(let o in s){const r=s[o];let I;!n.ignoreAttributes&&t.attrsMap&&t.attrsMap[r]?I=jI(t.attrsMap[r],e[r],n):r===n.textNodeName?I=jI(t.val,e[r],n):I=jI(t.child[r],e[r],n),g=Vh(g,I)}}return g}else return i}},Sh=function(t){switch(t){case void 0:return It.missingPremitive;case null:return It.nilPremitive;case"":return It.emptyValue;default:return t}},Vh=function(t,e){return!B2(e[0])&&!B2(t[t.length-1])&&(t+=It.boundryChar),t+e},B2=function(t){return eL.indexOf(t)!==-1};function tL(t){return t===void 0?It.missingChar:t===null?It.nilChar:t.child&&Object.keys(t.child).length===0&&(!t.attrsMap||Object.keys(t.attrsMap).length===0)?It.emptyChar:!0}const b2=cs,nL=oi.buildOptions,iL=function(t,e,n){return n=nL(n,b2.defaultOptions,b2.props),jI(t,e,n)};p2.convert2nimn=iL;var y2={};const sc=oi,gL=oi.buildOptions,v2=cs,sL=function(t,e){return e=gL(e,v2.defaultOptions,v2.props),e.indentBy=e.indentBy||"",Uh(t,e)},Uh=function(t,e,n){let i="{";const g=Object.keys(t.child);for(let s=0;s<g.length;s++){const o=g[s];if(t.child[o]&&t.child[o].length>1){i+='"'+o+'" : [ ';for(let r in t.child[o])i+=Uh(t.child[o][r],e)+" , ";i=i.substr(0,i.length-1)+" ] "}else i+='"'+o+'" : '+Uh(t.child[o][0],e)+" ,"}return sc.merge(i,t.attrsMap),sc.isEmptyObject(i)?sc.isExist(t.val)?t.val:"":(sc.isExist(t.val)&&(typeof t.val=="string"&&(t.val===""||t.val===e.cdataPositionChar)||(i+='"'+e.textNodeName+'" : '+oL(t.val))),i[i.length-1]===","&&(i=i.substr(0,i.length-2)),i+"}")};function oL(t){return t===!0||t===!1||!isNaN(t)?t:'"'+t+'"'}y2.convertToJsonString=sL;const rL=oi.buildOptions,IL={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataTagName:!1,cdataPositionChar:"\\c",format:!1,indentBy:"  ",supressEmptyNode:!1,tagValueProcessor:function(t){return t},attrValueProcessor:function(t){return t}},aL=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","cdataTagName","cdataPositionChar","format","indentBy","supressEmptyNode","tagValueProcessor","attrValueProcessor","rootNodeName"];function xh(t){this.options=rL(t,IL,aL),this.options.ignoreAttributes||this.options.attrNodeName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=hL),this.options.cdataTagName?this.isCDATA=mL:this.isCDATA=function(){return!1},this.replaceCDATAstr=CL,this.replaceCDATAarr=cL,this.processTextOrObjNode=lL,this.options.format?(this.indentate=uL,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.supressEmptyNode?(this.buildTextNode=dL,this.buildObjNode=AL):(this.buildTextNode=Z2,this.buildObjNode=G2),this.buildTextValNode=Z2,this.buildObjectNode=G2}xh.prototype.parse=function(t){return Array.isArray(t)&&this.options.rootNodeName&&this.options.rootNodeName.length>1&&(t={[this.options.rootNodeName]:t}),this.j2x(t,0).val};xh.prototype.j2x=function(t,e){let n="",i="";for(let g in t)if(typeof t[g]!="undefined")if(t[g]===null)i+=this.indentate(e)+"<"+g+"/"+this.tagEndChar;else if(t[g]instanceof Date)i+=this.buildTextNode(t[g],g,"",e);else if(typeof t[g]!="object"){const s=this.isAttribute(g);s?n+=" "+s+'="'+this.options.attrValueProcessor(""+t[g])+'"':this.isCDATA(g)?t[this.options.textNodeName]?i+=this.replaceCDATAstr(t[this.options.textNodeName],t[g]):i+=this.replaceCDATAstr("",t[g]):g===this.options.textNodeName?t[this.options.cdataTagName]||(i+=this.options.tagValueProcessor(""+t[g])):i+=this.buildTextNode(t[g],g,"",e)}else if(Array.isArray(t[g]))if(this.isCDATA(g))i+=this.indentate(e),t[this.options.textNodeName]?i+=this.replaceCDATAarr(t[this.options.textNodeName],t[g]):i+=this.replaceCDATAarr("",t[g]);else{const s=t[g].length;for(let o=0;o<s;o++){const r=t[g][o];typeof r=="undefined"||(r===null?i+=this.indentate(e)+"<"+g+"/"+this.tagEndChar:typeof r=="object"?i+=this.processTextOrObjNode(r,g,e):i+=this.buildTextNode(r,g,"",e))}}else if(this.options.attrNodeName&&g===this.options.attrNodeName){const s=Object.keys(t[g]),o=s.length;for(let r=0;r<o;r++)n+=" "+s[r]+'="'+this.options.attrValueProcessor(""+t[g][s[r]])+'"'}else i+=this.processTextOrObjNode(t[g],g,e);return{attrStr:n,val:i}};function lL(t,e,n){const i=this.j2x(t,n+1);return t[this.options.textNodeName]!==void 0&&Object.keys(t).length===1?this.buildTextNode(i.val,e,i.attrStr,n):this.buildObjNode(i.val,e,i.attrStr,n)}function CL(t,e){return t=this.options.tagValueProcessor(""+t),this.options.cdataPositionChar===""||t===""?t+"<![CDATA["+e+"]]"+this.tagEndChar:t.replace(this.options.cdataPositionChar,"<![CDATA["+e+"]]"+this.tagEndChar)}function cL(t,e){if(t=this.options.tagValueProcessor(""+t),this.options.cdataPositionChar===""||t==="")return t+"<![CDATA["+e.join("]]><![CDATA[")+"]]"+this.tagEndChar;for(let n in e)t=t.replace(this.options.cdataPositionChar,"<![CDATA["+e[n]+"]]>");return t+this.newLine}function G2(t,e,n,i){return n&&t.indexOf("<")===-1?this.indentate(i)+"<"+e+n+">"+t+"</"+e+this.tagEndChar:this.indentate(i)+"<"+e+n+this.tagEndChar+t+this.indentate(i)+"</"+e+this.tagEndChar}function AL(t,e,n,i){return t!==""?this.buildObjectNode(t,e,n,i):this.indentate(i)+"<"+e+n+"/"+this.tagEndChar}function Z2(t,e,n,i){return this.indentate(i)+"<"+e+n+">"+this.options.tagValueProcessor(t)+"</"+e+this.tagEndChar}function dL(t,e,n,i){return t!==""?this.buildTextValNode(t,e,n,i):this.indentate(i)+"<"+e+n+"/"+this.tagEndChar}function uL(t){return this.options.indentBy.repeat(t)}function hL(t){return t.startsWith(this.options.attributeNamePrefix)?t.substr(this.attrPrefixLen):!1}function mL(t){return t===this.options.cdataTagName}var fL=xh;(function(t){const e=l2,n=cs,i=cs,g=oi.buildOptions,s=u2;t.parse=function(o,r={},I){if(I){I===!0&&(I={});const C=s.validate(o,I);if(C!==!0)throw Error(C.err.msg)}r.parseTrueNumberOnly&&r.parseNodeValue!==!1&&!r.numParseOptions&&(r.numParseOptions={leadingZeros:!1});let a=g(r,i.defaultOptions,i.props);const l=n.getTraversalObj(o,a);return e.convertToJson(l,a)},t.convertTonimn=p2.convert2nimn,t.getTraversalObj=n.getTraversalObj,t.convertToJson=e.convertToJson,t.convertToJsonString=y2.convertToJsonString,t.validate=s.validate,t.j2xParser=fL,t.parseToNimn=function(o,r,I){return t.convertTonimn(t.getTraversalObj(o,I),r,I)}})(UK);const Wh=new Map;function LD(t,e){Wh.set(t,e)}async function pL(t){if(!Wh.has(t.id))throw new Error(`Compression codec ${t.id} is not supported by Zarr.js yet.`);return(await Wh.get(t.id)()).fromConfig(t)}function Nh(t){return new Proxy(t,{set(e,n,i,g){return e.setItem(n,i)},get(e,n,i){return e.getItem(n)},deleteProperty(e,n){return e.deleteItem(n)},has(e,n){return e.containsItem(n)}})}function BL(t){return typeof t=="object"&&t!==null&&"__zarr__"in t}function wh(t){return BL(t)&&t.__zarr__==="KeyError"}class xi extends Error{constructor(e){super(`path ${e} contains an array`);this.__zarr__="ContainsArrayError",Object.setPrototypeOf(this,xi.prototype)}}class Wi extends Error{constructor(e){super(`path ${e} contains a group`);this.__zarr__="ContainsGroupError",Object.setPrototypeOf(this,Wi.prototype)}}class Th extends Error{constructor(e){super(`array not found at path ${e}`);this.__zarr__="ArrayNotFoundError",Object.setPrototypeOf(this,Th.prototype)}}class oc extends Error{constructor(e){super(`ground not found at path ${e}`);this.__zarr__="GroupNotFoundError",Object.setPrototypeOf(this,oc.prototype)}}class Pt extends Error{constructor(e){super(e);this.__zarr__="PermissionError",Object.setPrototypeOf(this,Pt.prototype)}}class qI extends Error{constructor(e){super(`key ${e} not present`);this.__zarr__="KeyError",Object.setPrototypeOf(this,qI.prototype)}}class Eh extends RangeError{constructor(e,n){super(`too many indices for array; expected ${n.length}, got ${e.length}`);this.__zarr__="TooManyIndicesError",Object.setPrototypeOf(this,Eh.prototype)}}class ds extends RangeError{constructor(e){super(e);this.__zarr__="BoundsCheckError",Object.setPrototypeOf(this,ds.prototype)}}class rc extends RangeError{constructor(e,n,i,g){super(`slice arguments slice(${e}, ${n}, ${i}) invalid: ${g}`);this.__zarr__="InvalidSliceError",Object.setPrototypeOf(this,rc.prototype)}}class Qh extends Error{constructor(){super("Negative step size is not supported when indexing.");this.__zarr__="NegativeStepError",Object.setPrototypeOf(this,Qh.prototype)}}class St extends Error{constructor(e){super(e);this.__zarr__="ValueError",Object.setPrototypeOf(this,St.prototype)}}class Xh extends Error{constructor(e){super(e);this.__zarr__="HTTPError",Object.setPrototypeOf(this,Xh.prototype)}}function Ni(t,e=void 0,n=null){if(t===void 0)throw new rc(t,e,n,"The first argument must not be undefined");if(typeof t=="string"&&t!==":"||typeof e=="string"&&e!==":")throw new rc(t,e,n,'Arguments can only be integers, ":" or null');return e===void 0&&(e=t,t=null),{start:t===":"?null:t,stop:e===":"?null:e,step:n,_slice:!0}}function bL(t,e,n,i){if(t<0?(t+=i,t<0&&(t=n<0?-1:0)):t>=i&&(t=n<0?i-1:i),e<0?(e+=i,e<0&&(e=n<0?-1:0)):e>=i&&(e=n<0?i-1:i),n<0){if(e<t){const g=Math.floor((t-e-1)/-n+1);return[t,e,n,g]}}else if(t<e){const g=Math.floor((e-t-1)/n+1);return[t,e,n,g]}return[t,e,n,0]}function R2(t,e){let n,i,g;t.step===null?g=1:g=t.step,t.start===null?n=g<0?Number.MAX_SAFE_INTEGER:0:(n=t.start,n<0&&(n+=e)),t.stop===null?i=g<0?-Number.MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER:(i=t.stop,i<0&&(i+=e));const s=bL(n,i,g,e);if(n=s[0],i=s[1],g=s[2],e=s[3],g===0)throw new Error("Step size 0 is invalid");return[n,i,g,e]}function F2(t){return Array.isArray(t)?t:[t]}function yL(t,e){if(t.length>e.length)throw new Eh(t,e)}function us(t,e){const n=[],i=[];for(let g=0;g<t.length;g++){const s=t[g];if(typeof s=="number")n.push(s);else{const o=R2(s,e[g]),r=o[3];i.push(r),n.push(o)}}return[n,i]}function Ug(t,e,n=!1){t=vL(t,e);for(let i=0;i<t.length;i++){const g=t[i];if(typeof g=="number")n?t[i]=Ni(g,g+1,1):t[i]=Yh(g,e[i]);else{if(S2(g))throw new TypeError("Integer array selections are not supported (yet)");(g===":"||g===null)&&(t[i]=Ni(null,null,1))}}return t}function vL(t,e){t=F2(t);let n=-1,i=0;for(let g=0;g<t.length;g++)t[g]==="..."&&(n=g,i+=1);if(i>1)throw new RangeError("an index can only have a single ellipsis ('...')");if(i===1){const g=n,s=t.length-(g+1),o=t.length-1;if(o>=e.length)t=t.filter(r=>r!=="...");else{const r=e.length-o;let I=t.slice(0,g).concat(new Array(r).fill(null));s>0&&(I=I.concat(t.slice(t.length-s))),t=I}}if(t.length<e.length){const g=e.length-t.length;t=t.concat(new Array(g).fill(null))}return yL(t,e),t}function Yh(t,e){if(t<0&&(t=e+t),t>=e||t<0)throw new ds(`index out of bounds for dimension with length ${e}`);return t}function GL(t){return typeof t=="number"}function S2(t){if(!Array.isArray(t))return!1;for(const e of t)if(typeof e!="number")return!1;return!0}function _h(t){return t!==null&&t._slice===!0}function ZL(t){return _h(t)&&(t.step===null||t.step===1)}function RL(t){t=F2(t);for(let e=0;e<t.length;e++){const n=t[e];if(!(S2(n)||ZL(n)||n==="..."))return!1}return!0}function*FL(...t){if(t.length===0)return;const e=t.map(i=>i()),n=e.map(i=>i.next());for(let i=0;;){if(n[i].done){if(e[i]=t[i](),n[i]=e[i].next(),++i>=e.length)return}else yield n.map(({value:g})=>g),i=0;n[i]=e[i].next()}}class V2{constructor(e,n){e=Ug(e,n.shape),this.dimIndexers=[];const i=n.shape;for(let g=0;g<i.length;g++){let s=e[g];const o=i[g],r=n.chunks[g];if(s===null&&(s=Ni(null)),GL(s))this.dimIndexers.push(new SL(s,o,r));else if(_h(s))this.dimIndexers.push(new U2(s,o,r));else throw new RangeError(`Unspported selection item for basic indexing; expected integer or slice, got ${s}`)}this.shape=[];for(const g of this.dimIndexers)g instanceof U2&&this.shape.push(g.numItems);this.dropAxes=null}*iter(){const e=this.dimIndexers.map(i=>()=>i.iter()),n=FL(...e);for(const i of n){const g=[],s=[],o=[];for(const r of i)g.push(r.dimChunkIndex),s.push(r.dimChunkSelection),r.dimOutSelection!==null&&o.push(r.dimOutSelection);yield{chunkCoords:g,chunkSelection:s,outSelection:o}}}}class SL{constructor(e,n,i){e=Yh(e,n),this.dimSelection=e,this.dimLength=n,this.dimChunkLength=i,this.numItems=1}*iter(){const e=Math.floor(this.dimSelection/this.dimChunkLength),n=e*this.dimChunkLength,i=this.dimSelection-n;yield{dimChunkIndex:e,dimChunkSelection:i,dimOutSelection:null}}}class U2{constructor(e,n,i){const[g,s,o]=R2(e,n);if(this.start=g,this.stop=s,this.step=o,this.step<1)throw new Qh;this.dimLength=n,this.dimChunkLength=i,this.numItems=Math.max(0,Math.ceil((this.stop-this.start)/this.step)),this.numChunks=Math.ceil(this.dimLength/this.dimChunkLength)}*iter(){const e=Math.floor(this.start/this.dimChunkLength),n=Math.ceil(this.stop/this.dimChunkLength);for(let i=e;i<n;i++){const g=i*this.dimChunkLength,s=Math.min(this.dimLength,(i+1)*this.dimChunkLength),o=s-g;let r,I,a;if(this.start<g){r=0;const A=(g-this.start)%this.step;A>0&&(r+=this.step-A),a=Math.ceil((g-this.start)/this.step)}else r=this.start-g,a=0;this.stop>s?I=o:I=this.stop-g;const l=Ni(r,I,this.step),C=Math.ceil((I-r)/this.step),c=Ni(a,a+C);yield{dimChunkIndex:i,dimChunkSelection:l,dimOutSelection:c}}}}const $I=typeof process!="undefined"&&process.versions&&process.versions.node;function Rn(t){if(t===null)return"";for(t instanceof String&&(t=t.valueOf()),t=t.replace(/\\/g,"/");t.length>0&&t[0]==="/";)t=t.slice(1);for(;t.length>0&&t[t.length-1]==="/";)t=t.slice(0,t.length-1);t=t.replace(/\/\/+/g,"/");const e=t.split("/");for(const n of e)if(n==="."||n==="..")throw Error("path containing '.' or '..' segment not allowed");return t}function Hh(t){return typeof t=="number"&&(t=[t]),t.map(e=>Math.floor(e))}function VL(t,e){if(t===null||t===!0)throw new Error("Chunk guessing is not supported yet");return t===!1?e:(typeof t=="number"&&(t=[t]),t.length<e.length&&(t=t.concat(e.slice(t.length))),t.map((n,i)=>n===-1||n===null?e[i]:Math.floor(n)))}function UL(t){return t=t.toUpperCase(),t}function xL(t){return t}function WL(t){return t}function x2(t,e){if(t===null)return!0;Array.isArray(t)||(t=[t]);for(let n=0;n<Math.min(t.length,e.length);n++){const i=t[n];if(i!==null){if(_h(i)){const g=i,s=g.step===1||g.step===null;if(g.start===null&&g.stop===null&&s||g.stop-g.start===e[n]&&s)continue;return!1}return!1}}return!0}function NL(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function wL(t){const e=t.length,n=Array(e);let i=1;for(let g=e-1;g>=0;g--)n[g]=i,i*=t[g];return n}function kh(...t){return t.map((e,n)=>n===0?e.trim().replace(/[\/]*$/g,""):e.trim().replace(/(^[\/]*|[\/]*$)/g,"")).filter(e=>e.length).join("/")}function W2(t){const e=t.BYTES_PER_ELEMENT;if(e===1)return;if($I){const o=Buffer.from(t.buffer,t.byteOffset,t.length*e);e===2&&o.swap16(),e===4&&o.swap32(),e===8&&o.swap64();return}const n=new Uint8Array(t.buffer,t.byteOffset,t.length*e),i=e/2,g=e-1;let s;for(let o=0;o<n.length;o+=e)for(let r=0;r<i;r++)s=n[o+r],n[o+r]=n[o+g-r],n[o+g-r]=s}function TL(t){const e=t.slice();return W2(e),e}const Ic=".zarray",Kh=".zgroup",N2=".zattrs";async function Fn(t,e=null){e=Rn(e);const i=xg(e)+Ic;return t.containsItem(i)}async function un(t,e=null){e=Rn(e);const i=xg(e)+Kh;return t.containsItem(i)}function xg(t){return t.length>0?t+"/":""}async function w2(t,e,n,i){if(e.length===0)return;const g=e.split("/");let s="";for(const o of g.slice(0,g.length-1))s+=o,await Fn(t,s)?await Lh(t,s,i):await un(t,s)||await Lh(t,s),s+="/"}async function Lh(t,e=null,n=!1){if(e=Rn(e),n)throw Error("Group overwriting not implemented yet :(");if(await Fn(t,e))throw new xi(e);if(await un(t,e))throw new Wi(e);const i={zarr_format:2},g=xg(e)+Kh;await t.setItem(g,JSON.stringify(i))}async function ea(t,e=null,n=null,i=!1){e=Rn(e),await w2(t,e,n,i),await Lh(t,e,i)}async function EL(t,e,n,i,g,s,o,r,I,a,l,C){if(I)throw Error("Array overwriting not implemented yet :(");if(await Fn(t,g))throw new xi(g);if(await un(t,g))throw new Wi(g);if(i=xL(i),e=Hh(e),n=VL(n,e),r=UL(r),o=WL(o),l!==null&&l.length>0)throw Error("Filters are not supported yet");let c=o;typeof o=="number"&&(Number.isNaN(o)&&(c="NaN"),Number.POSITIVE_INFINITY===o&&(c="Infinity"),Number.NEGATIVE_INFINITY===o&&(c="-Infinity")),l=null;const A={zarr_format:2,shape:e,chunks:n,dtype:i,fill_value:c,order:r,compressor:s,filters:l};C&&(A.dimension_separator=C);const d=xg(g)+Ic;await t.setItem(d,JSON.stringify(A))}async function ac(t,e,n,i,g=null,s=null,o=null,r="C",I=!1,a=null,l=null,C){g=Rn(g),await w2(t,g,a,I),await EL(t,e,n,i,g,s,o,r,I,a,l,C)}function lc(t){if(typeof t!="string"){if($I&&Buffer.isBuffer(t))return JSON.parse(t.toString());if(t instanceof ArrayBuffer){const e=new TextDecoder,n=new Uint8Array(t);return JSON.parse(e.decode(n))}else return t}return JSON.parse(t)}class T2{constructor(e,n,i,g=!0){this.store=e,this.key=n,this.readOnly=i,this.cache=g,this.cachedValue=null}async asObject(){if(this.cache&&this.cachedValue!==null)return this.cachedValue;const e=await this.getNoSync();return this.cache&&(this.cachedValue=e),e}async getNoSync(){try{const e=await this.store.getItem(this.key);return lc(e)}catch{return{}}}async setNoSync(e,n){const i=await this.getNoSync();return i[e]=n,await this.putNoSync(i),!0}async putNoSync(e){await this.store.setItem(this.key,JSON.stringify(e)),this.cache&&(this.cachedValue=e)}async delNoSync(e){const n=await this.getNoSync();return delete n[e],await this.putNoSync(n),!0}async put(e){if(this.readOnly)throw new Pt("attributes are read-only");return this.putNoSync(e)}async setItem(e,n){if(this.readOnly)throw new Pt("attributes are read-only");return this.setNoSync(e,n)}async getItem(e){return(await this.asObject())[e]}async deleteItem(e){if(this.readOnly)throw new Pt("attributes are read-only");return this.delNoSync(e)}async containsItem(e){return(await this.asObject())[e]!==void 0}proxy(){return Nh(this)}}const QL={"|b":Int8Array,"|B":Uint8Array,"|u1":Uint8Array,"|i1":Int8Array,"<b":Int8Array,"<B":Uint8Array,"<u1":Uint8Array,"<i1":Int8Array,"<u2":Uint16Array,"<i2":Int16Array,"<u4":Uint32Array,"<i4":Int32Array,"<f4":Float32Array,"<f8":Float64Array,">b":Int8Array,">B":Uint8Array,">u1":Uint8Array,">i1":Int8Array,">u2":Uint16Array,">i2":Int16Array,">u4":Uint32Array,">i4":Int32Array,">f4":Float32Array,">f8":Float64Array};function wi(t){const e=QL[t];if(!e)throw Error(`Dtype not recognized or not supported in zarr.js, got ${t}.`);return e}function E2(t){if(t instanceof Uint8Array)return"|u1";if(t instanceof Int8Array)return"|i1";if(t instanceof Uint16Array)return"<u2";if(t instanceof Int16Array)return"<i2";if(t instanceof Uint32Array)return"<u4";if(t instanceof Int32Array)return"<i4";if(t instanceof Float32Array)return"<f4";if(t instanceof Float64Array)return"<f8";throw new St("Mapping for TypedArray to Dtypestring not known")}function Mh(t){return t.byteLength!==void 0?t.constructor:Mh(t[0])}function XL(t,e,n){const i=Ug(n,e),[g,s]=us(i,e);return[Ph(t,e,g),s]}function Ph(t,e,n){const i=n[0];if(typeof i=="number")return e.length===1?t[i]:Ph(t[i],e.slice(1),n.slice(1));const[g,s,o,r]=i;if(r===0)return new(Mh(t))(0);if(e.length===1){if(o===1)return t.slice(g,s);const a=new t.constructor(r);for(let l=0;l<r;l++)a[l]=t[g+l*o];return a}let I=new Array(r);for(let a=0;a<r;a++)I[a]=Ph(t[g+a*o],e.slice(1),n.slice(1));return r>0&&typeof I[0]=="number"&&(I=t[0].constructor.from(I)),I}function YL(t,e,n,i){const g=Ug(i,n,!0),[s,o]=us(g,n);Dh(t,e,n,s)}function _L(t,e,n,i,g){const s=Ug(g,n,!1),[o,r]=us(s,n);if(JSON.stringify(r)!==JSON.stringify(i))throw new St(`Shape mismatch in target and source NestedArray: ${r} and ${i}`);Jh(t,e,n,o)}function Jh(t,e,n,i){const g=i[0];if(typeof e=="number"){Dh(t,e,n,i.map(a=>typeof a=="number"?[a,a+1,1,1]:a));return}if(typeof g=="number"){Jh(t[g],e,n.slice(1),i.slice(1));return}const[s,o,r,I]=g;if(n.length===1){if(r===1)t.set(e,s);else for(let a=0;a<I;a++)t[s+a*r]=e[a];return}for(let a=0;a<I;a++)Jh(t[s+a*r],e[a],n.slice(1),i.slice(1))}function Dh(t,e,n,i){const g=i[0],[s,o,r,I]=g;if(n.length===1){if(r===1)t.fill(e,s,o);else for(let a=0;a<I;a++)t[s+a*r]=e;return}for(let a=0;a<I;a++)Dh(t[s+a*r],e,n.slice(1),i.slice(1))}function HL(t,e,n){n===void 0&&(n=Mh(t));const i=e.reduce((s,o)=>s*o,1),g=new n(i);return Q2(t,e,g,0),g}function Q2(t,e,n,i){if(e.length===1){n.set(t,i);return}if(e.length===2){for(let o=0;o<e[0];o++)n.set(t[o],i+e[1]*o);return t}const g=e.slice(1),s=g.reduce((o,r)=>o*r,1);for(let o=0;o<e[0];o++)Q2(t[o],g,n,i+s*o);return t}class Ti{constructor(e,n,i){const g=e!==null&&!!e.BYTES_PER_ELEMENT;if(n===void 0){if(!g)throw new St("Shape argument is required unless you pass in a TypedArray");n=[e.length]}if(i===void 0){if(!g)throw new St("Dtype argument is required unless you pass in a TypedArray");i=E2(e)}if(n=Hh(n),this.shape=n,this.dtype=i,g&&n.length!==1&&(e=e.buffer),this.shape.length===0)this.data=new(wi(i))(1);else if($I&&Buffer.isBuffer(e)||e instanceof ArrayBuffer||e===null||e.toString().startsWith("[object ArrayBuffer]")){const s=n.reduce((I,a)=>I*a,1);e===null&&(e=new ArrayBuffer(s*parseInt(i[i.length-1],10)));const o=e.byteLength/parseInt(i[i.length-1],10);if(s!==o)throw new Error(`Buffer has ${o} of dtype ${i}, shape is too large or small ${n} (flat=${s})`);const r=wi(i);this.data=X2(e,r,n)}else this.data=e}get(e){const[n,i]=XL(this.data,this.shape,e);return i.length===0?n:new Ti(n,i,this.dtype)}set(e=null,n){e===null&&(e=[Ni(null)]),typeof n=="number"?this.shape.length===0?this.data[0]=n:YL(this.data,n,this.shape,e):_L(this.data,n.data,this.shape,n.shape,e)}flatten(){return this.shape.length===1?this.data:HL(this.data,this.shape,wi(this.dtype))}static arange(e,n="<i4"){const i=wi(n),g=kL([e],i);return new Ti(g,[e],n)}}function kL(t,e){const n=t.reduce((g,s)=>g*s,1),i=new e(n);return i.set([...Array(n).keys()]),i}function X2(t,e,n,i=0){if(n.length===1)return new e(t.slice(i,i+n[0]*e.BYTES_PER_ELEMENT));const g=new Array(n[0]);if(n.length===2){for(let r=0;r<n[0];r++)g[r]=new e(t.slice(i+n[1]*r*e.BYTES_PER_ELEMENT,i+n[1]*(r+1)*e.BYTES_PER_ELEMENT));return g}const s=n.slice(1),o=s.reduce((r,I)=>r*I,1);for(let r=0;r<n[0];r++)g[r]=X2(t,e,s,i+o*r*e.BYTES_PER_ELEMENT);return g}function KL(t,e,n,i,g){const s=Ug(i,n,!0),[o]=us(s,n);Y2(g,t,e,o)}function LL(t,e,n,i,g,s,o){const r=Ug(i,n,!1),[I,a]=us(r,n);if(JSON.stringify(a)!==JSON.stringify(o))throw new St(`Shape mismatch in target and source RawArray: ${a} and ${o}`);zh(t,e,I,g,s)}function ML(t,e,n,i,g,s,o,r){const I=Ug(i,n,!0),[a]=us(I,n),l=Ug(r,o,!1),[C]=us(l,o);Oh(t,e,a,g,s,C)}function Y2(t,e,n,i){const[g,...s]=i,[o,...r]=n,[I,a,l,C]=g;if(n.length===1){if(l===1&&o===1)e.fill(t,I,I+C);else for(let c=0;c<C;c++)e[o*(I+l*c)]=t;return}for(let c=0;c<C;c++)Y2(t,e.subarray(o*(I+l*c)),r,s)}function zh(t,e,n,i,g){if(n.length===0){t.set(i);return}const[s,...o]=n,[r,...I]=e;if(typeof s=="number"){zh(t.subarray(s*r),I,o,i,g);return}const[a,...l]=g,[C,c,A,d]=s;if(e.length===1){if(A===1&&r===1&&a===1)t.set(i.subarray(0,d),C);else for(let m=0;m<d;m++)t[r*(C+A*m)]=i[a*m];return}for(let m=0;m<d;m++)zh(t.subarray(r*(C+m*A)),I,o,i.subarray(a*m),l)}function Oh(t,e,n,i,g,s){if(s.length===0){t.set(i.subarray(0,t.length));return}const[o,...r]=n,[I,...a]=s,[l,...C]=e,[c,...A]=g;if(typeof I=="number"){Oh(t,e,n,i.subarray(c*I),A,a);return}const[d,m,u,h]=o,[f,p,b,Z]=I;if(e.length===1&&g.length===1){if(u===1&&l===1&&b===1&&c===1)t.set(i.subarray(f,f+h),d);else for(let v=0;v<h;v++)t[l*(d+u*v)]=i[c*(f+b*v)];return}for(let v=0;v<h;v++)Oh(t.subarray(l*(d+v*u)),C,r,i.subarray(c*(f+v*b)),A,a)}class hs{constructor(e,n,i,g){const s=e!==null&&!!e.BYTES_PER_ELEMENT;if(n===void 0){if(!s)throw new St("Shape argument is required unless you pass in a TypedArray");n=[e.length]}if(n=Hh(n),i===void 0){if(!s)throw new St("Dtype argument is required unless you pass in a TypedArray");i=E2(e)}if(g===void 0&&(g=wL(n)),this.shape=n,this.dtype=i,this.strides=g,s&&n.length!==1&&(e=e.buffer),this.shape.length===0)this.data=new(wi(i))(1);else if($I&&Buffer.isBuffer(e)||e instanceof ArrayBuffer||e===null||e.toString().startsWith("[object ArrayBuffer]")){const o=n.reduce((a,l)=>a*l,1);e===null&&(e=new ArrayBuffer(o*parseInt(i[i.length-1],10)));const r=e.byteLength/parseInt(i[i.length-1],10);if(o!==r)throw new Error(`Buffer has ${r} of dtype ${i}, shape is too large or small ${n} (flat=${o})`);const I=wi(i);this.data=new I(e)}else this.data=e}set(e=null,n,i){e===null&&(e=[Ni(null)]),typeof n=="number"?this.shape.length===0?this.data[0]=n:KL(this.data,this.strides,this.shape,e,n):n instanceof hs&&i?ML(this.data,this.strides,this.shape,e,n.data,n.strides,n.shape,i):LL(this.data,this.strides,this.shape,e,n.data,n.strides,n.shape)}}function PL(t){var e={exports:{}};return t(e,e.exports),e.exports}var JL=PL(function(t){var e=Object.prototype.hasOwnProperty,n="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(n=!1));function g(I,a,l){this.fn=I,this.context=a,this.once=l||!1}function s(I,a,l,C,c){if(typeof l!="function")throw new TypeError("The listener must be a function");var A=new g(l,C||I,c),d=n?n+a:a;return I._events[d]?I._events[d].fn?I._events[d]=[I._events[d],A]:I._events[d].push(A):(I._events[d]=A,I._eventsCount++),I}function o(I,a){--I._eventsCount==0?I._events=new i:delete I._events[a]}function r(){this._events=new i,this._eventsCount=0}r.prototype.eventNames=function(){var a=[],l,C;if(this._eventsCount===0)return a;for(C in l=this._events)e.call(l,C)&&a.push(n?C.slice(1):C);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(l)):a},r.prototype.listeners=function(a){var l=n?n+a:a,C=this._events[l];if(!C)return[];if(C.fn)return[C.fn];for(var c=0,A=C.length,d=new Array(A);c<A;c++)d[c]=C[c].fn;return d},r.prototype.listenerCount=function(a){var l=n?n+a:a,C=this._events[l];return C?C.fn?1:C.length:0},r.prototype.emit=function(a,l,C,c,A,d){var m=n?n+a:a;if(!this._events[m])return!1;var u=this._events[m],h=arguments.length,f,p;if(u.fn){switch(u.once&&this.removeListener(a,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,l),!0;case 3:return u.fn.call(u.context,l,C),!0;case 4:return u.fn.call(u.context,l,C,c),!0;case 5:return u.fn.call(u.context,l,C,c,A),!0;case 6:return u.fn.call(u.context,l,C,c,A,d),!0}for(p=1,f=new Array(h-1);p<h;p++)f[p-1]=arguments[p];u.fn.apply(u.context,f)}else{var b=u.length,Z;for(p=0;p<b;p++)switch(u[p].once&&this.removeListener(a,u[p].fn,void 0,!0),h){case 1:u[p].fn.call(u[p].context);break;case 2:u[p].fn.call(u[p].context,l);break;case 3:u[p].fn.call(u[p].context,l,C);break;case 4:u[p].fn.call(u[p].context,l,C,c);break;default:if(!f)for(Z=1,f=new Array(h-1);Z<h;Z++)f[Z-1]=arguments[Z];u[p].fn.apply(u[p].context,f)}}return!0},r.prototype.on=function(a,l,C){return s(this,a,l,C,!1)},r.prototype.once=function(a,l,C){return s(this,a,l,C,!0)},r.prototype.removeListener=function(a,l,C,c){var A=n?n+a:a;if(!this._events[A])return this;if(!l)return o(this,A),this;var d=this._events[A];if(d.fn)d.fn===l&&(!c||d.once)&&(!C||d.context===C)&&o(this,A);else{for(var m=0,u=[],h=d.length;m<h;m++)(d[m].fn!==l||c&&!d[m].once||C&&d[m].context!==C)&&u.push(d[m]);u.length?this._events[A]=u.length===1?u[0]:u:o(this,A)}return this},r.prototype.removeAllListeners=function(a){var l;return a?(l=n?n+a:a,this._events[l]&&o(this,l)):(this._events=new i,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=n,r.EventEmitter=r,t.exports=r}),DL=(t,e)=>(e=e||(()=>{}),t.then(n=>new Promise(i=>{i(e())}).then(()=>n),n=>new Promise(i=>{i(e())}).then(()=>{throw n})));class _2 extends Error{constructor(e){super(e);this.name="TimeoutError"}}const H2=(t,e,n)=>new Promise((i,g)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){i(t);return}const s=setTimeout(()=>{if(typeof n=="function"){try{i(n())}catch(I){g(I)}return}const o=typeof n=="string"?n:`Promise timed out after ${e} milliseconds`,r=n instanceof Error?n:new _2(o);typeof t.cancel=="function"&&t.cancel(),g(r)},e);DL(t.then(i,g),()=>{clearTimeout(s)})});var Cc=H2,zL=H2,OL=_2;Cc.default=zL;Cc.TimeoutError=OL;function jL(t,e,n){let i=0,g=t.length;for(;g>0;){const s=g/2|0;let o=i+s;n(t[o],e)<=0?(i=++o,g-=s+1):g=s}return i}var qL=jL,$L=Object.defineProperty({default:qL},"__esModule",{value:!0});class eM{constructor(){this._queue=[]}enqueue(e,n){n=Object.assign({priority:0},n);const i={priority:n.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=n.priority){this._queue.push(i);return}const g=$L.default(this._queue,i,(s,o)=>o.priority-s.priority);this._queue.splice(g,0,i)}dequeue(){const e=this._queue.shift();return e&&e.run}get size(){return this._queue.length}}var tM=eM,nM=Object.defineProperty({default:tM},"__esModule",{value:!0});const cc=()=>{},iM=new Cc.default.TimeoutError;class gM extends JL{constructor(e){super();if(this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=cc,this._resolveIdle=cc,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:nM.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother()}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=cc,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=cc)}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const n=this._intervalEnd-e;if(n<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},n)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother)return this.emit("active"),this._queue.dequeue()(),e&&this._initializeIntervalIfNeeded(),!0}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,n={}){return new Promise((i,g)=>{const s=async()=>{this._pendingCount++,this._intervalCount++;try{const o=this._timeout===void 0&&n.timeout===void 0?e():Cc.default(Promise.resolve(e()),n.timeout===void 0?this._timeout:n.timeout,()=>{(n.throwOnTimeout===void 0?this._throwOnTimeout:n.throwOnTimeout)&&g(iM)});i(await o)}catch(o){g(o)}this._next()};this._queue.enqueue(s,n),this._tryToStartAnother()})}async addAll(e,n){return Promise.all(e.map(async i=>this.add(i,n)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const n=this._resolveEmpty;this._resolveEmpty=()=>{n(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const n=this._resolveIdle;this._resolveIdle=()=>{n(),e()}})}get size(){return this._queue.size}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}set timeout(e){this._timeout=e}get timeout(){return this._timeout}}var k2=gM;class ta{constructor(e,n=null,i,g=!1,s=null,o=!0,r=!0){this.store=e,this._chunkStore=s,this.path=Rn(n),this.keyPrefix=xg(this.path),this.readOnly=g,this.cacheMetadata=o,this.cacheAttrs=r,this.meta=i,this.meta.compressor!==null?this.compressor=pL(this.meta.compressor):this.compressor=null;const I=this.keyPrefix+N2;this.attrs=new T2(this.store,I,this.readOnly,r)}get chunkStore(){return this._chunkStore?this._chunkStore:this.store}get name(){return this.path.length>0?this.path[0]!=="/"?"/"+this.path:this.path:null}get basename(){const e=this.name;if(e===null)return null;const n=e.split("/");return n[n.length-1]}get shape(){return this.meta.shape}get chunks(){return this.meta.chunks}get chunkSize(){return this.chunks.reduce((e,n)=>e*n,1)}get dtype(){return this.meta.dtype}get fillValue(){const e=this.meta.fill_value;return e==="NaN"?NaN:e==="Infinity"?1/0:e==="-Infinity"?-1/0:this.meta.fill_value}get nDims(){return this.meta.shape.length}get size(){return this.meta.shape.reduce((e,n)=>e*n,1)}get length(){return this.shape[0]}get _chunkDataShape(){if(this.shape===[])return[1];{const e=[];for(let n=0;n<this.shape.length;n++)e[n]=Math.ceil(this.shape[n]/this.chunks[n]);return e}}get chunkDataShape(){return this._chunkDataShape}get numChunks(){return this.chunkDataShape.reduce((e,n)=>e*n,1)}static async create(e,n=null,i=!1,g=null,s=!0,o=!0){const r=await this.loadMetadataForConstructor(e,n);return new ta(e,n,r,i,g,s,o)}static async loadMetadataForConstructor(e,n){try{n=Rn(n);const i=xg(n),g=await e.getItem(i+Ic);return lc(g)}catch(i){throw await un(e,n)?new Wi(n!=null?n:""):new Error("Failed to load metadata for ZarrArray:"+i.toString())}}async reloadMetadata(){const e=this.keyPrefix+Ic,n=this.store.getItem(e);return this.meta=lc(await n),this.meta}async refreshMetadata(){this.cacheMetadata||await this.reloadMetadata()}get(e=null,n={}){return this.getBasicSelection(e,!1,n)}getRaw(e=null,n={}){return this.getBasicSelection(e,!0,n)}async getBasicSelection(e,n=!1,{concurrencyLimit:i=10,progressCallback:g}={}){if(this.cacheMetadata||await this.reloadMetadata(),this.shape===[])throw new Error("Shape [] indexing is not supported yet");return this.getBasicSelectionND(e,n,i,g)}getBasicSelectionND(e,n,i,g){const s=new V2(e,this);return this.getSelection(s,n,i,g)}async getSelection(e,n,i,g){const s=this.dtype,o=e.shape,r=e.shape.reduce((l,C)=>l*C,1);if(n&&r===this.chunkSize){const l=e.iter(),C=l.next();if(C.done===!1&&l.next().done===!0){const c=C.value;return await this.decodeDirectToRawArray(c,o,r)}}const I=n?new hs(null,o,s):new Ti(null,o,s);if(r===0)return I;const a=new k2({concurrency:i});if(g){let l=0,C=0;for(const c of e.iter())C+=1;g({progress:0,queueSize:C});for(const c of e.iter())(async()=>{await a.add(()=>this.chunkGetItem(c.chunkCoords,c.chunkSelection,I,c.outSelection,e.dropAxes)),l+=1,g({progress:l,queueSize:C})})()}else for(const l of e.iter())a.add(()=>this.chunkGetItem(l.chunkCoords,l.chunkSelection,I,l.outSelection,e.dropAxes));return await a.onIdle(),I.shape.length===0?I.data[0]:I}async chunkGetItem(e,n,i,g,s){if(e.length!==this._chunkDataShape.length)throw new St(`Inconsistent shapes: chunkCoordsLength: ${e.length}, cDataShapeLength: ${this.chunkDataShape.length}`);const o=this.chunkKey(e);try{const r=await this.chunkStore.getItem(o),I=await this.decodeChunk(r);if(i instanceof Ti){if(RL(g)&&x2(n,this.chunks)&&!this.meta.filters){i.set(g,this.toNestedArray(I));return}const l=this.toNestedArray(I).get(n);if(s!==null)throw new Error("Drop axes is not supported yet");i.set(g,l)}else i.set(g,this.chunkBufferToRawArray(I),n)}catch(r){if(wh(r))this.fillValue!==null&&i.set(g,this.fillValue);else throw r}}async getRawChunk(e,n){if(e.length!==this.shape.length)throw new Error(`Chunk coordinates ${e.join(".")} do not correspond to shape ${this.shape}.`);try{for(let r=0;r<e.length;r++){const I=Math.ceil(this.shape[r]/this.chunks[r]);e[r]=Yh(e[r],I)}}catch(r){throw r instanceof ds?new ds(`index ${e.join(".")} is out of bounds for shape: ${this.shape} and chunks ${this.chunks}`):r}const i=this.chunkKey(e),g=this.chunkStore.getItem(i,n==null?void 0:n.storeOptions),s=await this.decodeChunk(await g),o=this.chunks.filter(r=>r!==1);return new hs(s,o,this.dtype)}chunkKey(e){var n;const i=(n=this.meta.dimension_separator)!==null&&n!==void 0?n:".";return this.keyPrefix+e.join(i)}ensureByteArray(e){return typeof e=="string"?new Uint8Array(Buffer.from(e).buffer):new Uint8Array(e)}toTypedArray(e){return new(wi(this.dtype))(e)}toNestedArray(e){const n=this.ensureByteArray(e).buffer;return new Ti(n,this.chunks,this.dtype)}async decodeChunk(e){let n=this.ensureByteArray(e);return this.compressor!==null&&(n=await(await this.compressor).decode(n)),this.dtype.includes(">")&&W2(this.toTypedArray(n.buffer)),n.buffer}chunkBufferToRawArray(e){return new hs(e,this.chunks,this.dtype)}async decodeDirectToRawArray({chunkCoords:e},n,i){const g=this.chunkKey(e);try{const s=await this.chunkStore.getItem(g);return new hs(await this.decodeChunk(s),n,this.dtype)}catch(s){if(wh(s)){const o=new(wi(this.dtype))(i);return new hs(o.fill(this.fillValue),n)}else throw s}}async set(e=null,n,i={}){await this.setBasicSelection(e,n,i)}async setBasicSelection(e,n,{concurrencyLimit:i=10,progressCallback:g}={}){if(this.readOnly)throw new Pt("Object is read only");if(this.cacheMetadata||await this.reloadMetadata(),this.shape===[])throw new Error("Shape [] indexing is not supported yet");await this.setBasicSelectionND(e,n,i,g)}async setBasicSelectionND(e,n,i,g){const s=new V2(e,this);await this.setSelection(s,n,i,g)}getChunkValue(e,n,i,g){let s;if(g===[])s=i;else if(typeof i=="number")s=i;else if(s=i.get(e.outSelection),n.dropAxes!==null)throw new Error("Handling drop axes not supported yet");return s}async setSelection(e,n,i,g){const s=e.shape;if(s!==[]){if(typeof n!="number")if(n instanceof Ti){if(!NL(n.shape,s))throw new St(`Shape mismatch in source NestedArray and set selection: ${n.shape} and ${s}`)}else throw new Error("Unknown data type for setting :(")}const o=new k2({concurrency:i});if(g){let r=0;for(const a of e.iter())r+=1;let I=0;g({progress:0,queueSize:r});for(const a of e.iter()){const l=this.getChunkValue(a,e,n,s);(async()=>{await o.add(()=>this.chunkSetItem(a.chunkCoords,a.chunkSelection,l)),I+=1,g({progress:I,queueSize:r})})()}}else for(const r of e.iter()){const I=this.getChunkValue(r,e,n,s);o.add(()=>this.chunkSetItem(r.chunkCoords,r.chunkSelection,I))}await o.onIdle()}async chunkSetItem(e,n,i){const g=this.chunkKey(e);let s=null;const o=wi(this.dtype),r=this.chunkSize;if(x2(n,this.chunks))typeof i=="number"?(s=new o(r),s.fill(i)):s=i.flatten();else{let a;try{const C=await this.chunkStore.getItem(g),c=await this.decodeChunk(C);a=this.toTypedArray(c)}catch(C){if(wh(C))a=new o(r),this.fillValue!==null&&a.fill(this.fillValue);else throw C}const l=new Ti(a,this.chunks,this.dtype);l.set(n,i),s=l.flatten()}const I=await this.encodeChunk(s);this.chunkStore.setItem(g,I)}async encodeChunk(e){if(this.dtype.includes(">")&&(e=TL(e)),this.compressor!==null){const n=new Uint8Array(e.buffer);return(await(await this.compressor).encode(n)).buffer}return e.buffer}}class sM{constructor(e={}){this.root=e}proxy(){return Nh(this)}getParent(e){let n=this.root;const i=e.split("/");for(const g of i.slice(0,i.length-1))if(n=n[g],!n)throw Error(e);return[n,i[i.length-1]]}requireParent(e){let n=this.root;const i=e.split("/");for(const g of i.slice(0,i.length-1))n[g]===void 0&&(n[g]={}),n=n[g];return[n,i[i.length-1]]}getItem(e){const[n,i]=this.getParent(e),g=n[i];if(g===void 0)throw new qI(e);return g}setItem(e,n){const[i,g]=this.requireParent(e);return i[g]=n,!0}deleteItem(e){const[n,i]=this.getParent(e);return delete n[i]}containsItem(e){try{return this.getItem(e)!==void 0}catch{return!1}}keys(){throw new Error("Method not implemented.")}}var Ii;(function(t){t.HEAD="HEAD",t.GET="GET",t.PUT="PUT"})(Ii||(Ii={}));const oM=[Ii.HEAD,Ii.GET,Ii.PUT];class rM{constructor(e,n={}){this.url=e;const{fetchOptions:i={},supportedMethods:g=oM}=n;this.fetchOptions=i,this.supportedMethods=new Set(g)}keys(){throw new Error("Method not implemented.")}async getItem(e,n){const i=kh(this.url,e),g=await fetch(i,S(S({},this.fetchOptions),n));if(g.status===404)throw new qI(e);if(g.status!==200)throw new Xh(String(g.status));return $I?Buffer.from(await g.arrayBuffer()):g.arrayBuffer()}async setItem(e,n){if(!this.supportedMethods.has(Ii.PUT))throw new Error("HTTP PUT no a supported method for store.");const i=kh(this.url,e);return typeof n=="string"&&(n=new TextEncoder().encode(n).buffer),(await fetch(i,J(S({},this.fetchOptions),{method:Ii.PUT,body:n}))).status.toString()[0]==="2"}deleteItem(e){throw new Error("Method not implemented.")}async containsItem(e){const n=kh(this.url,e),i=this.supportedMethods.has(Ii.HEAD)?Ii.HEAD:Ii.GET;return(await fetch(n,J(S({},this.fetchOptions),{method:i}))).status===200}}async function Qo({shape:t,chunks:e=!0,dtype:n="<i4",compressor:i=null,fillValue:g=null,order:s="C",store:o,overwrite:r=!1,path:I,chunkStore:a,filters:l,cacheMetadata:C=!0,cacheAttrs:c=!0,readOnly:A=!1,dimensionSeparator:d}){return o=na(o),await ac(o,t,e,n,I,i,g,s,r,a,l,d),await ta.create(o,I,A,a,C,c)}async function IM(t,e={}){return e.fillValue=null,Qo(S({shape:t},e))}async function aM(t,e={}){return e.fillValue=0,Qo(S({shape:t},e))}async function lM(t,e={}){return e.fillValue=1,Qo(S({shape:t},e))}async function CM(t,e,n={}){return n.fillValue=e,Qo(S({shape:t},n))}async function K2(t,e={}){let n=null;t instanceof Ti?(n=t.shape,e.dtype=e.dtype===void 0?t.dtype:e.dtype):n=t.byteLength;const i=e.readOnly===void 0?!1:e.readOnly;e.readOnly=!1;const g=await Qo(S({shape:n},e));return await g.set(null,t),g.readOnly=i,g}async function MD({shape:t,mode:e="a",chunks:n=!0,dtype:i="<i4",compressor:g=null,fillValue:s=null,order:o="C",store:r,overwrite:I=!1,path:a=null,chunkStore:l,filters:C,cacheMetadata:c=!0,cacheAttrs:A=!0,dimensionSeparator:d}={}){if(r=na(r),l===void 0&&(l=na(r)),a=Rn(a),e==="r"||e==="r+"){if(!await Fn(r,a))throw await un(r,a)?new Wi(a):new Th(a)}else if(e==="w"){if(t===void 0)throw new St("Shape can not be undefined when creating a new array");await ac(r,t,n,i,a,g,s,o,I,l,C,d)}else if(e==="a"){if(!await Fn(r,a)){if(await un(r,a))throw new Wi(a);if(t===void 0)throw new St("Shape can not be undefined when creating a new array");await ac(r,t,n,i,a,g,s,o,I,l,C,d)}}else if(e==="w-"||e==="x"){if(await Fn(r,a))throw new xi(a);if(await un(r,a))throw new Wi(a);if(t===void 0)throw new St("Shape can not be undefined when creating a new array");await ac(r,t,n,i,a,g,s,o,I,l,C,d)}else throw new St(`Invalid mode argument: ${e}`);const m=e==="r";return ta.create(r,a,m,l,c,A)}function na(t){return t===void 0?new sM:typeof t=="string"?new rM(t):t}class Xo{constructor(e,n=null,i,g=!1,s=null,o=!0){this.store=e,this._chunkStore=s,this.path=Rn(n),this.keyPrefix=xg(this.path),this.readOnly=g,this.meta=i;const r=this.keyPrefix+N2;this.attrs=new T2(this.store,r,this.readOnly,o)}get name(){return this.path.length>0?this.path[0]!=="/"?"/"+this.path:this.path:"/"}get basename(){const e=this.name.split("/");return e[e.length-1]}get chunkStore(){return this._chunkStore?this._chunkStore:this.store}static async create(e,n=null,i=!1,g=null,s=!0){const o=await this.loadMetadataForConstructor(e,n);return new Xo(e,n,o,i,g,s)}static async loadMetadataForConstructor(e,n){n=Rn(n);const i=xg(n);try{const g=await e.getItem(i+Kh);return lc(g)}catch{throw await Fn(e,n)?new xi(n):new oc(n)}}itemPath(e){const n=typeof e=="string"&&e.length>0&&e[0]==="/",i=Rn(e);return!n&&this.path.length>0?this.keyPrefix+i:i}async createGroup(e,n=!1){if(this.readOnly)throw new Pt("group is read only");const i=this.itemPath(e);return await ea(this.store,i,this._chunkStore,n),Xo.create(this.store,i,this.readOnly,this._chunkStore,this.attrs.cache)}async requireGroup(e,n=!1){if(this.readOnly)throw new Pt("group is read only");const i=this.itemPath(e);return await un(this.store,i)||await ea(this.store,i,this._chunkStore,n),Xo.create(this.store,i,this.readOnly,this._chunkStore,this.attrs.cache)}getOptsForArrayCreation(e,n={}){const i=this.itemPath(e);return n.path=i,n.cacheAttrs===void 0&&(n.cacheAttrs=this.attrs.cache),n.store=this.store,n.chunkStore=this.chunkStore,n}array(e,n,i,g){if(this.readOnly)throw new Pt("group is read only");return i=this.getOptsForArrayCreation(e,i),i.overwrite=g===void 0?i.overwrite:g,K2(n,i)}empty(e,n,i={}){if(this.readOnly)throw new Pt("group is read only");return i=this.getOptsForArrayCreation(e,i),IM(n,i)}zeros(e,n,i={}){if(this.readOnly)throw new Pt("group is read only");return i=this.getOptsForArrayCreation(e,i),aM(n,i)}ones(e,n,i={}){if(this.readOnly)throw new Pt("group is read only");return i=this.getOptsForArrayCreation(e,i),lM(n,i)}full(e,n,i,g={}){if(this.readOnly)throw new Pt("group is read only");return g=this.getOptsForArrayCreation(e,g),CM(n,i,g)}createDataset(e,n,i,g){if(this.readOnly)throw new Pt("group is read only");g=this.getOptsForArrayCreation(e,g);let s;if(i===void 0){if(n===void 0)throw new St("Shape must be set if no data is passed to CreateDataset");s=Qo(S({shape:n},g))}else s=K2(i,g);return s}async getItem(e){const n=this.itemPath(e);if(await Fn(this.store,n))return ta.create(this.store,n,this.readOnly,this.chunkStore,void 0,this.attrs.cache);if(await un(this.store,n))return Xo.create(this.store,n,this.readOnly,this._chunkStore,this.attrs.cache);throw new qI(e)}async setItem(e,n){return await this.array(e,n,{},!0),!0}async deleteItem(e){throw this.readOnly?new Pt("group is read only"):new Error("Method not implemented.")}async containsItem(e){const n=this.itemPath(e);return await Fn(this.store,n)||un(this.store,n)}proxy(){return Nh(this)}}async function PD(t,e=null,n="a",i,g=!0){if(t=na(t),i!==void 0&&(i=na(t)),e=Rn(e),n==="r"||n==="r+"){if(!await un(t,e))throw await Fn(t,e)?new xi(e):new oc(e)}else if(n==="w")await ea(t,e,i,!0);else if(n==="a"){if(!await un(t,e)){if(await Fn(t,e))throw new xi(e);await ea(t,e,i)}}else if(n==="w-"||n==="x"){if(await Fn(t,e))throw new xi(e);if(await un(t,e))throw new Wi(e);await ea(t,e,i)}else throw new St(`Invalid mode argument: ${n}`);const s=n==="r";return Xo.create(t,e,s,i,g)}var Ac={exports:{}},ia={};/** @license React v17.0.2
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cM=G.exports,L2=60103;ia.Fragment=60107;if(typeof Symbol=="function"&&Symbol.for){var M2=Symbol.for;L2=M2("react.element"),ia.Fragment=M2("react.fragment")}var AM=cM.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,dM=Object.prototype.hasOwnProperty,uM={key:!0,ref:!0,__self:!0,__source:!0};function P2(t,e,n){var i,g={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)dM.call(e,i)&&!uM.hasOwnProperty(i)&&(g[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)g[i]===void 0&&(g[i]=e[i]);return{$$typeof:L2,type:t,key:s,ref:o,props:g,_owner:AM.current}}ia.jsx=P2;ia.jsxs=P2;Ac.exports=ia;const JD=Ac.exports.jsx,DD=Ac.exports.jsxs,zD=Ac.exports.Fragment;var hM=`#define SHADER_NAME xr-layer-fragment-shader
precision highp float;precision highp int;precision highp SAMPLER_TYPE;
#define GLSLIFY 1
uniform SAMPLER_TYPE channel0;uniform SAMPLER_TYPE channel1;uniform SAMPLER_TYPE channel2;uniform SAMPLER_TYPE channel3;uniform SAMPLER_TYPE channel4;uniform SAMPLER_TYPE channel5;in vec2 vTexCoord;uniform vec2 contrastLimits[6];void main(){float intensity0=float(texture(channel0,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity0,contrastLimits[0],0);float intensity1=float(texture(channel1,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity1,contrastLimits[1],1);float intensity2=float(texture(channel2,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity2,contrastLimits[2],2);float intensity3=float(texture(channel3,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity3,contrastLimits[3],3);float intensity4=float(texture(channel4,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity4,contrastLimits[4],4);float intensity5=float(texture(channel5,vTexCoord).r);DECKGL_PROCESS_INTENSITY(intensity5,contrastLimits[5],5);DECKGL_MUTATE_COLOR(gl_FragColor,intensity0,intensity1,intensity2,intensity3,intensity4,intensity5,vTexCoord);geometry.uv=vTexCoord;DECKGL_FILTER_COLOR(gl_FragColor,geometry);}`,mM=`#define GLSLIFY 1
#define SHADER_NAME xr-layer-vertex-shader
attribute vec2 texCoords;attribute vec3 positions;attribute vec3 positions64Low;attribute vec3 instancePickingColors;varying vec2 vTexCoord;void main(void){geometry.worldPosition=positions;geometry.uv=texCoords;geometry.pickingColor=instancePickingColors;gl_Position=project_position_to_clipspace(positions,positions64Low,vec3(0.),geometry.position);DECKGL_FILTER_GL_POSITION(gl_Position,geometry);vTexCoord=texCoords;vec4 color=vec4(0.);DECKGL_FILTER_COLOR(color,geometry);}`,fM=`#define GLSLIFY 1
float apply_contrast_limits(float intensity,vec2 contrastLimits){return max(0.,(intensity-contrastLimits[0])/max(0.0005,(contrastLimits[1]-contrastLimits[0])));}`,pM={name:"channel-intensity-module",defines:{SAMPLER_TYPE:"usampler2D",COLORMAP_FUNCTION:""},fs:fM};const BM=255,J2=[0,0,0],D2=6,bM="-apple-system, 'Helvetica Neue', Arial, sans-serif",z2={Uint8:{format:q.R8UI,dataFormat:q.RED_INTEGER,type:q.UNSIGNED_BYTE,max:2**8-1,sampler:"usampler2D"},Uint16:{format:q.R16UI,dataFormat:q.RED_INTEGER,type:q.UNSIGNED_SHORT,max:2**16-1,sampler:"usampler2D"},Uint32:{format:q.R32UI,dataFormat:q.RED_INTEGER,type:q.UNSIGNED_INT,max:2**32-1,sampler:"usampler2D"},Float32:{format:q.R32F,dataFormat:q.RED,type:q.FLOAT,max:3.4*10**38,sampler:"sampler2D"},Int8:{format:q.R8I,dataFormat:q.RED_INTEGER,type:q.BYTE,max:2**(8-1)-1,sampler:"isampler2D"},Int16:{format:q.R16I,dataFormat:q.RED_INTEGER,type:q.SHORT,max:2**(16-1)-1,sampler:"isampler2D"},Int32:{format:q.R32I,dataFormat:q.RED_INTEGER,type:q.INT,max:2**(32-1)-1,sampler:"isampler2D"},Float64:{format:q.R32F,dataFormat:q.RED,type:q.FLOAT,max:3.4*10**38,sampler:"sampler2D",cast:t=>new Float32Array(t)}},yM=["jet","hsv","hot","cool","spring","summer","autumn","winter","bone","copper","greys","yignbu","greens","yiorrd","bluered","rdbu","picnic","rainbow","portland","blackbody","earth","electric","alpha","viridis","inferno","magma","plasma","warm","rainbow-soft","bathymetry","cdom","chlorophyll","density","freesurface-blue","freesurface-red","oxygen","par","phase","salinity","temperature","turbidity","velocity-blue","velocity-green","cubehelix"];var ai;(function(t){t.MAX_INTENSITY_PROJECTION="Maximum Intensity Projection",t.MIN_INTENSITY_PROJECTION="Minimum Intensity Projection",t.ADDITIVE="Additive"})(ai||(ai={}));function vM(t){return[...Array(t).keys()]}function jh(t,e,n){for(let i=0;i<n;i+=1)t.push(e);return t}function qh(t){const e=z2[t];if(!e){const n=Object.keys(z2);throw Error(`Dtype not supported, got ${t}. Must be one of ${n}.`)}return e}function O2({contrastLimits:t=[],channelsVisible:e,domain:n,dtype:i}){const g=n&&n[1]||qh(i).max,s=t.map((I,a)=>e[a]?I:[g,g]),o=D2-s.length;if(o<0)throw Error(`${s.lengths} channels passed in, but only 6 are allowed.`);return jh(s,[g,g],o).reduce((I,a)=>I.concat(a),[])}function GM(t){var g,s;const{x:e,y:n,z:i}=(s=(g=t==null?void 0:t.meta)==null?void 0:g.physicalSizes)!=null?s:{};if((e==null?void 0:e.size)&&(n==null?void 0:n.size)&&(i==null?void 0:i.size)){const o=Math.min(i.size,e.size,n.size),r=[e.size/o,n.size/o,i.size/o];return new Pe().scale(r)}return new Pe().identity()}const j2={fs:hM,vs:mM};function ZM(t,e){const n=a0(t,Ee.TEXTURE_FLOAT),i=a0(t,Ee.TEXTURE_FILTER_LINEAR_FLOAT);if(!n)throw new Error("WebGL1 context does not support floating point textures.  Unable to display raster data.");return!i&&e===q.LINEAR?(console.warn("LINEAR filtering not supported in WebGL1 context.  Falling back to NEAREST."),q.NEAREST):e}function q2(t,e,n){if(!ye(e))return{format:q.LUMINANCE,dataFormat:q.LUMINANCE,type:q.FLOAT,sampler:"sampler2D",shaderModule:j2,filter:ZM(e,n),cast:r=>new Float32Array(r)};const i=n===q.LINEAR,g=S({},j2),s=`#version 300 es
`;g.fs=s.concat(g.fs),g.vs=s.concat(g.vs);const o=qh(i?"Float32":t);return J(S({},o),{shaderModule:g,filter:n,cast:i?r=>new Float32Array(r):r=>r})}const RM={pickable:{type:"boolean",value:!0,compare:!0},coordinateSystem:ce.CARTESIAN,channelData:{type:"object",value:{},compare:!0},bounds:{type:"array",value:[0,0,1,1],compare:!0},contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},dtype:{type:"string",value:"Uint16",compare:!0},interpolation:{type:"number",value:q.NEAREST,compare:!0}},dc=class extends An{getShaders(){const{dtype:t,interpolation:e}=this.props,{shaderModule:n,sampler:i}=q2(t,this.context.gl,e),g=this._isHookDefinedByExtensions("fs:DECKGL_PROCESS_INTENSITY"),s=J(S({},pM),{inject:{}});return g||(s.inject["fs:DECKGL_PROCESS_INTENSITY"]=`
        intensity = apply_contrast_limits(intensity, contrastLimits);
      `),super.getShaders(J(S({},n),{defines:{SAMPLER_TYPE:i},modules:[Bg,yg,s]}))}_isHookDefinedByExtensions(t){const{extensions:e}=this.props;return e==null?void 0:e.some(n=>{const i=n.getShaders(),{inject:g={},modules:s=[]}=i,o=g[t],r=s.some(I=>I==null?void 0:I.inject[t]);return o||r})}initializeState(){const{gl:t}=this.context;t.pixelStorei(q.UNPACK_ALIGNMENT,1),t.pixelStorei(q.PACK_ALIGNMENT,1),this.getAttributeManager().add({positions:{size:3,type:q.DOUBLE,fp64:this.use64bitPositions(),update:this.calculatePositions,noAlloc:!0}}),this.setState({numInstances:1,positions:new Float64Array(12)});const n=rs.getDefaultProgramManager(t),i="fs:DECKGL_MUTATE_COLOR(inout vec4 rgba, float intensity0, float intensity1, float intensity2, float intensity3, float intensity4, float intensity5, vec2 vTexCoord)",g="fs:DECKGL_PROCESS_INTENSITY(inout float intensity, vec2 contrastLimits, int channelIndex)";n._hookFunctions.includes(i)||n.addShaderHook(i),n._hookFunctions.includes(g)||n.addShaderHook(g)}finalizeState(){super.finalizeState(),this.state.textures&&Object.values(this.state.textures).forEach(t=>t&&t.delete())}updateState(g){var s=g,{props:t,oldProps:e,changeFlags:n}=s,i=Hc(s,["props","oldProps","changeFlags"]);var r,I;if(super.updateState(S({props:t,oldProps:e,changeFlags:n},i)),n.extensionsChanged||t.interpolation!==e.interpolation){const{gl:a}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}(t.channelData!==e.channelData&&((r=t.channelData)==null?void 0:r.data)!==((I=e.channelData)==null?void 0:I.data)||t.interpolation!==e.interpolation)&&this.loadChannelTextures(t.channelData);const o=this.getAttributeManager();t.bounds!==e.bounds&&o.invalidate("positions")}_getModel(t){return t?new Zn(t,J(S({},this.getShaders()),{id:this.props.id,geometry:new ni({drawMode:q.TRIANGLE_FAN,vertexCount:4,attributes:{texCoords:new Float32Array([0,1,0,0,1,0,1,1])}}),isInstanced:!1})):null}calculatePositions(t){const{positions:e}=this.state,{bounds:n}=this.props;e[0]=n[0],e[1]=n[1],e[2]=0,e[3]=n[0],e[4]=n[3],e[5]=0,e[6]=n[2],e[7]=n[3],e[8]=0,e[9]=n[2],e[10]=n[1],e[11]=0,t.value=e}draw({uniforms:t}){const{textures:e,model:n}=this.state;if(e&&n){const{contrastLimits:i,domain:g,dtype:s,channelsVisible:o}=this.props,r=Object.values(e).filter(a=>a).length,I=O2({contrastLimits:i.slice(0,r),channelsVisible:o.slice(0,r),domain:g,dtype:s});n.setUniforms(S(J(S({},t),{contrastLimits:I}),e)).draw()}}loadChannelTextures(t){const e={channel0:null,channel1:null,channel2:null,channel3:null,channel4:null,channel5:null};this.state.textures&&Object.values(this.state.textures).forEach(n=>n&&n.delete()),t&&Object.keys(t).length>0&&t.data&&(t.data.forEach((n,i)=>{e[`channel${i}`]=this.dataToTexture(n,t.width,t.height)},this),this.setState({textures:e}))}dataToTexture(t,e,n){var s,o;const{interpolation:i}=this.props,g=q2(this.props.dtype,this.context.gl,i);return new on(this.context.gl,{width:e,height:n,data:(o=(s=g.cast)==null?void 0:s.call(g,t))!=null?o:t,mipmaps:!1,parameters:{[q.TEXTURE_MIN_FILTER]:g.filter,[q.TEXTURE_MAG_FILTER]:g.filter,[q.TEXTURE_WRAP_S]:q.CLAMP_TO_EDGE,[q.TEXTURE_WRAP_T]:q.CLAMP_TO_EDGE},format:g.format,dataFormat:g.dataFormat,type:g.type})}};dc.layerName="XRLayer";dc.defaultProps=RM;const Ei={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},$2=J(S({},WC.defaultProps),{pickable:{type:"boolean",value:!0,compare:!0},coordinateSystem:ce.CARTESIAN}),FM=(t,e)=>{const n=e?"true":"false",i=`vec3(${(e||[0,0,0]).map(g=>String(g/255)).join(",")})`;switch(t){case Ei.RGB:return`color[3] = (${n} && (color.rgb == ${i})) ? 0.0 : color.a;`;case Ei.WhiteIsZero:return`          float value = 1.0 - (color.r / 256.0);
          color = vec4(value, value, value, (${n} && vec3(value, value, value) == ${i}) ? 0.0 : color.a);
        `;case Ei.BlackIsZero:return`          float value = (color.r / 256.0);
          color = vec4(value, value, value, (${n} && vec3(value, value, value) == ${i}) ? 0.0 : color.a);
        `;case Ei.YCbCr:return`          float y = color[0];
          float cb = color[1];
          float cr = color[2];
          color[0] = (y + (1.40200 * (cr - .5)));
          color[1] = (y - (0.34414 * (cb - .5)) - (0.71414 * (cr - .5)));
          color[2] = (y + (1.77200 * (cb - .5)));
          color[3] = (${n} && distance(color.rgb, ${i}) < 0.01) ? 0.0 : color.a;
        `;default:return console.error("Unsupported photometric interpretation or none provided.  No transformation will be done to image data"),""}},SM=t=>{switch(t){case Ei.RGB:return[0,0,0,0];case Ei.WhiteIsZero:return[255,255,255,0];case Ei.BlackIsZero:return[0,0,0,0];case Ei.YCbCr:return[16,128,128,0];default:return console.error("Unsupported photometric interpretation or none provided.  No transformation will be done to image data"),[0,0,0,0]}};class $h extends WC{_getModel(e){const{photometricInterpretation:n,transparentColorInHook:i}=this.props,g=FM(n,i);return e?new Zn(e,J(S({},this.getShaders()),{id:this.props.id,geometry:new ni({drawMode:q.TRIANGLES,vertexCount:6}),isInstanced:!1,inject:{"fs:DECKGL_FILTER_COLOR":g}})):null}}const ga=class extends kn{initializeState(t){const{gl:e}=this.context;e.pixelStorei(q.UNPACK_ALIGNMENT,1),e.pixelStorei(q.PACK_ALIGNMENT,1),super.initializeState(t)}renderLayers(){const{photometricInterpretation:t,transparentColor:e}=this.props,n=SM(t);return new $h(this.props,{transparentColor:n,transparentColorInHook:e,id:`${this.props.id}-wrapped`})}};ga.layerName="BitmapLayer";ga.PHOTOMETRIC_INTERPRETATIONS=Ei;ga.defaultProps=J(S({},$2),{image:{type:"object",value:{},compare:!0},transparentColor:{type:"array",value:[0,0,0],compare:!0},photometricInterpretation:{type:"number",value:2,compare:!0}});$h.defaultProps=$2;$h.layerName="BitmapLayerWrapper";function Yo(t){const e=t[t.length-1];return e===3||e===4}function VM(t){const e=new Map(t.map((n,i)=>[n,i]));if(e.size!==t.length)throw Error("Labels must be unique, found duplicated label.");return n=>{const i=e.get(n);if(i===void 0)throw Error("Invalid dimension.");return i}}function sa(t){const e=Yo(t.shape),[n,i]=t.shape.slice(e?-3:-2);return{height:n,width:i}}const eR="__vivSignalAborted";function UM(t){const{bbox:{left:e,top:n,right:i,bottom:g},x:s,y:o,z:r}=t.tile,{data:I,id:a,loader:l,maxZoom:C}=t;if([e,g,i,n].some(u=>u<0)||!I)return null;const c=l[0],{height:A,width:d}=sa(c),m=[e,I.height<c.tileSize?A:g,I.width<c.tileSize?d:i,n];if(Yo(c.shape)){const{photometricInterpretation:u=2}=c.meta;return new ga(t,{image:I,photometricInterpretation:u,bounds:m,id:`tile-sub-layer-${m}-${a}`,tileId:{x:s,y:o,z:r}})}return new dc(t,{channelData:I,bounds:m,id:`tile-sub-layer-${m}-${a}`,tileId:{x:s,y:o,z:r},interpolation:r===C?q.NEAREST:q.LINEAR})}const xM={pickable:{type:"boolean",value:!0,compare:!0},coordinateSystem:ce.CARTESIAN,contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},renderSubLayers:{type:"function",value:UM,compare:!1},dtype:{type:"string",value:"Uint16",compare:!0},domain:{type:"array",value:[],compare:!0},viewportId:{type:"string",value:"",compare:!0},interpolation:{type:"number",value:null,compare:!0}};class em extends Gh{_updateTileset(){this.props.viewportId||super._updateTileset(),(this.props.viewportId&&this.context.viewport.id===this.props.viewportId||!this.state.tileset._viewport)&&super._updateTileset()}}em.layerName="MultiscaleImageLayerBase";em.defaultProps=xM;var WM=`#define GLSLIFY 1
uniform float majorLensAxis;uniform float minorLensAxis;uniform vec2 lensCenter;uniform bool lensEnabled;uniform int lensSelection;uniform vec3 lensBorderColor;uniform float lensBorderRadius;uniform vec3 colors[6];bool frag_in_lens_bounds(vec2 vTexCoord){return pow((lensCenter.x-vTexCoord.x)/majorLensAxis,2.)+pow((lensCenter.y-vTexCoord.y)/minorLensAxis,2.)<(1.-lensBorderRadius);}bool frag_on_lens_bounds(vec2 vTexCoord){float ellipseDistance=pow((lensCenter.x-vTexCoord.x)/majorLensAxis,2.)+pow((lensCenter.y-vTexCoord.y)/minorLensAxis,2.);return ellipseDistance<=1.&&ellipseDistance>=(1.-lensBorderRadius);}float get_use_color_float(vec2 vTexCoord,int channelIndex){bool isFragInLensBounds=frag_in_lens_bounds(vTexCoord);bool inLensAndUseLens=lensEnabled&&isFragInLensBounds;return float(int((inLensAndUseLens&&channelIndex==lensSelection)||(!inLensAndUseLens)));}void mutate_color(inout vec3 rgb,float intensity0,float intensity1,float intensity2,float intensity3,float intensity4,float intensity5,vec2 vTexCoord){float useColorValue=0.;useColorValue=get_use_color_float(vTexCoord,0);rgb+=max(0.,min(1.,intensity0))*max(vec3(colors[0]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,1);rgb+=max(0.,min(1.,intensity1))*max(vec3(colors[1]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,2);rgb+=max(0.,min(1.,intensity2))*max(vec3(colors[2]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,3);rgb+=max(0.,min(1.,intensity3))*max(vec3(colors[3]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,4);rgb+=max(0.,min(1.,intensity4))*max(vec3(colors[4]),(1.-useColorValue)*vec3(1.,1.,1.));useColorValue=get_use_color_float(vTexCoord,5);rgb+=max(0.,min(1.,intensity5))*max(vec3(colors[5]),(1.-useColorValue)*vec3(1.,1.,1.));}`,NM={name:"lens-module",fs:WM,inject:{"fs:DECKGL_MUTATE_COLOR":`
   vec3 rgb = rgba.rgb;
   mutate_color(rgb, intensity0, intensity1, intensity2, intensity3, intensity4, intensity5, vTexCoord);
   rgba = vec4(rgb, 1.);
  `,"fs:#main-end":`
      bool isFragOnLensBounds = frag_on_lens_bounds(vTexCoord);
     gl_FragColor = (lensEnabled && isFragOnLensBounds) ? vec4(lensBorderColor, 1.) : gl_FragColor;
  `}};const tR=[[0,0,255],[0,255,0],[255,0,255],[255,255,0],[255,128,0],[0,255,255],[255,255,255],[255,0,0]];function nR(t){if(t>tR.length)throw new Error("Too many colors");return tR.slice(0,t)}function tm({colors:t,channelsVisible:e}){const n=t.map((s,o)=>e[o]?s.map(r=>r/BM):J2),i=D2-n.length;return jh(n,J2,i).reduce((s,o)=>s.concat(o),[])}const _o={lensEnabled:{type:"boolean",value:!1,compare:!0},lensSelection:{type:"number",value:0,compare:!0},lensRadius:{type:"number",value:100,compare:!0},lensBorderColor:{type:"array",value:[255,255,255],compare:!0},lensBorderRadius:{type:"number",value:.02,compare:!0},colors:{type:"array",value:null,compare:!0}},iR=class extends $0{getShaders(){return J(S({},super.getShaders()),{modules:[NM]})}initializeState(){const t=this.getCurrentLayer();if(t.isComposite)return;const e=()=>{const{viewportId:n}=t.props,{lensRadius:i=_o.lensRadius.value}=this.props;if(!n){t.setState({unprojectLensBounds:[0,0,0,0]});return}const{mousePosition:g}=t.context,s=t.context.deck.viewManager.views.filter(I=>I.id===n)[0],o=t.context.deck.viewManager.viewState[n],r=s.makeViewport(J(S({},o),{viewState:o}));if(g&&r.containsPixel(g)){const I={x:g.x-r.x,y:g.y-r.y},l=[[I.x-i,I.y],[I.x,I.y+i],[I.x+i,I.y],[I.x,I.y-i]].map((C,c)=>r.unproject(C)[c%2]);t.setState({unprojectLensBounds:l})}else t.setState({unprojectLensBounds:[0,0,0,0]})};this.context.deck&&this.context.deck.eventManager.on({pointermove:e,pointerleave:e,wheel:e}),this.setState({onMouseMove:e,unprojectLensBounds:[0,0,0,0]})}draw(){var v;const{unprojectLensBounds:t=[0,0,0,0]}=this.state,{bounds:e,lensEnabled:n=_o.lensEnabled.value,lensSelection:i=_o.lensSelection.value,lensBorderColor:g=_o.lensBorderColor.value,lensBorderRadius:s=_o.lensBorderRadius.value,colors:o,channelsVisible:r}=this.props,[I,a,l,C]=t,[c,A,d,m]=e,u=(I-c)/(d-c),h=(a-m)/(A-m),f=(l-c)/(d-c),p=(C-m)/(A-m),b=tm({channelsVisible:r||this.selections.map(()=>!0),colors:o||nR(this.props.selections.length)}),Z={majorLensAxis:(f-u)/2,minorLensAxis:(h-p)/2,lensCenter:[(f+u)/2,(h+p)/2],lensEnabled:n,lensSelection:i,lensBorderColor:g,lensBorderRadius:s,colors:b};(v=this.state.model)==null||v.setUniforms(Z)}finalizeState(){var t,e,n;this.context.deck&&this.context.deck.eventManager.off({pointermove:(t=this.state)==null?void 0:t.onMouseMove,pointerleave:(e=this.state)==null?void 0:e.onMouseMove,wheel:(n=this.state)==null?void 0:n.onMouseMove})}};iR.extensionName="LensExtension";iR.defaultProps=_o;var wM=`#define GLSLIFY 1
vec4 apply_transparent_color_1540259130(vec3 color,vec3 transparentColor,bool useTransparentColor,float opacity){return vec4(color,(color==transparentColor&&useTransparentColor)? 0. : opacity);}uniform vec3 transparentColor;uniform bool useTransparentColor;uniform float opacity;uniform vec3 colors[6];void mutate_color(inout vec3 rgb,float intensity0,float intensity1,float intensity2,float intensity3,float intensity4,float intensity5){rgb+=max(0.0,min(1.0,intensity0))*vec3(colors[0]);rgb+=max(0.0,min(1.0,intensity1))*vec3(colors[1]);rgb+=max(0.0,min(1.0,intensity2))*vec3(colors[2]);rgb+=max(0.0,min(1.0,intensity3))*vec3(colors[3]);rgb+=max(0.0,min(1.0,intensity4))*vec3(colors[4]);rgb+=max(0.0,min(1.0,intensity5))*vec3(colors[5]);}vec4 apply_opacity(vec3 rgb){return vec4(apply_transparent_color_1540259130(rgb,transparentColor,useTransparentColor,opacity));}`,TM={name:"color-palette-module",fs:wM,inject:{"fs:DECKGL_MUTATE_COLOR":`
   vec3 rgb = rgba.rgb;
   mutate_color(rgb, intensity0, intensity1, intensity2, intensity3, intensity4, intensity5);
   rgba = apply_opacity(rgb);
  `}};const uc={colors:{type:"array",value:null,compare:!0},opacity:{type:"number",value:1,compare:!0},transparentColor:{type:"array",value:null,compare:!0},useTransparentColor:{type:"boolean",value:!1,compare:!0}},hc=class extends $0{getShaders(){return J(S({},super.getShaders()),{modules:[TM]})}draw(){var r;const{colors:t,channelsVisible:e,opacity:n=uc.opacity.value,transparentColor:i=uc.transparentColor.value,useTransparentColor:g=uc.useTransparentColor.value}=this.props,o={colors:tm({channelsVisible:e||this.selections.map(()=>!0),colors:t||nR(this.props.selections.length)}),opacity:n,transparentColor:(i||[0,0,0]).map(I=>I/255),useTransparentColor:Boolean(g)};(r=this.state.model)==null||r.setUniforms(o)}};hc.extensionName="ColorPaletteExtension";hc.defaultProps=uc;var EM=`#define GLSLIFY 1
vec4 jet(float x_17){const float e0=0.0;const vec4 v0=vec4(0,0,0.5137254901960784,1);const float e1=0.125;const vec4 v1=vec4(0,0.23529411764705882,0.6666666666666666,1);const float e2=0.375;const vec4 v2=vec4(0.0196078431372549,1,1,1);const float e3=0.625;const vec4 v3=vec4(1,1,0,1);const float e4=0.875;const vec4 v4=vec4(0.9803921568627451,0,0,1);const float e5=1.0;const vec4 v5=vec4(0.5019607843137255,0,0,1);float a0=smoothstep(e0,e1,x_17);float a1=smoothstep(e1,e2,x_17);float a2=smoothstep(e2,e3,x_17);float a3=smoothstep(e3,e4,x_17);float a4=smoothstep(e4,e5,x_17);return max(mix(v0,v1,a0)*step(e0,x_17)*step(x_17,e1),max(mix(v1,v2,a1)*step(e1,x_17)*step(x_17,e2),max(mix(v2,v3,a2)*step(e2,x_17)*step(x_17,e3),max(mix(v3,v4,a3)*step(e3,x_17)*step(x_17,e4),mix(v4,v5,a4)*step(e4,x_17)*step(x_17,e5)))));}vec4 hsv(float x_18){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=0.169;const vec4 v1=vec4(0.9921568627450981,1,0.00784313725490196,1);const float e2=0.173;const vec4 v2=vec4(0.9686274509803922,1,0.00784313725490196,1);const float e3=0.337;const vec4 v3=vec4(0,0.9882352941176471,0.01568627450980392,1);const float e4=0.341;const vec4 v4=vec4(0,0.9882352941176471,0.0392156862745098,1);const float e5=0.506;const vec4 v5=vec4(0.00392156862745098,0.9764705882352941,1,1);const float e6=0.671;const vec4 v6=vec4(0.00784313725490196,0,0.9921568627450981,1);const float e7=0.675;const vec4 v7=vec4(0.03137254901960784,0,0.9921568627450981,1);const float e8=0.839;const vec4 v8=vec4(1,0,0.984313725490196,1);const float e9=0.843;const vec4 v9=vec4(1,0,0.9607843137254902,1);const float e10=1.0;const vec4 v10=vec4(1,0,0.023529411764705882,1);float a0=smoothstep(e0,e1,x_18);float a1=smoothstep(e1,e2,x_18);float a2=smoothstep(e2,e3,x_18);float a3=smoothstep(e3,e4,x_18);float a4=smoothstep(e4,e5,x_18);float a5=smoothstep(e5,e6,x_18);float a6=smoothstep(e6,e7,x_18);float a7=smoothstep(e7,e8,x_18);float a8=smoothstep(e8,e9,x_18);float a9=smoothstep(e9,e10,x_18);return max(mix(v0,v1,a0)*step(e0,x_18)*step(x_18,e1),max(mix(v1,v2,a1)*step(e1,x_18)*step(x_18,e2),max(mix(v2,v3,a2)*step(e2,x_18)*step(x_18,e3),max(mix(v3,v4,a3)*step(e3,x_18)*step(x_18,e4),max(mix(v4,v5,a4)*step(e4,x_18)*step(x_18,e5),max(mix(v5,v6,a5)*step(e5,x_18)*step(x_18,e6),max(mix(v6,v7,a6)*step(e6,x_18)*step(x_18,e7),max(mix(v7,v8,a7)*step(e7,x_18)*step(x_18,e8),max(mix(v8,v9,a8)*step(e8,x_18)*step(x_18,e9),mix(v9,v10,a9)*step(e9,x_18)*step(x_18,e10))))))))));}vec4 hot(float x_13){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.3;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.6;const vec4 v2=vec4(1,0.8235294117647058,0,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_13);float a1=smoothstep(e1,e2,x_13);float a2=smoothstep(e2,e3,x_13);return max(mix(v0,v1,a0)*step(e0,x_13)*step(x_13,e1),max(mix(v1,v2,a1)*step(e1,x_13)*step(x_13,e2),mix(v2,v3,a2)*step(e2,x_13)*step(x_13,e3)));}vec4 cool(float x_24){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.4549019607843137,0,0.8549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.2901960784313726,0.9294117647058824,1);const float e3=0.38;const vec4 v3=vec4(0.26666666666666666,0.5725490196078431,0.9058823529411765,1);const float e4=0.5;const vec4 v4=vec4(0,0.8,0.7725490196078432,1);const float e5=0.63;const vec4 v5=vec4(0,0.9686274509803922,0.5725490196078431,1);const float e6=0.75;const vec4 v6=vec4(0,1,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.1568627450980392,1,0.03137254901960784,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_24);float a1=smoothstep(e1,e2,x_24);float a2=smoothstep(e2,e3,x_24);float a3=smoothstep(e3,e4,x_24);float a4=smoothstep(e4,e5,x_24);float a5=smoothstep(e5,e6,x_24);float a6=smoothstep(e6,e7,x_24);float a7=smoothstep(e7,e8,x_24);return max(mix(v0,v1,a0)*step(e0,x_24)*step(x_24,e1),max(mix(v1,v2,a1)*step(e1,x_24)*step(x_24,e2),max(mix(v2,v3,a2)*step(e2,x_24)*step(x_24,e3),max(mix(v3,v4,a3)*step(e3,x_24)*step(x_24,e4),max(mix(v4,v5,a4)*step(e4,x_24)*step(x_24,e5),max(mix(v5,v6,a5)*step(e5,x_24)*step(x_24,e6),max(mix(v6,v7,a6)*step(e6,x_24)*step(x_24,e7),mix(v7,v8,a7)*step(e7,x_24)*step(x_24,e8))))))));}vec4 spring(float x_5){const float e0=0.0;const vec4 v0=vec4(1,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_5);return mix(v0,v1,a0)*step(e0,x_5)*step(x_5,e1);}vec4 summer(float x_12){const float e0=0.0;const vec4 v0=vec4(0,0.5019607843137255,0.4,1);const float e1=1.0;const vec4 v1=vec4(1,1,0.4,1);float a0=smoothstep(e0,e1,x_12);return mix(v0,v1,a0)*step(e0,x_12)*step(x_12,e1);}vec4 autumn(float x_25){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_25);return mix(v0,v1,a0)*step(e0,x_25)*step(x_25,e1);}vec4 winter(float x_16){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(0,1,0.5019607843137255,1);float a0=smoothstep(e0,e1,x_16);return mix(v0,v1,a0)*step(e0,x_16)*step(x_16,e1);}vec4 bone(float x_15){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.376;const vec4 v1=vec4(0.32941176470588235,0.32941176470588235,0.4549019607843137,1);const float e2=0.753;const vec4 v2=vec4(0.6627450980392157,0.7843137254901961,0.7843137254901961,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_15);float a1=smoothstep(e1,e2,x_15);float a2=smoothstep(e2,e3,x_15);return max(mix(v0,v1,a0)*step(e0,x_15)*step(x_15,e1),max(mix(v1,v2,a1)*step(e1,x_15)*step(x_15,e2),mix(v2,v3,a2)*step(e2,x_15)*step(x_15,e3)));}vec4 copper(float x_10){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.804;const vec4 v1=vec4(1,0.6274509803921569,0.4,1);const float e2=1.0;const vec4 v2=vec4(1,0.7803921568627451,0.4980392156862745,1);float a0=smoothstep(e0,e1,x_10);float a1=smoothstep(e1,e2,x_10);return max(mix(v0,v1,a0)*step(e0,x_10)*step(x_10,e1),mix(v1,v2,a1)*step(e1,x_10)*step(x_10,e2));}vec4 greys(float x_4){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_4);return mix(v0,v1,a0)*step(e0,x_4)*step(x_4,e1);}vec4 yignbu(float x_32){const float e0=0.0;const vec4 v0=vec4(0.03137254901960784,0.11372549019607843,0.34509803921568627,1);const float e1=0.125;const vec4 v1=vec4(0.1450980392156863,0.20392156862745098,0.5803921568627451,1);const float e2=0.25;const vec4 v2=vec4(0.13333333333333333,0.3686274509803922,0.6588235294117647,1);const float e3=0.375;const vec4 v3=vec4(0.11372549019607843,0.5686274509803921,0.7529411764705882,1);const float e4=0.5;const vec4 v4=vec4(0.2549019607843137,0.7137254901960784,0.7686274509803922,1);const float e5=0.625;const vec4 v5=vec4(0.4980392156862745,0.803921568627451,0.7333333333333333,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7058823529411765,1);const float e7=0.875;const vec4 v7=vec4(0.9294117647058824,0.9725490196078431,0.8509803921568627,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8509803921568627,1);float a0=smoothstep(e0,e1,x_32);float a1=smoothstep(e1,e2,x_32);float a2=smoothstep(e2,e3,x_32);float a3=smoothstep(e3,e4,x_32);float a4=smoothstep(e4,e5,x_32);float a5=smoothstep(e5,e6,x_32);float a6=smoothstep(e6,e7,x_32);float a7=smoothstep(e7,e8,x_32);return max(mix(v0,v1,a0)*step(e0,x_32)*step(x_32,e1),max(mix(v1,v2,a1)*step(e1,x_32)*step(x_32,e2),max(mix(v2,v3,a2)*step(e2,x_32)*step(x_32,e3),max(mix(v3,v4,a3)*step(e3,x_32)*step(x_32,e4),max(mix(v4,v5,a4)*step(e4,x_32)*step(x_32,e5),max(mix(v5,v6,a5)*step(e5,x_32)*step(x_32,e6),max(mix(v6,v7,a6)*step(e6,x_32)*step(x_32,e7),mix(v7,v8,a7)*step(e7,x_32)*step(x_32,e8))))))));}vec4 greens(float x_34){const float e0=0.0;const vec4 v0=vec4(0,0.26666666666666666,0.10588235294117647,1);const float e1=0.125;const vec4 v1=vec4(0,0.42745098039215684,0.17254901960784313,1);const float e2=0.25;const vec4 v2=vec4(0.13725490196078433,0.5450980392156862,0.27058823529411763,1);const float e3=0.375;const vec4 v3=vec4(0.2549019607843137,0.6705882352941176,0.36470588235294116,1);const float e4=0.5;const vec4 v4=vec4(0.4549019607843137,0.7686274509803922,0.4627450980392157,1);const float e5=0.625;const vec4 v5=vec4(0.6313725490196078,0.8509803921568627,0.6078431372549019,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7529411764705882,1);const float e7=0.875;const vec4 v7=vec4(0.8980392156862745,0.9607843137254902,0.8784313725490196,1);const float e8=1.0;const vec4 v8=vec4(0.9686274509803922,0.9882352941176471,0.9607843137254902,1);float a0=smoothstep(e0,e1,x_34);float a1=smoothstep(e1,e2,x_34);float a2=smoothstep(e2,e3,x_34);float a3=smoothstep(e3,e4,x_34);float a4=smoothstep(e4,e5,x_34);float a5=smoothstep(e5,e6,x_34);float a6=smoothstep(e6,e7,x_34);float a7=smoothstep(e7,e8,x_34);return max(mix(v0,v1,a0)*step(e0,x_34)*step(x_34,e1),max(mix(v1,v2,a1)*step(e1,x_34)*step(x_34,e2),max(mix(v2,v3,a2)*step(e2,x_34)*step(x_34,e3),max(mix(v3,v4,a3)*step(e3,x_34)*step(x_34,e4),max(mix(v4,v5,a4)*step(e4,x_34)*step(x_34,e5),max(mix(v5,v6,a5)*step(e5,x_34)*step(x_34,e6),max(mix(v6,v7,a6)*step(e6,x_34)*step(x_34,e7),mix(v7,v8,a7)*step(e7,x_34)*step(x_34,e8))))))));}vec4 yiorrd(float x_41){const float e0=0.0;const vec4 v0=vec4(0.5019607843137255,0,0.14901960784313725,1);const float e1=0.125;const vec4 v1=vec4(0.7411764705882353,0,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.8901960784313725,0.10196078431372549,0.10980392156862745,1);const float e3=0.375;const vec4 v3=vec4(0.9882352941176471,0.3058823529411765,0.16470588235294117,1);const float e4=0.5;const vec4 v4=vec4(0.9921568627450981,0.5529411764705883,0.23529411764705882,1);const float e5=0.625;const vec4 v5=vec4(0.996078431372549,0.6980392156862745,0.2980392156862745,1);const float e6=0.75;const vec4 v6=vec4(0.996078431372549,0.8509803921568627,0.4627450980392157,1);const float e7=0.875;const vec4 v7=vec4(1,0.9294117647058824,0.6274509803921569,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8,1);float a0=smoothstep(e0,e1,x_41);float a1=smoothstep(e1,e2,x_41);float a2=smoothstep(e2,e3,x_41);float a3=smoothstep(e3,e4,x_41);float a4=smoothstep(e4,e5,x_41);float a5=smoothstep(e5,e6,x_41);float a6=smoothstep(e6,e7,x_41);float a7=smoothstep(e7,e8,x_41);return max(mix(v0,v1,a0)*step(e0,x_41)*step(x_41,e1),max(mix(v1,v2,a1)*step(e1,x_41)*step(x_41,e2),max(mix(v2,v3,a2)*step(e2,x_41)*step(x_41,e3),max(mix(v3,v4,a3)*step(e3,x_41)*step(x_41,e4),max(mix(v4,v5,a4)*step(e4,x_41)*step(x_41,e5),max(mix(v5,v6,a5)*step(e5,x_41)*step(x_41,e6),max(mix(v6,v7,a6)*step(e6,x_41)*step(x_41,e7),mix(v7,v8,a7)*step(e7,x_41)*step(x_41,e8))))))));}vec4 bluered(float x_23){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_23);return mix(v0,v1,a0)*step(e0,x_23)*step(x_23,e1);}vec4 rdbu(float x_1){const float e0=0.0;const vec4 v0=vec4(0.0196078431372549,0.0392156862745098,0.6745098039215687,1);const float e1=0.35;const vec4 v1=vec4(0.41568627450980394,0.5372549019607843,0.9686274509803922,1);const float e2=0.5;const vec4 v2=vec4(0.7450980392156863,0.7450980392156863,0.7450980392156863,1);const float e3=0.6;const vec4 v3=vec4(0.8627450980392157,0.6666666666666666,0.5176470588235295,1);const float e4=0.7;const vec4 v4=vec4(0.9019607843137255,0.5686274509803921,0.35294117647058826,1);const float e5=1.0;const vec4 v5=vec4(0.6980392156862745,0.0392156862745098,0.10980392156862745,1);float a0=smoothstep(e0,e1,x_1);float a1=smoothstep(e1,e2,x_1);float a2=smoothstep(e2,e3,x_1);float a3=smoothstep(e3,e4,x_1);float a4=smoothstep(e4,e5,x_1);return max(mix(v0,v1,a0)*step(e0,x_1)*step(x_1,e1),max(mix(v1,v2,a1)*step(e1,x_1)*step(x_1,e2),max(mix(v2,v3,a2)*step(e2,x_1)*step(x_1,e3),max(mix(v3,v4,a3)*step(e3,x_1)*step(x_1,e4),mix(v4,v5,a4)*step(e4,x_1)*step(x_1,e5)))));}vec4 picnic(float x_42){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=0.1;const vec4 v1=vec4(0.2,0.6,1,1);const float e2=0.2;const vec4 v2=vec4(0.4,0.8,1,1);const float e3=0.3;const vec4 v3=vec4(0.6,0.8,1,1);const float e4=0.4;const vec4 v4=vec4(0.8,0.8,1,1);const float e5=0.5;const vec4 v5=vec4(1,1,1,1);const float e6=0.6;const vec4 v6=vec4(1,0.8,1,1);const float e7=0.7;const vec4 v7=vec4(1,0.6,1,1);const float e8=0.8;const vec4 v8=vec4(1,0.4,0.8,1);const float e9=0.9;const vec4 v9=vec4(1,0.4,0.4,1);const float e10=1.0;const vec4 v10=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_42);float a1=smoothstep(e1,e2,x_42);float a2=smoothstep(e2,e3,x_42);float a3=smoothstep(e3,e4,x_42);float a4=smoothstep(e4,e5,x_42);float a5=smoothstep(e5,e6,x_42);float a6=smoothstep(e6,e7,x_42);float a7=smoothstep(e7,e8,x_42);float a8=smoothstep(e8,e9,x_42);float a9=smoothstep(e9,e10,x_42);return max(mix(v0,v1,a0)*step(e0,x_42)*step(x_42,e1),max(mix(v1,v2,a1)*step(e1,x_42)*step(x_42,e2),max(mix(v2,v3,a2)*step(e2,x_42)*step(x_42,e3),max(mix(v3,v4,a3)*step(e3,x_42)*step(x_42,e4),max(mix(v4,v5,a4)*step(e4,x_42)*step(x_42,e5),max(mix(v5,v6,a5)*step(e5,x_42)*step(x_42,e6),max(mix(v6,v7,a6)*step(e6,x_42)*step(x_42,e7),max(mix(v7,v8,a7)*step(e7,x_42)*step(x_42,e8),max(mix(v8,v9,a8)*step(e8,x_42)*step(x_42,e9),mix(v9,v10,a9)*step(e9,x_42)*step(x_42,e10))))))))));}vec4 rainbow(float x_31){const float e0=0.0;const vec4 v0=vec4(0.5882352941176471,0,0.35294117647058826,1);const float e1=0.125;const vec4 v1=vec4(0,0,0.7843137254901961,1);const float e2=0.25;const vec4 v2=vec4(0,0.09803921568627451,1,1);const float e3=0.375;const vec4 v3=vec4(0,0.596078431372549,1,1);const float e4=0.5;const vec4 v4=vec4(0.17254901960784313,1,0.5882352941176471,1);const float e5=0.625;const vec4 v5=vec4(0.592156862745098,1,0,1);const float e6=0.75;const vec4 v6=vec4(1,0.9176470588235294,0,1);const float e7=0.875;const vec4 v7=vec4(1,0.43529411764705883,0,1);const float e8=1.0;const vec4 v8=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_31);float a1=smoothstep(e1,e2,x_31);float a2=smoothstep(e2,e3,x_31);float a3=smoothstep(e3,e4,x_31);float a4=smoothstep(e4,e5,x_31);float a5=smoothstep(e5,e6,x_31);float a6=smoothstep(e6,e7,x_31);float a7=smoothstep(e7,e8,x_31);return max(mix(v0,v1,a0)*step(e0,x_31)*step(x_31,e1),max(mix(v1,v2,a1)*step(e1,x_31)*step(x_31,e2),max(mix(v2,v3,a2)*step(e2,x_31)*step(x_31,e3),max(mix(v3,v4,a3)*step(e3,x_31)*step(x_31,e4),max(mix(v4,v5,a4)*step(e4,x_31)*step(x_31,e5),max(mix(v5,v6,a5)*step(e5,x_31)*step(x_31,e6),max(mix(v6,v7,a6)*step(e6,x_31)*step(x_31,e7),mix(v7,v8,a7)*step(e7,x_31)*step(x_31,e8))))))));}vec4 portland(float x_21){const float e0=0.0;const vec4 v0=vec4(0.047058823529411764,0.2,0.5137254901960784,1);const float e1=0.25;const vec4 v1=vec4(0.0392156862745098,0.5333333333333333,0.7294117647058823,1);const float e2=0.5;const vec4 v2=vec4(0.9490196078431372,0.8274509803921568,0.2196078431372549,1);const float e3=0.75;const vec4 v3=vec4(0.9490196078431372,0.5607843137254902,0.2196078431372549,1);const float e4=1.0;const vec4 v4=vec4(0.8509803921568627,0.11764705882352941,0.11764705882352941,1);float a0=smoothstep(e0,e1,x_21);float a1=smoothstep(e1,e2,x_21);float a2=smoothstep(e2,e3,x_21);float a3=smoothstep(e3,e4,x_21);return max(mix(v0,v1,a0)*step(e0,x_21)*step(x_21,e1),max(mix(v1,v2,a1)*step(e1,x_21)*step(x_21,e2),max(mix(v2,v3,a2)*step(e2,x_21)*step(x_21,e3),mix(v3,v4,a3)*step(e3,x_21)*step(x_21,e4))));}vec4 blackbody(float x_38){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.2;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.4;const vec4 v2=vec4(0.9019607843137255,0.8235294117647058,0,1);const float e3=0.7;const vec4 v3=vec4(1,1,1,1);const float e4=1.0;const vec4 v4=vec4(0.6274509803921569,0.7843137254901961,1,1);float a0=smoothstep(e0,e1,x_38);float a1=smoothstep(e1,e2,x_38);float a2=smoothstep(e2,e3,x_38);float a3=smoothstep(e3,e4,x_38);return max(mix(v0,v1,a0)*step(e0,x_38)*step(x_38,e1),max(mix(v1,v2,a1)*step(e1,x_38)*step(x_38,e2),max(mix(v2,v3,a2)*step(e2,x_38)*step(x_38,e3),mix(v3,v4,a3)*step(e3,x_38)*step(x_38,e4))));}vec4 earth(float x_29){const float e0=0.0;const vec4 v0=vec4(0,0,0.5098039215686274,1);const float e1=0.1;const vec4 v1=vec4(0,0.7058823529411765,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(0.1568627450980392,0.8235294117647058,0.1568627450980392,1);const float e3=0.4;const vec4 v3=vec4(0.9019607843137255,0.9019607843137255,0.19607843137254902,1);const float e4=0.6;const vec4 v4=vec4(0.47058823529411764,0.27450980392156865,0.0784313725490196,1);const float e5=1.0;const vec4 v5=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_29);float a1=smoothstep(e1,e2,x_29);float a2=smoothstep(e2,e3,x_29);float a3=smoothstep(e3,e4,x_29);float a4=smoothstep(e4,e5,x_29);return max(mix(v0,v1,a0)*step(e0,x_29)*step(x_29,e1),max(mix(v1,v2,a1)*step(e1,x_29)*step(x_29,e2),max(mix(v2,v3,a2)*step(e2,x_29)*step(x_29,e3),max(mix(v3,v4,a3)*step(e3,x_29)*step(x_29,e4),mix(v4,v5,a4)*step(e4,x_29)*step(x_29,e5)))));}vec4 electric(float x_9){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.15;const vec4 v1=vec4(0.11764705882352941,0,0.39215686274509803,1);const float e2=0.4;const vec4 v2=vec4(0.47058823529411764,0,0.39215686274509803,1);const float e3=0.6;const vec4 v3=vec4(0.6274509803921569,0.35294117647058826,0,1);const float e4=0.8;const vec4 v4=vec4(0.9019607843137255,0.7843137254901961,0,1);const float e5=1.0;const vec4 v5=vec4(1,0.9803921568627451,0.8627450980392157,1);float a0=smoothstep(e0,e1,x_9);float a1=smoothstep(e1,e2,x_9);float a2=smoothstep(e2,e3,x_9);float a3=smoothstep(e3,e4,x_9);float a4=smoothstep(e4,e5,x_9);return max(mix(v0,v1,a0)*step(e0,x_9)*step(x_9,e1),max(mix(v1,v2,a1)*step(e1,x_9)*step(x_9,e2),max(mix(v2,v3,a2)*step(e2,x_9)*step(x_9,e3),max(mix(v3,v4,a3)*step(e3,x_9)*step(x_9,e4),mix(v4,v5,a4)*step(e4,x_9)*step(x_9,e5)))));}vec4 alpha(float x_0){const float e0=0.0;const vec4 v0=vec4(1,1,1,0);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_0);return mix(v0,v1,a0)*step(e0,x_0)*step(x_0,e1);}vec4 viridis(float x_22){const float e0=0.0;const vec4 v0=vec4(0.26666666666666666,0.00392156862745098,0.32941176470588235,1);const float e1=0.13;const vec4 v1=vec4(0.2784313725490196,0.17254901960784313,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.23137254901960785,0.3176470588235294,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.17254901960784313,0.44313725490196076,0.5568627450980392,1);const float e4=0.5;const vec4 v4=vec4(0.12941176470588237,0.5647058823529412,0.5529411764705883,1);const float e5=0.63;const vec4 v5=vec4(0.15294117647058825,0.6784313725490196,0.5058823529411764,1);const float e6=0.75;const vec4 v6=vec4(0.3607843137254902,0.7843137254901961,0.38823529411764707,1);const float e7=0.88;const vec4 v7=vec4(0.6666666666666666,0.8627450980392157,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9058823529411765,0.1450980392156863,1);float a0=smoothstep(e0,e1,x_22);float a1=smoothstep(e1,e2,x_22);float a2=smoothstep(e2,e3,x_22);float a3=smoothstep(e3,e4,x_22);float a4=smoothstep(e4,e5,x_22);float a5=smoothstep(e5,e6,x_22);float a6=smoothstep(e6,e7,x_22);float a7=smoothstep(e7,e8,x_22);return max(mix(v0,v1,a0)*step(e0,x_22)*step(x_22,e1),max(mix(v1,v2,a1)*step(e1,x_22)*step(x_22,e2),max(mix(v2,v3,a2)*step(e2,x_22)*step(x_22,e3),max(mix(v3,v4,a3)*step(e3,x_22)*step(x_22,e4),max(mix(v4,v5,a4)*step(e4,x_22)*step(x_22,e5),max(mix(v5,v6,a5)*step(e5,x_22)*step(x_22,e6),max(mix(v6,v7,a6)*step(e6,x_22)*step(x_22,e7),mix(v7,v8,a7)*step(e7,x_22)*step(x_22,e8))))))));}vec4 inferno(float x_30){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.12156862745098039,0.047058823529411764,0.2823529411764706,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.058823529411764705,0.42745098039215684,1);const float e3=0.38;const vec4 v3=vec4(0.5333333333333333,0.13333333333333333,0.41568627450980394,1);const float e4=0.5;const vec4 v4=vec4(0.7294117647058823,0.21176470588235294,0.3333333333333333,1);const float e5=0.63;const vec4 v5=vec4(0.8901960784313725,0.34901960784313724,0.2,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5490196078431373,0.0392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.788235294117647,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,1,0.6431372549019608,1);float a0=smoothstep(e0,e1,x_30);float a1=smoothstep(e1,e2,x_30);float a2=smoothstep(e2,e3,x_30);float a3=smoothstep(e3,e4,x_30);float a4=smoothstep(e4,e5,x_30);float a5=smoothstep(e5,e6,x_30);float a6=smoothstep(e6,e7,x_30);float a7=smoothstep(e7,e8,x_30);return max(mix(v0,v1,a0)*step(e0,x_30)*step(x_30,e1),max(mix(v1,v2,a1)*step(e1,x_30)*step(x_30,e2),max(mix(v2,v3,a2)*step(e2,x_30)*step(x_30,e3),max(mix(v3,v4,a3)*step(e3,x_30)*step(x_30,e4),max(mix(v4,v5,a4)*step(e4,x_30)*step(x_30,e5),max(mix(v5,v6,a5)*step(e5,x_30)*step(x_30,e6),max(mix(v6,v7,a6)*step(e6,x_30)*step(x_30,e7),mix(v7,v8,a7)*step(e7,x_30)*step(x_30,e8))))))));}vec4 magma(float x_33){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.10980392156862745,0.06274509803921569,0.26666666666666666,1);const float e2=0.25;const vec4 v2=vec4(0.30980392156862746,0.07058823529411765,0.4823529411764706,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.1450980392156863,0.5058823529411764,1);const float e4=0.5;const vec4 v4=vec4(0.7098039215686275,0.21176470588235294,0.47843137254901963,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.3137254901960784,0.39215686274509803,1);const float e6=0.75;const vec4 v6=vec4(0.984313725490196,0.5294117647058824,0.3803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.996078431372549,0.7607843137254902,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,0.9921568627450981,0.7490196078431373,1);float a0=smoothstep(e0,e1,x_33);float a1=smoothstep(e1,e2,x_33);float a2=smoothstep(e2,e3,x_33);float a3=smoothstep(e3,e4,x_33);float a4=smoothstep(e4,e5,x_33);float a5=smoothstep(e5,e6,x_33);float a6=smoothstep(e6,e7,x_33);float a7=smoothstep(e7,e8,x_33);return max(mix(v0,v1,a0)*step(e0,x_33)*step(x_33,e1),max(mix(v1,v2,a1)*step(e1,x_33)*step(x_33,e2),max(mix(v2,v3,a2)*step(e2,x_33)*step(x_33,e3),max(mix(v3,v4,a3)*step(e3,x_33)*step(x_33,e4),max(mix(v4,v5,a4)*step(e4,x_33)*step(x_33,e5),max(mix(v5,v6,a5)*step(e5,x_33)*step(x_33,e6),max(mix(v6,v7,a6)*step(e6,x_33)*step(x_33,e7),mix(v7,v8,a7)*step(e7,x_33)*step(x_33,e8))))))));}vec4 plasma(float x_3){const float e0=0.0;const vec4 v0=vec4(0.050980392156862744,0.03137254901960784,0.5294117647058824,1);const float e1=0.13;const vec4 v1=vec4(0.29411764705882354,0.011764705882352941,0.6313725490196078,1);const float e2=0.25;const vec4 v2=vec4(0.49019607843137253,0.011764705882352941,0.6588235294117647,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.13333333333333333,0.5882352941176471,1);const float e4=0.5;const vec4 v4=vec4(0.796078431372549,0.27450980392156865,0.4745098039215686,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.4196078431372549,0.36470588235294116,1);const float e6=0.75;const vec4 v6=vec4(0.9725490196078431,0.5803921568627451,0.2549019607843137,1);const float e7=0.88;const vec4 v7=vec4(0.9921568627450981,0.7647058823529411,0.1568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9411764705882353,0.9764705882352941,0.12941176470588237,1);float a0=smoothstep(e0,e1,x_3);float a1=smoothstep(e1,e2,x_3);float a2=smoothstep(e2,e3,x_3);float a3=smoothstep(e3,e4,x_3);float a4=smoothstep(e4,e5,x_3);float a5=smoothstep(e5,e6,x_3);float a6=smoothstep(e6,e7,x_3);float a7=smoothstep(e7,e8,x_3);return max(mix(v0,v1,a0)*step(e0,x_3)*step(x_3,e1),max(mix(v1,v2,a1)*step(e1,x_3)*step(x_3,e2),max(mix(v2,v3,a2)*step(e2,x_3)*step(x_3,e3),max(mix(v3,v4,a3)*step(e3,x_3)*step(x_3,e4),max(mix(v4,v5,a4)*step(e4,x_3)*step(x_3,e5),max(mix(v5,v6,a5)*step(e5,x_3)*step(x_3,e6),max(mix(v6,v7,a6)*step(e6,x_3)*step(x_3,e7),mix(v7,v8,a7)*step(e7,x_3)*step(x_3,e8))))))));}vec4 warm(float x_43){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.6745098039215687,0,0.7333333333333333,1);const float e2=0.25;const vec4 v2=vec4(0.8588235294117647,0,0.6666666666666666,1);const float e3=0.38;const vec4 v3=vec4(1,0,0.5098039215686274,1);const float e4=0.5;const vec4 v4=vec4(1,0.24705882352941178,0.2901960784313726,1);const float e5=0.63;const vec4 v5=vec4(1,0.4823529411764706,0,1);const float e6=0.75;const vec4 v6=vec4(0.9176470588235294,0.6901960784313725,0,1);const float e7=0.88;const vec4 v7=vec4(0.7450980392156863,0.8941176470588236,0,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_43);float a1=smoothstep(e1,e2,x_43);float a2=smoothstep(e2,e3,x_43);float a3=smoothstep(e3,e4,x_43);float a4=smoothstep(e4,e5,x_43);float a5=smoothstep(e5,e6,x_43);float a6=smoothstep(e6,e7,x_43);float a7=smoothstep(e7,e8,x_43);return max(mix(v0,v1,a0)*step(e0,x_43)*step(x_43,e1),max(mix(v1,v2,a1)*step(e1,x_43)*step(x_43,e2),max(mix(v2,v3,a2)*step(e2,x_43)*step(x_43,e3),max(mix(v3,v4,a3)*step(e3,x_43)*step(x_43,e4),max(mix(v4,v5,a4)*step(e4,x_43)*step(x_43,e5),max(mix(v5,v6,a5)*step(e5,x_43)*step(x_43,e6),max(mix(v6,v7,a6)*step(e6,x_43)*step(x_43,e7),mix(v7,v8,a7)*step(e7,x_43)*step(x_43,e8))))))));}vec4 rainbow_soft_1310269270(float x_14){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.1;const vec4 v1=vec4(0.7803921568627451,0,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(1,0,0.4745098039215686,1);const float e3=0.3;const vec4 v3=vec4(1,0.4235294117647059,0,1);const float e4=0.4;const vec4 v4=vec4(0.8705882352941177,0.7607843137254902,0,1);const float e5=0.5;const vec4 v5=vec4(0.5882352941176471,1,0,1);const float e6=0.6;const vec4 v6=vec4(0,1,0.21568627450980393,1);const float e7=0.7;const vec4 v7=vec4(0,0.9647058823529412,0.5882352941176471,1);const float e8=0.8;const vec4 v8=vec4(0.19607843137254902,0.6549019607843137,0.8705882352941177,1);const float e9=0.9;const vec4 v9=vec4(0.403921568627451,0.2,0.9215686274509803,1);const float e10=1.0;const vec4 v10=vec4(0.48627450980392156,0,0.7294117647058823,1);float a0=smoothstep(e0,e1,x_14);float a1=smoothstep(e1,e2,x_14);float a2=smoothstep(e2,e3,x_14);float a3=smoothstep(e3,e4,x_14);float a4=smoothstep(e4,e5,x_14);float a5=smoothstep(e5,e6,x_14);float a6=smoothstep(e6,e7,x_14);float a7=smoothstep(e7,e8,x_14);float a8=smoothstep(e8,e9,x_14);float a9=smoothstep(e9,e10,x_14);return max(mix(v0,v1,a0)*step(e0,x_14)*step(x_14,e1),max(mix(v1,v2,a1)*step(e1,x_14)*step(x_14,e2),max(mix(v2,v3,a2)*step(e2,x_14)*step(x_14,e3),max(mix(v3,v4,a3)*step(e3,x_14)*step(x_14,e4),max(mix(v4,v5,a4)*step(e4,x_14)*step(x_14,e5),max(mix(v5,v6,a5)*step(e5,x_14)*step(x_14,e6),max(mix(v6,v7,a6)*step(e6,x_14)*step(x_14,e7),max(mix(v7,v8,a7)*step(e7,x_14)*step(x_14,e8),max(mix(v8,v9,a8)*step(e8,x_14)*step(x_14,e9),mix(v9,v10,a9)*step(e9,x_14)*step(x_14,e10))))))))));}vec4 bathymetry(float x_36){const float e0=0.0;const vec4 v0=vec4(0.1568627450980392,0.10196078431372549,0.17254901960784313,1);const float e1=0.13;const vec4 v1=vec4(0.23137254901960785,0.19215686274509805,0.35294117647058826,1);const float e2=0.25;const vec4 v2=vec4(0.25098039215686274,0.2980392156862745,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.24705882352941178,0.43137254901960786,0.592156862745098,1);const float e4=0.5;const vec4 v4=vec4(0.2823529411764706,0.5568627450980392,0.6196078431372549,1);const float e5=0.63;const vec4 v5=vec4(0.3333333333333333,0.6823529411764706,0.6392156862745098,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.807843137254902,0.6392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.7333333333333333,0.9019607843137255,0.6745098039215687,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.996078431372549,0.8,1);float a0=smoothstep(e0,e1,x_36);float a1=smoothstep(e1,e2,x_36);float a2=smoothstep(e2,e3,x_36);float a3=smoothstep(e3,e4,x_36);float a4=smoothstep(e4,e5,x_36);float a5=smoothstep(e5,e6,x_36);float a6=smoothstep(e6,e7,x_36);float a7=smoothstep(e7,e8,x_36);return max(mix(v0,v1,a0)*step(e0,x_36)*step(x_36,e1),max(mix(v1,v2,a1)*step(e1,x_36)*step(x_36,e2),max(mix(v2,v3,a2)*step(e2,x_36)*step(x_36,e3),max(mix(v3,v4,a3)*step(e3,x_36)*step(x_36,e4),max(mix(v4,v5,a4)*step(e4,x_36)*step(x_36,e5),max(mix(v5,v6,a5)*step(e5,x_36)*step(x_36,e6),max(mix(v6,v7,a6)*step(e6,x_36)*step(x_36,e7),mix(v7,v8,a7)*step(e7,x_36)*step(x_36,e8))))))));}vec4 cdom(float x_7){const float e0=0.0;const vec4 v0=vec4(0.1843137254901961,0.058823529411764705,0.24313725490196078,1);const float e1=0.13;const vec4 v1=vec4(0.3411764705882353,0.09019607843137255,0.33725490196078434,1);const float e2=0.25;const vec4 v2=vec4(0.5098039215686274,0.10980392156862745,0.38823529411764707,1);const float e3=0.38;const vec4 v3=vec4(0.6705882352941176,0.1607843137254902,0.3764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.807843137254902,0.2627450980392157,0.33725490196078434,1);const float e5=0.63;const vec4 v5=vec4(0.9019607843137255,0.41568627450980394,0.32941176470588235,1);const float e6=0.75;const vec4 v6=vec4(0.9490196078431372,0.5843137254901961,0.403921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7568627450980392,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.9294117647058824,0.6901960784313725,1);float a0=smoothstep(e0,e1,x_7);float a1=smoothstep(e1,e2,x_7);float a2=smoothstep(e2,e3,x_7);float a3=smoothstep(e3,e4,x_7);float a4=smoothstep(e4,e5,x_7);float a5=smoothstep(e5,e6,x_7);float a6=smoothstep(e6,e7,x_7);float a7=smoothstep(e7,e8,x_7);return max(mix(v0,v1,a0)*step(e0,x_7)*step(x_7,e1),max(mix(v1,v2,a1)*step(e1,x_7)*step(x_7,e2),max(mix(v2,v3,a2)*step(e2,x_7)*step(x_7,e3),max(mix(v3,v4,a3)*step(e3,x_7)*step(x_7,e4),max(mix(v4,v5,a4)*step(e4,x_7)*step(x_7,e5),max(mix(v5,v6,a5)*step(e5,x_7)*step(x_7,e6),max(mix(v6,v7,a6)*step(e6,x_7)*step(x_7,e7),mix(v7,v8,a7)*step(e7,x_7)*step(x_7,e8))))))));}vec4 chlorophyll(float x_6){const float e0=0.0;const vec4 v0=vec4(0.07058823529411765,0.1411764705882353,0.0784313725490196,1);const float e1=0.13;const vec4 v1=vec4(0.09803921568627451,0.24705882352941178,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.09411764705882353,0.3568627450980392,0.23137254901960785,1);const float e3=0.38;const vec4 v3=vec4(0.050980392156862744,0.4666666666666667,0.2823529411764706,1);const float e4=0.5;const vec4 v4=vec4(0.07058823529411765,0.5803921568627451,0.3137254901960784,1);const float e5=0.63;const vec4 v5=vec4(0.3137254901960784,0.6784313725490196,0.34901960784313724,1);const float e6=0.75;const vec4 v6=vec4(0.5176470588235295,0.7686274509803922,0.47843137254901963,1);const float e7=0.88;const vec4 v7=vec4(0.6862745098039216,0.8666666666666667,0.6352941176470588,1);const float e8=1.0;const vec4 v8=vec4(0.8431372549019608,0.9764705882352941,0.8156862745098039,1);float a0=smoothstep(e0,e1,x_6);float a1=smoothstep(e1,e2,x_6);float a2=smoothstep(e2,e3,x_6);float a3=smoothstep(e3,e4,x_6);float a4=smoothstep(e4,e5,x_6);float a5=smoothstep(e5,e6,x_6);float a6=smoothstep(e6,e7,x_6);float a7=smoothstep(e7,e8,x_6);return max(mix(v0,v1,a0)*step(e0,x_6)*step(x_6,e1),max(mix(v1,v2,a1)*step(e1,x_6)*step(x_6,e2),max(mix(v2,v3,a2)*step(e2,x_6)*step(x_6,e3),max(mix(v3,v4,a3)*step(e3,x_6)*step(x_6,e4),max(mix(v4,v5,a4)*step(e4,x_6)*step(x_6,e5),max(mix(v5,v6,a5)*step(e5,x_6)*step(x_6,e6),max(mix(v6,v7,a6)*step(e6,x_6)*step(x_6,e7),mix(v7,v8,a7)*step(e7,x_6)*step(x_6,e8))))))));}vec4 density(float x_19){const float e0=0.0;const vec4 v0=vec4(0.21176470588235294,0.054901960784313725,0.1411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.34901960784313724,0.09019607843137255,0.3137254901960784,1);const float e2=0.25;const vec4 v2=vec4(0.43137254901960786,0.17647058823529413,0.5176470588235295,1);const float e3=0.38;const vec4 v3=vec4(0.47058823529411764,0.30196078431372547,0.6980392156862745,1);const float e4=0.5;const vec4 v4=vec4(0.47058823529411764,0.44313725490196076,0.8352941176470589,1);const float e5=0.63;const vec4 v5=vec4(0.45098039215686275,0.592156862745098,0.8941176470588236,1);const float e6=0.75;const vec4 v6=vec4(0.5254901960784314,0.7254901960784313,0.8901960784313725,1);const float e7=0.88;const vec4 v7=vec4(0.6941176470588235,0.8392156862745098,0.8901960784313725,1);const float e8=1.0;const vec4 v8=vec4(0.9019607843137255,0.9450980392156862,0.9450980392156862,1);float a0=smoothstep(e0,e1,x_19);float a1=smoothstep(e1,e2,x_19);float a2=smoothstep(e2,e3,x_19);float a3=smoothstep(e3,e4,x_19);float a4=smoothstep(e4,e5,x_19);float a5=smoothstep(e5,e6,x_19);float a6=smoothstep(e6,e7,x_19);float a7=smoothstep(e7,e8,x_19);return max(mix(v0,v1,a0)*step(e0,x_19)*step(x_19,e1),max(mix(v1,v2,a1)*step(e1,x_19)*step(x_19,e2),max(mix(v2,v3,a2)*step(e2,x_19)*step(x_19,e3),max(mix(v3,v4,a3)*step(e3,x_19)*step(x_19,e4),max(mix(v4,v5,a4)*step(e4,x_19)*step(x_19,e5),max(mix(v5,v6,a5)*step(e5,x_19)*step(x_19,e6),max(mix(v6,v7,a6)*step(e6,x_19)*step(x_19,e7),mix(v7,v8,a7)*step(e7,x_19)*step(x_19,e8))))))));}vec4 freesurface_blue_3154355989(float x_35){const float e0=0.0;const vec4 v0=vec4(0.11764705882352941,0.01568627450980392,0.43137254901960786,1);const float e1=0.13;const vec4 v1=vec4(0.1843137254901961,0.054901960784313725,0.6901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.1607843137254902,0.17647058823529413,0.9254901960784314,1);const float e3=0.38;const vec4 v3=vec4(0.09803921568627451,0.38823529411764707,0.8313725490196079,1);const float e4=0.5;const vec4 v4=vec4(0.26666666666666666,0.5137254901960784,0.7843137254901961,1);const float e5=0.63;const vec4 v5=vec4(0.4470588235294118,0.611764705882353,0.7725490196078432,1);const float e6=0.75;const vec4 v6=vec4(0.615686274509804,0.7098039215686275,0.796078431372549,1);const float e7=0.88;const vec4 v7=vec4(0.7843137254901961,0.8156862745098039,0.8470588235294118,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_35);float a1=smoothstep(e1,e2,x_35);float a2=smoothstep(e2,e3,x_35);float a3=smoothstep(e3,e4,x_35);float a4=smoothstep(e4,e5,x_35);float a5=smoothstep(e5,e6,x_35);float a6=smoothstep(e6,e7,x_35);float a7=smoothstep(e7,e8,x_35);return max(mix(v0,v1,a0)*step(e0,x_35)*step(x_35,e1),max(mix(v1,v2,a1)*step(e1,x_35)*step(x_35,e2),max(mix(v2,v3,a2)*step(e2,x_35)*step(x_35,e3),max(mix(v3,v4,a3)*step(e3,x_35)*step(x_35,e4),max(mix(v4,v5,a4)*step(e4,x_35)*step(x_35,e5),max(mix(v5,v6,a5)*step(e5,x_35)*step(x_35,e6),max(mix(v6,v7,a6)*step(e6,x_35)*step(x_35,e7),mix(v7,v8,a7)*step(e7,x_35)*step(x_35,e8))))))));}vec4 freesurface_red_1679163293(float x_20){const float e0=0.0;const vec4 v0=vec4(0.23529411764705882,0.03529411764705882,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.39215686274509803,0.06666666666666667,0.10588235294117647,1);const float e2=0.25;const vec4 v2=vec4(0.5568627450980392,0.0784313725490196,0.11372549019607843,1);const float e3=0.38;const vec4 v3=vec4(0.6941176470588235,0.16862745098039217,0.10588235294117647,1);const float e4=0.5;const vec4 v4=vec4(0.7529411764705882,0.3411764705882353,0.24705882352941178,1);const float e5=0.63;const vec4 v5=vec4(0.803921568627451,0.49019607843137253,0.4117647058823529,1);const float e6=0.75;const vec4 v6=vec4(0.8470588235294118,0.6352941176470588,0.5803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.8901960784313725,0.7803921568627451,0.7568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_20);float a1=smoothstep(e1,e2,x_20);float a2=smoothstep(e2,e3,x_20);float a3=smoothstep(e3,e4,x_20);float a4=smoothstep(e4,e5,x_20);float a5=smoothstep(e5,e6,x_20);float a6=smoothstep(e6,e7,x_20);float a7=smoothstep(e7,e8,x_20);return max(mix(v0,v1,a0)*step(e0,x_20)*step(x_20,e1),max(mix(v1,v2,a1)*step(e1,x_20)*step(x_20,e2),max(mix(v2,v3,a2)*step(e2,x_20)*step(x_20,e3),max(mix(v3,v4,a3)*step(e3,x_20)*step(x_20,e4),max(mix(v4,v5,a4)*step(e4,x_20)*step(x_20,e5),max(mix(v5,v6,a5)*step(e5,x_20)*step(x_20,e6),max(mix(v6,v7,a6)*step(e6,x_20)*step(x_20,e7),mix(v7,v8,a7)*step(e7,x_20)*step(x_20,e8))))))));}vec4 oxygen(float x_11){const float e0=0.0;const vec4 v0=vec4(0.25098039215686274,0.0196078431372549,0.0196078431372549,1);const float e1=0.13;const vec4 v1=vec4(0.41568627450980394,0.023529411764705882,0.058823529411764705,1);const float e2=0.25;const vec4 v2=vec4(0.5647058823529412,0.10196078431372549,0.027450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.25098039215686274,0.011764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.7372549019607844,0.39215686274509803,0.01568627450980392,1);const float e5=0.63;const vec4 v5=vec4(0.807843137254902,0.5333333333333333,0.043137254901960784,1);const float e6=0.75;const vec4 v6=vec4(0.8627450980392157,0.6823529411764706,0.09803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9058823529411765,0.8431372549019608,0.17254901960784313,1);const float e8=1.0;const vec4 v8=vec4(0.9725490196078431,0.996078431372549,0.4117647058823529,1);float a0=smoothstep(e0,e1,x_11);float a1=smoothstep(e1,e2,x_11);float a2=smoothstep(e2,e3,x_11);float a3=smoothstep(e3,e4,x_11);float a4=smoothstep(e4,e5,x_11);float a5=smoothstep(e5,e6,x_11);float a6=smoothstep(e6,e7,x_11);float a7=smoothstep(e7,e8,x_11);return max(mix(v0,v1,a0)*step(e0,x_11)*step(x_11,e1),max(mix(v1,v2,a1)*step(e1,x_11)*step(x_11,e2),max(mix(v2,v3,a2)*step(e2,x_11)*step(x_11,e3),max(mix(v3,v4,a3)*step(e3,x_11)*step(x_11,e4),max(mix(v4,v5,a4)*step(e4,x_11)*step(x_11,e5),max(mix(v5,v6,a5)*step(e5,x_11)*step(x_11,e6),max(mix(v6,v7,a6)*step(e6,x_11)*step(x_11,e7),mix(v7,v8,a7)*step(e7,x_11)*step(x_11,e8))))))));}vec4 par(float x_28){const float e0=0.0;const vec4 v0=vec4(0.2,0.0784313725490196,0.09411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.35294117647058826,0.12549019607843137,0.13725490196078433,1);const float e2=0.25;const vec4 v2=vec4(0.5058823529411764,0.17254901960784313,0.13333333333333333,1);const float e3=0.38;const vec4 v3=vec4(0.6235294117647059,0.26666666666666666,0.09803921568627451,1);const float e4=0.5;const vec4 v4=vec4(0.7137254901960784,0.38823529411764707,0.07450980392156863,1);const float e5=0.63;const vec4 v5=vec4(0.7803921568627451,0.5254901960784314,0.08627450980392157,1);const float e6=0.75;const vec4 v6=vec4(0.8313725490196079,0.6705882352941176,0.13725490196078433,1);const float e7=0.88;const vec4 v7=vec4(0.8666666666666667,0.8235294117647058,0.21176470588235294,1);const float e8=1.0;const vec4 v8=vec4(0.8823529411764706,0.9921568627450981,0.29411764705882354,1);float a0=smoothstep(e0,e1,x_28);float a1=smoothstep(e1,e2,x_28);float a2=smoothstep(e2,e3,x_28);float a3=smoothstep(e3,e4,x_28);float a4=smoothstep(e4,e5,x_28);float a5=smoothstep(e5,e6,x_28);float a6=smoothstep(e6,e7,x_28);float a7=smoothstep(e7,e8,x_28);return max(mix(v0,v1,a0)*step(e0,x_28)*step(x_28,e1),max(mix(v1,v2,a1)*step(e1,x_28)*step(x_28,e2),max(mix(v2,v3,a2)*step(e2,x_28)*step(x_28,e3),max(mix(v3,v4,a3)*step(e3,x_28)*step(x_28,e4),max(mix(v4,v5,a4)*step(e4,x_28)*step(x_28,e5),max(mix(v5,v6,a5)*step(e5,x_28)*step(x_28,e6),max(mix(v6,v7,a6)*step(e6,x_28)*step(x_28,e7),mix(v7,v8,a7)*step(e7,x_28)*step(x_28,e8))))))));}vec4 phase(float x_39){const float e0=0.0;const vec4 v0=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.7215686274509804,0.2784313725490196,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.7294117647058823,0.22745098039215686,0.45098039215686275,1);const float e3=0.38;const vec4 v3=vec4(0.6274509803921569,0.2784313725490196,0.7254901960784313,1);const float e4=0.5;const vec4 v4=vec4(0.43137254901960786,0.3803921568627451,0.8549019607843137,1);const float e5=0.63;const vec4 v5=vec4(0.19607843137254902,0.4823529411764706,0.6431372549019608,1);const float e6=0.75;const vec4 v6=vec4(0.12156862745098039,0.5137254901960784,0.43137254901960786,1);const float e7=0.88;const vec4 v7=vec4(0.30196078431372547,0.5058823529411764,0.13333333333333333,1);const float e8=1.0;const vec4 v8=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);float a0=smoothstep(e0,e1,x_39);float a1=smoothstep(e1,e2,x_39);float a2=smoothstep(e2,e3,x_39);float a3=smoothstep(e3,e4,x_39);float a4=smoothstep(e4,e5,x_39);float a5=smoothstep(e5,e6,x_39);float a6=smoothstep(e6,e7,x_39);float a7=smoothstep(e7,e8,x_39);return max(mix(v0,v1,a0)*step(e0,x_39)*step(x_39,e1),max(mix(v1,v2,a1)*step(e1,x_39)*step(x_39,e2),max(mix(v2,v3,a2)*step(e2,x_39)*step(x_39,e3),max(mix(v3,v4,a3)*step(e3,x_39)*step(x_39,e4),max(mix(v4,v5,a4)*step(e4,x_39)*step(x_39,e5),max(mix(v5,v6,a5)*step(e5,x_39)*step(x_39,e6),max(mix(v6,v7,a6)*step(e6,x_39)*step(x_39,e7),mix(v7,v8,a7)*step(e7,x_39)*step(x_39,e8))))))));}vec4 salinity(float x_26){const float e0=0.0;const vec4 v0=vec4(0.16470588235294117,0.09411764705882353,0.4235294117647059,1);const float e1=0.13;const vec4 v1=vec4(0.12941176470588237,0.19607843137254902,0.6352941176470588,1);const float e2=0.25;const vec4 v2=vec4(0.058823529411764705,0.35294117647058826,0.5686274509803921,1);const float e3=0.38;const vec4 v3=vec4(0.1568627450980392,0.4627450980392157,0.5372549019607843,1);const float e4=0.5;const vec4 v4=vec4(0.23137254901960785,0.5725490196078431,0.5294117647058824,1);const float e5=0.63;const vec4 v5=vec4(0.30980392156862746,0.6862745098039216,0.49411764705882355,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.796078431372549,0.40784313725490196,1);const float e7=0.88;const vec4 v7=vec4(0.7568627450980392,0.8666666666666667,0.39215686274509803,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9372549019607843,0.6039215686274509,1);float a0=smoothstep(e0,e1,x_26);float a1=smoothstep(e1,e2,x_26);float a2=smoothstep(e2,e3,x_26);float a3=smoothstep(e3,e4,x_26);float a4=smoothstep(e4,e5,x_26);float a5=smoothstep(e5,e6,x_26);float a6=smoothstep(e6,e7,x_26);float a7=smoothstep(e7,e8,x_26);return max(mix(v0,v1,a0)*step(e0,x_26)*step(x_26,e1),max(mix(v1,v2,a1)*step(e1,x_26)*step(x_26,e2),max(mix(v2,v3,a2)*step(e2,x_26)*step(x_26,e3),max(mix(v3,v4,a3)*step(e3,x_26)*step(x_26,e4),max(mix(v4,v5,a4)*step(e4,x_26)*step(x_26,e5),max(mix(v5,v6,a5)*step(e5,x_26)*step(x_26,e6),max(mix(v6,v7,a6)*step(e6,x_26)*step(x_26,e7),mix(v7,v8,a7)*step(e7,x_26)*step(x_26,e8))))))));}vec4 temperature(float x_8){const float e0=0.0;const vec4 v0=vec4(0.01568627450980392,0.13725490196078433,0.2,1);const float e1=0.13;const vec4 v1=vec4(0.09019607843137255,0.2,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.23137254901960785,0.615686274509804,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.30980392156862746,0.5607843137254902,1);const float e4=0.5;const vec4 v4=vec4(0.6862745098039216,0.37254901960784315,0.5098039215686274,1);const float e5=0.63;const vec4 v5=vec4(0.8705882352941177,0.4392156862745098,0.396078431372549,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5725490196078431,0.25882352941176473,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7686274509803922,0.2549019607843137,1);const float e8=1.0;const vec4 v8=vec4(0.9098039215686274,0.9803921568627451,0.3568627450980392,1);float a0=smoothstep(e0,e1,x_8);float a1=smoothstep(e1,e2,x_8);float a2=smoothstep(e2,e3,x_8);float a3=smoothstep(e3,e4,x_8);float a4=smoothstep(e4,e5,x_8);float a5=smoothstep(e5,e6,x_8);float a6=smoothstep(e6,e7,x_8);float a7=smoothstep(e7,e8,x_8);return max(mix(v0,v1,a0)*step(e0,x_8)*step(x_8,e1),max(mix(v1,v2,a1)*step(e1,x_8)*step(x_8,e2),max(mix(v2,v3,a2)*step(e2,x_8)*step(x_8,e3),max(mix(v3,v4,a3)*step(e3,x_8)*step(x_8,e4),max(mix(v4,v5,a4)*step(e4,x_8)*step(x_8,e5),max(mix(v5,v6,a5)*step(e5,x_8)*step(x_8,e6),max(mix(v6,v7,a6)*step(e6,x_8)*step(x_8,e7),mix(v7,v8,a7)*step(e7,x_8)*step(x_8,e8))))))));}vec4 turbidity(float x_40){const float e0=0.0;const vec4 v0=vec4(0.13333333333333333,0.12156862745098039,0.10588235294117647,1);const float e1=0.13;const vec4 v1=vec4(0.2549019607843137,0.19607843137254902,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.27058823529411763,0.20392156862745098,1);const float e3=0.38;const vec4 v3=vec4(0.5137254901960784,0.34901960784313724,0.2235294117647059,1);const float e4=0.5;const vec4 v4=vec4(0.6313725490196078,0.4392156862745098,0.23137254901960785,1);const float e5=0.63;const vec4 v5=vec4(0.7254901960784313,0.5490196078431373,0.25882352941176473,1);const float e6=0.75;const vec4 v6=vec4(0.792156862745098,0.6823529411764706,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.8470588235294118,0.8196078431372549,0.49411764705882355,1);const float e8=1.0;const vec4 v8=vec4(0.9137254901960784,0.9647058823529412,0.6705882352941176,1);float a0=smoothstep(e0,e1,x_40);float a1=smoothstep(e1,e2,x_40);float a2=smoothstep(e2,e3,x_40);float a3=smoothstep(e3,e4,x_40);float a4=smoothstep(e4,e5,x_40);float a5=smoothstep(e5,e6,x_40);float a6=smoothstep(e6,e7,x_40);float a7=smoothstep(e7,e8,x_40);return max(mix(v0,v1,a0)*step(e0,x_40)*step(x_40,e1),max(mix(v1,v2,a1)*step(e1,x_40)*step(x_40,e2),max(mix(v2,v3,a2)*step(e2,x_40)*step(x_40,e3),max(mix(v3,v4,a3)*step(e3,x_40)*step(x_40,e4),max(mix(v4,v5,a4)*step(e4,x_40)*step(x_40,e5),max(mix(v5,v6,a5)*step(e5,x_40)*step(x_40,e6),max(mix(v6,v7,a6)*step(e6,x_40)*step(x_40,e7),mix(v7,v8,a7)*step(e7,x_40)*step(x_40,e8))))))));}vec4 velocity_blue_297387650(float x_2){const float e0=0.0;const vec4 v0=vec4(0.06666666666666667,0.12549019607843137,0.25098039215686274,1);const float e1=0.13;const vec4 v1=vec4(0.13725490196078433,0.20392156862745098,0.4549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.11372549019607843,0.3176470588235294,0.611764705882353,1);const float e3=0.38;const vec4 v3=vec4(0.12156862745098039,0.44313725490196076,0.6352941176470588,1);const float e4=0.5;const vec4 v4=vec4(0.19607843137254902,0.5647058823529412,0.6627450980392157,1);const float e5=0.63;const vec4 v5=vec4(0.3411764705882353,0.6784313725490196,0.6901960784313725,1);const float e6=0.75;const vec4 v6=vec4(0.5843137254901961,0.7686274509803922,0.7411764705882353,1);const float e7=0.88;const vec4 v7=vec4(0.796078431372549,0.8666666666666667,0.8274509803921568,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.984313725490196,0.9019607843137255,1);float a0=smoothstep(e0,e1,x_2);float a1=smoothstep(e1,e2,x_2);float a2=smoothstep(e2,e3,x_2);float a3=smoothstep(e3,e4,x_2);float a4=smoothstep(e4,e5,x_2);float a5=smoothstep(e5,e6,x_2);float a6=smoothstep(e6,e7,x_2);float a7=smoothstep(e7,e8,x_2);return max(mix(v0,v1,a0)*step(e0,x_2)*step(x_2,e1),max(mix(v1,v2,a1)*step(e1,x_2)*step(x_2,e2),max(mix(v2,v3,a2)*step(e2,x_2)*step(x_2,e3),max(mix(v3,v4,a3)*step(e3,x_2)*step(x_2,e4),max(mix(v4,v5,a4)*step(e4,x_2)*step(x_2,e5),max(mix(v5,v6,a5)*step(e5,x_2)*step(x_2,e6),max(mix(v6,v7,a6)*step(e6,x_2)*step(x_2,e7),mix(v7,v8,a7)*step(e7,x_2)*step(x_2,e8))))))));}vec4 velocity_green_2558432129(float x_27){const float e0=0.0;const vec4 v0=vec4(0.09019607843137255,0.13725490196078433,0.07450980392156863,1);const float e1=0.13;const vec4 v1=vec4(0.09411764705882353,0.25098039215686274,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.043137254901960784,0.37254901960784315,0.17647058823529413,1);const float e3=0.38;const vec4 v3=vec4(0.15294117647058825,0.4823529411764706,0.13725490196078433,1);const float e4=0.5;const vec4 v4=vec4(0.37254901960784315,0.5725490196078431,0.047058823529411764,1);const float e5=0.63;const vec4 v5=vec4(0.596078431372549,0.6470588235294118,0.07058823529411765,1);const float e6=0.75;const vec4 v6=vec4(0.788235294117647,0.7294117647058823,0.27058823529411763,1);const float e7=0.88;const vec4 v7=vec4(0.9137254901960784,0.8470588235294118,0.5372549019607843,1);const float e8=1.0;const vec4 v8=vec4(1,0.9921568627450981,0.803921568627451,1);float a0=smoothstep(e0,e1,x_27);float a1=smoothstep(e1,e2,x_27);float a2=smoothstep(e2,e3,x_27);float a3=smoothstep(e3,e4,x_27);float a4=smoothstep(e4,e5,x_27);float a5=smoothstep(e5,e6,x_27);float a6=smoothstep(e6,e7,x_27);float a7=smoothstep(e7,e8,x_27);return max(mix(v0,v1,a0)*step(e0,x_27)*step(x_27,e1),max(mix(v1,v2,a1)*step(e1,x_27)*step(x_27,e2),max(mix(v2,v3,a2)*step(e2,x_27)*step(x_27,e3),max(mix(v3,v4,a3)*step(e3,x_27)*step(x_27,e4),max(mix(v4,v5,a4)*step(e4,x_27)*step(x_27,e5),max(mix(v5,v6,a5)*step(e5,x_27)*step(x_27,e6),max(mix(v6,v7,a6)*step(e6,x_27)*step(x_27,e7),mix(v7,v8,a7)*step(e7,x_27)*step(x_27,e8))))))));}vec4 cubehelix(float x_37){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.07;const vec4 v1=vec4(0.08627450980392157,0.0196078431372549,0.23137254901960785,1);const float e2=0.13;const vec4 v2=vec4(0.23529411764705882,0.01568627450980392,0.4117647058823529,1);const float e3=0.2;const vec4 v3=vec4(0.42745098039215684,0.00392156862745098,0.5294117647058824,1);const float e4=0.27;const vec4 v4=vec4(0.6313725490196078,0,0.5764705882352941,1);const float e5=0.33;const vec4 v5=vec4(0.8235294117647058,0.00784313725490196,0.5568627450980392,1);const float e6=0.4;const vec4 v6=vec4(0.984313725490196,0.043137254901960784,0.4823529411764706,1);const float e7=0.47;const vec4 v7=vec4(1,0.11372549019607843,0.3803921568627451,1);const float e8=0.53;const vec4 v8=vec4(1,0.21176470588235294,0.27058823529411763,1);const float e9=0.6;const vec4 v9=vec4(1,0.3333333333333333,0.1803921568627451,1);const float e10=0.67;const vec4 v10=vec4(1,0.47058823529411764,0.13333333333333333,1);const float e11=0.73;const vec4 v11=vec4(1,0.615686274509804,0.1450980392156863,1);const float e12=0.8;const vec4 v12=vec4(0.9450980392156862,0.7490196078431373,0.2235294117647059,1);const float e13=0.87;const vec4 v13=vec4(0.8784313725490196,0.8627450980392157,0.36470588235294116,1);const float e14=0.93;const vec4 v14=vec4(0.8549019607843137,0.9450980392156862,0.5568627450980392,1);const float e15=1.0;const vec4 v15=vec4(0.8901960784313725,0.9921568627450981,0.7764705882352941,1);float a0=smoothstep(e0,e1,x_37);float a1=smoothstep(e1,e2,x_37);float a2=smoothstep(e2,e3,x_37);float a3=smoothstep(e3,e4,x_37);float a4=smoothstep(e4,e5,x_37);float a5=smoothstep(e5,e6,x_37);float a6=smoothstep(e6,e7,x_37);float a7=smoothstep(e7,e8,x_37);float a8=smoothstep(e8,e9,x_37);float a9=smoothstep(e9,e10,x_37);float a10=smoothstep(e10,e11,x_37);float a11=smoothstep(e11,e12,x_37);float a12=smoothstep(e12,e13,x_37);float a13=smoothstep(e13,e14,x_37);float a14=smoothstep(e14,e15,x_37);return max(mix(v0,v1,a0)*step(e0,x_37)*step(x_37,e1),max(mix(v1,v2,a1)*step(e1,x_37)*step(x_37,e2),max(mix(v2,v3,a2)*step(e2,x_37)*step(x_37,e3),max(mix(v3,v4,a3)*step(e3,x_37)*step(x_37,e4),max(mix(v4,v5,a4)*step(e4,x_37)*step(x_37,e5),max(mix(v5,v6,a5)*step(e5,x_37)*step(x_37,e6),max(mix(v6,v7,a6)*step(e6,x_37)*step(x_37,e7),max(mix(v7,v8,a7)*step(e7,x_37)*step(x_37,e8),max(mix(v8,v9,a8)*step(e8,x_37)*step(x_37,e9),max(mix(v9,v10,a9)*step(e9,x_37)*step(x_37,e10),max(mix(v10,v11,a10)*step(e10,x_37)*step(x_37,e11),max(mix(v11,v12,a11)*step(e11,x_37)*step(x_37,e12),max(mix(v12,v13,a12)*step(e12,x_37)*step(x_37,e13),max(mix(v13,v14,a13)*step(e13,x_37)*step(x_37,e14),mix(v14,v15,a14)*step(e14,x_37)*step(x_37,e15)))))))))))))));}vec4 apply_transparent_color_452471729(vec3 color,vec3 transparentColor,bool useTransparentColor,float opacity){return vec4(color,(color==transparentColor&&useTransparentColor)? 0. : opacity);}uniform float opacity;uniform bool useTransparentColor;vec4 colormap(float intensity){return vec4(apply_transparent_color_452471729(COLORMAP_FUNCTION(min(1.,intensity)).xyz,COLORMAP_FUNCTION(0.).xyz,useTransparentColor,opacity));}`,QM={name:"additive-colormap",fs:EM,inject:{"fs:DECKGL_MUTATE_COLOR":`
  float intensityCombo = 0.;
  intensityCombo += max(0.,intensity0);
  intensityCombo += max(0.,intensity1);
  intensityCombo += max(0.,intensity2);
  intensityCombo += max(0.,intensity3);
  intensityCombo += max(0.,intensity4);
  intensityCombo += max(0.,intensity5);
  rgba = colormap(intensityCombo);
`}};const mc={colormap:{type:"string",value:"viridis",compare:!0},opacity:{type:"number",value:1,compare:!0},useTransparentColor:{type:"boolean",value:!1,compare:!0}},gR=class extends $0{getShaders(){var t;return{defines:{COLORMAP_FUNCTION:((t=this==null?void 0:this.props)==null?void 0:t.colormap)||mc.colormap.value},modules:[QM]}}updateState(g){var s=g,{props:t,oldProps:e,changeFlags:n}=s,i=Hc(s,["props","oldProps","changeFlags"]);if(super.updateState(S({props:t,oldProps:e,changeFlags:n},i)),t.colormap!==e.colormap){const{gl:o}=this.context;this.state.model&&(this.state.model.delete(),this.setState({model:this._getModel(o)}))}}draw(){var i;const{useTransparentColor:t=mc.useTransparentColor.value,opacity:e=mc.opacity.value}=this.props,n={opacity:e,useTransparentColor:t};(i=this.state.model)==null||i.setUniforms(n)}};gR.extensionName="AdditiveColormapExtension";gR.defaultProps=mc;const XM={pickable:{type:"boolean",value:!0,compare:!0},coordinateSystem:ce.CARTESIAN,contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},selections:{type:"array",value:[],compare:!0},domain:{type:"array",value:[],compare:!0},viewportId:{type:"string",value:"",compare:!0},loader:{type:"object",value:{getRaster:async()=>({data:[],height:0,width:0}),dtype:"Uint16"},compare:!0},onClick:{type:"function",value:null,compare:!0},onViewportLoad:{type:"function",value:null,compare:!0},interpolation:{type:"number",value:q.NEAREST,compare:!0},extensions:{type:"array",value:[new hc],compare:!0}},fc=class extends kn{finalizeState(){this.state.abortController.abort()}updateState({props:t,oldProps:e}){const n=t.loader!==e.loader,i=t.selections!==e.selections;if(n||i){const{loader:g,selections:s=[],onViewportLoad:o}=this.props,r=new AbortController;this.setState({abortController:r});const{signal:I}=r,a=C=>g.getRaster({selection:C,signal:I}),l=s.map(a);Promise.all(l).then(C=>{const c={data:C.map(A=>A.data),width:C[0].width,height:C[0].height};Yo(g.shape)&&(c.data=c.data[0],c.data.length===c.width*c.height*3&&(c.format=q.RGB,c.dataFormat=q.RGB)),o&&o(c),this.setState(S({},c))}).catch(C=>{if(C!==eR)throw C})}}getPickingInfo({info:t,sourceLayer:e}){return t.sourceLayer=e,t.tile=e.props.tile,t}renderLayers(){const{loader:t,id:e}=this.props,{dtype:n}=t,{width:i,height:g,data:s}=this.state;if(!(i&&g))return null;const o=[0,g,i,0];if(Yo(t.shape)){const{photometricInterpretation:r=2}=t.meta;return new ga(this.props,{image:this.state,photometricInterpretation:r,bounds:o,id:`image-sub-layer-${o}-${e}`})}return new dc(this.props,{channelData:{data:s,height:g,width:i},bounds:o,id:`image-sub-layer-${o}-${e}`,dtype:n})}};fc.layerName="ImageLayer";fc.defaultProps=XM;const YM={pickable:{type:"boolean",value:!0,compare:!0},onHover:{type:"function",value:null,compare:!1},contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},domain:{type:"array",value:[],compare:!0},viewportId:{type:"string",value:"",compare:!0},maxRequests:{type:"number",value:10,compare:!0},onClick:{type:"function",value:null,compare:!0},refinementStrategy:{type:"string",value:null,compare:!0},excludeBackground:{type:"boolean",value:!1,compare:!0},extensions:{type:"array",value:[new hc],compare:!0}},sR=class extends kn{renderLayers(){const{loader:t,selections:e,opacity:n,viewportId:i,onTileError:g,onHover:s,id:o,onClick:r,modelMatrix:I,excludeBackground:a,refinementStrategy:l}=this.props,{tileSize:C,dtype:c}=t[0],A=async({x:v,y:N,z:x,signal:V})=>{if(!e||e.length===0)return null;const E=Math.round(-x),D=_=>{const k={x:v,y:N,selection:_,signal:V};return t[E].getTile(k)};try{const _=await Promise.all(e.map(D)),k={data:_.map(z=>z.data),width:_[0].width,height:_[0].height};return Yo(t[E].shape)&&(k.data=k.data[0],k.data.length===k.width*k.height*3&&(k.format=q.RGB,k.dataFormat=q.RGB)),k}catch(_){if(_===eR)return null;throw _}},{height:d,width:m}=sa(t[0]),u=new em(this.props,{id:`Tiled-Image-${o}`,getTileData:A,dtype:c,tileSize:C,zoomOffset:Math.round(Math.log2(I?I.getScale()[0]:1)),extent:[0,0,m,d],minZoom:Math.round(-(t.length-1)),maxZoom:0,refinementStrategy:l||(n===1?"best-available":"no-overlap"),updateTriggers:{getTileData:[t,e]},onTileError:g||t[0].onTileError}),h=t[t.length-1],f=typeof h.getRaster=="function",p=I?I.clone():new Pe;return[f&&!a&&new fc(this.props,{id:`Background-Image-${o}`,loader:h,modelMatrix:p.scale(2**(t.length-1)),visible:!i||this.context.viewport.id===i,onHover:s,onClick:r,interpolation:q.LINEAR,onViewportLoad:null}),u]}};sR.layerName="MultiscaleImageLayer";sR.defaultProps=YM;const _M={pickable:{type:"boolean",value:!0,compare:!0},loader:{type:"object",value:{getRaster:async()=>({data:[],height:0,width:0}),getRasterSize:()=>({height:0,width:0}),dtype:"<u2"},compare:!0},id:{type:"string",value:"",compare:!0},boundingBox:{type:"array",value:[[0,0],[0,1],[1,1],[1,0]],compare:!0},boundingBoxColor:{type:"array",value:[255,0,0],compare:!0},boundingBoxOutlineWidth:{type:"number",value:1,compare:!0},viewportOutlineColor:{type:"array",value:[255,190,0],compare:!0},viewportOutlineWidth:{type:"number",value:2,compare:!0},overviewScale:{type:"number",value:1,compare:!0},zoom:{type:"number",value:1,compare:!0}},oR=class extends kn{renderLayers(){const{loader:t,id:e,zoom:n,boundingBox:i,boundingBoxColor:g,boundingBoxOutlineWidth:s,viewportOutlineColor:o,viewportOutlineWidth:r,overviewScale:I}=this.props,{width:a,height:l}=sa(t[0]),C=t.length-1,c=t[C],A=new fc(this.props,{id:`viewport-${e}`,modelMatrix:new Pe().scale(2**C*I),loader:c}),d=new MC({id:`bounding-box-overview-${e}`,coordinateSystem:ce.CARTESIAN,data:[i],getPolygon:h=>h,filled:!1,stroked:!0,getLineColor:g,getLineWidth:s*2**n}),m=new MC({id:`viewport-outline-${e}`,coordinateSystem:ce.CARTESIAN,data:[[[0,0],[a*I,0],[a*I,l*I],[0,l*I]]],getPolygon:h=>h,filled:!1,stroked:!0,getLineColor:o,getLineWidth:r*2**n});return[A,d,m]}};oR.layerName="OverviewLayer";oR.defaultProps=_M;function HM(t){const e=new DZ().makeViewport({viewState:t,height:t.height,width:t.width});return[e.unproject([0,0]),e.unproject([e.width,0]),e.unproject([e.width,e.height]),e.unproject([0,e.height])]}function kM(t,e,n){const i=t[2][0]-t[0][0];switch(e){case"bottom-right":{const g=t[2][1]-(t[2][1]-t[0][1])*n,s=t[2][0]-i*n;return[g,s]}case"top-right":{const g=(t[2][1]-t[0][1])*n,s=t[2][0]-i*n;return[g,s]}case"top-left":{const g=(t[2][1]-t[0][1])*n,s=i*n;return[g,s]}case"bottom-left":{const g=t[2][1]-(t[2][1]-t[0][1])*n,s=i*n;return[g,s]}default:throw new Error(`Position ${e} not found`)}}const KM={pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},unit:{type:"string",value:"",compare:!0},size:{type:"number",value:1,compare:!0},position:{type:"string",value:"bottom-right",compare:!0},length:{type:"number",value:.085,compare:!0}},rR=class extends kn{renderLayers(){const{id:t,unit:e,size:n,position:i,viewState:g,length:s}=this.props,o=HM(g),{zoom:r}=g,a=(o[2][0]-o[0][0])*.05,l=Math.max(2**(-r+1.5),(o[2][1]-o[0][1])*.007),C=a*n,[c,A]=kM(o,i,s),d=new HI({id:`scale-bar-length-${t}`,coordinateSystem:ce.CARTESIAN,data:[[[A,c],[A+a,c]]],getSourcePosition:f=>f[0],getTargetPosition:f=>f[1],getWidth:2,getColor:[220,220,220]}),m=new HI({id:`scale-bar-height-left-${t}`,coordinateSystem:ce.CARTESIAN,data:[[[A,c-l],[A,c+l]]],getSourcePosition:f=>f[0],getTargetPosition:f=>f[1],getWidth:2,getColor:[220,220,220]}),u=new HI({id:`scale-bar-height-right-${t}`,coordinateSystem:ce.CARTESIAN,data:[[[A+a,c-l],[A+a,c+l]]],getSourcePosition:f=>f[0],getTargetPosition:f=>f[1],getWidth:2,getColor:[220,220,220]}),h=new JI({id:`units-label-layer-${t}`,coordinateSystem:ce.CARTESIAN,data:[{text:C.toPrecision(5)+e,position:[A+a*.5,c+l*4]}],getColor:[220,220,220,255],getSize:12,fontFamily:bM,sizeUnits:"meters",sizeScale:2**-r,characterSet:[...e.split(""),...vM(10).map(f=>String(f)),".","e","+"]});return[d,m,u,h]}};rR.layerName="ScaleBarLayer";rR.defaultProps=KM;var LM=`#version 300 es
#define GLSLIFY 1
#define SHADER_NAME xr-layer-vertex-shader
in vec3 positions;uniform vec3 eye_pos;uniform mat4 proj;uniform mat4 model;uniform mat4 view;uniform mat4 scale;uniform mat4 resolution;out vec3 vray_dir;flat out vec3 transformed_eye;void main(){gl_Position=proj*view*model*scale*resolution*vec4(positions,1.);/*This first diagram is a skewed volume(i.e a "shear" model matrix applied)top down with the eye marked as #,all in world space^___|__\\|\\\\|\\|____|||
#
This next diagram shows the volume after the inverse model matrix has placed it back in model coordinates,but the eye still in world space.^___|___|||||||__|__||||
#
Finally,we apply the inverse model matrix transformation to the eye as well to bring it too into world space.Notice that the ray here matches the "voxels" through which the first ray also passes,as desired.^____/__|/||/||/____|///
#
*/transformed_eye=(inverse(resolution)*inverse(scale)*inverse(model)*(vec4(eye_pos,1.))).xyz;vray_dir=positions-transformed_eye;}`,MM=`#version 300 es
precision highp int;precision highp float;precision highp SAMPLER_TYPE;
#define GLSLIFY 1
uniform highp SAMPLER_TYPE volume0;uniform highp SAMPLER_TYPE volume1;uniform highp SAMPLER_TYPE volume2;uniform highp SAMPLER_TYPE volume3;uniform highp SAMPLER_TYPE volume4;uniform highp SAMPLER_TYPE volume5;uniform vec3 scaledDimensions;uniform mat4 scale;uniform vec3 normals[NUM_PLANES];uniform float distances[NUM_PLANES];uniform vec3 colors[6];uniform vec2 xSlice;uniform vec2 ySlice;uniform vec2 zSlice;uniform vec2 contrastLimits[6];in vec3 vray_dir;flat in vec3 transformed_eye;out vec4 color;vec2 intersect_box(vec3 orig,vec3 dir){vec3 box_min=vec3(xSlice[0],ySlice[0],zSlice[0]);vec3 box_max=vec3(xSlice[1],ySlice[1],zSlice[1]);vec3 inv_dir=1./dir;vec3 tmin_tmp=(box_min-orig)*inv_dir;vec3 tmax_tmp=(box_max-orig)*inv_dir;vec3 tmin=min(tmin_tmp,tmax_tmp);vec3 tmax=max(tmin_tmp,tmax_tmp);float t0=max(tmin.x,max(tmin.y,tmin.z));float t1=min(tmax.x,min(tmax.y,tmax.z));vec2 val=vec2(t0,t1);return val;}float linear_to_srgb(float x){if(x<=0.0031308f){return 12.92f*x;}return 1.055f*pow(x,1.f/2.4f)-0.055f;}float wang_hash(int seed){seed=(seed ^ 61)^(seed>>16);seed*=9;seed=seed ^(seed>>4);seed*=0x27d4eb2d;seed=seed ^(seed>>15);return float(seed % 2147483647)/float(2147483647);}void main(void){vec3 ray_dir=normalize(vray_dir);vec2 t_hit=intersect_box(transformed_eye,ray_dir);if(t_hit.x>t_hit.y){discard;}t_hit.x=max(t_hit.x,0.);vec3 dt_vec=1./(scale*vec4(abs(ray_dir),1.)).xyz;float dt=1.*min(dt_vec.x,min(dt_vec.y,dt_vec.z));float offset=wang_hash(int(gl_FragCoord.x+640.*gl_FragCoord.y));vec3 p=transformed_eye+(t_hit.x+offset*dt)*ray_dir;_BEFORE_RENDERfor(float t=t_hit.x;t<t_hit.y;t+=dt){float canShow=1.;for(int i=0;i<NUM_PLANES;i+=1){canShow*=max(0.,sign(dot(normals[i],p)+distances[i]));}float canShowXCoordinate=max(p.x-0.,0.)*max(1.-p.x,0.);float canShowYCoordinate=max(p.y-0.,0.)*max(1.-p.y,0.);float canShowZCoordinate=max(p.z-0.,0.)*max(1.-p.z,0.);float canShowCoordinate=float(ceil(canShowXCoordinate*canShowYCoordinate*canShowZCoordinate));canShow=canShowCoordinate*canShow;float intensityValue0=float(texture(volume0,p).r);DECKGL_PROCESS_INTENSITY(intensityValue0,contrastLimits[0],0);intensityValue0=canShow*intensityValue0;float intensityValue1=float(texture(volume1,p).r);DECKGL_PROCESS_INTENSITY(intensityValue1,contrastLimits[1],1);intensityValue1=canShow*intensityValue1;float intensityValue2=float(texture(volume2,p).r);DECKGL_PROCESS_INTENSITY(intensityValue2,contrastLimits[2],2);intensityValue2=canShow*intensityValue2;float intensityValue3=float(texture(volume3,p).r);DECKGL_PROCESS_INTENSITY(intensityValue3,contrastLimits[3],3);intensityValue3=canShow*intensityValue3;float intensityValue4=float(texture(volume4,p).r);DECKGL_PROCESS_INTENSITY(intensityValue4,contrastLimits[4],4);intensityValue4=canShow*intensityValue4;float intensityValue5=float(texture(volume5,p).r);DECKGL_PROCESS_INTENSITY(intensityValue5,contrastLimits[5],5);intensityValue5=canShow*intensityValue5;_RENDERp+=ray_dir*dt;}_AFTER_RENDERcolor.r=linear_to_srgb(color.r);color.g=linear_to_srgb(color.g);color.b=linear_to_srgb(color.b);}`,PM=`#define GLSLIFY 1
vec4 jet(float x_17){const float e0=0.0;const vec4 v0=vec4(0,0,0.5137254901960784,1);const float e1=0.125;const vec4 v1=vec4(0,0.23529411764705882,0.6666666666666666,1);const float e2=0.375;const vec4 v2=vec4(0.0196078431372549,1,1,1);const float e3=0.625;const vec4 v3=vec4(1,1,0,1);const float e4=0.875;const vec4 v4=vec4(0.9803921568627451,0,0,1);const float e5=1.0;const vec4 v5=vec4(0.5019607843137255,0,0,1);float a0=smoothstep(e0,e1,x_17);float a1=smoothstep(e1,e2,x_17);float a2=smoothstep(e2,e3,x_17);float a3=smoothstep(e3,e4,x_17);float a4=smoothstep(e4,e5,x_17);return max(mix(v0,v1,a0)*step(e0,x_17)*step(x_17,e1),max(mix(v1,v2,a1)*step(e1,x_17)*step(x_17,e2),max(mix(v2,v3,a2)*step(e2,x_17)*step(x_17,e3),max(mix(v3,v4,a3)*step(e3,x_17)*step(x_17,e4),mix(v4,v5,a4)*step(e4,x_17)*step(x_17,e5)))));}vec4 hsv(float x_18){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=0.169;const vec4 v1=vec4(0.9921568627450981,1,0.00784313725490196,1);const float e2=0.173;const vec4 v2=vec4(0.9686274509803922,1,0.00784313725490196,1);const float e3=0.337;const vec4 v3=vec4(0,0.9882352941176471,0.01568627450980392,1);const float e4=0.341;const vec4 v4=vec4(0,0.9882352941176471,0.0392156862745098,1);const float e5=0.506;const vec4 v5=vec4(0.00392156862745098,0.9764705882352941,1,1);const float e6=0.671;const vec4 v6=vec4(0.00784313725490196,0,0.9921568627450981,1);const float e7=0.675;const vec4 v7=vec4(0.03137254901960784,0,0.9921568627450981,1);const float e8=0.839;const vec4 v8=vec4(1,0,0.984313725490196,1);const float e9=0.843;const vec4 v9=vec4(1,0,0.9607843137254902,1);const float e10=1.0;const vec4 v10=vec4(1,0,0.023529411764705882,1);float a0=smoothstep(e0,e1,x_18);float a1=smoothstep(e1,e2,x_18);float a2=smoothstep(e2,e3,x_18);float a3=smoothstep(e3,e4,x_18);float a4=smoothstep(e4,e5,x_18);float a5=smoothstep(e5,e6,x_18);float a6=smoothstep(e6,e7,x_18);float a7=smoothstep(e7,e8,x_18);float a8=smoothstep(e8,e9,x_18);float a9=smoothstep(e9,e10,x_18);return max(mix(v0,v1,a0)*step(e0,x_18)*step(x_18,e1),max(mix(v1,v2,a1)*step(e1,x_18)*step(x_18,e2),max(mix(v2,v3,a2)*step(e2,x_18)*step(x_18,e3),max(mix(v3,v4,a3)*step(e3,x_18)*step(x_18,e4),max(mix(v4,v5,a4)*step(e4,x_18)*step(x_18,e5),max(mix(v5,v6,a5)*step(e5,x_18)*step(x_18,e6),max(mix(v6,v7,a6)*step(e6,x_18)*step(x_18,e7),max(mix(v7,v8,a7)*step(e7,x_18)*step(x_18,e8),max(mix(v8,v9,a8)*step(e8,x_18)*step(x_18,e9),mix(v9,v10,a9)*step(e9,x_18)*step(x_18,e10))))))))));}vec4 hot(float x_13){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.3;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.6;const vec4 v2=vec4(1,0.8235294117647058,0,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_13);float a1=smoothstep(e1,e2,x_13);float a2=smoothstep(e2,e3,x_13);return max(mix(v0,v1,a0)*step(e0,x_13)*step(x_13,e1),max(mix(v1,v2,a1)*step(e1,x_13)*step(x_13,e2),mix(v2,v3,a2)*step(e2,x_13)*step(x_13,e3)));}vec4 cool(float x_24){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.4549019607843137,0,0.8549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.2901960784313726,0.9294117647058824,1);const float e3=0.38;const vec4 v3=vec4(0.26666666666666666,0.5725490196078431,0.9058823529411765,1);const float e4=0.5;const vec4 v4=vec4(0,0.8,0.7725490196078432,1);const float e5=0.63;const vec4 v5=vec4(0,0.9686274509803922,0.5725490196078431,1);const float e6=0.75;const vec4 v6=vec4(0,1,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.1568627450980392,1,0.03137254901960784,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_24);float a1=smoothstep(e1,e2,x_24);float a2=smoothstep(e2,e3,x_24);float a3=smoothstep(e3,e4,x_24);float a4=smoothstep(e4,e5,x_24);float a5=smoothstep(e5,e6,x_24);float a6=smoothstep(e6,e7,x_24);float a7=smoothstep(e7,e8,x_24);return max(mix(v0,v1,a0)*step(e0,x_24)*step(x_24,e1),max(mix(v1,v2,a1)*step(e1,x_24)*step(x_24,e2),max(mix(v2,v3,a2)*step(e2,x_24)*step(x_24,e3),max(mix(v3,v4,a3)*step(e3,x_24)*step(x_24,e4),max(mix(v4,v5,a4)*step(e4,x_24)*step(x_24,e5),max(mix(v5,v6,a5)*step(e5,x_24)*step(x_24,e6),max(mix(v6,v7,a6)*step(e6,x_24)*step(x_24,e7),mix(v7,v8,a7)*step(e7,x_24)*step(x_24,e8))))))));}vec4 spring(float x_5){const float e0=0.0;const vec4 v0=vec4(1,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_5);return mix(v0,v1,a0)*step(e0,x_5)*step(x_5,e1);}vec4 summer(float x_12){const float e0=0.0;const vec4 v0=vec4(0,0.5019607843137255,0.4,1);const float e1=1.0;const vec4 v1=vec4(1,1,0.4,1);float a0=smoothstep(e0,e1,x_12);return mix(v0,v1,a0)*step(e0,x_12)*step(x_12,e1);}vec4 autumn(float x_25){const float e0=0.0;const vec4 v0=vec4(1,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,0,1);float a0=smoothstep(e0,e1,x_25);return mix(v0,v1,a0)*step(e0,x_25)*step(x_25,e1);}vec4 winter(float x_16){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(0,1,0.5019607843137255,1);float a0=smoothstep(e0,e1,x_16);return mix(v0,v1,a0)*step(e0,x_16)*step(x_16,e1);}vec4 bone(float x_15){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.376;const vec4 v1=vec4(0.32941176470588235,0.32941176470588235,0.4549019607843137,1);const float e2=0.753;const vec4 v2=vec4(0.6627450980392157,0.7843137254901961,0.7843137254901961,1);const float e3=1.0;const vec4 v3=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_15);float a1=smoothstep(e1,e2,x_15);float a2=smoothstep(e2,e3,x_15);return max(mix(v0,v1,a0)*step(e0,x_15)*step(x_15,e1),max(mix(v1,v2,a1)*step(e1,x_15)*step(x_15,e2),mix(v2,v3,a2)*step(e2,x_15)*step(x_15,e3)));}vec4 copper(float x_10){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.804;const vec4 v1=vec4(1,0.6274509803921569,0.4,1);const float e2=1.0;const vec4 v2=vec4(1,0.7803921568627451,0.4980392156862745,1);float a0=smoothstep(e0,e1,x_10);float a1=smoothstep(e1,e2,x_10);return max(mix(v0,v1,a0)*step(e0,x_10)*step(x_10,e1),mix(v1,v2,a1)*step(e1,x_10)*step(x_10,e2));}vec4 greys(float x_4){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_4);return mix(v0,v1,a0)*step(e0,x_4)*step(x_4,e1);}vec4 yignbu(float x_32){const float e0=0.0;const vec4 v0=vec4(0.03137254901960784,0.11372549019607843,0.34509803921568627,1);const float e1=0.125;const vec4 v1=vec4(0.1450980392156863,0.20392156862745098,0.5803921568627451,1);const float e2=0.25;const vec4 v2=vec4(0.13333333333333333,0.3686274509803922,0.6588235294117647,1);const float e3=0.375;const vec4 v3=vec4(0.11372549019607843,0.5686274509803921,0.7529411764705882,1);const float e4=0.5;const vec4 v4=vec4(0.2549019607843137,0.7137254901960784,0.7686274509803922,1);const float e5=0.625;const vec4 v5=vec4(0.4980392156862745,0.803921568627451,0.7333333333333333,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7058823529411765,1);const float e7=0.875;const vec4 v7=vec4(0.9294117647058824,0.9725490196078431,0.8509803921568627,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8509803921568627,1);float a0=smoothstep(e0,e1,x_32);float a1=smoothstep(e1,e2,x_32);float a2=smoothstep(e2,e3,x_32);float a3=smoothstep(e3,e4,x_32);float a4=smoothstep(e4,e5,x_32);float a5=smoothstep(e5,e6,x_32);float a6=smoothstep(e6,e7,x_32);float a7=smoothstep(e7,e8,x_32);return max(mix(v0,v1,a0)*step(e0,x_32)*step(x_32,e1),max(mix(v1,v2,a1)*step(e1,x_32)*step(x_32,e2),max(mix(v2,v3,a2)*step(e2,x_32)*step(x_32,e3),max(mix(v3,v4,a3)*step(e3,x_32)*step(x_32,e4),max(mix(v4,v5,a4)*step(e4,x_32)*step(x_32,e5),max(mix(v5,v6,a5)*step(e5,x_32)*step(x_32,e6),max(mix(v6,v7,a6)*step(e6,x_32)*step(x_32,e7),mix(v7,v8,a7)*step(e7,x_32)*step(x_32,e8))))))));}vec4 greens(float x_34){const float e0=0.0;const vec4 v0=vec4(0,0.26666666666666666,0.10588235294117647,1);const float e1=0.125;const vec4 v1=vec4(0,0.42745098039215684,0.17254901960784313,1);const float e2=0.25;const vec4 v2=vec4(0.13725490196078433,0.5450980392156862,0.27058823529411763,1);const float e3=0.375;const vec4 v3=vec4(0.2549019607843137,0.6705882352941176,0.36470588235294116,1);const float e4=0.5;const vec4 v4=vec4(0.4549019607843137,0.7686274509803922,0.4627450980392157,1);const float e5=0.625;const vec4 v5=vec4(0.6313725490196078,0.8509803921568627,0.6078431372549019,1);const float e6=0.75;const vec4 v6=vec4(0.7803921568627451,0.9137254901960784,0.7529411764705882,1);const float e7=0.875;const vec4 v7=vec4(0.8980392156862745,0.9607843137254902,0.8784313725490196,1);const float e8=1.0;const vec4 v8=vec4(0.9686274509803922,0.9882352941176471,0.9607843137254902,1);float a0=smoothstep(e0,e1,x_34);float a1=smoothstep(e1,e2,x_34);float a2=smoothstep(e2,e3,x_34);float a3=smoothstep(e3,e4,x_34);float a4=smoothstep(e4,e5,x_34);float a5=smoothstep(e5,e6,x_34);float a6=smoothstep(e6,e7,x_34);float a7=smoothstep(e7,e8,x_34);return max(mix(v0,v1,a0)*step(e0,x_34)*step(x_34,e1),max(mix(v1,v2,a1)*step(e1,x_34)*step(x_34,e2),max(mix(v2,v3,a2)*step(e2,x_34)*step(x_34,e3),max(mix(v3,v4,a3)*step(e3,x_34)*step(x_34,e4),max(mix(v4,v5,a4)*step(e4,x_34)*step(x_34,e5),max(mix(v5,v6,a5)*step(e5,x_34)*step(x_34,e6),max(mix(v6,v7,a6)*step(e6,x_34)*step(x_34,e7),mix(v7,v8,a7)*step(e7,x_34)*step(x_34,e8))))))));}vec4 yiorrd(float x_41){const float e0=0.0;const vec4 v0=vec4(0.5019607843137255,0,0.14901960784313725,1);const float e1=0.125;const vec4 v1=vec4(0.7411764705882353,0,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.8901960784313725,0.10196078431372549,0.10980392156862745,1);const float e3=0.375;const vec4 v3=vec4(0.9882352941176471,0.3058823529411765,0.16470588235294117,1);const float e4=0.5;const vec4 v4=vec4(0.9921568627450981,0.5529411764705883,0.23529411764705882,1);const float e5=0.625;const vec4 v5=vec4(0.996078431372549,0.6980392156862745,0.2980392156862745,1);const float e6=0.75;const vec4 v6=vec4(0.996078431372549,0.8509803921568627,0.4627450980392157,1);const float e7=0.875;const vec4 v7=vec4(1,0.9294117647058824,0.6274509803921569,1);const float e8=1.0;const vec4 v8=vec4(1,1,0.8,1);float a0=smoothstep(e0,e1,x_41);float a1=smoothstep(e1,e2,x_41);float a2=smoothstep(e2,e3,x_41);float a3=smoothstep(e3,e4,x_41);float a4=smoothstep(e4,e5,x_41);float a5=smoothstep(e5,e6,x_41);float a6=smoothstep(e6,e7,x_41);float a7=smoothstep(e7,e8,x_41);return max(mix(v0,v1,a0)*step(e0,x_41)*step(x_41,e1),max(mix(v1,v2,a1)*step(e1,x_41)*step(x_41,e2),max(mix(v2,v3,a2)*step(e2,x_41)*step(x_41,e3),max(mix(v3,v4,a3)*step(e3,x_41)*step(x_41,e4),max(mix(v4,v5,a4)*step(e4,x_41)*step(x_41,e5),max(mix(v5,v6,a5)*step(e5,x_41)*step(x_41,e6),max(mix(v6,v7,a6)*step(e6,x_41)*step(x_41,e7),mix(v7,v8,a7)*step(e7,x_41)*step(x_41,e8))))))));}vec4 bluered(float x_23){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=1.0;const vec4 v1=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_23);return mix(v0,v1,a0)*step(e0,x_23)*step(x_23,e1);}vec4 rdbu(float x_1){const float e0=0.0;const vec4 v0=vec4(0.0196078431372549,0.0392156862745098,0.6745098039215687,1);const float e1=0.35;const vec4 v1=vec4(0.41568627450980394,0.5372549019607843,0.9686274509803922,1);const float e2=0.5;const vec4 v2=vec4(0.7450980392156863,0.7450980392156863,0.7450980392156863,1);const float e3=0.6;const vec4 v3=vec4(0.8627450980392157,0.6666666666666666,0.5176470588235295,1);const float e4=0.7;const vec4 v4=vec4(0.9019607843137255,0.5686274509803921,0.35294117647058826,1);const float e5=1.0;const vec4 v5=vec4(0.6980392156862745,0.0392156862745098,0.10980392156862745,1);float a0=smoothstep(e0,e1,x_1);float a1=smoothstep(e1,e2,x_1);float a2=smoothstep(e2,e3,x_1);float a3=smoothstep(e3,e4,x_1);float a4=smoothstep(e4,e5,x_1);return max(mix(v0,v1,a0)*step(e0,x_1)*step(x_1,e1),max(mix(v1,v2,a1)*step(e1,x_1)*step(x_1,e2),max(mix(v2,v3,a2)*step(e2,x_1)*step(x_1,e3),max(mix(v3,v4,a3)*step(e3,x_1)*step(x_1,e4),mix(v4,v5,a4)*step(e4,x_1)*step(x_1,e5)))));}vec4 picnic(float x_42){const float e0=0.0;const vec4 v0=vec4(0,0,1,1);const float e1=0.1;const vec4 v1=vec4(0.2,0.6,1,1);const float e2=0.2;const vec4 v2=vec4(0.4,0.8,1,1);const float e3=0.3;const vec4 v3=vec4(0.6,0.8,1,1);const float e4=0.4;const vec4 v4=vec4(0.8,0.8,1,1);const float e5=0.5;const vec4 v5=vec4(1,1,1,1);const float e6=0.6;const vec4 v6=vec4(1,0.8,1,1);const float e7=0.7;const vec4 v7=vec4(1,0.6,1,1);const float e8=0.8;const vec4 v8=vec4(1,0.4,0.8,1);const float e9=0.9;const vec4 v9=vec4(1,0.4,0.4,1);const float e10=1.0;const vec4 v10=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_42);float a1=smoothstep(e1,e2,x_42);float a2=smoothstep(e2,e3,x_42);float a3=smoothstep(e3,e4,x_42);float a4=smoothstep(e4,e5,x_42);float a5=smoothstep(e5,e6,x_42);float a6=smoothstep(e6,e7,x_42);float a7=smoothstep(e7,e8,x_42);float a8=smoothstep(e8,e9,x_42);float a9=smoothstep(e9,e10,x_42);return max(mix(v0,v1,a0)*step(e0,x_42)*step(x_42,e1),max(mix(v1,v2,a1)*step(e1,x_42)*step(x_42,e2),max(mix(v2,v3,a2)*step(e2,x_42)*step(x_42,e3),max(mix(v3,v4,a3)*step(e3,x_42)*step(x_42,e4),max(mix(v4,v5,a4)*step(e4,x_42)*step(x_42,e5),max(mix(v5,v6,a5)*step(e5,x_42)*step(x_42,e6),max(mix(v6,v7,a6)*step(e6,x_42)*step(x_42,e7),max(mix(v7,v8,a7)*step(e7,x_42)*step(x_42,e8),max(mix(v8,v9,a8)*step(e8,x_42)*step(x_42,e9),mix(v9,v10,a9)*step(e9,x_42)*step(x_42,e10))))))))));}vec4 rainbow(float x_31){const float e0=0.0;const vec4 v0=vec4(0.5882352941176471,0,0.35294117647058826,1);const float e1=0.125;const vec4 v1=vec4(0,0,0.7843137254901961,1);const float e2=0.25;const vec4 v2=vec4(0,0.09803921568627451,1,1);const float e3=0.375;const vec4 v3=vec4(0,0.596078431372549,1,1);const float e4=0.5;const vec4 v4=vec4(0.17254901960784313,1,0.5882352941176471,1);const float e5=0.625;const vec4 v5=vec4(0.592156862745098,1,0,1);const float e6=0.75;const vec4 v6=vec4(1,0.9176470588235294,0,1);const float e7=0.875;const vec4 v7=vec4(1,0.43529411764705883,0,1);const float e8=1.0;const vec4 v8=vec4(1,0,0,1);float a0=smoothstep(e0,e1,x_31);float a1=smoothstep(e1,e2,x_31);float a2=smoothstep(e2,e3,x_31);float a3=smoothstep(e3,e4,x_31);float a4=smoothstep(e4,e5,x_31);float a5=smoothstep(e5,e6,x_31);float a6=smoothstep(e6,e7,x_31);float a7=smoothstep(e7,e8,x_31);return max(mix(v0,v1,a0)*step(e0,x_31)*step(x_31,e1),max(mix(v1,v2,a1)*step(e1,x_31)*step(x_31,e2),max(mix(v2,v3,a2)*step(e2,x_31)*step(x_31,e3),max(mix(v3,v4,a3)*step(e3,x_31)*step(x_31,e4),max(mix(v4,v5,a4)*step(e4,x_31)*step(x_31,e5),max(mix(v5,v6,a5)*step(e5,x_31)*step(x_31,e6),max(mix(v6,v7,a6)*step(e6,x_31)*step(x_31,e7),mix(v7,v8,a7)*step(e7,x_31)*step(x_31,e8))))))));}vec4 portland(float x_21){const float e0=0.0;const vec4 v0=vec4(0.047058823529411764,0.2,0.5137254901960784,1);const float e1=0.25;const vec4 v1=vec4(0.0392156862745098,0.5333333333333333,0.7294117647058823,1);const float e2=0.5;const vec4 v2=vec4(0.9490196078431372,0.8274509803921568,0.2196078431372549,1);const float e3=0.75;const vec4 v3=vec4(0.9490196078431372,0.5607843137254902,0.2196078431372549,1);const float e4=1.0;const vec4 v4=vec4(0.8509803921568627,0.11764705882352941,0.11764705882352941,1);float a0=smoothstep(e0,e1,x_21);float a1=smoothstep(e1,e2,x_21);float a2=smoothstep(e2,e3,x_21);float a3=smoothstep(e3,e4,x_21);return max(mix(v0,v1,a0)*step(e0,x_21)*step(x_21,e1),max(mix(v1,v2,a1)*step(e1,x_21)*step(x_21,e2),max(mix(v2,v3,a2)*step(e2,x_21)*step(x_21,e3),mix(v3,v4,a3)*step(e3,x_21)*step(x_21,e4))));}vec4 blackbody(float x_38){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.2;const vec4 v1=vec4(0.9019607843137255,0,0,1);const float e2=0.4;const vec4 v2=vec4(0.9019607843137255,0.8235294117647058,0,1);const float e3=0.7;const vec4 v3=vec4(1,1,1,1);const float e4=1.0;const vec4 v4=vec4(0.6274509803921569,0.7843137254901961,1,1);float a0=smoothstep(e0,e1,x_38);float a1=smoothstep(e1,e2,x_38);float a2=smoothstep(e2,e3,x_38);float a3=smoothstep(e3,e4,x_38);return max(mix(v0,v1,a0)*step(e0,x_38)*step(x_38,e1),max(mix(v1,v2,a1)*step(e1,x_38)*step(x_38,e2),max(mix(v2,v3,a2)*step(e2,x_38)*step(x_38,e3),mix(v3,v4,a3)*step(e3,x_38)*step(x_38,e4))));}vec4 earth(float x_29){const float e0=0.0;const vec4 v0=vec4(0,0,0.5098039215686274,1);const float e1=0.1;const vec4 v1=vec4(0,0.7058823529411765,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(0.1568627450980392,0.8235294117647058,0.1568627450980392,1);const float e3=0.4;const vec4 v3=vec4(0.9019607843137255,0.9019607843137255,0.19607843137254902,1);const float e4=0.6;const vec4 v4=vec4(0.47058823529411764,0.27450980392156865,0.0784313725490196,1);const float e5=1.0;const vec4 v5=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_29);float a1=smoothstep(e1,e2,x_29);float a2=smoothstep(e2,e3,x_29);float a3=smoothstep(e3,e4,x_29);float a4=smoothstep(e4,e5,x_29);return max(mix(v0,v1,a0)*step(e0,x_29)*step(x_29,e1),max(mix(v1,v2,a1)*step(e1,x_29)*step(x_29,e2),max(mix(v2,v3,a2)*step(e2,x_29)*step(x_29,e3),max(mix(v3,v4,a3)*step(e3,x_29)*step(x_29,e4),mix(v4,v5,a4)*step(e4,x_29)*step(x_29,e5)))));}vec4 electric(float x_9){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.15;const vec4 v1=vec4(0.11764705882352941,0,0.39215686274509803,1);const float e2=0.4;const vec4 v2=vec4(0.47058823529411764,0,0.39215686274509803,1);const float e3=0.6;const vec4 v3=vec4(0.6274509803921569,0.35294117647058826,0,1);const float e4=0.8;const vec4 v4=vec4(0.9019607843137255,0.7843137254901961,0,1);const float e5=1.0;const vec4 v5=vec4(1,0.9803921568627451,0.8627450980392157,1);float a0=smoothstep(e0,e1,x_9);float a1=smoothstep(e1,e2,x_9);float a2=smoothstep(e2,e3,x_9);float a3=smoothstep(e3,e4,x_9);float a4=smoothstep(e4,e5,x_9);return max(mix(v0,v1,a0)*step(e0,x_9)*step(x_9,e1),max(mix(v1,v2,a1)*step(e1,x_9)*step(x_9,e2),max(mix(v2,v3,a2)*step(e2,x_9)*step(x_9,e3),max(mix(v3,v4,a3)*step(e3,x_9)*step(x_9,e4),mix(v4,v5,a4)*step(e4,x_9)*step(x_9,e5)))));}vec4 alpha(float x_0){const float e0=0.0;const vec4 v0=vec4(1,1,1,0);const float e1=1.0;const vec4 v1=vec4(1,1,1,1);float a0=smoothstep(e0,e1,x_0);return mix(v0,v1,a0)*step(e0,x_0)*step(x_0,e1);}vec4 viridis(float x_22){const float e0=0.0;const vec4 v0=vec4(0.26666666666666666,0.00392156862745098,0.32941176470588235,1);const float e1=0.13;const vec4 v1=vec4(0.2784313725490196,0.17254901960784313,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.23137254901960785,0.3176470588235294,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.17254901960784313,0.44313725490196076,0.5568627450980392,1);const float e4=0.5;const vec4 v4=vec4(0.12941176470588237,0.5647058823529412,0.5529411764705883,1);const float e5=0.63;const vec4 v5=vec4(0.15294117647058825,0.6784313725490196,0.5058823529411764,1);const float e6=0.75;const vec4 v6=vec4(0.3607843137254902,0.7843137254901961,0.38823529411764707,1);const float e7=0.88;const vec4 v7=vec4(0.6666666666666666,0.8627450980392157,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9058823529411765,0.1450980392156863,1);float a0=smoothstep(e0,e1,x_22);float a1=smoothstep(e1,e2,x_22);float a2=smoothstep(e2,e3,x_22);float a3=smoothstep(e3,e4,x_22);float a4=smoothstep(e4,e5,x_22);float a5=smoothstep(e5,e6,x_22);float a6=smoothstep(e6,e7,x_22);float a7=smoothstep(e7,e8,x_22);return max(mix(v0,v1,a0)*step(e0,x_22)*step(x_22,e1),max(mix(v1,v2,a1)*step(e1,x_22)*step(x_22,e2),max(mix(v2,v3,a2)*step(e2,x_22)*step(x_22,e3),max(mix(v3,v4,a3)*step(e3,x_22)*step(x_22,e4),max(mix(v4,v5,a4)*step(e4,x_22)*step(x_22,e5),max(mix(v5,v6,a5)*step(e5,x_22)*step(x_22,e6),max(mix(v6,v7,a6)*step(e6,x_22)*step(x_22,e7),mix(v7,v8,a7)*step(e7,x_22)*step(x_22,e8))))))));}vec4 inferno(float x_30){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.12156862745098039,0.047058823529411764,0.2823529411764706,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.058823529411764705,0.42745098039215684,1);const float e3=0.38;const vec4 v3=vec4(0.5333333333333333,0.13333333333333333,0.41568627450980394,1);const float e4=0.5;const vec4 v4=vec4(0.7294117647058823,0.21176470588235294,0.3333333333333333,1);const float e5=0.63;const vec4 v5=vec4(0.8901960784313725,0.34901960784313724,0.2,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5490196078431373,0.0392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.788235294117647,0.19607843137254902,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,1,0.6431372549019608,1);float a0=smoothstep(e0,e1,x_30);float a1=smoothstep(e1,e2,x_30);float a2=smoothstep(e2,e3,x_30);float a3=smoothstep(e3,e4,x_30);float a4=smoothstep(e4,e5,x_30);float a5=smoothstep(e5,e6,x_30);float a6=smoothstep(e6,e7,x_30);float a7=smoothstep(e7,e8,x_30);return max(mix(v0,v1,a0)*step(e0,x_30)*step(x_30,e1),max(mix(v1,v2,a1)*step(e1,x_30)*step(x_30,e2),max(mix(v2,v3,a2)*step(e2,x_30)*step(x_30,e3),max(mix(v3,v4,a3)*step(e3,x_30)*step(x_30,e4),max(mix(v4,v5,a4)*step(e4,x_30)*step(x_30,e5),max(mix(v5,v6,a5)*step(e5,x_30)*step(x_30,e6),max(mix(v6,v7,a6)*step(e6,x_30)*step(x_30,e7),mix(v7,v8,a7)*step(e7,x_30)*step(x_30,e8))))))));}vec4 magma(float x_33){const float e0=0.0;const vec4 v0=vec4(0,0,0.01568627450980392,1);const float e1=0.13;const vec4 v1=vec4(0.10980392156862745,0.06274509803921569,0.26666666666666666,1);const float e2=0.25;const vec4 v2=vec4(0.30980392156862746,0.07058823529411765,0.4823529411764706,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.1450980392156863,0.5058823529411764,1);const float e4=0.5;const vec4 v4=vec4(0.7098039215686275,0.21176470588235294,0.47843137254901963,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.3137254901960784,0.39215686274509803,1);const float e6=0.75;const vec4 v6=vec4(0.984313725490196,0.5294117647058824,0.3803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.996078431372549,0.7607843137254902,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.9882352941176471,0.9921568627450981,0.7490196078431373,1);float a0=smoothstep(e0,e1,x_33);float a1=smoothstep(e1,e2,x_33);float a2=smoothstep(e2,e3,x_33);float a3=smoothstep(e3,e4,x_33);float a4=smoothstep(e4,e5,x_33);float a5=smoothstep(e5,e6,x_33);float a6=smoothstep(e6,e7,x_33);float a7=smoothstep(e7,e8,x_33);return max(mix(v0,v1,a0)*step(e0,x_33)*step(x_33,e1),max(mix(v1,v2,a1)*step(e1,x_33)*step(x_33,e2),max(mix(v2,v3,a2)*step(e2,x_33)*step(x_33,e3),max(mix(v3,v4,a3)*step(e3,x_33)*step(x_33,e4),max(mix(v4,v5,a4)*step(e4,x_33)*step(x_33,e5),max(mix(v5,v6,a5)*step(e5,x_33)*step(x_33,e6),max(mix(v6,v7,a6)*step(e6,x_33)*step(x_33,e7),mix(v7,v8,a7)*step(e7,x_33)*step(x_33,e8))))))));}vec4 plasma(float x_3){const float e0=0.0;const vec4 v0=vec4(0.050980392156862744,0.03137254901960784,0.5294117647058824,1);const float e1=0.13;const vec4 v1=vec4(0.29411764705882354,0.011764705882352941,0.6313725490196078,1);const float e2=0.25;const vec4 v2=vec4(0.49019607843137253,0.011764705882352941,0.6588235294117647,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.13333333333333333,0.5882352941176471,1);const float e4=0.5;const vec4 v4=vec4(0.796078431372549,0.27450980392156865,0.4745098039215686,1);const float e5=0.63;const vec4 v5=vec4(0.8980392156862745,0.4196078431372549,0.36470588235294116,1);const float e6=0.75;const vec4 v6=vec4(0.9725490196078431,0.5803921568627451,0.2549019607843137,1);const float e7=0.88;const vec4 v7=vec4(0.9921568627450981,0.7647058823529411,0.1568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9411764705882353,0.9764705882352941,0.12941176470588237,1);float a0=smoothstep(e0,e1,x_3);float a1=smoothstep(e1,e2,x_3);float a2=smoothstep(e2,e3,x_3);float a3=smoothstep(e3,e4,x_3);float a4=smoothstep(e4,e5,x_3);float a5=smoothstep(e5,e6,x_3);float a6=smoothstep(e6,e7,x_3);float a7=smoothstep(e7,e8,x_3);return max(mix(v0,v1,a0)*step(e0,x_3)*step(x_3,e1),max(mix(v1,v2,a1)*step(e1,x_3)*step(x_3,e2),max(mix(v2,v3,a2)*step(e2,x_3)*step(x_3,e3),max(mix(v3,v4,a3)*step(e3,x_3)*step(x_3,e4),max(mix(v4,v5,a4)*step(e4,x_3)*step(x_3,e5),max(mix(v5,v6,a5)*step(e5,x_3)*step(x_3,e6),max(mix(v6,v7,a6)*step(e6,x_3)*step(x_3,e7),mix(v7,v8,a7)*step(e7,x_3)*step(x_3,e8))))))));}vec4 warm(float x_43){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.13;const vec4 v1=vec4(0.6745098039215687,0,0.7333333333333333,1);const float e2=0.25;const vec4 v2=vec4(0.8588235294117647,0,0.6666666666666666,1);const float e3=0.38;const vec4 v3=vec4(1,0,0.5098039215686274,1);const float e4=0.5;const vec4 v4=vec4(1,0.24705882352941178,0.2901960784313726,1);const float e5=0.63;const vec4 v5=vec4(1,0.4823529411764706,0,1);const float e6=0.75;const vec4 v6=vec4(0.9176470588235294,0.6901960784313725,0,1);const float e7=0.88;const vec4 v7=vec4(0.7450980392156863,0.8941176470588236,0,1);const float e8=1.0;const vec4 v8=vec4(0.5764705882352941,1,0,1);float a0=smoothstep(e0,e1,x_43);float a1=smoothstep(e1,e2,x_43);float a2=smoothstep(e2,e3,x_43);float a3=smoothstep(e3,e4,x_43);float a4=smoothstep(e4,e5,x_43);float a5=smoothstep(e5,e6,x_43);float a6=smoothstep(e6,e7,x_43);float a7=smoothstep(e7,e8,x_43);return max(mix(v0,v1,a0)*step(e0,x_43)*step(x_43,e1),max(mix(v1,v2,a1)*step(e1,x_43)*step(x_43,e2),max(mix(v2,v3,a2)*step(e2,x_43)*step(x_43,e3),max(mix(v3,v4,a3)*step(e3,x_43)*step(x_43,e4),max(mix(v4,v5,a4)*step(e4,x_43)*step(x_43,e5),max(mix(v5,v6,a5)*step(e5,x_43)*step(x_43,e6),max(mix(v6,v7,a6)*step(e6,x_43)*step(x_43,e7),mix(v7,v8,a7)*step(e7,x_43)*step(x_43,e8))))))));}vec4 rainbow_soft_1310269270(float x_14){const float e0=0.0;const vec4 v0=vec4(0.49019607843137253,0,0.7019607843137254,1);const float e1=0.1;const vec4 v1=vec4(0.7803921568627451,0,0.7058823529411765,1);const float e2=0.2;const vec4 v2=vec4(1,0,0.4745098039215686,1);const float e3=0.3;const vec4 v3=vec4(1,0.4235294117647059,0,1);const float e4=0.4;const vec4 v4=vec4(0.8705882352941177,0.7607843137254902,0,1);const float e5=0.5;const vec4 v5=vec4(0.5882352941176471,1,0,1);const float e6=0.6;const vec4 v6=vec4(0,1,0.21568627450980393,1);const float e7=0.7;const vec4 v7=vec4(0,0.9647058823529412,0.5882352941176471,1);const float e8=0.8;const vec4 v8=vec4(0.19607843137254902,0.6549019607843137,0.8705882352941177,1);const float e9=0.9;const vec4 v9=vec4(0.403921568627451,0.2,0.9215686274509803,1);const float e10=1.0;const vec4 v10=vec4(0.48627450980392156,0,0.7294117647058823,1);float a0=smoothstep(e0,e1,x_14);float a1=smoothstep(e1,e2,x_14);float a2=smoothstep(e2,e3,x_14);float a3=smoothstep(e3,e4,x_14);float a4=smoothstep(e4,e5,x_14);float a5=smoothstep(e5,e6,x_14);float a6=smoothstep(e6,e7,x_14);float a7=smoothstep(e7,e8,x_14);float a8=smoothstep(e8,e9,x_14);float a9=smoothstep(e9,e10,x_14);return max(mix(v0,v1,a0)*step(e0,x_14)*step(x_14,e1),max(mix(v1,v2,a1)*step(e1,x_14)*step(x_14,e2),max(mix(v2,v3,a2)*step(e2,x_14)*step(x_14,e3),max(mix(v3,v4,a3)*step(e3,x_14)*step(x_14,e4),max(mix(v4,v5,a4)*step(e4,x_14)*step(x_14,e5),max(mix(v5,v6,a5)*step(e5,x_14)*step(x_14,e6),max(mix(v6,v7,a6)*step(e6,x_14)*step(x_14,e7),max(mix(v7,v8,a7)*step(e7,x_14)*step(x_14,e8),max(mix(v8,v9,a8)*step(e8,x_14)*step(x_14,e9),mix(v9,v10,a9)*step(e9,x_14)*step(x_14,e10))))))))));}vec4 bathymetry(float x_36){const float e0=0.0;const vec4 v0=vec4(0.1568627450980392,0.10196078431372549,0.17254901960784313,1);const float e1=0.13;const vec4 v1=vec4(0.23137254901960785,0.19215686274509805,0.35294117647058826,1);const float e2=0.25;const vec4 v2=vec4(0.25098039215686274,0.2980392156862745,0.5450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.24705882352941178,0.43137254901960786,0.592156862745098,1);const float e4=0.5;const vec4 v4=vec4(0.2823529411764706,0.5568627450980392,0.6196078431372549,1);const float e5=0.63;const vec4 v5=vec4(0.3333333333333333,0.6823529411764706,0.6392156862745098,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.807843137254902,0.6392156862745098,1);const float e7=0.88;const vec4 v7=vec4(0.7333333333333333,0.9019607843137255,0.6745098039215687,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.996078431372549,0.8,1);float a0=smoothstep(e0,e1,x_36);float a1=smoothstep(e1,e2,x_36);float a2=smoothstep(e2,e3,x_36);float a3=smoothstep(e3,e4,x_36);float a4=smoothstep(e4,e5,x_36);float a5=smoothstep(e5,e6,x_36);float a6=smoothstep(e6,e7,x_36);float a7=smoothstep(e7,e8,x_36);return max(mix(v0,v1,a0)*step(e0,x_36)*step(x_36,e1),max(mix(v1,v2,a1)*step(e1,x_36)*step(x_36,e2),max(mix(v2,v3,a2)*step(e2,x_36)*step(x_36,e3),max(mix(v3,v4,a3)*step(e3,x_36)*step(x_36,e4),max(mix(v4,v5,a4)*step(e4,x_36)*step(x_36,e5),max(mix(v5,v6,a5)*step(e5,x_36)*step(x_36,e6),max(mix(v6,v7,a6)*step(e6,x_36)*step(x_36,e7),mix(v7,v8,a7)*step(e7,x_36)*step(x_36,e8))))))));}vec4 cdom(float x_7){const float e0=0.0;const vec4 v0=vec4(0.1843137254901961,0.058823529411764705,0.24313725490196078,1);const float e1=0.13;const vec4 v1=vec4(0.3411764705882353,0.09019607843137255,0.33725490196078434,1);const float e2=0.25;const vec4 v2=vec4(0.5098039215686274,0.10980392156862745,0.38823529411764707,1);const float e3=0.38;const vec4 v3=vec4(0.6705882352941176,0.1607843137254902,0.3764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.807843137254902,0.2627450980392157,0.33725490196078434,1);const float e5=0.63;const vec4 v5=vec4(0.9019607843137255,0.41568627450980394,0.32941176470588235,1);const float e6=0.75;const vec4 v6=vec4(0.9490196078431372,0.5843137254901961,0.403921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7568627450980392,0.5294117647058824,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.9294117647058824,0.6901960784313725,1);float a0=smoothstep(e0,e1,x_7);float a1=smoothstep(e1,e2,x_7);float a2=smoothstep(e2,e3,x_7);float a3=smoothstep(e3,e4,x_7);float a4=smoothstep(e4,e5,x_7);float a5=smoothstep(e5,e6,x_7);float a6=smoothstep(e6,e7,x_7);float a7=smoothstep(e7,e8,x_7);return max(mix(v0,v1,a0)*step(e0,x_7)*step(x_7,e1),max(mix(v1,v2,a1)*step(e1,x_7)*step(x_7,e2),max(mix(v2,v3,a2)*step(e2,x_7)*step(x_7,e3),max(mix(v3,v4,a3)*step(e3,x_7)*step(x_7,e4),max(mix(v4,v5,a4)*step(e4,x_7)*step(x_7,e5),max(mix(v5,v6,a5)*step(e5,x_7)*step(x_7,e6),max(mix(v6,v7,a6)*step(e6,x_7)*step(x_7,e7),mix(v7,v8,a7)*step(e7,x_7)*step(x_7,e8))))))));}vec4 chlorophyll(float x_6){const float e0=0.0;const vec4 v0=vec4(0.07058823529411765,0.1411764705882353,0.0784313725490196,1);const float e1=0.13;const vec4 v1=vec4(0.09803921568627451,0.24705882352941178,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.09411764705882353,0.3568627450980392,0.23137254901960785,1);const float e3=0.38;const vec4 v3=vec4(0.050980392156862744,0.4666666666666667,0.2823529411764706,1);const float e4=0.5;const vec4 v4=vec4(0.07058823529411765,0.5803921568627451,0.3137254901960784,1);const float e5=0.63;const vec4 v5=vec4(0.3137254901960784,0.6784313725490196,0.34901960784313724,1);const float e6=0.75;const vec4 v6=vec4(0.5176470588235295,0.7686274509803922,0.47843137254901963,1);const float e7=0.88;const vec4 v7=vec4(0.6862745098039216,0.8666666666666667,0.6352941176470588,1);const float e8=1.0;const vec4 v8=vec4(0.8431372549019608,0.9764705882352941,0.8156862745098039,1);float a0=smoothstep(e0,e1,x_6);float a1=smoothstep(e1,e2,x_6);float a2=smoothstep(e2,e3,x_6);float a3=smoothstep(e3,e4,x_6);float a4=smoothstep(e4,e5,x_6);float a5=smoothstep(e5,e6,x_6);float a6=smoothstep(e6,e7,x_6);float a7=smoothstep(e7,e8,x_6);return max(mix(v0,v1,a0)*step(e0,x_6)*step(x_6,e1),max(mix(v1,v2,a1)*step(e1,x_6)*step(x_6,e2),max(mix(v2,v3,a2)*step(e2,x_6)*step(x_6,e3),max(mix(v3,v4,a3)*step(e3,x_6)*step(x_6,e4),max(mix(v4,v5,a4)*step(e4,x_6)*step(x_6,e5),max(mix(v5,v6,a5)*step(e5,x_6)*step(x_6,e6),max(mix(v6,v7,a6)*step(e6,x_6)*step(x_6,e7),mix(v7,v8,a7)*step(e7,x_6)*step(x_6,e8))))))));}vec4 density(float x_19){const float e0=0.0;const vec4 v0=vec4(0.21176470588235294,0.054901960784313725,0.1411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.34901960784313724,0.09019607843137255,0.3137254901960784,1);const float e2=0.25;const vec4 v2=vec4(0.43137254901960786,0.17647058823529413,0.5176470588235295,1);const float e3=0.38;const vec4 v3=vec4(0.47058823529411764,0.30196078431372547,0.6980392156862745,1);const float e4=0.5;const vec4 v4=vec4(0.47058823529411764,0.44313725490196076,0.8352941176470589,1);const float e5=0.63;const vec4 v5=vec4(0.45098039215686275,0.592156862745098,0.8941176470588236,1);const float e6=0.75;const vec4 v6=vec4(0.5254901960784314,0.7254901960784313,0.8901960784313725,1);const float e7=0.88;const vec4 v7=vec4(0.6941176470588235,0.8392156862745098,0.8901960784313725,1);const float e8=1.0;const vec4 v8=vec4(0.9019607843137255,0.9450980392156862,0.9450980392156862,1);float a0=smoothstep(e0,e1,x_19);float a1=smoothstep(e1,e2,x_19);float a2=smoothstep(e2,e3,x_19);float a3=smoothstep(e3,e4,x_19);float a4=smoothstep(e4,e5,x_19);float a5=smoothstep(e5,e6,x_19);float a6=smoothstep(e6,e7,x_19);float a7=smoothstep(e7,e8,x_19);return max(mix(v0,v1,a0)*step(e0,x_19)*step(x_19,e1),max(mix(v1,v2,a1)*step(e1,x_19)*step(x_19,e2),max(mix(v2,v3,a2)*step(e2,x_19)*step(x_19,e3),max(mix(v3,v4,a3)*step(e3,x_19)*step(x_19,e4),max(mix(v4,v5,a4)*step(e4,x_19)*step(x_19,e5),max(mix(v5,v6,a5)*step(e5,x_19)*step(x_19,e6),max(mix(v6,v7,a6)*step(e6,x_19)*step(x_19,e7),mix(v7,v8,a7)*step(e7,x_19)*step(x_19,e8))))))));}vec4 freesurface_blue_3154355989(float x_35){const float e0=0.0;const vec4 v0=vec4(0.11764705882352941,0.01568627450980392,0.43137254901960786,1);const float e1=0.13;const vec4 v1=vec4(0.1843137254901961,0.054901960784313725,0.6901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.1607843137254902,0.17647058823529413,0.9254901960784314,1);const float e3=0.38;const vec4 v3=vec4(0.09803921568627451,0.38823529411764707,0.8313725490196079,1);const float e4=0.5;const vec4 v4=vec4(0.26666666666666666,0.5137254901960784,0.7843137254901961,1);const float e5=0.63;const vec4 v5=vec4(0.4470588235294118,0.611764705882353,0.7725490196078432,1);const float e6=0.75;const vec4 v6=vec4(0.615686274509804,0.7098039215686275,0.796078431372549,1);const float e7=0.88;const vec4 v7=vec4(0.7843137254901961,0.8156862745098039,0.8470588235294118,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_35);float a1=smoothstep(e1,e2,x_35);float a2=smoothstep(e2,e3,x_35);float a3=smoothstep(e3,e4,x_35);float a4=smoothstep(e4,e5,x_35);float a5=smoothstep(e5,e6,x_35);float a6=smoothstep(e6,e7,x_35);float a7=smoothstep(e7,e8,x_35);return max(mix(v0,v1,a0)*step(e0,x_35)*step(x_35,e1),max(mix(v1,v2,a1)*step(e1,x_35)*step(x_35,e2),max(mix(v2,v3,a2)*step(e2,x_35)*step(x_35,e3),max(mix(v3,v4,a3)*step(e3,x_35)*step(x_35,e4),max(mix(v4,v5,a4)*step(e4,x_35)*step(x_35,e5),max(mix(v5,v6,a5)*step(e5,x_35)*step(x_35,e6),max(mix(v6,v7,a6)*step(e6,x_35)*step(x_35,e7),mix(v7,v8,a7)*step(e7,x_35)*step(x_35,e8))))))));}vec4 freesurface_red_1679163293(float x_20){const float e0=0.0;const vec4 v0=vec4(0.23529411764705882,0.03529411764705882,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.39215686274509803,0.06666666666666667,0.10588235294117647,1);const float e2=0.25;const vec4 v2=vec4(0.5568627450980392,0.0784313725490196,0.11372549019607843,1);const float e3=0.38;const vec4 v3=vec4(0.6941176470588235,0.16862745098039217,0.10588235294117647,1);const float e4=0.5;const vec4 v4=vec4(0.7529411764705882,0.3411764705882353,0.24705882352941178,1);const float e5=0.63;const vec4 v5=vec4(0.803921568627451,0.49019607843137253,0.4117647058823529,1);const float e6=0.75;const vec4 v6=vec4(0.8470588235294118,0.6352941176470588,0.5803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.8901960784313725,0.7803921568627451,0.7568627450980392,1);const float e8=1.0;const vec4 v8=vec4(0.9450980392156862,0.9294117647058824,0.9254901960784314,1);float a0=smoothstep(e0,e1,x_20);float a1=smoothstep(e1,e2,x_20);float a2=smoothstep(e2,e3,x_20);float a3=smoothstep(e3,e4,x_20);float a4=smoothstep(e4,e5,x_20);float a5=smoothstep(e5,e6,x_20);float a6=smoothstep(e6,e7,x_20);float a7=smoothstep(e7,e8,x_20);return max(mix(v0,v1,a0)*step(e0,x_20)*step(x_20,e1),max(mix(v1,v2,a1)*step(e1,x_20)*step(x_20,e2),max(mix(v2,v3,a2)*step(e2,x_20)*step(x_20,e3),max(mix(v3,v4,a3)*step(e3,x_20)*step(x_20,e4),max(mix(v4,v5,a4)*step(e4,x_20)*step(x_20,e5),max(mix(v5,v6,a5)*step(e5,x_20)*step(x_20,e6),max(mix(v6,v7,a6)*step(e6,x_20)*step(x_20,e7),mix(v7,v8,a7)*step(e7,x_20)*step(x_20,e8))))))));}vec4 oxygen(float x_11){const float e0=0.0;const vec4 v0=vec4(0.25098039215686274,0.0196078431372549,0.0196078431372549,1);const float e1=0.13;const vec4 v1=vec4(0.41568627450980394,0.023529411764705882,0.058823529411764705,1);const float e2=0.25;const vec4 v2=vec4(0.5647058823529412,0.10196078431372549,0.027450980392156862,1);const float e3=0.38;const vec4 v3=vec4(0.6588235294117647,0.25098039215686274,0.011764705882352941,1);const float e4=0.5;const vec4 v4=vec4(0.7372549019607844,0.39215686274509803,0.01568627450980392,1);const float e5=0.63;const vec4 v5=vec4(0.807843137254902,0.5333333333333333,0.043137254901960784,1);const float e6=0.75;const vec4 v6=vec4(0.8627450980392157,0.6823529411764706,0.09803921568627451,1);const float e7=0.88;const vec4 v7=vec4(0.9058823529411765,0.8431372549019608,0.17254901960784313,1);const float e8=1.0;const vec4 v8=vec4(0.9725490196078431,0.996078431372549,0.4117647058823529,1);float a0=smoothstep(e0,e1,x_11);float a1=smoothstep(e1,e2,x_11);float a2=smoothstep(e2,e3,x_11);float a3=smoothstep(e3,e4,x_11);float a4=smoothstep(e4,e5,x_11);float a5=smoothstep(e5,e6,x_11);float a6=smoothstep(e6,e7,x_11);float a7=smoothstep(e7,e8,x_11);return max(mix(v0,v1,a0)*step(e0,x_11)*step(x_11,e1),max(mix(v1,v2,a1)*step(e1,x_11)*step(x_11,e2),max(mix(v2,v3,a2)*step(e2,x_11)*step(x_11,e3),max(mix(v3,v4,a3)*step(e3,x_11)*step(x_11,e4),max(mix(v4,v5,a4)*step(e4,x_11)*step(x_11,e5),max(mix(v5,v6,a5)*step(e5,x_11)*step(x_11,e6),max(mix(v6,v7,a6)*step(e6,x_11)*step(x_11,e7),mix(v7,v8,a7)*step(e7,x_11)*step(x_11,e8))))))));}vec4 par(float x_28){const float e0=0.0;const vec4 v0=vec4(0.2,0.0784313725490196,0.09411764705882353,1);const float e1=0.13;const vec4 v1=vec4(0.35294117647058826,0.12549019607843137,0.13725490196078433,1);const float e2=0.25;const vec4 v2=vec4(0.5058823529411764,0.17254901960784313,0.13333333333333333,1);const float e3=0.38;const vec4 v3=vec4(0.6235294117647059,0.26666666666666666,0.09803921568627451,1);const float e4=0.5;const vec4 v4=vec4(0.7137254901960784,0.38823529411764707,0.07450980392156863,1);const float e5=0.63;const vec4 v5=vec4(0.7803921568627451,0.5254901960784314,0.08627450980392157,1);const float e6=0.75;const vec4 v6=vec4(0.8313725490196079,0.6705882352941176,0.13725490196078433,1);const float e7=0.88;const vec4 v7=vec4(0.8666666666666667,0.8235294117647058,0.21176470588235294,1);const float e8=1.0;const vec4 v8=vec4(0.8823529411764706,0.9921568627450981,0.29411764705882354,1);float a0=smoothstep(e0,e1,x_28);float a1=smoothstep(e1,e2,x_28);float a2=smoothstep(e2,e3,x_28);float a3=smoothstep(e3,e4,x_28);float a4=smoothstep(e4,e5,x_28);float a5=smoothstep(e5,e6,x_28);float a6=smoothstep(e6,e7,x_28);float a7=smoothstep(e7,e8,x_28);return max(mix(v0,v1,a0)*step(e0,x_28)*step(x_28,e1),max(mix(v1,v2,a1)*step(e1,x_28)*step(x_28,e2),max(mix(v2,v3,a2)*step(e2,x_28)*step(x_28,e3),max(mix(v3,v4,a3)*step(e3,x_28)*step(x_28,e4),max(mix(v4,v5,a4)*step(e4,x_28)*step(x_28,e5),max(mix(v5,v6,a5)*step(e5,x_28)*step(x_28,e6),max(mix(v6,v7,a6)*step(e6,x_28)*step(x_28,e7),mix(v7,v8,a7)*step(e7,x_28)*step(x_28,e8))))))));}vec4 phase(float x_39){const float e0=0.0;const vec4 v0=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);const float e1=0.13;const vec4 v1=vec4(0.7215686274509804,0.2784313725490196,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.7294117647058823,0.22745098039215686,0.45098039215686275,1);const float e3=0.38;const vec4 v3=vec4(0.6274509803921569,0.2784313725490196,0.7254901960784313,1);const float e4=0.5;const vec4 v4=vec4(0.43137254901960786,0.3803921568627451,0.8549019607843137,1);const float e5=0.63;const vec4 v5=vec4(0.19607843137254902,0.4823529411764706,0.6431372549019608,1);const float e6=0.75;const vec4 v6=vec4(0.12156862745098039,0.5137254901960784,0.43137254901960786,1);const float e7=0.88;const vec4 v7=vec4(0.30196078431372547,0.5058823529411764,0.13333333333333333,1);const float e8=1.0;const vec4 v8=vec4(0.5686274509803921,0.4117647058823529,0.07058823529411765,1);float a0=smoothstep(e0,e1,x_39);float a1=smoothstep(e1,e2,x_39);float a2=smoothstep(e2,e3,x_39);float a3=smoothstep(e3,e4,x_39);float a4=smoothstep(e4,e5,x_39);float a5=smoothstep(e5,e6,x_39);float a6=smoothstep(e6,e7,x_39);float a7=smoothstep(e7,e8,x_39);return max(mix(v0,v1,a0)*step(e0,x_39)*step(x_39,e1),max(mix(v1,v2,a1)*step(e1,x_39)*step(x_39,e2),max(mix(v2,v3,a2)*step(e2,x_39)*step(x_39,e3),max(mix(v3,v4,a3)*step(e3,x_39)*step(x_39,e4),max(mix(v4,v5,a4)*step(e4,x_39)*step(x_39,e5),max(mix(v5,v6,a5)*step(e5,x_39)*step(x_39,e6),max(mix(v6,v7,a6)*step(e6,x_39)*step(x_39,e7),mix(v7,v8,a7)*step(e7,x_39)*step(x_39,e8))))))));}vec4 salinity(float x_26){const float e0=0.0;const vec4 v0=vec4(0.16470588235294117,0.09411764705882353,0.4235294117647059,1);const float e1=0.13;const vec4 v1=vec4(0.12941176470588237,0.19607843137254902,0.6352941176470588,1);const float e2=0.25;const vec4 v2=vec4(0.058823529411764705,0.35294117647058826,0.5686274509803921,1);const float e3=0.38;const vec4 v3=vec4(0.1568627450980392,0.4627450980392157,0.5372549019607843,1);const float e4=0.5;const vec4 v4=vec4(0.23137254901960785,0.5725490196078431,0.5294117647058824,1);const float e5=0.63;const vec4 v5=vec4(0.30980392156862746,0.6862745098039216,0.49411764705882355,1);const float e6=0.75;const vec4 v6=vec4(0.47058823529411764,0.796078431372549,0.40784313725490196,1);const float e7=0.88;const vec4 v7=vec4(0.7568627450980392,0.8666666666666667,0.39215686274509803,1);const float e8=1.0;const vec4 v8=vec4(0.9921568627450981,0.9372549019607843,0.6039215686274509,1);float a0=smoothstep(e0,e1,x_26);float a1=smoothstep(e1,e2,x_26);float a2=smoothstep(e2,e3,x_26);float a3=smoothstep(e3,e4,x_26);float a4=smoothstep(e4,e5,x_26);float a5=smoothstep(e5,e6,x_26);float a6=smoothstep(e6,e7,x_26);float a7=smoothstep(e7,e8,x_26);return max(mix(v0,v1,a0)*step(e0,x_26)*step(x_26,e1),max(mix(v1,v2,a1)*step(e1,x_26)*step(x_26,e2),max(mix(v2,v3,a2)*step(e2,x_26)*step(x_26,e3),max(mix(v3,v4,a3)*step(e3,x_26)*step(x_26,e4),max(mix(v4,v5,a4)*step(e4,x_26)*step(x_26,e5),max(mix(v5,v6,a5)*step(e5,x_26)*step(x_26,e6),max(mix(v6,v7,a6)*step(e6,x_26)*step(x_26,e7),mix(v7,v8,a7)*step(e7,x_26)*step(x_26,e8))))))));}vec4 temperature(float x_8){const float e0=0.0;const vec4 v0=vec4(0.01568627450980392,0.13725490196078433,0.2,1);const float e1=0.13;const vec4 v1=vec4(0.09019607843137255,0.2,0.47843137254901963,1);const float e2=0.25;const vec4 v2=vec4(0.3333333333333333,0.23137254901960785,0.615686274509804,1);const float e3=0.38;const vec4 v3=vec4(0.5058823529411764,0.30980392156862746,0.5607843137254902,1);const float e4=0.5;const vec4 v4=vec4(0.6862745098039216,0.37254901960784315,0.5098039215686274,1);const float e5=0.63;const vec4 v5=vec4(0.8705882352941177,0.4392156862745098,0.396078431372549,1);const float e6=0.75;const vec4 v6=vec4(0.9764705882352941,0.5725490196078431,0.25882352941176473,1);const float e7=0.88;const vec4 v7=vec4(0.9764705882352941,0.7686274509803922,0.2549019607843137,1);const float e8=1.0;const vec4 v8=vec4(0.9098039215686274,0.9803921568627451,0.3568627450980392,1);float a0=smoothstep(e0,e1,x_8);float a1=smoothstep(e1,e2,x_8);float a2=smoothstep(e2,e3,x_8);float a3=smoothstep(e3,e4,x_8);float a4=smoothstep(e4,e5,x_8);float a5=smoothstep(e5,e6,x_8);float a6=smoothstep(e6,e7,x_8);float a7=smoothstep(e7,e8,x_8);return max(mix(v0,v1,a0)*step(e0,x_8)*step(x_8,e1),max(mix(v1,v2,a1)*step(e1,x_8)*step(x_8,e2),max(mix(v2,v3,a2)*step(e2,x_8)*step(x_8,e3),max(mix(v3,v4,a3)*step(e3,x_8)*step(x_8,e4),max(mix(v4,v5,a4)*step(e4,x_8)*step(x_8,e5),max(mix(v5,v6,a5)*step(e5,x_8)*step(x_8,e6),max(mix(v6,v7,a6)*step(e6,x_8)*step(x_8,e7),mix(v7,v8,a7)*step(e7,x_8)*step(x_8,e8))))))));}vec4 turbidity(float x_40){const float e0=0.0;const vec4 v0=vec4(0.13333333333333333,0.12156862745098039,0.10588235294117647,1);const float e1=0.13;const vec4 v1=vec4(0.2549019607843137,0.19607843137254902,0.1607843137254902,1);const float e2=0.25;const vec4 v2=vec4(0.3843137254901961,0.27058823529411763,0.20392156862745098,1);const float e3=0.38;const vec4 v3=vec4(0.5137254901960784,0.34901960784313724,0.2235294117647059,1);const float e4=0.5;const vec4 v4=vec4(0.6313725490196078,0.4392156862745098,0.23137254901960785,1);const float e5=0.63;const vec4 v5=vec4(0.7254901960784313,0.5490196078431373,0.25882352941176473,1);const float e6=0.75;const vec4 v6=vec4(0.792156862745098,0.6823529411764706,0.34509803921568627,1);const float e7=0.88;const vec4 v7=vec4(0.8470588235294118,0.8196078431372549,0.49411764705882355,1);const float e8=1.0;const vec4 v8=vec4(0.9137254901960784,0.9647058823529412,0.6705882352941176,1);float a0=smoothstep(e0,e1,x_40);float a1=smoothstep(e1,e2,x_40);float a2=smoothstep(e2,e3,x_40);float a3=smoothstep(e3,e4,x_40);float a4=smoothstep(e4,e5,x_40);float a5=smoothstep(e5,e6,x_40);float a6=smoothstep(e6,e7,x_40);float a7=smoothstep(e7,e8,x_40);return max(mix(v0,v1,a0)*step(e0,x_40)*step(x_40,e1),max(mix(v1,v2,a1)*step(e1,x_40)*step(x_40,e2),max(mix(v2,v3,a2)*step(e2,x_40)*step(x_40,e3),max(mix(v3,v4,a3)*step(e3,x_40)*step(x_40,e4),max(mix(v4,v5,a4)*step(e4,x_40)*step(x_40,e5),max(mix(v5,v6,a5)*step(e5,x_40)*step(x_40,e6),max(mix(v6,v7,a6)*step(e6,x_40)*step(x_40,e7),mix(v7,v8,a7)*step(e7,x_40)*step(x_40,e8))))))));}vec4 velocity_blue_297387650(float x_2){const float e0=0.0;const vec4 v0=vec4(0.06666666666666667,0.12549019607843137,0.25098039215686274,1);const float e1=0.13;const vec4 v1=vec4(0.13725490196078433,0.20392156862745098,0.4549019607843137,1);const float e2=0.25;const vec4 v2=vec4(0.11372549019607843,0.3176470588235294,0.611764705882353,1);const float e3=0.38;const vec4 v3=vec4(0.12156862745098039,0.44313725490196076,0.6352941176470588,1);const float e4=0.5;const vec4 v4=vec4(0.19607843137254902,0.5647058823529412,0.6627450980392157,1);const float e5=0.63;const vec4 v5=vec4(0.3411764705882353,0.6784313725490196,0.6901960784313725,1);const float e6=0.75;const vec4 v6=vec4(0.5843137254901961,0.7686274509803922,0.7411764705882353,1);const float e7=0.88;const vec4 v7=vec4(0.796078431372549,0.8666666666666667,0.8274509803921568,1);const float e8=1.0;const vec4 v8=vec4(0.996078431372549,0.984313725490196,0.9019607843137255,1);float a0=smoothstep(e0,e1,x_2);float a1=smoothstep(e1,e2,x_2);float a2=smoothstep(e2,e3,x_2);float a3=smoothstep(e3,e4,x_2);float a4=smoothstep(e4,e5,x_2);float a5=smoothstep(e5,e6,x_2);float a6=smoothstep(e6,e7,x_2);float a7=smoothstep(e7,e8,x_2);return max(mix(v0,v1,a0)*step(e0,x_2)*step(x_2,e1),max(mix(v1,v2,a1)*step(e1,x_2)*step(x_2,e2),max(mix(v2,v3,a2)*step(e2,x_2)*step(x_2,e3),max(mix(v3,v4,a3)*step(e3,x_2)*step(x_2,e4),max(mix(v4,v5,a4)*step(e4,x_2)*step(x_2,e5),max(mix(v5,v6,a5)*step(e5,x_2)*step(x_2,e6),max(mix(v6,v7,a6)*step(e6,x_2)*step(x_2,e7),mix(v7,v8,a7)*step(e7,x_2)*step(x_2,e8))))))));}vec4 velocity_green_2558432129(float x_27){const float e0=0.0;const vec4 v0=vec4(0.09019607843137255,0.13725490196078433,0.07450980392156863,1);const float e1=0.13;const vec4 v1=vec4(0.09411764705882353,0.25098039215686274,0.14901960784313725,1);const float e2=0.25;const vec4 v2=vec4(0.043137254901960784,0.37254901960784315,0.17647058823529413,1);const float e3=0.38;const vec4 v3=vec4(0.15294117647058825,0.4823529411764706,0.13725490196078433,1);const float e4=0.5;const vec4 v4=vec4(0.37254901960784315,0.5725490196078431,0.047058823529411764,1);const float e5=0.63;const vec4 v5=vec4(0.596078431372549,0.6470588235294118,0.07058823529411765,1);const float e6=0.75;const vec4 v6=vec4(0.788235294117647,0.7294117647058823,0.27058823529411763,1);const float e7=0.88;const vec4 v7=vec4(0.9137254901960784,0.8470588235294118,0.5372549019607843,1);const float e8=1.0;const vec4 v8=vec4(1,0.9921568627450981,0.803921568627451,1);float a0=smoothstep(e0,e1,x_27);float a1=smoothstep(e1,e2,x_27);float a2=smoothstep(e2,e3,x_27);float a3=smoothstep(e3,e4,x_27);float a4=smoothstep(e4,e5,x_27);float a5=smoothstep(e5,e6,x_27);float a6=smoothstep(e6,e7,x_27);float a7=smoothstep(e7,e8,x_27);return max(mix(v0,v1,a0)*step(e0,x_27)*step(x_27,e1),max(mix(v1,v2,a1)*step(e1,x_27)*step(x_27,e2),max(mix(v2,v3,a2)*step(e2,x_27)*step(x_27,e3),max(mix(v3,v4,a3)*step(e3,x_27)*step(x_27,e4),max(mix(v4,v5,a4)*step(e4,x_27)*step(x_27,e5),max(mix(v5,v6,a5)*step(e5,x_27)*step(x_27,e6),max(mix(v6,v7,a6)*step(e6,x_27)*step(x_27,e7),mix(v7,v8,a7)*step(e7,x_27)*step(x_27,e8))))))));}vec4 cubehelix(float x_37){const float e0=0.0;const vec4 v0=vec4(0,0,0,1);const float e1=0.07;const vec4 v1=vec4(0.08627450980392157,0.0196078431372549,0.23137254901960785,1);const float e2=0.13;const vec4 v2=vec4(0.23529411764705882,0.01568627450980392,0.4117647058823529,1);const float e3=0.2;const vec4 v3=vec4(0.42745098039215684,0.00392156862745098,0.5294117647058824,1);const float e4=0.27;const vec4 v4=vec4(0.6313725490196078,0,0.5764705882352941,1);const float e5=0.33;const vec4 v5=vec4(0.8235294117647058,0.00784313725490196,0.5568627450980392,1);const float e6=0.4;const vec4 v6=vec4(0.984313725490196,0.043137254901960784,0.4823529411764706,1);const float e7=0.47;const vec4 v7=vec4(1,0.11372549019607843,0.3803921568627451,1);const float e8=0.53;const vec4 v8=vec4(1,0.21176470588235294,0.27058823529411763,1);const float e9=0.6;const vec4 v9=vec4(1,0.3333333333333333,0.1803921568627451,1);const float e10=0.67;const vec4 v10=vec4(1,0.47058823529411764,0.13333333333333333,1);const float e11=0.73;const vec4 v11=vec4(1,0.615686274509804,0.1450980392156863,1);const float e12=0.8;const vec4 v12=vec4(0.9450980392156862,0.7490196078431373,0.2235294117647059,1);const float e13=0.87;const vec4 v13=vec4(0.8784313725490196,0.8627450980392157,0.36470588235294116,1);const float e14=0.93;const vec4 v14=vec4(0.8549019607843137,0.9450980392156862,0.5568627450980392,1);const float e15=1.0;const vec4 v15=vec4(0.8901960784313725,0.9921568627450981,0.7764705882352941,1);float a0=smoothstep(e0,e1,x_37);float a1=smoothstep(e1,e2,x_37);float a2=smoothstep(e2,e3,x_37);float a3=smoothstep(e3,e4,x_37);float a4=smoothstep(e4,e5,x_37);float a5=smoothstep(e5,e6,x_37);float a6=smoothstep(e6,e7,x_37);float a7=smoothstep(e7,e8,x_37);float a8=smoothstep(e8,e9,x_37);float a9=smoothstep(e9,e10,x_37);float a10=smoothstep(e10,e11,x_37);float a11=smoothstep(e11,e12,x_37);float a12=smoothstep(e12,e13,x_37);float a13=smoothstep(e13,e14,x_37);float a14=smoothstep(e14,e15,x_37);return max(mix(v0,v1,a0)*step(e0,x_37)*step(x_37,e1),max(mix(v1,v2,a1)*step(e1,x_37)*step(x_37,e2),max(mix(v2,v3,a2)*step(e2,x_37)*step(x_37,e3),max(mix(v3,v4,a3)*step(e3,x_37)*step(x_37,e4),max(mix(v4,v5,a4)*step(e4,x_37)*step(x_37,e5),max(mix(v5,v6,a5)*step(e5,x_37)*step(x_37,e6),max(mix(v6,v7,a6)*step(e6,x_37)*step(x_37,e7),max(mix(v7,v8,a7)*step(e7,x_37)*step(x_37,e8),max(mix(v8,v9,a8)*step(e8,x_37)*step(x_37,e9),max(mix(v9,v10,a9)*step(e9,x_37)*step(x_37,e10),max(mix(v10,v11,a10)*step(e10,x_37)*step(x_37,e11),max(mix(v11,v12,a11)*step(e11,x_37)*step(x_37,e12),max(mix(v12,v13,a12)*step(e12,x_37)*step(x_37,e13),max(mix(v13,v14,a13)*step(e13,x_37)*step(x_37,e14),mix(v14,v15,a14)*step(e14,x_37)*step(x_37,e15)))))))))))))));}float apply_contrast_limits(float intensity,vec2 contrastLimits){float contrastLimitsAppliedToIntensity=(intensity-contrastLimits[0])/max(0.0005,(contrastLimits[1]-contrastLimits[0]));return max(0.,contrastLimitsAppliedToIntensity);}vec4 colormap(float intensity,float opacity){return vec4(COLORMAP_FUNCTION(min(1.,intensity)).xyz,opacity);}`,IR={name:"channel-intensity-module",fs:PM};const JM={[ai.MAX_INTENSITY_PROJECTION]:{_BEFORE_RENDER:`      float maxVals[6] = float[6](-1.0, -1.0, -1.0, -1.0, -1.0, -1.0);
    `,_RENDER:`    
      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);

      for(int i = 0; i < 6; i++) {
        if(intensityArray[i] > maxVals[i]) {
          maxVals[i] = intensityArray[i];
        }
      }
    `,_AFTER_RENDER:`      vec3 rgbCombo = vec3(0.0);
      for(int i = 0; i < 6; i++) {
        rgbCombo += max(0.0, min(1.0, maxVals[i])) * vec3(colors[i]);
      }
      color = vec4(rgbCombo, 1.0);
    `},[ai.MIN_INTENSITY_PROJECTION]:{_BEFORE_RENDER:`      float minVals[6] = float[6](1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0.);
    `,_RENDER:`    
      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);

      for(int i = 0; i < 6; i++) {
        if(intensityArray[i] < minVals[i]) {
          minVals[i] = intensityArray[i];
        }
      }
    `,_AFTER_RENDER:`      vec3 rgbCombo = vec3(0.0);
      for(int i = 0; i < 6; i++) {
        rgbCombo += max(0.0, min(1.0, minVals[i])) * vec3(colors[i]);
      }
      color = vec4(rgbCombo, 1.0);
    `},[ai.ADDITIVE]:{_BEFORE_RENDER:"",_RENDER:`      vec3 rgbCombo = vec3(0.0);
      vec3 hsvCombo = vec3(0.0);
      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);
      float total = 0.0;
      for(int i = 0; i < 6; i++) {
        float intensityValue = intensityArray[i];
        rgbCombo += max(0.0, min(1.0, intensityValue)) * colors[i];
        total += intensityValue;
      }
      // Do not go past 1 in opacity.
      total = min(total, 1.0);
      vec4 val_color = vec4(rgbCombo, total);
      // Opacity correction
      val_color.a = 1.0 - pow(1.0 - val_color.a, 1.0);
      color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;
      color.a += (1.0 - color.a) * val_color.a;
      if (color.a >= 0.95) {
        break;
      }
    `,_AFTER_RENDER:""}},DM={[ai.MAX_INTENSITY_PROJECTION]:{_BEFORE_RENDER:`      float maxVals[6] = float[6](-1.0, -1.0, -1.0, -1.0, -1.0, -1.0);
    `,_RENDER:`    
      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);

      for(int i = 0; i < 6; i++) {
        if(intensityArray[i] > maxVals[i]) {
          maxVals[i] = intensityArray[i];
        }
      }
    `,_AFTER_RENDER:`      float total = 0.0;
      for(int i = 0; i < 6; i++) {
        total += maxVals[i];
      }
      // Do not go past 1 in opacity/colormap value.
      total = min(total, 1.0);
      color = colormap(total, total);
    `},[ai.MIN_INTENSITY_PROJECTION]:{_BEFORE_RENDER:`      float minVals[6] = float[6](1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0., 1. / 0.);
    `,_RENDER:`    
      float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);

      for(int i = 0; i < 6; i++) {
        if(intensityArray[i] < minVals[i]) {
          minVals[i] = intensityArray[i];
        }
      }
    `,_AFTER_RENDER:`      float total = 0.0;
      for(int i = 0; i < 6; i++) {
        total += minVals[i];
      }
      // Do not go past 1 in opacity/colormap value.
      total = min(total, 1.0);
      color = colormap(total, total);
    `},[ai.ADDITIVE]:{_BEFORE_RENDER:"",_RENDER:`    float intensityArray[6] = float[6](intensityValue0, intensityValue1, intensityValue2, intensityValue3, intensityValue4, intensityValue5);
		float total = 0.0;

		for(int i = 0; i < 6; i++) {
			total += intensityArray[i];
		}
		// Do not go past 1 in opacity/colormap value.
		total = min(total, 1.0);

		vec4 val_color = colormap(total, total);

		// Opacity correction
		val_color.a = 1.0 - pow(1.0 - val_color.a, 1.0);
		color.rgb += (1.0 - color.a) * val_color.a * val_color.rgb;
		color.a += (1.0 - color.a) * val_color.a;
		if (color.a >= 0.95) {
			break;
		}
    p += ray_dir * dt;
    `,_AFTER_RENDER:""}},zM=[1,1,0,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,0,0,0,1,1,0,1,0,0,1,1,1,1,0,1,0,0,1,1,0,0,0,0,0],aR=1,OM={pickable:!1,coordinateSystem:ce.CARTESIAN,channelData:{type:"object",value:{},compare:!0},colors:{type:"array",value:[],compare:!0},contrastLimits:{type:"array",value:[],compare:!0},dtype:{type:"string",value:"Uint8",compare:!0},colormap:{type:"string",value:"",compare:!0},xSlice:{type:"array",value:null,compare:!0},ySlice:{type:"array",value:null,compare:!0},zSlice:{type:"array",value:null,compare:!0},clippingPlanes:{type:"array",value:[],compare:!0},renderingMode:{type:"string",value:ai.ADDITIVE,compare:!0},resolutionMatrix:{type:"object",value:new Pe,compare:!0}};function lR(){const t=qh("Float32");return J(S({},t),{sampler:t.sampler.replace("2D","3D"),cast:e=>new Float32Array(e)})}function jM(t){const e=yM.filter(g=>g!==(t||"viridis")).map(g=>g.replace(/-/g,"_")),n=new RegExp(`vec4 (${e.join("(_([0-9]*))?|")})\\(float x_[0-9]+\\){([^}]+)}`,"g");return J(S({},IR),{fs:IR.fs.replace(n,""),defines:{COLORMAP_FUNCTION:t||"viridis"}})}const nm=class extends An{initializeState(){const{gl:t}=this.context;t.pixelStorei(q.UNPACK_ALIGNMENT,1),t.pixelStorei(q.PACK_ALIGNMENT,1);const e=rs.getDefaultProgramManager(t),n="fs:DECKGL_PROCESS_INTENSITY(inout float intensity, vec2 contrastLimits, int channelIndex)";e._hookFunctions.includes(n)||e.addShaderHook(n)}_isHookDefinedByExtensions(t){const{extensions:e}=this.props;return e==null?void 0:e.some(n=>{const i=n.getShaders(),{inject:g={},modules:s=[]}=i,o=g[t],r=s.some(I=>I==null?void 0:I.inject[t]);return o||r})}getShaders(){const{colormap:t,renderingMode:e,clippingPlanes:n}=this.props,{sampler:i}=lR(),{_BEFORE_RENDER:g,_RENDER:s,_AFTER_RENDER:o}=t?DM[e]:JM[e],r=jM(t),I=this._isHookDefinedByExtensions("fs:DECKGL_PROCESS_INTENSITY"),a=J(S({},r),{inject:{}});return I||(a.inject["fs:DECKGL_PROCESS_INTENSITY"]=`
        intensity = apply_contrast_limits(intensity, contrastLimits);
      `),super.getShaders({vs:LM,fs:MM.replace("_BEFORE_RENDER",g).replace("_RENDER",s).replace("_AFTER_RENDER",o),defines:{SAMPLER_TYPE:i,COLORMAP_FUNCTION:t||"viridis",NUM_PLANES:String(n.length||aR)},modules:[a]})}finalizeState(){super.finalizeState(),this.state.textures&&Object.values(this.state.textures).forEach(t=>t&&t.delete())}updateState({props:t,oldProps:e,changeFlags:n}){var i,g;if(n.extensionsChanged||t.colormap!==e.colormap||t.renderingMode!==e.renderingMode||t.clippingPlanes.length!==e.clippingPlanes.length){const{gl:s}=this.context;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(s)})}t.channelData&&((i=t==null?void 0:t.channelData)==null?void 0:i.data)!==((g=e==null?void 0:e.channelData)==null?void 0:g.data)&&this.loadTexture(t.channelData)}_getModel(t){return t?new Zn(t,J(S({},this.getShaders()),{geometry:new ni({drawMode:t.TRIANGLE_STRIP,attributes:{positions:new Float32Array(zM)}})})):null}draw({uniforms:t}){const{textures:e,model:n,scaleMatrix:i}=this.state,{contrastLimits:g,colors:s,xSlice:o,ySlice:r,zSlice:I,modelMatrix:a,channelsVisible:l,domain:C,dtype:c,clippingPlanes:A,resolutionMatrix:d}=this.props,{viewMatrix:m,viewMatrixInverse:u,projectionMatrix:h}=this.context.viewport;if(e&&n&&i){const f=O2({contrastLimits:g,channelsVisible:l,domain:C,dtype:c}),p=tm({colors:s,channelsVisible:l}),b=i.clone().invert(),Z=d.clone().invert(),v=jh(A.map(V=>V.clone().transform(b).transform(Z)),new Sg([1,0,0]),A.length||aR),N=v.map(V=>V.normal).flat(),x=v.map(V=>V.distance);n.setUniforms(J(S(S({},t),e),{contrastLimits:f,colors:p,xSlice:new Float32Array(o?o.map(V=>V/i[0]/d[0]):[0,1]),ySlice:new Float32Array(r?r.map(V=>V/i[5]/d[5]):[0,1]),zSlice:new Float32Array(I?I.map(V=>V/i[10]/d[10]):[0,1]),eye_pos:new Float32Array([u[12],u[13],u[14]]),view:m,proj:h,scale:i,resolution:d,model:a||new Pe,normals:N,distances:x})).draw()}}loadTexture(t){const e={volume0:null,volume1:null,volume2:null,volume3:null,volume4:null,volume5:null};if(this.state.textures&&Object.values(this.state.textures).forEach(n=>n&&n.delete()),t&&Object.keys(t).length>0&&t.data){const{height:n,width:i,depth:g}=t;t.data.forEach((s,o)=>{e[`volume${o}`]=this.dataToTexture(s,i,n,g)},this),this.setState({textures:e,scaleMatrix:new Pe().scale(this.props.physicalSizeScalingMatrix.transformPoint([i,n,g]))})}}dataToTexture(t,e,n,i){var o,r;const g=lR();return new Cv(this.context.gl,{width:e,height:n,depth:i,data:(r=(o=g.cast)==null?void 0:o.call(g,t))!=null?r:t,format:g.dataFormat,dataFormat:g.format,type:g.type,mipmaps:!1,parameters:{[q.TEXTURE_MIN_FILTER]:q.LINEAR,[q.TEXTURE_MAG_FILTER]:q.LINEAR,[q.TEXTURE_WRAP_S]:q.CLAMP_TO_EDGE,[q.TEXTURE_WRAP_T]:q.CLAMP_TO_EDGE,[q.TEXTURE_WRAP_R]:q.CLAMP_TO_EDGE}})}};nm.layerName="XR3DLayer";nm.defaultProps=OM;async function qM({source:t,selection:e,onUpdate:n=()=>{},downsampleDepth:i=1,signal:g}){const{shape:s,labels:o,dtype:r}=t,{height:I,width:a}=sa(t),l=s[o.indexOf("z")],C=Math.max(1,Math.floor(l/i)),c=I*a,A=`${r}Array`,d=globalThis[A],m=new d(c*C);return await Promise.all(new Array(C).fill(0).map(async(u,h)=>{const f=J(S({},e),{z:h*i}),{data:p}=await t.getRaster({selection:f,signal:g});let b=0;for(n();b<c;){const Z=h*c+(c-b-1),v=(a-b-1)%a+a*Math.floor(b/a);m[Z]=p[v],b+=1}n()})),{data:m,height:I,width:a,depth:C}}const CR=(t,e,n)=>new JI({id:`text-${n}`,coordinateSystem:ce.CARTESIAN,data:[{text:t,position:e.position}],getColor:[220,220,220,255],getSize:25,sizeUnits:"meters",sizeScale:2**-e.zoom,fontFamily:"Helvetica"}),$M={pickable:!1,coordinateSystem:ce.CARTESIAN,contrastLimits:{type:"array",value:[],compare:!0},channelsVisible:{type:"array",value:[],compare:!0},colors:{type:"array",value:[],compare:!0},colormap:{type:"string",value:"",compare:!0},selections:{type:"array",value:[],compare:!0},resolution:{type:"number",value:0,compare:!0},domain:{type:"array",value:[],compare:!0},loader:{type:"object",value:[{getRaster:async()=>({data:[],height:0,width:0}),dtype:"Uint16",shape:[1],labels:["z"]}],compare:!0},xSlice:{type:"array",value:null,compare:!0},ySlice:{type:"array",value:null,compare:!0},zSlice:{type:"array",value:null,compare:!0},clippingPlanes:{type:"array",value:[],compare:!0},renderingMode:{type:"string",value:ai.MAX_INTENSITY_PROJECTION,compare:!0},onUpdate:{type:"function",value:()=>{},compare:!0},useProgressIndicator:{type:"boolean",value:!0,compare:!0},useWebGL1Warning:{type:"boolean",value:!0,compare:!0}},cR=class extends kn{clearState(){this.setState({height:null,width:null,depth:null,data:null,physicalSizeScalingMatrix:null,resolutionMatrix:null,progress:0,abortController:null})}finalizeState(){this.state.abortController.abort()}updateState({oldProps:t,props:e}){const n=e.loader!==t.loader,i=e.resolution!==t.resolution,g=e.selections!==t.selections;if(i&&this.clearState(),n||g||i){const{loader:s,selections:o=[],resolution:r,onViewportLoad:I}=this.props,a=s[r];let l=0;const C=(a.shape[a.labels.indexOf("z")]>>r)*o.length,c=()=>{l+=.5/C,this.props.onUpdate&&this.props.onUpdate({progress:l}),this.setState({progress:l})},A=new AbortController;this.setState({abortController:A});const{signal:d}=A,m=o.map(h=>qM({selection:h,source:a,onUpdate:c,downsampleDepth:2**r,signal:d})),u=GM(s[r]);Promise.all(m).then(h=>{I&&I(h);const f={data:h.map(p=>p.data),width:h[0].width,height:h[0].height,depth:h[0].depth};this.setState(J(S({},f),{physicalSizeScalingMatrix:u,resolutionMatrix:new Pe().scale(2**r)}))})}}renderLayers(){const{loader:t,id:e,resolution:n,useProgressIndicator:i,useWebGL1Warning:g}=this.props,{dtype:s}=t[n],{data:o,width:r,height:I,depth:a,progress:l,physicalSizeScalingMatrix:C,resolutionMatrix:c}=this.state,{gl:A}=this.context;if(!ye(A)&&g){const{viewport:d}=this.context;return CR(["Volume rendering is only available on browsers that support WebGL2. If you","are using Safari, you can turn on WebGL2 by navigating in the top menubar","to check Develop > Experimental Features > WebGL 2.0 and then refreshing","the page."].join(`
`),d,e)}if(!(r&&I)&&i){const{viewport:d}=this.context;return CR(`Loading Volume ${String((l||0)*100).slice(0,5)}%...`,d,e)}return new nm(this.props,{channelData:{data:o,width:r,height:I,depth:a},id:`XR3DLayer-${0}-${I}-${r}-${0}-${n}-${e}`,physicalSizeScalingMatrix:C,parameters:{[q.CULL_FACE]:!0,[q.CULL_FACE_MODE]:q.FRONT,[q.DEPTH_TEST]:!1,blendFunc:[q.SRC_ALPHA,q.ONE],blend:!0},resolutionMatrix:c,dtype:s})}};cR.layerName="VolumeLayer";cR.defaultProps=$M;const eP="KGZ1bmN0aW9uICgpIHsKICAndXNlIHN0cmljdCc7CgogIGZ1bmN0aW9uIGRlY29kZVJvd0FjYyhyb3csIHN0cmlkZSkgewogICAgbGV0IGxlbmd0aCA9IHJvdy5sZW5ndGggLSBzdHJpZGU7CiAgICBsZXQgb2Zmc2V0ID0gMDsKICAgIGRvIHsKICAgICAgZm9yIChsZXQgaSA9IHN0cmlkZTsgaSA+IDA7IGktLSkgewogICAgICAgIHJvd1tvZmZzZXQgKyBzdHJpZGVdICs9IHJvd1tvZmZzZXRdOwogICAgICAgIG9mZnNldCsrOwogICAgICB9CgogICAgICBsZW5ndGggLT0gc3RyaWRlOwogICAgfSB3aGlsZSAobGVuZ3RoID4gMCk7CiAgfQoKICBmdW5jdGlvbiBkZWNvZGVSb3dGbG9hdGluZ1BvaW50KHJvdywgc3RyaWRlLCBieXRlc1BlclNhbXBsZSkgewogICAgbGV0IGluZGV4ID0gMDsKICAgIGxldCBjb3VudCA9IHJvdy5sZW5ndGg7CiAgICBjb25zdCB3YyA9IGNvdW50IC8gYnl0ZXNQZXJTYW1wbGU7CgogICAgd2hpbGUgKGNvdW50ID4gc3RyaWRlKSB7CiAgICAgIGZvciAobGV0IGkgPSBzdHJpZGU7IGkgPiAwOyAtLWkpIHsKICAgICAgICByb3dbaW5kZXggKyBzdHJpZGVdICs9IHJvd1tpbmRleF07CiAgICAgICAgKytpbmRleDsKICAgICAgfQogICAgICBjb3VudCAtPSBzdHJpZGU7CiAgICB9CgogICAgY29uc3QgY29weSA9IHJvdy5zbGljZSgpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3YzsgKytpKSB7CiAgICAgIGZvciAobGV0IGIgPSAwOyBiIDwgYnl0ZXNQZXJTYW1wbGU7ICsrYikgewogICAgICAgIHJvd1soYnl0ZXNQZXJTYW1wbGUgKiBpKSArIGJdID0gY29weVsoKGJ5dGVzUGVyU2FtcGxlIC0gYiAtIDEpICogd2MpICsgaV07CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGFwcGx5UHJlZGljdG9yKGJsb2NrLCBwcmVkaWN0b3IsIHdpZHRoLCBoZWlnaHQsIGJpdHNQZXJTYW1wbGUsCiAgICBwbGFuYXJDb25maWd1cmF0aW9uKSB7CiAgICBpZiAoIXByZWRpY3RvciB8fCBwcmVkaWN0b3IgPT09IDEpIHsKICAgICAgcmV0dXJuIGJsb2NrOwogICAgfQoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYml0c1BlclNhbXBsZS5sZW5ndGg7ICsraSkgewogICAgICBpZiAoYml0c1BlclNhbXBsZVtpXSAlIDggIT09IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1doZW4gZGVjb2Rpbmcgd2l0aCBwcmVkaWN0b3IsIG9ubHkgbXVsdGlwbGUgb2YgOCBiaXRzIGFyZSBzdXBwb3J0ZWQuJyk7CiAgICAgIH0KICAgICAgaWYgKGJpdHNQZXJTYW1wbGVbaV0gIT09IGJpdHNQZXJTYW1wbGVbMF0pIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1doZW4gZGVjb2Rpbmcgd2l0aCBwcmVkaWN0b3IsIGFsbCBzYW1wbGVzIG11c3QgaGF2ZSB0aGUgc2FtZSBzaXplLicpOwogICAgICB9CiAgICB9CgogICAgY29uc3QgYnl0ZXNQZXJTYW1wbGUgPSBiaXRzUGVyU2FtcGxlWzBdIC8gODsKICAgIGNvbnN0IHN0cmlkZSA9IHBsYW5hckNvbmZpZ3VyYXRpb24gPT09IDIgPyAxIDogYml0c1BlclNhbXBsZS5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoZWlnaHQ7ICsraSkgewogICAgICAvLyBMYXN0IHN0cmlwIHdpbGwgYmUgdHJ1bmNhdGVkIGlmIGhlaWdodCAlIHN0cmlwSGVpZ2h0ICE9IDAKICAgICAgaWYgKGkgKiBzdHJpZGUgKiB3aWR0aCAqIGJ5dGVzUGVyU2FtcGxlID49IGJsb2NrLmJ5dGVMZW5ndGgpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBsZXQgcm93OwogICAgICBpZiAocHJlZGljdG9yID09PSAyKSB7IC8vIGhvcml6b250YWwgcHJlZGljdGlvbgogICAgICAgIHN3aXRjaCAoYml0c1BlclNhbXBsZVswXSkgewogICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICByb3cgPSBuZXcgVWludDhBcnJheSgKICAgICAgICAgICAgICBibG9jaywgaSAqIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgcm93ID0gbmV3IFVpbnQxNkFycmF5KAogICAgICAgICAgICAgIGJsb2NrLCBpICogc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSwgc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSAvIDIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgcm93ID0gbmV3IFVpbnQzMkFycmF5KAogICAgICAgICAgICAgIGJsb2NrLCBpICogc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSwgc3RyaWRlICogd2lkdGggKiBieXRlc1BlclNhbXBsZSAvIDQsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBQcmVkaWN0b3IgMiBub3QgYWxsb3dlZCB3aXRoICR7Yml0c1BlclNhbXBsZVswXX0gYml0cyBwZXIgc2FtcGxlLmApOwogICAgICAgIH0KICAgICAgICBkZWNvZGVSb3dBY2Mocm93LCBzdHJpZGUpOwogICAgICB9IGVsc2UgaWYgKHByZWRpY3RvciA9PT0gMykgeyAvLyBob3Jpem9udGFsIGZsb2F0aW5nIHBvaW50CiAgICAgICAgcm93ID0gbmV3IFVpbnQ4QXJyYXkoCiAgICAgICAgICBibG9jaywgaSAqIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsIHN0cmlkZSAqIHdpZHRoICogYnl0ZXNQZXJTYW1wbGUsCiAgICAgICAgKTsKICAgICAgICBkZWNvZGVSb3dGbG9hdGluZ1BvaW50KHJvdywgc3RyaWRlLCBieXRlc1BlclNhbXBsZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBibG9jazsKICB9CgogIGNsYXNzIEJhc2VEZWNvZGVyIHsKICAgIGFzeW5jIGRlY29kZShmaWxlRGlyZWN0b3J5LCBidWZmZXIpIHsKICAgICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IHRoaXMuZGVjb2RlQmxvY2soYnVmZmVyKTsKICAgICAgY29uc3QgcHJlZGljdG9yID0gZmlsZURpcmVjdG9yeS5QcmVkaWN0b3IgfHwgMTsKICAgICAgaWYgKHByZWRpY3RvciAhPT0gMSkgewogICAgICAgIGNvbnN0IGlzVGlsZWQgPSAhZmlsZURpcmVjdG9yeS5TdHJpcE9mZnNldHM7CiAgICAgICAgY29uc3QgdGlsZVdpZHRoID0gaXNUaWxlZCA/IGZpbGVEaXJlY3RvcnkuVGlsZVdpZHRoIDogZmlsZURpcmVjdG9yeS5JbWFnZVdpZHRoOwogICAgICAgIGNvbnN0IHRpbGVIZWlnaHQgPSBpc1RpbGVkID8gZmlsZURpcmVjdG9yeS5UaWxlTGVuZ3RoIDogKAogICAgICAgICAgZmlsZURpcmVjdG9yeS5Sb3dzUGVyU3RyaXAgfHwgZmlsZURpcmVjdG9yeS5JbWFnZUxlbmd0aAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGFwcGx5UHJlZGljdG9yKAogICAgICAgICAgZGVjb2RlZCwgcHJlZGljdG9yLCB0aWxlV2lkdGgsIHRpbGVIZWlnaHQsIGZpbGVEaXJlY3RvcnkuQml0c1BlclNhbXBsZSwKICAgICAgICAgIGZpbGVEaXJlY3RvcnkuUGxhbmFyQ29uZmlndXJhdGlvbiwKICAgICAgICApOwogICAgICB9CiAgICAgIHJldHVybiBkZWNvZGVkOwogICAgfQogIH0KCiAgY2xhc3MgUmF3RGVjb2RlciBleHRlbmRzIEJhc2VEZWNvZGVyIHsKICAgIGRlY29kZUJsb2NrKGJ1ZmZlcikgewogICAgICByZXR1cm4gYnVmZmVyOwogICAgfQogIH0KCiAgbGV0IEEsST1udWxsO2Z1bmN0aW9uIGcoKXtyZXR1cm4gbnVsbCE9PUkmJkkuYnVmZmVyPT09QS5tZW1vcnkuYnVmZmVyfHwoST1uZXcgVWludDhBcnJheShBLm1lbW9yeS5idWZmZXIpKSxJfWxldCBCPTA7bGV0IFE9bnVsbDtmdW5jdGlvbiBDKCl7cmV0dXJuIG51bGwhPT1RJiZRLmJ1ZmZlcj09PUEubWVtb3J5LmJ1ZmZlcnx8KFE9bmV3IEludDMyQXJyYXkoQS5tZW1vcnkuYnVmZmVyKSksUX1hc3luYyBmdW5jdGlvbiBFKEkpe3ZvaWQgMD09PUkmJihJPSIiLnJlcGxhY2UoL1wuanMkLywiX2JnLndhc20iKSk7KCJzdHJpbmciPT10eXBlb2YgSXx8ImZ1bmN0aW9uIj09dHlwZW9mIFJlcXVlc3QmJkkgaW5zdGFuY2VvZiBSZXF1ZXN0fHwiZnVuY3Rpb24iPT10eXBlb2YgVVJMJiZJIGluc3RhbmNlb2YgVVJMKSYmKEk9ZmV0Y2goSSkpO2NvbnN0e2luc3RhbmNlOmcsbW9kdWxlOkJ9PWF3YWl0IGFzeW5jIGZ1bmN0aW9uKEEsSSl7aWYoImZ1bmN0aW9uIj09dHlwZW9mIFJlc3BvbnNlJiZBIGluc3RhbmNlb2YgUmVzcG9uc2Upe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZVN0cmVhbWluZyl0cnl7cmV0dXJuIGF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlU3RyZWFtaW5nKEEsSSl9Y2F0Y2goSSl7aWYoImFwcGxpY2F0aW9uL3dhc20iPT1BLmhlYWRlcnMuZ2V0KCJDb250ZW50LVR5cGUiKSl0aHJvdyBJO2NvbnNvbGUud2FybigiYFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlU3RyZWFtaW5nYCBmYWlsZWQgYmVjYXVzZSB5b3VyIHNlcnZlciBkb2VzIG5vdCBzZXJ2ZSB3YXNtIHdpdGggYGFwcGxpY2F0aW9uL3dhc21gIE1JTUUgdHlwZS4gRmFsbGluZyBiYWNrIHRvIGBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZWAgd2hpY2ggaXMgc2xvd2VyLiBPcmlnaW5hbCBlcnJvcjpcbiIsSSk7fWNvbnN0IGc9YXdhaXQgQS5hcnJheUJ1ZmZlcigpO3JldHVybiBhd2FpdCBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZShnLEkpfXtjb25zdCBnPWF3YWl0IFdlYkFzc2VtYmx5Lmluc3RhbnRpYXRlKEEsSSk7cmV0dXJuIGcgaW5zdGFuY2VvZiBXZWJBc3NlbWJseS5JbnN0YW5jZT97aW5zdGFuY2U6Zyxtb2R1bGU6QX06Z319KGF3YWl0IEkse30pO3JldHVybiBBPWcuZXhwb3J0cyxFLl9fd2JpbmRnZW5fd2FzbV9tb2R1bGU9QixBfXZhciBEPU9iamVjdC5mcmVlemUoe19fcHJvdG9fXzpudWxsLGRlY29tcHJlc3M6ZnVuY3Rpb24oSSxRKXt0cnl7Y29uc3QgRj1BLl9fd2JpbmRnZW5fYWRkX3RvX3N0YWNrX3BvaW50ZXIoLTE2KTt2YXIgRT1mdW5jdGlvbihBLEkpe2NvbnN0IFE9SSgxKkEubGVuZ3RoKTtyZXR1cm4gZygpLnNldChBLFEvMSksQj1BLmxlbmd0aCxRfShJLEEuX193YmluZGdlbl9tYWxsb2MpLEQ9QjtBLmRlY29tcHJlc3MoRixFLEQsUSk7dmFyIGk9QygpW0YvNCswXSx3PUMoKVtGLzQrMV0sRz0obz1pLE49dyxnKCkuc3ViYXJyYXkoby8xLG8vMStOKSkuc2xpY2UoKTtyZXR1cm4gQS5fX3diaW5kZ2VuX2ZyZWUoaSwxKncpLEd9ZmluYWxseXtBLl9fd2JpbmRnZW5fYWRkX3RvX3N0YWNrX3BvaW50ZXIoMTYpO312YXIgbyxOO30sZGVmYXVsdDpFfSk7Y29uc3QgaT1bNjIsMCwwLDAsNjMsNTIsNTMsNTQsNTUsNTYsNTcsNTgsNTksNjAsNjEsMCwwLDAsMCwwLDAsMCwwLDEsMiwzLDQsNSw2LDcsOCw5LDEwLDExLDEyLDEzLDE0LDE1LDE2LDE3LDE4LDE5LDIwLDIxLDIyLDIzLDI0LDI1LDAsMCwwLDAsMCwwLDI2LDI3LDI4LDI5LDMwLDMxLDMyLDMzLDM0LDM1LDM2LDM3LDM4LDM5LDQwLDQxLDQyLDQzLDQ0LDQ1LDQ2LDQ3LDQ4LDQ5LDUwLDUxXTtmdW5jdGlvbiB3KEEpe3JldHVybiBpW0EtNDNdfWNvbnN0IEc9ZnVuY3Rpb24oQSl7bGV0IEksZz1BLmVuZHNXaXRoKCI9PSIpPzI6QS5lbmRzV2l0aCgiPSIpPzE6MCxCPUEubGVuZ3RoLFE9bmV3IFVpbnQ4QXJyYXkoQi80KjMpO2ZvcihsZXQgZz0wLEM9MDtnPEI7Zys9NCxDKz0zKUk9dyhBLmNoYXJDb2RlQXQoZykpPDwxOHx3KEEuY2hhckNvZGVBdChnKzEpKTw8MTJ8dyhBLmNoYXJDb2RlQXQoZysyKSk8PDZ8dyhBLmNoYXJDb2RlQXQoZyszKSksUVtDXT1JPj4xNixRW0MrMV09ST4+OCYyNTUsUVtDKzJdPTI1NSZJO3JldHVybiBRLnN1YmFycmF5KDAsUS5sZW5ndGgtZyl9KCJBR0Z6YlFFQUFBQUJXUTVnQW45L0FYOWdBMzkvZndGL1lBSi9md0JnQVg4QVlBTi9mMzhBWUFGL0FYOWdCSDkvZjM4QVlBUi9mMzkvQVg5Z0JuOS9mMzkvZndCZ0FYOEJmbUFBQUdBRmYzOS9mMzhBWUFWL2YzOS9md0YvWUFKK2Z3Ri9BMjFzQlFnSUN3TUJBZ1VNQVFBQkFBSUFCUUFDQWdZR0RRWURBZ0FDQUFBRUJBUUNBZ1lHQUFZQkJnSUhBd1FEQkFRREF3QURCUU1EQkFRRUJBUUNBZ0FIQUFRQUFnTUJBZ2NGQkFJREFRVUNBZ0lEQWdJREF3Y0NBUUFBQkFJQUNnQUFBUUFGQWdBREJRa0pDUU1DQkFVQmNBRXJLd1VEQVFBUkJna0Jmd0ZCZ0lEQUFBc0hYd1VHYldWdGIzSjVBZ0FLWkdWamIyMXdjbVZ6Y3dBbkgxOWZkMkpwYm1SblpXNWZZV1JrWDNSdlgzTjBZV05yWDNCdmFXNTBaWElBWWhGZlgzZGlhVzVrWjJWdVgyMWhiR3h2WXdCTUQxOWZkMkpwYm1SblpXNWZabkpsWlFCV0NUQUJBRUVCQ3lwcUpEVUNabVZETlFGbVpVTmhhMnBYREQxcFZCb2hTVnRUYUdkZlhERU9YbGhxYVFzY1FXQWJQMlFLc3VnQmJOTXFBZ2gvQVg0Q1FBSkFBa0FDUUNBQVFmVUJUd1JBSUFCQnpmOTdUdzBDSUFCQkMyb2lBRUY0Y1NFR1FaQ253QUFvQWdBaUNFVU5BVUVBSUFacklRUUNRQUpBQW45QkFDQUFRUWgySWdCRkRRQWFRUjhnQmtILy8vOEhTdzBBR2lBR1FRWWdBR2NpQUd0QkgzRjJRUUZ4SUFCQkFYUnJRVDVxQ3lJSFFRSjBRWnlwd0FCcUtBSUFJZ0FFUUNBR1FRQkJHU0FIUVFGMmEwRWZjU0FIUVI5R0czUWhBZ05BQWtBZ0FFRUVhaWdDQUVGNGNTSUZJQVpKRFFBZ0JTQUdheUlGSUFSUERRQWdBQ0VESUFVaUJBMEFRUUFoQkF3REN5QUFRUlJxS0FJQUlnVWdBU0FGSUFBZ0FrRWRka0VFY1dwQkVHb29BZ0FpQUVjYklBRWdCUnNoQVNBQ1FRRjBJUUlnQUEwQUN5QUJCRUFnQVNFQURBSUxJQU1OQWd0QkFDRURRUUlnQjBFZmNYUWlBRUVBSUFCcmNpQUljU0lBUlEwRElBQkJBQ0FBYTNGb1FRSjBRWnlwd0FCcUtBSUFJZ0JGRFFNTEEwQWdBQ0FESUFCQkJHb29BZ0JCZUhFaUFpQUdUeUFDSUFacklnSWdCRWx4SWdFYklRTWdBaUFFSUFFYklRUWdBQ2dDRUNJQ0JIOGdBZ1VnQUVFVWFpZ0NBQXNpQUEwQUN5QURSUTBDQzBHY3FzQUFLQUlBSWdBZ0JrOUJBQ0FFSUFBZ0JtdFBHdzBCSUFNb0FoZ2hCd0pBQWtBZ0F5QURLQUlNSWdGR0JFQWdBMEVVUVJBZ0EwRVVhaUlDS0FJQUlnRWJhaWdDQUNJQURRRkJBQ0VCREFJTElBTW9BZ2dpQUNBQk5nSU1JQUVnQURZQ0NBd0JDeUFDSUFOQkVHb2dBUnNoQWdOQUlBSWhCU0FBSWdGQkZHb2lBaWdDQUNJQVJRUkFJQUZCRUdvaEFpQUJLQUlRSVFBTElBQU5BQXNnQlVFQU5nSUFDd0pBSUFkRkRRQUNRQ0FESUFNb0FoeEJBblJCbktuQUFHb2lBQ2dDQUVjRVFDQUhRUkJCRkNBSEtBSVFJQU5HRzJvZ0FUWUNBQ0FCUlEwQ0RBRUxJQUFnQVRZQ0FDQUJEUUJCa0tmQUFFR1FwOEFBS0FJQVFYNGdBeWdDSEhkeE5nSUFEQUVMSUFFZ0J6WUNHQ0FES0FJUUlnQUVRQ0FCSUFBMkFoQWdBQ0FCTmdJWUN5QURRUlJxS0FJQUlnQkZEUUFnQVVFVWFpQUFOZ0lBSUFBZ0FUWUNHQXNDUUNBRVFSQlBCRUFnQXlBR1FRTnlOZ0lFSUFNZ0Jtb2lCU0FFUVFGeU5nSUVJQVFnQldvZ0JEWUNBQ0FFUVlBQ1R3UkFJQVZDQURjQ0VDQUZBbjlCQUNBRVFRaDJJZ0JGRFFBYVFSOGdCRUgvLy84SFN3MEFHaUFFUVFZZ0FHY2lBR3RCSDNGMlFRRnhJQUJCQVhSclFUNXFDeUlBTmdJY0lBQkJBblJCbktuQUFHb2hBZ0pBQWtBQ1FBSkFRWkNud0FBb0FnQWlBVUVCSUFCQkgzRjBJZ1p4QkVBZ0FpZ0NBQ0lDUVFScUtBSUFRWGh4SUFSSERRRWdBaUVBREFJTFFaQ253QUFnQVNBR2NqWUNBQ0FDSUFVMkFnQU1Bd3NnQkVFQVFSa2dBRUVCZG10QkgzRWdBRUVmUmh0MElRRURRQ0FDSUFGQkhYWkJCSEZxUVJCcUlnWW9BZ0FpQUVVTkFpQUJRUUYwSVFFZ0FDRUNJQUJCQkdvb0FnQkJlSEVnQkVjTkFBc0xJQUFvQWdnaUFpQUZOZ0lNSUFBZ0JUWUNDQ0FGUVFBMkFoZ2dCU0FBTmdJTUlBVWdBallDQ0F3RUN5QUdJQVUyQWdBTElBVWdBallDR0NBRklBVTJBZ3dnQlNBRk5nSUlEQUlMSUFSQkEzWWlBa0VEZEVHVXA4QUFhaUVBQW45QmpLZkFBQ2dDQUNJQlFRRWdBblFpQW5FRVFDQUFLQUlJREFFTFFZeW53QUFnQVNBQ2NqWUNBQ0FBQ3lFQ0lBQWdCVFlDQ0NBQ0lBVTJBZ3dnQlNBQU5nSU1JQVVnQWpZQ0NBd0JDeUFESUFRZ0Jtb2lBRUVEY2pZQ0JDQUFJQU5xSWdBZ0FDZ0NCRUVCY2pZQ0JBc2dBMEVJYWc4TEFrQUNRRUdNcDhBQUtBSUFJZ0ZCRUNBQVFRdHFRWGh4SUFCQkMwa2JJZ1pCQTNZaUFIWWlBa0VEY1VVRVFDQUdRWnlxd0FBb0FnQk5EUU1nQWcwQlFaQ253QUFvQWdBaUFFVU5BeUFBUVFBZ0FHdHhhRUVDZEVHY3FjQUFhaWdDQUNJQlFRUnFLQUlBUVhoeElBWnJJUVFnQVNFQ0EwQWdBU2dDRUNJQVJRUkFJQUZCRkdvb0FnQWlBRVVOQkFzZ0FFRUVhaWdDQUVGNGNTQUdheUlCSUFRZ0FTQUVTU0lCR3lFRUlBQWdBaUFCR3lFQ0lBQWhBUXdBQ3dBTEFrQWdBa0YvYzBFQmNTQUFhaUlBUVFOMFFZeW53QUJxSWdOQkVHb29BZ0FpQWtFSWFpSUZLQUlBSWdRZ0EwRUlhaUlEUndSQUlBUWdBellDRENBRElBUTJBZ2dNQVF0QmpLZkFBQ0FCUVg0Z0FIZHhOZ0lBQ3lBQ0lBQkJBM1FpQUVFRGNqWUNCQ0FBSUFKcUlnQWdBQ2dDQkVFQmNqWUNCQ0FGRHdzQ1FFRUNJQUIwSWdSQkFDQUVhM0lnQWlBQWRIRWlBRUVBSUFCcmNXZ2lBa0VEZEVHTXA4QUFhaUlEUVJCcUtBSUFJZ0JCQ0dvaUJTZ0NBQ0lFSUFOQkNHb2lBMGNFUUNBRUlBTTJBZ3dnQXlBRU5nSUlEQUVMUVl5bndBQWdBVUYrSUFKM2NUWUNBQXNnQUNBR1FRTnlOZ0lFSUFBZ0Jtb2lBeUFDUVFOMElnSWdCbXNpQVVFQmNqWUNCQ0FBSUFKcUlBRTJBZ0JCbktyQUFDZ0NBQ0lBQkVBZ0FFRURkaUlFUVFOMFFaU253QUJxSVFCQnBLckFBQ2dDQUNFQ0FuOUJqS2ZBQUNnQ0FDSUdRUUVnQkVFZmNYUWlCSEVFUUNBQUtBSUlEQUVMUVl5bndBQWdCQ0FHY2pZQ0FDQUFDeUVFSUFBZ0FqWUNDQ0FFSUFJMkFnd2dBaUFBTmdJTUlBSWdCRFlDQ0F0QnBLckFBQ0FETmdJQVFaeXF3QUFnQVRZQ0FDQUZEd3NnQWlnQ0dDRUhBa0FDUUNBQ0lBSW9BZ3dpQVVZRVFDQUNRUlJCRUNBQ1FSUnFJZ0VvQWdBaUF4dHFLQUlBSWdBTkFVRUFJUUVNQWdzZ0FpZ0NDQ0lBSUFFMkFnd2dBU0FBTmdJSURBRUxJQUVnQWtFUWFpQURHeUVEQTBBZ0F5RUZJQUFpQVVFVWFpSURLQUlBSWdCRkJFQWdBVUVRYWlFRElBRW9BaEFoQUFzZ0FBMEFDeUFGUVFBMkFnQUxJQWRGRFFNZ0FpQUNLQUljUVFKMFFaeXB3QUJxSWdBb0FnQkhCRUFnQjBFUVFSUWdCeWdDRUNBQ1JodHFJQUUyQWdBZ0FVVU5CQXdEQ3lBQUlBRTJBZ0FnQVEwQ1FaQ253QUJCa0tmQUFDZ0NBRUYrSUFJb0FoeDNjVFlDQUF3REN3SkFBa0FDUUFKQUFrQkJuS3JBQUNnQ0FDSUFJQVpKQkVCQm9LckFBQ2dDQUNJQUlBWkxEUU5CQUNFQ0lBWkJyNEFFYWlJQVFSQjJRQUFpQVVGL1JnMEdJQUZCRUhRaUJVVU5Ca0dzcXNBQUlBQkJnSUI4Y1NJRVFheXF3QUFvQWdCcUlnQTJBZ0JCc0tyQUFFR3dxc0FBS0FJQUlnRWdBQ0FCSUFCTEd6WUNBRUdvcXNBQUtBSUFJZ05GRFFGQnRLckFBQ0VBQTBBZ0FDZ0NBQ0lCSUFBb0FnUWlCMm9nQlVZTkF5QUFLQUlJSWdBTkFBc01CQXRCcEtyQUFDZ0NBQ0VDQW44Z0FDQUdheUlCUVE5TkJFQkJwS3JBQUVFQU5nSUFRWnlxd0FCQkFEWUNBQ0FDSUFCQkEzSTJBZ1FnQUNBQ2FpSUJRUVJxSVFBZ0FTZ0NCRUVCY2d3QkMwR2Nxc0FBSUFFMkFnQkJwS3JBQUNBQ0lBWnFJZ1EyQWdBZ0JDQUJRUUZ5TmdJRUlBQWdBbW9nQVRZQ0FDQUNRUVJxSVFBZ0JrRURjZ3NoQVNBQUlBRTJBZ0FnQWtFSWFnOExRY2lxd0FBb0FnQWlBRUVBSUFBZ0JVMGJSUVJBUWNpcXdBQWdCVFlDQUF0QnpLckFBRUgvSHpZQ0FFRzBxc0FBSUFVMkFnQkJ3S3JBQUVFQU5nSUFRYmlxd0FBZ0JEWUNBRUdncDhBQVFaU253QUEyQWdCQnFLZkFBRUdjcDhBQU5nSUFRWnlud0FCQmxLZkFBRFlDQUVHd3A4QUFRYVNud0FBMkFnQkJwS2ZBQUVHY3A4QUFOZ0lBUWJpbndBQkJyS2ZBQURZQ0FFR3NwOEFBUWFTbndBQTJBZ0JCd0tmQUFFRzBwOEFBTmdJQVFiU253QUJCcktmQUFEWUNBRUhJcDhBQVFieW53QUEyQWdCQnZLZkFBRUcwcDhBQU5nSUFRZENud0FCQnhLZkFBRFlDQUVIRXA4QUFRYnlud0FBMkFnQkIyS2ZBQUVITXA4QUFOZ0lBUWN5bndBQkJ4S2ZBQURZQ0FFSGdwOEFBUWRTbndBQTJBZ0JCMUtmQUFFSE1wOEFBTmdJQVFkeW53QUJCMUtmQUFEWUNBRUhvcDhBQVFkeW53QUEyQWdCQjVLZkFBRUhjcDhBQU5nSUFRZkNud0FCQjVLZkFBRFlDQUVIc3A4QUFRZVNud0FBMkFnQkIrS2ZBQUVIc3A4QUFOZ0lBUWZTbndBQkI3S2ZBQURZQ0FFR0FxTUFBUWZTbndBQTJBZ0JCL0tmQUFFSDBwOEFBTmdJQVFZaW93QUJCL0tmQUFEWUNBRUdFcU1BQVFmeW53QUEyQWdCQmtLakFBRUdFcU1BQU5nSUFRWXlvd0FCQmhLakFBRFlDQUVHWXFNQUFRWXlvd0FBMkFnQkJsS2pBQUVHTXFNQUFOZ0lBUWFDb3dBQkJsS2pBQURZQ0FFR29xTUFBUVp5b3dBQTJBZ0JCbktqQUFFR1VxTUFBTmdJQVFiQ293QUJCcEtqQUFEWUNBRUdrcU1BQVFaeW93QUEyQWdCQnVLakFBRUdzcU1BQU5nSUFRYXlvd0FCQnBLakFBRFlDQUVIQXFNQUFRYlNvd0FBMkFnQkJ0S2pBQUVHc3FNQUFOZ0lBUWNpb3dBQkJ2S2pBQURZQ0FFRzhxTUFBUWJTb3dBQTJBZ0JCMEtqQUFFSEVxTUFBTmdJQVFjU293QUJCdktqQUFEWUNBRUhZcU1BQVFjeW93QUEyQWdCQnpLakFBRUhFcU1BQU5nSUFRZUNvd0FCQjFLakFBRFlDQUVIVXFNQUFRY3lvd0FBMkFnQkI2S2pBQUVIY3FNQUFOZ0lBUWR5b3dBQkIxS2pBQURZQ0FFSHdxTUFBUWVTb3dBQTJBZ0JCNUtqQUFFSGNxTUFBTmdJQVFmaW93QUJCN0tqQUFEWUNBRUhzcU1BQVFlU293QUEyQWdCQmdLbkFBRUgwcU1BQU5nSUFRZlNvd0FCQjdLakFBRFlDQUVHSXFjQUFRZnlvd0FBMkFnQkIvS2pBQUVIMHFNQUFOZ0lBUVpDcHdBQkJoS25BQURZQ0FFR0VxY0FBUWZ5b3dBQTJBZ0JCbUtuQUFFR01xY0FBTmdJQVFZeXB3QUJCaEtuQUFEWUNBRUdvcXNBQUlBVTJBZ0JCbEtuQUFFR01xY0FBTmdJQVFhQ3F3QUFnQkVGWWFpSUFOZ0lBSUFVZ0FFRUJjallDQkNBQUlBVnFRU2cyQWdSQnhLckFBRUdBZ0lBQk5nSUFEQU1MSUFCQkRHb29BZ0FnQlNBRFRYSWdBU0FEUzNJTkFTQUFJQVFnQjJvMkFnUkJxS3JBQUVHb3FzQUFLQUlBSWdCQkQycEJlSEVpQVVGNGFqWUNBRUdncXNBQVFhQ3F3QUFvQWdBZ0JHb2lCQ0FBSUFGcmFrRUlhaUlETmdJQUlBRkJmR29nQTBFQmNqWUNBQ0FBSUFScVFTZzJBZ1JCeEtyQUFFR0FnSUFCTmdJQURBSUxRYUNxd0FBZ0FDQUdheUlDTmdJQVFhaXF3QUJCcUtyQUFDZ0NBQ0lBSUFacUlnRTJBZ0FnQVNBQ1FRRnlOZ0lFSUFBZ0JrRURjallDQkNBQVFRaHFJUUlNQWd0QnlLckFBRUhJcXNBQUtBSUFJZ0FnQlNBQUlBVkpHellDQUNBRUlBVnFJUUZCdEtyQUFDRUFBa0FEUUNBQklBQW9BZ0JIQkVBZ0FDZ0NDQ0lBRFFFTUFnc0xJQUJCREdvb0FnQU5BQ0FBSUFVMkFnQWdBQ0FBS0FJRUlBUnFOZ0lFSUFVZ0JrRURjallDQkNBRklBWnFJUUFnQVNBRmF5QUdheUVHQWtBQ1FDQUJRYWlxd0FBb0FnQkhCRUJCcEtyQUFDZ0NBQ0FCUmcwQklBRkJCR29vQWdBaUFrRURjVUVCUmdSQUlBRWdBa0Y0Y1NJQ0VCRWdBaUFHYWlFR0lBRWdBbW9oQVFzZ0FTQUJLQUlFUVg1eE5nSUVJQUFnQmtFQmNqWUNCQ0FBSUFacUlBWTJBZ0FnQmtHQUFrOEVRQ0FBUWdBM0FoQWdBQUovUVFBZ0JrRUlkaUlDUlEwQUdrRWZJQVpCLy8vL0Iwc05BQm9nQmtFR0lBSm5JZ0pyUVI5eGRrRUJjU0FDUVFGMGEwRSthZ3NpQVRZQ0hDQUJRUUowUVp5cHdBQnFJUUlDUUFKQUFrQUNRRUdRcDhBQUtBSUFJZ1JCQVNBQlFSOXhkQ0lEY1FSQUlBSW9BZ0FpQWtFRWFpZ0NBRUY0Y1NBR1J3MEJJQUloQkF3Q0MwR1FwOEFBSUFNZ0JISTJBZ0FnQWlBQU5nSUFEQU1MSUFaQkFFRVpJQUZCQVhaclFSOXhJQUZCSDBZYmRDRUJBMEFnQWlBQlFSMTJRUVJ4YWtFUWFpSURLQUlBSWdSRkRRSWdBVUVCZENFQklBUWlBa0VFYWlnQ0FFRjRjU0FHUncwQUN3c2dCQ2dDQ0NJQ0lBQTJBZ3dnQkNBQU5nSUlJQUJCQURZQ0dDQUFJQVEyQWd3Z0FDQUNOZ0lJREFVTElBTWdBRFlDQUFzZ0FDQUNOZ0lZSUFBZ0FEWUNEQ0FBSUFBMkFnZ01Bd3NnQmtFRGRpSUJRUU4wUVpTbndBQnFJUUlDZjBHTXA4QUFLQUlBSWdSQkFTQUJkQ0lCY1FSQUlBSW9BZ2dNQVF0QmpLZkFBQ0FCSUFSeU5nSUFJQUlMSVFFZ0FpQUFOZ0lJSUFFZ0FEWUNEQ0FBSUFJMkFnd2dBQ0FCTmdJSURBSUxRYWlxd0FBZ0FEWUNBRUdncXNBQVFhQ3F3QUFvQWdBZ0Jtb2lBallDQUNBQUlBSkJBWEkyQWdRTUFRdEJwS3JBQUNBQU5nSUFRWnlxd0FCQm5LckFBQ2dDQUNBR2FpSUNOZ0lBSUFBZ0FrRUJjallDQkNBQUlBSnFJQUkyQWdBTElBVkJDR29QQzBHMHFzQUFJUUFEUUFKQUlBQW9BZ0FpQVNBRFRRUkFJQUVnQUNnQ0JHb2lCeUFEU3cwQkN5QUFLQUlJSVFBTUFRc0xRYWlxd0FBZ0JUWUNBRUdncXNBQUlBUkJXR29pQURZQ0FDQUZJQUJCQVhJMkFnUWdBQ0FGYWtFb05nSUVRY1Nxd0FCQmdJQ0FBVFlDQUNBRElBZEJZR3BCZUhGQmVHb2lBQ0FBSUFOQkVHcEpHeUlCUVJzMkFnUkJ0S3JBQUNrQ0FDRUpJQUZCRUdwQnZLckFBQ2tDQURjQ0FDQUJJQWszQWdoQndLckFBRUVBTmdJQVFiaXF3QUFnQkRZQ0FFRzBxc0FBSUFVMkFnQkJ2S3JBQUNBQlFRaHFOZ0lBSUFGQkhHb2hBQU5BSUFCQkJ6WUNBQ0FISUFCQkJHb2lBRXNOQUFzZ0FTQURSZzBBSUFFZ0FTZ0NCRUYrY1RZQ0JDQURJQUVnQTJzaUJVRUJjallDQkNBQklBVTJBZ0FnQlVHQUFrOEVRQ0FEUWdBM0FoQWdBMEVjYWdKL1FRQWdCVUVJZGlJQVJRMEFHa0VmSUFWQi8vLy9CMHNOQUJvZ0JVRUdJQUJuSWdCclFSOXhka0VCY1NBQVFRRjBhMEUrYWdzaUFEWUNBQ0FBUVFKMFFaeXB3QUJxSVFFQ1FBSkFBa0FDUUVHUXA4QUFLQUlBSWdSQkFTQUFRUjl4ZENJSGNRUkFJQUVvQWdBaUJFRUVhaWdDQUVGNGNTQUZSdzBCSUFRaEFBd0NDMEdRcDhBQUlBUWdCM0kyQWdBZ0FTQUROZ0lBSUFOQkdHb2dBVFlDQUF3REN5QUZRUUJCR1NBQVFRRjJhMEVmY1NBQVFSOUdHM1FoQVFOQUlBUWdBVUVkZGtFRWNXcEJFR29pQnlnQ0FDSUFSUTBDSUFGQkFYUWhBU0FBSVFRZ0FFRUVhaWdDQUVGNGNTQUZSdzBBQ3dzZ0FDZ0NDQ0lCSUFNMkFnd2dBQ0FETmdJSUlBTkJHR3BCQURZQ0FDQURJQUEyQWd3Z0F5QUJOZ0lJREFNTElBY2dBellDQUNBRFFSaHFJQVEyQWdBTElBTWdBellDRENBRElBTTJBZ2dNQVFzZ0JVRURkaUlCUVFOMFFaU253QUJxSVFBQ2YwR01wOEFBS0FJQUlnUkJBU0FCZENJQmNRUkFJQUFvQWdnTUFRdEJqS2ZBQUNBQklBUnlOZ0lBSUFBTElRRWdBQ0FETmdJSUlBRWdBellDRENBRElBQTJBZ3dnQXlBQk5nSUlDMEdncXNBQUtBSUFJZ0FnQmswTkFFR2dxc0FBSUFBZ0Jtc2lBallDQUVHb3FzQUFRYWlxd0FBb0FnQWlBQ0FHYWlJQk5nSUFJQUVnQWtFQmNqWUNCQ0FBSUFaQkEzSTJBZ1FnQUVFSWFnOExJQUlQQ3lBQklBYzJBaGdnQWlnQ0VDSUFCRUFnQVNBQU5nSVFJQUFnQVRZQ0dBc2dBa0VVYWlnQ0FDSUFSUTBBSUFGQkZHb2dBRFlDQUNBQUlBRTJBaGdMQWtBZ0JFRVFUd1JBSUFJZ0JrRURjallDQkNBQ0lBWnFJZ01nQkVFQmNqWUNCQ0FESUFScUlBUTJBZ0JCbktyQUFDZ0NBQ0lBQkVBZ0FFRURkaUlGUVFOMFFaU253QUJxSVFCQnBLckFBQ2dDQUNFQkFuOUJqS2ZBQUNnQ0FDSUdRUUVnQlVFZmNYUWlCWEVFUUNBQUtBSUlEQUVMUVl5bndBQWdCU0FHY2pZQ0FDQUFDeUVGSUFBZ0FUWUNDQ0FGSUFFMkFnd2dBU0FBTmdJTUlBRWdCVFlDQ0F0QnBLckFBQ0FETmdJQVFaeXF3QUFnQkRZQ0FBd0JDeUFDSUFRZ0Jtb2lBRUVEY2pZQ0JDQUFJQUpxSWdBZ0FDZ0NCRUVCY2pZQ0JBc2dBa0VJYWd2aEVBSVNmd0orSXdCQmdBRnJJZ1lrQUNBR0lBTTJBaXdnQmlBQ05nSW9Ba0FDZndKQUFrQUNRQUpBSUFFdEFFZEZCRUFnQVNrRE9DRVlJQUZDQURjRE9BSi9JQmhDLy84RGcxQkZCRUFnR0VJd2lLY2hFU0FZUWhDSXB5RU1JQmhDSUlpbkRBRUxJQVpCSUdvZ0FTQUdRU2hxRUNzZ0JpOEJJRVVFUUVFQklRME1CZ3RCQXlFTklBWXZBU0lpRENJQ0lBRXZBVUJQRFFVZ0FpQUJMd0ZDUmcwQ0lBRXZBVVFnREVILy93TnhSZzBESUFGQkdHb29BZ0JGRFFVZ0FVRW9haUFCUVJCcUlnY2dEQkFtR2lBQktBSVlJZ0lnREVILy93TnhJZ3BORFFRZ0J5Z0NBQ0FLUVFKMGFpSUNMUUFDSVJFZ0FpOEJBQXNoRXlBR1FSaHFJQUZCS0dvUVFpQUdLQUlZSVFJQ1FDQUdLQUljSWdjZ0JVMEVRQ0FIRFFGQkFTRVNRUUVoRFNBRklRZEJBUXdIQ3lBRlJRUkFRUUVoRFVFQUlRZEJBUXdIQ3lBRUlBSWdCUkJMR2lBQlFUQnFJZ0lnQWlnQ0FDQUZhallDQUVHSWc4QUFJUVJCQUNFTlFRQWhCMEVCREFZTElBUWdBaUFIRUVzZ0FVRXdhaUlDSUFJb0FnQWdCMm8yQWdBZ0Iyb2hCQ0FGSUFkcklRZEJBQ0VOUVFFTUJRc2dBRUVDT2dBSUlBQkNBRGNDQUF3RkN5QUJJQUV0QUVZaUIwRUJhaUlDT2dBS0lBRkJBU0FIUVE5eGRFRUNhanNCUUNBQlFYOGdBa0VQY1hSQmYzTTdBUWdnQVVFUWFpQUhFQTFCQUNFTVFRQWhEU0FGSVFkQkFBd0RDeUFCUVFFNkFFZEJBaUVOREFFTElBb2dBa0hvaHNBQUVEWUFDMEVBSVF3Z0JTRUhRUUFMSVFJZ0JrRTRha0VBTmdJQUlBWkNBRGNETUNBR1FjZ0Fha0VBTmdJQUlBWkNBRGNEUUNBR1Fmd0Fha0VBTmdJQUlBWkI5QUJxUVFBMkFnQWdCa0hzQUdwQkFEWUNBQ0FHUWVRQWFrRUFOZ0lBSUFaQjNBQnFRUUEyQWdBZ0JrSFlpY0FBTmdKNElBWkIySW5BQURZQ2NDQUdRZGlKd0FBMkFtZ2dCa0hZaWNBQU5nSmdJQVpCMkluQUFEWUNXQ0FHUVFBMkFsUWdCa0hZaWNBQU5nSlFBa0FDZndKQUlBSkZEUUFnQVVFUWFpRVVJQUZCS0dvaEZTQUdRY2dBYWlFWElBWkJQbW9oRmdKQUFrQUNRQUpBQWtBQ1FBSkFBa0FEUUFKQUFrQWdCdzBBSUFaQkVHb2dGUkJDSUFZb0FoUkZEUUJCQUNFSERBRUxJQUVnQmtFb2FoQVlRUUFoQ3lBWElSQkJBQ0VPQWtBQ1FBSkFBa0FDUUFKQUFrQUNRQUpBQTBBZ0FTMEFDeUlDSUFFdEFBb2lDRWtOQVNBQklBSWdDR3M2QUFzZ0JrRXdhaUFMYWlJS0lBRXZBUWdpQWlBQktRTUFJQWl0aVNJWXAzRTdBUUFnQVNBWUlBS3RRbitGUW9DQWZJU0ROd01BSUE0RVFDQU9RWDlxUVFWTERRVWdCeUFMSUJacUx3RUFJZ0pKRFFZZ0VDQUVOZ0lBSUJCQkJHb2dBallDQUNBSElBSnJJUWNnQWlBRWFpRUVDeUFCTHdGQUlnSWdEbXBCLy84RGNTQUJMd0VJSUFFdEFFaHJRZi8vQTNGR0RRSWdDaThCQUNJS0lBRXZBVUpHSUFvZ0FrOXlEUUlnQ2lBQkx3RkVSZzBDSUFFb0FpUWlBaUFLVFEwR0lBY2dBU2dDSENBS1FRRjBhaThCQUNJQ1NRMENJQTVCQVdvaERpQUxJQlpxUVFKcUlBSTdBUUFnRUVFSWFpRVFJQXRCQW1vaUMwRU1SdzBBQzBFR0lRNUJCU0VRSUFZdkFUb2hDQXdIQ3lBT0RRRkJBU0FOSUJJYklRME1DQXNnRGtFQmFpRU9DeUFPUVFkUERRTWdCa0V3YWlBT1FYOXFJaEJCQVhScUx3RUFJUWdnRUEwRUlBd2hDZ3dGQ3lBT1FYOXFRUVpCbUlUQUFCQTJBQXRCNklIQUFFRWpRZmlDd0FBUVNBQUxJQW9nQWtHb2hNQUFFRFlBQ3lBT1FRWkJ1SVRBQUJBM0FBc2dCa0hRQUdvaEFpQUdRVEJxSVFzRFFDQUdRUWhxSUJRZ0ZDQUxMd0VBSWdvZ0FpZ0NBQ0FDUVFScUtBSUFFQ2tnREJBaklBWXRBQW9oRVNBR0x3RUlJUk1nQVNBQkx3RkFRUUZxT3dGQUlBdEJBbW9oQ3lBQ1FRaHFJUUlnQ2lFTUlCQkJmMm9pRUEwQUN5QU9RUU4wSUFacVFVQnJJZ0lvQWdRaENTQUNRUUEyQWdRZ0FpZ0NBQ0VQSUFKQmlJUEFBRFlDQUFzZ0NDSU1JQUV2QVVKR0RRTUNRQ0FCTHdGRUlBaEhCRUFnQ0NBQkx3RkFJZ0pORFFGQkF5RU5RUUFNRFFzZ0FVRUJPZ0JIUVFJaERVRUFEQXdMQW44Z0J3Si9Ba0FDUUNBQ0lBaEhCRUFnQVNnQ0pDSUNJQWhMRFFFZ0NDQUNRZGlFd0FBUU5nQUxJQUVvQWlRaUFpQUtRZi8vQTNFaUNFME5DQ0FISUFFb0Fod2dDRUVCZEdvdkFRQkJBV3BCLy84RGNTSUNUdzBCSUE4RVFDQUJLQUlzSWdJZ0NVa05DaUFCS0FJb0lBOGdDUkJMR2lBQklBazJBakFnQVNBSk5nSTBDMEVBSVE4Z0ZSQXpJUXRCQVF3REN5QUhJQUVvQWh3Z0NFRUJkR292QVFBaUFra0VRRUVBSVE4Z0ZTQVVJQXdRSmlFTFFRRU1Bd3NnRkNBTUlBUWdBaEFwSVFzZ0Fnd0JDeUFQUlFSQUlBRW9BaXdpQ0NBQktBSTBJZ2xKRFFrZ0ZTZ0NBQ0VQQ3lBSlJRMEVJQWtnQWtzTkNTQVBMUUFBSVFzZ0JDQVBJQWtRU3lBQ0lBbEdEUW9nQ1dvZ0N6b0FBQ0FDQ3lJSmF5RUhJQWtnQkNJUGFpRUVRUUFMSUFFb0FoaEIveDlOQkVBZ0JpQVVJQXNnQ2hBaklBRXZBVUFoRUNBR0xRQUNJUkVnQmk4QkFDRVRBa0FnQVMwQUNpSUlRUXRMRFFBZ0VDQUJMd0VJSWdvZ0FTMEFTR3RCLy84RGNVY05BQ0FCSUFoQkFXbzZBQW9nQVNBS1FRRjBRUUZ5T3dFSUN5QUJJQkJCQVdvN0FVQUxRUUFoRWtVTkFRc0xRZ0VoR1NBUFJRMEtJQUVvQWl3aUFpQUpTUTBISUFFb0FpZ2dEeUFKRUVzYUlBRWdDVFlDTUNBQklBazJBalFNQ2d0QkFFRUFRWWlGd0FBUU5nQUxJQUVRTkF3R0N5QUlJQUpCeUlUQUFCQTJBQXNnQ1NBQ1FlaUV3QUFRTndBTElBa2dDRUg0aE1BQUVEY0FDeUFKSUFKQm1JWEFBQkEzQUF0QkFFRUFRYWlGd0FBUU5nQUxJQWtnQWtHNGhjQUFFRGNBQzBFQUN5RU1RUUFoRTBFQUlSRUxJQUFnQlNBSGF6WUNCQ0FBSUFNZ0JpZ0NMQ0lDYXpZQ0FDQUFRUUFnRFNBRElBSkxHeUFOSUExQkFVWWJPZ0FJSUFFZ0RLMUMvLzhEZzBJUWhpQVpoQ0FUclVMLy93T0RRaUNHaENBUnJVTC9BWU5DTUlhRU53TTRDeUFHUVlBQmFpUUFDOVlRQWhGL0FuNGpBRUdBQVdzaUJpUUFJQVlnQXpZQ0xDQUdJQUkyQWlnQ1FBSi9Ba0FDUUFKQUFrQWdBUzBBUjBVRVFDQUJLUU00SVJjZ0FVSUFOd000QW44Z0YwTC8vd09EVUVVRVFDQVhRakNJcHlFUklCZENFSWluSVF3Z0YwSWdpS2NNQVFzZ0JrRWdhaUFCSUFaQktHb1FMaUFHTHdFZ1JRUkFRUUVoRFF3R0MwRURJUTBnQmk4QklpSU1JZ0lnQVM4QlFFOE5CU0FDSUFFdkFVSkdEUUlnQVM4QlJDQU1RZi8vQTNGR0RRTWdBVUVZYWlnQ0FFVU5CU0FCUVNocUlBRkJFR29pQnlBTUVDWWFJQUVvQWhnaUFpQU1RZi8vQTNFaUNVME5CQ0FIS0FJQUlBbEJBblJxSWdJdEFBSWhFU0FDTHdFQUN5RVNJQVpCR0dvZ0FVRW9haEJDSUFZb0FoZ2hBZ0pBSUFZb0Fod2lCeUFGVFFSQUlBY05BVUVCSVFoQkFTRU5JQVVoQjBFQkRBY0xJQVZGQkVCQkFTRU5RUUFoQjBFQkRBY0xJQVFnQWlBRkVFc2FJQUZCTUdvaUFpQUNLQUlBSUFWcU5nSUFRWWlEd0FBaEJFRUFJUTFCQUNFSFFRRU1CZ3NnQkNBQ0lBY1FTeUFCUVRCcUlnSWdBaWdDQUNBSGFqWUNBQ0FIYWlFRUlBVWdCMnNoQjBFQUlRMUJBUXdGQ3lBQVFRSTZBQWdnQUVJQU53SUFEQVVMSUFFZ0FTMEFSaUlIUVFGcUlnSTZBQW9nQVVFQklBZEJEM0YwUVFKcU93RkFJQUZCZnlBQ1FROXhkRUYvY3pzQkNDQUJRUkJxSUFjUURVRUFJUXhCQUNFTklBVWhCMEVBREFNTElBRkJBVG9BUjBFQ0lRME1BUXNnQ1NBQ1FlaUd3QUFRTmdBTFFRQWhEQ0FGSVFkQkFBc2hBaUFHUVRocVFRQTJBZ0FnQmtJQU53TXdJQVpCeUFCcVFRQTJBZ0FnQmtJQU53TkFJQVpCL0FCcVFRQTJBZ0FnQmtIMEFHcEJBRFlDQUNBR1Fld0Fha0VBTmdJQUlBWkI1QUJxUVFBMkFnQWdCa0hjQUdwQkFEWUNBQ0FHUWRpSndBQTJBbmdnQmtIWWljQUFOZ0p3SUFaQjJJbkFBRFlDYUNBR1FkaUp3QUEyQW1BZ0JrSFlpY0FBTmdKWUlBWkJBRFlDVkNBR1FkaUp3QUEyQWxBQ1FBSi9Ba0FnQWtVTkFDQUJRUkJxSVJNZ0FVRW9haUVVSUFaQnlBQnFJUllnQmtFK2FpRVZBa0FDUUFKQUFrQUNRQUpBQWtBQ1FBTkFBa0FDUUNBSERRQWdCa0VRYWlBVUVFSWdCaWdDRkVVTkFFRUFJUWNNQVFzZ0FTQUdRU2hxRUNCQkFDRUxJQlloRUVFQUlRNENRQUpBQWtBQ1FBSkFBa0FDUUFKQUFrQURRQ0FCTFFBTElnSWdBUzBBQ2lJSlNRMEJJQUVnQWlBSmF6b0FDeUFCSUFFcEF3QWlGeUFKclVJL2c0ZzNBd0FnQmtFd2FpQUxhaUlKSUFFdkFRZ2dGNmR4T3dFQUlBNEVRQ0FPUVg5cVFRVkxEUVVnQnlBTElCVnFMd0VBSWdKSkRRWWdFQ0FFTmdJQUlCQkJCR29nQWpZQ0FDQUhJQUpySVFjZ0FpQUVhaUVFQ3lBQkx3RkFJZ0lnRG1wQi8vOERjU0FCTHdFSUlBRXRBRWhyUWYvL0EzRkdEUUlnQ1M4QkFDSUpJQUV2QVVKR0lBa2dBazl5RFFJZ0NTQUJMd0ZFUmcwQ0lBRW9BaVFpQWlBSlRRMEdJQWNnQVNnQ0hDQUpRUUYwYWk4QkFDSUNTUTBDSUE1QkFXb2hEaUFMSUJWcVFRSnFJQUk3QVFBZ0VFRUlhaUVRSUF0QkFtb2lDMEVNUncwQUMwRUdJUTVCQlNFUUlBWXZBVG9oQ0F3SEN5QU9EUUZCQVNBTklBZ2JJUTBNQ0FzZ0RrRUJhaUVPQ3lBT1FRZFBEUU1nQmtFd2FpQU9RWDlxSWhCQkFYUnFMd0VBSVFnZ0VBMEVJQXdoQ1F3RkN5QU9RWDlxUVFaQm1JVEFBQkEyQUF0QjZJSEFBRUVqUWZpQ3dBQVFTQUFMSUFrZ0FrR29oTUFBRURZQUN5QU9RUVpCdUlUQUFCQTNBQXNnQmtIUUFHb2hBaUFHUVRCcUlRc0RRQ0FHUVFocUlCTWdFeUFMTHdFQUlna2dBaWdDQUNBQ1FRUnFLQUlBRUNrZ0RCQWpJQVl0QUFvaEVTQUdMd0VJSVJJZ0FTQUJMd0ZBUVFGcU93RkFJQXRCQW1vaEN5QUNRUWhxSVFJZ0NTRU1JQkJCZjJvaUVBMEFDeUFPUVFOMElBWnFRVUJySWdJb0FnUWhDaUFDUVFBMkFnUWdBaWdDQUNFUElBSkJpSVBBQURZQ0FBc2dDQ0lNSUFFdkFVSkdEUU1DUUNBQkx3RkVJQWhIQkVBZ0NDQUJMd0ZBSWdKTkRRRkJBeUVOUVFBTURRc2dBVUVCT2dCSFFRSWhEVUVBREF3TEFuOGdCd0ovQWtBQ1FDQUNJQWhIQkVBZ0FTZ0NKQ0lDSUFoTERRRWdDQ0FDUWRpRXdBQVFOZ0FMSUFFb0FpUWlBaUFKUWYvL0EzRWlDRTBOQ0NBSElBRW9BaHdnQ0VFQmRHb3ZBUUJCQVdwQi8vOERjU0lDVHcwQklBOEVRQ0FCS0FJc0lnSWdDa2tOQ2lBQktBSW9JQThnQ2hCTEdpQUJJQW8yQWpBZ0FTQUtOZ0kwQzBFQUlROGdGQkF6SVF0QkFRd0RDeUFISUFFb0Fod2dDRUVCZEdvdkFRQWlBa2tFUUVFQUlROGdGQ0FUSUF3UUppRUxRUUVNQXdzZ0V5QU1JQVFnQWhBcElRc2dBZ3dCQ3lBUFJRUkFJQUVvQWl3aUNDQUJLQUkwSWdwSkRRa2dGQ2dDQUNFUEN5QUtSUTBFSUFvZ0Frc05DU0FQTFFBQUlRc2dCQ0FQSUFvUVN5QUNJQXBHRFFvZ0Ntb2dDem9BQUNBQ0N5SUtheUVISUFvZ0JDSVBhaUVFUVFBTElBRW9BaGhCL3g5TkJFQWdCaUFUSUFzZ0NSQWpJQUV2QVVBaEVDQUdMUUFDSVJFZ0JpOEJBQ0VTQWtBZ0FTMEFDaUlJUVF0TERRQWdFQ0FCTHdFSUlna2dBUzBBU0d0Qi8vOERjVWNOQUNBQklBaEJBV282QUFvZ0FTQUpRUUYwUVFGeU93RUlDeUFCSUJCQkFXbzdBVUFMUVFBaENFVU5BUXNMUWdFaEdDQVBSUTBLSUFFb0Fpd2lBaUFLU1EwSElBRW9BaWdnRHlBS0VFc2FJQUVnQ2pZQ01DQUJJQW8yQWpRTUNndEJBRUVBUVlpRndBQVFOZ0FMSUFFUU5Bd0dDeUFJSUFKQnlJVEFBQkEyQUFzZ0NpQUNRZWlFd0FBUU53QUxJQW9nQ0VINGhNQUFFRGNBQ3lBS0lBSkJtSVhBQUJBM0FBdEJBRUVBUWFpRndBQVFOZ0FMSUFvZ0FrRzRoY0FBRURjQUMwRUFDeUVNUVFBaEVrRUFJUkVMSUFBZ0JTQUhhellDQkNBQUlBTWdCaWdDTENJQ2F6WUNBQ0FBUVFBZ0RTQURJQUpMR3lBTklBMUJBVVliT2dBSUlBRWdESzFDLy84RGcwSVFoaUFZaENBU3JVTC8vd09EUWlDR2hDQVJyVUwvQVlOQ01JYUVOd000Q3lBR1FZQUJhaVFBQzZvSUFRWi9Jd0JCOEFCcklnVWtBQ0FGSUFNMkFnd2dCU0FDTmdJSVFRRWhCeUFCSVFZQ1FDQUJRWUVDU1EwQVFRQWdBV3NoQ1VHQUFpRUlBMEFDUUNBSUlBRlBEUUJCQUNFSElBQWdDR29zQUFCQnYzOU1EUUFnQ0NFR0RBSUxJQWhCZjJvaEJrRUFJUWNnQ0VFQlJnMEJJQWdnQ1dvZ0JpRUlRUUZIRFFBTEN5QUZJQVkyQWhRZ0JTQUFOZ0lRSUFWQkFFRUZJQWNiTmdJY0lBVkI4SXZBQUVIQWtzQUFJQWNiTmdJWUFrQUNmd0pBQWtBZ0FpQUJTeUlISUFNZ0FVdHlSUVJBSUFJZ0Ewc05BUUpBSUFKRklBRWdBa1p5UlFSQUlBRWdBazBOQVNBQUlBSnFMQUFBUVVCSURRRUxJQU1oQWdzZ0JTQUNOZ0lnSUFKQkFDQUJJQUpIRzBVRVFDQUNJUWNNQXdzZ0FVRUJhaUVEQTBBQ1FDQUNJQUZQRFFBZ0FDQUNhaXdBQUVGQVNBMEFJQUloQnlBRlFTUnFEQVVMSUFKQmYyb2hCeUFDUVFGR0RRTWdBaUFEUmlBSElRSkZEUUFMREFJTElBVWdBaUFESUFjYk5nSW9JQVZCeEFCcVFRTTJBZ0FnQlVIY0FHcEJIVFlDQUNBRlFkUUFha0VkTmdJQUlBVkNBemNDTkNBRlFlaVN3QUEyQWpBZ0JVRWNOZ0pNSUFVZ0JVSElBR28yQWtBZ0JTQUZRUmhxTmdKWUlBVWdCVUVRYWpZQ1VDQUZJQVZCS0dvMkFrZ01Bd3NnQlVIa0FHcEJIVFlDQUNBRlFkd0Fha0VkTmdJQUlBVkIxQUJxUVJ3MkFnQWdCVUhFQUdwQkJEWUNBQ0FGUWdRM0FqUWdCVUdrazhBQU5nSXdJQVZCSERZQ1RDQUZJQVZCeUFCcU5nSkFJQVVnQlVFWWFqWUNZQ0FGSUFWQkVHbzJBbGdnQlNBRlFReHFOZ0pRSUFVZ0JVRUlhallDU0F3Q0N5QUZRU1JxQ3lFSUFrQWdBU0FIUmcwQVFRRWhBd0pBQWtBQ1FDQUFJQWRxSWdZc0FBQWlBa0YvVEFSQVFRQWhBeUFBSUFGcUlnRWhBQ0FCSUFaQkFXcEhCRUFnQmkwQUFVRS9jU0VESUFaQkFtb2hBQXNnQWtFZmNTRUpJQUpCL3dGeFFkOEJTdzBCSUFNZ0NVRUdkSEloQWd3Q0N5QUZJQUpCL3dGeE5nSWtJQVZCS0dvaEFRd0NDMEVBSVFvZ0FTRUdJQUFnQVVjRVFDQUFMUUFBUVQ5eElRb2dBRUVCYWlFR0N5QUtJQU5CQm5SeUlRQWdBa0gvQVhGQjhBRkpCRUFnQUNBSlFReDBjaUVDREFFTFFRQWhBaUFCSUFaSEJIOGdCaTBBQUVFL2NRVkJBQXNnQ1VFU2RFR0FnUEFBY1NBQVFRWjBjbklpQWtHQWdNUUFSZzBDQ3lBRklBSTJBaVJCQVNFRElBVkJLR29oQVNBQ1FZQUJTUTBBUVFJaEF5QUNRWUFRU1EwQVFRTkJCQ0FDUVlDQUJFa2JJUU1MSUFVZ0J6WUNLQ0FGSUFNZ0IybzJBaXdnQlVIRUFHcEJCVFlDQUNBRlFld0Fha0VkTmdJQUlBVkI1QUJxUVIwMkFnQWdCVUhjQUdwQkhqWUNBQ0FGUWRRQWFrRWZOZ0lBSUFWQ0JUY0NOQ0FGUWZpVHdBQTJBakFnQlNBQk5nSllJQVVnQ0RZQ1VDQUZRUncyQWt3Z0JTQUZRY2dBYWpZQ1FDQUZJQVZCR0dvMkFtZ2dCU0FGUVJCcU5nSmdJQVVnQlVFZ2FqWUNTQXdCQzBIOGk4QUFRU3NnQkJCSUFBc2dCVUV3YWlBRUVGRUFDOUlJQVFWL0lBQkJlR29pQVNBQVFYeHFLQUlBSWdOQmVIRWlBR29oQWdKQUFrQWdBMEVCY1EwQUlBTkJBM0ZGRFFFZ0FTZ0NBQ0lESUFCcUlRQWdBU0FEYXlJQlFhU3F3QUFvQWdCR0JFQWdBaWdDQkVFRGNVRURSdzBCUVp5cXdBQWdBRFlDQUNBQ0lBSW9BZ1JCZm5FMkFnUWdBU0FBUVFGeU5nSUVJQUFnQVdvZ0FEWUNBQThMSUFFZ0F4QVJDd0pBSUFKQkJHb2lCQ2dDQUNJRFFRSnhCRUFnQkNBRFFYNXhOZ0lBSUFFZ0FFRUJjallDQkNBQUlBRnFJQUEyQWdBTUFRc0NRQ0FDUWFpcXdBQW9BZ0JIQkVCQnBLckFBQ2dDQUNBQ1JnMEJJQUlnQTBGNGNTSUNFQkVnQVNBQUlBSnFJZ0JCQVhJMkFnUWdBQ0FCYWlBQU5nSUFJQUZCcEtyQUFDZ0NBRWNOQWtHY3FzQUFJQUEyQWdBUEMwR29xc0FBSUFFMkFnQkJvS3JBQUVHZ3FzQUFLQUlBSUFCcUlnQTJBZ0FnQVNBQVFRRnlOZ0lFUWFTcXdBQW9BZ0FnQVVZRVFFR2Nxc0FBUVFBMkFnQkJwS3JBQUVFQU5nSUFDMEhFcXNBQUtBSUFJZ0lnQUU4TkFrR29xc0FBS0FJQUlnQkZEUUlDUUVHZ3FzQUFLQUlBSWdOQktVa05BRUcwcXNBQUlRRURRQ0FCS0FJQUlnUWdBRTBFUUNBRUlBRW9BZ1JxSUFCTERRSUxJQUVvQWdnaUFRMEFDd3RCektyQUFBSi9RZjhmUWJ5cXdBQW9BZ0FpQUVVTkFCcEJBQ0VCQTBBZ0FVRUJhaUVCSUFBb0FnZ2lBQTBBQ3lBQlFmOGZJQUZCL3g5TEd3czJBZ0FnQXlBQ1RRMENRY1Nxd0FCQmZ6WUNBQThMUWFTcXdBQWdBVFlDQUVHY3FzQUFRWnlxd0FBb0FnQWdBR29pQURZQ0FDQUJJQUJCQVhJMkFnUWdBQ0FCYWlBQU5nSUFEd3RCektyQUFBSi9Ba0FnQUVHQUFrOEVRQ0FCUWdBM0FoQWdBVUVjYWdKL1FRQWdBRUVJZGlJQ1JRMEFHa0VmSUFCQi8vLy9CMHNOQUJvZ0FFRUdJQUpuSWdKclFSOXhka0VCY1NBQ1FRRjBhMEUrYWdzaUF6WUNBQ0FEUVFKMFFaeXB3QUJxSVFJQ1FBSkFBa0FDUUFKQVFaQ253QUFvQWdBaUJFRUJJQU5CSDNGMElnVnhCRUFnQWlnQ0FDSUNRUVJxS0FJQVFYaHhJQUJIRFFFZ0FpRUREQUlMUVpDbndBQWdCQ0FGY2pZQ0FDQUNJQUUyQWdBTUF3c2dBRUVBUVJrZ0EwRUJkbXRCSDNFZ0EwRWZSaHQwSVFRRFFDQUNJQVJCSFhaQkJIRnFRUkJxSWdVb0FnQWlBMFVOQWlBRVFRRjBJUVFnQXlJQ1FRUnFLQUlBUVhoeElBQkhEUUFMQ3lBREtBSUlJZ0FnQVRZQ0RDQURJQUUyQWdnZ0FVRVlha0VBTmdJQUlBRWdBellDRENBQklBQTJBZ2dNQWdzZ0JTQUJOZ0lBQ3lBQlFSaHFJQUkyQWdBZ0FTQUJOZ0lNSUFFZ0FUWUNDQXRCektyQUFFSE1xc0FBS0FJQVFYOXFJZ0EyQWdBZ0FBMERRYnlxd0FBb0FnQWlBQTBCUWY4ZkRBSUxJQUJCQTNZaUFrRURkRUdVcDhBQWFpRUFBbjlCaktmQUFDZ0NBQ0lEUVFFZ0FuUWlBbkVFUUNBQUtBSUlEQUVMUVl5bndBQWdBaUFEY2pZQ0FDQUFDeUVDSUFBZ0FUWUNDQ0FDSUFFMkFnd2dBU0FBTmdJTUlBRWdBallDQ0E4TFFRQWhBUU5BSUFGQkFXb2hBU0FBS0FJSUlnQU5BQXNnQVVIL0h5QUJRZjhmU3hzTE5nSUFDd3VXQndFS2Z5QUFLQUlRSVFNQ1FBSkFBa0FnQUNnQ0NDSU1RUUZIQkVBZ0EwRUJSZzBCREFNTElBTkJBVWNOQVFzZ0FTQUNhaUVEQWtBQ1FDQUFRUlJxS0FJQUlnaEZCRUFnQVNFRURBRUxJQUVoQkFOQUlBTWdCQ0lIUmcwQ0lBZEJBV29oQkFKQUlBY3NBQUFpQmtGL1NnMEFJQVpCL3dGeElRa0NmeUFESUFSR0JFQkJBQ0VLSUFNTUFRc2dCeTBBQVVFL2NTRUtJQWRCQW1vaUJBc2hCaUFKUWVBQlNRMEFBbjhnQXlBR1JnUkFRUUFoQ3lBRERBRUxJQVl0QUFCQlAzRWhDeUFHUVFGcUlnUUxJUVlnQ1VId0FVa05BQ0FESUFaR0JIOUJBQVVnQmtFQmFpRUVJQVl0QUFCQlAzRUxJQWxCRW5SQmdJRHdBSEVnQ2tFTWRISWdDMEVHZEhKeVFZQ0F4QUJHRFFNTElBUWdCMnNnQldvaEJTQUlRWDlxSWdnTkFBc0xJQU1nQkVZTkFBSkFJQVFzQUFBaUIwRi9TZzBBQW44Z0F5QUVRUUZxUmdSQUlBTWhDRUVBREFFTElBUkJBbW9oQ0NBRUxRQUJRVDl4UVFaMEN5QUhRZjhCY1VIZ0FVa05BQUovSUFNZ0NFWUVRQ0FESVFaQkFBd0JDeUFJUVFGcUlRWWdDQzBBQUVFL2NRc2dCMEgvQVhGQjhBRkpEUUFnQjBIL0FYRWhCM0loQkNBRElBWkdCSDlCQUFVZ0JpMEFBRUUvY1FzZ0IwRVNkRUdBZ1BBQWNTQUVRUVowY25KQmdJREVBRVlOQVFzQ1FDQUZSU0FDSUFWR2NrVUVRRUVBSVFNZ0JTQUNUdzBCSUFFZ0JXb3NBQUJCUUVnTkFRc2dBU0VEQ3lBRklBSWdBeHNoQWlBRElBRWdBeHNoQVFzZ0RFRUJSZzBBREFFTEFrQWdBZ1JBUVFBaEJDQUNJUVVnQVNFREEwQWdCQ0FETFFBQVFjQUJjVUdBQVVacUlRUWdBMEVCYWlFRElBVkJmMm9pQlEwQUN5QUNJQVJySUFBb0Fnd2lCazhOQWtFQUlRUWdBaUVGSUFFaEF3TkFJQVFnQXkwQUFFSEFBWEZCZ0FGR2FpRUVJQU5CQVdvaEF5QUZRWDlxSWdVTkFBc01BUXRCQUNFRUlBQW9BZ3dpQmcwQURBRUxRUUFoQXlBRUlBSnJJQVpxSWdRaEJRSkFBa0FDUUVFQUlBQXRBQ0FpQmlBR1FRTkdHMEVEY1VFQmF3NERBUUFCQWdzZ0JFRUJkaUVESUFSQkFXcEJBWFloQlF3QkMwRUFJUVVnQkNFREN5QURRUUZxSVFNQ1FBTkFJQU5CZjJvaUF3UkFJQUFvQWhnZ0FDZ0NCQ0FBS0FJY0tBSVFFUUFBUlEwQkRBSUxDeUFBS0FJRUlRUWdBQ2dDR0NBQklBSWdBQ2dDSENnQ0RCRUJBQTBBSUFWQkFXb2hBeUFBS0FJY0lRRWdBQ2dDR0NFQUEwQWdBMEYvYWlJRFJRUkFRUUFQQ3lBQUlBUWdBU2dDRUJFQUFFVU5BQXNMUVFFUEN5QUFLQUlZSUFFZ0FpQUFRUnhxS0FJQUtBSU1FUUVBQzdzR0FRUi9JQUFnQVdvaEFnSkFBa0FnQUVFRWFpZ0NBQ0lEUVFGeERRQWdBMEVEY1VVTkFTQUFLQUlBSWdNZ0FXb2hBU0FBSUFOcklnQkJwS3JBQUNnQ0FFWUVRQ0FDS0FJRVFRTnhRUU5IRFFGQm5LckFBQ0FCTmdJQUlBSWdBaWdDQkVGK2NUWUNCQ0FBSUFGQkFYSTJBZ1FnQWlBQk5nSUFEd3NnQUNBREVCRUxBa0FnQWtFRWFpZ0NBQ0lEUVFKeEJFQWdBa0VFYWlBRFFYNXhOZ0lBSUFBZ0FVRUJjallDQkNBQUlBRnFJQUUyQWdBTUFRc0NRQ0FDUWFpcXdBQW9BZ0JIQkVCQnBLckFBQ2dDQUNBQ1JnMEJJQUlnQTBGNGNTSUNFQkVnQUNBQklBSnFJZ0ZCQVhJMkFnUWdBQ0FCYWlBQk5nSUFJQUJCcEtyQUFDZ0NBRWNOQWtHY3FzQUFJQUUyQWdBUEMwR29xc0FBSUFBMkFnQkJvS3JBQUVHZ3FzQUFLQUlBSUFGcUlnRTJBZ0FnQUNBQlFRRnlOZ0lFSUFCQnBLckFBQ2dDQUVjTkFrR2Nxc0FBUVFBMkFnQkJwS3JBQUVFQU5nSUFEd3RCcEtyQUFDQUFOZ0lBUVp5cXdBQkJuS3JBQUNnQ0FDQUJhaUlCTmdJQUlBQWdBVUVCY2pZQ0JDQUFJQUZxSUFFMkFnQVBDeUFCUVlBQ1R3UkFJQUJDQURjQ0VDQUFRUnhxQW45QkFDQUJRUWgySWdKRkRRQWFRUjhnQVVILy8vOEhTdzBBR2lBQlFRWWdBbWNpQW10QkgzRjJRUUZ4SUFKQkFYUnJRVDVxQ3lJRE5nSUFJQU5CQW5SQm5LbkFBR29oQWdKQUFrQUNRQUpBUVpDbndBQW9BZ0FpQkVFQklBTkJIM0YwSWdWeEJFQWdBaWdDQUNJQ1FRUnFLQUlBUVhoeElBRkhEUUVnQWlFRERBSUxRWkNud0FBZ0JDQUZjallDQUNBQ0lBQTJBZ0FNQXdzZ0FVRUFRUmtnQTBFQmRtdEJIM0VnQTBFZlJodDBJUVFEUUNBQ0lBUkJIWFpCQkhGcVFSQnFJZ1VvQWdBaUEwVU5BaUFFUVFGMElRUWdBeUlDUVFScUtBSUFRWGh4SUFGSERRQUxDeUFES0FJSUlnRWdBRFlDRENBRElBQTJBZ2dnQUVFWWFrRUFOZ0lBSUFBZ0F6WUNEQ0FBSUFFMkFnZ1BDeUFGSUFBMkFnQUxJQUJCR0dvZ0FqWUNBQ0FBSUFBMkFnd2dBQ0FBTmdJSUR3c2dBVUVEZGlJQ1FRTjBRWlNud0FCcUlRRUNmMEdNcDhBQUtBSUFJZ05CQVNBQ2RDSUNjUVJBSUFFb0FnZ01BUXRCaktmQUFDQUNJQU55TmdJQUlBRUxJUUlnQVNBQU5nSUlJQUlnQURZQ0RDQUFJQUUyQWd3Z0FDQUNOZ0lJQ3d1cUJnRUhmd0pBQWtBQ1FBSkFBa0FDUUFKQUFrQWdBRUdBZ0FSUEJFQWdBRUdBZ0FoSkRRRWdBRUcxMlhOcVFiWGJLMGtnQUVIaWkzUnFRZUlMU1hJZ0FFR2ZxSFJxUVo4WVNTQUFRZDdpZEdwQkRrbHljaUFBUWY3Ly93QnhRWjd3Q2tZZ0FFR2lzblZxUVNKSmNpQUFRY3VSZFdwQkMwbHljZzBDSUFCQjhJTTRTUThMSUFCQmdQNERjVUVJZGlFR1FlaVV3QUFoQVNBQVFmOEJjU0VIQTBBQ1FDQUJRUUpxSVFVZ0FpQUJMUUFCSWdScUlRTWdCaUFCTFFBQUlnRkhCRUFnQVNBR1N3MEJJQU1oQWlBRklnRkJ1cFhBQUVjTkFnd0JDeUFESUFKSkRRUWdBMEdpQWtzTkJTQUNRYnFWd0FCcUlRRUNRQU5BSUFSRkRRRWdCRUYvYWlFRUlBRXRBQUFnQVVFQmFpRUJJQWRIRFFBTFFRQWhCQXdFQ3lBRElRSWdCU0lCUWJxVndBQkhEUUVMQ3lBQVFmLy9BM0VoQTBIY2w4QUFJUUZCQVNFRUEwQWdBVUVCYWlFQUFuOGdBQ0FCTFFBQUlnSkJHSFJCR0hVaUJVRUFUZzBBR2lBQVFaR2F3QUJHRFFZZ0FTMEFBU0FGUWY4QWNVRUlkSEloQWlBQlFRSnFDeUVCSUFNZ0Ftc2lBMEVBU0EwQ0lBUkJBWE1oQkNBQlFaR2F3QUJIRFFBTERBRUxJQUJCZ1A0RGNVRUlkaUVHUVpHYXdBQWhBU0FBUWY4QmNTRUhBMEFDUUNBQlFRSnFJUVVnQWlBQkxRQUJJZ1JxSVFNZ0JpQUJMUUFBSWdGSEJFQWdBU0FHU3cwQklBTWhBaUFGSWdGQjNackFBRWNOQWd3QkN5QURJQUpKRFFZZ0EwR3ZBVXNOQnlBQ1FkMmF3QUJxSVFFQ1FBTkFJQVJGRFFFZ0JFRi9haUVFSUFFdEFBQWdBVUVCYWlFQklBZEhEUUFMUVFBaEJBd0RDeUFESVFJZ0JTSUJRZDJhd0FCSERRRUxDeUFBUWYvL0EzRWhBMEdNbk1BQUlRRkJBU0VFQTBBZ0FVRUJhaUVBQW44Z0FDQUJMUUFBSWdKQkdIUkJHSFVpQlVFQVRnMEFHaUFBUWErZndBQkdEUWdnQVMwQUFTQUZRZjhBY1VFSWRISWhBaUFCUVFKcUN5RUJJQU1nQW1zaUEwRUFTQTBCSUFSQkFYTWhCQ0FCUWErZndBQkhEUUFMQ3lBRVFRRnhEd3NnQWlBRFFjaVV3QUFRT0FBTElBTkJvZ0pCeUpUQUFCQTNBQXRCL0l2QUFFRXJRZGlVd0FBUVNBQUxJQUlnQTBISWxNQUFFRGdBQ3lBRFFhOEJRY2lVd0FBUU53QUxRZnlMd0FCQkswSFlsTUFBRUVnQUM3RUZBUWQvUVN0QmdJREVBQ0FBS0FJQUlnbEJBWEVpQlJzaENpQUVJQVZxSVFnQ1FDQUpRUVJ4UlFSQVFRQWhBUXdCQ3lBQ0JFQWdBaUVHSUFFaEJRTkFJQWNnQlMwQUFFSEFBWEZCZ0FGR2FpRUhJQVZCQVdvaEJTQUdRWDlxSWdZTkFBc0xJQUlnQ0dvZ0Iyc2hDQXNDUUFKQUlBQW9BZ2hCQVVjRVFDQUFJQW9nQVNBQ0VFWU5BUXdDQ3lBQVFReHFLQUlBSWdZZ0NFMEVRQ0FBSUFvZ0FTQUNFRVlOQVF3Q0N3SkFBa0FDUUFKQUlBbEJDSEVFUUNBQUtBSUVJUWtnQUVFd05nSUVJQUF0QUNBaEN5QUFRUUU2QUNBZ0FDQUtJQUVnQWhCR0RRVkJBQ0VGSUFZZ0NHc2lBU0VDUVFFZ0FDMEFJQ0lHSUFaQkEwWWJRUU54UVFGckRnTUNBUUlEQzBFQUlRVWdCaUFJYXlJR0lRZ0NRQUpBQWtCQkFTQUFMUUFnSWdjZ0IwRURSaHRCQTNGQkFXc09Bd0VBQVFJTElBWkJBWFloQlNBR1FRRnFRUUYySVFnTUFRdEJBQ0VJSUFZaEJRc2dCVUVCYWlFRkEwQWdCVUYvYWlJRlJRMEVJQUFvQWhnZ0FDZ0NCQ0FBS0FJY0tBSVFFUUFBUlEwQUMwRUJEd3NnQVVFQmRpRUZJQUZCQVdwQkFYWWhBZ3dCQzBFQUlRSWdBU0VGQ3lBRlFRRnFJUVVDUUFOQUlBVkJmMm9pQlVVTkFTQUFLQUlZSUFBb0FnUWdBQ2dDSENnQ0VCRUFBRVVOQUF0QkFROExJQUFvQWdRaEFTQUFLQUlZSUFNZ0JDQUFLQUljS0FJTUVRRUFEUUVnQWtFQmFpRUhJQUFvQWh3aEFpQUFLQUlZSVFNRFFDQUhRWDlxSWdjRVFDQURJQUVnQWlnQ0VCRUFBRVVOQVF3REN3c2dBQ0FMT2dBZ0lBQWdDVFlDQkVFQUR3c2dBQ2dDQkNFRklBQWdDaUFCSUFJUVJnMEFJQUFvQWhnZ0F5QUVJQUFvQWh3b0Fnd1JBUUFOQUNBSVFRRnFJUWNnQUNnQ0hDRUJJQUFvQWhnaEFBTkFJQWRCZjJvaUIwVUVRRUVBRHdzZ0FDQUZJQUVvQWhBUkFBQkZEUUFMQzBFQkR3c2dBQ2dDR0NBRElBUWdBRUVjYWlnQ0FDZ0NEQkVCQUF2MEJRRUtmeU1BUVRCcklnTWtBQ0FEUVNScUlBRTJBZ0FnQTBFRE9nQW9JQU5DZ0lDQWdJQUVOd01JSUFNZ0FEWUNJQ0FEUVFBMkFoZ2dBMEVBTmdJUUFuOENRQUpBQWtBZ0FpZ0NDQ0lFQkVBZ0FpZ0NBQ0VHSUFJb0FnUWlDQ0FDUVF4cUtBSUFJZ1VnQlNBSVN4c2lCVVVOQVNBQUlBWW9BZ0FnQmlnQ0JDQUJLQUlNRVFFQURRTWdCa0VNYWlFQUlBSW9BaFFoQnlBQ0tBSVFJUW9nQlNFSkEwQWdBeUFFUVJ4cUxRQUFPZ0FvSUFNZ0JFRUVhaWtDQUVJZ2lUY0RDQ0FFUVJocUtBSUFJUUpCQUNFTFFRQWhBUUpBQWtBQ1FDQUVRUlJxS0FJQVFRRnJEZ0lBQWdFTElBSWdCMDhFUUNBQ0lBZEJ0SkRBQUJBMkFBc2dBa0VEZENBS2FpSU1LQUlFUVNCSERRRWdEQ2dDQUNnQ0FDRUNDMEVCSVFFTElBTWdBallDRkNBRElBRTJBaEFnQkVFUWFpZ0NBQ0VDQWtBQ1FBSkFJQVJCREdvb0FnQkJBV3NPQWdBQ0FRc2dBaUFIVHdSQUlBSWdCMEcwa01BQUVEWUFDeUFDUVFOMElBcHFJZ0VvQWdSQklFY05BU0FCS0FJQUtBSUFJUUlMUVFFaEN3c2dBeUFDTmdJY0lBTWdDellDR0NBRUtBSUFJZ0VnQjBrRVFDQUtJQUZCQTNScUlnRW9BZ0FnQTBFSWFpQUJLQUlFRVFBQURRVWdDVUYvYWlJSlJRMEVJQVJCSUdvaEJDQUFRWHhxSVFFZ0FDZ0NBQ0VDSUFCQkNHb2hBQ0FES0FJZ0lBRW9BZ0FnQWlBREtBSWtLQUlNRVFFQVJRMEJEQVVMQ3lBQklBZEJwSkRBQUJBMkFBc2dBaWdDQUNFR0lBSW9BZ1FpQ0NBQ1FSUnFLQUlBSWdVZ0JTQUlTeHNpQlVVTkFDQUNLQUlRSVFRZ0FDQUdLQUlBSUFZb0FnUWdBU2dDREJFQkFBMENJQVpCREdvaEFDQUZJUUlEUUNBRUtBSUFJQU5CQ0dvZ0JFRUVhaWdDQUJFQUFBMERJQUpCZjJvaUFrVU5BaUFFUVFocUlRUWdBRUY4YWlFQklBQW9BZ0FoQ1NBQVFRaHFJUUFnQXlnQ0lDQUJLQUlBSUFrZ0F5Z0NKQ2dDREJFQkFFVU5BQXNNQWd0QkFDRUZDeUFJSUFWTEJFQWdBeWdDSUNBR0lBVkJBM1JxSWdBb0FnQWdBQ2dDQkNBREtBSWtLQUlNRVFFQURRRUxRUUFNQVF0QkFRc2dBMEV3YWlRQUM0MEZBUWQvQWtBZ0FVSE0vM3RMRFFCQkVDQUJRUXRxUVhoeElBRkJDMGtiSVFJZ0FFRjhhaUlGS0FJQUlnWkJlSEVoQXdKQUFrQUNRQUpBQWtBQ1FDQUdRUU54QkVBZ0FFRjRhaUlISUFOcUlRZ2dBeUFDVHcwQlFhaXF3QUFvQWdBZ0NFWU5Ba0drcXNBQUtBSUFJQWhHRFFNZ0NFRUVhaWdDQUNJR1FRSnhEUVlnQmtGNGNTSUdJQU5xSWdNZ0FrOE5CQXdHQ3lBQ1FZQUNTU0FESUFKQkJISkpjaUFESUFKclFZR0FDRTl5RFFVTUJBc2dBeUFDYXlJQlFSQkpEUU1nQlNBQ0lBWkJBWEZ5UVFKeU5nSUFJQUlnQjJvaUJDQUJRUU55TmdJRUlBZ2dDQ2dDQkVFQmNqWUNCQ0FFSUFFUUJnd0RDMEdncXNBQUtBSUFJQU5xSWdNZ0FrME5BeUFGSUFJZ0JrRUJjWEpCQW5JMkFnQWdBaUFIYWlJQklBTWdBbXNpQkVFQmNqWUNCRUdncXNBQUlBUTJBZ0JCcUtyQUFDQUJOZ0lBREFJTFFaeXF3QUFvQWdBZ0Eyb2lBeUFDU1EwQ0FrQWdBeUFDYXlJQlFROU5CRUFnQlNBR1FRRnhJQU55UVFKeU5nSUFJQU1nQjJvaUFTQUJLQUlFUVFGeU5nSUVRUUFoQVF3QkN5QUZJQUlnQmtFQmNYSkJBbkkyQWdBZ0FpQUhhaUlFSUFGQkFYSTJBZ1FnQXlBSGFpSUNJQUUyQWdBZ0FpQUNLQUlFUVg1eE5nSUVDMEdrcXNBQUlBUTJBZ0JCbktyQUFDQUJOZ0lBREFFTElBZ2dCaEFSSUFNZ0Ftc2lBVUVRVHdSQUlBVWdBaUFGS0FJQVFRRnhja0VDY2pZQ0FDQUNJQWRxSWdRZ0FVRURjallDQkNBRElBZHFJZ0lnQWlnQ0JFRUJjallDQkNBRUlBRVFCZ3dCQ3lBRklBTWdCU2dDQUVFQmNYSkJBbkkyQWdBZ0F5QUhhaUlCSUFFb0FnUkJBWEkyQWdRTElBQWhCQXdCQ3lBQkVBQWlBa1VOQUNBQ0lBQWdBVUY4UVhnZ0JTZ0NBQ0lFUVFOeEd5QUVRWGh4YWlJRUlBUWdBVXNiRUVzZ0FCQUVEd3NnQkF2MEJBRUpmeU1BUVRCcklnUWtBQUpBQW44Z0FnUkFJQVJCS0dvaENRTkFBa0FnQUNnQ0NDMEFBRVVOQUNBQUtBSUFRY2lOd0FCQkJDQUFLQUlFS0FJTUVRRUFSUTBBUVFFTUF3c2dCRUVLTmdJb0lBUkNpb0NBZ0JBM0F5QWdCQ0FDTmdJY1FRQWhCU0FFUVFBMkFoZ2dCQ0FDTmdJVUlBUWdBVFlDRUVFQklRY2dBU0VHSUFJaUF5RUlBbjhDUUFKQUEwQWdCU0FHYWlFR0lBUWdCMnBCSjJvdEFBQWhDZ0pBQWtBQ1FDQURRUWROQkVBZ0EwVU5BU0FJSUFWcklRdEJBQ0VEQTBBZ0F5QUdhaTBBQUNBS1JnMEVJQXNnQTBFQmFpSURSdzBBQ3d3QkN5QUVRUWhxSUFvZ0JpQURFQlFnQkNnQ0NFRUJSZzBCSUFRb0Fod2hDQXNnQkNBSU5nSVlEQVFMSUFRb0Fnd2hBeUFFS0FJa0lRY2dCQ2dDR0NFRkN5QUVJQU1nQldwQkFXb2lCVFlDR0FKQUFrQWdCU0FIU1FSQUlBUW9BaFFoQXd3QkN5QUVLQUlVSWdNZ0JVa05BQ0FIUVFWUERRTWdCU0FIYXlJR0lBUW9BaEJxSWdnZ0NVWU5BU0FJSUFrZ0J4QkVSUTBCQ3lBRUtBSWNJZ2dnQlVrZ0F5QUlTWElOQXlBSUlBVnJJUU1nQkNnQ0VDRUdEQUVMQ3lBQUtBSUlRUUU2QUFBZ0JrRUJhZ3dDQ3lBSFFRUkJzSkxBQUJBM0FBc2dBQ2dDQ0VFQU9nQUFJQUlMSVFNZ0FDZ0NCQ0VHSUFBb0FnQWhCUUpBQWtBZ0EwVWdBaUFEUm5KRkJFQWdBaUFEU3dSQUlBRWdBMm9pQnl3QUFFRy9mMG9OQWdzZ0FTQUNRUUFnQTBITWpjQUFFQU1BQ3lBRklBRWdBeUFHS0FJTUVRRUFSUTBCUVFFTUJBdEJBU0FGSUFFZ0F5QUdLQUlNRVFFQURRTWFJQWNzQUFCQnYzOU1EUVFMSUFFZ0Eyb2hBU0FDSUFOcklnSU5BQXNMUVFBTElBUkJNR29rQUE4TElBRWdBaUFESUFKQjNJM0FBQkFEQUF1NkF3RUVmeU1BUVJCcklnSWtBQ0FBS0FJQUlRUUNRQUpBQWtBQ2Z3SkFBa0FnQVVHQUFVOEVRQ0FDUVFBMkFnd2dBVUdBRUVrTkFTQUNRUXhxSVFBZ0FVR0FnQVJKQkVBZ0FpQUJRVDl4UVlBQmNqb0FEaUFDSUFGQkRIWkI0QUZ5T2dBTUlBSWdBVUVHZGtFL2NVR0FBWEk2QUExQkF5RUJEQVlMSUFJZ0FVRS9jVUdBQVhJNkFBOGdBaUFCUVJKMlFmQUJjam9BRENBQ0lBRkJCblpCUDNGQmdBRnlPZ0FPSUFJZ0FVRU1ka0UvY1VHQUFYSTZBQTFCQkNFQkRBVUxJQVFvQWdnaUFDQUVRUVJxS0FJQVJ3UkFJQVFvQWdBaEJRd0VDd0pBSUFCQkFXb2lBeUFBU1EwQUlBQkJBWFFpQlNBRElBVWdBMHNiSWdOQkNDQURRUWhMR3lFRElBQUVRQ0FEUVFCSURRRWdCQ2dDQUNJRlJRMERJQVVnQUVFQklBTVFWUXdFQ3lBRFFRQk9EUUlMRUYwQUN5QUNJQUZCUDNGQmdBRnlPZ0FOSUFJZ0FVRUdka0hBQVhJNkFBd2dBa0VNYWlFQVFRSWhBUXdEQ3lBRFFRRVFXUXNpQlFSQUlBUWdCVFlDQUNBRVFRUnFJQU0yQWdBZ0JDZ0NDQ0VBREFFTElBTkJBUkJqQUFzZ0FDQUZhaUFCT2dBQUlBUWdCQ2dDQ0VFQmFqWUNDQXdCQ3lBRUlBQWdBQ0FCYWhBZkN5QUNRUkJxSkFCQkFBdTBBd0VFZnlBQVFRQTJBZ2dnQUVFVWFrRUFOZ0lBSUFGQkQzRWhCQ0FBUVF4cUlRSkJBQ0VCQTBBZ0FDZ0NCQ0FCUmdSQUlBQWdBUkE4SUFBb0FnZ2hBUXNnQUNnQ0FDQUJRUUowYWlJQklBTTZBQUlnQVVFQU93RUFJQUFnQUNnQ0NFRUJhallDQ0NBQUtBSVVJZ0VnQUNnQ0VFWUVRQ0FDSUFFUU95QUFLQUlVSVFFTElBQW9BZ3dnQVVFQmRHcEJBVHNCQUNBQUlBQW9BaFJCQVdvMkFoUWdBQ2dDQ0NFQklBTkJBV29pQlNFRElBVkIvLzhEY1NBRWRrVU5BQXNnQUNnQ0JDQUJSZ1JBSUFBZ0FSQThJQUFvQWdnaEFRc2dBQ2dDQUNBQlFRSjBhaUlCUVFBNkFBSWdBVUVBT3dFQUlBQWdBQ2dDQ0VFQmFqWUNDQ0FBS0FJVUlnRWdBQ2dDRUVZRVFDQUNJQUVRT3lBQUtBSVVJUUVMSUFBb0Fnd2dBVUVCZEdwQkFEc0JBQ0FBSUFBb0FoUkJBV28yQWhRZ0FDZ0NDQ0lCSUFBb0FnUkdCRUFnQUNBQkVEd2dBQ2dDQ0NFQkN5QUFLQUlBSUFGQkFuUnFJZ0ZCQURvQUFpQUJRUUE3QVFBZ0FDQUFLQUlJUVFGcU5nSUlJQUFvQWhRaUFTQUFLQUlRUmdSQUlBSWdBUkE3SUFBb0FoUWhBUXNnQUNnQ0RDQUJRUUYwYWtFQU93RUFJQUFnQUNnQ0ZFRUJhallDRkF2K0F3SURmd0YrSUFFb0FoaEJKeUFCUVJ4cUtBSUFLQUlRRVFBQVJRUkFRZlFBSVFOQkFpRUNBa0FDUUFKQUFrQUNRQUpBSUFBb0FnQWlBRUYzYWc0ZkJRRURBd0FEQXdNREF3TURBd01EQXdNREF3TURBd01EQXdRREF3TURCQUlMUWZJQUlRTU1CQXRCN2dBaEF3d0RDeUFBUWR3QVJnMEJDd0ovQW40Q1FDQUFFQTlGQkVBZ0FCQUhSUTBCUVFFTUF3c2dBRUVCY21kQkFuWkJCM090UW9DQWdJRFFBSVFNQVFzZ0FFRUJjbWRCQW5aQkIzT3RRb0NBZ0lEUUFJUUxJUVZCQXdzaEFpQUFJUU1NQVFzZ0FDRURDd05BSUFJaEJFSGNBQ0VBUVFFaEFnSkFBbjRDUUFKQUFrQUNRQ0FFUVFGckRnTUJCUUFDQ3dKQUFrQUNRQUpBSUFWQ0lJaW5RZjhCY1VFQmF3NEZBd0lCQUFZRkMwSDFBQ0VBSUFWQy8vLy8vNDlnZzBLQWdJQ0FNSVFNQmd0Qit3QWhBQ0FGUXYvLy8vK1BZSU5DZ0lDQWdDQ0VEQVVMUVRCQjF3QWdBeUFGcHlJRVFRSjBRUnh4ZGtFUGNTSUFRUXBKR3lBQWFpRUFJQVZDZjN4Qy8vLy8vdytESUFWQ2dJQ0FnSENEaENBRURRUWFJQVZDLy8vLy80OWdnMEtBZ0lDQUVJUU1CQXRCL1FBaEFDQUZRdi8vLy8rUFlJTU1Bd3RCQUNFQ0lBTWhBQXdEQ3lBQktBSVlRU2NnQVNnQ0hDZ0NFQkVBQUE4TElBVkMvLy8vLzQ5Z2cwS0FnSUNBd0FDRUN5RUZRUU1oQWdzZ0FTZ0NHQ0FBSUFFb0Fod29BaEFSQUFCRkRRQUxDMEVCQzZBREFRVi9Ba0FDUUVFQVFROGdBRUdrbWdSSkd5SUJJQUZCQ0dvaUFTQUJRUUowUVppZ3dBQnFLQUlBUVF0MElBQkJDM1FpQWtzYklnRWdBVUVFYWlJQklBRkJBblJCbUtEQUFHb29BZ0JCQzNRZ0Frc2JJZ0VnQVVFQ2FpSUJJQUZCQW5SQm1LREFBR29vQWdCQkMzUWdBa3NiSWdFZ0FVRUJhaUlCSUFGQkFuUkJtS0RBQUdvb0FnQkJDM1FnQWtzYklnTkJBblJCbUtEQUFHb29BZ0JCQzNRaUFTQUNSaUFCSUFKSmFpQURhaUlDUVI1TkJFQkJzUVVoQkNBQ1FSNUhCRUFnQWtFQ2RFR2NvTUFBYWlnQ0FFRVZkaUVFQzBFQUlRRWdBa0YvYWlJRElBSk5CRUFnQTBFZlR3MERJQU5CQW5SQm1LREFBR29vQWdCQi8vLy9BSEVoQVFzQ1FDQUVJQUpCQW5SQm1LREFBR29vQWdCQkZYWWlBMEVCYWtZTkFDQUFJQUZySVFJZ0EwR3hCU0FEUWJFRlN4c2hCU0FFUVg5cUlRRkJBQ0VBQTBBZ0F5QUZSZzBESUFBZ0EwR1VvY0FBYWkwQUFHb2lBQ0FDU3cwQklBRWdBMEVCYWlJRFJ3MEFDeUFCSVFNTElBTkJBWEVQQ3lBQ1FSOUIySi9BQUJBMkFBc2dCVUd4QlVIb244QUFFRFlBQ3lBRFFSOUIrSi9BQUJBMkFBdm9BZ0VGZndKQVFjMy9leUFBUVJBZ0FFRVFTeHNpQUdzZ0FVME5BQ0FBUVJBZ0FVRUxha0Y0Y1NBQlFRdEpHeUlFYWtFTWFoQUFJZ0pGRFFBZ0FrRjRhaUVCQWtBZ0FFRi9haUlESUFKeFJRUkFJQUVoQUF3QkN5QUNRWHhxSWdVb0FnQWlCa0Y0Y1NBQ0lBTnFRUUFnQUd0eFFYaHFJZ0lnQUNBQ2FpQUNJQUZyUVJCTEd5SUFJQUZySWdKcklRTWdCa0VEY1FSQUlBQWdBeUFBS0FJRVFRRnhja0VDY2pZQ0JDQUFJQU5xSWdNZ0F5Z0NCRUVCY2pZQ0JDQUZJQUlnQlNnQ0FFRUJjWEpCQW5JMkFnQWdBQ0FBS0FJRVFRRnlOZ0lFSUFFZ0FoQUdEQUVMSUFFb0FnQWhBU0FBSUFNMkFnUWdBQ0FCSUFKcU5nSUFDd0pBSUFCQkJHb29BZ0FpQVVFRGNVVU5BQ0FCUVhoeElnSWdCRUVRYWswTkFDQUFRUVJxSUFRZ0FVRUJjWEpCQW5JMkFnQWdBQ0FFYWlJQklBSWdCR3NpQkVFRGNqWUNCQ0FBSUFKcUlnSWdBaWdDQkVFQmNqWUNCQ0FCSUFRUUJnc2dBRUVJYWlFREN5QURDNFVEQVFSL0FrQUNRQ0FCUVlBQ1R3UkFJQUJCR0dvb0FnQWhCQUpBQWtBZ0FDQUFLQUlNSWdKR0JFQWdBRUVVUVJBZ0FFRVVhaUlDS0FJQUlnTWJhaWdDQUNJQkRRRkJBQ0VDREFJTElBQW9BZ2dpQVNBQ05nSU1JQUlnQVRZQ0NBd0JDeUFDSUFCQkVHb2dBeHNoQXdOQUlBTWhCU0FCSWdKQkZHb2lBeWdDQUNJQlJRUkFJQUpCRUdvaEF5QUNLQUlRSVFFTElBRU5BQXNnQlVFQU5nSUFDeUFFUlEwQ0lBQWdBRUVjYWlnQ0FFRUNkRUdjcWNBQWFpSUJLQUlBUndSQUlBUkJFRUVVSUFRb0FoQWdBRVliYWlBQ05nSUFJQUpGRFFNTUFnc2dBU0FDTmdJQUlBSU5BVUdRcDhBQVFaQ253QUFvQWdCQmZpQUFLQUljZDNFMkFnQVBDeUFBUVF4cUtBSUFJZ0lnQUVFSWFpZ0NBQ0lBUndSQUlBQWdBallDRENBQ0lBQTJBZ2dQQzBHTXA4QUFRWXlud0FBb0FnQkJmaUFCUVFOMmQzRTJBZ0FNQVFzZ0FpQUVOZ0lZSUFBb0FoQWlBUVJBSUFJZ0FUWUNFQ0FCSUFJMkFoZ0xJQUJCRkdvb0FnQWlBRVVOQUNBQ1FSUnFJQUEyQWdBZ0FDQUNOZ0lZQ3d1akF3SUVmd0orSXdCQlFHb2lBaVFBUVFFaEJBSkFJQUF0QUFRTkFDQUFMUUFGSVFVZ0FDZ0NBQ0lETFFBQVFRUnhSUVJBSUFNb0FoaEI4WTNBQUVIempjQUFJQVViUVFKQkF5QUZHeUFEUVJ4cUtBSUFLQUlNRVFFQURRRWdBQ2dDQUNJREtBSVlRYzZtd0FCQkJ5QURRUnhxS0FJQUtBSU1FUUVBRFFFZ0FDZ0NBQ0lES0FJWVFhZU13QUJCQWlBRFFSeHFLQUlBS0FJTUVRRUFEUUVnQVNBQUtBSUFRWlNnd0FBb0FnQVJBQUFoQkF3QkN5QUZSUVJBSUFNb0FoaEI3STNBQUVFRElBTkJIR29vQWdBb0Fnd1JBUUFOQVNBQUtBSUFJUU1MSUFKQkFUb0FGeUFDUVRScVFiQ053QUEyQWdBZ0FpQURLUUlZTndNSUlBSWdBa0VYYWpZQ0VDQURLUUlJSVFZZ0F5a0NFQ0VISUFJZ0F5MEFJRG9BT0NBQ0lBYzNBeWdnQWlBR053TWdJQUlnQXlrQ0FEY0RHQ0FDSUFKQkNHbzJBakFnQWtFSWFrSE9wc0FBUVFjUUN3MEFJQUpCQ0dwQnA0ekFBRUVDRUFzTkFDQUJJQUpCR0dwQmxLREFBQ2dDQUJFQUFBMEFJQUlvQWpCQjc0M0FBRUVDSUFJb0FqUW9BZ3dSQVFBaEJBc2dBRUVCT2dBRklBQWdCRG9BQkNBQ1FVQnJKQUFMNWdJQ0JuOEJmaU1BUVRCcklnUWtBQ0FFUVJCcUVDb2dCQ0FFS0FJVUlnVTJBaHdnQkNBRUtBSVFJZ1kyQWhnZ0JFRUlhaUFEUVFBUVFDQUVLUU1JSVFvZ0FFRUFOZ0lJSUFBZ0NqY0NBQUpBQWtBZ0F3UkFRUUFoQmtFQUlRVURRQ0FBSUFWQmdDQVFPaUFBSUFNZ0FDZ0NCQ0lISUFjZ0Ewc2JFRThnQmlBQ1N3MENJQUFvQWdBaENDQUFLQUlJSWdjZ0JVa05BeUFFUVNCcUlBUkJHR29pQ1NnQ0FDQUJJQVpxSUFJZ0Jtc2dCU0FJYWlBSElBVnJJQWtvQWdRb0Fnd1JDQUFnQkNnQ0pDQUZhaUVISUFRb0FpQWhDQ0FBS0FJSUlnVWdCMDhFUUNBQUtBSUFHaUFBSUFjMkFnZ2dCeUVGQ3lBRUxRQW9RUUpIQkVBZ0JpQUlhaUVHSUFVZ0Ewa05BUXNMSUFRb0FoZ2hCaUFFS0FJY0lRVUxJQVlnQlNnQ0FCRURBQ0FFS0FJY0lnQW9BZ2dhSUFRb0FoZ2hBU0FBS0FJRUJFQWdBUkFFQ3lBRVFUQnFKQUFQQ3lBR0lBSkJ5SUhBQUJBNUFBc2dCU0FIUWRpQndBQVFPUUFMMkFJQkJYOENRQUpBQWtBQ1FBSkFJQUpCQTJwQmZIRWdBbXNpQkVVTkFDQURJQVFnQkNBRFN4c2lCVVVOQUVFQUlRUWdBVUgvQVhFaEJnSkFBMEFnQWlBRWFpMEFBQ0FHUmcwQklBVWdCRUVCYWlJRVJ3MEFDeUFGSUFOQmVHb2lCRTBOQWd3REMwRUJJUWNNQXdzZ0EwRjRhaUVFUVFBaEJRc2dBVUgvQVhGQmdZS0VDR3doQmdOQUlBSWdCV29pQjBFRWFpZ0NBQ0FHY3lJSVFYOXpJQWhCLy8zN2QycHhJQWNvQWdBZ0JuTWlCMEYvY3lBSFFmLzkrM2RxY1hKQmdJR0NoSGh4UlFSQUlBVkJDR29pQlNBRVRRMEJDd3NnQlNBRFN3MENDMEVBSVFZQ2YwRUFJQU1nQlVZTkFCb2dBaUFGYWlFQ0lBTWdCV3NoQmtFQUlRUWdBVUgvQVhFaEFRSkFBMEFnQWlBRWFpMEFBQ0FCUmcwQklBWWdCRUVCYWlJRVJ3MEFDMEVBREFFTElBUWhCa0VCQ3lFSElBVWdCbW9oQkFzZ0FDQUVOZ0lFSUFBZ0J6WUNBQThMSUFVZ0EwSG9rTUFBRURrQUM3NENBZ1YvQVg0akFFRXdheUlFSkFCQkp5RUNBa0FnQUVLUXpnQlVCRUFnQUNFSERBRUxBMEFnQkVFSmFpQUNhaUlEUVh4cUlBQWdBRUtRemdDQUlnZENrTTRBZm4ybklnVkIvLzhEY1VIa0FHNGlCa0VCZEVHbWpzQUFhaThBQURzQUFDQURRWDVxSUFVZ0JrSGtBR3hyUWYvL0EzRkJBWFJCcG83QUFHb3ZBQUE3QUFBZ0FrRjhhaUVDSUFCQy84SFhMMVlnQnlFQURRQUxDeUFIcHlJRFFlTUFTZ1JBSUFKQmZtb2lBaUFFUVFscWFpQUhweUlESUFOQi8vOERjVUhrQUc0aUEwSGtBR3hyUWYvL0EzRkJBWFJCcG83QUFHb3ZBQUE3QUFBTEFrQWdBMEVLVGdSQUlBSkJmbW9pQWlBRVFRbHFhaUFEUVFGMFFhYU93QUJxTHdBQU93QUFEQUVMSUFKQmYyb2lBaUFFUVFscWFpQURRVEJxT2dBQUN5QUJRZkNMd0FCQkFDQUVRUWxxSUFKcVFTY2dBbXNRQ0NBRVFUQnFKQUFMb3dJQ0JIOEJmaU1BUVVCcUlnUWtBQUpBQWtBQ1FDQUNJQU5xSWdNZ0FrOEVRQ0FCS0FJRUlRVWdCRUVZYWtLQmdJQ0FFRGNEQUNBRUtBSWNJZ0pCZjJvaUJpQUVLQUlZYWtFQUlBSnJJZ2R4clNBRlFRRjBJZ1VnQXlBRklBTkxHeUlEUVFnZ0EwRUlTeHV0ZmlJSVFpQ0lweUFDUlhJTkFTQUNhVUVCUmdSQUlBaW5JQVpxSUFkeElRTU1Bd3NnQkVFd2FoQXdBQXNnQkVFSWFpQURRUUFRV2lBQUlBUXBBd2czQWdSQkFTRUNEQUlMUVFBaEFnc2dCRUV3YWlBQkVFMGdCRUVnYWlBRElBSWdCRUV3YWhBbFFRRWhBaUFFUVNocUtBSUFJUU1nQkNnQ0pDRUZJQVFvQWlCQkFVY0VRQ0FCSUFVZ0F4QmFRUUFoQWd3QkN5QUVRUkJxSUFVZ0F4QmFJQUFnQkNrREVEY0NCQXNnQUNBQ05nSUFJQVJCUUdza0FBdXVBZ0VJZnlNQVFUQnJJZ0VrQUVHQUlDRUNJQUZCR0dvUUx5QUJLQUljSVFRZ0FTZ0NHQ0VGSUFGQkVHb1FNaUFCS0FJVUlRWWdBU2dDRUNFSElBRkJDR3BCZ0NCQkFSQkFJQUZCZ0NBMkFpZ2dBU0FCS0FJTUlnZzJBaVFnQVNBQktBSUlJZ00yQWlBZ0NFR0JJRThFUUNBQlFTQnFRWUFnRUVVZ0FTZ0NJQ0VESUFFb0FpZ2hBZ3NnQUVFQU93QkhJQUJCQURzQk9DQUFJQU0yQWlnZ0FDQUZOZ0lRSUFCQkNEb0FSaUFBUVFBNkFBc2dBRUlBTndNQUlBQkJNR3BDQURjREFDQUFRU3hxSUFJMkFnQWdBRUVrYWtFQU5nSUFJQUJCSUdvZ0JqWUNBQ0FBUVJ4cUlBYzJBZ0FnQUVFWWFrRUFOZ0lBSUFCQkZHb2dCRFlDQUNBQVFRazZBQW9nQUVHQUFqc0JRaUFBUVlFQ093RkVJQUJCZ2dJN0FVQWdBRUgvQXpzQkNDQUJRVEJxSkFBTHh3SUNCWDhCZmlNQVFSQnJJZ01rQUNBQUxRQUxJUUlnQTBJQU53TUlJQUVvQWdBaEJRSkFBa0FnQUFKL0lBRW9BZ1FpQkVIQUFDQUNheUlHUWZnQmNVRURkaUlDU1FSQUlBUkJDVThOQWlBRFFRaHFJQVVnQkJCTEdpQUJRUUEyQWdRZ0FVR0lnOEFBTmdJQUlBUkJBM1FNQVFzZ0JrSC9BWEZCeUFCUERRSWdBMEVJYWlBRklBSVFTeG9nQVNBRUlBSnJOZ0lFSUFFZ0FpQUZhallDQUNBR1FmZ0JjUXNnQUMwQUN5SUJham9BQ3lBQUlBQXBBd0FnQXlrRENDSUhRamlHSUFkQ0tJWkNnSUNBZ0lDQXdQOEFnNFFnQjBJWWhrS0FnSUNBZ09BL2d5QUhRZ2lHUW9DQWdJRHdINE9FaENBSFFnaUlRb0NBZ1BnUGd5QUhRaGlJUW9DQS9BZURoQ0FIUWlpSVFvRCtBNE1nQjBJNGlJU0VoQ0FCUVQ5eHJZaUVOd01BSUFOQkVHb2tBQThMSUFSQkNFSFloY0FBRURjQUN5QUNRUWhCeUlYQUFCQTNBQXVxQWdFRGZ5TUFRWUFCYXlJRUpBQUNRQUpBQW44Q1FDQUJLQUlBSWdOQkVIRkZCRUFnQUNnQ0FDRUNJQU5CSUhFTkFTQUNyU0FCRUJVTUFnc2dBQ2dDQUNFQ1FRQWhBQU5BSUFBZ0JHcEIvd0JxSUFKQkQzRWlBMEV3Y2lBRFFkY0FhaUFEUVFwSkd6b0FBQ0FBUVg5cUlRQWdBa0VFZGlJQ0RRQUxJQUJCZ0FGcUlnSkJnUUZQRFFJZ0FVR2tqc0FBUVFJZ0FDQUVha0dBQVdwQkFDQUFheEFJREFFTFFRQWhBQU5BSUFBZ0JHcEIvd0JxSUFKQkQzRWlBMEV3Y2lBRFFUZHFJQU5CQ2trYk9nQUFJQUJCZjJvaEFDQUNRUVIySWdJTkFBc2dBRUdBQVdvaUFrR0JBVThOQWlBQlFhU093QUJCQWlBQUlBUnFRWUFCYWtFQUlBQnJFQWdMSUFSQmdBRnFKQUFQQ3lBQ1FZQUJRWlNPd0FBUU9RQUxJQUpCZ0FGQmxJN0FBQkE1QUF1eEFnRUVmeU1BUVVCcUlnSWtBQ0FCS0FJRUlnTkZCRUFnQVVFRWFpRURJQUVvQWdBaEJDQUNRUUEyQWlBZ0FrSUJOd01ZSUFJZ0FrRVlhallDSkNBQ1FUaHFJQVJCRUdvcEFnQTNBd0FnQWtFd2FpQUVRUWhxS1FJQU53TUFJQUlnQkNrQ0FEY0RLQ0FDUVNScVFkaUp3QUFnQWtFb2FoQUpHaUFDUVJCcUlnUWdBaWdDSURZQ0FDQUNJQUlwQXhnM0F3Z0NRQ0FCS0FJRUlnVkZEUUFnQVVFSWFpZ0NBRVVOQUNBRkVBUUxJQU1nQWlrRENEY0NBQ0FEUVFocUlBUW9BZ0EyQWdBZ0F5Z0NBQ0VEQ3lBQlFRRTJBZ1FnQVVFTWFpZ0NBQ0VFSUFGQkNHb2lBU2dDQUNFRklBRkNBRGNDQUVFTVFRUVFXU0lCUlFSQVFReEJCQkJqQUFzZ0FTQUVOZ0lJSUFFZ0JUWUNCQ0FCSUFNMkFnQWdBRUdRaThBQU5nSUVJQUFnQVRZQ0FDQUNRVUJySkFBTC9BRUJBbjhqQUVFUWF5SUNKQUFnQUNnQ0FDQUNRUUEyQWd3Q2Z3SkFBa0FnQVVHQUFVOEVRQ0FCUVlBUVNRMEJJQUpCREdvaEFDQUJRWUNBQkU4TkFpQUNJQUZCUDNGQmdBRnlPZ0FPSUFJZ0FVRU1ka0hnQVhJNkFBd2dBaUFCUVFaMlFUOXhRWUFCY2pvQURVRUREQU1MSUFJZ0FUb0FEQ0FDUVF4cUlRQkJBUXdDQ3lBQ0lBRkJQM0ZCZ0FGeU9nQU5JQUlnQVVFR2RrSEFBWEk2QUF3Z0FrRU1haUVBUVFJTUFRc2dBaUFCUVQ5eFFZQUJjam9BRHlBQ0lBRkJFblpCOEFGeU9nQU1JQUlnQVVFR2RrRS9jVUdBQVhJNkFBNGdBaUFCUVF4MlFUOXhRWUFCY2pvQURVRUVDeUVCSUFBZ0FSQUxJQUpCRUdva0FBdjVBUUVDZnlNQVFSQnJJZ0lrQUNBQ1FRQTJBZ3dDZndKQUFrQWdBVUdBQVU4RVFDQUJRWUFRU1EwQklBSkJER29oQXlBQlFZQ0FCRThOQWlBQ0lBRkJQM0ZCZ0FGeU9nQU9JQUlnQVVFTWRrSGdBWEk2QUF3Z0FpQUJRUVoyUVQ5eFFZQUJjam9BRFVFRERBTUxJQUlnQVRvQURDQUNRUXhxSVFOQkFRd0NDeUFDSUFGQlAzRkJnQUZ5T2dBTklBSWdBVUVHZGtIQUFYSTZBQXdnQWtFTWFpRURRUUlNQVFzZ0FpQUJRVDl4UVlBQmNqb0FEeUFDSUFGQkVuWkI4QUZ5T2dBTUlBSWdBVUVHZGtFL2NVR0FBWEk2QUE0Z0FpQUJRUXgyUVQ5eFFZQUJjam9BRFVFRUN5RUJJQUFnQXlBQkVBc2dBa0VRYWlRQUMvd0JBUU4vSXdCQklHc2lCQ1FBQWtBZ0FrRUJhaUlESUFKUEJFQWdBU2dDQkNJQ1FRRjBJZ1VnQXlBRklBTkxHeUlEUVFRZ0EwRUVTeHNpQTBILy8vLy9BM0VnQTBaQkFYUWhCU0FEUVFKMElRTUNRQ0FDQkVBZ0JFRVlha0VDTmdJQUlBUWdBa0VDZERZQ0ZDQUVJQUVvQWdBMkFoQU1BUXNnQkVFQU5nSVFDeUFFSUFNZ0JTQUVRUkJxRUNWQkFTRUNJQVJCQ0dvb0FnQWhBeUFFS0FJRUlRVWdCQ2dDQUVFQlJ3UkFJQUVnQlRZQ0FDQUJJQU5CQW5ZMkFnUkJBQ0VDREFJTElBQWdCVFlDQkNBQVFRaHFJQU0yQWdBTUFRc2dBQ0FETmdJRUlBQkJDR3BCQURZQ0FFRUJJUUlMSUFBZ0FqWUNBQ0FFUVNCcUpBQUw4QUVCQkg4akFFRWdheUlFSkFBQ1FDQUNRUUZxSWdNZ0FrOEVRQ0FCS0FJRUlnVkJBWFFpQWlBRElBSWdBMHNiSWdOQkJDQURRUVJMR3lJRElBTnFJZ1lnQTA5QkFYUWhBd0pBSUFVRVFDQUVRUmhxUVFJMkFnQWdCQ0FDTmdJVUlBUWdBU2dDQURZQ0VBd0JDeUFFUVFBMkFoQUxJQVFnQmlBRElBUkJFR29RSlVFQklRSWdCRUVJYWlnQ0FDRURJQVFvQWdRaEJTQUVLQUlBUVFGSEJFQWdBU0FGTmdJQUlBRWdBMEVCZGpZQ0JFRUFJUUlNQWdzZ0FDQUZOZ0lFSUFCQkNHb2dBellDQUF3QkN5QUFJQU0yQWdRZ0FFRUlha0VBTmdJQVFRRWhBZ3NnQUNBQ05nSUFJQVJCSUdva0FBdlpBUUVEZndKQUlBQkJCR29vQWdBaUJDQUFRUWhxS0FJQUlnTnJJQUlnQVdzaUJVOEVRQ0FBS0FJQUlRUU1BUXNDZndKQUFrQWdBeUFGYWlJQ0lBTkpEUUFnQkVFQmRDSURJQUlnQXlBQ1N4c2lBa0VJSUFKQkNFc2JJUUlnQkFSQUlBSkJBRWdOQVNBQUtBSUFJZ05GRFFJZ0F5QUVRUUVnQWhCVkRBTUxJQUpCQUU0TkFRc1FYUUFMSUFKQkFSQlpDeUlFQkVBZ0FDQUVOZ0lBSUFCQkJHb2dBallDQUNBQVFRaHFLQUlBSVFNTUFRc2dBa0VCRUdNQUN5QURJQVJxSUFFZ0JSQkxHaUFBUVFocUlnQWdBQ2dDQUNBRmFqWUNBQXZvQVFFRmZ5TUFRUkJySWdNa0FDQUFMUUFMSVFJZ0EwSUFOd01JSUFFb0FnQWhCUUpBQWtBZ0FBSi9JQUVvQWdRaUJFSEFBQ0FDYXlJR1FmZ0JjVUVEZGlJQ1NRUkFJQVJCQ1U4TkFpQURRUWhxSUFVZ0JCQkxHaUFCUVFBMkFnUWdBVUdJZzhBQU5nSUFJQVJCQTNRTUFRc2dCa0gvQVhGQnlBQlBEUUlnQTBFSWFpQUZJQUlRU3hvZ0FTQUVJQUpyTmdJRUlBRWdBaUFGYWpZQ0FDQUdRZmdCY1FzZ0FDMEFDeUlCYWpvQUN5QUFJQUFwQXdBZ0F5a0RDQ0FCUVQ5eHJZYUVOd01BSUFOQkVHb2tBQThMSUFSQkNFSDRoY0FBRURjQUN5QUNRUWhCNklYQUFCQTNBQXZjQVFFRWZ5TUFRVUJxSWdJa0FDQUJRUVJxSVFRZ0FTZ0NCRVVFUUNBQktBSUFJUU1nQWtFQU5nSWdJQUpDQVRjREdDQUNJQUpCR0dvMkFpUWdBa0U0YWlBRFFSQnFLUUlBTndNQUlBSkJNR29nQTBFSWFpa0NBRGNEQUNBQ0lBTXBBZ0EzQXlnZ0FrRWtha0hZaWNBQUlBSkJLR29RQ1JvZ0FrRVFhaUlESUFJb0FpQTJBZ0FnQWlBQ0tRTVlOd01JQWtBZ0FTZ0NCQ0lGUlEwQUlBRkJDR29vQWdCRkRRQWdCUkFFQ3lBRUlBSXBBd2czQWdBZ0JFRUlhaUFES0FJQU5nSUFDeUFBUVpDTHdBQTJBZ1FnQUNBRU5nSUFJQUpCUUdza0FBdVlBZ0VDZnlNQVFTQnJJZ1FrQUVFQklRVkJpS2ZBQUVHSXA4QUFLQUlBUVFGcU5nSUFBa0FDUUFKQVFkQ3F3QUFvQWdCQkFVY0VRRUhRcXNBQVFvR0FnSUFRTndNQURBRUxRZFNxd0FCQjFLckFBQ2dDQUVFQmFpSUZOZ0lBSUFWQkFrc05BUXNnQkNBRE5nSWNJQVFnQWpZQ0dDQUVRZkNKd0FBMkFoUWdCRUh3aWNBQU5nSVFRZnltd0FBb0FnQWlBa0YvVEEwQVFmeW13QUFnQWtFQmFpSUNOZ0lBUWZ5bXdBQkJoS2ZBQUNnQ0FDSURCSDlCZ0tmQUFDZ0NBQ0FFUVFocUlBQWdBU2dDRUJFQ0FDQUVJQVFwQXdnM0F4QWdCRUVRYWlBREtBSU1FUUlBUWZ5bXdBQW9BZ0FGSUFJTFFYOXFOZ0lBSUFWQkFVME5BUXNBQ3lNQVFSQnJJZ0lrQUNBQ0lBRTJBZ3dnQWlBQU5nSUlBQXZNQVFFQ2Z5QUJRUlJxS0FJQUlnVWdBMEgvL3dOeElnUkxCRUFnQVNnQ0RDQUVRUUYwYWk4QkFDRUZJQUVvQWdnaUJDQUJLQUlFUmdSQUlBRWdCQkE4SUFFb0FnZ2hCQXNnQVNnQ0FDQUVRUUowYWlJRUlBSTZBQUlnQkNBRE93RUFJQUVnQVNnQ0NFRUJhallDQ0NBQktBSVVJZ1FnQVVFUWFpZ0NBRVlFUUNBQlFReHFJQVFRT3lBQktBSVVJUVFMSUFFb0Fnd2dCRUVCZEdvZ0JVRUJhanNCQUNBQklBRW9BaFJCQVdvMkFoUWdBQ0FDT2dBQ0lBQWdBenNCQUE4TElBUWdCVUg0aHNBQUVEWUFDOFFCQVFKL0l3QkJFR3NpQWlRQUlBSWdBYTFDZ0lDQWdCQkNBQ0FCS0FJWVFjV213QUJCQ1NBQlFSeHFLQUlBS0FJTUVRRUFHNFEzQXdBZ0FpQUFOZ0lNSUFJZ0FrRU1haEFTSUFJdEFBUWhBU0FDTFFBRkJFQWdBVUgvQVhFaEFDQUNBbjlCQVNBQURRQWFJQUlvQWdBaUFFRWNhaWdDQUNnQ0RDRUJJQUFvQWhnaEF5QUFMUUFBUVFSeFJRUkFJQU5COTQzQUFFRUNJQUVSQVFBTUFRc2dBMEgyamNBQVFRRWdBUkVCQUFzaUFUb0FCQXNnQWtFUWFpUUFJQUZCL3dGeFFRQkhDNm9CQVFKL0FrQUNRQUpBSUFJRVFFRUJJUVFnQVVFQVRnMEJEQUlMSUFBZ0FUWUNCRUVCSVFRTUFRc0NRQUpBQWtBQ1FBSkFJQU1vQWdBaUJVVUVRQ0FCUlEwQkRBTUxJQU1vQWdRaUF3MEJJQUVOQWdzZ0FpRUREQU1MSUFVZ0F5QUNJQUVRVlNJRFJRMEJEQUlMSUFFZ0FoQlpJZ01OQVFzZ0FDQUJOZ0lFSUFJaEFRd0NDeUFBSUFNMkFnUkJBQ0VFREFFTFFRQWhBUXNnQUNBRU5nSUFJQUJCQ0dvZ0FUWUNBQXVmQVFFRGZ5QUFRZ0EzQWdnQ1FDQUJRUlJxS0FJQUlnUWdBa0gvL3dOeElnTkxCRUFnQVNnQ0RDQURRUUYwYWk4QkFDRURJQUFvQWdRaEJDQUFRUUEyQWdRZ0FDZ0NBQ0VGSUFCQkFUWUNBQ0FFSUFOSkRRRWdBU0FDSUFVZ0F4QXBJQUFvQWdRRVFDQUFLQUlBRUFRTElBQWdBellDRENBQUlBUTJBZ1FnQUNBRk5nSUFEd3NnQXlBRVFiaUd3QUFRTmdBTElBTWdCRUhJaHNBQUVEY0FDNGNCQVFKL0l3QkJNR3NpQkNRQUlBUkJJR29pQlNBQ05nSUlJQVVnQWpZQ0JDQUZJQUUyQWdBZ0JFRUlhaUFFUVNCcUVFNGdCRUVRYWlBRUtBSUlJZ0VnQkNnQ0RDSUNJQU1RRXlBQ0JFQWdBUkFFQ3lBRVFTaHFJQVJCR0dvb0FnQTJBZ0FnQkNBRUtRTVFOd01nSUFRZ0JFRWdhaEJPSUFBZ0JDa0RBRGNEQUNBRVFUQnFKQUFMZ2dFQkJuOGpBRUVRYXlJREpBQWdBQ0FBS0FJSUlBRVFPaUFBS0FJQUlRVWdBQ2dDQ0NFQ0lBTkJDR3BCQVNBQkVGb2dBaUFGYWlFRUlBTW9BZ3dpQmlBREtBSUlJZ2RMQkVBZ0JDQUdJQWRyRUZJZ0JTQUNJQVpxSUFkcklnSnFJUVFMSUFBZ0FRUi9JQVJCQURvQUFDQUNRUUZxQlNBQ0N6WUNDQ0FEUVJCcUpBQUxqZ0VCQTM4Z0FDZ0NDQ0lFSUFGQi8vOERjU0lGU3dSQUlBTUVRQ0FBS0FJQUlRUWdBa0YvYWlFRklBRWhBQU5BSUFRZ0FFSC8vd054UVFKMGFpSUdMd0VBSVFBZ0F5QUZhaUFHTFFBQ09nQUFJQUFnQVNBQUlBRkIvLzhEY1VrYklRQWdBMEYvYWlJRERRQUxJQUl0QUFBUEMwRUFRUUJCbUlmQUFCQTJBQXNnQlVFQmFpQUVRWWlId0FBUU53QUxhQUVDZnlNQVFkQUFheUlDSkFBakFFRXdheUlCSkFBZ0FVRUlPZ0FQSUFGQk1Hb2tBQ0FDRUJkQjBBQkJDQkJaSWdFRVFDQUJJQUpCMEFBUVN4b2dBVUVCT2dCSUlBQkJwSVBBQURZQ0JDQUFJQUUyQWdBZ0FrSFFBR29rQUE4TFFkQUFRUWdRWXdBTGdBRUNBbjhCZmlBQkxRQUxJZ1FnQVMwQUNpSURTUVJBSUFFZ0FoQVlJQUV0QUFzaEJDQUJMUUFLSVFNTElBUWdBMEgvQVhGSkJIOUJBQVVnQVNBRUlBTnJPZ0FMSUFFZ0FTa0RBQ0FEcllraUJTQUJMd0VJSWdHdFFuK0ZRb0NBZklTRE53TUFJQUVnQmFkeElRTkJBUXNoQVNBQUlBTTdBUUlnQUNBQk93RUFDNklCQVFOL0l3QkJFR3NpQVNRQUlBQW9BZ0FpQWtFVWFpZ0NBQ0VEQWtBQ2Z3SkFBa0FnQWlnQ0JBNENBQUVEQ3lBRERRSkJBQ0VDUWZDSndBQU1BUXNnQXcwQklBSW9BZ0FpQXlnQ0JDRUNJQU1vQWdBTElRTWdBU0FDTmdJRUlBRWdBellDQUNBQlFmeUt3QUFnQUNnQ0JDZ0NDQ0FBS0FJSUVDSUFDeUFCUVFBMkFnUWdBU0FDTmdJQUlBRkI2SXJBQUNBQUtBSUVLQUlJSUFBb0FnZ1FJZ0FMZ1FFQkEzOGdBU2dDQkNJRElBSlBCRUFDUUNBRFJRMEFJQUVvQWdBaEJBSkFBa0FnQWtVRVFFRUJJUU1nQkJBRURBRUxJQVFnQTBFQklBSVFWU0lEUlEwQkN5QUJJQUkyQWdRZ0FTQUROZ0lBREFFTElBQWdBallDQkNBQVFRaHFRUUUyQWdCQkFTRUZDeUFBSUFVMkFnQVBDMEdVaU1BQVFTUkJ1SWpBQUJCSUFBdDFBZ0ovQVg0Z0FTMEFDeUlFSUFFdEFBb2lBMGtFUUNBQklBSVFJQ0FCTFFBTElRUWdBUzBBQ2lFREN5QUVJQU5CL3dGeFNRUi9RUUFGSUFFZ0JDQURhem9BQ3lBQklBRXBBd0FpQlNBRHJVSS9nNGczQXdBZ0FTOEJDQ0FGcDNFaEEwRUJDeUVCSUFBZ0F6c0JBaUFBSUFFN0FRQUxNQUVCZndKQUFrQkJnSUFCUVFJUVdTSUJEUUVNQUF0QmdJQUJRUUlRWXdBTElBQWdBVFlDQUNBQVFZQWdOZ0lFQzRZQkFRRi9Jd0JCUUdvaUFTUUFJQUZCS3pZQ0RDQUJRWUNCd0FBMkFnZ2dBVUdzZ2NBQU5nSVVJQUVnQURZQ0VDQUJRU3hxUVFJMkFnQWdBVUU4YWtFaE5nSUFJQUZDQWpjQ0hDQUJRYXlNd0FBMkFoZ2dBVUVkTmdJMElBRWdBVUV3YWpZQ0tDQUJJQUZCRUdvMkFqZ2dBU0FCUVFocU5nSXdJQUZCR0dwQjhJREFBQkJSQUF0eEFRTi9Jd0JCSUdzaUFpUUFBa0FnQUNBQkVCa05BQ0FCUVJ4cUtBSUFJUU1nQVNnQ0dDQUNRUnhxUVFBMkFnQWdBa0h3aThBQU5nSVlJQUpDQVRjQ0RDQUNRZlNMd0FBMkFnZ2dBeUFDUVFocUVBa05BQ0FBUVFScUlBRVFHU0FDUVNCcUpBQVBDeUFDUVNCcUpBQkJBUXN3QVFGL0FrQUNRRUdBd0FCQkFoQlpJZ0VOQVF3QUMwR0F3QUJCQWhCakFBc2dBQ0FCTmdJQUlBQkJnQ0EyQWdRTGV3RUNmd0pBQWtBZ0FDZ0NCQ0lCQkVBZ0FDZ0NEQ0lDSUFGUERRRWdBQ2dDQUNJQklBSnFJQUV0QUFBNkFBQWdBRUVBTmdJSUlBQWdBQ2dDREVFQmFqWUNEQ0FBS0FJRVJRMENJQUFvQWdBdEFBQVBDMEVBUVFCQmlJYkFBQkEyQUFzZ0FpQUJRWmlHd0FBUU5nQUxRUUJCQUVHb2hzQUFFRFlBQzJnQkFuOGdBQ0FBTFFCR0lnRkJBV29pQWpvQUNpQUFRUUVnQVVFUGNYUkJBbW9pQVRzQlFDQUFRWDhnQWtFUGNYUkJmM003QVFnZ0FFRVlhaWdDQUNBQlFmLy9BM0VpQVU4RVFDQUFJQUUyQWhnTElBQkJKR29vQWdBZ0FVOEVRQ0FBSUFFMkFpUUxDMUFCQVg4Z0FFRVVhaWdDQUNJQlJTQUJRUUowUlhKRkJFQWdBQ2dDRUJBRUN5QUFRU0JxS0FJQUlnRkZJQUZCQVhSRmNrVUVRQ0FBS0FJY0VBUUxJQUJCTEdvb0FnQUVRQ0FBS0FJb0VBUUxDMndCQVg4akFFRXdheUlESkFBZ0F5QUJOZ0lFSUFNZ0FEWUNBQ0FEUVJ4cVFRSTJBZ0FnQTBFc2FrRWNOZ0lBSUFOQ0FqY0NEQ0FEUVlDTndBQTJBZ2dnQTBFY05nSWtJQU1nQTBFZ2FqWUNHQ0FESUFNMkFpZ2dBeUFEUVFScU5nSWdJQU5CQ0dvZ0FoQlJBQXRzQVFGL0l3QkJNR3NpQXlRQUlBTWdBVFlDQkNBRElBQTJBZ0FnQTBFY2FrRUNOZ0lBSUFOQkxHcEJIRFlDQUNBRFFnSTNBZ3dnQTBITWtjQUFOZ0lJSUFOQkhEWUNKQ0FESUFOQklHbzJBaGdnQXlBRFFRUnFOZ0lvSUFNZ0F6WUNJQ0FEUVFocUlBSVFVUUFMYkFFQmZ5TUFRVEJySWdNa0FDQURJQUUyQWdRZ0F5QUFOZ0lBSUFOQkhHcEJBallDQUNBRFFTeHFRUncyQWdBZ0EwSUNOd0lNSUFOQmdKTEFBRFlDQ0NBRFFSdzJBaVFnQXlBRFFTQnFOZ0lZSUFNZ0EwRUVhallDS0NBRElBTTJBaUFnQTBFSWFpQUNFRkVBQzJ3QkFYOGpBRUV3YXlJREpBQWdBeUFCTmdJRUlBTWdBRFlDQUNBRFFSeHFRUUkyQWdBZ0EwRXNha0VjTmdJQUlBTkNBamNDRENBRFFheVJ3QUEyQWdnZ0EwRWNOZ0lrSUFNZ0EwRWdhallDR0NBRElBTkJCR28yQWlnZ0F5QUROZ0lnSUFOQkNHb2dBaEJSQUF0Y0FRRi9Jd0JCRUdzaUF5UUFBa0FnQUNnQ0JDQUJheUFDVHdSQUlBTkJBRFlDQUF3QkN5QURJQUFnQVNBQ0VCWWdBeWdDQUVFQlJ3MEFJQU5CQ0dvb0FnQWlBQVJBSUFNb0FnUWdBQkJqQUFzUVhRQUxJQU5CRUdva0FBdGFBUUYvSXdCQkVHc2lBaVFBQWtBZ0FDZ0NCQ0FCYTBFQlR3UkFJQUpCQURZQ0FBd0JDeUFDSUFBZ0FSQWVJQUlvQWdCQkFVY05BQ0FDUVFocUtBSUFJZ0FFUUNBQ0tBSUVJQUFRWXdBTEVGMEFDeUFDUVJCcUpBQUxXZ0VCZnlNQVFSQnJJZ0lrQUFKQUlBQW9BZ1FnQVd0QkFVOEVRQ0FDUVFBMkFnQU1BUXNnQWlBQUlBRVFIU0FDS0FJQVFRRkhEUUFnQWtFSWFpZ0NBQ0lBQkVBZ0FpZ0NCQ0FBRUdNQUN4QmRBQXNnQWtFUWFpUUFDMWtCQVg4akFFRWdheUlDSkFBZ0FpQUFLQUlBTmdJRUlBSkJHR29nQVVFUWFpa0NBRGNEQUNBQ1FSQnFJQUZCQ0dvcEFnQTNBd0FnQWlBQktRSUFOd01JSUFKQkJHcEIySW5BQUNBQ1FRaHFFQWtnQWtFZ2FpUUFDMFlBQWtCQkNDQUNTUVJBQW45QkNDQUNTUVJBSUFJZ0F4QVFEQUVMSUFNUUFBc2lBZzBCUVFBUEN5QUFJQU1RQ2c4TElBSWdBQ0FESUFFZ0FTQURTeHNRU3lBQUVBUUxXUUVCZnlNQVFTQnJJZ0lrQUNBQ0lBQW9BZ0EyQWdRZ0FrRVlhaUFCUVJCcUtRSUFOd01BSUFKQkVHb2dBVUVJYWlrQ0FEY0RBQ0FDSUFFcEFnQTNBd2dnQWtFRWFrSHdqOEFBSUFKQkNHb1FDU0FDUVNCcUpBQUxXUUFDUUFKQUFrQWdBVUYvU2dSQUFrQWdBZ1JBSUFFTkFRd0VDeUFCUlEwRElBRkJBUkJaSWdJTkJBd0NDeUFCRUVjaUFrVU5BUXdEQ3hCZEFBc2dBVUVCRUdNQUMwRUJJUUlMSUFBZ0FUWUNCQ0FBSUFJMkFnQUxWZ0VCZnlNQVFTQnJJZ0lrQUNBQ0lBQTJBZ1FnQWtFWWFpQUJRUkJxS1FJQU53TUFJQUpCRUdvZ0FVRUlhaWtDQURjREFDQUNJQUVwQWdBM0F3Z2dBa0VFYWtId2o4QUFJQUpCQ0dvUUNTQUNRU0JxSkFBTFdRRURmd0pBSUFFb0Fnd2lBaUFCS0FJSUlnTlBCRUFnQVNnQ0JDSUVJQUpKRFFFZ0FTZ0NBQ0VCSUFBZ0FpQURhellDQkNBQUlBRWdBMm8yQWdBUEN5QURJQUpCMkliQUFCQTRBQXNnQWlBRVFkaUd3QUFRTndBTFZRRUJmeUFBUVJCcUlBQXRBRVlRRFNBQVFRQTZBRWNnQUVFQU93RTRJQUJCTUdwQ0FEY0RBQ0FBUVFBNkFBc2dBRUlBTndNQUlBQWdBQzBBUmtFQmFpSUJPZ0FLSUFCQmZ5QUJRUTl4ZEVGL2N6c0JDQXREQVFOL0FrQWdBa1VOQUFOQUlBQXRBQUFpQkNBQkxRQUFJZ1ZHQkVBZ0FFRUJhaUVBSUFGQkFXb2hBU0FDUVg5cUlnSU5BUXdDQ3dzZ0JDQUZheUVEQ3lBREMwVUJBWDhqQUVFUWF5SUNKQUFnQWlBQUlBRVFMUUpBSUFJb0FnQkJBVVlFUUNBQ1FRaHFLQUlBSWdCRkRRRWdBaWdDQkNBQUVHTUFDeUFDUVJCcUpBQVBDeEJkQUF0S0FBSi9JQUZCZ0lERUFFY0VRRUVCSUFBb0FoZ2dBU0FBUVJ4cUtBSUFLQUlRRVFBQURRRWFDeUFDUlFSQVFRQVBDeUFBS0FJWUlBSWdBeUFBUVJ4cUtBSUFLQUlNRVFFQUN3c21BUUYvQWtBZ0FCQUFJZ0ZGRFFBZ0FVRjhhaTBBQUVFRGNVVU5BQ0FCSUFBUVVnc2dBUXRIQVFGL0l3QkJJR3NpQXlRQUlBTkJGR3BCQURZQ0FDQURRZkNMd0FBMkFoQWdBMElCTndJRUlBTWdBVFlDSENBRElBQTJBaGdnQXlBRFFSaHFOZ0lBSUFNZ0FoQlJBQXRFQVFKL0lBRW9BZ1FoQWlBQktBSUFJUU5CQ0VFRUVGa2lBVVVFUUVFSVFRUVFZd0FMSUFFZ0FqWUNCQ0FCSUFNMkFnQWdBRUdnaThBQU5nSUVJQUFnQVRZQ0FBdGJBUU4vSXdCQkVHc2lBU1FBSUFBb0Fnd2lBa1VFUUVHQWlzQUFRU3RCeUlyQUFCQklBQXNnQUNnQ0NDSURSUVJBUVlDS3dBQkJLMEhZaXNBQUVFZ0FDeUFCSUFJMkFnZ2dBU0FBTmdJRUlBRWdBellDQUNBQkVGQUFDek1CQVg4Z0FnUkFJQUFoQXdOQUlBTWdBUzBBQURvQUFDQUJRUUZxSVFFZ0EwRUJhaUVESUFKQmYyb2lBZzBBQ3dzZ0FBc3NBQUpBSUFCQmZFMEVRQ0FBUlFSQVFRUWhBQXdDQ3lBQUlBQkJmVWxCQW5RUVdTSUFEUUVMQUFzZ0FBc3hBUUYvSUFFb0FnUWlBZ1JBSUFBZ0FqWUNCQ0FBUVFocVFRRTJBZ0FnQUNBQktBSUFOZ0lBRHdzZ0FFRUFOZ0lBQ3pFQkFYOGdBQ0FCS0FJRUlBRW9BZ2dpQWtzRWZ5QUJJQUlRUlNBQktBSUlCU0FDQ3pZQ0JDQUFJQUVvQWdBMkFnQUxLQUVCZnlBQUtBSUlJZ0lnQVU4RVFDQUFLQUlBR2lBQUlBRTJBZ2dQQ3lBQUlBRWdBbXNRS0Fzc0FRRi9Jd0JCRUdzaUFTUUFJQUZCQ0dvZ0FFRUlhaWdDQURZQ0FDQUJJQUFwQWdBM0F3QWdBUkFzQUFzMEFRRi9Jd0JCRUdzaUFpUUFJQUlnQVRZQ0RDQUNJQUEyQWdnZ0FrRzhqTUFBTmdJRUlBSkI4SXZBQURZQ0FDQUNFRW9BQ3lFQUlBRUVRQU5BSUFCQkFEb0FBQ0FBUVFGcUlRQWdBVUYvYWlJQkRRQUxDd3NnQVFGL0FrQWdBQ2dDQUNJQlJRMEFJQUJCQkdvb0FnQkZEUUFnQVJBRUN3c2dBUUYvQWtBZ0FDZ0NCQ0lCUlEwQUlBQkJDR29vQWdCRkRRQWdBUkFFQ3dzTUFDQUFJQUVnQWlBREVENExDd0FnQVFSQUlBQVFCQXNMRWdBZ0FDZ0NBQ0FCSUFFZ0Ftb1FIMEVBQ3hRQUlBQW9BZ0FnQVNBQUtBSUVLQUlNRVFBQUN4a0FBbjlCQ0NBQlNRUkFJQUVnQUJBUURBRUxJQUFRQUFzTEVBQWdBQ0FDTmdJRUlBQWdBVFlDQUFzVEFDQUFRYUNMd0FBMkFnUWdBQ0FCTmdJQUN4QUFJQUVnQUNnQ0FDQUFLQUlFRUFVTEVRQkJ6SXZBQUVFUlFlQ0x3QUFRU0FBTERnQWdBQ2dDQUJvRFFBd0FDd0FMQ3dBZ0FEVUNBQ0FCRUJVTERRQWdBQ2dDQUNBQklBSVFDd3NMQUNBQU1RQUFJQUVRRlFzTEFDQUFJd0JxSkFBakFBc1pBQ0FBSUFGQitLYkFBQ2dDQUNJQVFRNGdBQnNSQWdBQUN3MEFJQUZCeEpEQUFFRUNFQVVMQ1FBZ0FFRUFPZ0JIQ3djQUlBQXRBRWNMRFFCQzlQbWU1dTZqcXZuK0FBc05BRUwzdU83NnFzelY3dVVBQ3d3QVF1blFvdHZNb3VxN1Jnc0RBQUVMQXdBQkN3dmZKZ0VBUVlDQXdBQUwxU1l2VlhObGNuTXZabTA0TVRNdkxuSjFjM1IxY0M5MGIyOXNZMmhoYVc1ekwzTjBZV0pzWlMxNE9EWmZOalF0WVhCd2JHVXRaR0Z5ZDJsdUwyeHBZaTl5ZFhOMGJHbGlMM055WXk5eWRYTjBMMnhwWW5KaGNua3ZZMjl5WlM5emNtTXZZV3hzYjJNdmJHRjViM1YwTG5KekFBQVFBSEFBQUFBTEFRQUFPUUFBQUdOaGJHeGxaQ0JnVW1WemRXeDBPanAxYm5keVlYQW9LV0FnYjI0Z1lXNGdZRVZ5Y21BZ2RtRnNkV1VBQVFBQUFBQUFBQUFCQUFBQUFnQUFBSE55WXk5c2FXSXVjbk1BQUx3QUVBQUtBQUFBR3dBQUFBNEFBQUM4QUJBQUNnQUFBQndBQUFBU0FBQUFZWE56WlhKMGFXOXVJR1poYVd4bFpEb2diV2xrSUR3OUlITmxiR1l1YkdWdUtDa3ZWWE5sY25NdlptMDRNVE12TG5KMWMzUjFjQzkwYjI5c1kyaGhhVzV6TDNOMFlXSnNaUzE0T0RaZk5qUXRZWEJ3YkdVdFpHRnlkMmx1TDJ4cFlpOXlkWE4wYkdsaUwzTnlZeTl5ZFhOMEwyeHBZbkpoY25rdlkyOXlaUzl6Y21NdmMyeHBZMlV2Ylc5a0xuSnpDd0VRQUcwQUFBRDlCQUFBQ1FBQUFBTUFBQUJRQUFBQUNBQUFBQVFBQUFBRkFBQUFCZ0FBQUFjQUFBQUlBQUFBVUFBQUFBZ0FBQUFKQUFBQUNnQUFBQXNBQUFBTUFBQUFMMVZ6WlhKekwyWnRPREV6THk1allYSm5ieTl5WldkcGMzUnllUzl6Y21NdloybDBhSFZpTG1OdmJTMHhaV05qTmpJNU9XUmlPV1ZqT0RJekwzZGxaWHBzTFRBdU1TNDBMM055WXk5a1pXTnZaR1V1Y25NQUFNQUJFQUJXQUFBQVdnSUFBQjhBQUFEQUFSQUFWZ0FBQUcwQ0FBQWJBQUFBd0FFUUFGWUFBQUNDQWdBQUpnQUFBTUFCRUFCV0FBQUFxd0lBQUJFQUFBREFBUkFBVmdBQUFLMENBQUFSQUFBQXdBRVFBRllBQUFDNUFnQUFHUUFBQU1BQkVBQldBQUFBelFJQUFDSUFBQURBQVJBQVZnQUFBTThDQUFBYkFBQUF3QUVRQUZZQUFBRFFBZ0FBRlFBQUFNQUJFQUJXQUFBQTBRSUFBQlVBQUFEQUFSQUFWZ0FBQVBvQ0FBQU5BQUFBd0FFUUFGWUFBQUJGQXdBQUVRQUFBTUFCRUFCV0FBQUFTd01BQUJFQUFBREFBUkFBVmdBQUFJb0RBQUFSQUFBQXdBRVFBRllBQUFDUUF3QUFFUUFBQU1BQkVBQldBQUFBdkFNQUFDY0FBQURBQVJBQVZnQUFBTHdEQUFBSkFBQUF3QUVRQUZZQUFBQy9Bd0FBQ1FBQUFNQUJFQUJXQUFBQXhnTUFBQlVBQUFEQUFSQUFWZ0FBQU1rREFBQVlBQUFBd0FFUUFGWUFBQURTQXdBQUNnQUFBTUFCRUFCV0FBQUErQU1BQUFvQUFBREFBUkFBVmdBQUFBVUVBQUFWQUFBQXdBRVFBRllBQUFBTkJBQUFGZ0FBQU1BQkVBQldBQUFBR0FRQUFBa0FBQUF2VlhObGNuTXZabTA0TVRNdkxuSjFjM1IxY0M5MGIyOXNZMmhoYVc1ekwzTjBZV0pzWlMxNE9EWmZOalF0WVhCd2JHVXRaR0Z5ZDJsdUwyeHBZaTl5ZFhOMGJHbGlMM055WXk5eWRYTjBMMnhwWW5KaGNua3ZZV3hzYjJNdmMzSmpMM0poZDE5MlpXTXVjbk5VY21sbFpDQjBieUJ6YUhKcGJtc2dkRzhnWVNCc1lYSm5aWElnWTJGd1lXTnBkSG1vQXhBQWJBQUFBTVVCQUFBSkFBQUFUV0Y0YVcxMWJTQmpiMlJsSUhOcGVtVWdNVElnY21WeGRXbHlaV1FzSUdkdmRDQUFTQVFRQUNNQUFBQXZWWE5sY25NdlptMDRNVE12TG1OaGNtZHZMM0psWjJsemRISjVMM055WXk5bmFYUm9kV0l1WTI5dExURmxZMk0yTWprNVpHSTVaV000TWpNdmQyVmxlbXd0TUM0eExqUXZjM0pqTDJ4cFlpNXljd0IwQkJBQVV3QUFBRTBBQUFBRkFBQUFEd0FBQUFRQUFBQUVBQUFBRUFBQUFCRUFBQUFTQUFBQUR3QUFBQUFBQUFBQkFBQUFFd0FBQUdOaGJHeGxaQ0JnVDNCMGFXOXVPanAxYm5keVlYQW9LV0FnYjI0Z1lTQmdUbTl1WldBZ2RtRnNkV1ZzYVdKeVlYSjVMM04wWkM5emNtTXZjR0Z1YVdOcmFXNW5Mbkp6QUNzRkVBQWNBQUFBN1FFQUFCOEFBQUFyQlJBQUhBQUFBTzRCQUFBZUFBQUFGQUFBQUJBQUFBQUVBQUFBRlFBQUFCWUFBQUFQQUFBQUNBQUFBQVFBQUFBWEFBQUFHQUFBQUJrQUFBQU1BQUFBQkFBQUFCb0FBQUFQQUFBQUNBQUFBQVFBQUFBYkFBQUFiR2xpY21GeWVTOWhiR3h2WXk5emNtTXZjbUYzWDNabFl5NXljMk5oY0dGamFYUjVJRzkyWlhKbWJHOTNBQUFBc0FVUUFCd0FBQUFlQWdBQUJRQUFBR0F1TGdEeEJSQUFBZ0FBQUdOaGJHeGxaQ0JnVDNCMGFXOXVPanAxYm5keVlYQW9LV0FnYjI0Z1lTQmdUbTl1WldBZ2RtRnNkV1U2SUFBQUFQQUZFQUFBQUFBQUp3WVFBQUlBQUFBaUFBQUFBQUFBQUFFQUFBQWpBQUFBYVc1a1pYZ2diM1YwSUc5bUlHSnZkVzVrY3pvZ2RHaGxJR3hsYmlCcGN5QWdZblYwSUhSb1pTQnBibVJsZUNCcGN5QUFBRXdHRUFBZ0FBQUFiQVlRQUJJQUFBQnNhV0p5WVhKNUwyTnZjbVV2YzNKakwyWnRkQzlpZFdsc1pHVnljeTV5Y3lJQUFBQU1BQUFBQkFBQUFDUUFBQUFsQUFBQUpnQUFBQ0FnSUNDUUJoQUFJQUFBQURJQUFBQWhBQUFBa0FZUUFDQUFBQUF6QUFBQUVnQUFBQ0I3Q2l3S0xDQWdleUI5SUgxc2FXSnlZWEo1TDJOdmNtVXZjM0pqTDJadGRDOXVkVzB1Y25QNUJoQUFHd0FBQUdVQUFBQVVBQUFBTUhnd01EQXhNREl3TXpBME1EVXdOakEzTURnd09URXdNVEV4TWpFek1UUXhOVEUyTVRjeE9ERTVNakF5TVRJeU1qTXlOREkxTWpZeU56STRNamt6TURNeE16SXpNek0wTXpVek5qTTNNemd6T1RRd05ERTBNalF6TkRRME5UUTJORGMwT0RRNU5UQTFNVFV5TlRNMU5EVTFOVFkxTnpVNE5UazJNRFl4TmpJMk16WTBOalUyTmpZM05qZzJPVGN3TnpFM01qY3pOelEzTlRjMk56YzNPRGM1T0RBNE1UZ3lPRE00TkRnMU9EWTROemc0T0RrNU1Ea3hPVEk1TXprME9UVTVOamszT1RnNU9RQUFJZ0FBQUFRQUFBQUVBQUFBSndBQUFDZ0FBQUFwQUFBQWJHbGljbUZ5ZVM5amIzSmxMM055WXk5bWJYUXZiVzlrTG5KekFBZ0lFQUFiQUFBQVZRUUFBQkVBQUFBSUNCQUFHd0FBQUY4RUFBQWtBQUFBS0Nsc2FXSnlZWEo1TDJOdmNtVXZjM0pqTDNOc2FXTmxMMjFsYldOb2NpNXljd0FBUmdnUUFDQUFBQUJhQUFBQUJRQUFBSEpoYm1kbElITjBZWEowSUdsdVpHVjRJQ0J2ZFhRZ2IyWWdjbUZ1WjJVZ1ptOXlJSE5zYVdObElHOW1JR3hsYm1kMGFDQjRDQkFBRWdBQUFJb0lFQUFpQUFBQWNtRnVaMlVnWlc1a0lHbHVaR1Y0SUx3SUVBQVFBQUFBaWdnUUFDSUFBQUJ6YkdsalpTQnBibVJsZUNCemRHRnlkSE1nWVhRZ0lHSjFkQ0JsYm1SeklHRjBJQURjQ0JBQUZnQUFBUElJRUFBTkFBQUFiR2xpY21GeWVTOWpiM0psTDNOeVl5OXpkSEl2Y0dGMGRHVnliaTV5Y3dBUUNSQUFId0FBQUxBQkFBQW1BQUFBV3k0dUxsMWllWFJsSUdsdVpHVjRJQ0JwY3lCdmRYUWdiMllnWW05MWJtUnpJRzltSUdBQUFFVUpFQUFMQUFBQVVBa1FBQllBQUFEd0JSQUFBUUFBQUdKbFoybHVJRHc5SUdWdVpDQW9JRHc5SUNrZ2QyaGxiaUJ6YkdsamFXNW5JR0FBQUlBSkVBQU9BQUFBamdrUUFBUUFBQUNTQ1JBQUVBQUFBUEFGRUFBQkFBQUFJR2x6SUc1dmRDQmhJR05vWVhJZ1ltOTFibVJoY25rN0lHbDBJR2x6SUdsdWMybGtaU0FnS0dKNWRHVnpJQ2tnYjJZZ1lFVUpFQUFMQUFBQXhBa1FBQ1lBQUFEcUNSQUFDQUFBQVBJSkVBQUdBQUFBOEFVUUFBRUFBQUJzYVdKeVlYSjVMMk52Y21VdmMzSmpMM1Z1YVdOdlpHVXZjSEpwYm5SaFlteGxMbkp6QUFBQUlBb1FBQ1VBQUFBS0FBQUFIQUFBQUNBS0VBQWxBQUFBR2dBQUFEWUFBQUFBQVFNRkJRWUdBd2NHQ0FnSkVRb2NDeGtNRkEwUURnMFBCQkFERWhJVENSWUJGd1VZQWhrREdnY2NBaDBCSHhZZ0F5c0RMQUl0Q3k0Qk1BTXhBaklCcHdLcEFxb0Vxd2o2QXZzRi9RVCtBLzhKclhoNWk0MmlNRmRZaTR5UUhCM2REZzlMVFB2OExpOC9YRjFmdGVLRWpZNlJrcW14dXJ2RnhzbkszdVRsL3dBRUVSSXBNVFEzT2pzOVNVcGRoSTZTcWJHMHVydkd5czdQNU9VQUJBME9FUklwTVRRNk8wVkdTVXBlWkdXRWtadWR5YzdQRFJFcFJVbFhaR1dOa2FtMHVydkZ5ZC9rNWZBTkVVVkpaR1dBaExLOHZyL1YxL0R4ZzRXTHBLYSt2OFhIenMvYTIwaVl2YzNHenM5SlRrOVhXVjVmaVk2UHNiYTN2OEhHeDljUkZoZGJYUGIzL3YrQURXMXgzdDhPRHg5dWJ4d2RYMzErcnErN3ZQb1dGeDRmUmtkT1QxaGFYRjUrZjdYRjFOWGM4UEgxY25PUGRIV1dMMThtTGkrbnI3ZS94OC9YMzVwQWw1Z3dqeC9Bd2M3L1RrOWFXd2NJRHhBbkwrN3ZibTgzUFQ5Q1JaQ1IvdjlUWjNYSXlkRFIyTm5uL3Y4QUlGOGlndDhFZ2tRSUd3UUdFWUdzRG9Dck5TZ0xnT0FER1FnQkJDOEVOQVFIQXdFSEJnY1JDbEFQRWdkVkJ3TUVIQW9KQXdnREJ3TUNBd01EREFRRkF3c0dBUTRWQlRvREVRY0dCUkFIVndjQ0J4VU5VQVJEQXkwREFRUVJCZzhNT2dRZEpWOGdiUVJxSllESUJZS3dBeG9HZ3YwRFdRY1ZDeGNKRkF3VURHb0dDZ1lhQmxrSEt3VkdDaXdFREFRQkF6RUxMQVFhQmdzRGdLd0dDZ1loUDB3RUxRTjBDRHdERHdNOEJ6Z0lLd1dDL3hFWUNDOFJMUU1nRUNFUGdJd0VncGNaQ3hXSWxBVXZCVHNIQWc0WUNZQ3pMWFFNZ05ZYURBV0Evd1dBM3d6dURRT0VqUU0zQ1lGY0ZJQzRDSURMS2pnRENnWTRDRVlJREFaMEN4NERXZ1JaQ1lDREdCd0tGZ2xNQklDS0JxdWtEQmNFTWFFRWdkb21Cd3dGQllDbEVZRnRFSGdvS2daTUJJQ05CSUMrQXhzRER3MEFCZ0VCQXdFRUFnZ0lDUUlLQlFzQ0RnUVFBUkVDRWdVVEVSUUJGUUlYQWhrTkhBVWRDQ1FCYWdOckFyd0MwUUxVRE5VSjFnTFhBdG9CNEFYaEF1Z0M3aUR3QlBnQytRTDZBdnNCRENjN1BrNVBqNTZlbndZSENUWTlQbGJ6ME5FRUZCZzJOMVpYZjZxdXI3MDE0QktIaVk2ZUJBME9FUklwTVRRNlJVWkpTazVQWkdWY3RyY2JIQWNJQ2dzVUZ6WTVPcWlwMk5rSk41Q1JxQWNLT3o1bWFZK1NiMS91NzFwaW1wc25LRldkb0tHanBLZW9yYnE4eEFZTERCVWRPajlGVWFhbnpNMmdCeGthSWlVK1A4WEdCQ0FqSlNZb016ZzZTRXBNVUZOVlZsaGFYRjVnWTJWbWEzTjRmWCtLcEtxdnNNRFFycTk1ekc1dmsxNGlld1VEQkMwRFpnTUJMeTZBZ2gwRE1ROGNCQ1FKSGdVckJVUUVEaXFBcWdZa0JDUUVLQWcwQ3dHQWtJRTNDUllLQ0lDWU9RTmpDQWt3RmdVaEF4c0ZBVUE0QkVzRkx3UUtCd2tIUUNBbkJBd0pOZ002QlJvSEJBd0hVRWszTXcwekJ5NElDb0VtVWs0b0NDcFdIQlFYQ1U0RUhnOUREaGtIQ2daSUNDY0pkUXMvUVNvR093VUtCbEVHQVFVUUF3V0FpMkllU0FnS2dLWmVJa1VMQ2dZTkV6a0hDallzQkJDQXdEeGtVd3hJQ1FwR1JSdElDRk1kT1lFSFJnb2RBMGRKTndNT0NBb0dPUWNLZ1RZWmdMY0JEeklOZzV0bWRRdUF4SXE4aEMrUDBZSkhvYm1DT1FjcUJBSmdKZ3BHQ2lnRkU0S3dXMlZMQkRrSEVVQUZDd0lPbC9nSWhOWXFDYUwzZ1I4eEF4RUVDSUdNaVFSckJRMERDUWNRazJDQTlncHpDRzRYUm9DYUZBeFhDUm1BaDRGSEE0VkNEeFdGVUN1QTFTMERHZ1FDZ1hBNkJRR0ZBSURYS1V3RUNnUUNneEZFVEQyQXdqd0dBUVJWQlJzMEFvRU9MQVJrREZZS2dLNDRIUTBzQkFrSEFnNEdnSnFEMkFnTkF3MERkQXhaQnd3VURBUTRDQW9HS0FnaVRvRlVEQlVEQXdVSENSa0hCd2tERFFjcGdNc2xDb1FHYkdsaWNtRnllUzlqYjNKbEwzTnlZeTkxYm1samIyUmxMM1Z1YVdOdlpHVmZaR0YwWVM1eWN3Q3ZEeEFBS0FBQUFFc0FBQUFvQUFBQXJ3OFFBQ2dBQUFCWEFBQUFGZ0FBQUs4UEVBQW9BQUFBVWdBQUFENEFBQUFpQUFBQUJBQUFBQVFBQUFBcUFBQUFBQU1BQUlNRUlBQ1JCV0FBWFJPZ0FCSVhvQjRNSU9BZTd5d2dLeW93b0N0dnBtQXNBcWpnTEI3NzRDMEEvcUExbnYvZ05mMEJZVFlCQ3FFMkpBMWhONnNPNFRndkdDRTVNQnhoUnZNZW9VcndhbUZPVDIraFRwMjhJVTlsMGVGUEFOb2hVQURnNFZFdzRXRlQ3T0toVk5EbzRWUWdBQzVWOEFHL1ZRQndBQWNBTFFFQkFRSUJBZ0VCU0Fzd0ZSQUJaUWNDQmdJQ0FRUWpBUjRiV3dzNkNRa0JHQVFCQ1FFREFRVXJBM2NQQVNBM0FRRUJCQWdFQVFNSENnSWRBVG9CQVFFQ0JBZ0JDUUVLQWhvQkFnSTVBUVFDQkFJQ0F3TUJIZ0lEQVFzQ09RRUVCUUVDQkFFVUFoWUdBUUU2QVFFQ0FRUUlBUWNEQ2dJZUFUc0JBUUVNQVFrQktBRURBVGtEQlFNQkJBY0NDd0lkQVRvQkFnRUNBUU1CQlFJSEFnc0NIQUk1QWdFQkFnUUlBUWtCQ2dJZEFVZ0JCQUVDQXdFQkNBRlJBUUlIREFoaUFRSUpDd1pLQWhzQkFRRUJBVGNPQVFVQkFnVUxBU1FKQVdZRUFRWUJBZ0lDR1FJRUF4QUVEUUVDQWdZQkR3RUFBd0FESFFNZEFoNENRQUlCQndnQkFnc0pBUzBEZHdJaUFYWURCQUlKQVFZRDJ3SUNBVG9CQVFjQkFRRUJBZ2dHQ2dJQk1CRS9CREFIQVFFRkFTZ0pEQUlnQkFJQ0FRTTRBUUVDQXdFQkF6b0lBZ0tZQXdFTkFRY0VBUVlCQXdMR09nRUZBQUhESVFBRGpRRmdJQUFHYVFJQUJBRUtJQUpRQWdBQkF3RUVBUmtDQlFHWEFob1NEUUVtQ0JrTExnTXdBUUlFQWdJbkFVTUdBZ0lDQWd3QkNBRXZBVE1CQVFNQ0FnVUNBUUVxQWdnQjdnRUNBUVFCQUFFQUVCQVFBQUlBQWVJQmxRVUFBd0VDQlFRb0F3UUJwUUlBQkFBQ21RdXdBVFlQT0FNeEJBSUNSUU1rQlFFSVBnRU1BalFKQ2dRQ0FWOERBZ0VCQWdZQm9BRURDQlVDT1FJQkFRRUJGZ0VPQndNRnd3Z0NBd0VCRndGUkFRSUdBUUVDQVFFQ0FRTHJBUUlFQmdJQkFoc0NWUWdDQVFFQ2FnRUJBUUlHQVFGbEF3SUVBUVVBQ1FFQzlRRUtBZ0VCQkFHUUJBSUNCQUVnQ2lnR0FnUUlBUWtHQWdNdURRRUNBQWNCQmdFQlVoWUNCd0VDQVFKNkJnTUJBUUlCQndFQlNBSURBUUVCQUFJQUJUc0hBQUUvQkZFQkFBSUFBUUVEQkFVSUNBSUhIZ1NVQXdBM0JESUlBUTRCRmdVQkR3QUhBUkVDQndFQ0FRVUFCd0FFQUFkdEJ3QmdnUEFBVEdGNWIzVjBSWEp5Y0hKcGRtRjBaUUI3Q1hCeWIyUjFZMlZ5Y3dJSWJHRnVaM1ZoWjJVQkJGSjFjM1FBREhCeWIyTmxjM05sWkMxaWVRTUZjblZ6ZEdNZE1TNDBPUzR3SUNobE1UZzROR0U0WlRNZ01qQXlNQzB4TWkweU9Ta0dkMkZzY25WekJqQXVNVGd1TUF4M1lYTnRMV0pwYm1SblpXNFNNQzR5TGpjd0lDaGlOak0xTldNeU56QXAiKTtsZXQgbzthc3luYyBmdW5jdGlvbiBOKEEsSSl7b3x8KG89YXdhaXQoYXN5bmMoKT0+KGF3YWl0IEUoRyksRCkpKCkpO2NvbnN0IGc9by5kZWNvbXByZXNzKEEsSSk7aWYoMD09PWcubGVuZ3RoKXRocm93IEVycm9yKCJGYWlsZWQgdG8gZGVjb2RlIHdpdGggTFpXIGRlY29kZXIuIik7cmV0dXJuIGd9CgogIGNsYXNzIExaV0RlY29kZXIgZXh0ZW5kcyBCYXNlRGVjb2RlciB7CiAgICBjb25zdHJ1Y3RvcihmaWxlRGlyZWN0b3J5KSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIGNvbnN0IHdpZHRoID0gZmlsZURpcmVjdG9yeS5UaWxlV2lkdGggfHwgZmlsZURpcmVjdG9yeS5JbWFnZVdpZHRoOwogICAgICBjb25zdCBoZWlnaHQgPSBmaWxlRGlyZWN0b3J5LlRpbGVMZW5ndGggfHwgZmlsZURpcmVjdG9yeS5JbWFnZUxlbmd0aDsKICAgICAgY29uc3QgbmJ5dGVzID0gZmlsZURpcmVjdG9yeS5CaXRzUGVyU2FtcGxlWzBdIC8gODsKICAgICAgdGhpcy5tYXhVbmNvbXByZXNzZWRTaXplID0gd2lkdGggKiBoZWlnaHQgKiBuYnl0ZXM7CiAgICB9CgogICAgYXN5bmMgZGVjb2RlQmxvY2soYnVmZmVyKSB7CiAgICAgIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTsKICAgICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IE4oYnl0ZXMsIHRoaXMubWF4VW5jb21wcmVzc2VkU2l6ZSk7CiAgICAgIHJldHVybiBkZWNvZGVkLmJ1ZmZlcjsKICAgIH0KICB9CgogIC8qIC0qLSB0YWItd2lkdGg6IDI7IGluZGVudC10YWJzLW1vZGU6IG5pbDsgYy1iYXNpYy1vZmZzZXQ6IDIgLSotIC8KICAvKiB2aW06IHNldCBzaGlmdHdpZHRoPTIgdGFic3RvcD0yIGF1dG9pbmRlbnQgY2luZGVudCBleHBhbmR0YWI6ICovCiAgLyoKICAgICBDb3B5cmlnaHQgMjAxMSBub3RtYXN0ZXJ5ZXQKICAgICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICAgICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgICAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiAgICAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogICAgIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUKICAgICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogICAgIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogICAgIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICAgICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICAqLwoKICAvLyAtIFRoZSBKUEVHIHNwZWNpZmljYXRpb24gY2FuIGJlIGZvdW5kIGluIHRoZSBJVFUgQ0NJVFQgUmVjb21tZW5kYXRpb24gVC44MQogIC8vICAgKHd3dy53My5vcmcvR3JhcGhpY3MvSlBFRy9pdHUtdDgxLnBkZikKICAvLyAtIFRoZSBKRklGIHNwZWNpZmljYXRpb24gY2FuIGJlIGZvdW5kIGluIHRoZSBKUEVHIEZpbGUgSW50ZXJjaGFuZ2UgRm9ybWF0CiAgLy8gICAod3d3LnczLm9yZy9HcmFwaGljcy9KUEVHL2pmaWYzLnBkZikKICAvLyAtIFRoZSBBZG9iZSBBcHBsaWNhdGlvbi1TcGVjaWZpYyBKUEVHIG1hcmtlcnMgaW4gdGhlIFN1cHBvcnRpbmcgdGhlIERDVCBGaWx0ZXJzCiAgLy8gICBpbiBQb3N0U2NyaXB0IExldmVsIDIsIFRlY2huaWNhbCBOb3RlICM1MTE2CiAgLy8gICAocGFydG5lcnMuYWRvYmUuY29tL3B1YmxpYy9kZXZlbG9wZXIvZW4vcHMvc2RrLzUxMTYuRENUX0ZpbHRlci5wZGYpCgoKICBjb25zdCBkY3RaaWdaYWcgPSBuZXcgSW50MzJBcnJheShbCiAgICAwLAogICAgMSwgOCwKICAgIDE2LCA5LCAyLAogICAgMywgMTAsIDE3LCAyNCwKICAgIDMyLCAyNSwgMTgsIDExLCA0LAogICAgNSwgMTIsIDE5LCAyNiwgMzMsIDQwLAogICAgNDgsIDQxLCAzNCwgMjcsIDIwLCAxMywgNiwKICAgIDcsIDE0LCAyMSwgMjgsIDM1LCA0MiwgNDksIDU2LAogICAgNTcsIDUwLCA0MywgMzYsIDI5LCAyMiwgMTUsCiAgICAyMywgMzAsIDM3LCA0NCwgNTEsIDU4LAogICAgNTksIDUyLCA0NSwgMzgsIDMxLAogICAgMzksIDQ2LCA1MywgNjAsCiAgICA2MSwgNTQsIDQ3LAogICAgNTUsIDYyLAogICAgNjMsCiAgXSk7CgogIGNvbnN0IGRjdENvczEgPSA0MDE3OyAvLyBjb3MocGkvMTYpCiAgY29uc3QgZGN0U2luMSA9IDc5OTsgLy8gc2luKHBpLzE2KQogIGNvbnN0IGRjdENvczMgPSAzNDA2OyAvLyBjb3MoMypwaS8xNikKICBjb25zdCBkY3RTaW4zID0gMjI3NjsgLy8gc2luKDMqcGkvMTYpCiAgY29uc3QgZGN0Q29zNiA9IDE1Njc7IC8vIGNvcyg2KnBpLzE2KQogIGNvbnN0IGRjdFNpbjYgPSAzNzg0OyAvLyBzaW4oNipwaS8xNikKICBjb25zdCBkY3RTcXJ0MiA9IDU3OTM7IC8vIHNxcnQoMikKICBjb25zdCBkY3RTcXJ0MWQyID0gMjg5NjsvLyBzcXJ0KDIpIC8gMgoKICBmdW5jdGlvbiBidWlsZEh1ZmZtYW5UYWJsZShjb2RlTGVuZ3RocywgdmFsdWVzKSB7CiAgICBsZXQgayA9IDA7CiAgICBjb25zdCBjb2RlID0gW107CiAgICBsZXQgbGVuZ3RoID0gMTY7CiAgICB3aGlsZSAobGVuZ3RoID4gMCAmJiAhY29kZUxlbmd0aHNbbGVuZ3RoIC0gMV0pIHsKICAgICAgLS1sZW5ndGg7CiAgICB9CiAgICBjb2RlLnB1c2goeyBjaGlsZHJlbjogW10sIGluZGV4OiAwIH0pOwoKICAgIGxldCBwID0gY29kZVswXTsKICAgIGxldCBxOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNvZGVMZW5ndGhzW2ldOyBqKyspIHsKICAgICAgICBwID0gY29kZS5wb3AoKTsKICAgICAgICBwLmNoaWxkcmVuW3AuaW5kZXhdID0gdmFsdWVzW2tdOwogICAgICAgIHdoaWxlIChwLmluZGV4ID4gMCkgewogICAgICAgICAgcCA9IGNvZGUucG9wKCk7CiAgICAgICAgfQogICAgICAgIHAuaW5kZXgrKzsKICAgICAgICBjb2RlLnB1c2gocCk7CiAgICAgICAgd2hpbGUgKGNvZGUubGVuZ3RoIDw9IGkpIHsKICAgICAgICAgIGNvZGUucHVzaChxID0geyBjaGlsZHJlbjogW10sIGluZGV4OiAwIH0pOwogICAgICAgICAgcC5jaGlsZHJlbltwLmluZGV4XSA9IHEuY2hpbGRyZW47CiAgICAgICAgICBwID0gcTsKICAgICAgICB9CiAgICAgICAgaysrOwogICAgICB9CiAgICAgIGlmIChpICsgMSA8IGxlbmd0aCkgewogICAgICAgIC8vIHAgaGVyZSBwb2ludHMgdG8gbGFzdCBjb2RlCiAgICAgICAgY29kZS5wdXNoKHEgPSB7IGNoaWxkcmVuOiBbXSwgaW5kZXg6IDAgfSk7CiAgICAgICAgcC5jaGlsZHJlbltwLmluZGV4XSA9IHEuY2hpbGRyZW47CiAgICAgICAgcCA9IHE7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBjb2RlWzBdLmNoaWxkcmVuOwogIH0KCiAgZnVuY3Rpb24gZGVjb2RlU2NhbihkYXRhLCBpbml0aWFsT2Zmc2V0LAogICAgZnJhbWUsIGNvbXBvbmVudHMsIHJlc2V0SW50ZXJ2YWwsCiAgICBzcGVjdHJhbFN0YXJ0LCBzcGVjdHJhbEVuZCwKICAgIHN1Y2Nlc3NpdmVQcmV2LCBzdWNjZXNzaXZlKSB7CiAgICBjb25zdCB7IG1jdXNQZXJMaW5lLCBwcm9ncmVzc2l2ZSB9ID0gZnJhbWU7CgogICAgY29uc3Qgc3RhcnRPZmZzZXQgPSBpbml0aWFsT2Zmc2V0OwogICAgbGV0IG9mZnNldCA9IGluaXRpYWxPZmZzZXQ7CiAgICBsZXQgYml0c0RhdGEgPSAwOwogICAgbGV0IGJpdHNDb3VudCA9IDA7CiAgICBmdW5jdGlvbiByZWFkQml0KCkgewogICAgICBpZiAoYml0c0NvdW50ID4gMCkgewogICAgICAgIGJpdHNDb3VudC0tOwogICAgICAgIHJldHVybiAoYml0c0RhdGEgPj4gYml0c0NvdW50KSAmIDE7CiAgICAgIH0KICAgICAgYml0c0RhdGEgPSBkYXRhW29mZnNldCsrXTsKICAgICAgaWYgKGJpdHNEYXRhID09PSAweEZGKSB7CiAgICAgICAgY29uc3QgbmV4dEJ5dGUgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICBpZiAobmV4dEJ5dGUpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgdW5leHBlY3RlZCBtYXJrZXI6ICR7KChiaXRzRGF0YSA8PCA4KSB8IG5leHRCeXRlKS50b1N0cmluZygxNil9YCk7CiAgICAgICAgfQogICAgICAgIC8vIHVuc3R1ZmYgMAogICAgICB9CiAgICAgIGJpdHNDb3VudCA9IDc7CiAgICAgIHJldHVybiBiaXRzRGF0YSA+Pj4gNzsKICAgIH0KICAgIGZ1bmN0aW9uIGRlY29kZUh1ZmZtYW4odHJlZSkgewogICAgICBsZXQgbm9kZSA9IHRyZWU7CiAgICAgIGxldCBiaXQ7CiAgICAgIHdoaWxlICgoYml0ID0gcmVhZEJpdCgpKSAhPT0gbnVsbCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbmQtYXNzaWduCiAgICAgICAgbm9kZSA9IG5vZGVbYml0XTsKICAgICAgICBpZiAodHlwZW9mIG5vZGUgPT09ICdudW1iZXInKSB7CiAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBub2RlICE9PSAnb2JqZWN0JykgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbnZhbGlkIGh1ZmZtYW4gc2VxdWVuY2UnKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBmdW5jdGlvbiByZWNlaXZlKGluaXRpYWxMZW5ndGgpIHsKICAgICAgbGV0IGxlbmd0aCA9IGluaXRpYWxMZW5ndGg7CiAgICAgIGxldCBuID0gMDsKICAgICAgd2hpbGUgKGxlbmd0aCA+IDApIHsKICAgICAgICBjb25zdCBiaXQgPSByZWFkQml0KCk7CiAgICAgICAgaWYgKGJpdCA9PT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgICAgICB9CiAgICAgICAgbiA9IChuIDw8IDEpIHwgYml0OwogICAgICAgIC0tbGVuZ3RoOwogICAgICB9CiAgICAgIHJldHVybiBuOwogICAgfQogICAgZnVuY3Rpb24gcmVjZWl2ZUFuZEV4dGVuZChsZW5ndGgpIHsKICAgICAgY29uc3QgbiA9IHJlY2VpdmUobGVuZ3RoKTsKICAgICAgaWYgKG4gPj0gMSA8PCAobGVuZ3RoIC0gMSkpIHsKICAgICAgICByZXR1cm4gbjsKICAgICAgfQogICAgICByZXR1cm4gbiArICgtMSA8PCBsZW5ndGgpICsgMTsKICAgIH0KICAgIGZ1bmN0aW9uIGRlY29kZUJhc2VsaW5lKGNvbXBvbmVudCwgenopIHsKICAgICAgY29uc3QgdCA9IGRlY29kZUh1ZmZtYW4oY29tcG9uZW50Lmh1ZmZtYW5UYWJsZURDKTsKICAgICAgY29uc3QgZGlmZiA9IHQgPT09IDAgPyAwIDogcmVjZWl2ZUFuZEV4dGVuZCh0KTsKICAgICAgY29tcG9uZW50LnByZWQgKz0gZGlmZjsKICAgICAgenpbMF0gPSBjb21wb25lbnQucHJlZDsKICAgICAgbGV0IGsgPSAxOwogICAgICB3aGlsZSAoayA8IDY0KSB7CiAgICAgICAgY29uc3QgcnMgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyk7CiAgICAgICAgY29uc3QgcyA9IHJzICYgMTU7CiAgICAgICAgY29uc3QgciA9IHJzID4+IDQ7CiAgICAgICAgaWYgKHMgPT09IDApIHsKICAgICAgICAgIGlmIChyIDwgMTUpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBrICs9IDE2OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBrICs9IHI7CiAgICAgICAgICBjb25zdCB6ID0gZGN0WmlnWmFnW2tdOwogICAgICAgICAgenpbel0gPSByZWNlaXZlQW5kRXh0ZW5kKHMpOwogICAgICAgICAgaysrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gZGVjb2RlRENGaXJzdChjb21wb25lbnQsIHp6KSB7CiAgICAgIGNvbnN0IHQgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVEQyk7CiAgICAgIGNvbnN0IGRpZmYgPSB0ID09PSAwID8gMCA6IChyZWNlaXZlQW5kRXh0ZW5kKHQpIDw8IHN1Y2Nlc3NpdmUpOwogICAgICBjb21wb25lbnQucHJlZCArPSBkaWZmOwogICAgICB6elswXSA9IGNvbXBvbmVudC5wcmVkOwogICAgfQogICAgZnVuY3Rpb24gZGVjb2RlRENTdWNjZXNzaXZlKGNvbXBvbmVudCwgenopIHsKICAgICAgenpbMF0gfD0gcmVhZEJpdCgpIDw8IHN1Y2Nlc3NpdmU7CiAgICB9CiAgICBsZXQgZW9icnVuID0gMDsKICAgIGZ1bmN0aW9uIGRlY29kZUFDRmlyc3QoY29tcG9uZW50LCB6eikgewogICAgICBpZiAoZW9icnVuID4gMCkgewogICAgICAgIGVvYnJ1bi0tOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQgayA9IHNwZWN0cmFsU3RhcnQ7CiAgICAgIGNvbnN0IGUgPSBzcGVjdHJhbEVuZDsKICAgICAgd2hpbGUgKGsgPD0gZSkgewogICAgICAgIGNvbnN0IHJzID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlQUMpOwogICAgICAgIGNvbnN0IHMgPSBycyAmIDE1OwogICAgICAgIGNvbnN0IHIgPSBycyA+PiA0OwogICAgICAgIGlmIChzID09PSAwKSB7CiAgICAgICAgICBpZiAociA8IDE1KSB7CiAgICAgICAgICAgIGVvYnJ1biA9IHJlY2VpdmUocikgKyAoMSA8PCByKSAtIDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgayArPSAxNjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgayArPSByOwogICAgICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgICAgIHp6W3pdID0gcmVjZWl2ZUFuZEV4dGVuZChzKSAqICgxIDw8IHN1Y2Nlc3NpdmUpOwogICAgICAgICAgaysrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbGV0IHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMDsKICAgIGxldCBzdWNjZXNzaXZlQUNOZXh0VmFsdWU7CiAgICBmdW5jdGlvbiBkZWNvZGVBQ1N1Y2Nlc3NpdmUoY29tcG9uZW50LCB6eikgewogICAgICBsZXQgayA9IHNwZWN0cmFsU3RhcnQ7CiAgICAgIGNvbnN0IGUgPSBzcGVjdHJhbEVuZDsKICAgICAgbGV0IHIgPSAwOwogICAgICB3aGlsZSAoayA8PSBlKSB7CiAgICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgICBjb25zdCBkaXJlY3Rpb24gPSB6elt6XSA8IDAgPyAtMSA6IDE7CiAgICAgICAgc3dpdGNoIChzdWNjZXNzaXZlQUNTdGF0ZSkgewogICAgICAgICAgY2FzZSAwOiB7IC8vIGluaXRpYWwgc3RhdGUKICAgICAgICAgICAgY29uc3QgcnMgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyk7CiAgICAgICAgICAgIGNvbnN0IHMgPSBycyAmIDE1OwogICAgICAgICAgICByID0gcnMgPj4gNDsKICAgICAgICAgICAgaWYgKHMgPT09IDApIHsKICAgICAgICAgICAgICBpZiAociA8IDE1KSB7CiAgICAgICAgICAgICAgICBlb2JydW4gPSByZWNlaXZlKHIpICsgKDEgPDwgcik7CiAgICAgICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IDQ7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHIgPSAxNjsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKHMgIT09IDEpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignaW52YWxpZCBBQ24gZW5jb2RpbmcnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDTmV4dFZhbHVlID0gcmVjZWl2ZUFuZEV4dGVuZChzKTsKICAgICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IHIgPyAyIDogMzsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb250aW51ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb250aW51ZQogICAgICAgICAgfQogICAgICAgICAgY2FzZSAxOiAvLyBza2lwcGluZyByIHplcm8gaXRlbXMKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgaWYgKHp6W3pdKSB7CiAgICAgICAgICAgICAgenpbel0gKz0gKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKSAqIGRpcmVjdGlvbjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByLS07CiAgICAgICAgICAgICAgaWYgKHIgPT09IDApIHsKICAgICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gc3VjY2Vzc2l2ZUFDU3RhdGUgPT09IDIgPyAzIDogMDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDM6IC8vIHNldCB2YWx1ZSBmb3IgYSB6ZXJvIGl0ZW0KICAgICAgICAgICAgaWYgKHp6W3pdKSB7CiAgICAgICAgICAgICAgenpbel0gKz0gKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKSAqIGRpcmVjdGlvbjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB6elt6XSA9IHN1Y2Nlc3NpdmVBQ05leHRWYWx1ZSA8PCBzdWNjZXNzaXZlOwogICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNDogLy8gZW9iCiAgICAgICAgICAgIGlmICh6elt6XSkgewogICAgICAgICAgICAgIHp6W3pdICs9IChyZWFkQml0KCkgPDwgc3VjY2Vzc2l2ZSkgKiBkaXJlY3Rpb247CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGsrKzsKICAgICAgfQogICAgICBpZiAoc3VjY2Vzc2l2ZUFDU3RhdGUgPT09IDQpIHsKICAgICAgICBlb2JydW4tLTsKICAgICAgICBpZiAoZW9icnVuID09PSAwKSB7CiAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IDA7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBkZWNvZGVNY3UoY29tcG9uZW50LCBkZWNvZGVGdW5jdGlvbiwgbWN1LCByb3csIGNvbCkgewogICAgICBjb25zdCBtY3VSb3cgPSAobWN1IC8gbWN1c1BlckxpbmUpIHwgMDsKICAgICAgY29uc3QgbWN1Q29sID0gbWN1ICUgbWN1c1BlckxpbmU7CiAgICAgIGNvbnN0IGJsb2NrUm93ID0gKG1jdVJvdyAqIGNvbXBvbmVudC52KSArIHJvdzsKICAgICAgY29uc3QgYmxvY2tDb2wgPSAobWN1Q29sICogY29tcG9uZW50LmgpICsgY29sOwogICAgICBkZWNvZGVGdW5jdGlvbihjb21wb25lbnQsIGNvbXBvbmVudC5ibG9ja3NbYmxvY2tSb3ddW2Jsb2NrQ29sXSk7CiAgICB9CiAgICBmdW5jdGlvbiBkZWNvZGVCbG9jayhjb21wb25lbnQsIGRlY29kZUZ1bmN0aW9uLCBtY3UpIHsKICAgICAgY29uc3QgYmxvY2tSb3cgPSAobWN1IC8gY29tcG9uZW50LmJsb2Nrc1BlckxpbmUpIHwgMDsKICAgICAgY29uc3QgYmxvY2tDb2wgPSBtY3UgJSBjb21wb25lbnQuYmxvY2tzUGVyTGluZTsKICAgICAgZGVjb2RlRnVuY3Rpb24oY29tcG9uZW50LCBjb21wb25lbnQuYmxvY2tzW2Jsb2NrUm93XVtibG9ja0NvbF0pOwogICAgfQoKICAgIGNvbnN0IGNvbXBvbmVudHNMZW5ndGggPSBjb21wb25lbnRzLmxlbmd0aDsKICAgIGxldCBjb21wb25lbnQ7CiAgICBsZXQgaTsKICAgIGxldCBqOwogICAgbGV0IGs7CiAgICBsZXQgbjsKICAgIGxldCBkZWNvZGVGbjsKICAgIGlmIChwcm9ncmVzc2l2ZSkgewogICAgICBpZiAoc3BlY3RyYWxTdGFydCA9PT0gMCkgewogICAgICAgIGRlY29kZUZuID0gc3VjY2Vzc2l2ZVByZXYgPT09IDAgPyBkZWNvZGVEQ0ZpcnN0IDogZGVjb2RlRENTdWNjZXNzaXZlOwogICAgICB9IGVsc2UgewogICAgICAgIGRlY29kZUZuID0gc3VjY2Vzc2l2ZVByZXYgPT09IDAgPyBkZWNvZGVBQ0ZpcnN0IDogZGVjb2RlQUNTdWNjZXNzaXZlOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBkZWNvZGVGbiA9IGRlY29kZUJhc2VsaW5lOwogICAgfQoKICAgIGxldCBtY3UgPSAwOwogICAgbGV0IG1hcmtlcjsKICAgIGxldCBtY3VFeHBlY3RlZDsKICAgIGlmIChjb21wb25lbnRzTGVuZ3RoID09PSAxKSB7CiAgICAgIG1jdUV4cGVjdGVkID0gY29tcG9uZW50c1swXS5ibG9ja3NQZXJMaW5lICogY29tcG9uZW50c1swXS5ibG9ja3NQZXJDb2x1bW47CiAgICB9IGVsc2UgewogICAgICBtY3VFeHBlY3RlZCA9IG1jdXNQZXJMaW5lICogZnJhbWUubWN1c1BlckNvbHVtbjsKICAgIH0KCiAgICBjb25zdCB1c2VkUmVzZXRJbnRlcnZhbCA9IHJlc2V0SW50ZXJ2YWwgfHwgbWN1RXhwZWN0ZWQ7CgogICAgd2hpbGUgKG1jdSA8IG1jdUV4cGVjdGVkKSB7CiAgICAgIC8vIHJlc2V0IGludGVydmFsIHN0dWZmCiAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzTGVuZ3RoOyBpKyspIHsKICAgICAgICBjb21wb25lbnRzW2ldLnByZWQgPSAwOwogICAgICB9CiAgICAgIGVvYnJ1biA9IDA7CgogICAgICBpZiAoY29tcG9uZW50c0xlbmd0aCA9PT0gMSkgewogICAgICAgIGNvbXBvbmVudCA9IGNvbXBvbmVudHNbMF07CiAgICAgICAgZm9yIChuID0gMDsgbiA8IHVzZWRSZXNldEludGVydmFsOyBuKyspIHsKICAgICAgICAgIGRlY29kZUJsb2NrKGNvbXBvbmVudCwgZGVjb2RlRm4sIG1jdSk7CiAgICAgICAgICBtY3UrKzsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChuID0gMDsgbiA8IHVzZWRSZXNldEludGVydmFsOyBuKyspIHsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzTGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29tcG9uZW50ID0gY29tcG9uZW50c1tpXTsKICAgICAgICAgICAgY29uc3QgeyBoLCB2IH0gPSBjb21wb25lbnQ7CiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB2OyBqKyspIHsKICAgICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgaDsgaysrKSB7CiAgICAgICAgICAgICAgICBkZWNvZGVNY3UoY29tcG9uZW50LCBkZWNvZGVGbiwgbWN1LCBqLCBrKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIG1jdSsrOwoKICAgICAgICAgIC8vIElmIHdlJ3ZlIHJlYWNoZWQgb3VyIGV4cGVjdGVkIE1DVSdzLCBzdG9wIGRlY29kaW5nCiAgICAgICAgICBpZiAobWN1ID09PSBtY3VFeHBlY3RlZCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIGZpbmQgbWFya2VyCiAgICAgIGJpdHNDb3VudCA9IDA7CiAgICAgIG1hcmtlciA9IChkYXRhW29mZnNldF0gPDwgOCkgfCBkYXRhW29mZnNldCArIDFdOwogICAgICBpZiAobWFya2VyIDwgMHhGRjAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdtYXJrZXIgd2FzIG5vdCBmb3VuZCcpOwogICAgICB9CgogICAgICBpZiAobWFya2VyID49IDB4RkZEMCAmJiBtYXJrZXIgPD0gMHhGRkQ3KSB7IC8vIFJTVHgKICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgfSBlbHNlIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBvZmZzZXQgLSBzdGFydE9mZnNldDsKICB9CgogIGZ1bmN0aW9uIGJ1aWxkQ29tcG9uZW50RGF0YShmcmFtZSwgY29tcG9uZW50KSB7CiAgICBjb25zdCBsaW5lcyA9IFtdOwogICAgY29uc3QgeyBibG9ja3NQZXJMaW5lLCBibG9ja3NQZXJDb2x1bW4gfSA9IGNvbXBvbmVudDsKICAgIGNvbnN0IHNhbXBsZXNQZXJMaW5lID0gYmxvY2tzUGVyTGluZSA8PCAzOwogICAgY29uc3QgUiA9IG5ldyBJbnQzMkFycmF5KDY0KTsKICAgIGNvbnN0IHIgPSBuZXcgVWludDhBcnJheSg2NCk7CgogICAgLy8gQSBwb3J0IG9mIHBvcHBsZXIncyBJRENUIG1ldGhvZCB3aGljaCBpbiB0dXJuIGlzIHRha2VuIGZyb206CiAgICAvLyAgIENocmlzdG9waCBMb2VmZmxlciwgQWRyaWFhbiBMaWd0ZW5iZXJnLCBHZW9yZ2UgUy4gTW9zY2h5dHosCiAgICAvLyAgICJQcmFjdGljYWwgRmFzdCAxLUQgRENUIEFsZ29yaXRobXMgd2l0aCAxMSBNdWx0aXBsaWNhdGlvbnMiLAogICAgLy8gICBJRUVFIEludGwuIENvbmYuIG9uIEFjb3VzdGljcywgU3BlZWNoICYgU2lnbmFsIFByb2Nlc3NpbmcsIDE5ODksCiAgICAvLyAgIDk4OC05OTEuCiAgICBmdW5jdGlvbiBxdWFudGl6ZUFuZEludmVyc2UoenosIGRhdGFPdXQsIGRhdGFJbikgewogICAgICBjb25zdCBxdCA9IGNvbXBvbmVudC5xdWFudGl6YXRpb25UYWJsZTsKICAgICAgbGV0IHYwOwogICAgICBsZXQgdjE7CiAgICAgIGxldCB2MjsKICAgICAgbGV0IHYzOwogICAgICBsZXQgdjQ7CiAgICAgIGxldCB2NTsKICAgICAgbGV0IHY2OwogICAgICBsZXQgdjc7CiAgICAgIGxldCB0OwogICAgICBjb25zdCBwID0gZGF0YUluOwogICAgICBsZXQgaTsKCiAgICAgIC8vIGRlcXVhbnQKICAgICAgZm9yIChpID0gMDsgaSA8IDY0OyBpKyspIHsKICAgICAgICBwW2ldID0genpbaV0gKiBxdFtpXTsKICAgICAgfQoKICAgICAgLy8gaW52ZXJzZSBEQ1Qgb24gcm93cwogICAgICBmb3IgKGkgPSAwOyBpIDwgODsgKytpKSB7CiAgICAgICAgY29uc3Qgcm93ID0gOCAqIGk7CgogICAgICAgIC8vIGNoZWNrIGZvciBhbGwtemVybyBBQyBjb2VmZmljaWVudHMKICAgICAgICBpZiAocFsxICsgcm93XSA9PT0gMCAmJiBwWzIgKyByb3ddID09PSAwICYmIHBbMyArIHJvd10gPT09IDAKICAgICAgICAgICYmIHBbNCArIHJvd10gPT09IDAgJiYgcFs1ICsgcm93XSA9PT0gMCAmJiBwWzYgKyByb3ddID09PSAwCiAgICAgICAgICAmJiBwWzcgKyByb3ddID09PSAwKSB7CiAgICAgICAgICB0ID0gKChkY3RTcXJ0MiAqIHBbMCArIHJvd10pICsgNTEyKSA+PiAxMDsKICAgICAgICAgIHBbMCArIHJvd10gPSB0OwogICAgICAgICAgcFsxICsgcm93XSA9IHQ7CiAgICAgICAgICBwWzIgKyByb3ddID0gdDsKICAgICAgICAgIHBbMyArIHJvd10gPSB0OwogICAgICAgICAgcFs0ICsgcm93XSA9IHQ7CiAgICAgICAgICBwWzUgKyByb3ddID0gdDsKICAgICAgICAgIHBbNiArIHJvd10gPSB0OwogICAgICAgICAgcFs3ICsgcm93XSA9IHQ7CiAgICAgICAgICBjb250aW51ZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb250aW51ZQogICAgICAgIH0KCiAgICAgICAgLy8gc3RhZ2UgNAogICAgICAgIHYwID0gKChkY3RTcXJ0MiAqIHBbMCArIHJvd10pICsgMTI4KSA+PiA4OwogICAgICAgIHYxID0gKChkY3RTcXJ0MiAqIHBbNCArIHJvd10pICsgMTI4KSA+PiA4OwogICAgICAgIHYyID0gcFsyICsgcm93XTsKICAgICAgICB2MyA9IHBbNiArIHJvd107CiAgICAgICAgdjQgPSAoKGRjdFNxcnQxZDIgKiAocFsxICsgcm93XSAtIHBbNyArIHJvd10pKSArIDEyOCkgPj4gODsKICAgICAgICB2NyA9ICgoZGN0U3FydDFkMiAqIChwWzEgKyByb3ddICsgcFs3ICsgcm93XSkpICsgMTI4KSA+PiA4OwogICAgICAgIHY1ID0gcFszICsgcm93XSA8PCA0OwogICAgICAgIHY2ID0gcFs1ICsgcm93XSA8PCA0OwoKICAgICAgICAvLyBzdGFnZSAzCiAgICAgICAgdCA9ICh2MCAtIHYxICsgMSkgPj4gMTsKICAgICAgICB2MCA9ICh2MCArIHYxICsgMSkgPj4gMTsKICAgICAgICB2MSA9IHQ7CiAgICAgICAgdCA9ICgodjIgKiBkY3RTaW42KSArICh2MyAqIGRjdENvczYpICsgMTI4KSA+PiA4OwogICAgICAgIHYyID0gKCh2MiAqIGRjdENvczYpIC0gKHYzICogZGN0U2luNikgKyAxMjgpID4+IDg7CiAgICAgICAgdjMgPSB0OwogICAgICAgIHQgPSAodjQgLSB2NiArIDEpID4+IDE7CiAgICAgICAgdjQgPSAodjQgKyB2NiArIDEpID4+IDE7CiAgICAgICAgdjYgPSB0OwogICAgICAgIHQgPSAodjcgKyB2NSArIDEpID4+IDE7CiAgICAgICAgdjUgPSAodjcgLSB2NSArIDEpID4+IDE7CiAgICAgICAgdjcgPSB0OwoKICAgICAgICAvLyBzdGFnZSAyCiAgICAgICAgdCA9ICh2MCAtIHYzICsgMSkgPj4gMTsKICAgICAgICB2MCA9ICh2MCArIHYzICsgMSkgPj4gMTsKICAgICAgICB2MyA9IHQ7CiAgICAgICAgdCA9ICh2MSAtIHYyICsgMSkgPj4gMTsKICAgICAgICB2MSA9ICh2MSArIHYyICsgMSkgPj4gMTsKICAgICAgICB2MiA9IHQ7CiAgICAgICAgdCA9ICgodjQgKiBkY3RTaW4zKSArICh2NyAqIGRjdENvczMpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjQgPSAoKHY0ICogZGN0Q29zMykgLSAodjcgKiBkY3RTaW4zKSArIDIwNDgpID4+IDEyOwogICAgICAgIHY3ID0gdDsKICAgICAgICB0ID0gKCh2NSAqIGRjdFNpbjEpICsgKHY2ICogZGN0Q29zMSkgKyAyMDQ4KSA+PiAxMjsKICAgICAgICB2NSA9ICgodjUgKiBkY3RDb3MxKSAtICh2NiAqIGRjdFNpbjEpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjYgPSB0OwoKICAgICAgICAvLyBzdGFnZSAxCiAgICAgICAgcFswICsgcm93XSA9IHYwICsgdjc7CiAgICAgICAgcFs3ICsgcm93XSA9IHYwIC0gdjc7CiAgICAgICAgcFsxICsgcm93XSA9IHYxICsgdjY7CiAgICAgICAgcFs2ICsgcm93XSA9IHYxIC0gdjY7CiAgICAgICAgcFsyICsgcm93XSA9IHYyICsgdjU7CiAgICAgICAgcFs1ICsgcm93XSA9IHYyIC0gdjU7CiAgICAgICAgcFszICsgcm93XSA9IHYzICsgdjQ7CiAgICAgICAgcFs0ICsgcm93XSA9IHYzIC0gdjQ7CiAgICAgIH0KCiAgICAgIC8vIGludmVyc2UgRENUIG9uIGNvbHVtbnMKICAgICAgZm9yIChpID0gMDsgaSA8IDg7ICsraSkgewogICAgICAgIGNvbnN0IGNvbCA9IGk7CgogICAgICAgIC8vIGNoZWNrIGZvciBhbGwtemVybyBBQyBjb2VmZmljaWVudHMKICAgICAgICBpZiAocFsoMSAqIDgpICsgY29sXSA9PT0gMCAmJiBwWygyICogOCkgKyBjb2xdID09PSAwICYmIHBbKDMgKiA4KSArIGNvbF0gPT09IDAKICAgICAgICAgICYmIHBbKDQgKiA4KSArIGNvbF0gPT09IDAgJiYgcFsoNSAqIDgpICsgY29sXSA9PT0gMCAmJiBwWyg2ICogOCkgKyBjb2xdID09PSAwCiAgICAgICAgICAmJiBwWyg3ICogOCkgKyBjb2xdID09PSAwKSB7CiAgICAgICAgICB0ID0gKChkY3RTcXJ0MiAqIGRhdGFJbltpICsgMF0pICsgODE5MikgPj4gMTQ7CiAgICAgICAgICBwWygwICogOCkgKyBjb2xdID0gdDsKICAgICAgICAgIHBbKDEgKiA4KSArIGNvbF0gPSB0OwogICAgICAgICAgcFsoMiAqIDgpICsgY29sXSA9IHQ7CiAgICAgICAgICBwWygzICogOCkgKyBjb2xdID0gdDsKICAgICAgICAgIHBbKDQgKiA4KSArIGNvbF0gPSB0OwogICAgICAgICAgcFsoNSAqIDgpICsgY29sXSA9IHQ7CiAgICAgICAgICBwWyg2ICogOCkgKyBjb2xdID0gdDsKICAgICAgICAgIHBbKDcgKiA4KSArIGNvbF0gPSB0OwogICAgICAgICAgY29udGludWU7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tY29udGludWUKICAgICAgICB9CgogICAgICAgIC8vIHN0YWdlIDQKICAgICAgICB2MCA9ICgoZGN0U3FydDIgKiBwWygwICogOCkgKyBjb2xdKSArIDIwNDgpID4+IDEyOwogICAgICAgIHYxID0gKChkY3RTcXJ0MiAqIHBbKDQgKiA4KSArIGNvbF0pICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjIgPSBwWygyICogOCkgKyBjb2xdOwogICAgICAgIHYzID0gcFsoNiAqIDgpICsgY29sXTsKICAgICAgICB2NCA9ICgoZGN0U3FydDFkMiAqIChwWygxICogOCkgKyBjb2xdIC0gcFsoNyAqIDgpICsgY29sXSkpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjcgPSAoKGRjdFNxcnQxZDIgKiAocFsoMSAqIDgpICsgY29sXSArIHBbKDcgKiA4KSArIGNvbF0pKSArIDIwNDgpID4+IDEyOwogICAgICAgIHY1ID0gcFsoMyAqIDgpICsgY29sXTsKICAgICAgICB2NiA9IHBbKDUgKiA4KSArIGNvbF07CgogICAgICAgIC8vIHN0YWdlIDMKICAgICAgICB0ID0gKHYwIC0gdjEgKyAxKSA+PiAxOwogICAgICAgIHYwID0gKHYwICsgdjEgKyAxKSA+PiAxOwogICAgICAgIHYxID0gdDsKICAgICAgICB0ID0gKCh2MiAqIGRjdFNpbjYpICsgKHYzICogZGN0Q29zNikgKyAyMDQ4KSA+PiAxMjsKICAgICAgICB2MiA9ICgodjIgKiBkY3RDb3M2KSAtICh2MyAqIGRjdFNpbjYpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjMgPSB0OwogICAgICAgIHQgPSAodjQgLSB2NiArIDEpID4+IDE7CiAgICAgICAgdjQgPSAodjQgKyB2NiArIDEpID4+IDE7CiAgICAgICAgdjYgPSB0OwogICAgICAgIHQgPSAodjcgKyB2NSArIDEpID4+IDE7CiAgICAgICAgdjUgPSAodjcgLSB2NSArIDEpID4+IDE7CiAgICAgICAgdjcgPSB0OwoKICAgICAgICAvLyBzdGFnZSAyCiAgICAgICAgdCA9ICh2MCAtIHYzICsgMSkgPj4gMTsKICAgICAgICB2MCA9ICh2MCArIHYzICsgMSkgPj4gMTsKICAgICAgICB2MyA9IHQ7CiAgICAgICAgdCA9ICh2MSAtIHYyICsgMSkgPj4gMTsKICAgICAgICB2MSA9ICh2MSArIHYyICsgMSkgPj4gMTsKICAgICAgICB2MiA9IHQ7CiAgICAgICAgdCA9ICgodjQgKiBkY3RTaW4zKSArICh2NyAqIGRjdENvczMpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjQgPSAoKHY0ICogZGN0Q29zMykgLSAodjcgKiBkY3RTaW4zKSArIDIwNDgpID4+IDEyOwogICAgICAgIHY3ID0gdDsKICAgICAgICB0ID0gKCh2NSAqIGRjdFNpbjEpICsgKHY2ICogZGN0Q29zMSkgKyAyMDQ4KSA+PiAxMjsKICAgICAgICB2NSA9ICgodjUgKiBkY3RDb3MxKSAtICh2NiAqIGRjdFNpbjEpICsgMjA0OCkgPj4gMTI7CiAgICAgICAgdjYgPSB0OwoKICAgICAgICAvLyBzdGFnZSAxCiAgICAgICAgcFsoMCAqIDgpICsgY29sXSA9IHYwICsgdjc7CiAgICAgICAgcFsoNyAqIDgpICsgY29sXSA9IHYwIC0gdjc7CiAgICAgICAgcFsoMSAqIDgpICsgY29sXSA9IHYxICsgdjY7CiAgICAgICAgcFsoNiAqIDgpICsgY29sXSA9IHYxIC0gdjY7CiAgICAgICAgcFsoMiAqIDgpICsgY29sXSA9IHYyICsgdjU7CiAgICAgICAgcFsoNSAqIDgpICsgY29sXSA9IHYyIC0gdjU7CiAgICAgICAgcFsoMyAqIDgpICsgY29sXSA9IHYzICsgdjQ7CiAgICAgICAgcFsoNCAqIDgpICsgY29sXSA9IHYzIC0gdjQ7CiAgICAgIH0KCiAgICAgIC8vIGNvbnZlcnQgdG8gOC1iaXQgaW50ZWdlcnMKICAgICAgZm9yIChpID0gMDsgaSA8IDY0OyArK2kpIHsKICAgICAgICBjb25zdCBzYW1wbGUgPSAxMjggKyAoKHBbaV0gKyA4KSA+PiA0KTsKICAgICAgICBpZiAoc2FtcGxlIDwgMCkgewogICAgICAgICAgZGF0YU91dFtpXSA9IDA7CiAgICAgICAgfSBlbHNlIGlmIChzYW1wbGUgPiAwWEZGKSB7CiAgICAgICAgICBkYXRhT3V0W2ldID0gMHhGRjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YU91dFtpXSA9IHNhbXBsZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmb3IgKGxldCBibG9ja1JvdyA9IDA7IGJsb2NrUm93IDwgYmxvY2tzUGVyQ29sdW1uOyBibG9ja1JvdysrKSB7CiAgICAgIGNvbnN0IHNjYW5MaW5lID0gYmxvY2tSb3cgPDwgMzsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4OyBpKyspIHsKICAgICAgICBsaW5lcy5wdXNoKG5ldyBVaW50OEFycmF5KHNhbXBsZXNQZXJMaW5lKSk7CiAgICAgIH0KICAgICAgZm9yIChsZXQgYmxvY2tDb2wgPSAwOyBibG9ja0NvbCA8IGJsb2Nrc1BlckxpbmU7IGJsb2NrQ29sKyspIHsKICAgICAgICBxdWFudGl6ZUFuZEludmVyc2UoY29tcG9uZW50LmJsb2Nrc1tibG9ja1Jvd11bYmxvY2tDb2xdLCByLCBSKTsKCiAgICAgICAgbGV0IG9mZnNldCA9IDA7CiAgICAgICAgY29uc3Qgc2FtcGxlID0gYmxvY2tDb2wgPDwgMzsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDg7IGorKykgewogICAgICAgICAgY29uc3QgbGluZSA9IGxpbmVzW3NjYW5MaW5lICsgal07CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDg7IGkrKykgewogICAgICAgICAgICBsaW5lW3NhbXBsZSArIGldID0gcltvZmZzZXQrK107CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gbGluZXM7CiAgfQoKICBjbGFzcyBKcGVnU3RyZWFtUmVhZGVyIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmpmaWYgPSBudWxsOwogICAgICB0aGlzLmFkb2JlID0gbnVsbDsKCiAgICAgIHRoaXMucXVhbnRpemF0aW9uVGFibGVzID0gW107CiAgICAgIHRoaXMuaHVmZm1hblRhYmxlc0FDID0gW107CiAgICAgIHRoaXMuaHVmZm1hblRhYmxlc0RDID0gW107CiAgICAgIHRoaXMucmVzZXRGcmFtZXMoKTsKICAgIH0KCiAgICByZXNldEZyYW1lcygpIHsKICAgICAgdGhpcy5mcmFtZXMgPSBbXTsKICAgIH0KCiAgICBwYXJzZShkYXRhKSB7CiAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICAvLyBjb25zdCB7IGxlbmd0aCB9ID0gZGF0YTsKICAgICAgZnVuY3Rpb24gcmVhZFVpbnQxNigpIHsKICAgICAgICBjb25zdCB2YWx1ZSA9IChkYXRhW29mZnNldF0gPDwgOCkgfCBkYXRhW29mZnNldCArIDFdOwogICAgICAgIG9mZnNldCArPSAyOwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfQogICAgICBmdW5jdGlvbiByZWFkRGF0YUJsb2NrKCkgewogICAgICAgIGNvbnN0IGxlbmd0aCA9IHJlYWRVaW50MTYoKTsKICAgICAgICBjb25zdCBhcnJheSA9IGRhdGEuc3ViYXJyYXkob2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGggLSAyKTsKICAgICAgICBvZmZzZXQgKz0gYXJyYXkubGVuZ3RoOwogICAgICAgIHJldHVybiBhcnJheTsKICAgICAgfQogICAgICBmdW5jdGlvbiBwcmVwYXJlQ29tcG9uZW50cyhmcmFtZSkgewogICAgICAgIGxldCBtYXhIID0gMDsKICAgICAgICBsZXQgbWF4ViA9IDA7CiAgICAgICAgbGV0IGNvbXBvbmVudDsKICAgICAgICBsZXQgY29tcG9uZW50SWQ7CiAgICAgICAgZm9yIChjb21wb25lbnRJZCBpbiBmcmFtZS5jb21wb25lbnRzKSB7CiAgICAgICAgICBpZiAoZnJhbWUuY29tcG9uZW50cy5oYXNPd25Qcm9wZXJ0eShjb21wb25lbnRJZCkpIHsKICAgICAgICAgICAgY29tcG9uZW50ID0gZnJhbWUuY29tcG9uZW50c1tjb21wb25lbnRJZF07CiAgICAgICAgICAgIGlmIChtYXhIIDwgY29tcG9uZW50LmgpIHsKICAgICAgICAgICAgICBtYXhIID0gY29tcG9uZW50Lmg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1heFYgPCBjb21wb25lbnQudikgewogICAgICAgICAgICAgIG1heFYgPSBjb21wb25lbnQudjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBtY3VzUGVyTGluZSA9IE1hdGguY2VpbChmcmFtZS5zYW1wbGVzUGVyTGluZSAvIDggLyBtYXhIKTsKICAgICAgICBjb25zdCBtY3VzUGVyQ29sdW1uID0gTWF0aC5jZWlsKGZyYW1lLnNjYW5MaW5lcyAvIDggLyBtYXhWKTsKICAgICAgICBmb3IgKGNvbXBvbmVudElkIGluIGZyYW1lLmNvbXBvbmVudHMpIHsKICAgICAgICAgIGlmIChmcmFtZS5jb21wb25lbnRzLmhhc093blByb3BlcnR5KGNvbXBvbmVudElkKSkgewogICAgICAgICAgICBjb21wb25lbnQgPSBmcmFtZS5jb21wb25lbnRzW2NvbXBvbmVudElkXTsKICAgICAgICAgICAgY29uc3QgYmxvY2tzUGVyTGluZSA9IE1hdGguY2VpbChNYXRoLmNlaWwoZnJhbWUuc2FtcGxlc1BlckxpbmUgLyA4KSAqIGNvbXBvbmVudC5oIC8gbWF4SCk7CiAgICAgICAgICAgIGNvbnN0IGJsb2Nrc1BlckNvbHVtbiA9IE1hdGguY2VpbChNYXRoLmNlaWwoZnJhbWUuc2NhbkxpbmVzIC8gOCkgKiBjb21wb25lbnQudiAvIG1heFYpOwogICAgICAgICAgICBjb25zdCBibG9ja3NQZXJMaW5lRm9yTWN1ID0gbWN1c1BlckxpbmUgKiBjb21wb25lbnQuaDsKICAgICAgICAgICAgY29uc3QgYmxvY2tzUGVyQ29sdW1uRm9yTWN1ID0gbWN1c1BlckNvbHVtbiAqIGNvbXBvbmVudC52OwogICAgICAgICAgICBjb25zdCBibG9ja3MgPSBbXTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibG9ja3NQZXJDb2x1bW5Gb3JNY3U7IGkrKykgewogICAgICAgICAgICAgIGNvbnN0IHJvdyA9IFtdOwogICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYmxvY2tzUGVyTGluZUZvck1jdTsgaisrKSB7CiAgICAgICAgICAgICAgICByb3cucHVzaChuZXcgSW50MzJBcnJheSg2NCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBibG9ja3MucHVzaChyb3cpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lID0gYmxvY2tzUGVyTGluZTsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2Nrc1BlckNvbHVtbiA9IGJsb2Nrc1BlckNvbHVtbjsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2NrcyA9IGJsb2NrczsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnJhbWUubWF4SCA9IG1heEg7CiAgICAgICAgZnJhbWUubWF4ViA9IG1heFY7CiAgICAgICAgZnJhbWUubWN1c1BlckxpbmUgPSBtY3VzUGVyTGluZTsKICAgICAgICBmcmFtZS5tY3VzUGVyQ29sdW1uID0gbWN1c1BlckNvbHVtbjsKICAgICAgfQoKICAgICAgbGV0IGZpbGVNYXJrZXIgPSByZWFkVWludDE2KCk7CiAgICAgIGlmIChmaWxlTWFya2VyICE9PSAweEZGRDgpIHsgLy8gU09JIChTdGFydCBvZiBJbWFnZSkKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1NPSSBub3QgZm91bmQnKTsKICAgICAgfQoKICAgICAgZmlsZU1hcmtlciA9IHJlYWRVaW50MTYoKTsKICAgICAgd2hpbGUgKGZpbGVNYXJrZXIgIT09IDB4RkZEOSkgeyAvLyBFT0kgKEVuZCBvZiBpbWFnZSkKICAgICAgICBzd2l0Y2ggKGZpbGVNYXJrZXIpIHsKICAgICAgICAgIGNhc2UgMHhGRjAwOiBicmVhazsKICAgICAgICAgIGNhc2UgMHhGRkUwOiAvLyBBUFAwIChBcHBsaWNhdGlvbiBTcGVjaWZpYykKICAgICAgICAgIGNhc2UgMHhGRkUxOiAvLyBBUFAxCiAgICAgICAgICBjYXNlIDB4RkZFMjogLy8gQVBQMgogICAgICAgICAgY2FzZSAweEZGRTM6IC8vIEFQUDMKICAgICAgICAgIGNhc2UgMHhGRkU0OiAvLyBBUFA0CiAgICAgICAgICBjYXNlIDB4RkZFNTogLy8gQVBQNQogICAgICAgICAgY2FzZSAweEZGRTY6IC8vIEFQUDYKICAgICAgICAgIGNhc2UgMHhGRkU3OiAvLyBBUFA3CiAgICAgICAgICBjYXNlIDB4RkZFODogLy8gQVBQOAogICAgICAgICAgY2FzZSAweEZGRTk6IC8vIEFQUDkKICAgICAgICAgIGNhc2UgMHhGRkVBOiAvLyBBUFAxMAogICAgICAgICAgY2FzZSAweEZGRUI6IC8vIEFQUDExCiAgICAgICAgICBjYXNlIDB4RkZFQzogLy8gQVBQMTIKICAgICAgICAgIGNhc2UgMHhGRkVEOiAvLyBBUFAxMwogICAgICAgICAgY2FzZSAweEZGRUU6IC8vIEFQUDE0CiAgICAgICAgICBjYXNlIDB4RkZFRjogLy8gQVBQMTUKICAgICAgICAgIGNhc2UgMHhGRkZFOiB7IC8vIENPTSAoQ29tbWVudCkKICAgICAgICAgICAgY29uc3QgYXBwRGF0YSA9IHJlYWREYXRhQmxvY2soKTsKCiAgICAgICAgICAgIGlmIChmaWxlTWFya2VyID09PSAweEZGRTApIHsKICAgICAgICAgICAgICBpZiAoYXBwRGF0YVswXSA9PT0gMHg0QSAmJiBhcHBEYXRhWzFdID09PSAweDQ2ICYmIGFwcERhdGFbMl0gPT09IDB4NDkKICAgICAgICAgICAgICAgICYmIGFwcERhdGFbM10gPT09IDB4NDYgJiYgYXBwRGF0YVs0XSA9PT0gMCkgeyAvLyAnSkZJRlx4MDAnCiAgICAgICAgICAgICAgICB0aGlzLmpmaWYgPSB7CiAgICAgICAgICAgICAgICAgIHZlcnNpb246IHsgbWFqb3I6IGFwcERhdGFbNV0sIG1pbm9yOiBhcHBEYXRhWzZdIH0sCiAgICAgICAgICAgICAgICAgIGRlbnNpdHlVbml0czogYXBwRGF0YVs3XSwKICAgICAgICAgICAgICAgICAgeERlbnNpdHk6IChhcHBEYXRhWzhdIDw8IDgpIHwgYXBwRGF0YVs5XSwKICAgICAgICAgICAgICAgICAgeURlbnNpdHk6IChhcHBEYXRhWzEwXSA8PCA4KSB8IGFwcERhdGFbMTFdLAogICAgICAgICAgICAgICAgICB0aHVtYldpZHRoOiBhcHBEYXRhWzEyXSwKICAgICAgICAgICAgICAgICAgdGh1bWJIZWlnaHQ6IGFwcERhdGFbMTNdLAogICAgICAgICAgICAgICAgICB0aHVtYkRhdGE6IGFwcERhdGEuc3ViYXJyYXkoMTQsIDE0ICsgKDMgKiBhcHBEYXRhWzEyXSAqIGFwcERhdGFbMTNdKSksCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBUT0RPIEFQUDEgLSBFeGlmCiAgICAgICAgICAgIGlmIChmaWxlTWFya2VyID09PSAweEZGRUUpIHsKICAgICAgICAgICAgICBpZiAoYXBwRGF0YVswXSA9PT0gMHg0MSAmJiBhcHBEYXRhWzFdID09PSAweDY0ICYmIGFwcERhdGFbMl0gPT09IDB4NkYKICAgICAgICAgICAgICAgICYmIGFwcERhdGFbM10gPT09IDB4NjIgJiYgYXBwRGF0YVs0XSA9PT0gMHg2NSAmJiBhcHBEYXRhWzVdID09PSAwKSB7IC8vICdBZG9iZVx4MDAnCiAgICAgICAgICAgICAgICB0aGlzLmFkb2JlID0gewogICAgICAgICAgICAgICAgICB2ZXJzaW9uOiBhcHBEYXRhWzZdLAogICAgICAgICAgICAgICAgICBmbGFnczA6IChhcHBEYXRhWzddIDw8IDgpIHwgYXBwRGF0YVs4XSwKICAgICAgICAgICAgICAgICAgZmxhZ3MxOiAoYXBwRGF0YVs5XSA8PCA4KSB8IGFwcERhdGFbMTBdLAogICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1Db2RlOiBhcHBEYXRhWzExXSwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgMHhGRkRCOiB7IC8vIERRVCAoRGVmaW5lIFF1YW50aXphdGlvbiBUYWJsZXMpCiAgICAgICAgICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlc0xlbmd0aCA9IHJlYWRVaW50MTYoKTsKICAgICAgICAgICAgY29uc3QgcXVhbnRpemF0aW9uVGFibGVzRW5kID0gcXVhbnRpemF0aW9uVGFibGVzTGVuZ3RoICsgb2Zmc2V0IC0gMjsKICAgICAgICAgICAgd2hpbGUgKG9mZnNldCA8IHF1YW50aXphdGlvblRhYmxlc0VuZCkgewogICAgICAgICAgICAgIGNvbnN0IHF1YW50aXphdGlvblRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICAgIGNvbnN0IHRhYmxlRGF0YSA9IG5ldyBJbnQzMkFycmF5KDY0KTsKICAgICAgICAgICAgICBpZiAoKHF1YW50aXphdGlvblRhYmxlU3BlYyA+PiA0KSA9PT0gMCkgeyAvLyA4IGJpdCB2YWx1ZXMKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgNjQ7IGorKykgewogICAgICAgICAgICAgICAgICBjb25zdCB6ID0gZGN0WmlnWmFnW2pdOwogICAgICAgICAgICAgICAgICB0YWJsZURhdGFbel0gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKChxdWFudGl6YXRpb25UYWJsZVNwZWMgPj4gNCkgPT09IDEpIHsgLy8gMTYgYml0CiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDY0OyBqKyspIHsKICAgICAgICAgICAgICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1tqXTsKICAgICAgICAgICAgICAgICAgdGFibGVEYXRhW3pdID0gcmVhZFVpbnQxNigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RRVDogaW52YWxpZCB0YWJsZSBzcGVjJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMucXVhbnRpemF0aW9uVGFibGVzW3F1YW50aXphdGlvblRhYmxlU3BlYyAmIDE1XSA9IHRhYmxlRGF0YTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlIDB4RkZDMDogLy8gU09GMCAoU3RhcnQgb2YgRnJhbWUsIEJhc2VsaW5lIERDVCkKICAgICAgICAgIGNhc2UgMHhGRkMxOiAvLyBTT0YxIChTdGFydCBvZiBGcmFtZSwgRXh0ZW5kZWQgRENUKQogICAgICAgICAgY2FzZSAweEZGQzI6IHsgLy8gU09GMiAoU3RhcnQgb2YgRnJhbWUsIFByb2dyZXNzaXZlIERDVCkKICAgICAgICAgICAgcmVhZFVpbnQxNigpOyAvLyBza2lwIGRhdGEgbGVuZ3RoCiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gewogICAgICAgICAgICAgIGV4dGVuZGVkOiAoZmlsZU1hcmtlciA9PT0gMHhGRkMxKSwKICAgICAgICAgICAgICBwcm9ncmVzc2l2ZTogKGZpbGVNYXJrZXIgPT09IDB4RkZDMiksCiAgICAgICAgICAgICAgcHJlY2lzaW9uOiBkYXRhW29mZnNldCsrXSwKICAgICAgICAgICAgICBzY2FuTGluZXM6IHJlYWRVaW50MTYoKSwKICAgICAgICAgICAgICBzYW1wbGVzUGVyTGluZTogcmVhZFVpbnQxNigpLAogICAgICAgICAgICAgIGNvbXBvbmVudHM6IHt9LAogICAgICAgICAgICAgIGNvbXBvbmVudHNPcmRlcjogW10sCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBjb25zdCBjb21wb25lbnRzQ291bnQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgbGV0IGNvbXBvbmVudElkOwogICAgICAgICAgICAvLyBsZXQgbWF4SCA9IDA7CiAgICAgICAgICAgIC8vIGxldCBtYXhWID0gMDsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21wb25lbnRzQ291bnQ7IGkrKykgewogICAgICAgICAgICAgIGNvbXBvbmVudElkID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICAgIGNvbnN0IGggPSBkYXRhW29mZnNldCArIDFdID4+IDQ7CiAgICAgICAgICAgICAgY29uc3QgdiA9IGRhdGFbb2Zmc2V0ICsgMV0gJiAxNTsKICAgICAgICAgICAgICBjb25zdCBxSWQgPSBkYXRhW29mZnNldCArIDJdOwogICAgICAgICAgICAgIGZyYW1lLmNvbXBvbmVudHNPcmRlci5wdXNoKGNvbXBvbmVudElkKTsKICAgICAgICAgICAgICBmcmFtZS5jb21wb25lbnRzW2NvbXBvbmVudElkXSA9IHsKICAgICAgICAgICAgICAgIGgsCiAgICAgICAgICAgICAgICB2LAogICAgICAgICAgICAgICAgcXVhbnRpemF0aW9uSWR4OiBxSWQsCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBvZmZzZXQgKz0gMzsKICAgICAgICAgICAgfQogICAgICAgICAgICBwcmVwYXJlQ29tcG9uZW50cyhmcmFtZSk7CiAgICAgICAgICAgIHRoaXMuZnJhbWVzLnB1c2goZnJhbWUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBjYXNlIDB4RkZDNDogeyAvLyBESFQgKERlZmluZSBIdWZmbWFuIFRhYmxlcykKICAgICAgICAgICAgY29uc3QgaHVmZm1hbkxlbmd0aCA9IHJlYWRVaW50MTYoKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDI7IGkgPCBodWZmbWFuTGVuZ3RoOykgewogICAgICAgICAgICAgIGNvbnN0IGh1ZmZtYW5UYWJsZVNwZWMgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgICBjb25zdCBjb2RlTGVuZ3RocyA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgICAgICAgICAgICBsZXQgY29kZUxlbmd0aFN1bSA9IDA7CiAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgaisrLCBvZmZzZXQrKykgewogICAgICAgICAgICAgICAgY29kZUxlbmd0aHNbal0gPSBkYXRhW29mZnNldF07CiAgICAgICAgICAgICAgICBjb2RlTGVuZ3RoU3VtICs9IGNvZGVMZW5ndGhzW2pdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBodWZmbWFuVmFsdWVzID0gbmV3IFVpbnQ4QXJyYXkoY29kZUxlbmd0aFN1bSk7CiAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjb2RlTGVuZ3RoU3VtOyBqKyssIG9mZnNldCsrKSB7CiAgICAgICAgICAgICAgICBodWZmbWFuVmFsdWVzW2pdID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpICs9IDE3ICsgY29kZUxlbmd0aFN1bTsKCiAgICAgICAgICAgICAgaWYgKChodWZmbWFuVGFibGVTcGVjID4+IDQpID09PSAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLmh1ZmZtYW5UYWJsZXNEQ1todWZmbWFuVGFibGVTcGVjICYgMTVdID0gYnVpbGRIdWZmbWFuVGFibGUoCiAgICAgICAgICAgICAgICAgIGNvZGVMZW5ndGhzLCBodWZmbWFuVmFsdWVzLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5odWZmbWFuVGFibGVzQUNbaHVmZm1hblRhYmxlU3BlYyAmIDE1XSA9IGJ1aWxkSHVmZm1hblRhYmxlKAogICAgICAgICAgICAgICAgICBjb2RlTGVuZ3RocywgaHVmZm1hblZhbHVlcywKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGNhc2UgMHhGRkREOiAvLyBEUkkgKERlZmluZSBSZXN0YXJ0IEludGVydmFsKQogICAgICAgICAgICByZWFkVWludDE2KCk7IC8vIHNraXAgZGF0YSBsZW5ndGgKICAgICAgICAgICAgdGhpcy5yZXNldEludGVydmFsID0gcmVhZFVpbnQxNigpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDB4RkZEQTogeyAvLyBTT1MgKFN0YXJ0IG9mIFNjYW4pCiAgICAgICAgICAgIHJlYWRVaW50MTYoKTsgLy8gc2tpcCBsZW5ndGgKICAgICAgICAgICAgY29uc3Qgc2VsZWN0b3JzQ291bnQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3QgY29tcG9uZW50cyA9IFtdOwogICAgICAgICAgICBjb25zdCBmcmFtZSA9IHRoaXMuZnJhbWVzWzBdOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNlbGVjdG9yc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSBmcmFtZS5jb21wb25lbnRzW2RhdGFbb2Zmc2V0KytdXTsKICAgICAgICAgICAgICBjb25zdCB0YWJsZVNwZWMgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgICBjb21wb25lbnQuaHVmZm1hblRhYmxlREMgPSB0aGlzLmh1ZmZtYW5UYWJsZXNEQ1t0YWJsZVNwZWMgPj4gNF07CiAgICAgICAgICAgICAgY29tcG9uZW50Lmh1ZmZtYW5UYWJsZUFDID0gdGhpcy5odWZmbWFuVGFibGVzQUNbdGFibGVTcGVjICYgMTVdOwogICAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChjb21wb25lbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHNwZWN0cmFsU3RhcnQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3Qgc3BlY3RyYWxFbmQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3Qgc3VjY2Vzc2l2ZUFwcHJveGltYXRpb24gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkID0gZGVjb2RlU2NhbihkYXRhLCBvZmZzZXQsCiAgICAgICAgICAgICAgZnJhbWUsIGNvbXBvbmVudHMsIHRoaXMucmVzZXRJbnRlcnZhbCwKICAgICAgICAgICAgICBzcGVjdHJhbFN0YXJ0LCBzcGVjdHJhbEVuZCwKICAgICAgICAgICAgICBzdWNjZXNzaXZlQXBwcm94aW1hdGlvbiA+PiA0LCBzdWNjZXNzaXZlQXBwcm94aW1hdGlvbiAmIDE1KTsKICAgICAgICAgICAgb2Zmc2V0ICs9IHByb2Nlc3NlZDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAweEZGRkY6IC8vIEZpbGwgYnl0ZXMKICAgICAgICAgICAgaWYgKGRhdGFbb2Zmc2V0XSAhPT0gMHhGRikgeyAvLyBBdm9pZCBza2lwcGluZyBhIHZhbGlkIG1hcmtlci4KICAgICAgICAgICAgICBvZmZzZXQtLTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBpZiAoZGF0YVtvZmZzZXQgLSAzXSA9PT0gMHhGRgogICAgICAgICAgICAgICYmIGRhdGFbb2Zmc2V0IC0gMl0gPj0gMHhDMCAmJiBkYXRhW29mZnNldCAtIDJdIDw9IDB4RkUpIHsKICAgICAgICAgICAgICAvLyBjb3VsZCBiZSBpbmNvcnJlY3QgZW5jb2RpbmcgLS0gbGFzdCAweEZGIGJ5dGUgb2YgdGhlIHByZXZpb3VzCiAgICAgICAgICAgICAgLy8gYmxvY2sgd2FzIGVhdGVuIGJ5IHRoZSBlbmNvZGVyCiAgICAgICAgICAgICAgb2Zmc2V0IC09IDM7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGB1bmtub3duIEpQRUcgbWFya2VyICR7ZmlsZU1hcmtlci50b1N0cmluZygxNil9YCk7CiAgICAgICAgfQogICAgICAgIGZpbGVNYXJrZXIgPSByZWFkVWludDE2KCk7CiAgICAgIH0KICAgIH0KCiAgICBnZXRSZXN1bHQoKSB7CiAgICAgIGNvbnN0IHsgZnJhbWVzIH0gPSB0aGlzOwogICAgICBpZiAodGhpcy5mcmFtZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdubyBmcmFtZXMgd2VyZSBkZWNvZGVkJyk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5mcmFtZXMubGVuZ3RoID4gMSkgewogICAgICAgIGNvbnNvbGUud2FybignbW9yZSB0aGFuIG9uZSBmcmFtZSBpcyBub3Qgc3VwcG9ydGVkJyk7CiAgICAgIH0KCiAgICAgIC8vIHNldCBlYWNoIGZyYW1lJ3MgY29tcG9uZW50cyBxdWFudGl6YXRpb24gdGFibGUKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmZyYW1lcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGNwID0gdGhpcy5mcmFtZXNbaV0uY29tcG9uZW50czsKICAgICAgICBmb3IgKGNvbnN0IGogb2YgT2JqZWN0LmtleXMoY3ApKSB7CiAgICAgICAgICBjcFtqXS5xdWFudGl6YXRpb25UYWJsZSA9IHRoaXMucXVhbnRpemF0aW9uVGFibGVzW2NwW2pdLnF1YW50aXphdGlvbklkeF07CiAgICAgICAgICBkZWxldGUgY3Bbal0ucXVhbnRpemF0aW9uSWR4OwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgZnJhbWUgPSBmcmFtZXNbMF07CiAgICAgIGNvbnN0IHsgY29tcG9uZW50cywgY29tcG9uZW50c09yZGVyIH0gPSBmcmFtZTsKICAgICAgY29uc3Qgb3V0Q29tcG9uZW50cyA9IFtdOwogICAgICBjb25zdCB3aWR0aCA9IGZyYW1lLnNhbXBsZXNQZXJMaW5lOwogICAgICBjb25zdCBoZWlnaHQgPSBmcmFtZS5zY2FuTGluZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbXBvbmVudHNPcmRlci5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IGNvbXBvbmVudHNbY29tcG9uZW50c09yZGVyW2ldXTsKICAgICAgICBvdXRDb21wb25lbnRzLnB1c2goewogICAgICAgICAgbGluZXM6IGJ1aWxkQ29tcG9uZW50RGF0YShmcmFtZSwgY29tcG9uZW50KSwKICAgICAgICAgIHNjYWxlWDogY29tcG9uZW50LmggLyBmcmFtZS5tYXhILAogICAgICAgICAgc2NhbGVZOiBjb21wb25lbnQudiAvIGZyYW1lLm1heFYsCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG91dCA9IG5ldyBVaW50OEFycmF5KHdpZHRoICogaGVpZ2h0ICogb3V0Q29tcG9uZW50cy5sZW5ndGgpOwogICAgICBsZXQgb2kgPSAwOwogICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgKyt5KSB7CiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgKyt4KSB7CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG91dENvbXBvbmVudHMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gb3V0Q29tcG9uZW50c1tpXTsKICAgICAgICAgICAgb3V0W29pXSA9IGNvbXBvbmVudC5saW5lc1swIHwgeSAqIGNvbXBvbmVudC5zY2FsZVldWzAgfCB4ICogY29tcG9uZW50LnNjYWxlWF07CiAgICAgICAgICAgICsrb2k7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgfQoKICBjbGFzcyBKcGVnRGVjb2RlciBleHRlbmRzIEJhc2VEZWNvZGVyIHsKICAgIGNvbnN0cnVjdG9yKGZpbGVEaXJlY3RvcnkpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5yZWFkZXIgPSBuZXcgSnBlZ1N0cmVhbVJlYWRlcigpOwogICAgICBpZiAoZmlsZURpcmVjdG9yeS5KUEVHVGFibGVzKSB7CiAgICAgICAgdGhpcy5yZWFkZXIucGFyc2UoZmlsZURpcmVjdG9yeS5KUEVHVGFibGVzKTsKICAgICAgfQogICAgfQoKICAgIGRlY29kZUJsb2NrKGJ1ZmZlcikgewogICAgICB0aGlzLnJlYWRlci5yZXNldEZyYW1lcygpOwogICAgICB0aGlzLnJlYWRlci5wYXJzZShuZXcgVWludDhBcnJheShidWZmZXIpKTsKICAgICAgcmV0dXJuIHRoaXMucmVhZGVyLmdldFJlc3VsdCgpLmJ1ZmZlcjsKICAgIH0KICB9CgogIC8qISBwYWtvIDIuMC40IGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlY2EvcGFrbyBAbGljZW5zZSAoTUlUIEFORCBabGliKSAqLwogIC8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgogIC8vIChDKSAyMDE0LTIwMTcgVml0YWx5IFB1enJpbiBhbmQgQW5kcmV5IFR1cGl0c2luCiAgLy8KICAvLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAogIC8vIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcwogIC8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCiAgLy8KICAvLyBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSwKICAvLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0CiAgLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgogIC8vCiAgLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKICAvLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCiAgLy8gICBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmUKICAvLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCiAgLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKICAvLyAgIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4KICAvLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKICAvKiBlc2xpbnQtZGlzYWJsZSBzcGFjZS11bmFyeS1vcHMgKi8KCiAgLyogUHVibGljIGNvbnN0YW50cyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCiAgLy9jb25zdCBaX0ZJTFRFUkVEICAgICAgICAgID0gMTsKICAvL2NvbnN0IFpfSFVGRk1BTl9PTkxZICAgICAgPSAyOwogIC8vY29uc3QgWl9STEUgICAgICAgICAgICAgICA9IDM7CiAgY29uc3QgWl9GSVhFRCQxICAgICAgICAgICAgICAgPSA0OwogIC8vY29uc3QgWl9ERUZBVUxUX1NUUkFURUdZICA9IDA7CgogIC8qIFBvc3NpYmxlIHZhbHVlcyBvZiB0aGUgZGF0YV90eXBlIGZpZWxkICh0aG91Z2ggc2VlIGluZmxhdGUoKSkgKi8KICBjb25zdCBaX0JJTkFSWSAgICAgICAgICAgICAgPSAwOwogIGNvbnN0IFpfVEVYVCAgICAgICAgICAgICAgICA9IDE7CiAgLy9jb25zdCBaX0FTQ0lJICAgICAgICAgICAgID0gMTsgLy8gPSBaX1RFWFQKICBjb25zdCBaX1VOS05PV04kMSAgICAgICAgICAgICA9IDI7CgogIC8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgoKICBmdW5jdGlvbiB6ZXJvJDEoYnVmKSB7IGxldCBsZW4gPSBidWYubGVuZ3RoOyB3aGlsZSAoLS1sZW4gPj0gMCkgeyBidWZbbGVuXSA9IDA7IH0gfQoKICAvLyBGcm9tIHp1dGlsLmgKCiAgY29uc3QgU1RPUkVEX0JMT0NLID0gMDsKICBjb25zdCBTVEFUSUNfVFJFRVMgPSAxOwogIGNvbnN0IERZTl9UUkVFUyAgICA9IDI7CiAgLyogVGhlIHRocmVlIGtpbmRzIG9mIGJsb2NrIHR5cGUgKi8KCiAgY29uc3QgTUlOX01BVENIJDEgICAgPSAzOwogIGNvbnN0IE1BWF9NQVRDSCQxICAgID0gMjU4OwogIC8qIFRoZSBtaW5pbXVtIGFuZCBtYXhpbXVtIG1hdGNoIGxlbmd0aHMgKi8KCiAgLy8gRnJvbSBkZWZsYXRlLmgKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBJbnRlcm5hbCBjb21wcmVzc2lvbiBzdGF0ZS4KICAgKi8KCiAgY29uc3QgTEVOR1RIX0NPREVTJDEgID0gMjk7CiAgLyogbnVtYmVyIG9mIGxlbmd0aCBjb2Rlcywgbm90IGNvdW50aW5nIHRoZSBzcGVjaWFsIEVORF9CTE9DSyBjb2RlICovCgogIGNvbnN0IExJVEVSQUxTJDEgICAgICA9IDI1NjsKICAvKiBudW1iZXIgb2YgbGl0ZXJhbCBieXRlcyAwLi4yNTUgKi8KCiAgY29uc3QgTF9DT0RFUyQxICAgICAgID0gTElURVJBTFMkMSArIDEgKyBMRU5HVEhfQ09ERVMkMTsKICAvKiBudW1iZXIgb2YgTGl0ZXJhbCBvciBMZW5ndGggY29kZXMsIGluY2x1ZGluZyB0aGUgRU5EX0JMT0NLIGNvZGUgKi8KCiAgY29uc3QgRF9DT0RFUyQxICAgICAgID0gMzA7CiAgLyogbnVtYmVyIG9mIGRpc3RhbmNlIGNvZGVzICovCgogIGNvbnN0IEJMX0NPREVTJDEgICAgICA9IDE5OwogIC8qIG51bWJlciBvZiBjb2RlcyB1c2VkIHRvIHRyYW5zZmVyIHRoZSBiaXQgbGVuZ3RocyAqLwoKICBjb25zdCBIRUFQX1NJWkUkMSAgICAgPSAyICogTF9DT0RFUyQxICsgMTsKICAvKiBtYXhpbXVtIGhlYXAgc2l6ZSAqLwoKICBjb25zdCBNQVhfQklUUyQxICAgICAgPSAxNTsKICAvKiBBbGwgY29kZXMgbXVzdCBub3QgZXhjZWVkIE1BWF9CSVRTIGJpdHMgKi8KCiAgY29uc3QgQnVmX3NpemUgICAgICA9IDE2OwogIC8qIHNpemUgb2YgYml0IGJ1ZmZlciBpbiBiaV9idWYgKi8KCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIENvbnN0YW50cwogICAqLwoKICBjb25zdCBNQVhfQkxfQklUUyA9IDc7CiAgLyogQml0IGxlbmd0aCBjb2RlcyBtdXN0IG5vdCBleGNlZWQgTUFYX0JMX0JJVFMgYml0cyAqLwoKICBjb25zdCBFTkRfQkxPQ0sgICA9IDI1NjsKICAvKiBlbmQgb2YgYmxvY2sgbGl0ZXJhbCBjb2RlICovCgogIGNvbnN0IFJFUF8zXzYgICAgID0gMTY7CiAgLyogcmVwZWF0IHByZXZpb3VzIGJpdCBsZW5ndGggMy02IHRpbWVzICgyIGJpdHMgb2YgcmVwZWF0IGNvdW50KSAqLwoKICBjb25zdCBSRVBaXzNfMTAgICA9IDE3OwogIC8qIHJlcGVhdCBhIHplcm8gbGVuZ3RoIDMtMTAgdGltZXMgICgzIGJpdHMgb2YgcmVwZWF0IGNvdW50KSAqLwoKICBjb25zdCBSRVBaXzExXzEzOCA9IDE4OwogIC8qIHJlcGVhdCBhIHplcm8gbGVuZ3RoIDExLTEzOCB0aW1lcyAgKDcgYml0cyBvZiByZXBlYXQgY291bnQpICovCgogIC8qIGVzbGludC1kaXNhYmxlIGNvbW1hLXNwYWNpbmcsYXJyYXktYnJhY2tldC1zcGFjaW5nICovCiAgY29uc3QgZXh0cmFfbGJpdHMgPSAgIC8qIGV4dHJhIGJpdHMgZm9yIGVhY2ggbGVuZ3RoIGNvZGUgKi8KICAgIG5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMSwxLDEsMSwyLDIsMiwyLDMsMywzLDMsNCw0LDQsNCw1LDUsNSw1LDBdKTsKCiAgY29uc3QgZXh0cmFfZGJpdHMgPSAgIC8qIGV4dHJhIGJpdHMgZm9yIGVhY2ggZGlzdGFuY2UgY29kZSAqLwogICAgbmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMSwxLDIsMiwzLDMsNCw0LDUsNSw2LDYsNyw3LDgsOCw5LDksMTAsMTAsMTEsMTEsMTIsMTIsMTMsMTNdKTsKCiAgY29uc3QgZXh0cmFfYmxiaXRzID0gIC8qIGV4dHJhIGJpdHMgZm9yIGVhY2ggYml0IGxlbmd0aCBjb2RlICovCiAgICBuZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyLDMsN10pOwoKICBjb25zdCBibF9vcmRlciA9CiAgICBuZXcgVWludDhBcnJheShbMTYsMTcsMTgsMCw4LDcsOSw2LDEwLDUsMTEsNCwxMiwzLDEzLDIsMTQsMSwxNV0pOwogIC8qIGVzbGludC1lbmFibGUgY29tbWEtc3BhY2luZyxhcnJheS1icmFja2V0LXNwYWNpbmcgKi8KCiAgLyogVGhlIGxlbmd0aHMgb2YgdGhlIGJpdCBsZW5ndGggY29kZXMgYXJlIHNlbnQgaW4gb3JkZXIgb2YgZGVjcmVhc2luZwogICAqIHByb2JhYmlsaXR5LCB0byBhdm9pZCB0cmFuc21pdHRpbmcgdGhlIGxlbmd0aHMgZm9yIHVudXNlZCBiaXQgbGVuZ3RoIGNvZGVzLgogICAqLwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBMb2NhbCBkYXRhLiBUaGVzZSBhcmUgaW5pdGlhbGl6ZWQgb25seSBvbmNlLgogICAqLwoKICAvLyBXZSBwcmUtZmlsbCBhcnJheXMgd2l0aCAwIHRvIGF2b2lkIHVuaW5pdGlhbGl6ZWQgZ2FwcwoKICBjb25zdCBESVNUX0NPREVfTEVOID0gNTEyOyAvKiBzZWUgZGVmaW5pdGlvbiBvZiBhcnJheSBkaXN0X2NvZGUgYmVsb3cgKi8KCiAgLy8gISEhISBVc2UgZmxhdCBhcnJheSBpbnN0ZWFkIG9mIHN0cnVjdHVyZSwgRnJlcSA9IGkqMiwgTGVuID0gaSoyKzEKICBjb25zdCBzdGF0aWNfbHRyZWUgID0gbmV3IEFycmF5KChMX0NPREVTJDEgKyAyKSAqIDIpOwogIHplcm8kMShzdGF0aWNfbHRyZWUpOwogIC8qIFRoZSBzdGF0aWMgbGl0ZXJhbCB0cmVlLiBTaW5jZSB0aGUgYml0IGxlbmd0aHMgYXJlIGltcG9zZWQsIHRoZXJlIGlzIG5vCiAgICogbmVlZCBmb3IgdGhlIExfQ09ERVMgZXh0cmEgY29kZXMgdXNlZCBkdXJpbmcgaGVhcCBjb25zdHJ1Y3Rpb24uIEhvd2V2ZXIKICAgKiBUaGUgY29kZXMgMjg2IGFuZCAyODcgYXJlIG5lZWRlZCB0byBidWlsZCBhIGNhbm9uaWNhbCB0cmVlIChzZWUgX3RyX2luaXQKICAgKiBiZWxvdykuCiAgICovCgogIGNvbnN0IHN0YXRpY19kdHJlZSAgPSBuZXcgQXJyYXkoRF9DT0RFUyQxICogMik7CiAgemVybyQxKHN0YXRpY19kdHJlZSk7CiAgLyogVGhlIHN0YXRpYyBkaXN0YW5jZSB0cmVlLiAoQWN0dWFsbHkgYSB0cml2aWFsIHRyZWUgc2luY2UgYWxsIGNvZGVzIHVzZQogICAqIDUgYml0cy4pCiAgICovCgogIGNvbnN0IF9kaXN0X2NvZGUgICAgPSBuZXcgQXJyYXkoRElTVF9DT0RFX0xFTik7CiAgemVybyQxKF9kaXN0X2NvZGUpOwogIC8qIERpc3RhbmNlIGNvZGVzLiBUaGUgZmlyc3QgMjU2IHZhbHVlcyBjb3JyZXNwb25kIHRvIHRoZSBkaXN0YW5jZXMKICAgKiAzIC4uIDI1OCwgdGhlIGxhc3QgMjU2IHZhbHVlcyBjb3JyZXNwb25kIHRvIHRoZSB0b3AgOCBiaXRzIG9mCiAgICogdGhlIDE1IGJpdCBkaXN0YW5jZXMuCiAgICovCgogIGNvbnN0IF9sZW5ndGhfY29kZSAgPSBuZXcgQXJyYXkoTUFYX01BVENIJDEgLSBNSU5fTUFUQ0gkMSArIDEpOwogIHplcm8kMShfbGVuZ3RoX2NvZGUpOwogIC8qIGxlbmd0aCBjb2RlIGZvciBlYWNoIG5vcm1hbGl6ZWQgbWF0Y2ggbGVuZ3RoICgwID09IE1JTl9NQVRDSCkgKi8KCiAgY29uc3QgYmFzZV9sZW5ndGggICA9IG5ldyBBcnJheShMRU5HVEhfQ09ERVMkMSk7CiAgemVybyQxKGJhc2VfbGVuZ3RoKTsKICAvKiBGaXJzdCBub3JtYWxpemVkIGxlbmd0aCBmb3IgZWFjaCBjb2RlICgwID0gTUlOX01BVENIKSAqLwoKICBjb25zdCBiYXNlX2Rpc3QgICAgID0gbmV3IEFycmF5KERfQ09ERVMkMSk7CiAgemVybyQxKGJhc2VfZGlzdCk7CiAgLyogRmlyc3Qgbm9ybWFsaXplZCBkaXN0YW5jZSBmb3IgZWFjaCBjb2RlICgwID0gZGlzdGFuY2Ugb2YgMSkgKi8KCgogIGZ1bmN0aW9uIFN0YXRpY1RyZWVEZXNjKHN0YXRpY190cmVlLCBleHRyYV9iaXRzLCBleHRyYV9iYXNlLCBlbGVtcywgbWF4X2xlbmd0aCkgewoKICAgIHRoaXMuc3RhdGljX3RyZWUgID0gc3RhdGljX3RyZWU7ICAvKiBzdGF0aWMgdHJlZSBvciBOVUxMICovCiAgICB0aGlzLmV4dHJhX2JpdHMgICA9IGV4dHJhX2JpdHM7ICAgLyogZXh0cmEgYml0cyBmb3IgZWFjaCBjb2RlIG9yIE5VTEwgKi8KICAgIHRoaXMuZXh0cmFfYmFzZSAgID0gZXh0cmFfYmFzZTsgICAvKiBiYXNlIGluZGV4IGZvciBleHRyYV9iaXRzICovCiAgICB0aGlzLmVsZW1zICAgICAgICA9IGVsZW1zOyAgICAgICAgLyogbWF4IG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgdHJlZSAqLwogICAgdGhpcy5tYXhfbGVuZ3RoICAgPSBtYXhfbGVuZ3RoOyAgIC8qIG1heCBiaXQgbGVuZ3RoIGZvciB0aGUgY29kZXMgKi8KCiAgICAvLyBzaG93IGlmIGBzdGF0aWNfdHJlZWAgaGFzIGRhdGEgb3IgZHVtbXkgLSBuZWVkZWQgZm9yIG1vbm9tb3JwaGljIG9iamVjdHMKICAgIHRoaXMuaGFzX3N0cmVlICAgID0gc3RhdGljX3RyZWUgJiYgc3RhdGljX3RyZWUubGVuZ3RoOwogIH0KCgogIGxldCBzdGF0aWNfbF9kZXNjOwogIGxldCBzdGF0aWNfZF9kZXNjOwogIGxldCBzdGF0aWNfYmxfZGVzYzsKCgogIGZ1bmN0aW9uIFRyZWVEZXNjKGR5bl90cmVlLCBzdGF0X2Rlc2MpIHsKICAgIHRoaXMuZHluX3RyZWUgPSBkeW5fdHJlZTsgICAgIC8qIHRoZSBkeW5hbWljIHRyZWUgKi8KICAgIHRoaXMubWF4X2NvZGUgPSAwOyAgICAgICAgICAgIC8qIGxhcmdlc3QgY29kZSB3aXRoIG5vbiB6ZXJvIGZyZXF1ZW5jeSAqLwogICAgdGhpcy5zdGF0X2Rlc2MgPSBzdGF0X2Rlc2M7ICAgLyogdGhlIGNvcnJlc3BvbmRpbmcgc3RhdGljIHRyZWUgKi8KICB9CgoKCiAgY29uc3QgZF9jb2RlID0gKGRpc3QpID0+IHsKCiAgICByZXR1cm4gZGlzdCA8IDI1NiA/IF9kaXN0X2NvZGVbZGlzdF0gOiBfZGlzdF9jb2RlWzI1NiArIChkaXN0ID4+PiA3KV07CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIE91dHB1dCBhIHNob3J0IExTQiBmaXJzdCBvbiB0aGUgc3RyZWFtLgogICAqIElOIGFzc2VydGlvbjogdGhlcmUgaXMgZW5vdWdoIHJvb20gaW4gcGVuZGluZ0J1Zi4KICAgKi8KICBjb25zdCBwdXRfc2hvcnQgPSAocywgdykgPT4gewogIC8vICAgIHB1dF9ieXRlKHMsICh1Y2gpKCh3KSAmIDB4ZmYpKTsKICAvLyAgICBwdXRfYnl0ZShzLCAodWNoKSgodXNoKSh3KSA+PiA4KSk7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9ICh3KSAmIDB4ZmY7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9ICh3ID4+PiA4KSAmIDB4ZmY7CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFNlbmQgYSB2YWx1ZSBvbiBhIGdpdmVuIG51bWJlciBvZiBiaXRzLgogICAqIElOIGFzc2VydGlvbjogbGVuZ3RoIDw9IDE2IGFuZCB2YWx1ZSBmaXRzIGluIGxlbmd0aCBiaXRzLgogICAqLwogIGNvbnN0IHNlbmRfYml0cyA9IChzLCB2YWx1ZSwgbGVuZ3RoKSA9PiB7CgogICAgaWYgKHMuYmlfdmFsaWQgPiAoQnVmX3NpemUgLSBsZW5ndGgpKSB7CiAgICAgIHMuYmlfYnVmIHw9ICh2YWx1ZSA8PCBzLmJpX3ZhbGlkKSAmIDB4ZmZmZjsKICAgICAgcHV0X3Nob3J0KHMsIHMuYmlfYnVmKTsKICAgICAgcy5iaV9idWYgPSB2YWx1ZSA+PiAoQnVmX3NpemUgLSBzLmJpX3ZhbGlkKTsKICAgICAgcy5iaV92YWxpZCArPSBsZW5ndGggLSBCdWZfc2l6ZTsKICAgIH0gZWxzZSB7CiAgICAgIHMuYmlfYnVmIHw9ICh2YWx1ZSA8PCBzLmJpX3ZhbGlkKSAmIDB4ZmZmZjsKICAgICAgcy5iaV92YWxpZCArPSBsZW5ndGg7CiAgICB9CiAgfTsKCgogIGNvbnN0IHNlbmRfY29kZSA9IChzLCBjLCB0cmVlKSA9PiB7CgogICAgc2VuZF9iaXRzKHMsIHRyZWVbYyAqIDJdLyouQ29kZSovLCB0cmVlW2MgKiAyICsgMV0vKi5MZW4qLyk7CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFJldmVyc2UgdGhlIGZpcnN0IGxlbiBiaXRzIG9mIGEgY29kZSwgdXNpbmcgc3RyYWlnaHRmb3J3YXJkIGNvZGUgKGEgZmFzdGVyCiAgICogbWV0aG9kIHdvdWxkIHVzZSBhIHRhYmxlKQogICAqIElOIGFzc2VydGlvbjogMSA8PSBsZW4gPD0gMTUKICAgKi8KICBjb25zdCBiaV9yZXZlcnNlID0gKGNvZGUsIGxlbikgPT4gewoKICAgIGxldCByZXMgPSAwOwogICAgZG8gewogICAgICByZXMgfD0gY29kZSAmIDE7CiAgICAgIGNvZGUgPj4+PSAxOwogICAgICByZXMgPDw9IDE7CiAgICB9IHdoaWxlICgtLWxlbiA+IDApOwogICAgcmV0dXJuIHJlcyA+Pj4gMTsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogRmx1c2ggdGhlIGJpdCBidWZmZXIsIGtlZXBpbmcgYXQgbW9zdCA3IGJpdHMgaW4gaXQuCiAgICovCiAgY29uc3QgYmlfZmx1c2ggPSAocykgPT4gewoKICAgIGlmIChzLmJpX3ZhbGlkID09PSAxNikgewogICAgICBwdXRfc2hvcnQocywgcy5iaV9idWYpOwogICAgICBzLmJpX2J1ZiA9IDA7CiAgICAgIHMuYmlfdmFsaWQgPSAwOwoKICAgIH0gZWxzZSBpZiAocy5iaV92YWxpZCA+PSA4KSB7CiAgICAgIHMucGVuZGluZ19idWZbcy5wZW5kaW5nKytdID0gcy5iaV9idWYgJiAweGZmOwogICAgICBzLmJpX2J1ZiA+Pj0gODsKICAgICAgcy5iaV92YWxpZCAtPSA4OwogICAgfQogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb21wdXRlIHRoZSBvcHRpbWFsIGJpdCBsZW5ndGhzIGZvciBhIHRyZWUgYW5kIHVwZGF0ZSB0aGUgdG90YWwgYml0IGxlbmd0aAogICAqIGZvciB0aGUgY3VycmVudCBibG9jay4KICAgKiBJTiBhc3NlcnRpb246IHRoZSBmaWVsZHMgZnJlcSBhbmQgZGFkIGFyZSBzZXQsIGhlYXBbaGVhcF9tYXhdIGFuZAogICAqICAgIGFib3ZlIGFyZSB0aGUgdHJlZSBub2RlcyBzb3J0ZWQgYnkgaW5jcmVhc2luZyBmcmVxdWVuY3kuCiAgICogT1VUIGFzc2VydGlvbnM6IHRoZSBmaWVsZCBsZW4gaXMgc2V0IHRvIHRoZSBvcHRpbWFsIGJpdCBsZW5ndGgsIHRoZQogICAqICAgICBhcnJheSBibF9jb3VudCBjb250YWlucyB0aGUgZnJlcXVlbmNpZXMgZm9yIGVhY2ggYml0IGxlbmd0aC4KICAgKiAgICAgVGhlIGxlbmd0aCBvcHRfbGVuIGlzIHVwZGF0ZWQ7IHN0YXRpY19sZW4gaXMgYWxzbyB1cGRhdGVkIGlmIHN0cmVlIGlzCiAgICogICAgIG5vdCBudWxsLgogICAqLwogIGNvbnN0IGdlbl9iaXRsZW4gPSAocywgZGVzYykgPT4KICAvLyAgICBkZWZsYXRlX3N0YXRlICpzOwogIC8vICAgIHRyZWVfZGVzYyAqZGVzYzsgICAgLyogdGhlIHRyZWUgZGVzY3JpcHRvciAqLwogIHsKICAgIGNvbnN0IHRyZWUgICAgICAgICAgICA9IGRlc2MuZHluX3RyZWU7CiAgICBjb25zdCBtYXhfY29kZSAgICAgICAgPSBkZXNjLm1heF9jb2RlOwogICAgY29uc3Qgc3RyZWUgICAgICAgICAgID0gZGVzYy5zdGF0X2Rlc2Muc3RhdGljX3RyZWU7CiAgICBjb25zdCBoYXNfc3RyZWUgICAgICAgPSBkZXNjLnN0YXRfZGVzYy5oYXNfc3RyZWU7CiAgICBjb25zdCBleHRyYSAgICAgICAgICAgPSBkZXNjLnN0YXRfZGVzYy5leHRyYV9iaXRzOwogICAgY29uc3QgYmFzZSAgICAgICAgICAgID0gZGVzYy5zdGF0X2Rlc2MuZXh0cmFfYmFzZTsKICAgIGNvbnN0IG1heF9sZW5ndGggICAgICA9IGRlc2Muc3RhdF9kZXNjLm1heF9sZW5ndGg7CiAgICBsZXQgaDsgICAgICAgICAgICAgIC8qIGhlYXAgaW5kZXggKi8KICAgIGxldCBuLCBtOyAgICAgICAgICAgLyogaXRlcmF0ZSBvdmVyIHRoZSB0cmVlIGVsZW1lbnRzICovCiAgICBsZXQgYml0czsgICAgICAgICAgIC8qIGJpdCBsZW5ndGggKi8KICAgIGxldCB4Yml0czsgICAgICAgICAgLyogZXh0cmEgYml0cyAqLwogICAgbGV0IGY7ICAgICAgICAgICAgICAvKiBmcmVxdWVuY3kgKi8KICAgIGxldCBvdmVyZmxvdyA9IDA7ICAgLyogbnVtYmVyIG9mIGVsZW1lbnRzIHdpdGggYml0IGxlbmd0aCB0b28gbGFyZ2UgKi8KCiAgICBmb3IgKGJpdHMgPSAwOyBiaXRzIDw9IE1BWF9CSVRTJDE7IGJpdHMrKykgewogICAgICBzLmJsX2NvdW50W2JpdHNdID0gMDsKICAgIH0KCiAgICAvKiBJbiBhIGZpcnN0IHBhc3MsIGNvbXB1dGUgdGhlIG9wdGltYWwgYml0IGxlbmd0aHMgKHdoaWNoIG1heQogICAgICogb3ZlcmZsb3cgaW4gdGhlIGNhc2Ugb2YgdGhlIGJpdCBsZW5ndGggdHJlZSkuCiAgICAgKi8KICAgIHRyZWVbcy5oZWFwW3MuaGVhcF9tYXhdICogMiArIDFdLyouTGVuKi8gPSAwOyAvKiByb290IG9mIHRoZSBoZWFwICovCgogICAgZm9yIChoID0gcy5oZWFwX21heCArIDE7IGggPCBIRUFQX1NJWkUkMTsgaCsrKSB7CiAgICAgIG4gPSBzLmhlYXBbaF07CiAgICAgIGJpdHMgPSB0cmVlW3RyZWVbbiAqIDIgKyAxXS8qLkRhZCovICogMiArIDFdLyouTGVuKi8gKyAxOwogICAgICBpZiAoYml0cyA+IG1heF9sZW5ndGgpIHsKICAgICAgICBiaXRzID0gbWF4X2xlbmd0aDsKICAgICAgICBvdmVyZmxvdysrOwogICAgICB9CiAgICAgIHRyZWVbbiAqIDIgKyAxXS8qLkxlbiovID0gYml0czsKICAgICAgLyogV2Ugb3ZlcndyaXRlIHRyZWVbbl0uRGFkIHdoaWNoIGlzIG5vIGxvbmdlciBuZWVkZWQgKi8KCiAgICAgIGlmIChuID4gbWF4X2NvZGUpIHsgY29udGludWU7IH0gLyogbm90IGEgbGVhZiBub2RlICovCgogICAgICBzLmJsX2NvdW50W2JpdHNdKys7CiAgICAgIHhiaXRzID0gMDsKICAgICAgaWYgKG4gPj0gYmFzZSkgewogICAgICAgIHhiaXRzID0gZXh0cmFbbiAtIGJhc2VdOwogICAgICB9CiAgICAgIGYgPSB0cmVlW24gKiAyXS8qLkZyZXEqLzsKICAgICAgcy5vcHRfbGVuICs9IGYgKiAoYml0cyArIHhiaXRzKTsKICAgICAgaWYgKGhhc19zdHJlZSkgewogICAgICAgIHMuc3RhdGljX2xlbiArPSBmICogKHN0cmVlW24gKiAyICsgMV0vKi5MZW4qLyArIHhiaXRzKTsKICAgICAgfQogICAgfQogICAgaWYgKG92ZXJmbG93ID09PSAwKSB7IHJldHVybjsgfQoKICAgIC8vIFRyYWNlKChzdGRlcnIsIlxuYml0IGxlbmd0aCBvdmVyZmxvd1xuIikpOwogICAgLyogVGhpcyBoYXBwZW5zIGZvciBleGFtcGxlIG9uIG9iajIgYW5kIHBpYyBvZiB0aGUgQ2FsZ2FyeSBjb3JwdXMgKi8KCiAgICAvKiBGaW5kIHRoZSBmaXJzdCBiaXQgbGVuZ3RoIHdoaWNoIGNvdWxkIGluY3JlYXNlOiAqLwogICAgZG8gewogICAgICBiaXRzID0gbWF4X2xlbmd0aCAtIDE7CiAgICAgIHdoaWxlIChzLmJsX2NvdW50W2JpdHNdID09PSAwKSB7IGJpdHMtLTsgfQogICAgICBzLmJsX2NvdW50W2JpdHNdLS07ICAgICAgLyogbW92ZSBvbmUgbGVhZiBkb3duIHRoZSB0cmVlICovCiAgICAgIHMuYmxfY291bnRbYml0cyArIDFdICs9IDI7IC8qIG1vdmUgb25lIG92ZXJmbG93IGl0ZW0gYXMgaXRzIGJyb3RoZXIgKi8KICAgICAgcy5ibF9jb3VudFttYXhfbGVuZ3RoXS0tOwogICAgICAvKiBUaGUgYnJvdGhlciBvZiB0aGUgb3ZlcmZsb3cgaXRlbSBhbHNvIG1vdmVzIG9uZSBzdGVwIHVwLAogICAgICAgKiBidXQgdGhpcyBkb2VzIG5vdCBhZmZlY3QgYmxfY291bnRbbWF4X2xlbmd0aF0KICAgICAgICovCiAgICAgIG92ZXJmbG93IC09IDI7CiAgICB9IHdoaWxlIChvdmVyZmxvdyA+IDApOwoKICAgIC8qIE5vdyByZWNvbXB1dGUgYWxsIGJpdCBsZW5ndGhzLCBzY2FubmluZyBpbiBpbmNyZWFzaW5nIGZyZXF1ZW5jeS4KICAgICAqIGggaXMgc3RpbGwgZXF1YWwgdG8gSEVBUF9TSVpFLiAoSXQgaXMgc2ltcGxlciB0byByZWNvbnN0cnVjdCBhbGwKICAgICAqIGxlbmd0aHMgaW5zdGVhZCBvZiBmaXhpbmcgb25seSB0aGUgd3Jvbmcgb25lcy4gVGhpcyBpZGVhIGlzIHRha2VuCiAgICAgKiBmcm9tICdhcicgd3JpdHRlbiBieSBIYXJ1aGlrbyBPa3VtdXJhLikKICAgICAqLwogICAgZm9yIChiaXRzID0gbWF4X2xlbmd0aDsgYml0cyAhPT0gMDsgYml0cy0tKSB7CiAgICAgIG4gPSBzLmJsX2NvdW50W2JpdHNdOwogICAgICB3aGlsZSAobiAhPT0gMCkgewogICAgICAgIG0gPSBzLmhlYXBbLS1oXTsKICAgICAgICBpZiAobSA+IG1heF9jb2RlKSB7IGNvbnRpbnVlOyB9CiAgICAgICAgaWYgKHRyZWVbbSAqIDIgKyAxXS8qLkxlbiovICE9PSBiaXRzKSB7CiAgICAgICAgICAvLyBUcmFjZSgoc3RkZXJyLCJjb2RlICVkIGJpdHMgJWQtPiVkXG4iLCBtLCB0cmVlW21dLkxlbiwgYml0cykpOwogICAgICAgICAgcy5vcHRfbGVuICs9IChiaXRzIC0gdHJlZVttICogMiArIDFdLyouTGVuKi8pICogdHJlZVttICogMl0vKi5GcmVxKi87CiAgICAgICAgICB0cmVlW20gKiAyICsgMV0vKi5MZW4qLyA9IGJpdHM7CiAgICAgICAgfQogICAgICAgIG4tLTsKICAgICAgfQogICAgfQogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBHZW5lcmF0ZSB0aGUgY29kZXMgZm9yIGEgZ2l2ZW4gdHJlZSBhbmQgYml0IGNvdW50cyAod2hpY2ggbmVlZCBub3QgYmUKICAgKiBvcHRpbWFsKS4KICAgKiBJTiBhc3NlcnRpb246IHRoZSBhcnJheSBibF9jb3VudCBjb250YWlucyB0aGUgYml0IGxlbmd0aCBzdGF0aXN0aWNzIGZvcgogICAqIHRoZSBnaXZlbiB0cmVlIGFuZCB0aGUgZmllbGQgbGVuIGlzIHNldCBmb3IgYWxsIHRyZWUgZWxlbWVudHMuCiAgICogT1VUIGFzc2VydGlvbjogdGhlIGZpZWxkIGNvZGUgaXMgc2V0IGZvciBhbGwgdHJlZSBlbGVtZW50cyBvZiBub24KICAgKiAgICAgemVybyBjb2RlIGxlbmd0aC4KICAgKi8KICBjb25zdCBnZW5fY29kZXMgPSAodHJlZSwgbWF4X2NvZGUsIGJsX2NvdW50KSA9PgogIC8vICAgIGN0X2RhdGEgKnRyZWU7ICAgICAgICAgICAgIC8qIHRoZSB0cmVlIHRvIGRlY29yYXRlICovCiAgLy8gICAgaW50IG1heF9jb2RlOyAgICAgICAgICAgICAgLyogbGFyZ2VzdCBjb2RlIHdpdGggbm9uIHplcm8gZnJlcXVlbmN5ICovCiAgLy8gICAgdXNoZiAqYmxfY291bnQ7ICAgICAgICAgICAgLyogbnVtYmVyIG9mIGNvZGVzIGF0IGVhY2ggYml0IGxlbmd0aCAqLwogIHsKICAgIGNvbnN0IG5leHRfY29kZSA9IG5ldyBBcnJheShNQVhfQklUUyQxICsgMSk7IC8qIG5leHQgY29kZSB2YWx1ZSBmb3IgZWFjaCBiaXQgbGVuZ3RoICovCiAgICBsZXQgY29kZSA9IDA7ICAgICAgICAgICAgICAvKiBydW5uaW5nIGNvZGUgdmFsdWUgKi8KICAgIGxldCBiaXRzOyAgICAgICAgICAgICAgICAgIC8qIGJpdCBpbmRleCAqLwogICAgbGV0IG47ICAgICAgICAgICAgICAgICAgICAgLyogY29kZSBpbmRleCAqLwoKICAgIC8qIFRoZSBkaXN0cmlidXRpb24gY291bnRzIGFyZSBmaXJzdCB1c2VkIHRvIGdlbmVyYXRlIHRoZSBjb2RlIHZhbHVlcwogICAgICogd2l0aG91dCBiaXQgcmV2ZXJzYWwuCiAgICAgKi8KICAgIGZvciAoYml0cyA9IDE7IGJpdHMgPD0gTUFYX0JJVFMkMTsgYml0cysrKSB7CiAgICAgIG5leHRfY29kZVtiaXRzXSA9IGNvZGUgPSAoY29kZSArIGJsX2NvdW50W2JpdHMgLSAxXSkgPDwgMTsKICAgIH0KICAgIC8qIENoZWNrIHRoYXQgdGhlIGJpdCBjb3VudHMgaW4gYmxfY291bnQgYXJlIGNvbnNpc3RlbnQuIFRoZSBsYXN0IGNvZGUKICAgICAqIG11c3QgYmUgYWxsIG9uZXMuCiAgICAgKi8KICAgIC8vQXNzZXJ0IChjb2RlICsgYmxfY291bnRbTUFYX0JJVFNdLTEgPT0gKDE8PE1BWF9CSVRTKS0xLAogICAgLy8gICAgICAgICJpbmNvbnNpc3RlbnQgYml0IGNvdW50cyIpOwogICAgLy9UcmFjZXYoKHN0ZGVyciwiXG5nZW5fY29kZXM6IG1heF9jb2RlICVkICIsIG1heF9jb2RlKSk7CgogICAgZm9yIChuID0gMDsgIG4gPD0gbWF4X2NvZGU7IG4rKykgewogICAgICBsZXQgbGVuID0gdHJlZVtuICogMiArIDFdLyouTGVuKi87CiAgICAgIGlmIChsZW4gPT09IDApIHsgY29udGludWU7IH0KICAgICAgLyogTm93IHJldmVyc2UgdGhlIGJpdHMgKi8KICAgICAgdHJlZVtuICogMl0vKi5Db2RlKi8gPSBiaV9yZXZlcnNlKG5leHRfY29kZVtsZW5dKyssIGxlbik7CgogICAgICAvL1RyYWNlY3YodHJlZSAhPSBzdGF0aWNfbHRyZWUsIChzdGRlcnIsIlxubiAlM2QgJWMgbCAlMmQgYyAlNHggKCV4KSAiLAogICAgICAvLyAgICAgbiwgKGlzZ3JhcGgobikgPyBuIDogJyAnKSwgbGVuLCB0cmVlW25dLkNvZGUsIG5leHRfY29kZVtsZW5dLTEpKTsKICAgIH0KICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogSW5pdGlhbGl6ZSB0aGUgdmFyaW91cyAnY29uc3RhbnQnIHRhYmxlcy4KICAgKi8KICBjb25zdCB0cl9zdGF0aWNfaW5pdCA9ICgpID0+IHsKCiAgICBsZXQgbjsgICAgICAgIC8qIGl0ZXJhdGVzIG92ZXIgdHJlZSBlbGVtZW50cyAqLwogICAgbGV0IGJpdHM7ICAgICAvKiBiaXQgY291bnRlciAqLwogICAgbGV0IGxlbmd0aDsgICAvKiBsZW5ndGggdmFsdWUgKi8KICAgIGxldCBjb2RlOyAgICAgLyogY29kZSB2YWx1ZSAqLwogICAgbGV0IGRpc3Q7ICAgICAvKiBkaXN0YW5jZSBpbmRleCAqLwogICAgY29uc3QgYmxfY291bnQgPSBuZXcgQXJyYXkoTUFYX0JJVFMkMSArIDEpOwogICAgLyogbnVtYmVyIG9mIGNvZGVzIGF0IGVhY2ggYml0IGxlbmd0aCBmb3IgYW4gb3B0aW1hbCB0cmVlICovCgogICAgLy8gZG8gY2hlY2sgaW4gX3RyX2luaXQoKQogICAgLy9pZiAoc3RhdGljX2luaXRfZG9uZSkgcmV0dXJuOwoKICAgIC8qIEZvciBzb21lIGVtYmVkZGVkIHRhcmdldHMsIGdsb2JhbCB2YXJpYWJsZXMgYXJlIG5vdCBpbml0aWFsaXplZDogKi8KICAvKiNpZmRlZiBOT19JTklUX0dMT0JBTF9QT0lOVEVSUwogICAgc3RhdGljX2xfZGVzYy5zdGF0aWNfdHJlZSA9IHN0YXRpY19sdHJlZTsKICAgIHN0YXRpY19sX2Rlc2MuZXh0cmFfYml0cyA9IGV4dHJhX2xiaXRzOwogICAgc3RhdGljX2RfZGVzYy5zdGF0aWNfdHJlZSA9IHN0YXRpY19kdHJlZTsKICAgIHN0YXRpY19kX2Rlc2MuZXh0cmFfYml0cyA9IGV4dHJhX2RiaXRzOwogICAgc3RhdGljX2JsX2Rlc2MuZXh0cmFfYml0cyA9IGV4dHJhX2JsYml0czsKICAjZW5kaWYqLwoKICAgIC8qIEluaXRpYWxpemUgdGhlIG1hcHBpbmcgbGVuZ3RoICgwLi4yNTUpIC0+IGxlbmd0aCBjb2RlICgwLi4yOCkgKi8KICAgIGxlbmd0aCA9IDA7CiAgICBmb3IgKGNvZGUgPSAwOyBjb2RlIDwgTEVOR1RIX0NPREVTJDEgLSAxOyBjb2RlKyspIHsKICAgICAgYmFzZV9sZW5ndGhbY29kZV0gPSBsZW5ndGg7CiAgICAgIGZvciAobiA9IDA7IG4gPCAoMSA8PCBleHRyYV9sYml0c1tjb2RlXSk7IG4rKykgewogICAgICAgIF9sZW5ndGhfY29kZVtsZW5ndGgrK10gPSBjb2RlOwogICAgICB9CiAgICB9CiAgICAvL0Fzc2VydCAobGVuZ3RoID09IDI1NiwgInRyX3N0YXRpY19pbml0OiBsZW5ndGggIT0gMjU2Iik7CiAgICAvKiBOb3RlIHRoYXQgdGhlIGxlbmd0aCAyNTUgKG1hdGNoIGxlbmd0aCAyNTgpIGNhbiBiZSByZXByZXNlbnRlZAogICAgICogaW4gdHdvIGRpZmZlcmVudCB3YXlzOiBjb2RlIDI4NCArIDUgYml0cyBvciBjb2RlIDI4NSwgc28gd2UKICAgICAqIG92ZXJ3cml0ZSBsZW5ndGhfY29kZVsyNTVdIHRvIHVzZSB0aGUgYmVzdCBlbmNvZGluZzoKICAgICAqLwogICAgX2xlbmd0aF9jb2RlW2xlbmd0aCAtIDFdID0gY29kZTsKCiAgICAvKiBJbml0aWFsaXplIHRoZSBtYXBwaW5nIGRpc3QgKDAuLjMySykgLT4gZGlzdCBjb2RlICgwLi4yOSkgKi8KICAgIGRpc3QgPSAwOwogICAgZm9yIChjb2RlID0gMDsgY29kZSA8IDE2OyBjb2RlKyspIHsKICAgICAgYmFzZV9kaXN0W2NvZGVdID0gZGlzdDsKICAgICAgZm9yIChuID0gMDsgbiA8ICgxIDw8IGV4dHJhX2RiaXRzW2NvZGVdKTsgbisrKSB7CiAgICAgICAgX2Rpc3RfY29kZVtkaXN0KytdID0gY29kZTsKICAgICAgfQogICAgfQogICAgLy9Bc3NlcnQgKGRpc3QgPT0gMjU2LCAidHJfc3RhdGljX2luaXQ6IGRpc3QgIT0gMjU2Iik7CiAgICBkaXN0ID4+PSA3OyAvKiBmcm9tIG5vdyBvbiwgYWxsIGRpc3RhbmNlcyBhcmUgZGl2aWRlZCBieSAxMjggKi8KICAgIGZvciAoOyBjb2RlIDwgRF9DT0RFUyQxOyBjb2RlKyspIHsKICAgICAgYmFzZV9kaXN0W2NvZGVdID0gZGlzdCA8PCA3OwogICAgICBmb3IgKG4gPSAwOyBuIDwgKDEgPDwgKGV4dHJhX2RiaXRzW2NvZGVdIC0gNykpOyBuKyspIHsKICAgICAgICBfZGlzdF9jb2RlWzI1NiArIGRpc3QrK10gPSBjb2RlOwogICAgICB9CiAgICB9CiAgICAvL0Fzc2VydCAoZGlzdCA9PSAyNTYsICJ0cl9zdGF0aWNfaW5pdDogMjU2K2Rpc3QgIT0gNTEyIik7CgogICAgLyogQ29uc3RydWN0IHRoZSBjb2RlcyBvZiB0aGUgc3RhdGljIGxpdGVyYWwgdHJlZSAqLwogICAgZm9yIChiaXRzID0gMDsgYml0cyA8PSBNQVhfQklUUyQxOyBiaXRzKyspIHsKICAgICAgYmxfY291bnRbYml0c10gPSAwOwogICAgfQoKICAgIG4gPSAwOwogICAgd2hpbGUgKG4gPD0gMTQzKSB7CiAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdLyouTGVuKi8gPSA4OwogICAgICBuKys7CiAgICAgIGJsX2NvdW50WzhdKys7CiAgICB9CiAgICB3aGlsZSAobiA8PSAyNTUpIHsKICAgICAgc3RhdGljX2x0cmVlW24gKiAyICsgMV0vKi5MZW4qLyA9IDk7CiAgICAgIG4rKzsKICAgICAgYmxfY291bnRbOV0rKzsKICAgIH0KICAgIHdoaWxlIChuIDw9IDI3OSkgewogICAgICBzdGF0aWNfbHRyZWVbbiAqIDIgKyAxXS8qLkxlbiovID0gNzsKICAgICAgbisrOwogICAgICBibF9jb3VudFs3XSsrOwogICAgfQogICAgd2hpbGUgKG4gPD0gMjg3KSB7CiAgICAgIHN0YXRpY19sdHJlZVtuICogMiArIDFdLyouTGVuKi8gPSA4OwogICAgICBuKys7CiAgICAgIGJsX2NvdW50WzhdKys7CiAgICB9CiAgICAvKiBDb2RlcyAyODYgYW5kIDI4NyBkbyBub3QgZXhpc3QsIGJ1dCB3ZSBtdXN0IGluY2x1ZGUgdGhlbSBpbiB0aGUKICAgICAqIHRyZWUgY29uc3RydWN0aW9uIHRvIGdldCBhIGNhbm9uaWNhbCBIdWZmbWFuIHRyZWUgKGxvbmdlc3QgY29kZQogICAgICogYWxsIG9uZXMpCiAgICAgKi8KICAgIGdlbl9jb2RlcyhzdGF0aWNfbHRyZWUsIExfQ09ERVMkMSArIDEsIGJsX2NvdW50KTsKCiAgICAvKiBUaGUgc3RhdGljIGRpc3RhbmNlIHRyZWUgaXMgdHJpdmlhbDogKi8KICAgIGZvciAobiA9IDA7IG4gPCBEX0NPREVTJDE7IG4rKykgewogICAgICBzdGF0aWNfZHRyZWVbbiAqIDIgKyAxXS8qLkxlbiovID0gNTsKICAgICAgc3RhdGljX2R0cmVlW24gKiAyXS8qLkNvZGUqLyA9IGJpX3JldmVyc2UobiwgNSk7CiAgICB9CgogICAgLy8gTm93IGRhdGEgcmVhZHkgYW5kIHdlIGNhbiBpbml0IHN0YXRpYyB0cmVlcwogICAgc3RhdGljX2xfZGVzYyA9IG5ldyBTdGF0aWNUcmVlRGVzYyhzdGF0aWNfbHRyZWUsIGV4dHJhX2xiaXRzLCBMSVRFUkFMUyQxICsgMSwgTF9DT0RFUyQxLCBNQVhfQklUUyQxKTsKICAgIHN0YXRpY19kX2Rlc2MgPSBuZXcgU3RhdGljVHJlZURlc2Moc3RhdGljX2R0cmVlLCBleHRyYV9kYml0cywgMCwgICAgICAgICAgRF9DT0RFUyQxLCBNQVhfQklUUyQxKTsKICAgIHN0YXRpY19ibF9kZXNjID0gbmV3IFN0YXRpY1RyZWVEZXNjKG5ldyBBcnJheSgwKSwgZXh0cmFfYmxiaXRzLCAwLCAgICAgICAgIEJMX0NPREVTJDEsIE1BWF9CTF9CSVRTKTsKCiAgICAvL3N0YXRpY19pbml0X2RvbmUgPSB0cnVlOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBJbml0aWFsaXplIGEgbmV3IGJsb2NrLgogICAqLwogIGNvbnN0IGluaXRfYmxvY2sgPSAocykgPT4gewoKICAgIGxldCBuOyAvKiBpdGVyYXRlcyBvdmVyIHRyZWUgZWxlbWVudHMgKi8KCiAgICAvKiBJbml0aWFsaXplIHRoZSB0cmVlcy4gKi8KICAgIGZvciAobiA9IDA7IG4gPCBMX0NPREVTJDE7ICBuKyspIHsgcy5keW5fbHRyZWVbbiAqIDJdLyouRnJlcSovID0gMDsgfQogICAgZm9yIChuID0gMDsgbiA8IERfQ09ERVMkMTsgIG4rKykgeyBzLmR5bl9kdHJlZVtuICogMl0vKi5GcmVxKi8gPSAwOyB9CiAgICBmb3IgKG4gPSAwOyBuIDwgQkxfQ09ERVMkMTsgbisrKSB7IHMuYmxfdHJlZVtuICogMl0vKi5GcmVxKi8gPSAwOyB9CgogICAgcy5keW5fbHRyZWVbRU5EX0JMT0NLICogMl0vKi5GcmVxKi8gPSAxOwogICAgcy5vcHRfbGVuID0gcy5zdGF0aWNfbGVuID0gMDsKICAgIHMubGFzdF9saXQgPSBzLm1hdGNoZXMgPSAwOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBGbHVzaCB0aGUgYml0IGJ1ZmZlciBhbmQgYWxpZ24gdGhlIG91dHB1dCBvbiBhIGJ5dGUgYm91bmRhcnkKICAgKi8KICBjb25zdCBiaV93aW5kdXAgPSAocykgPT4KICB7CiAgICBpZiAocy5iaV92YWxpZCA+IDgpIHsKICAgICAgcHV0X3Nob3J0KHMsIHMuYmlfYnVmKTsKICAgIH0gZWxzZSBpZiAocy5iaV92YWxpZCA+IDApIHsKICAgICAgLy9wdXRfYnl0ZShzLCAoQnl0ZSlzLT5iaV9idWYpOwogICAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IHMuYmlfYnVmOwogICAgfQogICAgcy5iaV9idWYgPSAwOwogICAgcy5iaV92YWxpZCA9IDA7CiAgfTsKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogQ29weSBhIHN0b3JlZCBibG9jaywgc3RvcmluZyBmaXJzdCB0aGUgbGVuZ3RoIGFuZCBpdHMKICAgKiBvbmUncyBjb21wbGVtZW50IGlmIHJlcXVlc3RlZC4KICAgKi8KICBjb25zdCBjb3B5X2Jsb2NrID0gKHMsIGJ1ZiwgbGVuLCBoZWFkZXIpID0+CiAgLy9EZWZsYXRlU3RhdGUgKnM7CiAgLy9jaGFyZiAgICAqYnVmOyAgICAvKiB0aGUgaW5wdXQgZGF0YSAqLwogIC8vdW5zaWduZWQgbGVuOyAgICAgLyogaXRzIGxlbmd0aCAqLwogIC8vaW50ICAgICAgaGVhZGVyOyAgLyogdHJ1ZSBpZiBibG9jayBoZWFkZXIgbXVzdCBiZSB3cml0dGVuICovCiAgewogICAgYmlfd2luZHVwKHMpOyAgICAgICAgLyogYWxpZ24gb24gYnl0ZSBib3VuZGFyeSAqLwoKICAgIGlmIChoZWFkZXIpIHsKICAgICAgcHV0X3Nob3J0KHMsIGxlbik7CiAgICAgIHB1dF9zaG9ydChzLCB+bGVuKTsKICAgIH0KICAvLyAgd2hpbGUgKGxlbi0tKSB7CiAgLy8gICAgcHV0X2J5dGUocywgKmJ1ZisrKTsKICAvLyAgfQogICAgcy5wZW5kaW5nX2J1Zi5zZXQocy53aW5kb3cuc3ViYXJyYXkoYnVmLCBidWYgKyBsZW4pLCBzLnBlbmRpbmcpOwogICAgcy5wZW5kaW5nICs9IGxlbjsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb21wYXJlcyB0byBzdWJ0cmVlcywgdXNpbmcgdGhlIHRyZWUgZGVwdGggYXMgdGllIGJyZWFrZXIgd2hlbgogICAqIHRoZSBzdWJ0cmVlcyBoYXZlIGVxdWFsIGZyZXF1ZW5jeS4gVGhpcyBtaW5pbWl6ZXMgdGhlIHdvcnN0IGNhc2UgbGVuZ3RoLgogICAqLwogIGNvbnN0IHNtYWxsZXIgPSAodHJlZSwgbiwgbSwgZGVwdGgpID0+IHsKCiAgICBjb25zdCBfbjIgPSBuICogMjsKICAgIGNvbnN0IF9tMiA9IG0gKiAyOwogICAgcmV0dXJuICh0cmVlW19uMl0vKi5GcmVxKi8gPCB0cmVlW19tMl0vKi5GcmVxKi8gfHwKICAgICAgICAgICAodHJlZVtfbjJdLyouRnJlcSovID09PSB0cmVlW19tMl0vKi5GcmVxKi8gJiYgZGVwdGhbbl0gPD0gZGVwdGhbbV0pKTsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBSZXN0b3JlIHRoZSBoZWFwIHByb3BlcnR5IGJ5IG1vdmluZyBkb3duIHRoZSB0cmVlIHN0YXJ0aW5nIGF0IG5vZGUgaywKICAgKiBleGNoYW5naW5nIGEgbm9kZSB3aXRoIHRoZSBzbWFsbGVzdCBvZiBpdHMgdHdvIHNvbnMgaWYgbmVjZXNzYXJ5LCBzdG9wcGluZwogICAqIHdoZW4gdGhlIGhlYXAgcHJvcGVydHkgaXMgcmUtZXN0YWJsaXNoZWQgKGVhY2ggZmF0aGVyIHNtYWxsZXIgdGhhbiBpdHMKICAgKiB0d28gc29ucykuCiAgICovCiAgY29uc3QgcHFkb3duaGVhcCA9IChzLCB0cmVlLCBrKSA9PgogIC8vICAgIGRlZmxhdGVfc3RhdGUgKnM7CiAgLy8gICAgY3RfZGF0YSAqdHJlZTsgIC8qIHRoZSB0cmVlIHRvIHJlc3RvcmUgKi8KICAvLyAgICBpbnQgazsgICAgICAgICAgICAgICAvKiBub2RlIHRvIG1vdmUgZG93biAqLwogIHsKICAgIGNvbnN0IHYgPSBzLmhlYXBba107CiAgICBsZXQgaiA9IGsgPDwgMTsgIC8qIGxlZnQgc29uIG9mIGsgKi8KICAgIHdoaWxlIChqIDw9IHMuaGVhcF9sZW4pIHsKICAgICAgLyogU2V0IGogdG8gdGhlIHNtYWxsZXN0IG9mIHRoZSB0d28gc29uczogKi8KICAgICAgaWYgKGogPCBzLmhlYXBfbGVuICYmCiAgICAgICAgc21hbGxlcih0cmVlLCBzLmhlYXBbaiArIDFdLCBzLmhlYXBbal0sIHMuZGVwdGgpKSB7CiAgICAgICAgaisrOwogICAgICB9CiAgICAgIC8qIEV4aXQgaWYgdiBpcyBzbWFsbGVyIHRoYW4gYm90aCBzb25zICovCiAgICAgIGlmIChzbWFsbGVyKHRyZWUsIHYsIHMuaGVhcFtqXSwgcy5kZXB0aCkpIHsgYnJlYWs7IH0KCiAgICAgIC8qIEV4Y2hhbmdlIHYgd2l0aCB0aGUgc21hbGxlc3Qgc29uICovCiAgICAgIHMuaGVhcFtrXSA9IHMuaGVhcFtqXTsKICAgICAgayA9IGo7CgogICAgICAvKiBBbmQgY29udGludWUgZG93biB0aGUgdHJlZSwgc2V0dGluZyBqIHRvIHRoZSBsZWZ0IHNvbiBvZiBrICovCiAgICAgIGogPDw9IDE7CiAgICB9CiAgICBzLmhlYXBba10gPSB2OwogIH07CgoKICAvLyBpbmxpbmVkIG1hbnVhbGx5CiAgLy8gY29uc3QgU01BTExFU1QgPSAxOwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBTZW5kIHRoZSBibG9jayBkYXRhIGNvbXByZXNzZWQgdXNpbmcgdGhlIGdpdmVuIEh1ZmZtYW4gdHJlZXMKICAgKi8KICBjb25zdCBjb21wcmVzc19ibG9jayA9IChzLCBsdHJlZSwgZHRyZWUpID0+CiAgLy8gICAgZGVmbGF0ZV9zdGF0ZSAqczsKICAvLyAgICBjb25zdCBjdF9kYXRhICpsdHJlZTsgLyogbGl0ZXJhbCB0cmVlICovCiAgLy8gICAgY29uc3QgY3RfZGF0YSAqZHRyZWU7IC8qIGRpc3RhbmNlIHRyZWUgKi8KICB7CiAgICBsZXQgZGlzdDsgICAgICAgICAgIC8qIGRpc3RhbmNlIG9mIG1hdGNoZWQgc3RyaW5nICovCiAgICBsZXQgbGM7ICAgICAgICAgICAgIC8qIG1hdGNoIGxlbmd0aCBvciB1bm1hdGNoZWQgY2hhciAoaWYgZGlzdCA9PSAwKSAqLwogICAgbGV0IGx4ID0gMDsgICAgICAgICAvKiBydW5uaW5nIGluZGV4IGluIGxfYnVmICovCiAgICBsZXQgY29kZTsgICAgICAgICAgIC8qIHRoZSBjb2RlIHRvIHNlbmQgKi8KICAgIGxldCBleHRyYTsgICAgICAgICAgLyogbnVtYmVyIG9mIGV4dHJhIGJpdHMgdG8gc2VuZCAqLwoKICAgIGlmIChzLmxhc3RfbGl0ICE9PSAwKSB7CiAgICAgIGRvIHsKICAgICAgICBkaXN0ID0gKHMucGVuZGluZ19idWZbcy5kX2J1ZiArIGx4ICogMl0gPDwgOCkgfCAocy5wZW5kaW5nX2J1ZltzLmRfYnVmICsgbHggKiAyICsgMV0pOwogICAgICAgIGxjID0gcy5wZW5kaW5nX2J1ZltzLmxfYnVmICsgbHhdOwogICAgICAgIGx4Kys7CgogICAgICAgIGlmIChkaXN0ID09PSAwKSB7CiAgICAgICAgICBzZW5kX2NvZGUocywgbGMsIGx0cmVlKTsgLyogc2VuZCBhIGxpdGVyYWwgYnl0ZSAqLwogICAgICAgICAgLy9UcmFjZWN2KGlzZ3JhcGgobGMpLCAoc3RkZXJyLCIgJyVjJyAiLCBsYykpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvKiBIZXJlLCBsYyBpcyB0aGUgbWF0Y2ggbGVuZ3RoIC0gTUlOX01BVENIICovCiAgICAgICAgICBjb2RlID0gX2xlbmd0aF9jb2RlW2xjXTsKICAgICAgICAgIHNlbmRfY29kZShzLCBjb2RlICsgTElURVJBTFMkMSArIDEsIGx0cmVlKTsgLyogc2VuZCB0aGUgbGVuZ3RoIGNvZGUgKi8KICAgICAgICAgIGV4dHJhID0gZXh0cmFfbGJpdHNbY29kZV07CiAgICAgICAgICBpZiAoZXh0cmEgIT09IDApIHsKICAgICAgICAgICAgbGMgLT0gYmFzZV9sZW5ndGhbY29kZV07CiAgICAgICAgICAgIHNlbmRfYml0cyhzLCBsYywgZXh0cmEpOyAgICAgICAvKiBzZW5kIHRoZSBleHRyYSBsZW5ndGggYml0cyAqLwogICAgICAgICAgfQogICAgICAgICAgZGlzdC0tOyAvKiBkaXN0IGlzIG5vdyB0aGUgbWF0Y2ggZGlzdGFuY2UgLSAxICovCiAgICAgICAgICBjb2RlID0gZF9jb2RlKGRpc3QpOwogICAgICAgICAgLy9Bc3NlcnQgKGNvZGUgPCBEX0NPREVTLCAiYmFkIGRfY29kZSIpOwoKICAgICAgICAgIHNlbmRfY29kZShzLCBjb2RlLCBkdHJlZSk7ICAgICAgIC8qIHNlbmQgdGhlIGRpc3RhbmNlIGNvZGUgKi8KICAgICAgICAgIGV4dHJhID0gZXh0cmFfZGJpdHNbY29kZV07CiAgICAgICAgICBpZiAoZXh0cmEgIT09IDApIHsKICAgICAgICAgICAgZGlzdCAtPSBiYXNlX2Rpc3RbY29kZV07CiAgICAgICAgICAgIHNlbmRfYml0cyhzLCBkaXN0LCBleHRyYSk7ICAgLyogc2VuZCB0aGUgZXh0cmEgZGlzdGFuY2UgYml0cyAqLwogICAgICAgICAgfQogICAgICAgIH0gLyogbGl0ZXJhbCBvciBtYXRjaCBwYWlyID8gKi8KCiAgICAgICAgLyogQ2hlY2sgdGhhdCB0aGUgb3ZlcmxheSBiZXR3ZWVuIHBlbmRpbmdfYnVmIGFuZCBkX2J1ZitsX2J1ZiBpcyBvazogKi8KICAgICAgICAvL0Fzc2VydCgodUludCkocy0+cGVuZGluZykgPCBzLT5saXRfYnVmc2l6ZSArIDIqbHgsCiAgICAgICAgLy8gICAgICAgInBlbmRpbmdCdWYgb3ZlcmZsb3ciKTsKCiAgICAgIH0gd2hpbGUgKGx4IDwgcy5sYXN0X2xpdCk7CiAgICB9CgogICAgc2VuZF9jb2RlKHMsIEVORF9CTE9DSywgbHRyZWUpOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb25zdHJ1Y3Qgb25lIEh1ZmZtYW4gdHJlZSBhbmQgYXNzaWducyB0aGUgY29kZSBiaXQgc3RyaW5ncyBhbmQgbGVuZ3Rocy4KICAgKiBVcGRhdGUgdGhlIHRvdGFsIGJpdCBsZW5ndGggZm9yIHRoZSBjdXJyZW50IGJsb2NrLgogICAqIElOIGFzc2VydGlvbjogdGhlIGZpZWxkIGZyZXEgaXMgc2V0IGZvciBhbGwgdHJlZSBlbGVtZW50cy4KICAgKiBPVVQgYXNzZXJ0aW9uczogdGhlIGZpZWxkcyBsZW4gYW5kIGNvZGUgYXJlIHNldCB0byB0aGUgb3B0aW1hbCBiaXQgbGVuZ3RoCiAgICogICAgIGFuZCBjb3JyZXNwb25kaW5nIGNvZGUuIFRoZSBsZW5ndGggb3B0X2xlbiBpcyB1cGRhdGVkOyBzdGF0aWNfbGVuIGlzCiAgICogICAgIGFsc28gdXBkYXRlZCBpZiBzdHJlZSBpcyBub3QgbnVsbC4gVGhlIGZpZWxkIG1heF9jb2RlIGlzIHNldC4KICAgKi8KICBjb25zdCBidWlsZF90cmVlID0gKHMsIGRlc2MpID0+CiAgLy8gICAgZGVmbGF0ZV9zdGF0ZSAqczsKICAvLyAgICB0cmVlX2Rlc2MgKmRlc2M7IC8qIHRoZSB0cmVlIGRlc2NyaXB0b3IgKi8KICB7CiAgICBjb25zdCB0cmVlICAgICA9IGRlc2MuZHluX3RyZWU7CiAgICBjb25zdCBzdHJlZSAgICA9IGRlc2Muc3RhdF9kZXNjLnN0YXRpY190cmVlOwogICAgY29uc3QgaGFzX3N0cmVlID0gZGVzYy5zdGF0X2Rlc2MuaGFzX3N0cmVlOwogICAgY29uc3QgZWxlbXMgICAgPSBkZXNjLnN0YXRfZGVzYy5lbGVtczsKICAgIGxldCBuLCBtOyAgICAgICAgICAvKiBpdGVyYXRlIG92ZXIgaGVhcCBlbGVtZW50cyAqLwogICAgbGV0IG1heF9jb2RlID0gLTE7IC8qIGxhcmdlc3QgY29kZSB3aXRoIG5vbiB6ZXJvIGZyZXF1ZW5jeSAqLwogICAgbGV0IG5vZGU7ICAgICAgICAgIC8qIG5ldyBub2RlIGJlaW5nIGNyZWF0ZWQgKi8KCiAgICAvKiBDb25zdHJ1Y3QgdGhlIGluaXRpYWwgaGVhcCwgd2l0aCBsZWFzdCBmcmVxdWVudCBlbGVtZW50IGluCiAgICAgKiBoZWFwW1NNQUxMRVNUXS4gVGhlIHNvbnMgb2YgaGVhcFtuXSBhcmUgaGVhcFsyKm5dIGFuZCBoZWFwWzIqbisxXS4KICAgICAqIGhlYXBbMF0gaXMgbm90IHVzZWQuCiAgICAgKi8KICAgIHMuaGVhcF9sZW4gPSAwOwogICAgcy5oZWFwX21heCA9IEhFQVBfU0laRSQxOwoKICAgIGZvciAobiA9IDA7IG4gPCBlbGVtczsgbisrKSB7CiAgICAgIGlmICh0cmVlW24gKiAyXS8qLkZyZXEqLyAhPT0gMCkgewogICAgICAgIHMuaGVhcFsrK3MuaGVhcF9sZW5dID0gbWF4X2NvZGUgPSBuOwogICAgICAgIHMuZGVwdGhbbl0gPSAwOwoKICAgICAgfSBlbHNlIHsKICAgICAgICB0cmVlW24gKiAyICsgMV0vKi5MZW4qLyA9IDA7CiAgICAgIH0KICAgIH0KCiAgICAvKiBUaGUgcGt6aXAgZm9ybWF0IHJlcXVpcmVzIHRoYXQgYXQgbGVhc3Qgb25lIGRpc3RhbmNlIGNvZGUgZXhpc3RzLAogICAgICogYW5kIHRoYXQgYXQgbGVhc3Qgb25lIGJpdCBzaG91bGQgYmUgc2VudCBldmVuIGlmIHRoZXJlIGlzIG9ubHkgb25lCiAgICAgKiBwb3NzaWJsZSBjb2RlLiBTbyB0byBhdm9pZCBzcGVjaWFsIGNoZWNrcyBsYXRlciBvbiB3ZSBmb3JjZSBhdCBsZWFzdAogICAgICogdHdvIGNvZGVzIG9mIG5vbiB6ZXJvIGZyZXF1ZW5jeS4KICAgICAqLwogICAgd2hpbGUgKHMuaGVhcF9sZW4gPCAyKSB7CiAgICAgIG5vZGUgPSBzLmhlYXBbKytzLmhlYXBfbGVuXSA9IChtYXhfY29kZSA8IDIgPyArK21heF9jb2RlIDogMCk7CiAgICAgIHRyZWVbbm9kZSAqIDJdLyouRnJlcSovID0gMTsKICAgICAgcy5kZXB0aFtub2RlXSA9IDA7CiAgICAgIHMub3B0X2xlbi0tOwoKICAgICAgaWYgKGhhc19zdHJlZSkgewogICAgICAgIHMuc3RhdGljX2xlbiAtPSBzdHJlZVtub2RlICogMiArIDFdLyouTGVuKi87CiAgICAgIH0KICAgICAgLyogbm9kZSBpcyAwIG9yIDEgc28gaXQgZG9lcyBub3QgaGF2ZSBleHRyYSBiaXRzICovCiAgICB9CiAgICBkZXNjLm1heF9jb2RlID0gbWF4X2NvZGU7CgogICAgLyogVGhlIGVsZW1lbnRzIGhlYXBbaGVhcF9sZW4vMisxIC4uIGhlYXBfbGVuXSBhcmUgbGVhdmVzIG9mIHRoZSB0cmVlLAogICAgICogZXN0YWJsaXNoIHN1Yi1oZWFwcyBvZiBpbmNyZWFzaW5nIGxlbmd0aHM6CiAgICAgKi8KICAgIGZvciAobiA9IChzLmhlYXBfbGVuID4+IDEvKmludCAvMiovKTsgbiA+PSAxOyBuLS0pIHsgcHFkb3duaGVhcChzLCB0cmVlLCBuKTsgfQoKICAgIC8qIENvbnN0cnVjdCB0aGUgSHVmZm1hbiB0cmVlIGJ5IHJlcGVhdGVkbHkgY29tYmluaW5nIHRoZSBsZWFzdCB0d28KICAgICAqIGZyZXF1ZW50IG5vZGVzLgogICAgICovCiAgICBub2RlID0gZWxlbXM7ICAgICAgICAgICAgICAvKiBuZXh0IGludGVybmFsIG5vZGUgb2YgdGhlIHRyZWUgKi8KICAgIGRvIHsKICAgICAgLy9wcXJlbW92ZShzLCB0cmVlLCBuKTsgIC8qIG4gPSBub2RlIG9mIGxlYXN0IGZyZXF1ZW5jeSAqLwogICAgICAvKioqIHBxcmVtb3ZlICoqKi8KICAgICAgbiA9IHMuaGVhcFsxLypTTUFMTEVTVCovXTsKICAgICAgcy5oZWFwWzEvKlNNQUxMRVNUKi9dID0gcy5oZWFwW3MuaGVhcF9sZW4tLV07CiAgICAgIHBxZG93bmhlYXAocywgdHJlZSwgMS8qU01BTExFU1QqLyk7CiAgICAgIC8qKiovCgogICAgICBtID0gcy5oZWFwWzEvKlNNQUxMRVNUKi9dOyAvKiBtID0gbm9kZSBvZiBuZXh0IGxlYXN0IGZyZXF1ZW5jeSAqLwoKICAgICAgcy5oZWFwWy0tcy5oZWFwX21heF0gPSBuOyAvKiBrZWVwIHRoZSBub2RlcyBzb3J0ZWQgYnkgZnJlcXVlbmN5ICovCiAgICAgIHMuaGVhcFstLXMuaGVhcF9tYXhdID0gbTsKCiAgICAgIC8qIENyZWF0ZSBhIG5ldyBub2RlIGZhdGhlciBvZiBuIGFuZCBtICovCiAgICAgIHRyZWVbbm9kZSAqIDJdLyouRnJlcSovID0gdHJlZVtuICogMl0vKi5GcmVxKi8gKyB0cmVlW20gKiAyXS8qLkZyZXEqLzsKICAgICAgcy5kZXB0aFtub2RlXSA9IChzLmRlcHRoW25dID49IHMuZGVwdGhbbV0gPyBzLmRlcHRoW25dIDogcy5kZXB0aFttXSkgKyAxOwogICAgICB0cmVlW24gKiAyICsgMV0vKi5EYWQqLyA9IHRyZWVbbSAqIDIgKyAxXS8qLkRhZCovID0gbm9kZTsKCiAgICAgIC8qIGFuZCBpbnNlcnQgdGhlIG5ldyBub2RlIGluIHRoZSBoZWFwICovCiAgICAgIHMuaGVhcFsxLypTTUFMTEVTVCovXSA9IG5vZGUrKzsKICAgICAgcHFkb3duaGVhcChzLCB0cmVlLCAxLypTTUFMTEVTVCovKTsKCiAgICB9IHdoaWxlIChzLmhlYXBfbGVuID49IDIpOwoKICAgIHMuaGVhcFstLXMuaGVhcF9tYXhdID0gcy5oZWFwWzEvKlNNQUxMRVNUKi9dOwoKICAgIC8qIEF0IHRoaXMgcG9pbnQsIHRoZSBmaWVsZHMgZnJlcSBhbmQgZGFkIGFyZSBzZXQuIFdlIGNhbiBub3cKICAgICAqIGdlbmVyYXRlIHRoZSBiaXQgbGVuZ3Rocy4KICAgICAqLwogICAgZ2VuX2JpdGxlbihzLCBkZXNjKTsKCiAgICAvKiBUaGUgZmllbGQgbGVuIGlzIG5vdyBzZXQsIHdlIGNhbiBnZW5lcmF0ZSB0aGUgYml0IGNvZGVzICovCiAgICBnZW5fY29kZXModHJlZSwgbWF4X2NvZGUsIHMuYmxfY291bnQpOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBTY2FuIGEgbGl0ZXJhbCBvciBkaXN0YW5jZSB0cmVlIHRvIGRldGVybWluZSB0aGUgZnJlcXVlbmNpZXMgb2YgdGhlIGNvZGVzCiAgICogaW4gdGhlIGJpdCBsZW5ndGggdHJlZS4KICAgKi8KICBjb25zdCBzY2FuX3RyZWUgPSAocywgdHJlZSwgbWF4X2NvZGUpID0+CiAgLy8gICAgZGVmbGF0ZV9zdGF0ZSAqczsKICAvLyAgICBjdF9kYXRhICp0cmVlOyAgIC8qIHRoZSB0cmVlIHRvIGJlIHNjYW5uZWQgKi8KICAvLyAgICBpbnQgbWF4X2NvZGU7ICAgIC8qIGFuZCBpdHMgbGFyZ2VzdCBjb2RlIG9mIG5vbiB6ZXJvIGZyZXF1ZW5jeSAqLwogIHsKICAgIGxldCBuOyAgICAgICAgICAgICAgICAgICAgIC8qIGl0ZXJhdGVzIG92ZXIgYWxsIHRyZWUgZWxlbWVudHMgKi8KICAgIGxldCBwcmV2bGVuID0gLTE7ICAgICAgICAgIC8qIGxhc3QgZW1pdHRlZCBsZW5ndGggKi8KICAgIGxldCBjdXJsZW47ICAgICAgICAgICAgICAgIC8qIGxlbmd0aCBvZiBjdXJyZW50IGNvZGUgKi8KCiAgICBsZXQgbmV4dGxlbiA9IHRyZWVbMCAqIDIgKyAxXS8qLkxlbiovOyAvKiBsZW5ndGggb2YgbmV4dCBjb2RlICovCgogICAgbGV0IGNvdW50ID0gMDsgICAgICAgICAgICAgLyogcmVwZWF0IGNvdW50IG9mIHRoZSBjdXJyZW50IGNvZGUgKi8KICAgIGxldCBtYXhfY291bnQgPSA3OyAgICAgICAgIC8qIG1heCByZXBlYXQgY291bnQgKi8KICAgIGxldCBtaW5fY291bnQgPSA0OyAgICAgICAgIC8qIG1pbiByZXBlYXQgY291bnQgKi8KCiAgICBpZiAobmV4dGxlbiA9PT0gMCkgewogICAgICBtYXhfY291bnQgPSAxMzg7CiAgICAgIG1pbl9jb3VudCA9IDM7CiAgICB9CiAgICB0cmVlWyhtYXhfY29kZSArIDEpICogMiArIDFdLyouTGVuKi8gPSAweGZmZmY7IC8qIGd1YXJkICovCgogICAgZm9yIChuID0gMDsgbiA8PSBtYXhfY29kZTsgbisrKSB7CiAgICAgIGN1cmxlbiA9IG5leHRsZW47CiAgICAgIG5leHRsZW4gPSB0cmVlWyhuICsgMSkgKiAyICsgMV0vKi5MZW4qLzsKCiAgICAgIGlmICgrK2NvdW50IDwgbWF4X2NvdW50ICYmIGN1cmxlbiA9PT0gbmV4dGxlbikgewogICAgICAgIGNvbnRpbnVlOwoKICAgICAgfSBlbHNlIGlmIChjb3VudCA8IG1pbl9jb3VudCkgewogICAgICAgIHMuYmxfdHJlZVtjdXJsZW4gKiAyXS8qLkZyZXEqLyArPSBjb3VudDsKCiAgICAgIH0gZWxzZSBpZiAoY3VybGVuICE9PSAwKSB7CgogICAgICAgIGlmIChjdXJsZW4gIT09IHByZXZsZW4pIHsgcy5ibF90cmVlW2N1cmxlbiAqIDJdLyouRnJlcSovKys7IH0KICAgICAgICBzLmJsX3RyZWVbUkVQXzNfNiAqIDJdLyouRnJlcSovKys7CgogICAgICB9IGVsc2UgaWYgKGNvdW50IDw9IDEwKSB7CiAgICAgICAgcy5ibF90cmVlW1JFUFpfM18xMCAqIDJdLyouRnJlcSovKys7CgogICAgICB9IGVsc2UgewogICAgICAgIHMuYmxfdHJlZVtSRVBaXzExXzEzOCAqIDJdLyouRnJlcSovKys7CiAgICAgIH0KCiAgICAgIGNvdW50ID0gMDsKICAgICAgcHJldmxlbiA9IGN1cmxlbjsKCiAgICAgIGlmIChuZXh0bGVuID09PSAwKSB7CiAgICAgICAgbWF4X2NvdW50ID0gMTM4OwogICAgICAgIG1pbl9jb3VudCA9IDM7CgogICAgICB9IGVsc2UgaWYgKGN1cmxlbiA9PT0gbmV4dGxlbikgewogICAgICAgIG1heF9jb3VudCA9IDY7CiAgICAgICAgbWluX2NvdW50ID0gMzsKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWF4X2NvdW50ID0gNzsKICAgICAgICBtaW5fY291bnQgPSA0OwogICAgICB9CiAgICB9CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFNlbmQgYSBsaXRlcmFsIG9yIGRpc3RhbmNlIHRyZWUgaW4gY29tcHJlc3NlZCBmb3JtLCB1c2luZyB0aGUgY29kZXMgaW4KICAgKiBibF90cmVlLgogICAqLwogIGNvbnN0IHNlbmRfdHJlZSA9IChzLCB0cmVlLCBtYXhfY29kZSkgPT4KICAvLyAgICBkZWZsYXRlX3N0YXRlICpzOwogIC8vICAgIGN0X2RhdGEgKnRyZWU7IC8qIHRoZSB0cmVlIHRvIGJlIHNjYW5uZWQgKi8KICAvLyAgICBpbnQgbWF4X2NvZGU7ICAgICAgIC8qIGFuZCBpdHMgbGFyZ2VzdCBjb2RlIG9mIG5vbiB6ZXJvIGZyZXF1ZW5jeSAqLwogIHsKICAgIGxldCBuOyAgICAgICAgICAgICAgICAgICAgIC8qIGl0ZXJhdGVzIG92ZXIgYWxsIHRyZWUgZWxlbWVudHMgKi8KICAgIGxldCBwcmV2bGVuID0gLTE7ICAgICAgICAgIC8qIGxhc3QgZW1pdHRlZCBsZW5ndGggKi8KICAgIGxldCBjdXJsZW47ICAgICAgICAgICAgICAgIC8qIGxlbmd0aCBvZiBjdXJyZW50IGNvZGUgKi8KCiAgICBsZXQgbmV4dGxlbiA9IHRyZWVbMCAqIDIgKyAxXS8qLkxlbiovOyAvKiBsZW5ndGggb2YgbmV4dCBjb2RlICovCgogICAgbGV0IGNvdW50ID0gMDsgICAgICAgICAgICAgLyogcmVwZWF0IGNvdW50IG9mIHRoZSBjdXJyZW50IGNvZGUgKi8KICAgIGxldCBtYXhfY291bnQgPSA3OyAgICAgICAgIC8qIG1heCByZXBlYXQgY291bnQgKi8KICAgIGxldCBtaW5fY291bnQgPSA0OyAgICAgICAgIC8qIG1pbiByZXBlYXQgY291bnQgKi8KCiAgICAvKiB0cmVlW21heF9jb2RlKzFdLkxlbiA9IC0xOyAqLyAgLyogZ3VhcmQgYWxyZWFkeSBzZXQgKi8KICAgIGlmIChuZXh0bGVuID09PSAwKSB7CiAgICAgIG1heF9jb3VudCA9IDEzODsKICAgICAgbWluX2NvdW50ID0gMzsKICAgIH0KCiAgICBmb3IgKG4gPSAwOyBuIDw9IG1heF9jb2RlOyBuKyspIHsKICAgICAgY3VybGVuID0gbmV4dGxlbjsKICAgICAgbmV4dGxlbiA9IHRyZWVbKG4gKyAxKSAqIDIgKyAxXS8qLkxlbiovOwoKICAgICAgaWYgKCsrY291bnQgPCBtYXhfY291bnQgJiYgY3VybGVuID09PSBuZXh0bGVuKSB7CiAgICAgICAgY29udGludWU7CgogICAgICB9IGVsc2UgaWYgKGNvdW50IDwgbWluX2NvdW50KSB7CiAgICAgICAgZG8geyBzZW5kX2NvZGUocywgY3VybGVuLCBzLmJsX3RyZWUpOyB9IHdoaWxlICgtLWNvdW50ICE9PSAwKTsKCiAgICAgIH0gZWxzZSBpZiAoY3VybGVuICE9PSAwKSB7CiAgICAgICAgaWYgKGN1cmxlbiAhPT0gcHJldmxlbikgewogICAgICAgICAgc2VuZF9jb2RlKHMsIGN1cmxlbiwgcy5ibF90cmVlKTsKICAgICAgICAgIGNvdW50LS07CiAgICAgICAgfQogICAgICAgIC8vQXNzZXJ0KGNvdW50ID49IDMgJiYgY291bnQgPD0gNiwgIiAzXzY/Iik7CiAgICAgICAgc2VuZF9jb2RlKHMsIFJFUF8zXzYsIHMuYmxfdHJlZSk7CiAgICAgICAgc2VuZF9iaXRzKHMsIGNvdW50IC0gMywgMik7CgogICAgICB9IGVsc2UgaWYgKGNvdW50IDw9IDEwKSB7CiAgICAgICAgc2VuZF9jb2RlKHMsIFJFUFpfM18xMCwgcy5ibF90cmVlKTsKICAgICAgICBzZW5kX2JpdHMocywgY291bnQgLSAzLCAzKTsKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VuZF9jb2RlKHMsIFJFUFpfMTFfMTM4LCBzLmJsX3RyZWUpOwogICAgICAgIHNlbmRfYml0cyhzLCBjb3VudCAtIDExLCA3KTsKICAgICAgfQoKICAgICAgY291bnQgPSAwOwogICAgICBwcmV2bGVuID0gY3VybGVuOwogICAgICBpZiAobmV4dGxlbiA9PT0gMCkgewogICAgICAgIG1heF9jb3VudCA9IDEzODsKICAgICAgICBtaW5fY291bnQgPSAzOwoKICAgICAgfSBlbHNlIGlmIChjdXJsZW4gPT09IG5leHRsZW4pIHsKICAgICAgICBtYXhfY291bnQgPSA2OwogICAgICAgIG1pbl9jb3VudCA9IDM7CgogICAgICB9IGVsc2UgewogICAgICAgIG1heF9jb3VudCA9IDc7CiAgICAgICAgbWluX2NvdW50ID0gNDsKICAgICAgfQogICAgfQogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb25zdHJ1Y3QgdGhlIEh1ZmZtYW4gdHJlZSBmb3IgdGhlIGJpdCBsZW5ndGhzIGFuZCByZXR1cm4gdGhlIGluZGV4IGluCiAgICogYmxfb3JkZXIgb2YgdGhlIGxhc3QgYml0IGxlbmd0aCBjb2RlIHRvIHNlbmQuCiAgICovCiAgY29uc3QgYnVpbGRfYmxfdHJlZSA9IChzKSA9PiB7CgogICAgbGV0IG1heF9ibGluZGV4OyAgLyogaW5kZXggb2YgbGFzdCBiaXQgbGVuZ3RoIGNvZGUgb2Ygbm9uIHplcm8gZnJlcSAqLwoKICAgIC8qIERldGVybWluZSB0aGUgYml0IGxlbmd0aCBmcmVxdWVuY2llcyBmb3IgbGl0ZXJhbCBhbmQgZGlzdGFuY2UgdHJlZXMgKi8KICAgIHNjYW5fdHJlZShzLCBzLmR5bl9sdHJlZSwgcy5sX2Rlc2MubWF4X2NvZGUpOwogICAgc2Nhbl90cmVlKHMsIHMuZHluX2R0cmVlLCBzLmRfZGVzYy5tYXhfY29kZSk7CgogICAgLyogQnVpbGQgdGhlIGJpdCBsZW5ndGggdHJlZTogKi8KICAgIGJ1aWxkX3RyZWUocywgcy5ibF9kZXNjKTsKICAgIC8qIG9wdF9sZW4gbm93IGluY2x1ZGVzIHRoZSBsZW5ndGggb2YgdGhlIHRyZWUgcmVwcmVzZW50YXRpb25zLCBleGNlcHQKICAgICAqIHRoZSBsZW5ndGhzIG9mIHRoZSBiaXQgbGVuZ3RocyBjb2RlcyBhbmQgdGhlIDUrNSs0IGJpdHMgZm9yIHRoZSBjb3VudHMuCiAgICAgKi8KCiAgICAvKiBEZXRlcm1pbmUgdGhlIG51bWJlciBvZiBiaXQgbGVuZ3RoIGNvZGVzIHRvIHNlbmQuIFRoZSBwa3ppcCBmb3JtYXQKICAgICAqIHJlcXVpcmVzIHRoYXQgYXQgbGVhc3QgNCBiaXQgbGVuZ3RoIGNvZGVzIGJlIHNlbnQuIChhcHBub3RlLnR4dCBzYXlzCiAgICAgKiAzIGJ1dCB0aGUgYWN0dWFsIHZhbHVlIHVzZWQgaXMgNC4pCiAgICAgKi8KICAgIGZvciAobWF4X2JsaW5kZXggPSBCTF9DT0RFUyQxIC0gMTsgbWF4X2JsaW5kZXggPj0gMzsgbWF4X2JsaW5kZXgtLSkgewogICAgICBpZiAocy5ibF90cmVlW2JsX29yZGVyW21heF9ibGluZGV4XSAqIDIgKyAxXS8qLkxlbiovICE9PSAwKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIC8qIFVwZGF0ZSBvcHRfbGVuIHRvIGluY2x1ZGUgdGhlIGJpdCBsZW5ndGggdHJlZSBhbmQgY291bnRzICovCiAgICBzLm9wdF9sZW4gKz0gMyAqIChtYXhfYmxpbmRleCArIDEpICsgNSArIDUgKyA0OwogICAgLy9UcmFjZXYoKHN0ZGVyciwgIlxuZHluIHRyZWVzOiBkeW4gJWxkLCBzdGF0ICVsZCIsCiAgICAvLyAgICAgICAgcy0+b3B0X2xlbiwgcy0+c3RhdGljX2xlbikpOwoKICAgIHJldHVybiBtYXhfYmxpbmRleDsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogU2VuZCB0aGUgaGVhZGVyIGZvciBhIGJsb2NrIHVzaW5nIGR5bmFtaWMgSHVmZm1hbiB0cmVlczogdGhlIGNvdW50cywgdGhlCiAgICogbGVuZ3RocyBvZiB0aGUgYml0IGxlbmd0aCBjb2RlcywgdGhlIGxpdGVyYWwgdHJlZSBhbmQgdGhlIGRpc3RhbmNlIHRyZWUuCiAgICogSU4gYXNzZXJ0aW9uOiBsY29kZXMgPj0gMjU3LCBkY29kZXMgPj0gMSwgYmxjb2RlcyA+PSA0LgogICAqLwogIGNvbnN0IHNlbmRfYWxsX3RyZWVzID0gKHMsIGxjb2RlcywgZGNvZGVzLCBibGNvZGVzKSA9PgogIC8vICAgIGRlZmxhdGVfc3RhdGUgKnM7CiAgLy8gICAgaW50IGxjb2RlcywgZGNvZGVzLCBibGNvZGVzOyAvKiBudW1iZXIgb2YgY29kZXMgZm9yIGVhY2ggdHJlZSAqLwogIHsKICAgIGxldCByYW5rOyAgICAgICAgICAgICAgICAgICAgLyogaW5kZXggaW4gYmxfb3JkZXIgKi8KCiAgICAvL0Fzc2VydCAobGNvZGVzID49IDI1NyAmJiBkY29kZXMgPj0gMSAmJiBibGNvZGVzID49IDQsICJub3QgZW5vdWdoIGNvZGVzIik7CiAgICAvL0Fzc2VydCAobGNvZGVzIDw9IExfQ09ERVMgJiYgZGNvZGVzIDw9IERfQ09ERVMgJiYgYmxjb2RlcyA8PSBCTF9DT0RFUywKICAgIC8vICAgICAgICAidG9vIG1hbnkgY29kZXMiKTsKICAgIC8vVHJhY2V2KChzdGRlcnIsICJcbmJsIGNvdW50czogIikpOwogICAgc2VuZF9iaXRzKHMsIGxjb2RlcyAtIDI1NywgNSk7IC8qIG5vdCArMjU1IGFzIHN0YXRlZCBpbiBhcHBub3RlLnR4dCAqLwogICAgc2VuZF9iaXRzKHMsIGRjb2RlcyAtIDEsICAgNSk7CiAgICBzZW5kX2JpdHMocywgYmxjb2RlcyAtIDQsICA0KTsgLyogbm90IC0zIGFzIHN0YXRlZCBpbiBhcHBub3RlLnR4dCAqLwogICAgZm9yIChyYW5rID0gMDsgcmFuayA8IGJsY29kZXM7IHJhbmsrKykgewogICAgICAvL1RyYWNldigoc3RkZXJyLCAiXG5ibCBjb2RlICUyZCAiLCBibF9vcmRlcltyYW5rXSkpOwogICAgICBzZW5kX2JpdHMocywgcy5ibF90cmVlW2JsX29yZGVyW3JhbmtdICogMiArIDFdLyouTGVuKi8sIDMpOwogICAgfQogICAgLy9UcmFjZXYoKHN0ZGVyciwgIlxuYmwgdHJlZTogc2VudCAlbGQiLCBzLT5iaXRzX3NlbnQpKTsKCiAgICBzZW5kX3RyZWUocywgcy5keW5fbHRyZWUsIGxjb2RlcyAtIDEpOyAvKiBsaXRlcmFsIHRyZWUgKi8KICAgIC8vVHJhY2V2KChzdGRlcnIsICJcbmxpdCB0cmVlOiBzZW50ICVsZCIsIHMtPmJpdHNfc2VudCkpOwoKICAgIHNlbmRfdHJlZShzLCBzLmR5bl9kdHJlZSwgZGNvZGVzIC0gMSk7IC8qIGRpc3RhbmNlIHRyZWUgKi8KICAgIC8vVHJhY2V2KChzdGRlcnIsICJcbmRpc3QgdHJlZTogc2VudCAlbGQiLCBzLT5iaXRzX3NlbnQpKTsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogQ2hlY2sgaWYgdGhlIGRhdGEgdHlwZSBpcyBURVhUIG9yIEJJTkFSWSwgdXNpbmcgdGhlIGZvbGxvd2luZyBhbGdvcml0aG06CiAgICogLSBURVhUIGlmIHRoZSB0d28gY29uZGl0aW9ucyBiZWxvdyBhcmUgc2F0aXNmaWVkOgogICAqICAgIGEpIFRoZXJlIGFyZSBubyBub24tcG9ydGFibGUgY29udHJvbCBjaGFyYWN0ZXJzIGJlbG9uZ2luZyB0byB0aGUKICAgKiAgICAgICAiYmxhY2sgbGlzdCIgKDAuLjYsIDE0Li4yNSwgMjguLjMxKS4KICAgKiAgICBiKSBUaGVyZSBpcyBhdCBsZWFzdCBvbmUgcHJpbnRhYmxlIGNoYXJhY3RlciBiZWxvbmdpbmcgdG8gdGhlCiAgICogICAgICAgIndoaXRlIGxpc3QiICg5IHtUQUJ9LCAxMCB7TEZ9LCAxMyB7Q1J9LCAzMi4uMjU1KS4KICAgKiAtIEJJTkFSWSBvdGhlcndpc2UuCiAgICogLSBUaGUgZm9sbG93aW5nIHBhcnRpYWxseS1wb3J0YWJsZSBjb250cm9sIGNoYXJhY3RlcnMgZm9ybSBhCiAgICogICAiZ3JheSBsaXN0IiB0aGF0IGlzIGlnbm9yZWQgaW4gdGhpcyBkZXRlY3Rpb24gYWxnb3JpdGhtOgogICAqICAgKDcge0JFTH0sIDgge0JTfSwgMTEge1ZUfSwgMTIge0ZGfSwgMjYge1NVQn0sIDI3IHtFU0N9KS4KICAgKiBJTiBhc3NlcnRpb246IHRoZSBmaWVsZHMgRnJlcSBvZiBkeW5fbHRyZWUgYXJlIHNldC4KICAgKi8KICBjb25zdCBkZXRlY3RfZGF0YV90eXBlID0gKHMpID0+IHsKICAgIC8qIGJsYWNrX21hc2sgaXMgdGhlIGJpdCBtYXNrIG9mIGJsYWNrLWxpc3RlZCBieXRlcwogICAgICogc2V0IGJpdHMgMC4uNiwgMTQuLjI1LCBhbmQgMjguLjMxCiAgICAgKiAweGYzZmZjMDdmID0gYmluYXJ5IDExMTEwMDExMTExMTExMTExMTAwMDAwMDAxMTExMTExCiAgICAgKi8KICAgIGxldCBibGFja19tYXNrID0gMHhmM2ZmYzA3ZjsKICAgIGxldCBuOwoKICAgIC8qIENoZWNrIGZvciBub24tdGV4dHVhbCAoImJsYWNrLWxpc3RlZCIpIGJ5dGVzLiAqLwogICAgZm9yIChuID0gMDsgbiA8PSAzMTsgbisrLCBibGFja19tYXNrID4+Pj0gMSkgewogICAgICBpZiAoKGJsYWNrX21hc2sgJiAxKSAmJiAocy5keW5fbHRyZWVbbiAqIDJdLyouRnJlcSovICE9PSAwKSkgewogICAgICAgIHJldHVybiBaX0JJTkFSWTsKICAgICAgfQogICAgfQoKICAgIC8qIENoZWNrIGZvciB0ZXh0dWFsICgid2hpdGUtbGlzdGVkIikgYnl0ZXMuICovCiAgICBpZiAocy5keW5fbHRyZWVbOSAqIDJdLyouRnJlcSovICE9PSAwIHx8IHMuZHluX2x0cmVlWzEwICogMl0vKi5GcmVxKi8gIT09IDAgfHwKICAgICAgICBzLmR5bl9sdHJlZVsxMyAqIDJdLyouRnJlcSovICE9PSAwKSB7CiAgICAgIHJldHVybiBaX1RFWFQ7CiAgICB9CiAgICBmb3IgKG4gPSAzMjsgbiA8IExJVEVSQUxTJDE7IG4rKykgewogICAgICBpZiAocy5keW5fbHRyZWVbbiAqIDJdLyouRnJlcSovICE9PSAwKSB7CiAgICAgICAgcmV0dXJuIFpfVEVYVDsKICAgICAgfQogICAgfQoKICAgIC8qIFRoZXJlIGFyZSBubyAiYmxhY2stbGlzdGVkIiBvciAid2hpdGUtbGlzdGVkIiBieXRlczoKICAgICAqIHRoaXMgc3RyZWFtIGVpdGhlciBpcyBlbXB0eSBvciBoYXMgdG9sZXJhdGVkICgiZ3JheS1saXN0ZWQiKSBieXRlcyBvbmx5LgogICAgICovCiAgICByZXR1cm4gWl9CSU5BUlk7CiAgfTsKCgogIGxldCBzdGF0aWNfaW5pdF9kb25lID0gZmFsc2U7CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIEluaXRpYWxpemUgdGhlIHRyZWUgZGF0YSBzdHJ1Y3R1cmVzIGZvciBhIG5ldyB6bGliIHN0cmVhbS4KICAgKi8KICBjb25zdCBfdHJfaW5pdCQxID0gKHMpID0+CiAgewoKICAgIGlmICghc3RhdGljX2luaXRfZG9uZSkgewogICAgICB0cl9zdGF0aWNfaW5pdCgpOwogICAgICBzdGF0aWNfaW5pdF9kb25lID0gdHJ1ZTsKICAgIH0KCiAgICBzLmxfZGVzYyAgPSBuZXcgVHJlZURlc2Mocy5keW5fbHRyZWUsIHN0YXRpY19sX2Rlc2MpOwogICAgcy5kX2Rlc2MgID0gbmV3IFRyZWVEZXNjKHMuZHluX2R0cmVlLCBzdGF0aWNfZF9kZXNjKTsKICAgIHMuYmxfZGVzYyA9IG5ldyBUcmVlRGVzYyhzLmJsX3RyZWUsIHN0YXRpY19ibF9kZXNjKTsKCiAgICBzLmJpX2J1ZiA9IDA7CiAgICBzLmJpX3ZhbGlkID0gMDsKCiAgICAvKiBJbml0aWFsaXplIHRoZSBmaXJzdCBibG9jayBvZiB0aGUgZmlyc3QgZmlsZTogKi8KICAgIGluaXRfYmxvY2socyk7CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFNlbmQgYSBzdG9yZWQgYmxvY2sKICAgKi8KICBjb25zdCBfdHJfc3RvcmVkX2Jsb2NrJDEgPSAocywgYnVmLCBzdG9yZWRfbGVuLCBsYXN0KSA9PgogIC8vRGVmbGF0ZVN0YXRlICpzOwogIC8vY2hhcmYgKmJ1ZjsgICAgICAgLyogaW5wdXQgYmxvY2sgKi8KICAvL3VsZyBzdG9yZWRfbGVuOyAgIC8qIGxlbmd0aCBvZiBpbnB1dCBibG9jayAqLwogIC8vaW50IGxhc3Q7ICAgICAgICAgLyogb25lIGlmIHRoaXMgaXMgdGhlIGxhc3QgYmxvY2sgZm9yIGEgZmlsZSAqLwogIHsKICAgIHNlbmRfYml0cyhzLCAoU1RPUkVEX0JMT0NLIDw8IDEpICsgKGxhc3QgPyAxIDogMCksIDMpOyAgICAvKiBzZW5kIGJsb2NrIHR5cGUgKi8KICAgIGNvcHlfYmxvY2socywgYnVmLCBzdG9yZWRfbGVuLCB0cnVlKTsgLyogd2l0aCBoZWFkZXIgKi8KICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogU2VuZCBvbmUgZW1wdHkgc3RhdGljIGJsb2NrIHRvIGdpdmUgZW5vdWdoIGxvb2thaGVhZCBmb3IgaW5mbGF0ZS4KICAgKiBUaGlzIHRha2VzIDEwIGJpdHMsIG9mIHdoaWNoIDcgbWF5IHJlbWFpbiBpbiB0aGUgYml0IGJ1ZmZlci4KICAgKi8KICBjb25zdCBfdHJfYWxpZ24kMSA9IChzKSA9PiB7CiAgICBzZW5kX2JpdHMocywgU1RBVElDX1RSRUVTIDw8IDEsIDMpOwogICAgc2VuZF9jb2RlKHMsIEVORF9CTE9DSywgc3RhdGljX2x0cmVlKTsKICAgIGJpX2ZsdXNoKHMpOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBEZXRlcm1pbmUgdGhlIGJlc3QgZW5jb2RpbmcgZm9yIHRoZSBjdXJyZW50IGJsb2NrOiBkeW5hbWljIHRyZWVzLCBzdGF0aWMKICAgKiB0cmVlcyBvciBzdG9yZSwgYW5kIG91dHB1dCB0aGUgZW5jb2RlZCBibG9jayB0byB0aGUgemlwIGZpbGUuCiAgICovCiAgY29uc3QgX3RyX2ZsdXNoX2Jsb2NrJDEgPSAocywgYnVmLCBzdG9yZWRfbGVuLCBsYXN0KSA9PgogIC8vRGVmbGF0ZVN0YXRlICpzOwogIC8vY2hhcmYgKmJ1ZjsgICAgICAgLyogaW5wdXQgYmxvY2ssIG9yIE5VTEwgaWYgdG9vIG9sZCAqLwogIC8vdWxnIHN0b3JlZF9sZW47ICAgLyogbGVuZ3RoIG9mIGlucHV0IGJsb2NrICovCiAgLy9pbnQgbGFzdDsgICAgICAgICAvKiBvbmUgaWYgdGhpcyBpcyB0aGUgbGFzdCBibG9jayBmb3IgYSBmaWxlICovCiAgewogICAgbGV0IG9wdF9sZW5iLCBzdGF0aWNfbGVuYjsgIC8qIG9wdF9sZW4gYW5kIHN0YXRpY19sZW4gaW4gYnl0ZXMgKi8KICAgIGxldCBtYXhfYmxpbmRleCA9IDA7ICAgICAgICAvKiBpbmRleCBvZiBsYXN0IGJpdCBsZW5ndGggY29kZSBvZiBub24gemVybyBmcmVxICovCgogICAgLyogQnVpbGQgdGhlIEh1ZmZtYW4gdHJlZXMgdW5sZXNzIGEgc3RvcmVkIGJsb2NrIGlzIGZvcmNlZCAqLwogICAgaWYgKHMubGV2ZWwgPiAwKSB7CgogICAgICAvKiBDaGVjayBpZiB0aGUgZmlsZSBpcyBiaW5hcnkgb3IgdGV4dCAqLwogICAgICBpZiAocy5zdHJtLmRhdGFfdHlwZSA9PT0gWl9VTktOT1dOJDEpIHsKICAgICAgICBzLnN0cm0uZGF0YV90eXBlID0gZGV0ZWN0X2RhdGFfdHlwZShzKTsKICAgICAgfQoKICAgICAgLyogQ29uc3RydWN0IHRoZSBsaXRlcmFsIGFuZCBkaXN0YW5jZSB0cmVlcyAqLwogICAgICBidWlsZF90cmVlKHMsIHMubF9kZXNjKTsKICAgICAgLy8gVHJhY2V2KChzdGRlcnIsICJcbmxpdCBkYXRhOiBkeW4gJWxkLCBzdGF0ICVsZCIsIHMtPm9wdF9sZW4sCiAgICAgIC8vICAgICAgICBzLT5zdGF0aWNfbGVuKSk7CgogICAgICBidWlsZF90cmVlKHMsIHMuZF9kZXNjKTsKICAgICAgLy8gVHJhY2V2KChzdGRlcnIsICJcbmRpc3QgZGF0YTogZHluICVsZCwgc3RhdCAlbGQiLCBzLT5vcHRfbGVuLAogICAgICAvLyAgICAgICAgcy0+c3RhdGljX2xlbikpOwogICAgICAvKiBBdCB0aGlzIHBvaW50LCBvcHRfbGVuIGFuZCBzdGF0aWNfbGVuIGFyZSB0aGUgdG90YWwgYml0IGxlbmd0aHMgb2YKICAgICAgICogdGhlIGNvbXByZXNzZWQgYmxvY2sgZGF0YSwgZXhjbHVkaW5nIHRoZSB0cmVlIHJlcHJlc2VudGF0aW9ucy4KICAgICAgICovCgogICAgICAvKiBCdWlsZCB0aGUgYml0IGxlbmd0aCB0cmVlIGZvciB0aGUgYWJvdmUgdHdvIHRyZWVzLCBhbmQgZ2V0IHRoZSBpbmRleAogICAgICAgKiBpbiBibF9vcmRlciBvZiB0aGUgbGFzdCBiaXQgbGVuZ3RoIGNvZGUgdG8gc2VuZC4KICAgICAgICovCiAgICAgIG1heF9ibGluZGV4ID0gYnVpbGRfYmxfdHJlZShzKTsKCiAgICAgIC8qIERldGVybWluZSB0aGUgYmVzdCBlbmNvZGluZy4gQ29tcHV0ZSB0aGUgYmxvY2sgbGVuZ3RocyBpbiBieXRlcy4gKi8KICAgICAgb3B0X2xlbmIgPSAocy5vcHRfbGVuICsgMyArIDcpID4+PiAzOwogICAgICBzdGF0aWNfbGVuYiA9IChzLnN0YXRpY19sZW4gKyAzICsgNykgPj4+IDM7CgogICAgICAvLyBUcmFjZXYoKHN0ZGVyciwgIlxub3B0ICVsdSglbHUpIHN0YXQgJWx1KCVsdSkgc3RvcmVkICVsdSBsaXQgJXUgIiwKICAgICAgLy8gICAgICAgIG9wdF9sZW5iLCBzLT5vcHRfbGVuLCBzdGF0aWNfbGVuYiwgcy0+c3RhdGljX2xlbiwgc3RvcmVkX2xlbiwKICAgICAgLy8gICAgICAgIHMtPmxhc3RfbGl0KSk7CgogICAgICBpZiAoc3RhdGljX2xlbmIgPD0gb3B0X2xlbmIpIHsgb3B0X2xlbmIgPSBzdGF0aWNfbGVuYjsgfQoKICAgIH0gZWxzZSB7CiAgICAgIC8vIEFzc2VydChidWYgIT0gKGNoYXIqKTAsICJsb3N0IGJ1ZiIpOwogICAgICBvcHRfbGVuYiA9IHN0YXRpY19sZW5iID0gc3RvcmVkX2xlbiArIDU7IC8qIGZvcmNlIGEgc3RvcmVkIGJsb2NrICovCiAgICB9CgogICAgaWYgKChzdG9yZWRfbGVuICsgNCA8PSBvcHRfbGVuYikgJiYgKGJ1ZiAhPT0gLTEpKSB7CiAgICAgIC8qIDQ6IHR3byB3b3JkcyBmb3IgdGhlIGxlbmd0aHMgKi8KCiAgICAgIC8qIFRoZSB0ZXN0IGJ1ZiAhPSBOVUxMIGlzIG9ubHkgbmVjZXNzYXJ5IGlmIExJVF9CVUZTSVpFID4gV1NJWkUuCiAgICAgICAqIE90aGVyd2lzZSB3ZSBjYW4ndCBoYXZlIHByb2Nlc3NlZCBtb3JlIHRoYW4gV1NJWkUgaW5wdXQgYnl0ZXMgc2luY2UKICAgICAgICogdGhlIGxhc3QgYmxvY2sgZmx1c2gsIGJlY2F1c2UgY29tcHJlc3Npb24gd291bGQgaGF2ZSBiZWVuCiAgICAgICAqIHN1Y2Nlc3NmdWwuIElmIExJVF9CVUZTSVpFIDw9IFdTSVpFLCBpdCBpcyBuZXZlciB0b28gbGF0ZSB0bwogICAgICAgKiB0cmFuc2Zvcm0gYSBibG9jayBpbnRvIGEgc3RvcmVkIGJsb2NrLgogICAgICAgKi8KICAgICAgX3RyX3N0b3JlZF9ibG9jayQxKHMsIGJ1Ziwgc3RvcmVkX2xlbiwgbGFzdCk7CgogICAgfSBlbHNlIGlmIChzLnN0cmF0ZWd5ID09PSBaX0ZJWEVEJDEgfHwgc3RhdGljX2xlbmIgPT09IG9wdF9sZW5iKSB7CgogICAgICBzZW5kX2JpdHMocywgKFNUQVRJQ19UUkVFUyA8PCAxKSArIChsYXN0ID8gMSA6IDApLCAzKTsKICAgICAgY29tcHJlc3NfYmxvY2socywgc3RhdGljX2x0cmVlLCBzdGF0aWNfZHRyZWUpOwoKICAgIH0gZWxzZSB7CiAgICAgIHNlbmRfYml0cyhzLCAoRFlOX1RSRUVTIDw8IDEpICsgKGxhc3QgPyAxIDogMCksIDMpOwogICAgICBzZW5kX2FsbF90cmVlcyhzLCBzLmxfZGVzYy5tYXhfY29kZSArIDEsIHMuZF9kZXNjLm1heF9jb2RlICsgMSwgbWF4X2JsaW5kZXggKyAxKTsKICAgICAgY29tcHJlc3NfYmxvY2socywgcy5keW5fbHRyZWUsIHMuZHluX2R0cmVlKTsKICAgIH0KICAgIC8vIEFzc2VydCAocy0+Y29tcHJlc3NlZF9sZW4gPT0gcy0+Yml0c19zZW50LCAiYmFkIGNvbXByZXNzZWQgc2l6ZSIpOwogICAgLyogVGhlIGFib3ZlIGNoZWNrIGlzIG1hZGUgbW9kIDJeMzIsIGZvciBmaWxlcyBsYXJnZXIgdGhhbiA1MTIgTUIKICAgICAqIGFuZCB1TG9uZyBpbXBsZW1lbnRlZCBvbiAzMiBiaXRzLgogICAgICovCiAgICBpbml0X2Jsb2NrKHMpOwoKICAgIGlmIChsYXN0KSB7CiAgICAgIGJpX3dpbmR1cChzKTsKICAgIH0KICAgIC8vIFRyYWNldigoc3RkZXJyLCJcbmNvbXBybGVuICVsdSglbHUpICIsIHMtPmNvbXByZXNzZWRfbGVuPj4zLAogICAgLy8gICAgICAgcy0+Y29tcHJlc3NlZF9sZW4tNypsYXN0KSk7CiAgfTsKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogU2F2ZSB0aGUgbWF0Y2ggaW5mbyBhbmQgdGFsbHkgdGhlIGZyZXF1ZW5jeSBjb3VudHMuIFJldHVybiB0cnVlIGlmCiAgICogdGhlIGN1cnJlbnQgYmxvY2sgbXVzdCBiZSBmbHVzaGVkLgogICAqLwogIGNvbnN0IF90cl90YWxseSQxID0gKHMsIGRpc3QsIGxjKSA9PgogIC8vICAgIGRlZmxhdGVfc3RhdGUgKnM7CiAgLy8gICAgdW5zaWduZWQgZGlzdDsgIC8qIGRpc3RhbmNlIG9mIG1hdGNoZWQgc3RyaW5nICovCiAgLy8gICAgdW5zaWduZWQgbGM7ICAgIC8qIG1hdGNoIGxlbmd0aC1NSU5fTUFUQ0ggb3IgdW5tYXRjaGVkIGNoYXIgKGlmIGRpc3Q9PTApICovCiAgewogICAgLy9sZXQgb3V0X2xlbmd0aCwgaW5fbGVuZ3RoLCBkY29kZTsKCiAgICBzLnBlbmRpbmdfYnVmW3MuZF9idWYgKyBzLmxhc3RfbGl0ICogMl0gICAgID0gKGRpc3QgPj4+IDgpICYgMHhmZjsKICAgIHMucGVuZGluZ19idWZbcy5kX2J1ZiArIHMubGFzdF9saXQgKiAyICsgMV0gPSBkaXN0ICYgMHhmZjsKCiAgICBzLnBlbmRpbmdfYnVmW3MubF9idWYgKyBzLmxhc3RfbGl0XSA9IGxjICYgMHhmZjsKICAgIHMubGFzdF9saXQrKzsKCiAgICBpZiAoZGlzdCA9PT0gMCkgewogICAgICAvKiBsYyBpcyB0aGUgdW5tYXRjaGVkIGNoYXIgKi8KICAgICAgcy5keW5fbHRyZWVbbGMgKiAyXS8qLkZyZXEqLysrOwogICAgfSBlbHNlIHsKICAgICAgcy5tYXRjaGVzKys7CiAgICAgIC8qIEhlcmUsIGxjIGlzIHRoZSBtYXRjaCBsZW5ndGggLSBNSU5fTUFUQ0ggKi8KICAgICAgZGlzdC0tOyAgICAgICAgICAgICAvKiBkaXN0ID0gbWF0Y2ggZGlzdGFuY2UgLSAxICovCiAgICAgIC8vQXNzZXJ0KCh1c2gpZGlzdCA8ICh1c2gpTUFYX0RJU1QocykgJiYKICAgICAgLy8gICAgICAgKHVzaClsYyA8PSAodXNoKShNQVhfTUFUQ0gtTUlOX01BVENIKSAmJgogICAgICAvLyAgICAgICAodXNoKWRfY29kZShkaXN0KSA8ICh1c2gpRF9DT0RFUywgICJfdHJfdGFsbHk6IGJhZCBtYXRjaCIpOwoKICAgICAgcy5keW5fbHRyZWVbKF9sZW5ndGhfY29kZVtsY10gKyBMSVRFUkFMUyQxICsgMSkgKiAyXS8qLkZyZXEqLysrOwogICAgICBzLmR5bl9kdHJlZVtkX2NvZGUoZGlzdCkgKiAyXS8qLkZyZXEqLysrOwogICAgfQoKICAvLyAoISkgVGhpcyBibG9jayBpcyBkaXNhYmxlZCBpbiB6bGliIGRlZmF1bHRzLAogIC8vIGRvbid0IGVuYWJsZSBpdCBmb3IgYmluYXJ5IGNvbXBhdGliaWxpdHkKCiAgLy8jaWZkZWYgVFJVTkNBVEVfQkxPQ0sKICAvLyAgLyogVHJ5IHRvIGd1ZXNzIGlmIGl0IGlzIHByb2ZpdGFibGUgdG8gc3RvcCB0aGUgY3VycmVudCBibG9jayBoZXJlICovCiAgLy8gIGlmICgocy5sYXN0X2xpdCAmIDB4MWZmZikgPT09IDAgJiYgcy5sZXZlbCA+IDIpIHsKICAvLyAgICAvKiBDb21wdXRlIGFuIHVwcGVyIGJvdW5kIGZvciB0aGUgY29tcHJlc3NlZCBsZW5ndGggKi8KICAvLyAgICBvdXRfbGVuZ3RoID0gcy5sYXN0X2xpdCo4OwogIC8vICAgIGluX2xlbmd0aCA9IHMuc3Ryc3RhcnQgLSBzLmJsb2NrX3N0YXJ0OwogIC8vCiAgLy8gICAgZm9yIChkY29kZSA9IDA7IGRjb2RlIDwgRF9DT0RFUzsgZGNvZGUrKykgewogIC8vICAgICAgb3V0X2xlbmd0aCArPSBzLmR5bl9kdHJlZVtkY29kZSoyXS8qLkZyZXEqLyAqICg1ICsgZXh0cmFfZGJpdHNbZGNvZGVdKTsKICAvLyAgICB9CiAgLy8gICAgb3V0X2xlbmd0aCA+Pj49IDM7CiAgLy8gICAgLy9UcmFjZXYoKHN0ZGVyciwiXG5sYXN0X2xpdCAldSwgaW4gJWxkLCBvdXQgfiVsZCglbGQlJSkgIiwKICAvLyAgICAvLyAgICAgICBzLT5sYXN0X2xpdCwgaW5fbGVuZ3RoLCBvdXRfbGVuZ3RoLAogIC8vICAgIC8vICAgICAgIDEwMEwgLSBvdXRfbGVuZ3RoKjEwMEwvaW5fbGVuZ3RoKSk7CiAgLy8gICAgaWYgKHMubWF0Y2hlcyA8IChzLmxhc3RfbGl0Pj4xKS8qaW50IC8yKi8gJiYgb3V0X2xlbmd0aCA8IChpbl9sZW5ndGg+PjEpLyppbnQgLzIqLykgewogIC8vICAgICAgcmV0dXJuIHRydWU7CiAgLy8gICAgfQogIC8vICB9CiAgLy8jZW5kaWYKCiAgICByZXR1cm4gKHMubGFzdF9saXQgPT09IHMubGl0X2J1ZnNpemUgLSAxKTsKICAgIC8qIFdlIGF2b2lkIGVxdWFsaXR5IHdpdGggbGl0X2J1ZnNpemUgYmVjYXVzZSBvZiB3cmFwYXJvdW5kIGF0IDY0SwogICAgICogb24gMTYgYml0IG1hY2hpbmVzIGFuZCBiZWNhdXNlIHN0b3JlZCBibG9ja3MgYXJlIHJlc3RyaWN0ZWQgdG8KICAgICAqIDY0Sy0xIGJ5dGVzLgogICAgICovCiAgfTsKCiAgdmFyIF90cl9pbml0XzEgID0gX3RyX2luaXQkMTsKICB2YXIgX3RyX3N0b3JlZF9ibG9ja18xID0gX3RyX3N0b3JlZF9ibG9jayQxOwogIHZhciBfdHJfZmx1c2hfYmxvY2tfMSAgPSBfdHJfZmx1c2hfYmxvY2skMTsKICB2YXIgX3RyX3RhbGx5XzEgPSBfdHJfdGFsbHkkMTsKICB2YXIgX3RyX2FsaWduXzEgPSBfdHJfYWxpZ24kMTsKCiAgdmFyIHRyZWVzID0gewogIAlfdHJfaW5pdDogX3RyX2luaXRfMSwKICAJX3RyX3N0b3JlZF9ibG9jazogX3RyX3N0b3JlZF9ibG9ja18xLAogIAlfdHJfZmx1c2hfYmxvY2s6IF90cl9mbHVzaF9ibG9ja18xLAogIAlfdHJfdGFsbHk6IF90cl90YWxseV8xLAogIAlfdHJfYWxpZ246IF90cl9hbGlnbl8xCiAgfTsKCiAgLy8gTm90ZTogYWRsZXIzMiB0YWtlcyAxMiUgZm9yIGxldmVsIDAgYW5kIDIlIGZvciBsZXZlbCA2LgogIC8vIEl0IGlzbid0IHdvcnRoIGl0IHRvIG1ha2UgYWRkaXRpb25hbCBvcHRpbWl6YXRpb25zIGFzIGluIG9yaWdpbmFsLgogIC8vIFNtYWxsIHNpemUgaXMgcHJlZmVyYWJsZS4KCiAgLy8gKEMpIDE5OTUtMjAxMyBKZWFuLWxvdXAgR2FpbGx5IGFuZCBNYXJrIEFkbGVyCiAgLy8gKEMpIDIwMTQtMjAxNyBWaXRhbHkgUHV6cmluIGFuZCBBbmRyZXkgVHVwaXRzaW4KICAvLwogIC8vIFRoaXMgc29mdHdhcmUgaXMgcHJvdmlkZWQgJ2FzLWlzJywgd2l0aG91dCBhbnkgZXhwcmVzcyBvciBpbXBsaWVkCiAgLy8gd2FycmFudHkuIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzCiAgLy8gYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS4KICAvLwogIC8vIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLAogIC8vIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXQKICAvLyBmcmVlbHksIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyByZXN0cmljdGlvbnM6CiAgLy8KICAvLyAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdAogIC8vICAgY2xhaW0gdGhhdCB5b3Ugd3JvdGUgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLiBJZiB5b3UgdXNlIHRoaXMgc29mdHdhcmUKICAvLyAgIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZQogIC8vICAgYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC4KICAvLyAyLiBBbHRlcmVkIHNvdXJjZSB2ZXJzaW9ucyBtdXN0IGJlIHBsYWlubHkgbWFya2VkIGFzIHN1Y2gsIGFuZCBtdXN0IG5vdCBiZQogIC8vICAgbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLgogIC8vIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uCgogIGNvbnN0IGFkbGVyMzIgPSAoYWRsZXIsIGJ1ZiwgbGVuLCBwb3MpID0+IHsKICAgIGxldCBzMSA9IChhZGxlciAmIDB4ZmZmZikgfDAsCiAgICAgICAgczIgPSAoKGFkbGVyID4+PiAxNikgJiAweGZmZmYpIHwwLAogICAgICAgIG4gPSAwOwoKICAgIHdoaWxlIChsZW4gIT09IDApIHsKICAgICAgLy8gU2V0IGxpbWl0IH4gdHdpY2UgbGVzcyB0aGFuIDU1NTIsIHRvIGtlZXAKICAgICAgLy8gczIgaW4gMzEtYml0cywgYmVjYXVzZSB3ZSBmb3JjZSBzaWduZWQgaW50cy4KICAgICAgLy8gaW4gb3RoZXIgY2FzZSAlPSB3aWxsIGZhaWwuCiAgICAgIG4gPSBsZW4gPiAyMDAwID8gMjAwMCA6IGxlbjsKICAgICAgbGVuIC09IG47CgogICAgICBkbyB7CiAgICAgICAgczEgPSAoczEgKyBidWZbcG9zKytdKSB8MDsKICAgICAgICBzMiA9IChzMiArIHMxKSB8MDsKICAgICAgfSB3aGlsZSAoLS1uKTsKCiAgICAgIHMxICU9IDY1NTIxOwogICAgICBzMiAlPSA2NTUyMTsKICAgIH0KCiAgICByZXR1cm4gKHMxIHwgKHMyIDw8IDE2KSkgfDA7CiAgfTsKCgogIHZhciBhZGxlcjMyXzEgPSBhZGxlcjMyOwoKICAvLyBOb3RlOiB3ZSBjYW4ndCBnZXQgc2lnbmlmaWNhbnQgc3BlZWQgYm9vc3QgaGVyZS4KICAvLyBTbyB3cml0ZSBjb2RlIHRvIG1pbmltaXplIHNpemUgLSBubyBwcmVnZW5lcmF0ZWQgdGFibGVzCiAgLy8gYW5kIGFycmF5IHRvb2xzIGRlcGVuZGVuY2llcy4KCiAgLy8gKEMpIDE5OTUtMjAxMyBKZWFuLWxvdXAgR2FpbGx5IGFuZCBNYXJrIEFkbGVyCiAgLy8gKEMpIDIwMTQtMjAxNyBWaXRhbHkgUHV6cmluIGFuZCBBbmRyZXkgVHVwaXRzaW4KICAvLwogIC8vIFRoaXMgc29mdHdhcmUgaXMgcHJvdmlkZWQgJ2FzLWlzJywgd2l0aG91dCBhbnkgZXhwcmVzcyBvciBpbXBsaWVkCiAgLy8gd2FycmFudHkuIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzCiAgLy8gYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS4KICAvLwogIC8vIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLAogIC8vIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXQKICAvLyBmcmVlbHksIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyByZXN0cmljdGlvbnM6CiAgLy8KICAvLyAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdAogIC8vICAgY2xhaW0gdGhhdCB5b3Ugd3JvdGUgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLiBJZiB5b3UgdXNlIHRoaXMgc29mdHdhcmUKICAvLyAgIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZQogIC8vICAgYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC4KICAvLyAyLiBBbHRlcmVkIHNvdXJjZSB2ZXJzaW9ucyBtdXN0IGJlIHBsYWlubHkgbWFya2VkIGFzIHN1Y2gsIGFuZCBtdXN0IG5vdCBiZQogIC8vICAgbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLgogIC8vIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uCgogIC8vIFVzZSBvcmRpbmFyeSBhcnJheSwgc2luY2UgdW50eXBlZCBtYWtlcyBubyBib29zdCBoZXJlCiAgY29uc3QgbWFrZVRhYmxlID0gKCkgPT4gewogICAgbGV0IGMsIHRhYmxlID0gW107CgogICAgZm9yICh2YXIgbiA9IDA7IG4gPCAyNTY7IG4rKykgewogICAgICBjID0gbjsKICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCA4OyBrKyspIHsKICAgICAgICBjID0gKChjICYgMSkgPyAoMHhFREI4ODMyMCBeIChjID4+PiAxKSkgOiAoYyA+Pj4gMSkpOwogICAgICB9CiAgICAgIHRhYmxlW25dID0gYzsKICAgIH0KCiAgICByZXR1cm4gdGFibGU7CiAgfTsKCiAgLy8gQ3JlYXRlIHRhYmxlIG9uIGxvYWQuIEp1c3QgMjU1IHNpZ25lZCBsb25ncy4gTm90IGEgcHJvYmxlbS4KICBjb25zdCBjcmNUYWJsZSA9IG5ldyBVaW50MzJBcnJheShtYWtlVGFibGUoKSk7CgoKICBjb25zdCBjcmMzMiA9IChjcmMsIGJ1ZiwgbGVuLCBwb3MpID0+IHsKICAgIGNvbnN0IHQgPSBjcmNUYWJsZTsKICAgIGNvbnN0IGVuZCA9IHBvcyArIGxlbjsKCiAgICBjcmMgXj0gLTE7CgogICAgZm9yIChsZXQgaSA9IHBvczsgaSA8IGVuZDsgaSsrKSB7CiAgICAgIGNyYyA9IChjcmMgPj4+IDgpIF4gdFsoY3JjIF4gYnVmW2ldKSAmIDB4RkZdOwogICAgfQoKICAgIHJldHVybiAoY3JjIF4gKC0xKSk7IC8vID4+PiAwOwogIH07CgoKICB2YXIgY3JjMzJfMSA9IGNyYzMyOwoKICAvLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKICAvLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgogIC8vCiAgLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKICAvLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKICAvLyBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLgogIC8vCiAgLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCiAgLy8gaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdAogIC8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKICAvLwogIC8vIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90CiAgLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQogIC8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCiAgLy8gICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLgogIC8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCiAgLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCiAgLy8gMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi4KCiAgdmFyIG1lc3NhZ2VzID0gewogICAgMjogICAgICAnbmVlZCBkaWN0aW9uYXJ5JywgICAgIC8qIFpfTkVFRF9ESUNUICAgICAgIDIgICovCiAgICAxOiAgICAgICdzdHJlYW0gZW5kJywgICAgICAgICAgLyogWl9TVFJFQU1fRU5EICAgICAgMSAgKi8KICAgIDA6ICAgICAgJycsICAgICAgICAgICAgICAgICAgICAvKiBaX09LICAgICAgICAgICAgICAwICAqLwogICAgJy0xJzogICAnZmlsZSBlcnJvcicsICAgICAgICAgIC8qIFpfRVJSTk8gICAgICAgICAoLTEpICovCiAgICAnLTInOiAgICdzdHJlYW0gZXJyb3InLCAgICAgICAgLyogWl9TVFJFQU1fRVJST1IgICgtMikgKi8KICAgICctMyc6ICAgJ2RhdGEgZXJyb3InLCAgICAgICAgICAvKiBaX0RBVEFfRVJST1IgICAgKC0zKSAqLwogICAgJy00JzogICAnaW5zdWZmaWNpZW50IG1lbW9yeScsIC8qIFpfTUVNX0VSUk9SICAgICAoLTQpICovCiAgICAnLTUnOiAgICdidWZmZXIgZXJyb3InLCAgICAgICAgLyogWl9CVUZfRVJST1IgICAgICgtNSkgKi8KICAgICctNic6ICAgJ2luY29tcGF0aWJsZSB2ZXJzaW9uJyAvKiBaX1ZFUlNJT05fRVJST1IgKC02KSAqLwogIH07CgogIC8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgogIC8vIChDKSAyMDE0LTIwMTcgVml0YWx5IFB1enJpbiBhbmQgQW5kcmV5IFR1cGl0c2luCiAgLy8KICAvLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAogIC8vIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcwogIC8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCiAgLy8KICAvLyBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSwKICAvLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0CiAgLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgogIC8vCiAgLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKICAvLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCiAgLy8gICBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmUKICAvLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCiAgLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKICAvLyAgIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4KICAvLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKICB2YXIgY29uc3RhbnRzJDIgPSB7CgogICAgLyogQWxsb3dlZCBmbHVzaCB2YWx1ZXM7IHNlZSBkZWZsYXRlKCkgYW5kIGluZmxhdGUoKSBiZWxvdyBmb3IgZGV0YWlscyAqLwogICAgWl9OT19GTFVTSDogICAgICAgICAwLAogICAgWl9QQVJUSUFMX0ZMVVNIOiAgICAxLAogICAgWl9TWU5DX0ZMVVNIOiAgICAgICAyLAogICAgWl9GVUxMX0ZMVVNIOiAgICAgICAzLAogICAgWl9GSU5JU0g6ICAgICAgICAgICA0LAogICAgWl9CTE9DSzogICAgICAgICAgICA1LAogICAgWl9UUkVFUzogICAgICAgICAgICA2LAoKICAgIC8qIFJldHVybiBjb2RlcyBmb3IgdGhlIGNvbXByZXNzaW9uL2RlY29tcHJlc3Npb24gZnVuY3Rpb25zLiBOZWdhdGl2ZSB2YWx1ZXMKICAgICogYXJlIGVycm9ycywgcG9zaXRpdmUgdmFsdWVzIGFyZSB1c2VkIGZvciBzcGVjaWFsIGJ1dCBub3JtYWwgZXZlbnRzLgogICAgKi8KICAgIFpfT0s6ICAgICAgICAgICAgICAgMCwKICAgIFpfU1RSRUFNX0VORDogICAgICAgMSwKICAgIFpfTkVFRF9ESUNUOiAgICAgICAgMiwKICAgIFpfRVJSTk86ICAgICAgICAgICAtMSwKICAgIFpfU1RSRUFNX0VSUk9SOiAgICAtMiwKICAgIFpfREFUQV9FUlJPUjogICAgICAtMywKICAgIFpfTUVNX0VSUk9SOiAgICAgICAtNCwKICAgIFpfQlVGX0VSUk9SOiAgICAgICAtNSwKICAgIC8vWl9WRVJTSU9OX0VSUk9SOiAtNiwKCiAgICAvKiBjb21wcmVzc2lvbiBsZXZlbHMgKi8KICAgIFpfTk9fQ09NUFJFU1NJT046ICAgICAgICAgMCwKICAgIFpfQkVTVF9TUEVFRDogICAgICAgICAgICAgMSwKICAgIFpfQkVTVF9DT01QUkVTU0lPTjogICAgICAgOSwKICAgIFpfREVGQVVMVF9DT01QUkVTU0lPTjogICAtMSwKCgogICAgWl9GSUxURVJFRDogICAgICAgICAgICAgICAxLAogICAgWl9IVUZGTUFOX09OTFk6ICAgICAgICAgICAyLAogICAgWl9STEU6ICAgICAgICAgICAgICAgICAgICAzLAogICAgWl9GSVhFRDogICAgICAgICAgICAgICAgICA0LAogICAgWl9ERUZBVUxUX1NUUkFURUdZOiAgICAgICAwLAoKICAgIC8qIFBvc3NpYmxlIHZhbHVlcyBvZiB0aGUgZGF0YV90eXBlIGZpZWxkICh0aG91Z2ggc2VlIGluZmxhdGUoKSkgKi8KICAgIFpfQklOQVJZOiAgICAgICAgICAgICAgICAgMCwKICAgIFpfVEVYVDogICAgICAgICAgICAgICAgICAgMSwKICAgIC8vWl9BU0NJSTogICAgICAgICAgICAgICAgMSwgLy8gPSBaX1RFWFQgKGRlcHJlY2F0ZWQpCiAgICBaX1VOS05PV046ICAgICAgICAgICAgICAgIDIsCgogICAgLyogVGhlIGRlZmxhdGUgY29tcHJlc3Npb24gbWV0aG9kICovCiAgICBaX0RFRkxBVEVEOiAgICAgICAgICAgICAgIDgKICAgIC8vWl9OVUxMOiAgICAgICAgICAgICAgICAgbnVsbCAvLyBVc2UgLTEgb3IgbnVsbCBpbmxpbmUsIGRlcGVuZGluZyBvbiB2YXIgdHlwZQogIH07CgogIC8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgogIC8vIChDKSAyMDE0LTIwMTcgVml0YWx5IFB1enJpbiBhbmQgQW5kcmV5IFR1cGl0c2luCiAgLy8KICAvLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAogIC8vIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcwogIC8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCiAgLy8KICAvLyBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSwKICAvLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0CiAgLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgogIC8vCiAgLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKICAvLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCiAgLy8gICBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmUKICAvLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCiAgLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKICAvLyAgIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4KICAvLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKICBjb25zdCB7IF90cl9pbml0LCBfdHJfc3RvcmVkX2Jsb2NrLCBfdHJfZmx1c2hfYmxvY2ssIF90cl90YWxseSwgX3RyX2FsaWduIH0gPSB0cmVlczsKCgoKCiAgLyogUHVibGljIGNvbnN0YW50cyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKICBjb25zdCB7CiAgICBaX05PX0ZMVVNIOiBaX05PX0ZMVVNIJDIsIFpfUEFSVElBTF9GTFVTSCwgWl9GVUxMX0ZMVVNIOiBaX0ZVTExfRkxVU0gkMSwgWl9GSU5JU0g6IFpfRklOSVNIJDMsIFpfQkxPQ0s6IFpfQkxPQ0skMSwKICAgIFpfT0s6IFpfT0skMywgWl9TVFJFQU1fRU5EOiBaX1NUUkVBTV9FTkQkMywgWl9TVFJFQU1fRVJST1I6IFpfU1RSRUFNX0VSUk9SJDIsIFpfREFUQV9FUlJPUjogWl9EQVRBX0VSUk9SJDIsIFpfQlVGX0VSUk9SOiBaX0JVRl9FUlJPUiQxLAogICAgWl9ERUZBVUxUX0NPTVBSRVNTSU9OOiBaX0RFRkFVTFRfQ09NUFJFU1NJT04kMSwKICAgIFpfRklMVEVSRUQsIFpfSFVGRk1BTl9PTkxZLCBaX1JMRSwgWl9GSVhFRCwgWl9ERUZBVUxUX1NUUkFURUdZOiBaX0RFRkFVTFRfU1RSQVRFR1kkMSwKICAgIFpfVU5LTk9XTiwKICAgIFpfREVGTEFURUQ6IFpfREVGTEFURUQkMgogIH0gPSBjb25zdGFudHMkMjsKCiAgLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KCgogIGNvbnN0IE1BWF9NRU1fTEVWRUwgPSA5OwogIC8qIE1heGltdW0gdmFsdWUgZm9yIG1lbUxldmVsIGluIGRlZmxhdGVJbml0MiAqLwogIGNvbnN0IE1BWF9XQklUUyQxID0gMTU7CiAgLyogMzJLIExaNzcgd2luZG93ICovCiAgY29uc3QgREVGX01FTV9MRVZFTCA9IDg7CgoKICBjb25zdCBMRU5HVEhfQ09ERVMgID0gMjk7CiAgLyogbnVtYmVyIG9mIGxlbmd0aCBjb2Rlcywgbm90IGNvdW50aW5nIHRoZSBzcGVjaWFsIEVORF9CTE9DSyBjb2RlICovCiAgY29uc3QgTElURVJBTFMgICAgICA9IDI1NjsKICAvKiBudW1iZXIgb2YgbGl0ZXJhbCBieXRlcyAwLi4yNTUgKi8KICBjb25zdCBMX0NPREVTICAgICAgID0gTElURVJBTFMgKyAxICsgTEVOR1RIX0NPREVTOwogIC8qIG51bWJlciBvZiBMaXRlcmFsIG9yIExlbmd0aCBjb2RlcywgaW5jbHVkaW5nIHRoZSBFTkRfQkxPQ0sgY29kZSAqLwogIGNvbnN0IERfQ09ERVMgICAgICAgPSAzMDsKICAvKiBudW1iZXIgb2YgZGlzdGFuY2UgY29kZXMgKi8KICBjb25zdCBCTF9DT0RFUyAgICAgID0gMTk7CiAgLyogbnVtYmVyIG9mIGNvZGVzIHVzZWQgdG8gdHJhbnNmZXIgdGhlIGJpdCBsZW5ndGhzICovCiAgY29uc3QgSEVBUF9TSVpFICAgICA9IDIgKiBMX0NPREVTICsgMTsKICAvKiBtYXhpbXVtIGhlYXAgc2l6ZSAqLwogIGNvbnN0IE1BWF9CSVRTICA9IDE1OwogIC8qIEFsbCBjb2RlcyBtdXN0IG5vdCBleGNlZWQgTUFYX0JJVFMgYml0cyAqLwoKICBjb25zdCBNSU5fTUFUQ0ggPSAzOwogIGNvbnN0IE1BWF9NQVRDSCA9IDI1ODsKICBjb25zdCBNSU5fTE9PS0FIRUFEID0gKE1BWF9NQVRDSCArIE1JTl9NQVRDSCArIDEpOwoKICBjb25zdCBQUkVTRVRfRElDVCA9IDB4MjA7CgogIGNvbnN0IElOSVRfU1RBVEUgPSA0MjsKICBjb25zdCBFWFRSQV9TVEFURSA9IDY5OwogIGNvbnN0IE5BTUVfU1RBVEUgPSA3MzsKICBjb25zdCBDT01NRU5UX1NUQVRFID0gOTE7CiAgY29uc3QgSENSQ19TVEFURSA9IDEwMzsKICBjb25zdCBCVVNZX1NUQVRFID0gMTEzOwogIGNvbnN0IEZJTklTSF9TVEFURSA9IDY2NjsKCiAgY29uc3QgQlNfTkVFRF9NT1JFICAgICAgPSAxOyAvKiBibG9jayBub3QgY29tcGxldGVkLCBuZWVkIG1vcmUgaW5wdXQgb3IgbW9yZSBvdXRwdXQgKi8KICBjb25zdCBCU19CTE9DS19ET05FICAgICA9IDI7IC8qIGJsb2NrIGZsdXNoIHBlcmZvcm1lZCAqLwogIGNvbnN0IEJTX0ZJTklTSF9TVEFSVEVEID0gMzsgLyogZmluaXNoIHN0YXJ0ZWQsIG5lZWQgb25seSBtb3JlIG91dHB1dCBhdCBuZXh0IGRlZmxhdGUgKi8KICBjb25zdCBCU19GSU5JU0hfRE9ORSAgICA9IDQ7IC8qIGZpbmlzaCBkb25lLCBhY2NlcHQgbm8gbW9yZSBpbnB1dCBvciBvdXRwdXQgKi8KCiAgY29uc3QgT1NfQ09ERSA9IDB4MDM7IC8vIFVuaXggOikgLiBEb24ndCBkZXRlY3QsIHVzZSB0aGlzIGRlZmF1bHQuCgogIGNvbnN0IGVyciA9IChzdHJtLCBlcnJvckNvZGUpID0+IHsKICAgIHN0cm0ubXNnID0gbWVzc2FnZXNbZXJyb3JDb2RlXTsKICAgIHJldHVybiBlcnJvckNvZGU7CiAgfTsKCiAgY29uc3QgcmFuayA9IChmKSA9PiB7CiAgICByZXR1cm4gKChmKSA8PCAxKSAtICgoZikgPiA0ID8gOSA6IDApOwogIH07CgogIGNvbnN0IHplcm8gPSAoYnVmKSA9PiB7CiAgICBsZXQgbGVuID0gYnVmLmxlbmd0aDsgd2hpbGUgKC0tbGVuID49IDApIHsgYnVmW2xlbl0gPSAwOyB9CiAgfTsKCgogIC8qIGVzbGludC1kaXNhYmxlIG5ldy1jYXAgKi8KICBsZXQgSEFTSF9aTElCID0gKHMsIHByZXYsIGRhdGEpID0+ICgocHJldiA8PCBzLmhhc2hfc2hpZnQpIF4gZGF0YSkgJiBzLmhhc2hfbWFzazsKICAvLyBUaGlzIGhhc2ggY2F1c2VzIGxlc3MgY29sbGlzaW9ucywgaHR0cHM6Ly9naXRodWIuY29tL25vZGVjYS9wYWtvL2lzc3Vlcy8xMzUKICAvLyBCdXQgYnJlYWtzIGJpbmFyeSBjb21wYXRpYmlsaXR5CiAgLy9sZXQgSEFTSF9GQVNUID0gKHMsIHByZXYsIGRhdGEpID0+ICgocHJldiA8PCA4KSArIChwcmV2ID4+IDgpICsgKGRhdGEgPDwgNCkpICYgcy5oYXNoX21hc2s7CiAgbGV0IEhBU0ggPSBIQVNIX1pMSUI7CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBGbHVzaCBhcyBtdWNoIHBlbmRpbmcgb3V0cHV0IGFzIHBvc3NpYmxlLiBBbGwgZGVmbGF0ZSgpIG91dHB1dCBnb2VzCiAgICogdGhyb3VnaCB0aGlzIGZ1bmN0aW9uIHNvIHNvbWUgYXBwbGljYXRpb25zIG1heSB3aXNoIHRvIG1vZGlmeSBpdAogICAqIHRvIGF2b2lkIGFsbG9jYXRpbmcgYSBsYXJnZSBzdHJtLT5vdXRwdXQgYnVmZmVyIGFuZCBjb3B5aW5nIGludG8gaXQuCiAgICogKFNlZSBhbHNvIHJlYWRfYnVmKCkpLgogICAqLwogIGNvbnN0IGZsdXNoX3BlbmRpbmcgPSAoc3RybSkgPT4gewogICAgY29uc3QgcyA9IHN0cm0uc3RhdGU7CgogICAgLy9fdHJfZmx1c2hfYml0cyhzKTsKICAgIGxldCBsZW4gPSBzLnBlbmRpbmc7CiAgICBpZiAobGVuID4gc3RybS5hdmFpbF9vdXQpIHsKICAgICAgbGVuID0gc3RybS5hdmFpbF9vdXQ7CiAgICB9CiAgICBpZiAobGVuID09PSAwKSB7IHJldHVybjsgfQoKICAgIHN0cm0ub3V0cHV0LnNldChzLnBlbmRpbmdfYnVmLnN1YmFycmF5KHMucGVuZGluZ19vdXQsIHMucGVuZGluZ19vdXQgKyBsZW4pLCBzdHJtLm5leHRfb3V0KTsKICAgIHN0cm0ubmV4dF9vdXQgKz0gbGVuOwogICAgcy5wZW5kaW5nX291dCArPSBsZW47CiAgICBzdHJtLnRvdGFsX291dCArPSBsZW47CiAgICBzdHJtLmF2YWlsX291dCAtPSBsZW47CiAgICBzLnBlbmRpbmcgLT0gbGVuOwogICAgaWYgKHMucGVuZGluZyA9PT0gMCkgewogICAgICBzLnBlbmRpbmdfb3V0ID0gMDsKICAgIH0KICB9OwoKCiAgY29uc3QgZmx1c2hfYmxvY2tfb25seSA9IChzLCBsYXN0KSA9PiB7CiAgICBfdHJfZmx1c2hfYmxvY2socywgKHMuYmxvY2tfc3RhcnQgPj0gMCA/IHMuYmxvY2tfc3RhcnQgOiAtMSksIHMuc3Ryc3RhcnQgLSBzLmJsb2NrX3N0YXJ0LCBsYXN0KTsKICAgIHMuYmxvY2tfc3RhcnQgPSBzLnN0cnN0YXJ0OwogICAgZmx1c2hfcGVuZGluZyhzLnN0cm0pOwogIH07CgoKICBjb25zdCBwdXRfYnl0ZSA9IChzLCBiKSA9PiB7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IGI7CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBQdXQgYSBzaG9ydCBpbiB0aGUgcGVuZGluZyBidWZmZXIuIFRoZSAxNi1iaXQgdmFsdWUgaXMgcHV0IGluIE1TQiBvcmRlci4KICAgKiBJTiBhc3NlcnRpb246IHRoZSBzdHJlYW0gc3RhdGUgaXMgY29ycmVjdCBhbmQgdGhlcmUgaXMgZW5vdWdoIHJvb20gaW4KICAgKiBwZW5kaW5nX2J1Zi4KICAgKi8KICBjb25zdCBwdXRTaG9ydE1TQiA9IChzLCBiKSA9PiB7CgogICAgLy8gIHB1dF9ieXRlKHMsIChCeXRlKShiID4+IDgpKTsKICAvLyAgcHV0X2J5dGUocywgKEJ5dGUpKGIgJiAweGZmKSk7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IChiID4+PiA4KSAmIDB4ZmY7CiAgICBzLnBlbmRpbmdfYnVmW3MucGVuZGluZysrXSA9IGIgJiAweGZmOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBSZWFkIGEgbmV3IGJ1ZmZlciBmcm9tIHRoZSBjdXJyZW50IGlucHV0IHN0cmVhbSwgdXBkYXRlIHRoZSBhZGxlcjMyCiAgICogYW5kIHRvdGFsIG51bWJlciBvZiBieXRlcyByZWFkLiAgQWxsIGRlZmxhdGUoKSBpbnB1dCBnb2VzIHRocm91Z2gKICAgKiB0aGlzIGZ1bmN0aW9uIHNvIHNvbWUgYXBwbGljYXRpb25zIG1heSB3aXNoIHRvIG1vZGlmeSBpdCB0byBhdm9pZAogICAqIGFsbG9jYXRpbmcgYSBsYXJnZSBzdHJtLT5pbnB1dCBidWZmZXIgYW5kIGNvcHlpbmcgZnJvbSBpdC4KICAgKiAoU2VlIGFsc28gZmx1c2hfcGVuZGluZygpKS4KICAgKi8KICBjb25zdCByZWFkX2J1ZiA9IChzdHJtLCBidWYsIHN0YXJ0LCBzaXplKSA9PiB7CgogICAgbGV0IGxlbiA9IHN0cm0uYXZhaWxfaW47CgogICAgaWYgKGxlbiA+IHNpemUpIHsgbGVuID0gc2l6ZTsgfQogICAgaWYgKGxlbiA9PT0gMCkgeyByZXR1cm4gMDsgfQoKICAgIHN0cm0uYXZhaWxfaW4gLT0gbGVuOwoKICAgIC8vIHptZW1jcHkoYnVmLCBzdHJtLT5uZXh0X2luLCBsZW4pOwogICAgYnVmLnNldChzdHJtLmlucHV0LnN1YmFycmF5KHN0cm0ubmV4dF9pbiwgc3RybS5uZXh0X2luICsgbGVuKSwgc3RhcnQpOwogICAgaWYgKHN0cm0uc3RhdGUud3JhcCA9PT0gMSkgewogICAgICBzdHJtLmFkbGVyID0gYWRsZXIzMl8xKHN0cm0uYWRsZXIsIGJ1ZiwgbGVuLCBzdGFydCk7CiAgICB9CgogICAgZWxzZSBpZiAoc3RybS5zdGF0ZS53cmFwID09PSAyKSB7CiAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMl8xKHN0cm0uYWRsZXIsIGJ1ZiwgbGVuLCBzdGFydCk7CiAgICB9CgogICAgc3RybS5uZXh0X2luICs9IGxlbjsKICAgIHN0cm0udG90YWxfaW4gKz0gbGVuOwoKICAgIHJldHVybiBsZW47CiAgfTsKCgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIFNldCBtYXRjaF9zdGFydCB0byB0aGUgbG9uZ2VzdCBtYXRjaCBzdGFydGluZyBhdCB0aGUgZ2l2ZW4gc3RyaW5nIGFuZAogICAqIHJldHVybiBpdHMgbGVuZ3RoLiBNYXRjaGVzIHNob3J0ZXIgb3IgZXF1YWwgdG8gcHJldl9sZW5ndGggYXJlIGRpc2NhcmRlZCwKICAgKiBpbiB3aGljaCBjYXNlIHRoZSByZXN1bHQgaXMgZXF1YWwgdG8gcHJldl9sZW5ndGggYW5kIG1hdGNoX3N0YXJ0IGlzCiAgICogZ2FyYmFnZS4KICAgKiBJTiBhc3NlcnRpb25zOiBjdXJfbWF0Y2ggaXMgdGhlIGhlYWQgb2YgdGhlIGhhc2ggY2hhaW4gZm9yIHRoZSBjdXJyZW50CiAgICogICBzdHJpbmcgKHN0cnN0YXJ0KSBhbmQgaXRzIGRpc3RhbmNlIGlzIDw9IE1BWF9ESVNULCBhbmQgcHJldl9sZW5ndGggPj0gMQogICAqIE9VVCBhc3NlcnRpb246IHRoZSBtYXRjaCBsZW5ndGggaXMgbm90IGdyZWF0ZXIgdGhhbiBzLT5sb29rYWhlYWQuCiAgICovCiAgY29uc3QgbG9uZ2VzdF9tYXRjaCA9IChzLCBjdXJfbWF0Y2gpID0+IHsKCiAgICBsZXQgY2hhaW5fbGVuZ3RoID0gcy5tYXhfY2hhaW5fbGVuZ3RoOyAgICAgIC8qIG1heCBoYXNoIGNoYWluIGxlbmd0aCAqLwogICAgbGV0IHNjYW4gPSBzLnN0cnN0YXJ0OyAvKiBjdXJyZW50IHN0cmluZyAqLwogICAgbGV0IG1hdGNoOyAgICAgICAgICAgICAgICAgICAgICAgLyogbWF0Y2hlZCBzdHJpbmcgKi8KICAgIGxldCBsZW47ICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogbGVuZ3RoIG9mIGN1cnJlbnQgbWF0Y2ggKi8KICAgIGxldCBiZXN0X2xlbiA9IHMucHJldl9sZW5ndGg7ICAgICAgICAgICAgICAvKiBiZXN0IG1hdGNoIGxlbmd0aCBzbyBmYXIgKi8KICAgIGxldCBuaWNlX21hdGNoID0gcy5uaWNlX21hdGNoOyAgICAgICAgICAgICAvKiBzdG9wIGlmIG1hdGNoIGxvbmcgZW5vdWdoICovCiAgICBjb25zdCBsaW1pdCA9IChzLnN0cnN0YXJ0ID4gKHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkpID8KICAgICAgICBzLnN0cnN0YXJ0IC0gKHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkgOiAwLypOSUwqLzsKCiAgICBjb25zdCBfd2luID0gcy53aW5kb3c7IC8vIHNob3J0Y3V0CgogICAgY29uc3Qgd21hc2sgPSBzLndfbWFzazsKICAgIGNvbnN0IHByZXYgID0gcy5wcmV2OwoKICAgIC8qIFN0b3Agd2hlbiBjdXJfbWF0Y2ggYmVjb21lcyA8PSBsaW1pdC4gVG8gc2ltcGxpZnkgdGhlIGNvZGUsCiAgICAgKiB3ZSBwcmV2ZW50IG1hdGNoZXMgd2l0aCB0aGUgc3RyaW5nIG9mIHdpbmRvdyBpbmRleCAwLgogICAgICovCgogICAgY29uc3Qgc3RyZW5kID0gcy5zdHJzdGFydCArIE1BWF9NQVRDSDsKICAgIGxldCBzY2FuX2VuZDEgID0gX3dpbltzY2FuICsgYmVzdF9sZW4gLSAxXTsKICAgIGxldCBzY2FuX2VuZCAgID0gX3dpbltzY2FuICsgYmVzdF9sZW5dOwoKICAgIC8qIFRoZSBjb2RlIGlzIG9wdGltaXplZCBmb3IgSEFTSF9CSVRTID49IDggYW5kIE1BWF9NQVRDSC0yIG11bHRpcGxlIG9mIDE2LgogICAgICogSXQgaXMgZWFzeSB0byBnZXQgcmlkIG9mIHRoaXMgb3B0aW1pemF0aW9uIGlmIG5lY2Vzc2FyeS4KICAgICAqLwogICAgLy8gQXNzZXJ0KHMtPmhhc2hfYml0cyA+PSA4ICYmIE1BWF9NQVRDSCA9PSAyNTgsICJDb2RlIHRvbyBjbGV2ZXIiKTsKCiAgICAvKiBEbyBub3Qgd2FzdGUgdG9vIG11Y2ggdGltZSBpZiB3ZSBhbHJlYWR5IGhhdmUgYSBnb29kIG1hdGNoOiAqLwogICAgaWYgKHMucHJldl9sZW5ndGggPj0gcy5nb29kX21hdGNoKSB7CiAgICAgIGNoYWluX2xlbmd0aCA+Pj0gMjsKICAgIH0KICAgIC8qIERvIG5vdCBsb29rIGZvciBtYXRjaGVzIGJleW9uZCB0aGUgZW5kIG9mIHRoZSBpbnB1dC4gVGhpcyBpcyBuZWNlc3NhcnkKICAgICAqIHRvIG1ha2UgZGVmbGF0ZSBkZXRlcm1pbmlzdGljLgogICAgICovCiAgICBpZiAobmljZV9tYXRjaCA+IHMubG9va2FoZWFkKSB7IG5pY2VfbWF0Y2ggPSBzLmxvb2thaGVhZDsgfQoKICAgIC8vIEFzc2VydCgodWxnKXMtPnN0cnN0YXJ0IDw9IHMtPndpbmRvd19zaXplLU1JTl9MT09LQUhFQUQsICJuZWVkIGxvb2thaGVhZCIpOwoKICAgIGRvIHsKICAgICAgLy8gQXNzZXJ0KGN1cl9tYXRjaCA8IHMtPnN0cnN0YXJ0LCAibm8gZnV0dXJlIik7CiAgICAgIG1hdGNoID0gY3VyX21hdGNoOwoKICAgICAgLyogU2tpcCB0byBuZXh0IG1hdGNoIGlmIHRoZSBtYXRjaCBsZW5ndGggY2Fubm90IGluY3JlYXNlCiAgICAgICAqIG9yIGlmIHRoZSBtYXRjaCBsZW5ndGggaXMgbGVzcyB0aGFuIDIuICBOb3RlIHRoYXQgdGhlIGNoZWNrcyBiZWxvdwogICAgICAgKiBmb3IgaW5zdWZmaWNpZW50IGxvb2thaGVhZCBvbmx5IG9jY3VyIG9jY2FzaW9uYWxseSBmb3IgcGVyZm9ybWFuY2UKICAgICAgICogcmVhc29ucy4gIFRoZXJlZm9yZSB1bmluaXRpYWxpemVkIG1lbW9yeSB3aWxsIGJlIGFjY2Vzc2VkLCBhbmQKICAgICAgICogY29uZGl0aW9uYWwganVtcHMgd2lsbCBiZSBtYWRlIHRoYXQgZGVwZW5kIG9uIHRob3NlIHZhbHVlcy4KICAgICAgICogSG93ZXZlciB0aGUgbGVuZ3RoIG9mIHRoZSBtYXRjaCBpcyBsaW1pdGVkIHRvIHRoZSBsb29rYWhlYWQsIHNvCiAgICAgICAqIHRoZSBvdXRwdXQgb2YgZGVmbGF0ZSBpcyBub3QgYWZmZWN0ZWQgYnkgdGhlIHVuaW5pdGlhbGl6ZWQgdmFsdWVzLgogICAgICAgKi8KCiAgICAgIGlmIChfd2luW21hdGNoICsgYmVzdF9sZW5dICAgICAhPT0gc2Nhbl9lbmQgIHx8CiAgICAgICAgICBfd2luW21hdGNoICsgYmVzdF9sZW4gLSAxXSAhPT0gc2Nhbl9lbmQxIHx8CiAgICAgICAgICBfd2luW21hdGNoXSAgICAgICAgICAgICAgICAhPT0gX3dpbltzY2FuXSB8fAogICAgICAgICAgX3dpblsrK21hdGNoXSAgICAgICAgICAgICAgIT09IF93aW5bc2NhbiArIDFdKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIC8qIFRoZSBjaGVjayBhdCBiZXN0X2xlbi0xIGNhbiBiZSByZW1vdmVkIGJlY2F1c2UgaXQgd2lsbCBiZSBtYWRlCiAgICAgICAqIGFnYWluIGxhdGVyLiAoVGhpcyBoZXVyaXN0aWMgaXMgbm90IGFsd2F5cyBhIHdpbi4pCiAgICAgICAqIEl0IGlzIG5vdCBuZWNlc3NhcnkgdG8gY29tcGFyZSBzY2FuWzJdIGFuZCBtYXRjaFsyXSBzaW5jZSB0aGV5CiAgICAgICAqIGFyZSBhbHdheXMgZXF1YWwgd2hlbiB0aGUgb3RoZXIgYnl0ZXMgbWF0Y2gsIGdpdmVuIHRoYXQKICAgICAgICogdGhlIGhhc2gga2V5cyBhcmUgZXF1YWwgYW5kIHRoYXQgSEFTSF9CSVRTID49IDguCiAgICAgICAqLwogICAgICBzY2FuICs9IDI7CiAgICAgIG1hdGNoKys7CiAgICAgIC8vIEFzc2VydCgqc2NhbiA9PSAqbWF0Y2gsICJtYXRjaFsyXT8iKTsKCiAgICAgIC8qIFdlIGNoZWNrIGZvciBpbnN1ZmZpY2llbnQgbG9va2FoZWFkIG9ubHkgZXZlcnkgOHRoIGNvbXBhcmlzb247CiAgICAgICAqIHRoZSAyNTZ0aCBjaGVjayB3aWxsIGJlIG1hZGUgYXQgc3Ryc3RhcnQrMjU4LgogICAgICAgKi8KICAgICAgZG8gewogICAgICAgIC8qanNoaW50IG5vZW1wdHk6ZmFsc2UqLwogICAgICB9IHdoaWxlIChfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmCiAgICAgICAgICAgICAgIF93aW5bKytzY2FuXSA9PT0gX3dpblsrK21hdGNoXSAmJiBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYKICAgICAgICAgICAgICAgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmIF93aW5bKytzY2FuXSA9PT0gX3dpblsrK21hdGNoXSAmJgogICAgICAgICAgICAgICBfd2luWysrc2Nhbl0gPT09IF93aW5bKyttYXRjaF0gJiYgX3dpblsrK3NjYW5dID09PSBfd2luWysrbWF0Y2hdICYmCiAgICAgICAgICAgICAgIHNjYW4gPCBzdHJlbmQpOwoKICAgICAgLy8gQXNzZXJ0KHNjYW4gPD0gcy0+d2luZG93Kyh1bnNpZ25lZCkocy0+d2luZG93X3NpemUtMSksICJ3aWxkIHNjYW4iKTsKCiAgICAgIGxlbiA9IE1BWF9NQVRDSCAtIChzdHJlbmQgLSBzY2FuKTsKICAgICAgc2NhbiA9IHN0cmVuZCAtIE1BWF9NQVRDSDsKCiAgICAgIGlmIChsZW4gPiBiZXN0X2xlbikgewogICAgICAgIHMubWF0Y2hfc3RhcnQgPSBjdXJfbWF0Y2g7CiAgICAgICAgYmVzdF9sZW4gPSBsZW47CiAgICAgICAgaWYgKGxlbiA+PSBuaWNlX21hdGNoKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgc2Nhbl9lbmQxICA9IF93aW5bc2NhbiArIGJlc3RfbGVuIC0gMV07CiAgICAgICAgc2Nhbl9lbmQgICA9IF93aW5bc2NhbiArIGJlc3RfbGVuXTsKICAgICAgfQogICAgfSB3aGlsZSAoKGN1cl9tYXRjaCA9IHByZXZbY3VyX21hdGNoICYgd21hc2tdKSA+IGxpbWl0ICYmIC0tY2hhaW5fbGVuZ3RoICE9PSAwKTsKCiAgICBpZiAoYmVzdF9sZW4gPD0gcy5sb29rYWhlYWQpIHsKICAgICAgcmV0dXJuIGJlc3RfbGVuOwogICAgfQogICAgcmV0dXJuIHMubG9va2FoZWFkOwogIH07CgoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBGaWxsIHRoZSB3aW5kb3cgd2hlbiB0aGUgbG9va2FoZWFkIGJlY29tZXMgaW5zdWZmaWNpZW50LgogICAqIFVwZGF0ZXMgc3Ryc3RhcnQgYW5kIGxvb2thaGVhZC4KICAgKgogICAqIElOIGFzc2VydGlvbjogbG9va2FoZWFkIDwgTUlOX0xPT0tBSEVBRAogICAqIE9VVCBhc3NlcnRpb25zOiBzdHJzdGFydCA8PSB3aW5kb3dfc2l6ZS1NSU5fTE9PS0FIRUFECiAgICogICAgQXQgbGVhc3Qgb25lIGJ5dGUgaGFzIGJlZW4gcmVhZCwgb3IgYXZhaWxfaW4gPT0gMDsgcmVhZHMgYXJlCiAgICogICAgcGVyZm9ybWVkIGZvciBhdCBsZWFzdCB0d28gYnl0ZXMgKHJlcXVpcmVkIGZvciB0aGUgemlwIHRyYW5zbGF0ZV9lb2wKICAgKiAgICBvcHRpb24gLS0gbm90IHN1cHBvcnRlZCBoZXJlKS4KICAgKi8KICBjb25zdCBmaWxsX3dpbmRvdyA9IChzKSA9PiB7CgogICAgY29uc3QgX3dfc2l6ZSA9IHMud19zaXplOwogICAgbGV0IHAsIG4sIG0sIG1vcmUsIHN0cjsKCiAgICAvL0Fzc2VydChzLT5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFELCAiYWxyZWFkeSBlbm91Z2ggbG9va2FoZWFkIik7CgogICAgZG8gewogICAgICBtb3JlID0gcy53aW5kb3dfc2l6ZSAtIHMubG9va2FoZWFkIC0gcy5zdHJzdGFydDsKCiAgICAgIC8vIEpTIGludHMgaGF2ZSAzMiBiaXQsIGJsb2NrIGJlbG93IG5vdCBuZWVkZWQKICAgICAgLyogRGVhbCB3aXRoICFAIyQlIDY0SyBsaW1pdDogKi8KICAgICAgLy9pZiAoc2l6ZW9mKGludCkgPD0gMikgewogICAgICAvLyAgICBpZiAobW9yZSA9PSAwICYmIHMtPnN0cnN0YXJ0ID09IDAgJiYgcy0+bG9va2FoZWFkID09IDApIHsKICAgICAgLy8gICAgICAgIG1vcmUgPSB3c2l6ZTsKICAgICAgLy8KICAgICAgLy8gIH0gZWxzZSBpZiAobW9yZSA9PSAodW5zaWduZWQpKC0xKSkgewogICAgICAvLyAgICAgICAgLyogVmVyeSB1bmxpa2VseSwgYnV0IHBvc3NpYmxlIG9uIDE2IGJpdCBtYWNoaW5lIGlmCiAgICAgIC8vICAgICAgICAgKiBzdHJzdGFydCA9PSAwICYmIGxvb2thaGVhZCA9PSAxIChpbnB1dCBkb25lIGEgYnl0ZSBhdCB0aW1lKQogICAgICAvLyAgICAgICAgICovCiAgICAgIC8vICAgICAgICBtb3JlLS07CiAgICAgIC8vICAgIH0KICAgICAgLy99CgoKICAgICAgLyogSWYgdGhlIHdpbmRvdyBpcyBhbG1vc3QgZnVsbCBhbmQgdGhlcmUgaXMgaW5zdWZmaWNpZW50IGxvb2thaGVhZCwKICAgICAgICogbW92ZSB0aGUgdXBwZXIgaGFsZiB0byB0aGUgbG93ZXIgb25lIHRvIG1ha2Ugcm9vbSBpbiB0aGUgdXBwZXIgaGFsZi4KICAgICAgICovCiAgICAgIGlmIChzLnN0cnN0YXJ0ID49IF93X3NpemUgKyAoX3dfc2l6ZSAtIE1JTl9MT09LQUhFQUQpKSB7CgogICAgICAgIHMud2luZG93LnNldChzLndpbmRvdy5zdWJhcnJheShfd19zaXplLCBfd19zaXplICsgX3dfc2l6ZSksIDApOwogICAgICAgIHMubWF0Y2hfc3RhcnQgLT0gX3dfc2l6ZTsKICAgICAgICBzLnN0cnN0YXJ0IC09IF93X3NpemU7CiAgICAgICAgLyogd2Ugbm93IGhhdmUgc3Ryc3RhcnQgPj0gTUFYX0RJU1QgKi8KICAgICAgICBzLmJsb2NrX3N0YXJ0IC09IF93X3NpemU7CgogICAgICAgIC8qIFNsaWRlIHRoZSBoYXNoIHRhYmxlIChjb3VsZCBiZSBhdm9pZGVkIHdpdGggMzIgYml0IHZhbHVlcwogICAgICAgICBhdCB0aGUgZXhwZW5zZSBvZiBtZW1vcnkgdXNhZ2UpLiBXZSBzbGlkZSBldmVuIHdoZW4gbGV2ZWwgPT0gMAogICAgICAgICB0byBrZWVwIHRoZSBoYXNoIHRhYmxlIGNvbnNpc3RlbnQgaWYgd2Ugc3dpdGNoIGJhY2sgdG8gbGV2ZWwgPiAwCiAgICAgICAgIGxhdGVyLiAoVXNpbmcgbGV2ZWwgMCBwZXJtYW5lbnRseSBpcyBub3QgYW4gb3B0aW1hbCB1c2FnZSBvZgogICAgICAgICB6bGliLCBzbyB3ZSBkb24ndCBjYXJlIGFib3V0IHRoaXMgcGF0aG9sb2dpY2FsIGNhc2UuKQogICAgICAgICAqLwoKICAgICAgICBuID0gcy5oYXNoX3NpemU7CiAgICAgICAgcCA9IG47CgogICAgICAgIGRvIHsKICAgICAgICAgIG0gPSBzLmhlYWRbLS1wXTsKICAgICAgICAgIHMuaGVhZFtwXSA9IChtID49IF93X3NpemUgPyBtIC0gX3dfc2l6ZSA6IDApOwogICAgICAgIH0gd2hpbGUgKC0tbik7CgogICAgICAgIG4gPSBfd19zaXplOwogICAgICAgIHAgPSBuOwoKICAgICAgICBkbyB7CiAgICAgICAgICBtID0gcy5wcmV2Wy0tcF07CiAgICAgICAgICBzLnByZXZbcF0gPSAobSA+PSBfd19zaXplID8gbSAtIF93X3NpemUgOiAwKTsKICAgICAgICAgIC8qIElmIG4gaXMgbm90IG9uIGFueSBoYXNoIGNoYWluLCBwcmV2W25dIGlzIGdhcmJhZ2UgYnV0CiAgICAgICAgICAgKiBpdHMgdmFsdWUgd2lsbCBuZXZlciBiZSB1c2VkLgogICAgICAgICAgICovCiAgICAgICAgfSB3aGlsZSAoLS1uKTsKCiAgICAgICAgbW9yZSArPSBfd19zaXplOwogICAgICB9CiAgICAgIGlmIChzLnN0cm0uYXZhaWxfaW4gPT09IDApIHsKICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgLyogSWYgdGhlcmUgd2FzIG5vIHNsaWRpbmc6CiAgICAgICAqICAgIHN0cnN0YXJ0IDw9IFdTSVpFK01BWF9ESVNULTEgJiYgbG9va2FoZWFkIDw9IE1JTl9MT09LQUhFQUQgLSAxICYmCiAgICAgICAqICAgIG1vcmUgPT0gd2luZG93X3NpemUgLSBsb29rYWhlYWQgLSBzdHJzdGFydAogICAgICAgKiA9PiBtb3JlID49IHdpbmRvd19zaXplIC0gKE1JTl9MT09LQUhFQUQtMSArIFdTSVpFICsgTUFYX0RJU1QtMSkKICAgICAgICogPT4gbW9yZSA+PSB3aW5kb3dfc2l6ZSAtIDIqV1NJWkUgKyAyCiAgICAgICAqIEluIHRoZSBCSUdfTUVNIG9yIE1NQVAgY2FzZSAobm90IHlldCBzdXBwb3J0ZWQpLAogICAgICAgKiAgIHdpbmRvd19zaXplID09IGlucHV0X3NpemUgKyBNSU5fTE9PS0FIRUFEICAmJgogICAgICAgKiAgIHN0cnN0YXJ0ICsgcy0+bG9va2FoZWFkIDw9IGlucHV0X3NpemUgPT4gbW9yZSA+PSBNSU5fTE9PS0FIRUFELgogICAgICAgKiBPdGhlcndpc2UsIHdpbmRvd19zaXplID09IDIqV1NJWkUgc28gbW9yZSA+PSAyLgogICAgICAgKiBJZiB0aGVyZSB3YXMgc2xpZGluZywgbW9yZSA+PSBXU0laRS4gU28gaW4gYWxsIGNhc2VzLCBtb3JlID49IDIuCiAgICAgICAqLwogICAgICAvL0Fzc2VydChtb3JlID49IDIsICJtb3JlIDwgMiIpOwogICAgICBuID0gcmVhZF9idWYocy5zdHJtLCBzLndpbmRvdywgcy5zdHJzdGFydCArIHMubG9va2FoZWFkLCBtb3JlKTsKICAgICAgcy5sb29rYWhlYWQgKz0gbjsKCiAgICAgIC8qIEluaXRpYWxpemUgdGhlIGhhc2ggdmFsdWUgbm93IHRoYXQgd2UgaGF2ZSBzb21lIGlucHV0OiAqLwogICAgICBpZiAocy5sb29rYWhlYWQgKyBzLmluc2VydCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICBzdHIgPSBzLnN0cnN0YXJ0IC0gcy5pbnNlcnQ7CiAgICAgICAgcy5pbnNfaCA9IHMud2luZG93W3N0cl07CgogICAgICAgIC8qIFVQREFURV9IQVNIKHMsIHMtPmluc19oLCBzLT53aW5kb3dbc3RyICsgMV0pOyAqLwogICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3N0ciArIDFdKTsKICAvLyNpZiBNSU5fTUFUQ0ggIT0gMwogIC8vICAgICAgICBDYWxsIHVwZGF0ZV9oYXNoKCkgTUlOX01BVENILTMgbW9yZSB0aW1lcwogIC8vI2VuZGlmCiAgICAgICAgd2hpbGUgKHMuaW5zZXJ0KSB7CiAgICAgICAgICAvKiBVUERBVEVfSEFTSChzLCBzLT5pbnNfaCwgcy0+d2luZG93W3N0ciArIE1JTl9NQVRDSC0xXSk7ICovCiAgICAgICAgICBzLmluc19oID0gSEFTSChzLCBzLmluc19oLCBzLndpbmRvd1tzdHIgKyBNSU5fTUFUQ0ggLSAxXSk7CgogICAgICAgICAgcy5wcmV2W3N0ciAmIHMud19tYXNrXSA9IHMuaGVhZFtzLmluc19oXTsKICAgICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHN0cjsKICAgICAgICAgIHN0cisrOwogICAgICAgICAgcy5pbnNlcnQtLTsKICAgICAgICAgIGlmIChzLmxvb2thaGVhZCArIHMuaW5zZXJ0IDwgTUlOX01BVENIKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAvKiBJZiB0aGUgd2hvbGUgaW5wdXQgaGFzIGxlc3MgdGhhbiBNSU5fTUFUQ0ggYnl0ZXMsIGluc19oIGlzIGdhcmJhZ2UsCiAgICAgICAqIGJ1dCB0aGlzIGlzIG5vdCBpbXBvcnRhbnQgc2luY2Ugb25seSBsaXRlcmFsIGJ5dGVzIHdpbGwgYmUgZW1pdHRlZC4KICAgICAgICovCgogICAgfSB3aGlsZSAocy5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFEICYmIHMuc3RybS5hdmFpbF9pbiAhPT0gMCk7CgogICAgLyogSWYgdGhlIFdJTl9JTklUIGJ5dGVzIGFmdGVyIHRoZSBlbmQgb2YgdGhlIGN1cnJlbnQgZGF0YSBoYXZlIG5ldmVyIGJlZW4KICAgICAqIHdyaXR0ZW4sIHRoZW4gemVybyB0aG9zZSBieXRlcyBpbiBvcmRlciB0byBhdm9pZCBtZW1vcnkgY2hlY2sgcmVwb3J0cyBvZgogICAgICogdGhlIHVzZSBvZiB1bmluaXRpYWxpemVkIChvciB1bmluaXRpYWxpc2VkIGFzIEp1bGlhbiB3cml0ZXMpIGJ5dGVzIGJ5CiAgICAgKiB0aGUgbG9uZ2VzdCBtYXRjaCByb3V0aW5lcy4gIFVwZGF0ZSB0aGUgaGlnaCB3YXRlciBtYXJrIGZvciB0aGUgbmV4dAogICAgICogdGltZSB0aHJvdWdoIGhlcmUuICBXSU5fSU5JVCBpcyBzZXQgdG8gTUFYX01BVENIIHNpbmNlIHRoZSBsb25nZXN0IG1hdGNoCiAgICAgKiByb3V0aW5lcyBhbGxvdyBzY2FubmluZyB0byBzdHJzdGFydCArIE1BWF9NQVRDSCwgaWdub3JpbmcgbG9va2FoZWFkLgogICAgICovCiAgLy8gIGlmIChzLmhpZ2hfd2F0ZXIgPCBzLndpbmRvd19zaXplKSB7CiAgLy8gICAgY29uc3QgY3VyciA9IHMuc3Ryc3RhcnQgKyBzLmxvb2thaGVhZDsKICAvLyAgICBsZXQgaW5pdCA9IDA7CiAgLy8KICAvLyAgICBpZiAocy5oaWdoX3dhdGVyIDwgY3VycikgewogIC8vICAgICAgLyogUHJldmlvdXMgaGlnaCB3YXRlciBtYXJrIGJlbG93IGN1cnJlbnQgZGF0YSAtLSB6ZXJvIFdJTl9JTklUCiAgLy8gICAgICAgKiBieXRlcyBvciB1cCB0byBlbmQgb2Ygd2luZG93LCB3aGljaGV2ZXIgaXMgbGVzcy4KICAvLyAgICAgICAqLwogIC8vICAgICAgaW5pdCA9IHMud2luZG93X3NpemUgLSBjdXJyOwogIC8vICAgICAgaWYgKGluaXQgPiBXSU5fSU5JVCkKICAvLyAgICAgICAgaW5pdCA9IFdJTl9JTklUOwogIC8vICAgICAgem1lbXplcm8ocy0+d2luZG93ICsgY3VyciwgKHVuc2lnbmVkKWluaXQpOwogIC8vICAgICAgcy0+aGlnaF93YXRlciA9IGN1cnIgKyBpbml0OwogIC8vICAgIH0KICAvLyAgICBlbHNlIGlmIChzLT5oaWdoX3dhdGVyIDwgKHVsZyljdXJyICsgV0lOX0lOSVQpIHsKICAvLyAgICAgIC8qIEhpZ2ggd2F0ZXIgbWFyayBhdCBvciBhYm92ZSBjdXJyZW50IGRhdGEsIGJ1dCBiZWxvdyBjdXJyZW50IGRhdGEKICAvLyAgICAgICAqIHBsdXMgV0lOX0lOSVQgLS0gemVybyBvdXQgdG8gY3VycmVudCBkYXRhIHBsdXMgV0lOX0lOSVQsIG9yIHVwCiAgLy8gICAgICAgKiB0byBlbmQgb2Ygd2luZG93LCB3aGljaGV2ZXIgaXMgbGVzcy4KICAvLyAgICAgICAqLwogIC8vICAgICAgaW5pdCA9ICh1bGcpY3VyciArIFdJTl9JTklUIC0gcy0+aGlnaF93YXRlcjsKICAvLyAgICAgIGlmIChpbml0ID4gcy0+d2luZG93X3NpemUgLSBzLT5oaWdoX3dhdGVyKQogIC8vICAgICAgICBpbml0ID0gcy0+d2luZG93X3NpemUgLSBzLT5oaWdoX3dhdGVyOwogIC8vICAgICAgem1lbXplcm8ocy0+d2luZG93ICsgcy0+aGlnaF93YXRlciwgKHVuc2lnbmVkKWluaXQpOwogIC8vICAgICAgcy0+aGlnaF93YXRlciArPSBpbml0OwogIC8vICAgIH0KICAvLyAgfQogIC8vCiAgLy8gIEFzc2VydCgodWxnKXMtPnN0cnN0YXJ0IDw9IHMtPndpbmRvd19zaXplIC0gTUlOX0xPT0tBSEVBRCwKICAvLyAgICAibm90IGVub3VnaCByb29tIGZvciBzZWFyY2giKTsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBDb3B5IHdpdGhvdXQgY29tcHJlc3Npb24gYXMgbXVjaCBhcyBwb3NzaWJsZSBmcm9tIHRoZSBpbnB1dCBzdHJlYW0sIHJldHVybgogICAqIHRoZSBjdXJyZW50IGJsb2NrIHN0YXRlLgogICAqIFRoaXMgZnVuY3Rpb24gZG9lcyBub3QgaW5zZXJ0IG5ldyBzdHJpbmdzIGluIHRoZSBkaWN0aW9uYXJ5IHNpbmNlCiAgICogdW5jb21wcmVzc2libGUgZGF0YSBpcyBwcm9iYWJseSBub3QgdXNlZnVsLiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQKICAgKiBvbmx5IGZvciB0aGUgbGV2ZWw9MCBjb21wcmVzc2lvbiBvcHRpb24uCiAgICogTk9URTogdGhpcyBmdW5jdGlvbiBzaG91bGQgYmUgb3B0aW1pemVkIHRvIGF2b2lkIGV4dHJhIGNvcHlpbmcgZnJvbQogICAqIHdpbmRvdyB0byBwZW5kaW5nX2J1Zi4KICAgKi8KICBjb25zdCBkZWZsYXRlX3N0b3JlZCA9IChzLCBmbHVzaCkgPT4gewoKICAgIC8qIFN0b3JlZCBibG9ja3MgYXJlIGxpbWl0ZWQgdG8gMHhmZmZmIGJ5dGVzLCBwZW5kaW5nX2J1ZiBpcyBsaW1pdGVkCiAgICAgKiB0byBwZW5kaW5nX2J1Zl9zaXplLCBhbmQgZWFjaCBzdG9yZWQgYmxvY2sgaGFzIGEgNSBieXRlIGhlYWRlcjoKICAgICAqLwogICAgbGV0IG1heF9ibG9ja19zaXplID0gMHhmZmZmOwoKICAgIGlmIChtYXhfYmxvY2tfc2l6ZSA+IHMucGVuZGluZ19idWZfc2l6ZSAtIDUpIHsKICAgICAgbWF4X2Jsb2NrX3NpemUgPSBzLnBlbmRpbmdfYnVmX3NpemUgLSA1OwogICAgfQoKICAgIC8qIENvcHkgYXMgbXVjaCBhcyBwb3NzaWJsZSBmcm9tIGlucHV0IHRvIG91dHB1dDogKi8KICAgIGZvciAoOzspIHsKICAgICAgLyogRmlsbCB0aGUgd2luZG93IGFzIG11Y2ggYXMgcG9zc2libGU6ICovCiAgICAgIGlmIChzLmxvb2thaGVhZCA8PSAxKSB7CgogICAgICAgIC8vQXNzZXJ0KHMtPnN0cnN0YXJ0IDwgcy0+d19zaXplK01BWF9ESVNUKHMpIHx8CiAgICAgICAgLy8gIHMtPmJsb2NrX3N0YXJ0ID49IChsb25nKXMtPndfc2l6ZSwgInNsaWRlIHRvbyBsYXRlIik7CiAgLy8gICAgICBpZiAoIShzLnN0cnN0YXJ0IDwgcy53X3NpemUgKyAocy53X3NpemUgLSBNSU5fTE9PS0FIRUFEKSB8fAogIC8vICAgICAgICBzLmJsb2NrX3N0YXJ0ID49IHMud19zaXplKSkgewogIC8vICAgICAgICB0aHJvdyAgbmV3IEVycm9yKCJzbGlkZSB0b28gbGF0ZSIpOwogIC8vICAgICAgfQoKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPT09IDAgJiYgZmx1c2ggPT09IFpfTk9fRkxVU0gkMikgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CgogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIC8qIGZsdXNoIHRoZSBjdXJyZW50IGJsb2NrICovCiAgICAgIH0KICAgICAgLy9Bc3NlcnQocy0+YmxvY2tfc3RhcnQgPj0gMEwsICJibG9jayBnb25lIik7CiAgLy8gICAgaWYgKHMuYmxvY2tfc3RhcnQgPCAwKSB0aHJvdyBuZXcgRXJyb3IoImJsb2NrIGdvbmUiKTsKCiAgICAgIHMuc3Ryc3RhcnQgKz0gcy5sb29rYWhlYWQ7CiAgICAgIHMubG9va2FoZWFkID0gMDsKCiAgICAgIC8qIEVtaXQgYSBzdG9yZWQgYmxvY2sgaWYgcGVuZGluZ19idWYgd2lsbCBiZSBmdWxsOiAqLwogICAgICBjb25zdCBtYXhfc3RhcnQgPSBzLmJsb2NrX3N0YXJ0ICsgbWF4X2Jsb2NrX3NpemU7CgogICAgICBpZiAocy5zdHJzdGFydCA9PT0gMCB8fCBzLnN0cnN0YXJ0ID49IG1heF9zdGFydCkgewogICAgICAgIC8qIHN0cnN0YXJ0ID09IDAgaXMgcG9zc2libGUgd2hlbiB3cmFwYXJvdW5kIG9uIDE2LWJpdCBtYWNoaW5lICovCiAgICAgICAgcy5sb29rYWhlYWQgPSBzLnN0cnN0YXJ0IC0gbWF4X3N0YXJ0OwogICAgICAgIHMuc3Ryc3RhcnQgPSBtYXhfc3RhcnQ7CiAgICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgICAvKioqLwoKCiAgICAgIH0KICAgICAgLyogRmx1c2ggaWYgd2UgbWF5IGhhdmUgdG8gc2xpZGUsIG90aGVyd2lzZSBibG9ja19zdGFydCBtYXkgYmVjb21lCiAgICAgICAqIG5lZ2F0aXZlIGFuZCB0aGUgZGF0YSB3aWxsIGJlIGdvbmU6CiAgICAgICAqLwogICAgICBpZiAocy5zdHJzdGFydCAtIHMuYmxvY2tfc3RhcnQgPj0gKHMud19zaXplIC0gTUlOX0xPT0tBSEVBRCkpIHsKICAgICAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDApOyAqKiovCiAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIC8qKiovCiAgICAgIH0KICAgIH0KCiAgICBzLmluc2VydCA9IDA7CgogICAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCQzKSB7CiAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMSk7ICoqKi8KICAgICAgZmx1c2hfYmxvY2tfb25seShzLCB0cnVlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICAgIH0KICAgICAgLyoqKi8KICAgICAgcmV0dXJuIEJTX0ZJTklTSF9ET05FOwogICAgfQoKICAgIGlmIChzLnN0cnN0YXJ0ID4gcy5ibG9ja19zdGFydCkgewogICAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDApOyAqKiovCiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgICAgLyoqKi8KICAgIH0KCiAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogIH07CgogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIENvbXByZXNzIGFzIG11Y2ggYXMgcG9zc2libGUgZnJvbSB0aGUgaW5wdXQgc3RyZWFtLCByZXR1cm4gdGhlIGN1cnJlbnQKICAgKiBibG9jayBzdGF0ZS4KICAgKiBUaGlzIGZ1bmN0aW9uIGRvZXMgbm90IHBlcmZvcm0gbGF6eSBldmFsdWF0aW9uIG9mIG1hdGNoZXMgYW5kIGluc2VydHMKICAgKiBuZXcgc3RyaW5ncyBpbiB0aGUgZGljdGlvbmFyeSBvbmx5IGZvciB1bm1hdGNoZWQgc3RyaW5ncyBvciBmb3Igc2hvcnQKICAgKiBtYXRjaGVzLiBJdCBpcyB1c2VkIG9ubHkgZm9yIHRoZSBmYXN0IGNvbXByZXNzaW9uIG9wdGlvbnMuCiAgICovCiAgY29uc3QgZGVmbGF0ZV9mYXN0ID0gKHMsIGZsdXNoKSA9PiB7CgogICAgbGV0IGhhc2hfaGVhZDsgICAgICAgIC8qIGhlYWQgb2YgdGhlIGhhc2ggY2hhaW4gKi8KICAgIGxldCBiZmx1c2g7ICAgICAgICAgICAvKiBzZXQgaWYgY3VycmVudCBibG9jayBtdXN0IGJlIGZsdXNoZWQgKi8KCiAgICBmb3IgKDs7KSB7CiAgICAgIC8qIE1ha2Ugc3VyZSB0aGF0IHdlIGFsd2F5cyBoYXZlIGVub3VnaCBsb29rYWhlYWQsIGV4Y2VwdAogICAgICAgKiBhdCB0aGUgZW5kIG9mIHRoZSBpbnB1dCBmaWxlLiBXZSBuZWVkIE1BWF9NQVRDSCBieXRlcwogICAgICAgKiBmb3IgdGhlIG5leHQgbWF0Y2gsIHBsdXMgTUlOX01BVENIIGJ5dGVzIHRvIGluc2VydCB0aGUKICAgICAgICogc3RyaW5nIGZvbGxvd2luZyB0aGUgbmV4dCBtYXRjaC4KICAgICAgICovCiAgICAgIGlmIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQpIHsKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFEICYmIGZsdXNoID09PSBaX05PX0ZMVVNIJDIpIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgYnJlYWs7IC8qIGZsdXNoIHRoZSBjdXJyZW50IGJsb2NrICovCiAgICAgICAgfQogICAgICB9CgogICAgICAvKiBJbnNlcnQgdGhlIHN0cmluZyB3aW5kb3dbc3Ryc3RhcnQgLi4gc3Ryc3RhcnQrMl0gaW4gdGhlCiAgICAgICAqIGRpY3Rpb25hcnksIGFuZCBzZXQgaGFzaF9oZWFkIHRvIHRoZSBoZWFkIG9mIHRoZSBoYXNoIGNoYWluOgogICAgICAgKi8KICAgICAgaGFzaF9oZWFkID0gMC8qTklMKi87CiAgICAgIGlmIChzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICAvKioqIElOU0VSVF9TVFJJTkcocywgcy5zdHJzdGFydCwgaGFzaF9oZWFkKTsgKioqLwogICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3Muc3Ryc3RhcnQgKyBNSU5fTUFUQ0ggLSAxXSk7CiAgICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gcy5zdHJzdGFydDsKICAgICAgICAvKioqLwogICAgICB9CgogICAgICAvKiBGaW5kIHRoZSBsb25nZXN0IG1hdGNoLCBkaXNjYXJkaW5nIHRob3NlIDw9IHByZXZfbGVuZ3RoLgogICAgICAgKiBBdCB0aGlzIHBvaW50IHdlIGhhdmUgYWx3YXlzIG1hdGNoX2xlbmd0aCA8IE1JTl9NQVRDSAogICAgICAgKi8KICAgICAgaWYgKGhhc2hfaGVhZCAhPT0gMC8qTklMKi8gJiYgKChzLnN0cnN0YXJ0IC0gaGFzaF9oZWFkKSA8PSAocy53X3NpemUgLSBNSU5fTE9PS0FIRUFEKSkpIHsKICAgICAgICAvKiBUbyBzaW1wbGlmeSB0aGUgY29kZSwgd2UgcHJldmVudCBtYXRjaGVzIHdpdGggdGhlIHN0cmluZwogICAgICAgICAqIG9mIHdpbmRvdyBpbmRleCAwIChpbiBwYXJ0aWN1bGFyIHdlIGhhdmUgdG8gYXZvaWQgYSBtYXRjaAogICAgICAgICAqIG9mIHRoZSBzdHJpbmcgd2l0aCBpdHNlbGYgYXQgdGhlIHN0YXJ0IG9mIHRoZSBpbnB1dCBmaWxlKS4KICAgICAgICAgKi8KICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IGxvbmdlc3RfbWF0Y2gocywgaGFzaF9oZWFkKTsKICAgICAgICAvKiBsb25nZXN0X21hdGNoKCkgc2V0cyBtYXRjaF9zdGFydCAqLwogICAgICB9CiAgICAgIGlmIChzLm1hdGNoX2xlbmd0aCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICAvLyBjaGVja19tYXRjaChzLCBzLnN0cnN0YXJ0LCBzLm1hdGNoX3N0YXJ0LCBzLm1hdGNoX2xlbmd0aCk7IC8vIGZvciBkZWJ1ZyBvbmx5CgogICAgICAgIC8qKiogX3RyX3RhbGx5X2Rpc3Qocywgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgICAgcy5tYXRjaF9sZW5ndGggLSBNSU5fTUFUQ0gsIGJmbHVzaCk7ICoqKi8KICAgICAgICBiZmx1c2ggPSBfdHJfdGFsbHkocywgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQsIHMubWF0Y2hfbGVuZ3RoIC0gTUlOX01BVENIKTsKCiAgICAgICAgcy5sb29rYWhlYWQgLT0gcy5tYXRjaF9sZW5ndGg7CgogICAgICAgIC8qIEluc2VydCBuZXcgc3RyaW5ncyBpbiB0aGUgaGFzaCB0YWJsZSBvbmx5IGlmIHRoZSBtYXRjaCBsZW5ndGgKICAgICAgICAgKiBpcyBub3QgdG9vIGxhcmdlLiBUaGlzIHNhdmVzIHRpbWUgYnV0IGRlZ3JhZGVzIGNvbXByZXNzaW9uLgogICAgICAgICAqLwogICAgICAgIGlmIChzLm1hdGNoX2xlbmd0aCA8PSBzLm1heF9sYXp5X21hdGNoLyptYXhfaW5zZXJ0X2xlbmd0aCovICYmIHMubG9va2FoZWFkID49IE1JTl9NQVRDSCkgewogICAgICAgICAgcy5tYXRjaF9sZW5ndGgtLTsgLyogc3RyaW5nIGF0IHN0cnN0YXJ0IGFscmVhZHkgaW4gdGFibGUgKi8KICAgICAgICAgIGRvIHsKICAgICAgICAgICAgcy5zdHJzdGFydCsrOwogICAgICAgICAgICAvKioqIElOU0VSVF9TVFJJTkcocywgcy5zdHJzdGFydCwgaGFzaF9oZWFkKTsgKioqLwogICAgICAgICAgICBzLmluc19oID0gSEFTSChzLCBzLmluc19oLCBzLndpbmRvd1tzLnN0cnN0YXJ0ICsgTUlOX01BVENIIC0gMV0pOwogICAgICAgICAgICBoYXNoX2hlYWQgPSBzLnByZXZbcy5zdHJzdGFydCAmIHMud19tYXNrXSA9IHMuaGVhZFtzLmluc19oXTsKICAgICAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gcy5zdHJzdGFydDsKICAgICAgICAgICAgLyoqKi8KICAgICAgICAgICAgLyogc3Ryc3RhcnQgbmV2ZXIgZXhjZWVkcyBXU0laRS1NQVhfTUFUQ0gsIHNvIHRoZXJlIGFyZQogICAgICAgICAgICAgKiBhbHdheXMgTUlOX01BVENIIGJ5dGVzIGFoZWFkLgogICAgICAgICAgICAgKi8KICAgICAgICAgIH0gd2hpbGUgKC0tcy5tYXRjaF9sZW5ndGggIT09IDApOwogICAgICAgICAgcy5zdHJzdGFydCsrOwogICAgICAgIH0gZWxzZQogICAgICAgIHsKICAgICAgICAgIHMuc3Ryc3RhcnQgKz0gcy5tYXRjaF9sZW5ndGg7CiAgICAgICAgICBzLm1hdGNoX2xlbmd0aCA9IDA7CiAgICAgICAgICBzLmluc19oID0gcy53aW5kb3dbcy5zdHJzdGFydF07CiAgICAgICAgICAvKiBVUERBVEVfSEFTSChzLCBzLmluc19oLCBzLndpbmRvd1tzLnN0cnN0YXJ0KzFdKTsgKi8KICAgICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3Muc3Ryc3RhcnQgKyAxXSk7CgogIC8vI2lmIE1JTl9NQVRDSCAhPSAzCiAgLy8gICAgICAgICAgICAgICAgQ2FsbCBVUERBVEVfSEFTSCgpIE1JTl9NQVRDSC0zIG1vcmUgdGltZXMKICAvLyNlbmRpZgogICAgICAgICAgLyogSWYgbG9va2FoZWFkIDwgTUlOX01BVENILCBpbnNfaCBpcyBnYXJiYWdlLCBidXQgaXQgZG9lcyBub3QKICAgICAgICAgICAqIG1hdHRlciBzaW5jZSBpdCB3aWxsIGJlIHJlY29tcHV0ZWQgYXQgbmV4dCBkZWZsYXRlIGNhbGwuCiAgICAgICAgICAgKi8KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLyogTm8gbWF0Y2gsIG91dHB1dCBhIGxpdGVyYWwgYnl0ZSAqLwogICAgICAgIC8vVHJhY2V2digoc3RkZXJyLCIlYyIsIHMud2luZG93W3Muc3Ryc3RhcnRdKSk7CiAgICAgICAgLyoqKiBfdHJfdGFsbHlfbGl0KHMsIHMud2luZG93W3Muc3Ryc3RhcnRdLCBiZmx1c2gpOyAqKiovCiAgICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnRdKTsKCiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgIH0KICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMCk7ICoqKi8KICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgICAgLyoqKi8KICAgICAgfQogICAgfQogICAgcy5pbnNlcnQgPSAoKHMuc3Ryc3RhcnQgPCAoTUlOX01BVENIIC0gMSkpID8gcy5zdHJzdGFydCA6IE1JTl9NQVRDSCAtIDEpOwogICAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCQzKSB7CiAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMSk7ICoqKi8KICAgICAgZmx1c2hfYmxvY2tfb25seShzLCB0cnVlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICAgIH0KICAgICAgLyoqKi8KICAgICAgcmV0dXJuIEJTX0ZJTklTSF9ET05FOwogICAgfQogICAgaWYgKHMubGFzdF9saXQpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICAgIC8qKiovCiAgICB9CiAgICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBTYW1lIGFzIGFib3ZlLCBidXQgYWNoaWV2ZXMgYmV0dGVyIGNvbXByZXNzaW9uLiBXZSB1c2UgYSBsYXp5CiAgICogZXZhbHVhdGlvbiBmb3IgbWF0Y2hlczogYSBtYXRjaCBpcyBmaW5hbGx5IGFkb3B0ZWQgb25seSBpZiB0aGVyZSBpcwogICAqIG5vIGJldHRlciBtYXRjaCBhdCB0aGUgbmV4dCB3aW5kb3cgcG9zaXRpb24uCiAgICovCiAgY29uc3QgZGVmbGF0ZV9zbG93ID0gKHMsIGZsdXNoKSA9PiB7CgogICAgbGV0IGhhc2hfaGVhZDsgICAgICAgICAgLyogaGVhZCBvZiBoYXNoIGNoYWluICovCiAgICBsZXQgYmZsdXNoOyAgICAgICAgICAgICAgLyogc2V0IGlmIGN1cnJlbnQgYmxvY2sgbXVzdCBiZSBmbHVzaGVkICovCgogICAgbGV0IG1heF9pbnNlcnQ7CgogICAgLyogUHJvY2VzcyB0aGUgaW5wdXQgYmxvY2suICovCiAgICBmb3IgKDs7KSB7CiAgICAgIC8qIE1ha2Ugc3VyZSB0aGF0IHdlIGFsd2F5cyBoYXZlIGVub3VnaCBsb29rYWhlYWQsIGV4Y2VwdAogICAgICAgKiBhdCB0aGUgZW5kIG9mIHRoZSBpbnB1dCBmaWxlLiBXZSBuZWVkIE1BWF9NQVRDSCBieXRlcwogICAgICAgKiBmb3IgdGhlIG5leHQgbWF0Y2gsIHBsdXMgTUlOX01BVENIIGJ5dGVzIHRvIGluc2VydCB0aGUKICAgICAgICogc3RyaW5nIGZvbGxvd2luZyB0aGUgbmV4dCBtYXRjaC4KICAgICAgICovCiAgICAgIGlmIChzLmxvb2thaGVhZCA8IE1JTl9MT09LQUhFQUQpIHsKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPCBNSU5fTE9PS0FIRUFEICYmIGZsdXNoID09PSBaX05PX0ZMVVNIJDIpIHsKICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgfQogICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgeyBicmVhazsgfSAvKiBmbHVzaCB0aGUgY3VycmVudCBibG9jayAqLwogICAgICB9CgogICAgICAvKiBJbnNlcnQgdGhlIHN0cmluZyB3aW5kb3dbc3Ryc3RhcnQgLi4gc3Ryc3RhcnQrMl0gaW4gdGhlCiAgICAgICAqIGRpY3Rpb25hcnksIGFuZCBzZXQgaGFzaF9oZWFkIHRvIHRoZSBoZWFkIG9mIHRoZSBoYXNoIGNoYWluOgogICAgICAgKi8KICAgICAgaGFzaF9oZWFkID0gMC8qTklMKi87CiAgICAgIGlmIChzLmxvb2thaGVhZCA+PSBNSU5fTUFUQ0gpIHsKICAgICAgICAvKioqIElOU0VSVF9TVFJJTkcocywgcy5zdHJzdGFydCwgaGFzaF9oZWFkKTsgKioqLwogICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3Muc3Ryc3RhcnQgKyBNSU5fTUFUQ0ggLSAxXSk7CiAgICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gcy5zdHJzdGFydDsKICAgICAgICAvKioqLwogICAgICB9CgogICAgICAvKiBGaW5kIHRoZSBsb25nZXN0IG1hdGNoLCBkaXNjYXJkaW5nIHRob3NlIDw9IHByZXZfbGVuZ3RoLgogICAgICAgKi8KICAgICAgcy5wcmV2X2xlbmd0aCA9IHMubWF0Y2hfbGVuZ3RoOwogICAgICBzLnByZXZfbWF0Y2ggPSBzLm1hdGNoX3N0YXJ0OwogICAgICBzLm1hdGNoX2xlbmd0aCA9IE1JTl9NQVRDSCAtIDE7CgogICAgICBpZiAoaGFzaF9oZWFkICE9PSAwLypOSUwqLyAmJiBzLnByZXZfbGVuZ3RoIDwgcy5tYXhfbGF6eV9tYXRjaCAmJgogICAgICAgICAgcy5zdHJzdGFydCAtIGhhc2hfaGVhZCA8PSAocy53X3NpemUgLSBNSU5fTE9PS0FIRUFEKS8qTUFYX0RJU1QocykqLykgewogICAgICAgIC8qIFRvIHNpbXBsaWZ5IHRoZSBjb2RlLCB3ZSBwcmV2ZW50IG1hdGNoZXMgd2l0aCB0aGUgc3RyaW5nCiAgICAgICAgICogb2Ygd2luZG93IGluZGV4IDAgKGluIHBhcnRpY3VsYXIgd2UgaGF2ZSB0byBhdm9pZCBhIG1hdGNoCiAgICAgICAgICogb2YgdGhlIHN0cmluZyB3aXRoIGl0c2VsZiBhdCB0aGUgc3RhcnQgb2YgdGhlIGlucHV0IGZpbGUpLgogICAgICAgICAqLwogICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gbG9uZ2VzdF9tYXRjaChzLCBoYXNoX2hlYWQpOwogICAgICAgIC8qIGxvbmdlc3RfbWF0Y2goKSBzZXRzIG1hdGNoX3N0YXJ0ICovCgogICAgICAgIGlmIChzLm1hdGNoX2xlbmd0aCA8PSA1ICYmCiAgICAgICAgICAgKHMuc3RyYXRlZ3kgPT09IFpfRklMVEVSRUQgfHwgKHMubWF0Y2hfbGVuZ3RoID09PSBNSU5fTUFUQ0ggJiYgcy5zdHJzdGFydCAtIHMubWF0Y2hfc3RhcnQgPiA0MDk2LypUT09fRkFSKi8pKSkgewoKICAgICAgICAgIC8qIElmIHByZXZfbWF0Y2ggaXMgYWxzbyBNSU5fTUFUQ0gsIG1hdGNoX3N0YXJ0IGlzIGdhcmJhZ2UKICAgICAgICAgICAqIGJ1dCB3ZSB3aWxsIGlnbm9yZSB0aGUgY3VycmVudCBtYXRjaCBhbnl3YXkuCiAgICAgICAgICAgKi8KICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gTUlOX01BVENIIC0gMTsKICAgICAgICB9CiAgICAgIH0KICAgICAgLyogSWYgdGhlcmUgd2FzIGEgbWF0Y2ggYXQgdGhlIHByZXZpb3VzIHN0ZXAgYW5kIHRoZSBjdXJyZW50CiAgICAgICAqIG1hdGNoIGlzIG5vdCBiZXR0ZXIsIG91dHB1dCB0aGUgcHJldmlvdXMgbWF0Y2g6CiAgICAgICAqLwogICAgICBpZiAocy5wcmV2X2xlbmd0aCA+PSBNSU5fTUFUQ0ggJiYgcy5tYXRjaF9sZW5ndGggPD0gcy5wcmV2X2xlbmd0aCkgewogICAgICAgIG1heF9pbnNlcnQgPSBzLnN0cnN0YXJ0ICsgcy5sb29rYWhlYWQgLSBNSU5fTUFUQ0g7CiAgICAgICAgLyogRG8gbm90IGluc2VydCBzdHJpbmdzIGluIGhhc2ggdGFibGUgYmV5b25kIHRoaXMuICovCgogICAgICAgIC8vY2hlY2tfbWF0Y2gocywgcy5zdHJzdGFydC0xLCBzLnByZXZfbWF0Y2gsIHMucHJldl9sZW5ndGgpOwoKICAgICAgICAvKioqX3RyX3RhbGx5X2Rpc3Qocywgcy5zdHJzdGFydCAtIDEgLSBzLnByZXZfbWF0Y2gsCiAgICAgICAgICAgICAgICAgICAgICAgcy5wcmV2X2xlbmd0aCAtIE1JTl9NQVRDSCwgYmZsdXNoKTsqKiovCiAgICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIHMuc3Ryc3RhcnQgLSAxIC0gcy5wcmV2X21hdGNoLCBzLnByZXZfbGVuZ3RoIC0gTUlOX01BVENIKTsKICAgICAgICAvKiBJbnNlcnQgaW4gaGFzaCB0YWJsZSBhbGwgc3RyaW5ncyB1cCB0byB0aGUgZW5kIG9mIHRoZSBtYXRjaC4KICAgICAgICAgKiBzdHJzdGFydC0xIGFuZCBzdHJzdGFydCBhcmUgYWxyZWFkeSBpbnNlcnRlZC4gSWYgdGhlcmUgaXMgbm90CiAgICAgICAgICogZW5vdWdoIGxvb2thaGVhZCwgdGhlIGxhc3QgdHdvIHN0cmluZ3MgYXJlIG5vdCBpbnNlcnRlZCBpbgogICAgICAgICAqIHRoZSBoYXNoIHRhYmxlLgogICAgICAgICAqLwogICAgICAgIHMubG9va2FoZWFkIC09IHMucHJldl9sZW5ndGggLSAxOwogICAgICAgIHMucHJldl9sZW5ndGggLT0gMjsKICAgICAgICBkbyB7CiAgICAgICAgICBpZiAoKytzLnN0cnN0YXJ0IDw9IG1heF9pbnNlcnQpIHsKICAgICAgICAgICAgLyoqKiBJTlNFUlRfU1RSSU5HKHMsIHMuc3Ryc3RhcnQsIGhhc2hfaGVhZCk7ICoqKi8KICAgICAgICAgICAgcy5pbnNfaCA9IEhBU0gocywgcy5pbnNfaCwgcy53aW5kb3dbcy5zdHJzdGFydCArIE1JTl9NQVRDSCAtIDFdKTsKICAgICAgICAgICAgaGFzaF9oZWFkID0gcy5wcmV2W3Muc3Ryc3RhcnQgJiBzLndfbWFza10gPSBzLmhlYWRbcy5pbnNfaF07CiAgICAgICAgICAgIHMuaGVhZFtzLmluc19oXSA9IHMuc3Ryc3RhcnQ7CiAgICAgICAgICAgIC8qKiovCiAgICAgICAgICB9CiAgICAgICAgfSB3aGlsZSAoLS1zLnByZXZfbGVuZ3RoICE9PSAwKTsKICAgICAgICBzLm1hdGNoX2F2YWlsYWJsZSA9IDA7CiAgICAgICAgcy5tYXRjaF9sZW5ndGggPSBNSU5fTUFUQ0ggLSAxOwogICAgICAgIHMuc3Ryc3RhcnQrKzsKCiAgICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgICAgfQogICAgICAgICAgLyoqKi8KICAgICAgICB9CgogICAgICB9IGVsc2UgaWYgKHMubWF0Y2hfYXZhaWxhYmxlKSB7CiAgICAgICAgLyogSWYgdGhlcmUgd2FzIG5vIG1hdGNoIGF0IHRoZSBwcmV2aW91cyBwb3NpdGlvbiwgb3V0cHV0IGEKICAgICAgICAgKiBzaW5nbGUgbGl0ZXJhbC4gSWYgdGhlcmUgd2FzIGEgbWF0Y2ggYnV0IHRoZSBjdXJyZW50IG1hdGNoCiAgICAgICAgICogaXMgbG9uZ2VyLCB0cnVuY2F0ZSB0aGUgcHJldmlvdXMgbWF0Y2ggdG8gYSBzaW5nbGUgbGl0ZXJhbC4KICAgICAgICAgKi8KICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwiJWMiLCBzLT53aW5kb3dbcy0+c3Ryc3RhcnQtMV0pKTsKICAgICAgICAvKioqIF90cl90YWxseV9saXQocywgcy53aW5kb3dbcy5zdHJzdGFydC0xXSwgYmZsdXNoKTsgKioqLwogICAgICAgIGJmbHVzaCA9IF90cl90YWxseShzLCAwLCBzLndpbmRvd1tzLnN0cnN0YXJ0IC0gMV0pOwoKICAgICAgICBpZiAoYmZsdXNoKSB7CiAgICAgICAgICAvKioqIEZMVVNIX0JMT0NLX09OTFkocywgMCkgKioqLwogICAgICAgICAgZmx1c2hfYmxvY2tfb25seShzLCBmYWxzZSk7CiAgICAgICAgICAvKioqLwogICAgICAgIH0KICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLyogVGhlcmUgaXMgbm8gcHJldmlvdXMgbWF0Y2ggdG8gY29tcGFyZSB3aXRoLCB3YWl0IGZvcgogICAgICAgICAqIHRoZSBuZXh0IHN0ZXAgdG8gZGVjaWRlLgogICAgICAgICAqLwogICAgICAgIHMubWF0Y2hfYXZhaWxhYmxlID0gMTsKICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgfQogICAgfQogICAgLy9Bc3NlcnQgKGZsdXNoICE9IFpfTk9fRkxVU0gsICJubyBmbHVzaD8iKTsKICAgIGlmIChzLm1hdGNoX2F2YWlsYWJsZSkgewogICAgICAvL1RyYWNldnYoKHN0ZGVyciwiJWMiLCBzLT53aW5kb3dbcy0+c3Ryc3RhcnQtMV0pKTsKICAgICAgLyoqKiBfdHJfdGFsbHlfbGl0KHMsIHMud2luZG93W3Muc3Ryc3RhcnQtMV0sIGJmbHVzaCk7ICoqKi8KICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnQgLSAxXSk7CgogICAgICBzLm1hdGNoX2F2YWlsYWJsZSA9IDA7CiAgICB9CiAgICBzLmluc2VydCA9IHMuc3Ryc3RhcnQgPCBNSU5fTUFUQ0ggLSAxID8gcy5zdHJzdGFydCA6IE1JTl9NQVRDSCAtIDE7CiAgICBpZiAoZmx1c2ggPT09IFpfRklOSVNIJDMpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAxKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIHRydWUpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19GSU5JU0hfU1RBUlRFRDsKICAgICAgfQogICAgICAvKioqLwogICAgICByZXR1cm4gQlNfRklOSVNIX0RPTkU7CiAgICB9CiAgICBpZiAocy5sYXN0X2xpdCkgewogICAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDApOyAqKiovCiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgICAgLyoqKi8KICAgIH0KCiAgICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogRm9yIFpfUkxFLCBzaW1wbHkgbG9vayBmb3IgcnVucyBvZiBieXRlcywgZ2VuZXJhdGUgbWF0Y2hlcyBvbmx5IG9mIGRpc3RhbmNlCiAgICogb25lLiAgRG8gbm90IG1haW50YWluIGEgaGFzaCB0YWJsZS4gIChJdCB3aWxsIGJlIHJlZ2VuZXJhdGVkIGlmIHRoaXMgcnVuIG9mCiAgICogZGVmbGF0ZSBzd2l0Y2hlcyBhd2F5IGZyb20gWl9STEUuKQogICAqLwogIGNvbnN0IGRlZmxhdGVfcmxlID0gKHMsIGZsdXNoKSA9PiB7CgogICAgbGV0IGJmbHVzaDsgICAgICAgICAgICAvKiBzZXQgaWYgY3VycmVudCBibG9jayBtdXN0IGJlIGZsdXNoZWQgKi8KICAgIGxldCBwcmV2OyAgICAgICAgICAgICAgLyogYnl0ZSBhdCBkaXN0YW5jZSBvbmUgdG8gbWF0Y2ggKi8KICAgIGxldCBzY2FuLCBzdHJlbmQ7ICAgICAgLyogc2NhbiBnb2VzIHVwIHRvIHN0cmVuZCBmb3IgbGVuZ3RoIG9mIHJ1biAqLwoKICAgIGNvbnN0IF93aW4gPSBzLndpbmRvdzsKCiAgICBmb3IgKDs7KSB7CiAgICAgIC8qIE1ha2Ugc3VyZSB0aGF0IHdlIGFsd2F5cyBoYXZlIGVub3VnaCBsb29rYWhlYWQsIGV4Y2VwdAogICAgICAgKiBhdCB0aGUgZW5kIG9mIHRoZSBpbnB1dCBmaWxlLiBXZSBuZWVkIE1BWF9NQVRDSCBieXRlcwogICAgICAgKiBmb3IgdGhlIGxvbmdlc3QgcnVuLCBwbHVzIG9uZSBmb3IgdGhlIHVucm9sbGVkIGxvb3AuCiAgICAgICAqLwogICAgICBpZiAocy5sb29rYWhlYWQgPD0gTUFYX01BVENIKSB7CiAgICAgICAgZmlsbF93aW5kb3cocyk7CiAgICAgICAgaWYgKHMubG9va2FoZWFkIDw9IE1BWF9NQVRDSCAmJiBmbHVzaCA9PT0gWl9OT19GTFVTSCQyKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgICBpZiAocy5sb29rYWhlYWQgPT09IDApIHsgYnJlYWs7IH0gLyogZmx1c2ggdGhlIGN1cnJlbnQgYmxvY2sgKi8KICAgICAgfQoKICAgICAgLyogU2VlIGhvdyBtYW55IHRpbWVzIHRoZSBwcmV2aW91cyBieXRlIHJlcGVhdHMgKi8KICAgICAgcy5tYXRjaF9sZW5ndGggPSAwOwogICAgICBpZiAocy5sb29rYWhlYWQgPj0gTUlOX01BVENIICYmIHMuc3Ryc3RhcnQgPiAwKSB7CiAgICAgICAgc2NhbiA9IHMuc3Ryc3RhcnQgLSAxOwogICAgICAgIHByZXYgPSBfd2luW3NjYW5dOwogICAgICAgIGlmIChwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmIHByZXYgPT09IF93aW5bKytzY2FuXSkgewogICAgICAgICAgc3RyZW5kID0gcy5zdHJzdGFydCArIE1BWF9NQVRDSDsKICAgICAgICAgIGRvIHsKICAgICAgICAgICAgLypqc2hpbnQgbm9lbXB0eTpmYWxzZSovCiAgICAgICAgICB9IHdoaWxlIChwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmCiAgICAgICAgICAgICAgICAgICBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmCiAgICAgICAgICAgICAgICAgICBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmCiAgICAgICAgICAgICAgICAgICBwcmV2ID09PSBfd2luWysrc2Nhbl0gJiYgcHJldiA9PT0gX3dpblsrK3NjYW5dICYmCiAgICAgICAgICAgICAgICAgICBzY2FuIDwgc3RyZW5kKTsKICAgICAgICAgIHMubWF0Y2hfbGVuZ3RoID0gTUFYX01BVENIIC0gKHN0cmVuZCAtIHNjYW4pOwogICAgICAgICAgaWYgKHMubWF0Y2hfbGVuZ3RoID4gcy5sb29rYWhlYWQpIHsKICAgICAgICAgICAgcy5tYXRjaF9sZW5ndGggPSBzLmxvb2thaGVhZDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy9Bc3NlcnQoc2NhbiA8PSBzLT53aW5kb3crKHVJbnQpKHMtPndpbmRvd19zaXplLTEpLCAid2lsZCBzY2FuIik7CiAgICAgIH0KCiAgICAgIC8qIEVtaXQgbWF0Y2ggaWYgaGF2ZSBydW4gb2YgTUlOX01BVENIIG9yIGxvbmdlciwgZWxzZSBlbWl0IGxpdGVyYWwgKi8KICAgICAgaWYgKHMubWF0Y2hfbGVuZ3RoID49IE1JTl9NQVRDSCkgewogICAgICAgIC8vY2hlY2tfbWF0Y2gocywgcy5zdHJzdGFydCwgcy5zdHJzdGFydCAtIDEsIHMubWF0Y2hfbGVuZ3RoKTsKCiAgICAgICAgLyoqKiBfdHJfdGFsbHlfZGlzdChzLCAxLCBzLm1hdGNoX2xlbmd0aCAtIE1JTl9NQVRDSCwgYmZsdXNoKTsgKioqLwogICAgICAgIGJmbHVzaCA9IF90cl90YWxseShzLCAxLCBzLm1hdGNoX2xlbmd0aCAtIE1JTl9NQVRDSCk7CgogICAgICAgIHMubG9va2FoZWFkIC09IHMubWF0Y2hfbGVuZ3RoOwogICAgICAgIHMuc3Ryc3RhcnQgKz0gcy5tYXRjaF9sZW5ndGg7CiAgICAgICAgcy5tYXRjaF9sZW5ndGggPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIC8qIE5vIG1hdGNoLCBvdXRwdXQgYSBsaXRlcmFsIGJ5dGUgKi8KICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwiJWMiLCBzLT53aW5kb3dbcy0+c3Ryc3RhcnRdKSk7CiAgICAgICAgLyoqKiBfdHJfdGFsbHlfbGl0KHMsIHMud2luZG93W3Muc3Ryc3RhcnRdLCBiZmx1c2gpOyAqKiovCiAgICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnRdKTsKCiAgICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgICBzLnN0cnN0YXJ0Kys7CiAgICAgIH0KICAgICAgaWYgKGJmbHVzaCkgewogICAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMCk7ICoqKi8KICAgICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIEJTX05FRURfTU9SRTsKICAgICAgICB9CiAgICAgICAgLyoqKi8KICAgICAgfQogICAgfQogICAgcy5pbnNlcnQgPSAwOwogICAgaWYgKGZsdXNoID09PSBaX0ZJTklTSCQzKSB7CiAgICAgIC8qKiogRkxVU0hfQkxPQ0socywgMSk7ICoqKi8KICAgICAgZmx1c2hfYmxvY2tfb25seShzLCB0cnVlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfRklOSVNIX1NUQVJURUQ7CiAgICAgIH0KICAgICAgLyoqKi8KICAgICAgcmV0dXJuIEJTX0ZJTklTSF9ET05FOwogICAgfQogICAgaWYgKHMubGFzdF9saXQpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIGZhbHNlKTsKICAgICAgaWYgKHMuc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICB9CiAgICAgIC8qKiovCiAgICB9CiAgICByZXR1cm4gQlNfQkxPQ0tfRE9ORTsKICB9OwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgKiBGb3IgWl9IVUZGTUFOX09OTFksIGRvIG5vdCBsb29rIGZvciBtYXRjaGVzLiAgRG8gbm90IG1haW50YWluIGEgaGFzaCB0YWJsZS4KICAgKiAoSXQgd2lsbCBiZSByZWdlbmVyYXRlZCBpZiB0aGlzIHJ1biBvZiBkZWZsYXRlIHN3aXRjaGVzIGF3YXkgZnJvbSBIdWZmbWFuLikKICAgKi8KICBjb25zdCBkZWZsYXRlX2h1ZmYgPSAocywgZmx1c2gpID0+IHsKCiAgICBsZXQgYmZsdXNoOyAgICAgICAgICAgICAvKiBzZXQgaWYgY3VycmVudCBibG9jayBtdXN0IGJlIGZsdXNoZWQgKi8KCiAgICBmb3IgKDs7KSB7CiAgICAgIC8qIE1ha2Ugc3VyZSB0aGF0IHdlIGhhdmUgYSBsaXRlcmFsIHRvIHdyaXRlLiAqLwogICAgICBpZiAocy5sb29rYWhlYWQgPT09IDApIHsKICAgICAgICBmaWxsX3dpbmRvdyhzKTsKICAgICAgICBpZiAocy5sb29rYWhlYWQgPT09IDApIHsKICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9OT19GTFVTSCQyKSB7CiAgICAgICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsgICAgICAvKiBmbHVzaCB0aGUgY3VycmVudCBibG9jayAqLwogICAgICAgIH0KICAgICAgfQoKICAgICAgLyogT3V0cHV0IGEgbGl0ZXJhbCBieXRlICovCiAgICAgIHMubWF0Y2hfbGVuZ3RoID0gMDsKICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsIiVjIiwgcy0+d2luZG93W3MtPnN0cnN0YXJ0XSkpOwogICAgICAvKioqIF90cl90YWxseV9saXQocywgcy53aW5kb3dbcy5zdHJzdGFydF0sIGJmbHVzaCk7ICoqKi8KICAgICAgYmZsdXNoID0gX3RyX3RhbGx5KHMsIDAsIHMud2luZG93W3Muc3Ryc3RhcnRdKTsKICAgICAgcy5sb29rYWhlYWQtLTsKICAgICAgcy5zdHJzdGFydCsrOwogICAgICBpZiAoYmZsdXNoKSB7CiAgICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAwKTsgKioqLwogICAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICAgIGlmIChzLnN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gQlNfTkVFRF9NT1JFOwogICAgICAgIH0KICAgICAgICAvKioqLwogICAgICB9CiAgICB9CiAgICBzLmluc2VydCA9IDA7CiAgICBpZiAoZmx1c2ggPT09IFpfRklOSVNIJDMpIHsKICAgICAgLyoqKiBGTFVTSF9CTE9DSyhzLCAxKTsgKioqLwogICAgICBmbHVzaF9ibG9ja19vbmx5KHMsIHRydWUpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19GSU5JU0hfU1RBUlRFRDsKICAgICAgfQogICAgICAvKioqLwogICAgICByZXR1cm4gQlNfRklOSVNIX0RPTkU7CiAgICB9CiAgICBpZiAocy5sYXN0X2xpdCkgewogICAgICAvKioqIEZMVVNIX0JMT0NLKHMsIDApOyAqKiovCiAgICAgIGZsdXNoX2Jsb2NrX29ubHkocywgZmFsc2UpOwogICAgICBpZiAocy5zdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHJldHVybiBCU19ORUVEX01PUkU7CiAgICAgIH0KICAgICAgLyoqKi8KICAgIH0KICAgIHJldHVybiBCU19CTE9DS19ET05FOwogIH07CgogIC8qIFZhbHVlcyBmb3IgbWF4X2xhenlfbWF0Y2gsIGdvb2RfbWF0Y2ggYW5kIG1heF9jaGFpbl9sZW5ndGgsIGRlcGVuZGluZyBvbgogICAqIHRoZSBkZXNpcmVkIHBhY2sgbGV2ZWwgKDAuLjkpLiBUaGUgdmFsdWVzIGdpdmVuIGJlbG93IGhhdmUgYmVlbiB0dW5lZCB0bwogICAqIGV4Y2x1ZGUgd29yc3QgY2FzZSBwZXJmb3JtYW5jZSBmb3IgcGF0aG9sb2dpY2FsIGZpbGVzLiBCZXR0ZXIgdmFsdWVzIG1heSBiZQogICAqIGZvdW5kIGZvciBzcGVjaWZpYyBmaWxlcy4KICAgKi8KICBmdW5jdGlvbiBDb25maWcoZ29vZF9sZW5ndGgsIG1heF9sYXp5LCBuaWNlX2xlbmd0aCwgbWF4X2NoYWluLCBmdW5jKSB7CgogICAgdGhpcy5nb29kX2xlbmd0aCA9IGdvb2RfbGVuZ3RoOwogICAgdGhpcy5tYXhfbGF6eSA9IG1heF9sYXp5OwogICAgdGhpcy5uaWNlX2xlbmd0aCA9IG5pY2VfbGVuZ3RoOwogICAgdGhpcy5tYXhfY2hhaW4gPSBtYXhfY2hhaW47CiAgICB0aGlzLmZ1bmMgPSBmdW5jOwogIH0KCiAgY29uc3QgY29uZmlndXJhdGlvbl90YWJsZSA9IFsKICAgIC8qICAgICAgZ29vZCBsYXp5IG5pY2UgY2hhaW4gKi8KICAgIG5ldyBDb25maWcoMCwgMCwgMCwgMCwgZGVmbGF0ZV9zdG9yZWQpLCAgICAgICAgICAvKiAwIHN0b3JlIG9ubHkgKi8KICAgIG5ldyBDb25maWcoNCwgNCwgOCwgNCwgZGVmbGF0ZV9mYXN0KSwgICAgICAgICAgICAvKiAxIG1heCBzcGVlZCwgbm8gbGF6eSBtYXRjaGVzICovCiAgICBuZXcgQ29uZmlnKDQsIDUsIDE2LCA4LCBkZWZsYXRlX2Zhc3QpLCAgICAgICAgICAgLyogMiAqLwogICAgbmV3IENvbmZpZyg0LCA2LCAzMiwgMzIsIGRlZmxhdGVfZmFzdCksICAgICAgICAgIC8qIDMgKi8KCiAgICBuZXcgQ29uZmlnKDQsIDQsIDE2LCAxNiwgZGVmbGF0ZV9zbG93KSwgICAgICAgICAgLyogNCBsYXp5IG1hdGNoZXMgKi8KICAgIG5ldyBDb25maWcoOCwgMTYsIDMyLCAzMiwgZGVmbGF0ZV9zbG93KSwgICAgICAgICAvKiA1ICovCiAgICBuZXcgQ29uZmlnKDgsIDE2LCAxMjgsIDEyOCwgZGVmbGF0ZV9zbG93KSwgICAgICAgLyogNiAqLwogICAgbmV3IENvbmZpZyg4LCAzMiwgMTI4LCAyNTYsIGRlZmxhdGVfc2xvdyksICAgICAgIC8qIDcgKi8KICAgIG5ldyBDb25maWcoMzIsIDEyOCwgMjU4LCAxMDI0LCBkZWZsYXRlX3Nsb3cpLCAgICAvKiA4ICovCiAgICBuZXcgQ29uZmlnKDMyLCAyNTgsIDI1OCwgNDA5NiwgZGVmbGF0ZV9zbG93KSAgICAgLyogOSBtYXggY29tcHJlc3Npb24gKi8KICBdOwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICogSW5pdGlhbGl6ZSB0aGUgImxvbmdlc3QgbWF0Y2giIHJvdXRpbmVzIGZvciBhIG5ldyB6bGliIHN0cmVhbQogICAqLwogIGNvbnN0IGxtX2luaXQgPSAocykgPT4gewoKICAgIHMud2luZG93X3NpemUgPSAyICogcy53X3NpemU7CgogICAgLyoqKiBDTEVBUl9IQVNIKHMpOyAqKiovCiAgICB6ZXJvKHMuaGVhZCk7IC8vIEZpbGwgd2l0aCBOSUwgKD0gMCk7CgogICAgLyogU2V0IHRoZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb24gcGFyYW1ldGVyczoKICAgICAqLwogICAgcy5tYXhfbGF6eV9tYXRjaCA9IGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0ubWF4X2xhenk7CiAgICBzLmdvb2RfbWF0Y2ggPSBjb25maWd1cmF0aW9uX3RhYmxlW3MubGV2ZWxdLmdvb2RfbGVuZ3RoOwogICAgcy5uaWNlX21hdGNoID0gY29uZmlndXJhdGlvbl90YWJsZVtzLmxldmVsXS5uaWNlX2xlbmd0aDsKICAgIHMubWF4X2NoYWluX2xlbmd0aCA9IGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0ubWF4X2NoYWluOwoKICAgIHMuc3Ryc3RhcnQgPSAwOwogICAgcy5ibG9ja19zdGFydCA9IDA7CiAgICBzLmxvb2thaGVhZCA9IDA7CiAgICBzLmluc2VydCA9IDA7CiAgICBzLm1hdGNoX2xlbmd0aCA9IHMucHJldl9sZW5ndGggPSBNSU5fTUFUQ0ggLSAxOwogICAgcy5tYXRjaF9hdmFpbGFibGUgPSAwOwogICAgcy5pbnNfaCA9IDA7CiAgfTsKCgogIGZ1bmN0aW9uIERlZmxhdGVTdGF0ZSgpIHsKICAgIHRoaXMuc3RybSA9IG51bGw7ICAgICAgICAgICAgLyogcG9pbnRlciBiYWNrIHRvIHRoaXMgemxpYiBzdHJlYW0gKi8KICAgIHRoaXMuc3RhdHVzID0gMDsgICAgICAgICAgICAvKiBhcyB0aGUgbmFtZSBpbXBsaWVzICovCiAgICB0aGlzLnBlbmRpbmdfYnVmID0gbnVsbDsgICAgICAvKiBvdXRwdXQgc3RpbGwgcGVuZGluZyAqLwogICAgdGhpcy5wZW5kaW5nX2J1Zl9zaXplID0gMDsgIC8qIHNpemUgb2YgcGVuZGluZ19idWYgKi8KICAgIHRoaXMucGVuZGluZ19vdXQgPSAwOyAgICAgICAvKiBuZXh0IHBlbmRpbmcgYnl0ZSB0byBvdXRwdXQgdG8gdGhlIHN0cmVhbSAqLwogICAgdGhpcy5wZW5kaW5nID0gMDsgICAgICAgICAgIC8qIG5iIG9mIGJ5dGVzIGluIHRoZSBwZW5kaW5nIGJ1ZmZlciAqLwogICAgdGhpcy53cmFwID0gMDsgICAgICAgICAgICAgIC8qIGJpdCAwIHRydWUgZm9yIHpsaWIsIGJpdCAxIHRydWUgZm9yIGd6aXAgKi8KICAgIHRoaXMuZ3poZWFkID0gbnVsbDsgICAgICAgICAvKiBnemlwIGhlYWRlciBpbmZvcm1hdGlvbiB0byB3cml0ZSAqLwogICAgdGhpcy5nemluZGV4ID0gMDsgICAgICAgICAgIC8qIHdoZXJlIGluIGV4dHJhLCBuYW1lLCBvciBjb21tZW50ICovCiAgICB0aGlzLm1ldGhvZCA9IFpfREVGTEFURUQkMjsgLyogY2FuIG9ubHkgYmUgREVGTEFURUQgKi8KICAgIHRoaXMubGFzdF9mbHVzaCA9IC0xOyAgIC8qIHZhbHVlIG9mIGZsdXNoIHBhcmFtIGZvciBwcmV2aW91cyBkZWZsYXRlIGNhbGwgKi8KCiAgICB0aGlzLndfc2l6ZSA9IDA7ICAvKiBMWjc3IHdpbmRvdyBzaXplICgzMksgYnkgZGVmYXVsdCkgKi8KICAgIHRoaXMud19iaXRzID0gMDsgIC8qIGxvZzIod19zaXplKSAgKDguLjE2KSAqLwogICAgdGhpcy53X21hc2sgPSAwOyAgLyogd19zaXplIC0gMSAqLwoKICAgIHRoaXMud2luZG93ID0gbnVsbDsKICAgIC8qIFNsaWRpbmcgd2luZG93LiBJbnB1dCBieXRlcyBhcmUgcmVhZCBpbnRvIHRoZSBzZWNvbmQgaGFsZiBvZiB0aGUgd2luZG93LAogICAgICogYW5kIG1vdmUgdG8gdGhlIGZpcnN0IGhhbGYgbGF0ZXIgdG8ga2VlcCBhIGRpY3Rpb25hcnkgb2YgYXQgbGVhc3Qgd1NpemUKICAgICAqIGJ5dGVzLiBXaXRoIHRoaXMgb3JnYW5pemF0aW9uLCBtYXRjaGVzIGFyZSBsaW1pdGVkIHRvIGEgZGlzdGFuY2Ugb2YKICAgICAqIHdTaXplLU1BWF9NQVRDSCBieXRlcywgYnV0IHRoaXMgZW5zdXJlcyB0aGF0IElPIGlzIGFsd2F5cwogICAgICogcGVyZm9ybWVkIHdpdGggYSBsZW5ndGggbXVsdGlwbGUgb2YgdGhlIGJsb2NrIHNpemUuCiAgICAgKi8KCiAgICB0aGlzLndpbmRvd19zaXplID0gMDsKICAgIC8qIEFjdHVhbCBzaXplIG9mIHdpbmRvdzogMip3U2l6ZSwgZXhjZXB0IHdoZW4gdGhlIHVzZXIgaW5wdXQgYnVmZmVyCiAgICAgKiBpcyBkaXJlY3RseSB1c2VkIGFzIHNsaWRpbmcgd2luZG93LgogICAgICovCgogICAgdGhpcy5wcmV2ID0gbnVsbDsKICAgIC8qIExpbmsgdG8gb2xkZXIgc3RyaW5nIHdpdGggc2FtZSBoYXNoIGluZGV4LiBUbyBsaW1pdCB0aGUgc2l6ZSBvZiB0aGlzCiAgICAgKiBhcnJheSB0byA2NEssIHRoaXMgbGluayBpcyBtYWludGFpbmVkIG9ubHkgZm9yIHRoZSBsYXN0IDMySyBzdHJpbmdzLgogICAgICogQW4gaW5kZXggaW4gdGhpcyBhcnJheSBpcyB0aHVzIGEgd2luZG93IGluZGV4IG1vZHVsbyAzMksuCiAgICAgKi8KCiAgICB0aGlzLmhlYWQgPSBudWxsOyAgIC8qIEhlYWRzIG9mIHRoZSBoYXNoIGNoYWlucyBvciBOSUwuICovCgogICAgdGhpcy5pbnNfaCA9IDA7ICAgICAgIC8qIGhhc2ggaW5kZXggb2Ygc3RyaW5nIHRvIGJlIGluc2VydGVkICovCiAgICB0aGlzLmhhc2hfc2l6ZSA9IDA7ICAgLyogbnVtYmVyIG9mIGVsZW1lbnRzIGluIGhhc2ggdGFibGUgKi8KICAgIHRoaXMuaGFzaF9iaXRzID0gMDsgICAvKiBsb2cyKGhhc2hfc2l6ZSkgKi8KICAgIHRoaXMuaGFzaF9tYXNrID0gMDsgICAvKiBoYXNoX3NpemUtMSAqLwoKICAgIHRoaXMuaGFzaF9zaGlmdCA9IDA7CiAgICAvKiBOdW1iZXIgb2YgYml0cyBieSB3aGljaCBpbnNfaCBtdXN0IGJlIHNoaWZ0ZWQgYXQgZWFjaCBpbnB1dAogICAgICogc3RlcC4gSXQgbXVzdCBiZSBzdWNoIHRoYXQgYWZ0ZXIgTUlOX01BVENIIHN0ZXBzLCB0aGUgb2xkZXN0CiAgICAgKiBieXRlIG5vIGxvbmdlciB0YWtlcyBwYXJ0IGluIHRoZSBoYXNoIGtleSwgdGhhdCBpczoKICAgICAqICAgaGFzaF9zaGlmdCAqIE1JTl9NQVRDSCA+PSBoYXNoX2JpdHMKICAgICAqLwoKICAgIHRoaXMuYmxvY2tfc3RhcnQgPSAwOwogICAgLyogV2luZG93IHBvc2l0aW9uIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIGN1cnJlbnQgb3V0cHV0IGJsb2NrLiBHZXRzCiAgICAgKiBuZWdhdGl2ZSB3aGVuIHRoZSB3aW5kb3cgaXMgbW92ZWQgYmFja3dhcmRzLgogICAgICovCgogICAgdGhpcy5tYXRjaF9sZW5ndGggPSAwOyAgICAgIC8qIGxlbmd0aCBvZiBiZXN0IG1hdGNoICovCiAgICB0aGlzLnByZXZfbWF0Y2ggPSAwOyAgICAgICAgLyogcHJldmlvdXMgbWF0Y2ggKi8KICAgIHRoaXMubWF0Y2hfYXZhaWxhYmxlID0gMDsgICAvKiBzZXQgaWYgcHJldmlvdXMgbWF0Y2ggZXhpc3RzICovCiAgICB0aGlzLnN0cnN0YXJ0ID0gMDsgICAgICAgICAgLyogc3RhcnQgb2Ygc3RyaW5nIHRvIGluc2VydCAqLwogICAgdGhpcy5tYXRjaF9zdGFydCA9IDA7ICAgICAgIC8qIHN0YXJ0IG9mIG1hdGNoaW5nIHN0cmluZyAqLwogICAgdGhpcy5sb29rYWhlYWQgPSAwOyAgICAgICAgIC8qIG51bWJlciBvZiB2YWxpZCBieXRlcyBhaGVhZCBpbiB3aW5kb3cgKi8KCiAgICB0aGlzLnByZXZfbGVuZ3RoID0gMDsKICAgIC8qIExlbmd0aCBvZiB0aGUgYmVzdCBtYXRjaCBhdCBwcmV2aW91cyBzdGVwLiBNYXRjaGVzIG5vdCBncmVhdGVyIHRoYW4gdGhpcwogICAgICogYXJlIGRpc2NhcmRlZC4gVGhpcyBpcyB1c2VkIGluIHRoZSBsYXp5IG1hdGNoIGV2YWx1YXRpb24uCiAgICAgKi8KCiAgICB0aGlzLm1heF9jaGFpbl9sZW5ndGggPSAwOwogICAgLyogVG8gc3BlZWQgdXAgZGVmbGF0aW9uLCBoYXNoIGNoYWlucyBhcmUgbmV2ZXIgc2VhcmNoZWQgYmV5b25kIHRoaXMKICAgICAqIGxlbmd0aC4gIEEgaGlnaGVyIGxpbWl0IGltcHJvdmVzIGNvbXByZXNzaW9uIHJhdGlvIGJ1dCBkZWdyYWRlcyB0aGUKICAgICAqIHNwZWVkLgogICAgICovCgogICAgdGhpcy5tYXhfbGF6eV9tYXRjaCA9IDA7CiAgICAvKiBBdHRlbXB0IHRvIGZpbmQgYSBiZXR0ZXIgbWF0Y2ggb25seSB3aGVuIHRoZSBjdXJyZW50IG1hdGNoIGlzIHN0cmljdGx5CiAgICAgKiBzbWFsbGVyIHRoYW4gdGhpcyB2YWx1ZS4gVGhpcyBtZWNoYW5pc20gaXMgdXNlZCBvbmx5IGZvciBjb21wcmVzc2lvbgogICAgICogbGV2ZWxzID49IDQuCiAgICAgKi8KICAgIC8vIFRoYXQncyBhbGlhcyB0byBtYXhfbGF6eV9tYXRjaCwgZG9uJ3QgdXNlIGRpcmVjdGx5CiAgICAvL3RoaXMubWF4X2luc2VydF9sZW5ndGggPSAwOwogICAgLyogSW5zZXJ0IG5ldyBzdHJpbmdzIGluIHRoZSBoYXNoIHRhYmxlIG9ubHkgaWYgdGhlIG1hdGNoIGxlbmd0aCBpcyBub3QKICAgICAqIGdyZWF0ZXIgdGhhbiB0aGlzIGxlbmd0aC4gVGhpcyBzYXZlcyB0aW1lIGJ1dCBkZWdyYWRlcyBjb21wcmVzc2lvbi4KICAgICAqIG1heF9pbnNlcnRfbGVuZ3RoIGlzIHVzZWQgb25seSBmb3IgY29tcHJlc3Npb24gbGV2ZWxzIDw9IDMuCiAgICAgKi8KCiAgICB0aGlzLmxldmVsID0gMDsgICAgIC8qIGNvbXByZXNzaW9uIGxldmVsICgxLi45KSAqLwogICAgdGhpcy5zdHJhdGVneSA9IDA7ICAvKiBmYXZvciBvciBmb3JjZSBIdWZmbWFuIGNvZGluZyovCgogICAgdGhpcy5nb29kX21hdGNoID0gMDsKICAgIC8qIFVzZSBhIGZhc3RlciBzZWFyY2ggd2hlbiB0aGUgcHJldmlvdXMgbWF0Y2ggaXMgbG9uZ2VyIHRoYW4gdGhpcyAqLwoKICAgIHRoaXMubmljZV9tYXRjaCA9IDA7IC8qIFN0b3Agc2VhcmNoaW5nIHdoZW4gY3VycmVudCBtYXRjaCBleGNlZWRzIHRoaXMgKi8KCiAgICAgICAgICAgICAgICAvKiB1c2VkIGJ5IHRyZWVzLmM6ICovCgogICAgLyogRGlkbid0IHVzZSBjdF9kYXRhIHR5cGVkZWYgYmVsb3cgdG8gc3VwcHJlc3MgY29tcGlsZXIgd2FybmluZyAqLwoKICAgIC8vIHN0cnVjdCBjdF9kYXRhX3MgZHluX2x0cmVlW0hFQVBfU0laRV07ICAgLyogbGl0ZXJhbCBhbmQgbGVuZ3RoIHRyZWUgKi8KICAgIC8vIHN0cnVjdCBjdF9kYXRhX3MgZHluX2R0cmVlWzIqRF9DT0RFUysxXTsgLyogZGlzdGFuY2UgdHJlZSAqLwogICAgLy8gc3RydWN0IGN0X2RhdGFfcyBibF90cmVlWzIqQkxfQ09ERVMrMV07ICAvKiBIdWZmbWFuIHRyZWUgZm9yIGJpdCBsZW5ndGhzICovCgogICAgLy8gVXNlIGZsYXQgYXJyYXkgb2YgRE9VQkxFIHNpemUsIHdpdGggaW50ZXJsZWF2ZWQgZmF0YSwKICAgIC8vIGJlY2F1c2UgSlMgZG9lcyBub3Qgc3VwcG9ydCBlZmZlY3RpdmUKICAgIHRoaXMuZHluX2x0cmVlICA9IG5ldyBVaW50MTZBcnJheShIRUFQX1NJWkUgKiAyKTsKICAgIHRoaXMuZHluX2R0cmVlICA9IG5ldyBVaW50MTZBcnJheSgoMiAqIERfQ09ERVMgKyAxKSAqIDIpOwogICAgdGhpcy5ibF90cmVlICAgID0gbmV3IFVpbnQxNkFycmF5KCgyICogQkxfQ09ERVMgKyAxKSAqIDIpOwogICAgemVybyh0aGlzLmR5bl9sdHJlZSk7CiAgICB6ZXJvKHRoaXMuZHluX2R0cmVlKTsKICAgIHplcm8odGhpcy5ibF90cmVlKTsKCiAgICB0aGlzLmxfZGVzYyAgID0gbnVsbDsgICAgICAgICAvKiBkZXNjLiBmb3IgbGl0ZXJhbCB0cmVlICovCiAgICB0aGlzLmRfZGVzYyAgID0gbnVsbDsgICAgICAgICAvKiBkZXNjLiBmb3IgZGlzdGFuY2UgdHJlZSAqLwogICAgdGhpcy5ibF9kZXNjICA9IG51bGw7ICAgICAgICAgLyogZGVzYy4gZm9yIGJpdCBsZW5ndGggdHJlZSAqLwoKICAgIC8vdXNoIGJsX2NvdW50W01BWF9CSVRTKzFdOwogICAgdGhpcy5ibF9jb3VudCA9IG5ldyBVaW50MTZBcnJheShNQVhfQklUUyArIDEpOwogICAgLyogbnVtYmVyIG9mIGNvZGVzIGF0IGVhY2ggYml0IGxlbmd0aCBmb3IgYW4gb3B0aW1hbCB0cmVlICovCgogICAgLy9pbnQgaGVhcFsyKkxfQ09ERVMrMV07ICAgICAgLyogaGVhcCB1c2VkIHRvIGJ1aWxkIHRoZSBIdWZmbWFuIHRyZWVzICovCiAgICB0aGlzLmhlYXAgPSBuZXcgVWludDE2QXJyYXkoMiAqIExfQ09ERVMgKyAxKTsgIC8qIGhlYXAgdXNlZCB0byBidWlsZCB0aGUgSHVmZm1hbiB0cmVlcyAqLwogICAgemVybyh0aGlzLmhlYXApOwoKICAgIHRoaXMuaGVhcF9sZW4gPSAwOyAgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBlbGVtZW50cyBpbiB0aGUgaGVhcCAqLwogICAgdGhpcy5oZWFwX21heCA9IDA7ICAgICAgICAgICAgICAgLyogZWxlbWVudCBvZiBsYXJnZXN0IGZyZXF1ZW5jeSAqLwogICAgLyogVGhlIHNvbnMgb2YgaGVhcFtuXSBhcmUgaGVhcFsyKm5dIGFuZCBoZWFwWzIqbisxXS4gaGVhcFswXSBpcyBub3QgdXNlZC4KICAgICAqIFRoZSBzYW1lIGhlYXAgYXJyYXkgaXMgdXNlZCB0byBidWlsZCBhbGwgdHJlZXMuCiAgICAgKi8KCiAgICB0aGlzLmRlcHRoID0gbmV3IFVpbnQxNkFycmF5KDIgKiBMX0NPREVTICsgMSk7IC8vdWNoIGRlcHRoWzIqTF9DT0RFUysxXTsKICAgIHplcm8odGhpcy5kZXB0aCk7CiAgICAvKiBEZXB0aCBvZiBlYWNoIHN1YnRyZWUgdXNlZCBhcyB0aWUgYnJlYWtlciBmb3IgdHJlZXMgb2YgZXF1YWwgZnJlcXVlbmN5CiAgICAgKi8KCiAgICB0aGlzLmxfYnVmID0gMDsgICAgICAgICAgLyogYnVmZmVyIGluZGV4IGZvciBsaXRlcmFscyBvciBsZW5ndGhzICovCgogICAgdGhpcy5saXRfYnVmc2l6ZSA9IDA7CiAgICAvKiBTaXplIG9mIG1hdGNoIGJ1ZmZlciBmb3IgbGl0ZXJhbHMvbGVuZ3Rocy4gIFRoZXJlIGFyZSA0IHJlYXNvbnMgZm9yCiAgICAgKiBsaW1pdGluZyBsaXRfYnVmc2l6ZSB0byA2NEs6CiAgICAgKiAgIC0gZnJlcXVlbmNpZXMgY2FuIGJlIGtlcHQgaW4gMTYgYml0IGNvdW50ZXJzCiAgICAgKiAgIC0gaWYgY29tcHJlc3Npb24gaXMgbm90IHN1Y2Nlc3NmdWwgZm9yIHRoZSBmaXJzdCBibG9jaywgYWxsIGlucHV0CiAgICAgKiAgICAgZGF0YSBpcyBzdGlsbCBpbiB0aGUgd2luZG93IHNvIHdlIGNhbiBzdGlsbCBlbWl0IGEgc3RvcmVkIGJsb2NrIGV2ZW4KICAgICAqICAgICB3aGVuIGlucHV0IGNvbWVzIGZyb20gc3RhbmRhcmQgaW5wdXQuICAoVGhpcyBjYW4gYWxzbyBiZSBkb25lIGZvcgogICAgICogICAgIGFsbCBibG9ja3MgaWYgbGl0X2J1ZnNpemUgaXMgbm90IGdyZWF0ZXIgdGhhbiAzMksuKQogICAgICogICAtIGlmIGNvbXByZXNzaW9uIGlzIG5vdCBzdWNjZXNzZnVsIGZvciBhIGZpbGUgc21hbGxlciB0aGFuIDY0Sywgd2UgY2FuCiAgICAgKiAgICAgZXZlbiBlbWl0IGEgc3RvcmVkIGZpbGUgaW5zdGVhZCBvZiBhIHN0b3JlZCBibG9jayAoc2F2aW5nIDUgYnl0ZXMpLgogICAgICogICAgIFRoaXMgaXMgYXBwbGljYWJsZSBvbmx5IGZvciB6aXAgKG5vdCBnemlwIG9yIHpsaWIpLgogICAgICogICAtIGNyZWF0aW5nIG5ldyBIdWZmbWFuIHRyZWVzIGxlc3MgZnJlcXVlbnRseSBtYXkgbm90IHByb3ZpZGUgZmFzdAogICAgICogICAgIGFkYXB0YXRpb24gdG8gY2hhbmdlcyBpbiB0aGUgaW5wdXQgZGF0YSBzdGF0aXN0aWNzLiAoVGFrZSBmb3IKICAgICAqICAgICBleGFtcGxlIGEgYmluYXJ5IGZpbGUgd2l0aCBwb29ybHkgY29tcHJlc3NpYmxlIGNvZGUgZm9sbG93ZWQgYnkKICAgICAqICAgICBhIGhpZ2hseSBjb21wcmVzc2libGUgc3RyaW5nIHRhYmxlLikgU21hbGxlciBidWZmZXIgc2l6ZXMgZ2l2ZQogICAgICogICAgIGZhc3QgYWRhcHRhdGlvbiBidXQgaGF2ZSBvZiBjb3Vyc2UgdGhlIG92ZXJoZWFkIG9mIHRyYW5zbWl0dGluZwogICAgICogICAgIHRyZWVzIG1vcmUgZnJlcXVlbnRseS4KICAgICAqICAgLSBJIGNhbid0IGNvdW50IGFib3ZlIDQKICAgICAqLwoKICAgIHRoaXMubGFzdF9saXQgPSAwOyAgICAgIC8qIHJ1bm5pbmcgaW5kZXggaW4gbF9idWYgKi8KCiAgICB0aGlzLmRfYnVmID0gMDsKICAgIC8qIEJ1ZmZlciBpbmRleCBmb3IgZGlzdGFuY2VzLiBUbyBzaW1wbGlmeSB0aGUgY29kZSwgZF9idWYgYW5kIGxfYnVmIGhhdmUKICAgICAqIHRoZSBzYW1lIG51bWJlciBvZiBlbGVtZW50cy4gVG8gdXNlIGRpZmZlcmVudCBsZW5ndGhzLCBhbiBleHRyYSBmbGFnCiAgICAgKiBhcnJheSB3b3VsZCBiZSBuZWNlc3NhcnkuCiAgICAgKi8KCiAgICB0aGlzLm9wdF9sZW4gPSAwOyAgICAgICAvKiBiaXQgbGVuZ3RoIG9mIGN1cnJlbnQgYmxvY2sgd2l0aCBvcHRpbWFsIHRyZWVzICovCiAgICB0aGlzLnN0YXRpY19sZW4gPSAwOyAgICAvKiBiaXQgbGVuZ3RoIG9mIGN1cnJlbnQgYmxvY2sgd2l0aCBzdGF0aWMgdHJlZXMgKi8KICAgIHRoaXMubWF0Y2hlcyA9IDA7ICAgICAgIC8qIG51bWJlciBvZiBzdHJpbmcgbWF0Y2hlcyBpbiBjdXJyZW50IGJsb2NrICovCiAgICB0aGlzLmluc2VydCA9IDA7ICAgICAgICAvKiBieXRlcyBhdCBlbmQgb2Ygd2luZG93IGxlZnQgdG8gaW5zZXJ0ICovCgoKICAgIHRoaXMuYmlfYnVmID0gMDsKICAgIC8qIE91dHB1dCBidWZmZXIuIGJpdHMgYXJlIGluc2VydGVkIHN0YXJ0aW5nIGF0IHRoZSBib3R0b20gKGxlYXN0CiAgICAgKiBzaWduaWZpY2FudCBiaXRzKS4KICAgICAqLwogICAgdGhpcy5iaV92YWxpZCA9IDA7CiAgICAvKiBOdW1iZXIgb2YgdmFsaWQgYml0cyBpbiBiaV9idWYuICBBbGwgYml0cyBhYm92ZSB0aGUgbGFzdCB2YWxpZCBiaXQKICAgICAqIGFyZSBhbHdheXMgemVyby4KICAgICAqLwoKICAgIC8vIFVzZWQgZm9yIHdpbmRvdyBtZW1vcnkgaW5pdC4gV2Ugc2FmZWx5IGlnbm9yZSBpdCBmb3IgSlMuIFRoYXQgbWFrZXMKICAgIC8vIHNlbnNlIG9ubHkgZm9yIHBvaW50ZXJzIGFuZCBtZW1vcnkgY2hlY2sgdG9vbHMuCiAgICAvL3RoaXMuaGlnaF93YXRlciA9IDA7CiAgICAvKiBIaWdoIHdhdGVyIG1hcmsgb2Zmc2V0IGluIHdpbmRvdyBmb3IgaW5pdGlhbGl6ZWQgYnl0ZXMgLS0gYnl0ZXMgYWJvdmUKICAgICAqIHRoaXMgYXJlIHNldCB0byB6ZXJvIGluIG9yZGVyIHRvIGF2b2lkIG1lbW9yeSBjaGVjayB3YXJuaW5ncyB3aGVuCiAgICAgKiBsb25nZXN0IG1hdGNoIHJvdXRpbmVzIGFjY2VzcyBieXRlcyBwYXN0IHRoZSBpbnB1dC4gIFRoaXMgaXMgdGhlbgogICAgICogdXBkYXRlZCB0byB0aGUgbmV3IGhpZ2ggd2F0ZXIgbWFyay4KICAgICAqLwogIH0KCgogIGNvbnN0IGRlZmxhdGVSZXNldEtlZXAgPSAoc3RybSkgPT4gewoKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgewogICAgICByZXR1cm4gZXJyKHN0cm0sIFpfU1RSRUFNX0VSUk9SJDIpOwogICAgfQoKICAgIHN0cm0udG90YWxfaW4gPSBzdHJtLnRvdGFsX291dCA9IDA7CiAgICBzdHJtLmRhdGFfdHlwZSA9IFpfVU5LTk9XTjsKCiAgICBjb25zdCBzID0gc3RybS5zdGF0ZTsKICAgIHMucGVuZGluZyA9IDA7CiAgICBzLnBlbmRpbmdfb3V0ID0gMDsKCiAgICBpZiAocy53cmFwIDwgMCkgewogICAgICBzLndyYXAgPSAtcy53cmFwOwogICAgICAvKiB3YXMgbWFkZSBuZWdhdGl2ZSBieSBkZWZsYXRlKC4uLiwgWl9GSU5JU0gpOyAqLwogICAgfQogICAgcy5zdGF0dXMgPSAocy53cmFwID8gSU5JVF9TVEFURSA6IEJVU1lfU1RBVEUpOwogICAgc3RybS5hZGxlciA9IChzLndyYXAgPT09IDIpID8KICAgICAgMCAgLy8gY3JjMzIoMCwgWl9OVUxMLCAwKQogICAgOgogICAgICAxOyAvLyBhZGxlcjMyKDAsIFpfTlVMTCwgMCkKICAgIHMubGFzdF9mbHVzaCA9IFpfTk9fRkxVU0gkMjsKICAgIF90cl9pbml0KHMpOwogICAgcmV0dXJuIFpfT0skMzsKICB9OwoKCiAgY29uc3QgZGVmbGF0ZVJlc2V0ID0gKHN0cm0pID0+IHsKCiAgICBjb25zdCByZXQgPSBkZWZsYXRlUmVzZXRLZWVwKHN0cm0pOwogICAgaWYgKHJldCA9PT0gWl9PSyQzKSB7CiAgICAgIGxtX2luaXQoc3RybS5zdGF0ZSk7CiAgICB9CiAgICByZXR1cm4gcmV0OwogIH07CgoKICBjb25zdCBkZWZsYXRlU2V0SGVhZGVyID0gKHN0cm0sIGhlYWQpID0+IHsKCiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDI7IH0KICAgIGlmIChzdHJtLnN0YXRlLndyYXAgIT09IDIpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDI7IH0KICAgIHN0cm0uc3RhdGUuZ3poZWFkID0gaGVhZDsKICAgIHJldHVybiBaX09LJDM7CiAgfTsKCgogIGNvbnN0IGRlZmxhdGVJbml0MiA9IChzdHJtLCBsZXZlbCwgbWV0aG9kLCB3aW5kb3dCaXRzLCBtZW1MZXZlbCwgc3RyYXRlZ3kpID0+IHsKCiAgICBpZiAoIXN0cm0pIHsgLy8gPT09IFpfTlVMTAogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMjsKICAgIH0KICAgIGxldCB3cmFwID0gMTsKCiAgICBpZiAobGV2ZWwgPT09IFpfREVGQVVMVF9DT01QUkVTU0lPTiQxKSB7CiAgICAgIGxldmVsID0gNjsKICAgIH0KCiAgICBpZiAod2luZG93Qml0cyA8IDApIHsgLyogc3VwcHJlc3MgemxpYiB3cmFwcGVyICovCiAgICAgIHdyYXAgPSAwOwogICAgICB3aW5kb3dCaXRzID0gLXdpbmRvd0JpdHM7CiAgICB9CgogICAgZWxzZSBpZiAod2luZG93Qml0cyA+IDE1KSB7CiAgICAgIHdyYXAgPSAyOyAgICAgICAgICAgLyogd3JpdGUgZ3ppcCB3cmFwcGVyIGluc3RlYWQgKi8KICAgICAgd2luZG93Qml0cyAtPSAxNjsKICAgIH0KCgogICAgaWYgKG1lbUxldmVsIDwgMSB8fCBtZW1MZXZlbCA+IE1BWF9NRU1fTEVWRUwgfHwgbWV0aG9kICE9PSBaX0RFRkxBVEVEJDIgfHwKICAgICAgd2luZG93Qml0cyA8IDggfHwgd2luZG93Qml0cyA+IDE1IHx8IGxldmVsIDwgMCB8fCBsZXZlbCA+IDkgfHwKICAgICAgc3RyYXRlZ3kgPCAwIHx8IHN0cmF0ZWd5ID4gWl9GSVhFRCkgewogICAgICByZXR1cm4gZXJyKHN0cm0sIFpfU1RSRUFNX0VSUk9SJDIpOwogICAgfQoKCiAgICBpZiAod2luZG93Qml0cyA9PT0gOCkgewogICAgICB3aW5kb3dCaXRzID0gOTsKICAgIH0KICAgIC8qIHVudGlsIDI1Ni1ieXRlIHdpbmRvdyBidWcgZml4ZWQgKi8KCiAgICBjb25zdCBzID0gbmV3IERlZmxhdGVTdGF0ZSgpOwoKICAgIHN0cm0uc3RhdGUgPSBzOwogICAgcy5zdHJtID0gc3RybTsKCiAgICBzLndyYXAgPSB3cmFwOwogICAgcy5nemhlYWQgPSBudWxsOwogICAgcy53X2JpdHMgPSB3aW5kb3dCaXRzOwogICAgcy53X3NpemUgPSAxIDw8IHMud19iaXRzOwogICAgcy53X21hc2sgPSBzLndfc2l6ZSAtIDE7CgogICAgcy5oYXNoX2JpdHMgPSBtZW1MZXZlbCArIDc7CiAgICBzLmhhc2hfc2l6ZSA9IDEgPDwgcy5oYXNoX2JpdHM7CiAgICBzLmhhc2hfbWFzayA9IHMuaGFzaF9zaXplIC0gMTsKICAgIHMuaGFzaF9zaGlmdCA9IH5+KChzLmhhc2hfYml0cyArIE1JTl9NQVRDSCAtIDEpIC8gTUlOX01BVENIKTsKCiAgICBzLndpbmRvdyA9IG5ldyBVaW50OEFycmF5KHMud19zaXplICogMik7CiAgICBzLmhlYWQgPSBuZXcgVWludDE2QXJyYXkocy5oYXNoX3NpemUpOwogICAgcy5wcmV2ID0gbmV3IFVpbnQxNkFycmF5KHMud19zaXplKTsKCiAgICAvLyBEb24ndCBuZWVkIG1lbSBpbml0IG1hZ2ljIGZvciBKUy4KICAgIC8vcy5oaWdoX3dhdGVyID0gMDsgIC8qIG5vdGhpbmcgd3JpdHRlbiB0byBzLT53aW5kb3cgeWV0ICovCgogICAgcy5saXRfYnVmc2l6ZSA9IDEgPDwgKG1lbUxldmVsICsgNik7IC8qIDE2SyBlbGVtZW50cyBieSBkZWZhdWx0ICovCgogICAgcy5wZW5kaW5nX2J1Zl9zaXplID0gcy5saXRfYnVmc2l6ZSAqIDQ7CgogICAgLy9vdmVybGF5ID0gKHVzaGYgKikgWkFMTE9DKHN0cm0sIHMtPmxpdF9idWZzaXplLCBzaXplb2YodXNoKSsyKTsKICAgIC8vcy0+cGVuZGluZ19idWYgPSAodWNoZiAqKSBvdmVybGF5OwogICAgcy5wZW5kaW5nX2J1ZiA9IG5ldyBVaW50OEFycmF5KHMucGVuZGluZ19idWZfc2l6ZSk7CgogICAgLy8gSXQgaXMgb2Zmc2V0IGZyb20gYHMucGVuZGluZ19idWZgIChzaXplIGlzIGBzLmxpdF9idWZzaXplICogMmApCiAgICAvL3MtPmRfYnVmID0gb3ZlcmxheSArIHMtPmxpdF9idWZzaXplL3NpemVvZih1c2gpOwogICAgcy5kX2J1ZiA9IDEgKiBzLmxpdF9idWZzaXplOwoKICAgIC8vcy0+bF9idWYgPSBzLT5wZW5kaW5nX2J1ZiArICgxK3NpemVvZih1c2gpKSpzLT5saXRfYnVmc2l6ZTsKICAgIHMubF9idWYgPSAoMSArIDIpICogcy5saXRfYnVmc2l6ZTsKCiAgICBzLmxldmVsID0gbGV2ZWw7CiAgICBzLnN0cmF0ZWd5ID0gc3RyYXRlZ3k7CiAgICBzLm1ldGhvZCA9IG1ldGhvZDsKCiAgICByZXR1cm4gZGVmbGF0ZVJlc2V0KHN0cm0pOwogIH07CgogIGNvbnN0IGRlZmxhdGVJbml0ID0gKHN0cm0sIGxldmVsKSA9PiB7CgogICAgcmV0dXJuIGRlZmxhdGVJbml0MihzdHJtLCBsZXZlbCwgWl9ERUZMQVRFRCQyLCBNQVhfV0JJVFMkMSwgREVGX01FTV9MRVZFTCwgWl9ERUZBVUxUX1NUUkFURUdZJDEpOwogIH07CgoKICBjb25zdCBkZWZsYXRlJDIgPSAoc3RybSwgZmx1c2gpID0+IHsKCiAgICBsZXQgYmVnLCB2YWw7IC8vIGZvciBnemlwIGhlYWRlciB3cml0ZSBvbmx5CgogICAgaWYgKCFzdHJtIHx8ICFzdHJtLnN0YXRlIHx8CiAgICAgIGZsdXNoID4gWl9CTE9DSyQxIHx8IGZsdXNoIDwgMCkgewogICAgICByZXR1cm4gc3RybSA/IGVycihzdHJtLCBaX1NUUkVBTV9FUlJPUiQyKSA6IFpfU1RSRUFNX0VSUk9SJDI7CiAgICB9CgogICAgY29uc3QgcyA9IHN0cm0uc3RhdGU7CgogICAgaWYgKCFzdHJtLm91dHB1dCB8fAogICAgICAgICghc3RybS5pbnB1dCAmJiBzdHJtLmF2YWlsX2luICE9PSAwKSB8fAogICAgICAgIChzLnN0YXR1cyA9PT0gRklOSVNIX1NUQVRFICYmIGZsdXNoICE9PSBaX0ZJTklTSCQzKSkgewogICAgICByZXR1cm4gZXJyKHN0cm0sIChzdHJtLmF2YWlsX291dCA9PT0gMCkgPyBaX0JVRl9FUlJPUiQxIDogWl9TVFJFQU1fRVJST1IkMik7CiAgICB9CgogICAgcy5zdHJtID0gc3RybTsgLyoganVzdCBpbiBjYXNlICovCiAgICBjb25zdCBvbGRfZmx1c2ggPSBzLmxhc3RfZmx1c2g7CiAgICBzLmxhc3RfZmx1c2ggPSBmbHVzaDsKCiAgICAvKiBXcml0ZSB0aGUgaGVhZGVyICovCiAgICBpZiAocy5zdGF0dXMgPT09IElOSVRfU1RBVEUpIHsKCiAgICAgIGlmIChzLndyYXAgPT09IDIpIHsgLy8gR1pJUCBoZWFkZXIKICAgICAgICBzdHJtLmFkbGVyID0gMDsgIC8vY3JjMzIoMEwsIFpfTlVMTCwgMCk7CiAgICAgICAgcHV0X2J5dGUocywgMzEpOwogICAgICAgIHB1dF9ieXRlKHMsIDEzOSk7CiAgICAgICAgcHV0X2J5dGUocywgOCk7CiAgICAgICAgaWYgKCFzLmd6aGVhZCkgeyAvLyBzLT5nemhlYWQgPT0gWl9OVUxMCiAgICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIDApOwogICAgICAgICAgcHV0X2J5dGUocywgMCk7CiAgICAgICAgICBwdXRfYnl0ZShzLCAwKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIDApOwogICAgICAgICAgcHV0X2J5dGUocywgcy5sZXZlbCA9PT0gOSA/IDIgOgogICAgICAgICAgICAgICAgICAgICAgKHMuc3RyYXRlZ3kgPj0gWl9IVUZGTUFOX09OTFkgfHwgcy5sZXZlbCA8IDIgPwogICAgICAgICAgICAgICAgICAgICAgIDQgOiAwKSk7CiAgICAgICAgICBwdXRfYnl0ZShzLCBPU19DT0RFKTsKICAgICAgICAgIHMuc3RhdHVzID0gQlVTWV9TVEFURTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBwdXRfYnl0ZShzLCAocy5nemhlYWQudGV4dCA/IDEgOiAwKSArCiAgICAgICAgICAgICAgICAgICAgICAocy5nemhlYWQuaGNyYyA/IDIgOiAwKSArCiAgICAgICAgICAgICAgICAgICAgICAoIXMuZ3poZWFkLmV4dHJhID8gMCA6IDQpICsKICAgICAgICAgICAgICAgICAgICAgICghcy5nemhlYWQubmFtZSA/IDAgOiA4KSArCiAgICAgICAgICAgICAgICAgICAgICAoIXMuZ3poZWFkLmNvbW1lbnQgPyAwIDogMTYpCiAgICAgICAgICApOwogICAgICAgICAgcHV0X2J5dGUocywgcy5nemhlYWQudGltZSAmIDB4ZmYpOwogICAgICAgICAgcHV0X2J5dGUocywgKHMuZ3poZWFkLnRpbWUgPj4gOCkgJiAweGZmKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIChzLmd6aGVhZC50aW1lID4+IDE2KSAmIDB4ZmYpOwogICAgICAgICAgcHV0X2J5dGUocywgKHMuZ3poZWFkLnRpbWUgPj4gMjQpICYgMHhmZik7CiAgICAgICAgICBwdXRfYnl0ZShzLCBzLmxldmVsID09PSA5ID8gMiA6CiAgICAgICAgICAgICAgICAgICAgICAocy5zdHJhdGVneSA+PSBaX0hVRkZNQU5fT05MWSB8fCBzLmxldmVsIDwgMiA/CiAgICAgICAgICAgICAgICAgICAgICAgNCA6IDApKTsKICAgICAgICAgIHB1dF9ieXRlKHMsIHMuZ3poZWFkLm9zICYgMHhmZik7CiAgICAgICAgICBpZiAocy5nemhlYWQuZXh0cmEgJiYgcy5nemhlYWQuZXh0cmEubGVuZ3RoKSB7CiAgICAgICAgICAgIHB1dF9ieXRlKHMsIHMuZ3poZWFkLmV4dHJhLmxlbmd0aCAmIDB4ZmYpOwogICAgICAgICAgICBwdXRfYnl0ZShzLCAocy5nemhlYWQuZXh0cmEubGVuZ3RoID4+IDgpICYgMHhmZik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocy5nemhlYWQuaGNyYykgewogICAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzJfMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcsIDApOwogICAgICAgICAgfQogICAgICAgICAgcy5nemluZGV4ID0gMDsKICAgICAgICAgIHMuc3RhdHVzID0gRVhUUkFfU1RBVEU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgLy8gREVGTEFURSBoZWFkZXIKICAgICAgewogICAgICAgIGxldCBoZWFkZXIgPSAoWl9ERUZMQVRFRCQyICsgKChzLndfYml0cyAtIDgpIDw8IDQpKSA8PCA4OwogICAgICAgIGxldCBsZXZlbF9mbGFncyA9IC0xOwoKICAgICAgICBpZiAocy5zdHJhdGVneSA+PSBaX0hVRkZNQU5fT05MWSB8fCBzLmxldmVsIDwgMikgewogICAgICAgICAgbGV2ZWxfZmxhZ3MgPSAwOwogICAgICAgIH0gZWxzZSBpZiAocy5sZXZlbCA8IDYpIHsKICAgICAgICAgIGxldmVsX2ZsYWdzID0gMTsKICAgICAgICB9IGVsc2UgaWYgKHMubGV2ZWwgPT09IDYpIHsKICAgICAgICAgIGxldmVsX2ZsYWdzID0gMjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGV2ZWxfZmxhZ3MgPSAzOwogICAgICAgIH0KICAgICAgICBoZWFkZXIgfD0gKGxldmVsX2ZsYWdzIDw8IDYpOwogICAgICAgIGlmIChzLnN0cnN0YXJ0ICE9PSAwKSB7IGhlYWRlciB8PSBQUkVTRVRfRElDVDsgfQogICAgICAgIGhlYWRlciArPSAzMSAtIChoZWFkZXIgJSAzMSk7CgogICAgICAgIHMuc3RhdHVzID0gQlVTWV9TVEFURTsKICAgICAgICBwdXRTaG9ydE1TQihzLCBoZWFkZXIpOwoKICAgICAgICAvKiBTYXZlIHRoZSBhZGxlcjMyIG9mIHRoZSBwcmVzZXQgZGljdGlvbmFyeTogKi8KICAgICAgICBpZiAocy5zdHJzdGFydCAhPT0gMCkgewogICAgICAgICAgcHV0U2hvcnRNU0Iocywgc3RybS5hZGxlciA+Pj4gMTYpOwogICAgICAgICAgcHV0U2hvcnRNU0Iocywgc3RybS5hZGxlciAmIDB4ZmZmZik7CiAgICAgICAgfQogICAgICAgIHN0cm0uYWRsZXIgPSAxOyAvLyBhZGxlcjMyKDBMLCBaX05VTEwsIDApOwogICAgICB9CiAgICB9CgogIC8vI2lmZGVmIEdaSVAKICAgIGlmIChzLnN0YXR1cyA9PT0gRVhUUkFfU1RBVEUpIHsKICAgICAgaWYgKHMuZ3poZWFkLmV4dHJhLyogIT0gWl9OVUxMKi8pIHsKICAgICAgICBiZWcgPSBzLnBlbmRpbmc7ICAvKiBzdGFydCBvZiBieXRlcyB0byB1cGRhdGUgY3JjICovCgogICAgICAgIHdoaWxlIChzLmd6aW5kZXggPCAocy5nemhlYWQuZXh0cmEubGVuZ3RoICYgMHhmZmZmKSkgewogICAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICAgIGlmIChzLmd6aGVhZC5oY3JjICYmIHMucGVuZGluZyA+IGJlZykgewogICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBjcmMzMl8xKHN0cm0uYWRsZXIsIHMucGVuZGluZ19idWYsIHMucGVuZGluZyAtIGJlZywgYmVnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgICAgICBiZWcgPSBzLnBlbmRpbmc7CiAgICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBwdXRfYnl0ZShzLCBzLmd6aGVhZC5leHRyYVtzLmd6aW5kZXhdICYgMHhmZik7CiAgICAgICAgICBzLmd6aW5kZXgrKzsKICAgICAgICB9CiAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzJfMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgfQogICAgICAgIGlmIChzLmd6aW5kZXggPT09IHMuZ3poZWFkLmV4dHJhLmxlbmd0aCkgewogICAgICAgICAgcy5nemluZGV4ID0gMDsKICAgICAgICAgIHMuc3RhdHVzID0gTkFNRV9TVEFURTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgcy5zdGF0dXMgPSBOQU1FX1NUQVRFOwogICAgICB9CiAgICB9CiAgICBpZiAocy5zdGF0dXMgPT09IE5BTUVfU1RBVEUpIHsKICAgICAgaWYgKHMuZ3poZWFkLm5hbWUvKiAhPSBaX05VTEwqLykgewogICAgICAgIGJlZyA9IHMucGVuZGluZzsgIC8qIHN0YXJ0IG9mIGJ5dGVzIHRvIHVwZGF0ZSBjcmMgKi8KICAgICAgICAvL2ludCB2YWw7CgogICAgICAgIGRvIHsKICAgICAgICAgIGlmIChzLnBlbmRpbmcgPT09IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgICBpZiAocy5nemhlYWQuaGNyYyAmJiBzLnBlbmRpbmcgPiBiZWcpIHsKICAgICAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzJfMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgICAgICAgICAgYmVnID0gcy5wZW5kaW5nOwogICAgICAgICAgICBpZiAocy5wZW5kaW5nID09PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgICAgICB2YWwgPSAxOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvLyBKUyBzcGVjaWZpYzogbGl0dGxlIG1hZ2ljIHRvIGFkZCB6ZXJvIHRlcm1pbmF0b3IgdG8gZW5kIG9mIHN0cmluZwogICAgICAgICAgaWYgKHMuZ3ppbmRleCA8IHMuZ3poZWFkLm5hbWUubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhbCA9IHMuZ3poZWFkLm5hbWUuY2hhckNvZGVBdChzLmd6aW5kZXgrKykgJiAweGZmOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIHB1dF9ieXRlKHMsIHZhbCk7CiAgICAgICAgfSB3aGlsZSAodmFsICE9PSAwKTsKCiAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICBzdHJtLmFkbGVyID0gY3JjMzJfMShzdHJtLmFkbGVyLCBzLnBlbmRpbmdfYnVmLCBzLnBlbmRpbmcgLSBiZWcsIGJlZyk7CiAgICAgICAgfQogICAgICAgIGlmICh2YWwgPT09IDApIHsKICAgICAgICAgIHMuZ3ppbmRleCA9IDA7CiAgICAgICAgICBzLnN0YXR1cyA9IENPTU1FTlRfU1RBVEU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHMuc3RhdHVzID0gQ09NTUVOVF9TVEFURTsKICAgICAgfQogICAgfQogICAgaWYgKHMuc3RhdHVzID09PSBDT01NRU5UX1NUQVRFKSB7CiAgICAgIGlmIChzLmd6aGVhZC5jb21tZW50LyogIT0gWl9OVUxMKi8pIHsKICAgICAgICBiZWcgPSBzLnBlbmRpbmc7ICAvKiBzdGFydCBvZiBieXRlcyB0byB1cGRhdGUgY3JjICovCiAgICAgICAgLy9pbnQgdmFsOwoKICAgICAgICBkbyB7CiAgICAgICAgICBpZiAocy5wZW5kaW5nID09PSBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgICAgaWYgKHMuZ3poZWFkLmhjcmMgJiYgcy5wZW5kaW5nID4gYmVnKSB7CiAgICAgICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyXzEoc3RybS5hZGxlciwgcy5wZW5kaW5nX2J1Ziwgcy5wZW5kaW5nIC0gYmVnLCBiZWcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZsdXNoX3BlbmRpbmcoc3RybSk7CiAgICAgICAgICAgIGJlZyA9IHMucGVuZGluZzsKICAgICAgICAgICAgaWYgKHMucGVuZGluZyA9PT0gcy5wZW5kaW5nX2J1Zl9zaXplKSB7CiAgICAgICAgICAgICAgdmFsID0gMTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLy8gSlMgc3BlY2lmaWM6IGxpdHRsZSBtYWdpYyB0byBhZGQgemVybyB0ZXJtaW5hdG9yIHRvIGVuZCBvZiBzdHJpbmcKICAgICAgICAgIGlmIChzLmd6aW5kZXggPCBzLmd6aGVhZC5jb21tZW50Lmxlbmd0aCkgewogICAgICAgICAgICB2YWwgPSBzLmd6aGVhZC5jb21tZW50LmNoYXJDb2RlQXQocy5nemluZGV4KyspICYgMHhmZjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhbCA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICBwdXRfYnl0ZShzLCB2YWwpOwogICAgICAgIH0gd2hpbGUgKHZhbCAhPT0gMCk7CgogICAgICAgIGlmIChzLmd6aGVhZC5oY3JjICYmIHMucGVuZGluZyA+IGJlZykgewogICAgICAgICAgc3RybS5hZGxlciA9IGNyYzMyXzEoc3RybS5hZGxlciwgcy5wZW5kaW5nX2J1Ziwgcy5wZW5kaW5nIC0gYmVnLCBiZWcpOwogICAgICAgIH0KICAgICAgICBpZiAodmFsID09PSAwKSB7CiAgICAgICAgICBzLnN0YXR1cyA9IEhDUkNfU1RBVEU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHMuc3RhdHVzID0gSENSQ19TVEFURTsKICAgICAgfQogICAgfQogICAgaWYgKHMuc3RhdHVzID09PSBIQ1JDX1NUQVRFKSB7CiAgICAgIGlmIChzLmd6aGVhZC5oY3JjKSB7CiAgICAgICAgaWYgKHMucGVuZGluZyArIDIgPiBzLnBlbmRpbmdfYnVmX3NpemUpIHsKICAgICAgICAgIGZsdXNoX3BlbmRpbmcoc3RybSk7CiAgICAgICAgfQogICAgICAgIGlmIChzLnBlbmRpbmcgKyAyIDw9IHMucGVuZGluZ19idWZfc2l6ZSkgewogICAgICAgICAgcHV0X2J5dGUocywgc3RybS5hZGxlciAmIDB4ZmYpOwogICAgICAgICAgcHV0X2J5dGUocywgKHN0cm0uYWRsZXIgPj4gOCkgJiAweGZmKTsKICAgICAgICAgIHN0cm0uYWRsZXIgPSAwOyAvL2NyYzMyKDBMLCBaX05VTEwsIDApOwogICAgICAgICAgcy5zdGF0dXMgPSBCVVNZX1NUQVRFOwogICAgICAgIH0KICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICBzLnN0YXR1cyA9IEJVU1lfU1RBVEU7CiAgICAgIH0KICAgIH0KICAvLyNlbmRpZgoKICAgIC8qIEZsdXNoIGFzIG11Y2ggcGVuZGluZyBvdXRwdXQgYXMgcG9zc2libGUgKi8KICAgIGlmIChzLnBlbmRpbmcgIT09IDApIHsKICAgICAgZmx1c2hfcGVuZGluZyhzdHJtKTsKICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgLyogU2luY2UgYXZhaWxfb3V0IGlzIDAsIGRlZmxhdGUgd2lsbCBiZSBjYWxsZWQgYWdhaW4gd2l0aAogICAgICAgICAqIG1vcmUgb3V0cHV0IHNwYWNlLCBidXQgcG9zc2libHkgd2l0aCBib3RoIHBlbmRpbmcgYW5kCiAgICAgICAgICogYXZhaWxfaW4gZXF1YWwgdG8gemVyby4gVGhlcmUgd29uJ3QgYmUgYW55dGhpbmcgdG8gZG8sCiAgICAgICAgICogYnV0IHRoaXMgaXMgbm90IGFuIGVycm9yIHNpdHVhdGlvbiBzbyBtYWtlIHN1cmUgd2UKICAgICAgICAgKiByZXR1cm4gT0sgaW5zdGVhZCBvZiBCVUZfRVJST1IgYXQgbmV4dCBjYWxsIG9mIGRlZmxhdGU6CiAgICAgICAgICovCiAgICAgICAgcy5sYXN0X2ZsdXNoID0gLTE7CiAgICAgICAgcmV0dXJuIFpfT0skMzsKICAgICAgfQoKICAgICAgLyogTWFrZSBzdXJlIHRoZXJlIGlzIHNvbWV0aGluZyB0byBkbyBhbmQgYXZvaWQgZHVwbGljYXRlIGNvbnNlY3V0aXZlCiAgICAgICAqIGZsdXNoZXMuIEZvciByZXBlYXRlZCBhbmQgdXNlbGVzcyBjYWxscyB3aXRoIFpfRklOSVNILCB3ZSBrZWVwCiAgICAgICAqIHJldHVybmluZyBaX1NUUkVBTV9FTkQgaW5zdGVhZCBvZiBaX0JVRl9FUlJPUi4KICAgICAgICovCiAgICB9IGVsc2UgaWYgKHN0cm0uYXZhaWxfaW4gPT09IDAgJiYgcmFuayhmbHVzaCkgPD0gcmFuayhvbGRfZmx1c2gpICYmCiAgICAgIGZsdXNoICE9PSBaX0ZJTklTSCQzKSB7CiAgICAgIHJldHVybiBlcnIoc3RybSwgWl9CVUZfRVJST1IkMSk7CiAgICB9CgogICAgLyogVXNlciBtdXN0IG5vdCBwcm92aWRlIG1vcmUgaW5wdXQgYWZ0ZXIgdGhlIGZpcnN0IEZJTklTSDogKi8KICAgIGlmIChzLnN0YXR1cyA9PT0gRklOSVNIX1NUQVRFICYmIHN0cm0uYXZhaWxfaW4gIT09IDApIHsKICAgICAgcmV0dXJuIGVycihzdHJtLCBaX0JVRl9FUlJPUiQxKTsKICAgIH0KCiAgICAvKiBTdGFydCBhIG5ldyBibG9jayBvciBjb250aW51ZSB0aGUgY3VycmVudCBvbmUuCiAgICAgKi8KICAgIGlmIChzdHJtLmF2YWlsX2luICE9PSAwIHx8IHMubG9va2FoZWFkICE9PSAwIHx8CiAgICAgIChmbHVzaCAhPT0gWl9OT19GTFVTSCQyICYmIHMuc3RhdHVzICE9PSBGSU5JU0hfU1RBVEUpKSB7CiAgICAgIGxldCBic3RhdGUgPSAocy5zdHJhdGVneSA9PT0gWl9IVUZGTUFOX09OTFkpID8gZGVmbGF0ZV9odWZmKHMsIGZsdXNoKSA6CiAgICAgICAgKHMuc3RyYXRlZ3kgPT09IFpfUkxFID8gZGVmbGF0ZV9ybGUocywgZmx1c2gpIDoKICAgICAgICAgIGNvbmZpZ3VyYXRpb25fdGFibGVbcy5sZXZlbF0uZnVuYyhzLCBmbHVzaCkpOwoKICAgICAgaWYgKGJzdGF0ZSA9PT0gQlNfRklOSVNIX1NUQVJURUQgfHwgYnN0YXRlID09PSBCU19GSU5JU0hfRE9ORSkgewogICAgICAgIHMuc3RhdHVzID0gRklOSVNIX1NUQVRFOwogICAgICB9CiAgICAgIGlmIChic3RhdGUgPT09IEJTX05FRURfTU9SRSB8fCBic3RhdGUgPT09IEJTX0ZJTklTSF9TVEFSVEVEKSB7CiAgICAgICAgaWYgKHN0cm0uYXZhaWxfb3V0ID09PSAwKSB7CiAgICAgICAgICBzLmxhc3RfZmx1c2ggPSAtMTsKICAgICAgICAgIC8qIGF2b2lkIEJVRl9FUlJPUiBuZXh0IGNhbGwsIHNlZSBhYm92ZSAqLwogICAgICAgIH0KICAgICAgICByZXR1cm4gWl9PSyQzOwogICAgICAgIC8qIElmIGZsdXNoICE9IFpfTk9fRkxVU0ggJiYgYXZhaWxfb3V0ID09IDAsIHRoZSBuZXh0IGNhbGwKICAgICAgICAgKiBvZiBkZWZsYXRlIHNob3VsZCB1c2UgdGhlIHNhbWUgZmx1c2ggcGFyYW1ldGVyIHRvIG1ha2Ugc3VyZQogICAgICAgICAqIHRoYXQgdGhlIGZsdXNoIGlzIGNvbXBsZXRlLiBTbyB3ZSBkb24ndCBoYXZlIHRvIG91dHB1dCBhbgogICAgICAgICAqIGVtcHR5IGJsb2NrIGhlcmUsIHRoaXMgd2lsbCBiZSBkb25lIGF0IG5leHQgY2FsbC4gVGhpcyBhbHNvCiAgICAgICAgICogZW5zdXJlcyB0aGF0IGZvciBhIHZlcnkgc21hbGwgb3V0cHV0IGJ1ZmZlciwgd2UgZW1pdCBhdCBtb3N0CiAgICAgICAgICogb25lIGVtcHR5IGJsb2NrLgogICAgICAgICAqLwogICAgICB9CiAgICAgIGlmIChic3RhdGUgPT09IEJTX0JMT0NLX0RPTkUpIHsKICAgICAgICBpZiAoZmx1c2ggPT09IFpfUEFSVElBTF9GTFVTSCkgewogICAgICAgICAgX3RyX2FsaWduKHMpOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChmbHVzaCAhPT0gWl9CTE9DSyQxKSB7IC8qIEZVTExfRkxVU0ggb3IgU1lOQ19GTFVTSCAqLwoKICAgICAgICAgIF90cl9zdG9yZWRfYmxvY2socywgMCwgMCwgZmFsc2UpOwogICAgICAgICAgLyogRm9yIGEgZnVsbCBmbHVzaCwgdGhpcyBlbXB0eSBibG9jayB3aWxsIGJlIHJlY29nbml6ZWQKICAgICAgICAgICAqIGFzIGEgc3BlY2lhbCBtYXJrZXIgYnkgaW5mbGF0ZV9zeW5jKCkuCiAgICAgICAgICAgKi8KICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9GVUxMX0ZMVVNIJDEpIHsKICAgICAgICAgICAgLyoqKiBDTEVBUl9IQVNIKHMpOyAqKiovICAgICAgICAgICAgIC8qIGZvcmdldCBoaXN0b3J5ICovCiAgICAgICAgICAgIHplcm8ocy5oZWFkKTsgLy8gRmlsbCB3aXRoIE5JTCAoPSAwKTsKCiAgICAgICAgICAgIGlmIChzLmxvb2thaGVhZCA9PT0gMCkgewogICAgICAgICAgICAgIHMuc3Ryc3RhcnQgPSAwOwogICAgICAgICAgICAgIHMuYmxvY2tfc3RhcnQgPSAwOwogICAgICAgICAgICAgIHMuaW5zZXJ0ID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgICAgcy5sYXN0X2ZsdXNoID0gLTE7IC8qIGF2b2lkIEJVRl9FUlJPUiBhdCBuZXh0IGNhbGwsIHNlZSBhYm92ZSAqLwogICAgICAgICAgcmV0dXJuIFpfT0skMzsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8vQXNzZXJ0KHN0cm0tPmF2YWlsX291dCA+IDAsICJidWcyIik7CiAgICAvL2lmIChzdHJtLmF2YWlsX291dCA8PSAwKSB7IHRocm93IG5ldyBFcnJvcigiYnVnMiIpO30KCiAgICBpZiAoZmx1c2ggIT09IFpfRklOSVNIJDMpIHsgcmV0dXJuIFpfT0skMzsgfQogICAgaWYgKHMud3JhcCA8PSAwKSB7IHJldHVybiBaX1NUUkVBTV9FTkQkMzsgfQoKICAgIC8qIFdyaXRlIHRoZSB0cmFpbGVyICovCiAgICBpZiAocy53cmFwID09PSAyKSB7CiAgICAgIHB1dF9ieXRlKHMsIHN0cm0uYWRsZXIgJiAweGZmKTsKICAgICAgcHV0X2J5dGUocywgKHN0cm0uYWRsZXIgPj4gOCkgJiAweGZmKTsKICAgICAgcHV0X2J5dGUocywgKHN0cm0uYWRsZXIgPj4gMTYpICYgMHhmZik7CiAgICAgIHB1dF9ieXRlKHMsIChzdHJtLmFkbGVyID4+IDI0KSAmIDB4ZmYpOwogICAgICBwdXRfYnl0ZShzLCBzdHJtLnRvdGFsX2luICYgMHhmZik7CiAgICAgIHB1dF9ieXRlKHMsIChzdHJtLnRvdGFsX2luID4+IDgpICYgMHhmZik7CiAgICAgIHB1dF9ieXRlKHMsIChzdHJtLnRvdGFsX2luID4+IDE2KSAmIDB4ZmYpOwogICAgICBwdXRfYnl0ZShzLCAoc3RybS50b3RhbF9pbiA+PiAyNCkgJiAweGZmKTsKICAgIH0KICAgIGVsc2UKICAgIHsKICAgICAgcHV0U2hvcnRNU0Iocywgc3RybS5hZGxlciA+Pj4gMTYpOwogICAgICBwdXRTaG9ydE1TQihzLCBzdHJtLmFkbGVyICYgMHhmZmZmKTsKICAgIH0KCiAgICBmbHVzaF9wZW5kaW5nKHN0cm0pOwogICAgLyogSWYgYXZhaWxfb3V0IGlzIHplcm8sIHRoZSBhcHBsaWNhdGlvbiB3aWxsIGNhbGwgZGVmbGF0ZSBhZ2FpbgogICAgICogdG8gZmx1c2ggdGhlIHJlc3QuCiAgICAgKi8KICAgIGlmIChzLndyYXAgPiAwKSB7IHMud3JhcCA9IC1zLndyYXA7IH0KICAgIC8qIHdyaXRlIHRoZSB0cmFpbGVyIG9ubHkgb25jZSEgKi8KICAgIHJldHVybiBzLnBlbmRpbmcgIT09IDAgPyBaX09LJDMgOiBaX1NUUkVBTV9FTkQkMzsKICB9OwoKCiAgY29uc3QgZGVmbGF0ZUVuZCA9IChzdHJtKSA9PiB7CgogICAgaWYgKCFzdHJtLyo9PSBaX05VTEwqLyB8fCAhc3RybS5zdGF0ZS8qPT0gWl9OVUxMKi8pIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDI7CiAgICB9CgogICAgY29uc3Qgc3RhdHVzID0gc3RybS5zdGF0ZS5zdGF0dXM7CiAgICBpZiAoc3RhdHVzICE9PSBJTklUX1NUQVRFICYmCiAgICAgIHN0YXR1cyAhPT0gRVhUUkFfU1RBVEUgJiYKICAgICAgc3RhdHVzICE9PSBOQU1FX1NUQVRFICYmCiAgICAgIHN0YXR1cyAhPT0gQ09NTUVOVF9TVEFURSAmJgogICAgICBzdGF0dXMgIT09IEhDUkNfU1RBVEUgJiYKICAgICAgc3RhdHVzICE9PSBCVVNZX1NUQVRFICYmCiAgICAgIHN0YXR1cyAhPT0gRklOSVNIX1NUQVRFCiAgICApIHsKICAgICAgcmV0dXJuIGVycihzdHJtLCBaX1NUUkVBTV9FUlJPUiQyKTsKICAgIH0KCiAgICBzdHJtLnN0YXRlID0gbnVsbDsKCiAgICByZXR1cm4gc3RhdHVzID09PSBCVVNZX1NUQVRFID8gZXJyKHN0cm0sIFpfREFUQV9FUlJPUiQyKSA6IFpfT0skMzsKICB9OwoKCiAgLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAqIEluaXRpYWxpemVzIHRoZSBjb21wcmVzc2lvbiBkaWN0aW9uYXJ5IGZyb20gdGhlIGdpdmVuIGJ5dGUKICAgKiBzZXF1ZW5jZSB3aXRob3V0IHByb2R1Y2luZyBhbnkgY29tcHJlc3NlZCBvdXRwdXQuCiAgICovCiAgY29uc3QgZGVmbGF0ZVNldERpY3Rpb25hcnkgPSAoc3RybSwgZGljdGlvbmFyeSkgPT4gewoKICAgIGxldCBkaWN0TGVuZ3RoID0gZGljdGlvbmFyeS5sZW5ndGg7CgogICAgaWYgKCFzdHJtLyo9PSBaX05VTEwqLyB8fCAhc3RybS5zdGF0ZS8qPT0gWl9OVUxMKi8pIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDI7CiAgICB9CgogICAgY29uc3QgcyA9IHN0cm0uc3RhdGU7CiAgICBjb25zdCB3cmFwID0gcy53cmFwOwoKICAgIGlmICh3cmFwID09PSAyIHx8ICh3cmFwID09PSAxICYmIHMuc3RhdHVzICE9PSBJTklUX1NUQVRFKSB8fCBzLmxvb2thaGVhZCkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMjsKICAgIH0KCiAgICAvKiB3aGVuIHVzaW5nIHpsaWIgd3JhcHBlcnMsIGNvbXB1dGUgQWRsZXItMzIgZm9yIHByb3ZpZGVkIGRpY3Rpb25hcnkgKi8KICAgIGlmICh3cmFwID09PSAxKSB7CiAgICAgIC8qIGFkbGVyMzIoc3RybS0+YWRsZXIsIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgpOyAqLwogICAgICBzdHJtLmFkbGVyID0gYWRsZXIzMl8xKHN0cm0uYWRsZXIsIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgsIDApOwogICAgfQoKICAgIHMud3JhcCA9IDA7ICAgLyogYXZvaWQgY29tcHV0aW5nIEFkbGVyLTMyIGluIHJlYWRfYnVmICovCgogICAgLyogaWYgZGljdGlvbmFyeSB3b3VsZCBmaWxsIHdpbmRvdywganVzdCByZXBsYWNlIHRoZSBoaXN0b3J5ICovCiAgICBpZiAoZGljdExlbmd0aCA+PSBzLndfc2l6ZSkgewogICAgICBpZiAod3JhcCA9PT0gMCkgeyAgICAgICAgICAgIC8qIGFscmVhZHkgZW1wdHkgb3RoZXJ3aXNlICovCiAgICAgICAgLyoqKiBDTEVBUl9IQVNIKHMpOyAqKiovCiAgICAgICAgemVybyhzLmhlYWQpOyAvLyBGaWxsIHdpdGggTklMICg9IDApOwogICAgICAgIHMuc3Ryc3RhcnQgPSAwOwogICAgICAgIHMuYmxvY2tfc3RhcnQgPSAwOwogICAgICAgIHMuaW5zZXJ0ID0gMDsKICAgICAgfQogICAgICAvKiB1c2UgdGhlIHRhaWwgKi8KICAgICAgLy8gZGljdGlvbmFyeSA9IGRpY3Rpb25hcnkuc2xpY2UoZGljdExlbmd0aCAtIHMud19zaXplKTsKICAgICAgbGV0IHRtcERpY3QgPSBuZXcgVWludDhBcnJheShzLndfc2l6ZSk7CiAgICAgIHRtcERpY3Quc2V0KGRpY3Rpb25hcnkuc3ViYXJyYXkoZGljdExlbmd0aCAtIHMud19zaXplLCBkaWN0TGVuZ3RoKSwgMCk7CiAgICAgIGRpY3Rpb25hcnkgPSB0bXBEaWN0OwogICAgICBkaWN0TGVuZ3RoID0gcy53X3NpemU7CiAgICB9CiAgICAvKiBpbnNlcnQgZGljdGlvbmFyeSBpbnRvIHdpbmRvdyBhbmQgaGFzaCAqLwogICAgY29uc3QgYXZhaWwgPSBzdHJtLmF2YWlsX2luOwogICAgY29uc3QgbmV4dCA9IHN0cm0ubmV4dF9pbjsKICAgIGNvbnN0IGlucHV0ID0gc3RybS5pbnB1dDsKICAgIHN0cm0uYXZhaWxfaW4gPSBkaWN0TGVuZ3RoOwogICAgc3RybS5uZXh0X2luID0gMDsKICAgIHN0cm0uaW5wdXQgPSBkaWN0aW9uYXJ5OwogICAgZmlsbF93aW5kb3cocyk7CiAgICB3aGlsZSAocy5sb29rYWhlYWQgPj0gTUlOX01BVENIKSB7CiAgICAgIGxldCBzdHIgPSBzLnN0cnN0YXJ0OwogICAgICBsZXQgbiA9IHMubG9va2FoZWFkIC0gKE1JTl9NQVRDSCAtIDEpOwogICAgICBkbyB7CiAgICAgICAgLyogVVBEQVRFX0hBU0gocywgcy0+aW5zX2gsIHMtPndpbmRvd1tzdHIgKyBNSU5fTUFUQ0gtMV0pOyAqLwogICAgICAgIHMuaW5zX2ggPSBIQVNIKHMsIHMuaW5zX2gsIHMud2luZG93W3N0ciArIE1JTl9NQVRDSCAtIDFdKTsKCiAgICAgICAgcy5wcmV2W3N0ciAmIHMud19tYXNrXSA9IHMuaGVhZFtzLmluc19oXTsKCiAgICAgICAgcy5oZWFkW3MuaW5zX2hdID0gc3RyOwogICAgICAgIHN0cisrOwogICAgICB9IHdoaWxlICgtLW4pOwogICAgICBzLnN0cnN0YXJ0ID0gc3RyOwogICAgICBzLmxvb2thaGVhZCA9IE1JTl9NQVRDSCAtIDE7CiAgICAgIGZpbGxfd2luZG93KHMpOwogICAgfQogICAgcy5zdHJzdGFydCArPSBzLmxvb2thaGVhZDsKICAgIHMuYmxvY2tfc3RhcnQgPSBzLnN0cnN0YXJ0OwogICAgcy5pbnNlcnQgPSBzLmxvb2thaGVhZDsKICAgIHMubG9va2FoZWFkID0gMDsKICAgIHMubWF0Y2hfbGVuZ3RoID0gcy5wcmV2X2xlbmd0aCA9IE1JTl9NQVRDSCAtIDE7CiAgICBzLm1hdGNoX2F2YWlsYWJsZSA9IDA7CiAgICBzdHJtLm5leHRfaW4gPSBuZXh0OwogICAgc3RybS5pbnB1dCA9IGlucHV0OwogICAgc3RybS5hdmFpbF9pbiA9IGF2YWlsOwogICAgcy53cmFwID0gd3JhcDsKICAgIHJldHVybiBaX09LJDM7CiAgfTsKCgogIHZhciBkZWZsYXRlSW5pdF8xID0gZGVmbGF0ZUluaXQ7CiAgdmFyIGRlZmxhdGVJbml0Ml8xID0gZGVmbGF0ZUluaXQyOwogIHZhciBkZWZsYXRlUmVzZXRfMSA9IGRlZmxhdGVSZXNldDsKICB2YXIgZGVmbGF0ZVJlc2V0S2VlcF8xID0gZGVmbGF0ZVJlc2V0S2VlcDsKICB2YXIgZGVmbGF0ZVNldEhlYWRlcl8xID0gZGVmbGF0ZVNldEhlYWRlcjsKICB2YXIgZGVmbGF0ZV8yJDEgPSBkZWZsYXRlJDI7CiAgdmFyIGRlZmxhdGVFbmRfMSA9IGRlZmxhdGVFbmQ7CiAgdmFyIGRlZmxhdGVTZXREaWN0aW9uYXJ5XzEgPSBkZWZsYXRlU2V0RGljdGlvbmFyeTsKICB2YXIgZGVmbGF0ZUluZm8gPSAncGFrbyBkZWZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSc7CgogIC8qIE5vdCBpbXBsZW1lbnRlZAogIG1vZHVsZS5leHBvcnRzLmRlZmxhdGVCb3VuZCA9IGRlZmxhdGVCb3VuZDsKICBtb2R1bGUuZXhwb3J0cy5kZWZsYXRlQ29weSA9IGRlZmxhdGVDb3B5OwogIG1vZHVsZS5leHBvcnRzLmRlZmxhdGVQYXJhbXMgPSBkZWZsYXRlUGFyYW1zOwogIG1vZHVsZS5leHBvcnRzLmRlZmxhdGVQZW5kaW5nID0gZGVmbGF0ZVBlbmRpbmc7CiAgbW9kdWxlLmV4cG9ydHMuZGVmbGF0ZVByaW1lID0gZGVmbGF0ZVByaW1lOwogIG1vZHVsZS5leHBvcnRzLmRlZmxhdGVUdW5lID0gZGVmbGF0ZVR1bmU7CiAgKi8KCiAgdmFyIGRlZmxhdGVfMSQyID0gewogIAlkZWZsYXRlSW5pdDogZGVmbGF0ZUluaXRfMSwKICAJZGVmbGF0ZUluaXQyOiBkZWZsYXRlSW5pdDJfMSwKICAJZGVmbGF0ZVJlc2V0OiBkZWZsYXRlUmVzZXRfMSwKICAJZGVmbGF0ZVJlc2V0S2VlcDogZGVmbGF0ZVJlc2V0S2VlcF8xLAogIAlkZWZsYXRlU2V0SGVhZGVyOiBkZWZsYXRlU2V0SGVhZGVyXzEsCiAgCWRlZmxhdGU6IGRlZmxhdGVfMiQxLAogIAlkZWZsYXRlRW5kOiBkZWZsYXRlRW5kXzEsCiAgCWRlZmxhdGVTZXREaWN0aW9uYXJ5OiBkZWZsYXRlU2V0RGljdGlvbmFyeV8xLAogIAlkZWZsYXRlSW5mbzogZGVmbGF0ZUluZm8KICB9OwoKICBjb25zdCBfaGFzID0gKG9iaiwga2V5KSA9PiB7CiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTsKICB9OwoKICB2YXIgYXNzaWduID0gZnVuY3Rpb24gKG9iaiAvKmZyb20xLCBmcm9tMiwgZnJvbTMsIC4uLiovKSB7CiAgICBjb25zdCBzb3VyY2VzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsKICAgIHdoaWxlIChzb3VyY2VzLmxlbmd0aCkgewogICAgICBjb25zdCBzb3VyY2UgPSBzb3VyY2VzLnNoaWZ0KCk7CiAgICAgIGlmICghc291cmNlKSB7IGNvbnRpbnVlOyB9CgogICAgICBpZiAodHlwZW9mIHNvdXJjZSAhPT0gJ29iamVjdCcpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKHNvdXJjZSArICdtdXN0IGJlIG5vbi1vYmplY3QnKTsKICAgICAgfQoKICAgICAgZm9yIChjb25zdCBwIGluIHNvdXJjZSkgewogICAgICAgIGlmIChfaGFzKHNvdXJjZSwgcCkpIHsKICAgICAgICAgIG9ialtwXSA9IHNvdXJjZVtwXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb2JqOwogIH07CgoKICAvLyBKb2luIGFycmF5IG9mIGNodW5rcyB0byBzaW5nbGUgYXJyYXkuCiAgdmFyIGZsYXR0ZW5DaHVua3MgPSAoY2h1bmtzKSA9PiB7CiAgICAvLyBjYWxjdWxhdGUgZGF0YSBsZW5ndGgKICAgIGxldCBsZW4gPSAwOwoKICAgIGZvciAobGV0IGkgPSAwLCBsID0gY2h1bmtzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBsZW4gKz0gY2h1bmtzW2ldLmxlbmd0aDsKICAgIH0KCiAgICAvLyBqb2luIGNodW5rcwogICAgY29uc3QgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkobGVuKTsKCiAgICBmb3IgKGxldCBpID0gMCwgcG9zID0gMCwgbCA9IGNodW5rcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgbGV0IGNodW5rID0gY2h1bmtzW2ldOwogICAgICByZXN1bHQuc2V0KGNodW5rLCBwb3MpOwogICAgICBwb3MgKz0gY2h1bmsubGVuZ3RoOwogICAgfQoKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgdmFyIGNvbW1vbiA9IHsKICAJYXNzaWduOiBhc3NpZ24sCiAgCWZsYXR0ZW5DaHVua3M6IGZsYXR0ZW5DaHVua3MKICB9OwoKICAvLyBTdHJpbmcgZW5jb2RlL2RlY29kZSBoZWxwZXJzCgoKICAvLyBRdWljayBjaGVjayBpZiB3ZSBjYW4gdXNlIGZhc3QgYXJyYXkgdG8gYmluIHN0cmluZyBjb252ZXJzaW9uCiAgLy8KICAvLyAtIGFwcGx5KEFycmF5KSBjYW4gZmFpbCBvbiBBbmRyb2lkIDIuMgogIC8vIC0gYXBwbHkoVWludDhBcnJheSkgY2FuIGZhaWwgb24gaU9TIDUuMSBTYWZhcmkKICAvLwogIGxldCBTVFJfQVBQTFlfVUlBX09LID0gdHJ1ZTsKCiAgdHJ5IHsgU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBuZXcgVWludDhBcnJheSgxKSk7IH0gY2F0Y2ggKF9fKSB7IFNUUl9BUFBMWV9VSUFfT0sgPSBmYWxzZTsgfQoKCiAgLy8gVGFibGUgd2l0aCB1dGY4IGxlbmd0aHMgKGNhbGN1bGF0ZWQgYnkgZmlyc3QgYnl0ZSBvZiBzZXF1ZW5jZSkKICAvLyBOb3RlLCB0aGF0IDUgJiA2LWJ5dGUgdmFsdWVzIGFuZCBzb21lIDQtYnl0ZSB2YWx1ZXMgY2FuIG5vdCBiZSByZXByZXNlbnRlZCBpbiBKUywKICAvLyBiZWNhdXNlIG1heCBwb3NzaWJsZSBjb2RlcG9pbnQgaXMgMHgxMGZmZmYKICBjb25zdCBfdXRmOGxlbiA9IG5ldyBVaW50OEFycmF5KDI1Nik7CiAgZm9yIChsZXQgcSA9IDA7IHEgPCAyNTY7IHErKykgewogICAgX3V0ZjhsZW5bcV0gPSAocSA+PSAyNTIgPyA2IDogcSA+PSAyNDggPyA1IDogcSA+PSAyNDAgPyA0IDogcSA+PSAyMjQgPyAzIDogcSA+PSAxOTIgPyAyIDogMSk7CiAgfQogIF91dGY4bGVuWzI1NF0gPSBfdXRmOGxlblsyNTRdID0gMTsgLy8gSW52YWxpZCBzZXF1ZW5jZSBzdGFydAoKCiAgLy8gY29udmVydCBzdHJpbmcgdG8gYXJyYXkgKHR5cGVkLCB3aGVuIHBvc3NpYmxlKQogIHZhciBzdHJpbmcyYnVmID0gKHN0cikgPT4gewogICAgaWYgKHR5cGVvZiBUZXh0RW5jb2RlciA9PT0gJ2Z1bmN0aW9uJyAmJiBUZXh0RW5jb2Rlci5wcm90b3R5cGUuZW5jb2RlKSB7CiAgICAgIHJldHVybiBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoc3RyKTsKICAgIH0KCiAgICBsZXQgYnVmLCBjLCBjMiwgbV9wb3MsIGksIHN0cl9sZW4gPSBzdHIubGVuZ3RoLCBidWZfbGVuID0gMDsKCiAgICAvLyBjb3VudCBiaW5hcnkgc2l6ZQogICAgZm9yIChtX3BvcyA9IDA7IG1fcG9zIDwgc3RyX2xlbjsgbV9wb3MrKykgewogICAgICBjID0gc3RyLmNoYXJDb2RlQXQobV9wb3MpOwogICAgICBpZiAoKGMgJiAweGZjMDApID09PSAweGQ4MDAgJiYgKG1fcG9zICsgMSA8IHN0cl9sZW4pKSB7CiAgICAgICAgYzIgPSBzdHIuY2hhckNvZGVBdChtX3BvcyArIDEpOwogICAgICAgIGlmICgoYzIgJiAweGZjMDApID09PSAweGRjMDApIHsKICAgICAgICAgIGMgPSAweDEwMDAwICsgKChjIC0gMHhkODAwKSA8PCAxMCkgKyAoYzIgLSAweGRjMDApOwogICAgICAgICAgbV9wb3MrKzsKICAgICAgICB9CiAgICAgIH0KICAgICAgYnVmX2xlbiArPSBjIDwgMHg4MCA/IDEgOiBjIDwgMHg4MDAgPyAyIDogYyA8IDB4MTAwMDAgPyAzIDogNDsKICAgIH0KCiAgICAvLyBhbGxvY2F0ZSBidWZmZXIKICAgIGJ1ZiA9IG5ldyBVaW50OEFycmF5KGJ1Zl9sZW4pOwoKICAgIC8vIGNvbnZlcnQKICAgIGZvciAoaSA9IDAsIG1fcG9zID0gMDsgaSA8IGJ1Zl9sZW47IG1fcG9zKyspIHsKICAgICAgYyA9IHN0ci5jaGFyQ29kZUF0KG1fcG9zKTsKICAgICAgaWYgKChjICYgMHhmYzAwKSA9PT0gMHhkODAwICYmIChtX3BvcyArIDEgPCBzdHJfbGVuKSkgewogICAgICAgIGMyID0gc3RyLmNoYXJDb2RlQXQobV9wb3MgKyAxKTsKICAgICAgICBpZiAoKGMyICYgMHhmYzAwKSA9PT0gMHhkYzAwKSB7CiAgICAgICAgICBjID0gMHgxMDAwMCArICgoYyAtIDB4ZDgwMCkgPDwgMTApICsgKGMyIC0gMHhkYzAwKTsKICAgICAgICAgIG1fcG9zKys7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChjIDwgMHg4MCkgewogICAgICAgIC8qIG9uZSBieXRlICovCiAgICAgICAgYnVmW2krK10gPSBjOwogICAgICB9IGVsc2UgaWYgKGMgPCAweDgwMCkgewogICAgICAgIC8qIHR3byBieXRlcyAqLwogICAgICAgIGJ1ZltpKytdID0gMHhDMCB8IChjID4+PiA2KTsKICAgICAgICBidWZbaSsrXSA9IDB4ODAgfCAoYyAmIDB4M2YpOwogICAgICB9IGVsc2UgaWYgKGMgPCAweDEwMDAwKSB7CiAgICAgICAgLyogdGhyZWUgYnl0ZXMgKi8KICAgICAgICBidWZbaSsrXSA9IDB4RTAgfCAoYyA+Pj4gMTIpOwogICAgICAgIGJ1ZltpKytdID0gMHg4MCB8IChjID4+PiA2ICYgMHgzZik7CiAgICAgICAgYnVmW2krK10gPSAweDgwIHwgKGMgJiAweDNmKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvKiBmb3VyIGJ5dGVzICovCiAgICAgICAgYnVmW2krK10gPSAweGYwIHwgKGMgPj4+IDE4KTsKICAgICAgICBidWZbaSsrXSA9IDB4ODAgfCAoYyA+Pj4gMTIgJiAweDNmKTsKICAgICAgICBidWZbaSsrXSA9IDB4ODAgfCAoYyA+Pj4gNiAmIDB4M2YpOwogICAgICAgIGJ1ZltpKytdID0gMHg4MCB8IChjICYgMHgzZik7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gYnVmOwogIH07CgogIC8vIEhlbHBlcgogIGNvbnN0IGJ1ZjJiaW5zdHJpbmcgPSAoYnVmLCBsZW4pID0+IHsKICAgIC8vIE9uIENocm9tZSwgdGhlIGFyZ3VtZW50cyBpbiBhIGZ1bmN0aW9uIGNhbGwgdGhhdCBhcmUgYWxsb3dlZCBpcyBgNjU1MzRgLgogICAgLy8gSWYgdGhlIGxlbmd0aCBvZiB0aGUgYnVmZmVyIGlzIHNtYWxsZXIgdGhhbiB0aGF0LCB3ZSBjYW4gdXNlIHRoaXMgb3B0aW1pemF0aW9uLAogICAgLy8gb3RoZXJ3aXNlIHdlIHdpbGwgdGFrZSBhIHNsb3dlciBwYXRoLgogICAgaWYgKGxlbiA8IDY1NTM0KSB7CiAgICAgIGlmIChidWYuc3ViYXJyYXkgJiYgU1RSX0FQUExZX1VJQV9PSykgewogICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGJ1Zi5sZW5ndGggPT09IGxlbiA/IGJ1ZiA6IGJ1Zi5zdWJhcnJheSgwLCBsZW4pKTsKICAgICAgfQogICAgfQoKICAgIGxldCByZXN1bHQgPSAnJzsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnVmW2ldKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCgogIC8vIGNvbnZlcnQgYXJyYXkgdG8gc3RyaW5nCiAgdmFyIGJ1ZjJzdHJpbmcgPSAoYnVmLCBtYXgpID0+IHsKICAgIGNvbnN0IGxlbiA9IG1heCB8fCBidWYubGVuZ3RoOwoKICAgIGlmICh0eXBlb2YgVGV4dERlY29kZXIgPT09ICdmdW5jdGlvbicgJiYgVGV4dERlY29kZXIucHJvdG90eXBlLmRlY29kZSkgewogICAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGJ1Zi5zdWJhcnJheSgwLCBtYXgpKTsKICAgIH0KCiAgICBsZXQgaSwgb3V0OwoKICAgIC8vIFJlc2VydmUgbWF4IHBvc3NpYmxlIGxlbmd0aCAoMiB3b3JkcyBwZXIgY2hhcikKICAgIC8vIE5COiBieSB1bmtub3duIHJlYXNvbnMsIEFycmF5IGlzIHNpZ25pZmljYW50bHkgZmFzdGVyIGZvcgogICAgLy8gICAgIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkgdGhhbiBVaW50MTZBcnJheS4KICAgIGNvbnN0IHV0ZjE2YnVmID0gbmV3IEFycmF5KGxlbiAqIDIpOwoKICAgIGZvciAob3V0ID0gMCwgaSA9IDA7IGkgPCBsZW47KSB7CiAgICAgIGxldCBjID0gYnVmW2krK107CiAgICAgIC8vIHF1aWNrIHByb2Nlc3MgYXNjaWkKICAgICAgaWYgKGMgPCAweDgwKSB7IHV0ZjE2YnVmW291dCsrXSA9IGM7IGNvbnRpbnVlOyB9CgogICAgICBsZXQgY19sZW4gPSBfdXRmOGxlbltjXTsKICAgICAgLy8gc2tpcCA1ICYgNiBieXRlIGNvZGVzCiAgICAgIGlmIChjX2xlbiA+IDQpIHsgdXRmMTZidWZbb3V0KytdID0gMHhmZmZkOyBpICs9IGNfbGVuIC0gMTsgY29udGludWU7IH0KCiAgICAgIC8vIGFwcGx5IG1hc2sgb24gZmlyc3QgYnl0ZQogICAgICBjICY9IGNfbGVuID09PSAyID8gMHgxZiA6IGNfbGVuID09PSAzID8gMHgwZiA6IDB4MDc7CiAgICAgIC8vIGpvaW4gdGhlIHJlc3QKICAgICAgd2hpbGUgKGNfbGVuID4gMSAmJiBpIDwgbGVuKSB7CiAgICAgICAgYyA9IChjIDw8IDYpIHwgKGJ1ZltpKytdICYgMHgzZik7CiAgICAgICAgY19sZW4tLTsKICAgICAgfQoKICAgICAgLy8gdGVybWluYXRlZCBieSBlbmQgb2Ygc3RyaW5nPwogICAgICBpZiAoY19sZW4gPiAxKSB7IHV0ZjE2YnVmW291dCsrXSA9IDB4ZmZmZDsgY29udGludWU7IH0KCiAgICAgIGlmIChjIDwgMHgxMDAwMCkgewogICAgICAgIHV0ZjE2YnVmW291dCsrXSA9IGM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYyAtPSAweDEwMDAwOwogICAgICAgIHV0ZjE2YnVmW291dCsrXSA9IDB4ZDgwMCB8ICgoYyA+PiAxMCkgJiAweDNmZik7CiAgICAgICAgdXRmMTZidWZbb3V0KytdID0gMHhkYzAwIHwgKGMgJiAweDNmZik7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gYnVmMmJpbnN0cmluZyh1dGYxNmJ1Ziwgb3V0KTsKICB9OwoKCiAgLy8gQ2FsY3VsYXRlIG1heCBwb3NzaWJsZSBwb3NpdGlvbiBpbiB1dGY4IGJ1ZmZlciwKICAvLyB0aGF0IHdpbGwgbm90IGJyZWFrIHNlcXVlbmNlLiBJZiB0aGF0J3Mgbm90IHBvc3NpYmxlCiAgLy8gLSAodmVyeSBzbWFsbCBsaW1pdHMpIHJldHVybiBtYXggc2l6ZSBhcyBpcy4KICAvLwogIC8vIGJ1ZltdIC0gdXRmOCBieXRlcyBhcnJheQogIC8vIG1heCAgIC0gbGVuZ3RoIGxpbWl0IChtYW5kYXRvcnkpOwogIHZhciB1dGY4Ym9yZGVyID0gKGJ1ZiwgbWF4KSA9PiB7CgogICAgbWF4ID0gbWF4IHx8IGJ1Zi5sZW5ndGg7CiAgICBpZiAobWF4ID4gYnVmLmxlbmd0aCkgeyBtYXggPSBidWYubGVuZ3RoOyB9CgogICAgLy8gZ28gYmFjayBmcm9tIGxhc3QgcG9zaXRpb24sIHVudGlsIHN0YXJ0IG9mIHNlcXVlbmNlIGZvdW5kCiAgICBsZXQgcG9zID0gbWF4IC0gMTsKICAgIHdoaWxlIChwb3MgPj0gMCAmJiAoYnVmW3Bvc10gJiAweEMwKSA9PT0gMHg4MCkgeyBwb3MtLTsgfQoKICAgIC8vIFZlcnkgc21hbGwgYW5kIGJyb2tlbiBzZXF1ZW5jZSwKICAgIC8vIHJldHVybiBtYXgsIGJlY2F1c2Ugd2Ugc2hvdWxkIHJldHVybiBzb21ldGhpbmcgYW55d2F5LgogICAgaWYgKHBvcyA8IDApIHsgcmV0dXJuIG1heDsgfQoKICAgIC8vIElmIHdlIGNhbWUgdG8gc3RhcnQgb2YgYnVmZmVyIC0gdGhhdCBtZWFucyBidWZmZXIgaXMgdG9vIHNtYWxsLAogICAgLy8gcmV0dXJuIG1heCB0b28uCiAgICBpZiAocG9zID09PSAwKSB7IHJldHVybiBtYXg7IH0KCiAgICByZXR1cm4gKHBvcyArIF91dGY4bGVuW2J1Zltwb3NdXSA+IG1heCkgPyBwb3MgOiBtYXg7CiAgfTsKCiAgdmFyIHN0cmluZ3MgPSB7CiAgCXN0cmluZzJidWY6IHN0cmluZzJidWYsCiAgCWJ1ZjJzdHJpbmc6IGJ1ZjJzdHJpbmcsCiAgCXV0Zjhib3JkZXI6IHV0Zjhib3JkZXIKICB9OwoKICAvLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKICAvLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgogIC8vCiAgLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKICAvLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKICAvLyBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLgogIC8vCiAgLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCiAgLy8gaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdAogIC8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKICAvLwogIC8vIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90CiAgLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQogIC8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCiAgLy8gICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLgogIC8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCiAgLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCiAgLy8gMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi4KCiAgZnVuY3Rpb24gWlN0cmVhbSgpIHsKICAgIC8qIG5leHQgaW5wdXQgYnl0ZSAqLwogICAgdGhpcy5pbnB1dCA9IG51bGw7IC8vIEpTIHNwZWNpZmljLCBiZWNhdXNlIHdlIGhhdmUgbm8gcG9pbnRlcnMKICAgIHRoaXMubmV4dF9pbiA9IDA7CiAgICAvKiBudW1iZXIgb2YgYnl0ZXMgYXZhaWxhYmxlIGF0IGlucHV0ICovCiAgICB0aGlzLmF2YWlsX2luID0gMDsKICAgIC8qIHRvdGFsIG51bWJlciBvZiBpbnB1dCBieXRlcyByZWFkIHNvIGZhciAqLwogICAgdGhpcy50b3RhbF9pbiA9IDA7CiAgICAvKiBuZXh0IG91dHB1dCBieXRlIHNob3VsZCBiZSBwdXQgdGhlcmUgKi8KICAgIHRoaXMub3V0cHV0ID0gbnVsbDsgLy8gSlMgc3BlY2lmaWMsIGJlY2F1c2Ugd2UgaGF2ZSBubyBwb2ludGVycwogICAgdGhpcy5uZXh0X291dCA9IDA7CiAgICAvKiByZW1haW5pbmcgZnJlZSBzcGFjZSBhdCBvdXRwdXQgKi8KICAgIHRoaXMuYXZhaWxfb3V0ID0gMDsKICAgIC8qIHRvdGFsIG51bWJlciBvZiBieXRlcyBvdXRwdXQgc28gZmFyICovCiAgICB0aGlzLnRvdGFsX291dCA9IDA7CiAgICAvKiBsYXN0IGVycm9yIG1lc3NhZ2UsIE5VTEwgaWYgbm8gZXJyb3IgKi8KICAgIHRoaXMubXNnID0gJycvKlpfTlVMTCovOwogICAgLyogbm90IHZpc2libGUgYnkgYXBwbGljYXRpb25zICovCiAgICB0aGlzLnN0YXRlID0gbnVsbDsKICAgIC8qIGJlc3QgZ3Vlc3MgYWJvdXQgdGhlIGRhdGEgdHlwZTogYmluYXJ5IG9yIHRleHQgKi8KICAgIHRoaXMuZGF0YV90eXBlID0gMi8qWl9VTktOT1dOKi87CiAgICAvKiBhZGxlcjMyIHZhbHVlIG9mIHRoZSB1bmNvbXByZXNzZWQgZGF0YSAqLwogICAgdGhpcy5hZGxlciA9IDA7CiAgfQoKICB2YXIgenN0cmVhbSA9IFpTdHJlYW07CgogIGNvbnN0IHRvU3RyaW5nJDEgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwoKICAvKiBQdWJsaWMgY29uc3RhbnRzID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgogIGNvbnN0IHsKICAgIFpfTk9fRkxVU0g6IFpfTk9fRkxVU0gkMSwgWl9TWU5DX0ZMVVNILCBaX0ZVTExfRkxVU0gsIFpfRklOSVNIOiBaX0ZJTklTSCQyLAogICAgWl9PSzogWl9PSyQyLCBaX1NUUkVBTV9FTkQ6IFpfU1RSRUFNX0VORCQyLAogICAgWl9ERUZBVUxUX0NPTVBSRVNTSU9OLAogICAgWl9ERUZBVUxUX1NUUkFURUdZLAogICAgWl9ERUZMQVRFRDogWl9ERUZMQVRFRCQxCiAgfSA9IGNvbnN0YW50cyQyOwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCiAgLyoqCiAgICogY2xhc3MgRGVmbGF0ZQogICAqCiAgICogR2VuZXJpYyBKUy1zdHlsZSB3cmFwcGVyIGZvciB6bGliIGNhbGxzLiBJZiB5b3UgZG9uJ3QgbmVlZAogICAqIHN0cmVhbWluZyBiZWhhdmlvdXIgLSB1c2UgbW9yZSBzaW1wbGUgZnVuY3Rpb25zOiBbW2RlZmxhdGVdXSwKICAgKiBbW2RlZmxhdGVSYXddXSBhbmQgW1tnemlwXV0uCiAgICoqLwoKICAvKiBpbnRlcm5hbAogICAqIERlZmxhdGUuY2h1bmtzIC0+IEFycmF5CiAgICoKICAgKiBDaHVua3Mgb2Ygb3V0cHV0IGRhdGEsIGlmIFtbRGVmbGF0ZSNvbkRhdGFdXSBub3Qgb3ZlcnJpZGRlbi4KICAgKiovCgogIC8qKgogICAqIERlZmxhdGUucmVzdWx0IC0+IFVpbnQ4QXJyYXkKICAgKgogICAqIENvbXByZXNzZWQgcmVzdWx0LCBnZW5lcmF0ZWQgYnkgZGVmYXVsdCBbW0RlZmxhdGUjb25EYXRhXV0KICAgKiBhbmQgW1tEZWZsYXRlI29uRW5kXV0gaGFuZGxlcnMuIEZpbGxlZCBhZnRlciB5b3UgcHVzaCBsYXN0IGNodW5rCiAgICogKGNhbGwgW1tEZWZsYXRlI3B1c2hdXSB3aXRoIGBaX0ZJTklTSGAgLyBgdHJ1ZWAgcGFyYW0pLgogICAqKi8KCiAgLyoqCiAgICogRGVmbGF0ZS5lcnIgLT4gTnVtYmVyCiAgICoKICAgKiBFcnJvciBjb2RlIGFmdGVyIGRlZmxhdGUgZmluaXNoZWQuIDAgKFpfT0spIG9uIHN1Y2Nlc3MuCiAgICogWW91IHdpbGwgbm90IG5lZWQgaXQgaW4gcmVhbCBsaWZlLCBiZWNhdXNlIGRlZmxhdGUgZXJyb3JzCiAgICogYXJlIHBvc3NpYmxlIG9ubHkgb24gd3Jvbmcgb3B0aW9ucyBvciBiYWQgYG9uRGF0YWAgLyBgb25FbmRgCiAgICogY3VzdG9tIGhhbmRsZXJzLgogICAqKi8KCiAgLyoqCiAgICogRGVmbGF0ZS5tc2cgLT4gU3RyaW5nCiAgICoKICAgKiBFcnJvciBtZXNzYWdlLCBpZiBbW0RlZmxhdGUuZXJyXV0gIT0gMAogICAqKi8KCgogIC8qKgogICAqIG5ldyBEZWZsYXRlKG9wdGlvbnMpCiAgICogLSBvcHRpb25zIChPYmplY3QpOiB6bGliIGRlZmxhdGUgb3B0aW9ucy4KICAgKgogICAqIENyZWF0ZXMgbmV3IGRlZmxhdG9yIGluc3RhbmNlIHdpdGggc3BlY2lmaWVkIHBhcmFtcy4gVGhyb3dzIGV4Y2VwdGlvbgogICAqIG9uIGJhZCBwYXJhbXMuIFN1cHBvcnRlZCBvcHRpb25zOgogICAqCiAgICogLSBgbGV2ZWxgCiAgICogLSBgd2luZG93Qml0c2AKICAgKiAtIGBtZW1MZXZlbGAKICAgKiAtIGBzdHJhdGVneWAKICAgKiAtIGBkaWN0aW9uYXJ5YAogICAqCiAgICogW2h0dHA6Ly96bGliLm5ldC9tYW51YWwuaHRtbCNBZHZhbmNlZF0oaHR0cDovL3psaWIubmV0L21hbnVhbC5odG1sI0FkdmFuY2VkKQogICAqIGZvciBtb3JlIGluZm9ybWF0aW9uIG9uIHRoZXNlLgogICAqCiAgICogQWRkaXRpb25hbCBvcHRpb25zLCBmb3IgaW50ZXJuYWwgbmVlZHM6CiAgICoKICAgKiAtIGBjaHVua1NpemVgIC0gc2l6ZSBvZiBnZW5lcmF0ZWQgZGF0YSBjaHVua3MgKDE2SyBieSBkZWZhdWx0KQogICAqIC0gYHJhd2AgKEJvb2xlYW4pIC0gZG8gcmF3IGRlZmxhdGUKICAgKiAtIGBnemlwYCAoQm9vbGVhbikgLSBjcmVhdGUgZ3ppcCB3cmFwcGVyCiAgICogLSBgaGVhZGVyYCAoT2JqZWN0KSAtIGN1c3RvbSBoZWFkZXIgZm9yIGd6aXAKICAgKiAgIC0gYHRleHRgIChCb29sZWFuKSAtIHRydWUgaWYgY29tcHJlc3NlZCBkYXRhIGJlbGlldmVkIHRvIGJlIHRleHQKICAgKiAgIC0gYHRpbWVgIChOdW1iZXIpIC0gbW9kaWZpY2F0aW9uIHRpbWUsIHVuaXggdGltZXN0YW1wCiAgICogICAtIGBvc2AgKE51bWJlcikgLSBvcGVyYXRpb24gc3lzdGVtIGNvZGUKICAgKiAgIC0gYGV4dHJhYCAoQXJyYXkpIC0gYXJyYXkgb2YgYnl0ZXMgd2l0aCBleHRyYSBkYXRhIChtYXggNjU1MzYpCiAgICogICAtIGBuYW1lYCAoU3RyaW5nKSAtIGZpbGUgbmFtZSAoYmluYXJ5IHN0cmluZykKICAgKiAgIC0gYGNvbW1lbnRgIChTdHJpbmcpIC0gY29tbWVudCAoYmluYXJ5IHN0cmluZykKICAgKiAgIC0gYGhjcmNgIChCb29sZWFuKSAtIHRydWUgaWYgaGVhZGVyIGNyYyBzaG91bGQgYmUgYWRkZWQKICAgKgogICAqICMjIyMjIEV4YW1wbGU6CiAgICoKICAgKiBgYGBqYXZhc2NyaXB0CiAgICogY29uc3QgcGFrbyA9IHJlcXVpcmUoJ3Bha28nKQogICAqICAgLCBjaHVuazEgPSBuZXcgVWludDhBcnJheShbMSwyLDMsNCw1LDYsNyw4LDldKQogICAqICAgLCBjaHVuazIgPSBuZXcgVWludDhBcnJheShbMTAsMTEsMTIsMTMsMTQsMTUsMTYsMTcsMTgsMTldKTsKICAgKgogICAqIGNvbnN0IGRlZmxhdGUgPSBuZXcgcGFrby5EZWZsYXRlKHsgbGV2ZWw6IDN9KTsKICAgKgogICAqIGRlZmxhdGUucHVzaChjaHVuazEsIGZhbHNlKTsKICAgKiBkZWZsYXRlLnB1c2goY2h1bmsyLCB0cnVlKTsgIC8vIHRydWUgLT4gbGFzdCBjaHVuawogICAqCiAgICogaWYgKGRlZmxhdGUuZXJyKSB7IHRocm93IG5ldyBFcnJvcihkZWZsYXRlLmVycik7IH0KICAgKgogICAqIGNvbnNvbGUubG9nKGRlZmxhdGUucmVzdWx0KTsKICAgKiBgYGAKICAgKiovCiAgZnVuY3Rpb24gRGVmbGF0ZSQxKG9wdGlvbnMpIHsKICAgIHRoaXMub3B0aW9ucyA9IGNvbW1vbi5hc3NpZ24oewogICAgICBsZXZlbDogWl9ERUZBVUxUX0NPTVBSRVNTSU9OLAogICAgICBtZXRob2Q6IFpfREVGTEFURUQkMSwKICAgICAgY2h1bmtTaXplOiAxNjM4NCwKICAgICAgd2luZG93Qml0czogMTUsCiAgICAgIG1lbUxldmVsOiA4LAogICAgICBzdHJhdGVneTogWl9ERUZBVUxUX1NUUkFURUdZCiAgICB9LCBvcHRpb25zIHx8IHt9KTsKCiAgICBsZXQgb3B0ID0gdGhpcy5vcHRpb25zOwoKICAgIGlmIChvcHQucmF3ICYmIChvcHQud2luZG93Qml0cyA+IDApKSB7CiAgICAgIG9wdC53aW5kb3dCaXRzID0gLW9wdC53aW5kb3dCaXRzOwogICAgfQoKICAgIGVsc2UgaWYgKG9wdC5nemlwICYmIChvcHQud2luZG93Qml0cyA+IDApICYmIChvcHQud2luZG93Qml0cyA8IDE2KSkgewogICAgICBvcHQud2luZG93Qml0cyArPSAxNjsKICAgIH0KCiAgICB0aGlzLmVyciAgICA9IDA7ICAgICAgLy8gZXJyb3IgY29kZSwgaWYgaGFwcGVucyAoMCA9IFpfT0spCiAgICB0aGlzLm1zZyAgICA9ICcnOyAgICAgLy8gZXJyb3IgbWVzc2FnZQogICAgdGhpcy5lbmRlZCAgPSBmYWxzZTsgIC8vIHVzZWQgdG8gYXZvaWQgbXVsdGlwbGUgb25FbmQoKSBjYWxscwogICAgdGhpcy5jaHVua3MgPSBbXTsgICAgIC8vIGNodW5rcyBvZiBjb21wcmVzc2VkIGRhdGEKCiAgICB0aGlzLnN0cm0gPSBuZXcgenN0cmVhbSgpOwogICAgdGhpcy5zdHJtLmF2YWlsX291dCA9IDA7CgogICAgbGV0IHN0YXR1cyA9IGRlZmxhdGVfMSQyLmRlZmxhdGVJbml0MigKICAgICAgdGhpcy5zdHJtLAogICAgICBvcHQubGV2ZWwsCiAgICAgIG9wdC5tZXRob2QsCiAgICAgIG9wdC53aW5kb3dCaXRzLAogICAgICBvcHQubWVtTGV2ZWwsCiAgICAgIG9wdC5zdHJhdGVneQogICAgKTsKCiAgICBpZiAoc3RhdHVzICE9PSBaX09LJDIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2VzW3N0YXR1c10pOwogICAgfQoKICAgIGlmIChvcHQuaGVhZGVyKSB7CiAgICAgIGRlZmxhdGVfMSQyLmRlZmxhdGVTZXRIZWFkZXIodGhpcy5zdHJtLCBvcHQuaGVhZGVyKTsKICAgIH0KCiAgICBpZiAob3B0LmRpY3Rpb25hcnkpIHsKICAgICAgbGV0IGRpY3Q7CiAgICAgIC8vIENvbnZlcnQgZGF0YSBpZiBuZWVkZWQKICAgICAgaWYgKHR5cGVvZiBvcHQuZGljdGlvbmFyeSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAvLyBJZiB3ZSBuZWVkIHRvIGNvbXByZXNzIHRleHQsIGNoYW5nZSBlbmNvZGluZyB0byB1dGY4LgogICAgICAgIGRpY3QgPSBzdHJpbmdzLnN0cmluZzJidWYob3B0LmRpY3Rpb25hcnkpOwogICAgICB9IGVsc2UgaWYgKHRvU3RyaW5nJDEuY2FsbChvcHQuZGljdGlvbmFyeSkgPT09ICdbb2JqZWN0IEFycmF5QnVmZmVyXScpIHsKICAgICAgICBkaWN0ID0gbmV3IFVpbnQ4QXJyYXkob3B0LmRpY3Rpb25hcnkpOwogICAgICB9IGVsc2UgewogICAgICAgIGRpY3QgPSBvcHQuZGljdGlvbmFyeTsKICAgICAgfQoKICAgICAgc3RhdHVzID0gZGVmbGF0ZV8xJDIuZGVmbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLCBkaWN0KTsKCiAgICAgIGlmIChzdGF0dXMgIT09IFpfT0skMikgewogICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlc1tzdGF0dXNdKTsKICAgICAgfQoKICAgICAgdGhpcy5fZGljdF9zZXQgPSB0cnVlOwogICAgfQogIH0KCiAgLyoqCiAgICogRGVmbGF0ZSNwdXNoKGRhdGFbLCBmbHVzaF9tb2RlXSkgLT4gQm9vbGVhbgogICAqIC0gZGF0YSAoVWludDhBcnJheXxBcnJheUJ1ZmZlcnxTdHJpbmcpOiBpbnB1dCBkYXRhLiBTdHJpbmdzIHdpbGwgYmUKICAgKiAgIGNvbnZlcnRlZCB0byB1dGY4IGJ5dGUgc2VxdWVuY2UuCiAgICogLSBmbHVzaF9tb2RlIChOdW1iZXJ8Qm9vbGVhbik6IDAuLjYgZm9yIGNvcnJlc3BvbmRpbmcgWl9OT19GTFVTSC4uWl9UUkVFIG1vZGVzLgogICAqICAgU2VlIGNvbnN0YW50cy4gU2tpcHBlZCBvciBgZmFsc2VgIG1lYW5zIFpfTk9fRkxVU0gsIGB0cnVlYCBtZWFucyBaX0ZJTklTSC4KICAgKgogICAqIFNlbmRzIGlucHV0IGRhdGEgdG8gZGVmbGF0ZSBwaXBlLCBnZW5lcmF0aW5nIFtbRGVmbGF0ZSNvbkRhdGFdXSBjYWxscyB3aXRoCiAgICogbmV3IGNvbXByZXNzZWQgY2h1bmtzLiBSZXR1cm5zIGB0cnVlYCBvbiBzdWNjZXNzLiBUaGUgbGFzdCBkYXRhIGJsb2NrIG11c3QKICAgKiBoYXZlIGBmbHVzaF9tb2RlYCBaX0ZJTklTSCAob3IgYHRydWVgKS4gVGhhdCB3aWxsIGZsdXNoIGludGVybmFsIHBlbmRpbmcKICAgKiBidWZmZXJzIGFuZCBjYWxsIFtbRGVmbGF0ZSNvbkVuZF1dLgogICAqCiAgICogT24gZmFpbCBjYWxsIFtbRGVmbGF0ZSNvbkVuZF1dIHdpdGggZXJyb3IgY29kZSBhbmQgcmV0dXJuIGZhbHNlLgogICAqCiAgICogIyMjIyMgRXhhbXBsZQogICAqCiAgICogYGBgamF2YXNjcmlwdAogICAqIHB1c2goY2h1bmssIGZhbHNlKTsgLy8gcHVzaCBvbmUgb2YgZGF0YSBjaHVua3MKICAgKiAuLi4KICAgKiBwdXNoKGNodW5rLCB0cnVlKTsgIC8vIHB1c2ggbGFzdCBjaHVuawogICAqIGBgYAogICAqKi8KICBEZWZsYXRlJDEucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiAoZGF0YSwgZmx1c2hfbW9kZSkgewogICAgY29uc3Qgc3RybSA9IHRoaXMuc3RybTsKICAgIGNvbnN0IGNodW5rU2l6ZSA9IHRoaXMub3B0aW9ucy5jaHVua1NpemU7CiAgICBsZXQgc3RhdHVzLCBfZmx1c2hfbW9kZTsKCiAgICBpZiAodGhpcy5lbmRlZCkgeyByZXR1cm4gZmFsc2U7IH0KCiAgICBpZiAoZmx1c2hfbW9kZSA9PT0gfn5mbHVzaF9tb2RlKSBfZmx1c2hfbW9kZSA9IGZsdXNoX21vZGU7CiAgICBlbHNlIF9mbHVzaF9tb2RlID0gZmx1c2hfbW9kZSA9PT0gdHJ1ZSA/IFpfRklOSVNIJDIgOiBaX05PX0ZMVVNIJDE7CgogICAgLy8gQ29udmVydCBkYXRhIGlmIG5lZWRlZAogICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJykgewogICAgICAvLyBJZiB3ZSBuZWVkIHRvIGNvbXByZXNzIHRleHQsIGNoYW5nZSBlbmNvZGluZyB0byB1dGY4LgogICAgICBzdHJtLmlucHV0ID0gc3RyaW5ncy5zdHJpbmcyYnVmKGRhdGEpOwogICAgfSBlbHNlIGlmICh0b1N0cmluZyQxLmNhbGwoZGF0YSkgPT09ICdbb2JqZWN0IEFycmF5QnVmZmVyXScpIHsKICAgICAgc3RybS5pbnB1dCA9IG5ldyBVaW50OEFycmF5KGRhdGEpOwogICAgfSBlbHNlIHsKICAgICAgc3RybS5pbnB1dCA9IGRhdGE7CiAgICB9CgogICAgc3RybS5uZXh0X2luID0gMDsKICAgIHN0cm0uYXZhaWxfaW4gPSBzdHJtLmlucHV0Lmxlbmd0aDsKCiAgICBmb3IgKDs7KSB7CiAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHN0cm0ub3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkoY2h1bmtTaXplKTsKICAgICAgICBzdHJtLm5leHRfb3V0ID0gMDsKICAgICAgICBzdHJtLmF2YWlsX291dCA9IGNodW5rU2l6ZTsKICAgICAgfQoKICAgICAgLy8gTWFrZSBzdXJlIGF2YWlsX291dCA+IDYgdG8gYXZvaWQgcmVwZWF0aW5nIG1hcmtlcnMKICAgICAgaWYgKChfZmx1c2hfbW9kZSA9PT0gWl9TWU5DX0ZMVVNIIHx8IF9mbHVzaF9tb2RlID09PSBaX0ZVTExfRkxVU0gpICYmIHN0cm0uYXZhaWxfb3V0IDw9IDYpIHsKICAgICAgICB0aGlzLm9uRGF0YShzdHJtLm91dHB1dC5zdWJhcnJheSgwLCBzdHJtLm5leHRfb3V0KSk7CiAgICAgICAgc3RybS5hdmFpbF9vdXQgPSAwOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICBzdGF0dXMgPSBkZWZsYXRlXzEkMi5kZWZsYXRlKHN0cm0sIF9mbHVzaF9tb2RlKTsKCiAgICAgIC8vIEVuZGVkID0+IGZsdXNoIGFuZCBmaW5pc2gKICAgICAgaWYgKHN0YXR1cyA9PT0gWl9TVFJFQU1fRU5EJDIpIHsKICAgICAgICBpZiAoc3RybS5uZXh0X291dCA+IDApIHsKICAgICAgICAgIHRoaXMub25EYXRhKHN0cm0ub3V0cHV0LnN1YmFycmF5KDAsIHN0cm0ubmV4dF9vdXQpKTsKICAgICAgICB9CiAgICAgICAgc3RhdHVzID0gZGVmbGF0ZV8xJDIuZGVmbGF0ZUVuZCh0aGlzLnN0cm0pOwogICAgICAgIHRoaXMub25FbmQoc3RhdHVzKTsKICAgICAgICB0aGlzLmVuZGVkID0gdHJ1ZTsKICAgICAgICByZXR1cm4gc3RhdHVzID09PSBaX09LJDI7CiAgICAgIH0KCiAgICAgIC8vIEZsdXNoIGlmIG91dCBidWZmZXIgZnVsbAogICAgICBpZiAoc3RybS5hdmFpbF9vdXQgPT09IDApIHsKICAgICAgICB0aGlzLm9uRGF0YShzdHJtLm91dHB1dCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIC8vIEZsdXNoIGlmIHJlcXVlc3RlZCBhbmQgaGFzIGRhdGEKICAgICAgaWYgKF9mbHVzaF9tb2RlID4gMCAmJiBzdHJtLm5leHRfb3V0ID4gMCkgewogICAgICAgIHRoaXMub25EYXRhKHN0cm0ub3V0cHV0LnN1YmFycmF5KDAsIHN0cm0ubmV4dF9vdXQpKTsKICAgICAgICBzdHJtLmF2YWlsX291dCA9IDA7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIGlmIChzdHJtLmF2YWlsX2luID09PSAwKSBicmVhazsKICAgIH0KCiAgICByZXR1cm4gdHJ1ZTsKICB9OwoKCiAgLyoqCiAgICogRGVmbGF0ZSNvbkRhdGEoY2h1bmspIC0+IFZvaWQKICAgKiAtIGNodW5rIChVaW50OEFycmF5KTogb3V0cHV0IGRhdGEuCiAgICoKICAgKiBCeSBkZWZhdWx0LCBzdG9yZXMgZGF0YSBibG9ja3MgaW4gYGNodW5rc1tdYCBwcm9wZXJ0eSBhbmQgZ2x1ZQogICAqIHRob3NlIGluIGBvbkVuZGAuIE92ZXJyaWRlIHRoaXMgaGFuZGxlciwgaWYgeW91IG5lZWQgYW5vdGhlciBiZWhhdmlvdXIuCiAgICoqLwogIERlZmxhdGUkMS5wcm90b3R5cGUub25EYXRhID0gZnVuY3Rpb24gKGNodW5rKSB7CiAgICB0aGlzLmNodW5rcy5wdXNoKGNodW5rKTsKICB9OwoKCiAgLyoqCiAgICogRGVmbGF0ZSNvbkVuZChzdGF0dXMpIC0+IFZvaWQKICAgKiAtIHN0YXR1cyAoTnVtYmVyKTogZGVmbGF0ZSBzdGF0dXMuIDAgKFpfT0spIG9uIHN1Y2Nlc3MsCiAgICogICBvdGhlciBpZiBub3QuCiAgICoKICAgKiBDYWxsZWQgb25jZSBhZnRlciB5b3UgdGVsbCBkZWZsYXRlIHRoYXQgdGhlIGlucHV0IHN0cmVhbSBpcwogICAqIGNvbXBsZXRlIChaX0ZJTklTSCkuIEJ5IGRlZmF1bHQgLSBqb2luIGNvbGxlY3RlZCBjaHVua3MsCiAgICogZnJlZSBtZW1vcnkgYW5kIGZpbGwgYHJlc3VsdHNgIC8gYGVycmAgcHJvcGVydGllcy4KICAgKiovCiAgRGVmbGF0ZSQxLnByb3RvdHlwZS5vbkVuZCA9IGZ1bmN0aW9uIChzdGF0dXMpIHsKICAgIC8vIE9uIHN1Y2Nlc3MgLSBqb2luCiAgICBpZiAoc3RhdHVzID09PSBaX09LJDIpIHsKICAgICAgdGhpcy5yZXN1bHQgPSBjb21tb24uZmxhdHRlbkNodW5rcyh0aGlzLmNodW5rcyk7CiAgICB9CiAgICB0aGlzLmNodW5rcyA9IFtdOwogICAgdGhpcy5lcnIgPSBzdGF0dXM7CiAgICB0aGlzLm1zZyA9IHRoaXMuc3RybS5tc2c7CiAgfTsKCiAgLy8gKEMpIDE5OTUtMjAxMyBKZWFuLWxvdXAgR2FpbGx5IGFuZCBNYXJrIEFkbGVyCiAgLy8gKEMpIDIwMTQtMjAxNyBWaXRhbHkgUHV6cmluIGFuZCBBbmRyZXkgVHVwaXRzaW4KICAvLwogIC8vIFRoaXMgc29mdHdhcmUgaXMgcHJvdmlkZWQgJ2FzLWlzJywgd2l0aG91dCBhbnkgZXhwcmVzcyBvciBpbXBsaWVkCiAgLy8gd2FycmFudHkuIEluIG5vIGV2ZW50IHdpbGwgdGhlIGF1dGhvcnMgYmUgaGVsZCBsaWFibGUgZm9yIGFueSBkYW1hZ2VzCiAgLy8gYXJpc2luZyBmcm9tIHRoZSB1c2Ugb2YgdGhpcyBzb2Z0d2FyZS4KICAvLwogIC8vIFBlcm1pc3Npb24gaXMgZ3JhbnRlZCB0byBhbnlvbmUgdG8gdXNlIHRoaXMgc29mdHdhcmUgZm9yIGFueSBwdXJwb3NlLAogIC8vIGluY2x1ZGluZyBjb21tZXJjaWFsIGFwcGxpY2F0aW9ucywgYW5kIHRvIGFsdGVyIGl0IGFuZCByZWRpc3RyaWJ1dGUgaXQKICAvLyBmcmVlbHksIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyByZXN0cmljdGlvbnM6CiAgLy8KICAvLyAxLiBUaGUgb3JpZ2luIG9mIHRoaXMgc29mdHdhcmUgbXVzdCBub3QgYmUgbWlzcmVwcmVzZW50ZWQ7IHlvdSBtdXN0IG5vdAogIC8vICAgY2xhaW0gdGhhdCB5b3Ugd3JvdGUgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLiBJZiB5b3UgdXNlIHRoaXMgc29mdHdhcmUKICAvLyAgIGluIGEgcHJvZHVjdCwgYW4gYWNrbm93bGVkZ21lbnQgaW4gdGhlIHByb2R1Y3QgZG9jdW1lbnRhdGlvbiB3b3VsZCBiZQogIC8vICAgYXBwcmVjaWF0ZWQgYnV0IGlzIG5vdCByZXF1aXJlZC4KICAvLyAyLiBBbHRlcmVkIHNvdXJjZSB2ZXJzaW9ucyBtdXN0IGJlIHBsYWlubHkgbWFya2VkIGFzIHN1Y2gsIGFuZCBtdXN0IG5vdCBiZQogIC8vICAgbWlzcmVwcmVzZW50ZWQgYXMgYmVpbmcgdGhlIG9yaWdpbmFsIHNvZnR3YXJlLgogIC8vIDMuIFRoaXMgbm90aWNlIG1heSBub3QgYmUgcmVtb3ZlZCBvciBhbHRlcmVkIGZyb20gYW55IHNvdXJjZSBkaXN0cmlidXRpb24uCgogIC8vIFNlZSBzdGF0ZSBkZWZzIGZyb20gaW5mbGF0ZS5qcwogIGNvbnN0IEJBRCQxID0gMzA7ICAgICAgIC8qIGdvdCBhIGRhdGEgZXJyb3IgLS0gcmVtYWluIGhlcmUgdW50aWwgcmVzZXQgKi8KICBjb25zdCBUWVBFJDEgPSAxMjsgICAgICAvKiBpOiB3YWl0aW5nIGZvciB0eXBlIGJpdHMsIGluY2x1ZGluZyBsYXN0LWZsYWcgYml0ICovCgogIC8qCiAgICAgRGVjb2RlIGxpdGVyYWwsIGxlbmd0aCwgYW5kIGRpc3RhbmNlIGNvZGVzIGFuZCB3cml0ZSBvdXQgdGhlIHJlc3VsdGluZwogICAgIGxpdGVyYWwgYW5kIG1hdGNoIGJ5dGVzIHVudGlsIGVpdGhlciBub3QgZW5vdWdoIGlucHV0IG9yIG91dHB1dCBpcwogICAgIGF2YWlsYWJsZSwgYW4gZW5kLW9mLWJsb2NrIGlzIGVuY291bnRlcmVkLCBvciBhIGRhdGEgZXJyb3IgaXMgZW5jb3VudGVyZWQuCiAgICAgV2hlbiBsYXJnZSBlbm91Z2ggaW5wdXQgYW5kIG91dHB1dCBidWZmZXJzIGFyZSBzdXBwbGllZCB0byBpbmZsYXRlKCksIGZvcgogICAgIGV4YW1wbGUsIGEgMTZLIGlucHV0IGJ1ZmZlciBhbmQgYSA2NEsgb3V0cHV0IGJ1ZmZlciwgbW9yZSB0aGFuIDk1JSBvZiB0aGUKICAgICBpbmZsYXRlIGV4ZWN1dGlvbiB0aW1lIGlzIHNwZW50IGluIHRoaXMgcm91dGluZS4KCiAgICAgRW50cnkgYXNzdW1wdGlvbnM6CgogICAgICAgICAgc3RhdGUubW9kZSA9PT0gTEVOCiAgICAgICAgICBzdHJtLmF2YWlsX2luID49IDYKICAgICAgICAgIHN0cm0uYXZhaWxfb3V0ID49IDI1OAogICAgICAgICAgc3RhcnQgPj0gc3RybS5hdmFpbF9vdXQKICAgICAgICAgIHN0YXRlLmJpdHMgPCA4CgogICAgIE9uIHJldHVybiwgc3RhdGUubW9kZSBpcyBvbmUgb2Y6CgogICAgICAgICAgTEVOIC0tIHJhbiBvdXQgb2YgZW5vdWdoIG91dHB1dCBzcGFjZSBvciBlbm91Z2ggYXZhaWxhYmxlIGlucHV0CiAgICAgICAgICBUWVBFIC0tIHJlYWNoZWQgZW5kIG9mIGJsb2NrIGNvZGUsIGluZmxhdGUoKSB0byBpbnRlcnByZXQgbmV4dCBibG9jawogICAgICAgICAgQkFEIC0tIGVycm9yIGluIGJsb2NrIGRhdGEKCiAgICAgTm90ZXM6CgogICAgICAtIFRoZSBtYXhpbXVtIGlucHV0IGJpdHMgdXNlZCBieSBhIGxlbmd0aC9kaXN0YW5jZSBwYWlyIGlzIDE1IGJpdHMgZm9yIHRoZQogICAgICAgIGxlbmd0aCBjb2RlLCA1IGJpdHMgZm9yIHRoZSBsZW5ndGggZXh0cmEsIDE1IGJpdHMgZm9yIHRoZSBkaXN0YW5jZSBjb2RlLAogICAgICAgIGFuZCAxMyBiaXRzIGZvciB0aGUgZGlzdGFuY2UgZXh0cmEuICBUaGlzIHRvdGFscyA0OCBiaXRzLCBvciBzaXggYnl0ZXMuCiAgICAgICAgVGhlcmVmb3JlIGlmIHN0cm0uYXZhaWxfaW4gPj0gNiwgdGhlbiB0aGVyZSBpcyBlbm91Z2ggaW5wdXQgdG8gYXZvaWQKICAgICAgICBjaGVja2luZyBmb3IgYXZhaWxhYmxlIGlucHV0IHdoaWxlIGRlY29kaW5nLgoKICAgICAgLSBUaGUgbWF4aW11bSBieXRlcyB0aGF0IGEgc2luZ2xlIGxlbmd0aC9kaXN0YW5jZSBwYWlyIGNhbiBvdXRwdXQgaXMgMjU4CiAgICAgICAgYnl0ZXMsIHdoaWNoIGlzIHRoZSBtYXhpbXVtIGxlbmd0aCB0aGF0IGNhbiBiZSBjb2RlZC4gIGluZmxhdGVfZmFzdCgpCiAgICAgICAgcmVxdWlyZXMgc3RybS5hdmFpbF9vdXQgPj0gMjU4IGZvciBlYWNoIGxvb3AgdG8gYXZvaWQgY2hlY2tpbmcgZm9yCiAgICAgICAgb3V0cHV0IHNwYWNlLgogICAqLwogIHZhciBpbmZmYXN0ID0gZnVuY3Rpb24gaW5mbGF0ZV9mYXN0KHN0cm0sIHN0YXJ0KSB7CiAgICBsZXQgX2luOyAgICAgICAgICAgICAgICAgICAgLyogbG9jYWwgc3RybS5pbnB1dCAqLwogICAgbGV0IGxhc3Q7ICAgICAgICAgICAgICAgICAgIC8qIGhhdmUgZW5vdWdoIGlucHV0IHdoaWxlIGluIDwgbGFzdCAqLwogICAgbGV0IF9vdXQ7ICAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0ub3V0cHV0ICovCiAgICBsZXQgYmVnOyAgICAgICAgICAgICAgICAgICAgLyogaW5mbGF0ZSgpJ3MgaW5pdGlhbCBzdHJtLm91dHB1dCAqLwogICAgbGV0IGVuZDsgICAgICAgICAgICAgICAgICAgIC8qIHdoaWxlIG91dCA8IGVuZCwgZW5vdWdoIHNwYWNlIGF2YWlsYWJsZSAqLwogIC8vI2lmZGVmIElORkxBVEVfU1RSSUNUCiAgICBsZXQgZG1heDsgICAgICAgICAgICAgICAgICAgLyogbWF4aW11bSBkaXN0YW5jZSBmcm9tIHpsaWIgaGVhZGVyICovCiAgLy8jZW5kaWYKICAgIGxldCB3c2l6ZTsgICAgICAgICAgICAgICAgICAvKiB3aW5kb3cgc2l6ZSBvciB6ZXJvIGlmIG5vdCB1c2luZyB3aW5kb3cgKi8KICAgIGxldCB3aGF2ZTsgICAgICAgICAgICAgICAgICAvKiB2YWxpZCBieXRlcyBpbiB0aGUgd2luZG93ICovCiAgICBsZXQgd25leHQ7ICAgICAgICAgICAgICAgICAgLyogd2luZG93IHdyaXRlIGluZGV4ICovCiAgICAvLyBVc2UgYHNfd2luZG93YCBpbnN0ZWFkIGB3aW5kb3dgLCBhdm9pZCBjb25mbGljdCB3aXRoIGluc3RydW1lbnRhdGlvbiB0b29scwogICAgbGV0IHNfd2luZG93OyAgICAgICAgICAgICAgIC8qIGFsbG9jYXRlZCBzbGlkaW5nIHdpbmRvdywgaWYgd3NpemUgIT0gMCAqLwogICAgbGV0IGhvbGQ7ICAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0uaG9sZCAqLwogICAgbGV0IGJpdHM7ICAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0uYml0cyAqLwogICAgbGV0IGxjb2RlOyAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0ubGVuY29kZSAqLwogICAgbGV0IGRjb2RlOyAgICAgICAgICAgICAgICAgIC8qIGxvY2FsIHN0cm0uZGlzdGNvZGUgKi8KICAgIGxldCBsbWFzazsgICAgICAgICAgICAgICAgICAvKiBtYXNrIGZvciBmaXJzdCBsZXZlbCBvZiBsZW5ndGggY29kZXMgKi8KICAgIGxldCBkbWFzazsgICAgICAgICAgICAgICAgICAvKiBtYXNrIGZvciBmaXJzdCBsZXZlbCBvZiBkaXN0YW5jZSBjb2RlcyAqLwogICAgbGV0IGhlcmU7ICAgICAgICAgICAgICAgICAgIC8qIHJldHJpZXZlZCB0YWJsZSBlbnRyeSAqLwogICAgbGV0IG9wOyAgICAgICAgICAgICAgICAgICAgIC8qIGNvZGUgYml0cywgb3BlcmF0aW9uLCBleHRyYSBiaXRzLCBvciAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qICB3aW5kb3cgcG9zaXRpb24sIHdpbmRvdyBieXRlcyB0byBjb3B5ICovCiAgICBsZXQgbGVuOyAgICAgICAgICAgICAgICAgICAgLyogbWF0Y2ggbGVuZ3RoLCB1bnVzZWQgYnl0ZXMgKi8KICAgIGxldCBkaXN0OyAgICAgICAgICAgICAgICAgICAvKiBtYXRjaCBkaXN0YW5jZSAqLwogICAgbGV0IGZyb207ICAgICAgICAgICAgICAgICAgIC8qIHdoZXJlIHRvIGNvcHkgbWF0Y2ggZnJvbSAqLwogICAgbGV0IGZyb21fc291cmNlOwoKCiAgICBsZXQgaW5wdXQsIG91dHB1dDsgLy8gSlMgc3BlY2lmaWMsIGJlY2F1c2Ugd2UgaGF2ZSBubyBwb2ludGVycwoKICAgIC8qIGNvcHkgc3RhdGUgdG8gbG9jYWwgdmFyaWFibGVzICovCiAgICBjb25zdCBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgICAvL2hlcmUgPSBzdGF0ZS5oZXJlOwogICAgX2luID0gc3RybS5uZXh0X2luOwogICAgaW5wdXQgPSBzdHJtLmlucHV0OwogICAgbGFzdCA9IF9pbiArIChzdHJtLmF2YWlsX2luIC0gNSk7CiAgICBfb3V0ID0gc3RybS5uZXh0X291dDsKICAgIG91dHB1dCA9IHN0cm0ub3V0cHV0OwogICAgYmVnID0gX291dCAtIChzdGFydCAtIHN0cm0uYXZhaWxfb3V0KTsKICAgIGVuZCA9IF9vdXQgKyAoc3RybS5hdmFpbF9vdXQgLSAyNTcpOwogIC8vI2lmZGVmIElORkxBVEVfU1RSSUNUCiAgICBkbWF4ID0gc3RhdGUuZG1heDsKICAvLyNlbmRpZgogICAgd3NpemUgPSBzdGF0ZS53c2l6ZTsKICAgIHdoYXZlID0gc3RhdGUud2hhdmU7CiAgICB3bmV4dCA9IHN0YXRlLnduZXh0OwogICAgc193aW5kb3cgPSBzdGF0ZS53aW5kb3c7CiAgICBob2xkID0gc3RhdGUuaG9sZDsKICAgIGJpdHMgPSBzdGF0ZS5iaXRzOwogICAgbGNvZGUgPSBzdGF0ZS5sZW5jb2RlOwogICAgZGNvZGUgPSBzdGF0ZS5kaXN0Y29kZTsKICAgIGxtYXNrID0gKDEgPDwgc3RhdGUubGVuYml0cykgLSAxOwogICAgZG1hc2sgPSAoMSA8PCBzdGF0ZS5kaXN0Yml0cykgLSAxOwoKCiAgICAvKiBkZWNvZGUgbGl0ZXJhbHMgYW5kIGxlbmd0aC9kaXN0YW5jZXMgdW50aWwgZW5kLW9mLWJsb2NrIG9yIG5vdCBlbm91Z2gKICAgICAgIGlucHV0IGRhdGEgb3Igb3V0cHV0IHNwYWNlICovCgogICAgdG9wOgogICAgZG8gewogICAgICBpZiAoYml0cyA8IDE1KSB7CiAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICBiaXRzICs9IDg7CiAgICAgIH0KCiAgICAgIGhlcmUgPSBsY29kZVtob2xkICYgbG1hc2tdOwoKICAgICAgZG9sZW46CiAgICAgIGZvciAoOzspIHsgLy8gR290byBlbXVsYXRpb24KICAgICAgICBvcCA9IGhlcmUgPj4+IDI0LypoZXJlLmJpdHMqLzsKICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgYml0cyAtPSBvcDsKICAgICAgICBvcCA9IChoZXJlID4+PiAxNikgJiAweGZmLypoZXJlLm9wKi87CiAgICAgICAgaWYgKG9wID09PSAwKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAvKiBsaXRlcmFsICovCiAgICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwgaGVyZS52YWwgPj0gMHgyMCAmJiBoZXJlLnZhbCA8IDB4N2YgPwogICAgICAgICAgLy8gICAgICAgICJpbmZsYXRlOiAgICAgICAgIGxpdGVyYWwgJyVjJ1xuIiA6CiAgICAgICAgICAvLyAgICAgICAgImluZmxhdGU6ICAgICAgICAgbGl0ZXJhbCAweCUwMnhcbiIsIGhlcmUudmFsKSk7CiAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGhlcmUgJiAweGZmZmYvKmhlcmUudmFsKi87CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKG9wICYgMTYpIHsgICAgICAgICAgICAgICAgICAgICAvKiBsZW5ndGggYmFzZSAqLwogICAgICAgICAgbGVuID0gaGVyZSAmIDB4ZmZmZi8qaGVyZS52YWwqLzsKICAgICAgICAgIG9wICY9IDE1OyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBleHRyYSBiaXRzICovCiAgICAgICAgICBpZiAob3ApIHsKICAgICAgICAgICAgaWYgKGJpdHMgPCBvcCkgewogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbX2luKytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxlbiArPSBob2xkICYgKCgxIDw8IG9wKSAtIDEpOwogICAgICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgICAgIGJpdHMgLT0gb3A7CiAgICAgICAgICB9CiAgICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgICAgbGVuZ3RoICV1XG4iLCBsZW4pKTsKICAgICAgICAgIGlmIChiaXRzIDwgMTUpIHsKICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICBob2xkICs9IGlucHV0W19pbisrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICBoZXJlID0gZGNvZGVbaG9sZCAmIGRtYXNrXTsKCiAgICAgICAgICBkb2Rpc3Q6CiAgICAgICAgICBmb3IgKDs7KSB7IC8vIGdvdG8gZW11bGF0aW9uCiAgICAgICAgICAgIG9wID0gaGVyZSA+Pj4gMjQvKmhlcmUuYml0cyovOwogICAgICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgICAgIGJpdHMgLT0gb3A7CiAgICAgICAgICAgIG9wID0gKGhlcmUgPj4+IDE2KSAmIDB4ZmYvKmhlcmUub3AqLzsKCiAgICAgICAgICAgIGlmIChvcCAmIDE2KSB7ICAgICAgICAgICAgICAgICAgICAgIC8qIGRpc3RhbmNlIGJhc2UgKi8KICAgICAgICAgICAgICBkaXN0ID0gaGVyZSAmIDB4ZmZmZi8qaGVyZS52YWwqLzsKICAgICAgICAgICAgICBvcCAmPSAxNTsgICAgICAgICAgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBleHRyYSBiaXRzICovCiAgICAgICAgICAgICAgaWYgKGJpdHMgPCBvcCkgewogICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgIGlmIChiaXRzIDwgb3ApIHsKICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtfaW4rK10gPDwgYml0czsKICAgICAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBkaXN0ICs9IGhvbGQgJiAoKDEgPDwgb3ApIC0gMSk7CiAgLy8jaWZkZWYgSU5GTEFURV9TVFJJQ1QKICAgICAgICAgICAgICBpZiAoZGlzdCA+IGRtYXgpIHsKICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrJzsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQkMTsKICAgICAgICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICAgICAgICB9CiAgLy8jZW5kaWYKICAgICAgICAgICAgICBob2xkID4+Pj0gb3A7CiAgICAgICAgICAgICAgYml0cyAtPSBvcDsKICAgICAgICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgICAgZGlzdGFuY2UgJXVcbiIsIGRpc3QpKTsKICAgICAgICAgICAgICBvcCA9IF9vdXQgLSBiZWc7ICAgICAgICAgICAgICAgIC8qIG1heCBkaXN0YW5jZSBpbiBvdXRwdXQgKi8KICAgICAgICAgICAgICBpZiAoZGlzdCA+IG9wKSB7ICAgICAgICAgICAgICAgIC8qIHNlZSBpZiBjb3B5IGZyb20gd2luZG93ICovCiAgICAgICAgICAgICAgICBvcCA9IGRpc3QgLSBvcDsgICAgICAgICAgICAgICAvKiBkaXN0YW5jZSBiYWNrIGluIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgaWYgKG9wID4gd2hhdmUpIHsKICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnNhbmUpIHsKICAgICAgICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGRpc3RhbmNlIHRvbyBmYXIgYmFjayc7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRCQxOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICAgICAgICAgICAgfQoKICAvLyAoISkgVGhpcyBibG9jayBpcyBkaXNhYmxlZCBpbiB6bGliIGRlZmF1bHRzLAogIC8vIGRvbid0IGVuYWJsZSBpdCBmb3IgYmluYXJ5IGNvbXBhdGliaWxpdHkKICAvLyNpZmRlZiBJTkZMQVRFX0FMTE9XX0lOVkFMSURfRElTVEFOQ0VfVE9PRkFSX0FSUlIKICAvLyAgICAgICAgICAgICAgICBpZiAobGVuIDw9IG9wIC0gd2hhdmUpIHsKICAvLyAgICAgICAgICAgICAgICAgIGRvIHsKICAvLyAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSAwOwogIC8vICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1sZW4pOwogIC8vICAgICAgICAgICAgICAgICAgY29udGludWUgdG9wOwogIC8vICAgICAgICAgICAgICAgIH0KICAvLyAgICAgICAgICAgICAgICBsZW4gLT0gb3AgLSB3aGF2ZTsKICAvLyAgICAgICAgICAgICAgICBkbyB7CiAgLy8gICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IDA7CiAgLy8gICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1vcCA+IHdoYXZlKTsKICAvLyAgICAgICAgICAgICAgICBpZiAob3AgPT09IDApIHsKICAvLyAgICAgICAgICAgICAgICAgIGZyb20gPSBfb3V0IC0gZGlzdDsKICAvLyAgICAgICAgICAgICAgICAgIGRvIHsKICAvLyAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAvLyAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKC0tbGVuKTsKICAvLyAgICAgICAgICAgICAgICAgIGNvbnRpbnVlIHRvcDsKICAvLyAgICAgICAgICAgICAgICB9CiAgLy8jZW5kaWYKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZyb20gPSAwOyAvLyB3aW5kb3cgaW5kZXgKICAgICAgICAgICAgICAgIGZyb21fc291cmNlID0gc193aW5kb3c7CiAgICAgICAgICAgICAgICBpZiAod25leHQgPT09IDApIHsgICAgICAgICAgIC8qIHZlcnkgY29tbW9uIGNhc2UgKi8KICAgICAgICAgICAgICAgICAgZnJvbSArPSB3c2l6ZSAtIG9wOwogICAgICAgICAgICAgICAgICBpZiAob3AgPCBsZW4pIHsgICAgICAgICAvKiBzb21lIGZyb20gd2luZG93ICovCiAgICAgICAgICAgICAgICAgICAgbGVuIC09IG9wOwogICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gc193aW5kb3dbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgICB9IHdoaWxlICgtLW9wKTsKICAgICAgICAgICAgICAgICAgICBmcm9tID0gX291dCAtIGRpc3Q7ICAvKiByZXN0IGZyb20gb3V0cHV0ICovCiAgICAgICAgICAgICAgICAgICAgZnJvbV9zb3VyY2UgPSBvdXRwdXQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKHduZXh0IDwgb3ApIHsgICAgICAvKiB3cmFwIGFyb3VuZCB3aW5kb3cgKi8KICAgICAgICAgICAgICAgICAgZnJvbSArPSB3c2l6ZSArIHduZXh0IC0gb3A7CiAgICAgICAgICAgICAgICAgIG9wIC09IHduZXh0OwogICAgICAgICAgICAgICAgICBpZiAob3AgPCBsZW4pIHsgICAgICAgICAvKiBzb21lIGZyb20gZW5kIG9mIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgICAgIGxlbiAtPSBvcDsKICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IHNfd2luZG93W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoLS1vcCk7CiAgICAgICAgICAgICAgICAgICAgZnJvbSA9IDA7CiAgICAgICAgICAgICAgICAgICAgaWYgKHduZXh0IDwgbGVuKSB7ICAvKiBzb21lIGZyb20gc3RhcnQgb2Ygd2luZG93ICovCiAgICAgICAgICAgICAgICAgICAgICBvcCA9IHduZXh0OwogICAgICAgICAgICAgICAgICAgICAgbGVuIC09IG9wOwogICAgICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IHNfd2luZG93W2Zyb20rK107CiAgICAgICAgICAgICAgICAgICAgICB9IHdoaWxlICgtLW9wKTsKICAgICAgICAgICAgICAgICAgICAgIGZyb20gPSBfb3V0IC0gZGlzdDsgICAgICAvKiByZXN0IGZyb20gb3V0cHV0ICovCiAgICAgICAgICAgICAgICAgICAgICBmcm9tX3NvdXJjZSA9IG91dHB1dDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgeyAgICAgICAgICAgICAgICAgICAgICAvKiBjb250aWd1b3VzIGluIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgICBmcm9tICs9IHduZXh0IC0gb3A7CiAgICAgICAgICAgICAgICAgIGlmIChvcCA8IGxlbikgeyAgICAgICAgIC8qIHNvbWUgZnJvbSB3aW5kb3cgKi8KICAgICAgICAgICAgICAgICAgICBsZW4gLT0gb3A7CiAgICAgICAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBzX3dpbmRvd1tmcm9tKytdOwogICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKC0tb3ApOwogICAgICAgICAgICAgICAgICAgIGZyb20gPSBfb3V0IC0gZGlzdDsgIC8qIHJlc3QgZnJvbSBvdXRwdXQgKi8KICAgICAgICAgICAgICAgICAgICBmcm9tX3NvdXJjZSA9IG91dHB1dDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2hpbGUgKGxlbiA+IDIpIHsKICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBmcm9tX3NvdXJjZVtmcm9tKytdOwogICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGZyb21fc291cmNlW2Zyb20rK107CiAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgbGVuIC09IDM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobGVuKSB7CiAgICAgICAgICAgICAgICAgIG91dHB1dFtfb3V0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgaWYgKGxlbiA+IDEpIHsKICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IGZyb21fc291cmNlW2Zyb20rK107CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBmcm9tID0gX291dCAtIGRpc3Q7ICAgICAgICAgIC8qIGNvcHkgZGlyZWN0IGZyb20gb3V0cHV0ICovCiAgICAgICAgICAgICAgICBkbyB7ICAgICAgICAgICAgICAgICAgICAgICAgLyogbWluaW11bSBsZW5ndGggaXMgdGhyZWUgKi8KICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgbGVuIC09IDM7CiAgICAgICAgICAgICAgICB9IHdoaWxlIChsZW4gPiAyKTsKICAgICAgICAgICAgICAgIGlmIChsZW4pIHsKICAgICAgICAgICAgICAgICAgb3V0cHV0W19vdXQrK10gPSBvdXRwdXRbZnJvbSsrXTsKICAgICAgICAgICAgICAgICAgaWYgKGxlbiA+IDEpIHsKICAgICAgICAgICAgICAgICAgICBvdXRwdXRbX291dCsrXSA9IG91dHB1dFtmcm9tKytdOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKChvcCAmIDY0KSA9PT0gMCkgeyAgICAgICAgICAvKiAybmQgbGV2ZWwgZGlzdGFuY2UgY29kZSAqLwogICAgICAgICAgICAgIGhlcmUgPSBkY29kZVsoaGVyZSAmIDB4ZmZmZikvKmhlcmUudmFsKi8gKyAoaG9sZCAmICgoMSA8PCBvcCkgLSAxKSldOwogICAgICAgICAgICAgIGNvbnRpbnVlIGRvZGlzdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGRpc3RhbmNlIGNvZGUnOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQkMTsKICAgICAgICAgICAgICBicmVhayB0b3A7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOyAvLyBuZWVkIHRvIGVtdWxhdGUgZ290byB2aWEgImNvbnRpbnVlIgogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIGlmICgob3AgJiA2NCkgPT09IDApIHsgICAgICAgICAgICAgIC8qIDJuZCBsZXZlbCBsZW5ndGggY29kZSAqLwogICAgICAgICAgaGVyZSA9IGxjb2RlWyhoZXJlICYgMHhmZmZmKS8qaGVyZS52YWwqLyArIChob2xkICYgKCgxIDw8IG9wKSAtIDEpKV07CiAgICAgICAgICBjb250aW51ZSBkb2xlbjsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAob3AgJiAzMikgeyAgICAgICAgICAgICAgICAgICAgIC8qIGVuZC1vZi1ibG9jayAqLwogICAgICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICAgIGVuZCBvZiBibG9ja1xuIikpOwogICAgICAgICAgc3RhdGUubW9kZSA9IFRZUEUkMTsKICAgICAgICAgIGJyZWFrIHRvcDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGxpdGVyYWwvbGVuZ3RoIGNvZGUnOwogICAgICAgICAgc3RhdGUubW9kZSA9IEJBRCQxOwogICAgICAgICAgYnJlYWsgdG9wOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7IC8vIG5lZWQgdG8gZW11bGF0ZSBnb3RvIHZpYSAiY29udGludWUiCiAgICAgIH0KICAgIH0gd2hpbGUgKF9pbiA8IGxhc3QgJiYgX291dCA8IGVuZCk7CgogICAgLyogcmV0dXJuIHVudXNlZCBieXRlcyAob24gZW50cnksIGJpdHMgPCA4LCBzbyBpbiB3b24ndCBnbyB0b28gZmFyIGJhY2spICovCiAgICBsZW4gPSBiaXRzID4+IDM7CiAgICBfaW4gLT0gbGVuOwogICAgYml0cyAtPSBsZW4gPDwgMzsKICAgIGhvbGQgJj0gKDEgPDwgYml0cykgLSAxOwoKICAgIC8qIHVwZGF0ZSBzdGF0ZSBhbmQgcmV0dXJuICovCiAgICBzdHJtLm5leHRfaW4gPSBfaW47CiAgICBzdHJtLm5leHRfb3V0ID0gX291dDsKICAgIHN0cm0uYXZhaWxfaW4gPSAoX2luIDwgbGFzdCA/IDUgKyAobGFzdCAtIF9pbikgOiA1IC0gKF9pbiAtIGxhc3QpKTsKICAgIHN0cm0uYXZhaWxfb3V0ID0gKF9vdXQgPCBlbmQgPyAyNTcgKyAoZW5kIC0gX291dCkgOiAyNTcgLSAoX291dCAtIGVuZCkpOwogICAgc3RhdGUuaG9sZCA9IGhvbGQ7CiAgICBzdGF0ZS5iaXRzID0gYml0czsKICAgIHJldHVybjsKICB9OwoKICAvLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKICAvLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgogIC8vCiAgLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKICAvLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKICAvLyBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLgogIC8vCiAgLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCiAgLy8gaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdAogIC8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKICAvLwogIC8vIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90CiAgLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQogIC8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCiAgLy8gICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLgogIC8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCiAgLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCiAgLy8gMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi4KCiAgY29uc3QgTUFYQklUUyA9IDE1OwogIGNvbnN0IEVOT1VHSF9MRU5TJDEgPSA4NTI7CiAgY29uc3QgRU5PVUdIX0RJU1RTJDEgPSA1OTI7CiAgLy9jb25zdCBFTk9VR0ggPSAoRU5PVUdIX0xFTlMrRU5PVUdIX0RJU1RTKTsKCiAgY29uc3QgQ09ERVMkMSA9IDA7CiAgY29uc3QgTEVOUyQxID0gMTsKICBjb25zdCBESVNUUyQxID0gMjsKCiAgY29uc3QgbGJhc2UgPSBuZXcgVWludDE2QXJyYXkoWyAvKiBMZW5ndGggY29kZXMgMjU3Li4yODUgYmFzZSAqLwogICAgMywgNCwgNSwgNiwgNywgOCwgOSwgMTAsIDExLCAxMywgMTUsIDE3LCAxOSwgMjMsIDI3LCAzMSwKICAgIDM1LCA0MywgNTEsIDU5LCA2NywgODMsIDk5LCAxMTUsIDEzMSwgMTYzLCAxOTUsIDIyNywgMjU4LCAwLCAwCiAgXSk7CgogIGNvbnN0IGxleHQgPSBuZXcgVWludDhBcnJheShbIC8qIExlbmd0aCBjb2RlcyAyNTcuLjI4NSBleHRyYSAqLwogICAgMTYsIDE2LCAxNiwgMTYsIDE2LCAxNiwgMTYsIDE2LCAxNywgMTcsIDE3LCAxNywgMTgsIDE4LCAxOCwgMTgsCiAgICAxOSwgMTksIDE5LCAxOSwgMjAsIDIwLCAyMCwgMjAsIDIxLCAyMSwgMjEsIDIxLCAxNiwgNzIsIDc4CiAgXSk7CgogIGNvbnN0IGRiYXNlID0gbmV3IFVpbnQxNkFycmF5KFsgLyogRGlzdGFuY2UgY29kZXMgMC4uMjkgYmFzZSAqLwogICAgMSwgMiwgMywgNCwgNSwgNywgOSwgMTMsIDE3LCAyNSwgMzMsIDQ5LCA2NSwgOTcsIDEyOSwgMTkzLAogICAgMjU3LCAzODUsIDUxMywgNzY5LCAxMDI1LCAxNTM3LCAyMDQ5LCAzMDczLCA0MDk3LCA2MTQ1LAogICAgODE5MywgMTIyODksIDE2Mzg1LCAyNDU3NywgMCwgMAogIF0pOwoKICBjb25zdCBkZXh0ID0gbmV3IFVpbnQ4QXJyYXkoWyAvKiBEaXN0YW5jZSBjb2RlcyAwLi4yOSBleHRyYSAqLwogICAgMTYsIDE2LCAxNiwgMTYsIDE3LCAxNywgMTgsIDE4LCAxOSwgMTksIDIwLCAyMCwgMjEsIDIxLCAyMiwgMjIsCiAgICAyMywgMjMsIDI0LCAyNCwgMjUsIDI1LCAyNiwgMjYsIDI3LCAyNywKICAgIDI4LCAyOCwgMjksIDI5LCA2NCwgNjQKICBdKTsKCiAgY29uc3QgaW5mbGF0ZV90YWJsZSA9ICh0eXBlLCBsZW5zLCBsZW5zX2luZGV4LCBjb2RlcywgdGFibGUsIHRhYmxlX2luZGV4LCB3b3JrLCBvcHRzKSA9PgogIHsKICAgIGNvbnN0IGJpdHMgPSBvcHRzLmJpdHM7CiAgICAgICAgLy9oZXJlID0gb3B0cy5oZXJlOyAvKiB0YWJsZSBlbnRyeSBmb3IgZHVwbGljYXRpb24gKi8KCiAgICBsZXQgbGVuID0gMDsgICAgICAgICAgICAgICAvKiBhIGNvZGUncyBsZW5ndGggaW4gYml0cyAqLwogICAgbGV0IHN5bSA9IDA7ICAgICAgICAgICAgICAgLyogaW5kZXggb2YgY29kZSBzeW1ib2xzICovCiAgICBsZXQgbWluID0gMCwgbWF4ID0gMDsgICAgICAgICAgLyogbWluaW11bSBhbmQgbWF4aW11bSBjb2RlIGxlbmd0aHMgKi8KICAgIGxldCByb290ID0gMDsgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBpbmRleCBiaXRzIGZvciByb290IHRhYmxlICovCiAgICBsZXQgY3VyciA9IDA7ICAgICAgICAgICAgICAvKiBudW1iZXIgb2YgaW5kZXggYml0cyBmb3IgY3VycmVudCB0YWJsZSAqLwogICAgbGV0IGRyb3AgPSAwOyAgICAgICAgICAgICAgLyogY29kZSBiaXRzIHRvIGRyb3AgZm9yIHN1Yi10YWJsZSAqLwogICAgbGV0IGxlZnQgPSAwOyAgICAgICAgICAgICAgICAgICAvKiBudW1iZXIgb2YgcHJlZml4IGNvZGVzIGF2YWlsYWJsZSAqLwogICAgbGV0IHVzZWQgPSAwOyAgICAgICAgICAgICAgLyogY29kZSBlbnRyaWVzIGluIHRhYmxlIHVzZWQgKi8KICAgIGxldCBodWZmID0gMDsgICAgICAgICAgICAgIC8qIEh1ZmZtYW4gY29kZSAqLwogICAgbGV0IGluY3I7ICAgICAgICAgICAgICAvKiBmb3IgaW5jcmVtZW50aW5nIGNvZGUsIGluZGV4ICovCiAgICBsZXQgZmlsbDsgICAgICAgICAgICAgIC8qIGluZGV4IGZvciByZXBsaWNhdGluZyBlbnRyaWVzICovCiAgICBsZXQgbG93OyAgICAgICAgICAgICAgIC8qIGxvdyBiaXRzIGZvciBjdXJyZW50IHJvb3QgZW50cnkgKi8KICAgIGxldCBtYXNrOyAgICAgICAgICAgICAgLyogbWFzayBmb3IgbG93IHJvb3QgYml0cyAqLwogICAgbGV0IG5leHQ7ICAgICAgICAgICAgIC8qIG5leHQgYXZhaWxhYmxlIHNwYWNlIGluIHRhYmxlICovCiAgICBsZXQgYmFzZSA9IG51bGw7ICAgICAvKiBiYXNlIHZhbHVlIHRhYmxlIHRvIHVzZSAqLwogICAgbGV0IGJhc2VfaW5kZXggPSAwOwogIC8vICBsZXQgc2hvZXh0cmE7ICAgIC8qIGV4dHJhIGJpdHMgdGFibGUgdG8gdXNlICovCiAgICBsZXQgZW5kOyAgICAgICAgICAgICAgICAgICAgLyogdXNlIGJhc2UgYW5kIGV4dHJhIGZvciBzeW1ib2wgPiBlbmQgKi8KICAgIGNvbnN0IGNvdW50ID0gbmV3IFVpbnQxNkFycmF5KE1BWEJJVFMgKyAxKTsgLy9bTUFYQklUUysxXTsgICAgLyogbnVtYmVyIG9mIGNvZGVzIG9mIGVhY2ggbGVuZ3RoICovCiAgICBjb25zdCBvZmZzID0gbmV3IFVpbnQxNkFycmF5KE1BWEJJVFMgKyAxKTsgLy9bTUFYQklUUysxXTsgICAgIC8qIG9mZnNldHMgaW4gdGFibGUgZm9yIGVhY2ggbGVuZ3RoICovCiAgICBsZXQgZXh0cmEgPSBudWxsOwogICAgbGV0IGV4dHJhX2luZGV4ID0gMDsKCiAgICBsZXQgaGVyZV9iaXRzLCBoZXJlX29wLCBoZXJlX3ZhbDsKCiAgICAvKgogICAgIFByb2Nlc3MgYSBzZXQgb2YgY29kZSBsZW5ndGhzIHRvIGNyZWF0ZSBhIGNhbm9uaWNhbCBIdWZmbWFuIGNvZGUuICBUaGUKICAgICBjb2RlIGxlbmd0aHMgYXJlIGxlbnNbMC4uY29kZXMtMV0uICBFYWNoIGxlbmd0aCBjb3JyZXNwb25kcyB0byB0aGUKICAgICBzeW1ib2xzIDAuLmNvZGVzLTEuICBUaGUgSHVmZm1hbiBjb2RlIGlzIGdlbmVyYXRlZCBieSBmaXJzdCBzb3J0aW5nIHRoZQogICAgIHN5bWJvbHMgYnkgbGVuZ3RoIGZyb20gc2hvcnQgdG8gbG9uZywgYW5kIHJldGFpbmluZyB0aGUgc3ltYm9sIG9yZGVyCiAgICAgZm9yIGNvZGVzIHdpdGggZXF1YWwgbGVuZ3Rocy4gIFRoZW4gdGhlIGNvZGUgc3RhcnRzIHdpdGggYWxsIHplcm8gYml0cwogICAgIGZvciB0aGUgZmlyc3QgY29kZSBvZiB0aGUgc2hvcnRlc3QgbGVuZ3RoLCBhbmQgdGhlIGNvZGVzIGFyZSBpbnRlZ2VyCiAgICAgaW5jcmVtZW50cyBmb3IgdGhlIHNhbWUgbGVuZ3RoLCBhbmQgemVyb3MgYXJlIGFwcGVuZGVkIGFzIHRoZSBsZW5ndGgKICAgICBpbmNyZWFzZXMuICBGb3IgdGhlIGRlZmxhdGUgZm9ybWF0LCB0aGVzZSBiaXRzIGFyZSBzdG9yZWQgYmFja3dhcmRzCiAgICAgZnJvbSB0aGVpciBtb3JlIG5hdHVyYWwgaW50ZWdlciBpbmNyZW1lbnQgb3JkZXJpbmcsIGFuZCBzbyB3aGVuIHRoZQogICAgIGRlY29kaW5nIHRhYmxlcyBhcmUgYnVpbHQgaW4gdGhlIGxhcmdlIGxvb3AgYmVsb3csIHRoZSBpbnRlZ2VyIGNvZGVzCiAgICAgYXJlIGluY3JlbWVudGVkIGJhY2t3YXJkcy4KCiAgICAgVGhpcyByb3V0aW5lIGFzc3VtZXMsIGJ1dCBkb2VzIG5vdCBjaGVjaywgdGhhdCBhbGwgb2YgdGhlIGVudHJpZXMgaW4KICAgICBsZW5zW10gYXJlIGluIHRoZSByYW5nZSAwLi5NQVhCSVRTLiAgVGhlIGNhbGxlciBtdXN0IGFzc3VyZSB0aGlzLgogICAgIDEuLk1BWEJJVFMgaXMgaW50ZXJwcmV0ZWQgYXMgdGhhdCBjb2RlIGxlbmd0aC4gIHplcm8gbWVhbnMgdGhhdCB0aGF0CiAgICAgc3ltYm9sIGRvZXMgbm90IG9jY3VyIGluIHRoaXMgY29kZS4KCiAgICAgVGhlIGNvZGVzIGFyZSBzb3J0ZWQgYnkgY29tcHV0aW5nIGEgY291bnQgb2YgY29kZXMgZm9yIGVhY2ggbGVuZ3RoLAogICAgIGNyZWF0aW5nIGZyb20gdGhhdCBhIHRhYmxlIG9mIHN0YXJ0aW5nIGluZGljZXMgZm9yIGVhY2ggbGVuZ3RoIGluIHRoZQogICAgIHNvcnRlZCB0YWJsZSwgYW5kIHRoZW4gZW50ZXJpbmcgdGhlIHN5bWJvbHMgaW4gb3JkZXIgaW4gdGhlIHNvcnRlZAogICAgIHRhYmxlLiAgVGhlIHNvcnRlZCB0YWJsZSBpcyB3b3JrW10sIHdpdGggdGhhdCBzcGFjZSBiZWluZyBwcm92aWRlZCBieQogICAgIHRoZSBjYWxsZXIuCgogICAgIFRoZSBsZW5ndGggY291bnRzIGFyZSB1c2VkIGZvciBvdGhlciBwdXJwb3NlcyBhcyB3ZWxsLCBpLmUuIGZpbmRpbmcKICAgICB0aGUgbWluaW11bSBhbmQgbWF4aW11bSBsZW5ndGggY29kZXMsIGRldGVybWluaW5nIGlmIHRoZXJlIGFyZSBhbnkKICAgICBjb2RlcyBhdCBhbGwsIGNoZWNraW5nIGZvciBhIHZhbGlkIHNldCBvZiBsZW5ndGhzLCBhbmQgbG9va2luZyBhaGVhZAogICAgIGF0IGxlbmd0aCBjb3VudHMgdG8gZGV0ZXJtaW5lIHN1Yi10YWJsZSBzaXplcyB3aGVuIGJ1aWxkaW5nIHRoZQogICAgIGRlY29kaW5nIHRhYmxlcy4KICAgICAqLwoKICAgIC8qIGFjY3VtdWxhdGUgbGVuZ3RocyBmb3IgY29kZXMgKGFzc3VtZXMgbGVuc1tdIGFsbCBpbiAwLi5NQVhCSVRTKSAqLwogICAgZm9yIChsZW4gPSAwOyBsZW4gPD0gTUFYQklUUzsgbGVuKyspIHsKICAgICAgY291bnRbbGVuXSA9IDA7CiAgICB9CiAgICBmb3IgKHN5bSA9IDA7IHN5bSA8IGNvZGVzOyBzeW0rKykgewogICAgICBjb3VudFtsZW5zW2xlbnNfaW5kZXggKyBzeW1dXSsrOwogICAgfQoKICAgIC8qIGJvdW5kIGNvZGUgbGVuZ3RocywgZm9yY2Ugcm9vdCB0byBiZSB3aXRoaW4gY29kZSBsZW5ndGhzICovCiAgICByb290ID0gYml0czsKICAgIGZvciAobWF4ID0gTUFYQklUUzsgbWF4ID49IDE7IG1heC0tKSB7CiAgICAgIGlmIChjb3VudFttYXhdICE9PSAwKSB7IGJyZWFrOyB9CiAgICB9CiAgICBpZiAocm9vdCA+IG1heCkgewogICAgICByb290ID0gbWF4OwogICAgfQogICAgaWYgKG1heCA9PT0gMCkgeyAgICAgICAgICAgICAgICAgICAgIC8qIG5vIHN5bWJvbHMgdG8gY29kZSBhdCBhbGwgKi8KICAgICAgLy90YWJsZS5vcFtvcHRzLnRhYmxlX2luZGV4XSA9IDY0OyAgLy9oZXJlLm9wID0gKHZhciBjaGFyKTY0OyAgICAvKiBpbnZhbGlkIGNvZGUgbWFya2VyICovCiAgICAgIC8vdGFibGUuYml0c1tvcHRzLnRhYmxlX2luZGV4XSA9IDE7ICAgLy9oZXJlLmJpdHMgPSAodmFyIGNoYXIpMTsKICAgICAgLy90YWJsZS52YWxbb3B0cy50YWJsZV9pbmRleCsrXSA9IDA7ICAgLy9oZXJlLnZhbCA9ICh2YXIgc2hvcnQpMDsKICAgICAgdGFibGVbdGFibGVfaW5kZXgrK10gPSAoMSA8PCAyNCkgfCAoNjQgPDwgMTYpIHwgMDsKCgogICAgICAvL3RhYmxlLm9wW29wdHMudGFibGVfaW5kZXhdID0gNjQ7CiAgICAgIC8vdGFibGUuYml0c1tvcHRzLnRhYmxlX2luZGV4XSA9IDE7CiAgICAgIC8vdGFibGUudmFsW29wdHMudGFibGVfaW5kZXgrK10gPSAwOwogICAgICB0YWJsZVt0YWJsZV9pbmRleCsrXSA9ICgxIDw8IDI0KSB8ICg2NCA8PCAxNikgfCAwOwoKICAgICAgb3B0cy5iaXRzID0gMTsKICAgICAgcmV0dXJuIDA7ICAgICAvKiBubyBzeW1ib2xzLCBidXQgd2FpdCBmb3IgZGVjb2RpbmcgdG8gcmVwb3J0IGVycm9yICovCiAgICB9CiAgICBmb3IgKG1pbiA9IDE7IG1pbiA8IG1heDsgbWluKyspIHsKICAgICAgaWYgKGNvdW50W21pbl0gIT09IDApIHsgYnJlYWs7IH0KICAgIH0KICAgIGlmIChyb290IDwgbWluKSB7CiAgICAgIHJvb3QgPSBtaW47CiAgICB9CgogICAgLyogY2hlY2sgZm9yIGFuIG92ZXItc3Vic2NyaWJlZCBvciBpbmNvbXBsZXRlIHNldCBvZiBsZW5ndGhzICovCiAgICBsZWZ0ID0gMTsKICAgIGZvciAobGVuID0gMTsgbGVuIDw9IE1BWEJJVFM7IGxlbisrKSB7CiAgICAgIGxlZnQgPDw9IDE7CiAgICAgIGxlZnQgLT0gY291bnRbbGVuXTsKICAgICAgaWYgKGxlZnQgPCAwKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9ICAgICAgICAvKiBvdmVyLXN1YnNjcmliZWQgKi8KICAgIH0KICAgIGlmIChsZWZ0ID4gMCAmJiAodHlwZSA9PT0gQ09ERVMkMSB8fCBtYXggIT09IDEpKSB7CiAgICAgIHJldHVybiAtMTsgICAgICAgICAgICAgICAgICAgICAgLyogaW5jb21wbGV0ZSBzZXQgKi8KICAgIH0KCiAgICAvKiBnZW5lcmF0ZSBvZmZzZXRzIGludG8gc3ltYm9sIHRhYmxlIGZvciBlYWNoIGxlbmd0aCBmb3Igc29ydGluZyAqLwogICAgb2Zmc1sxXSA9IDA7CiAgICBmb3IgKGxlbiA9IDE7IGxlbiA8IE1BWEJJVFM7IGxlbisrKSB7CiAgICAgIG9mZnNbbGVuICsgMV0gPSBvZmZzW2xlbl0gKyBjb3VudFtsZW5dOwogICAgfQoKICAgIC8qIHNvcnQgc3ltYm9scyBieSBsZW5ndGgsIGJ5IHN5bWJvbCBvcmRlciB3aXRoaW4gZWFjaCBsZW5ndGggKi8KICAgIGZvciAoc3ltID0gMDsgc3ltIDwgY29kZXM7IHN5bSsrKSB7CiAgICAgIGlmIChsZW5zW2xlbnNfaW5kZXggKyBzeW1dICE9PSAwKSB7CiAgICAgICAgd29ya1tvZmZzW2xlbnNbbGVuc19pbmRleCArIHN5bV1dKytdID0gc3ltOwogICAgICB9CiAgICB9CgogICAgLyoKICAgICBDcmVhdGUgYW5kIGZpbGwgaW4gZGVjb2RpbmcgdGFibGVzLiAgSW4gdGhpcyBsb29wLCB0aGUgdGFibGUgYmVpbmcKICAgICBmaWxsZWQgaXMgYXQgbmV4dCBhbmQgaGFzIGN1cnIgaW5kZXggYml0cy4gIFRoZSBjb2RlIGJlaW5nIHVzZWQgaXMgaHVmZgogICAgIHdpdGggbGVuZ3RoIGxlbi4gIFRoYXQgY29kZSBpcyBjb252ZXJ0ZWQgdG8gYW4gaW5kZXggYnkgZHJvcHBpbmcgZHJvcAogICAgIGJpdHMgb2ZmIG9mIHRoZSBib3R0b20uICBGb3IgY29kZXMgd2hlcmUgbGVuIGlzIGxlc3MgdGhhbiBkcm9wICsgY3VyciwKICAgICB0aG9zZSB0b3AgZHJvcCArIGN1cnIgLSBsZW4gYml0cyBhcmUgaW5jcmVtZW50ZWQgdGhyb3VnaCBhbGwgdmFsdWVzIHRvCiAgICAgZmlsbCB0aGUgdGFibGUgd2l0aCByZXBsaWNhdGVkIGVudHJpZXMuCgogICAgIHJvb3QgaXMgdGhlIG51bWJlciBvZiBpbmRleCBiaXRzIGZvciB0aGUgcm9vdCB0YWJsZS4gIFdoZW4gbGVuIGV4Y2VlZHMKICAgICByb290LCBzdWItdGFibGVzIGFyZSBjcmVhdGVkIHBvaW50ZWQgdG8gYnkgdGhlIHJvb3QgZW50cnkgd2l0aCBhbiBpbmRleAogICAgIG9mIHRoZSBsb3cgcm9vdCBiaXRzIG9mIGh1ZmYuICBUaGlzIGlzIHNhdmVkIGluIGxvdyB0byBjaGVjayBmb3Igd2hlbiBhCiAgICAgbmV3IHN1Yi10YWJsZSBzaG91bGQgYmUgc3RhcnRlZC4gIGRyb3AgaXMgemVybyB3aGVuIHRoZSByb290IHRhYmxlIGlzCiAgICAgYmVpbmcgZmlsbGVkLCBhbmQgZHJvcCBpcyByb290IHdoZW4gc3ViLXRhYmxlcyBhcmUgYmVpbmcgZmlsbGVkLgoKICAgICBXaGVuIGEgbmV3IHN1Yi10YWJsZSBpcyBuZWVkZWQsIGl0IGlzIG5lY2Vzc2FyeSB0byBsb29rIGFoZWFkIGluIHRoZQogICAgIGNvZGUgbGVuZ3RocyB0byBkZXRlcm1pbmUgd2hhdCBzaXplIHN1Yi10YWJsZSBpcyBuZWVkZWQuICBUaGUgbGVuZ3RoCiAgICAgY291bnRzIGFyZSB1c2VkIGZvciB0aGlzLCBhbmQgc28gY291bnRbXSBpcyBkZWNyZW1lbnRlZCBhcyBjb2RlcyBhcmUKICAgICBlbnRlcmVkIGluIHRoZSB0YWJsZXMuCgogICAgIHVzZWQga2VlcHMgdHJhY2sgb2YgaG93IG1hbnkgdGFibGUgZW50cmllcyBoYXZlIGJlZW4gYWxsb2NhdGVkIGZyb20gdGhlCiAgICAgcHJvdmlkZWQgKnRhYmxlIHNwYWNlLiAgSXQgaXMgY2hlY2tlZCBmb3IgTEVOUyBhbmQgRElTVCB0YWJsZXMgYWdhaW5zdAogICAgIHRoZSBjb25zdGFudHMgRU5PVUdIX0xFTlMgYW5kIEVOT1VHSF9ESVNUUyB0byBndWFyZCBhZ2FpbnN0IGNoYW5nZXMgaW4KICAgICB0aGUgaW5pdGlhbCByb290IHRhYmxlIHNpemUgY29uc3RhbnRzLiAgU2VlIHRoZSBjb21tZW50cyBpbiBpbmZ0cmVlcy5oCiAgICAgZm9yIG1vcmUgaW5mb3JtYXRpb24uCgogICAgIHN5bSBpbmNyZW1lbnRzIHRocm91Z2ggYWxsIHN5bWJvbHMsIGFuZCB0aGUgbG9vcCB0ZXJtaW5hdGVzIHdoZW4KICAgICBhbGwgY29kZXMgb2YgbGVuZ3RoIG1heCwgaS5lLiBhbGwgY29kZXMsIGhhdmUgYmVlbiBwcm9jZXNzZWQuICBUaGlzCiAgICAgcm91dGluZSBwZXJtaXRzIGluY29tcGxldGUgY29kZXMsIHNvIGFub3RoZXIgbG9vcCBhZnRlciB0aGlzIG9uZSBmaWxscwogICAgIGluIHRoZSByZXN0IG9mIHRoZSBkZWNvZGluZyB0YWJsZXMgd2l0aCBpbnZhbGlkIGNvZGUgbWFya2Vycy4KICAgICAqLwoKICAgIC8qIHNldCB1cCBmb3IgY29kZSB0eXBlICovCiAgICAvLyBwb29yIG1hbiBvcHRpbWl6YXRpb24gLSB1c2UgaWYtZWxzZSBpbnN0ZWFkIG9mIHN3aXRjaCwKICAgIC8vIHRvIGF2b2lkIGRlb3B0cyBpbiBvbGQgdjgKICAgIGlmICh0eXBlID09PSBDT0RFUyQxKSB7CiAgICAgIGJhc2UgPSBleHRyYSA9IHdvcms7ICAgIC8qIGR1bW15IHZhbHVlLS1ub3QgdXNlZCAqLwogICAgICBlbmQgPSAxOTsKCiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IExFTlMkMSkgewogICAgICBiYXNlID0gbGJhc2U7CiAgICAgIGJhc2VfaW5kZXggLT0gMjU3OwogICAgICBleHRyYSA9IGxleHQ7CiAgICAgIGV4dHJhX2luZGV4IC09IDI1NzsKICAgICAgZW5kID0gMjU2OwoKICAgIH0gZWxzZSB7ICAgICAgICAgICAgICAgICAgICAvKiBESVNUUyAqLwogICAgICBiYXNlID0gZGJhc2U7CiAgICAgIGV4dHJhID0gZGV4dDsKICAgICAgZW5kID0gLTE7CiAgICB9CgogICAgLyogaW5pdGlhbGl6ZSBvcHRzIGZvciBsb29wICovCiAgICBodWZmID0gMDsgICAgICAgICAgICAgICAgICAgLyogc3RhcnRpbmcgY29kZSAqLwogICAgc3ltID0gMDsgICAgICAgICAgICAgICAgICAgIC8qIHN0YXJ0aW5nIGNvZGUgc3ltYm9sICovCiAgICBsZW4gPSBtaW47ICAgICAgICAgICAgICAgICAgLyogc3RhcnRpbmcgY29kZSBsZW5ndGggKi8KICAgIG5leHQgPSB0YWJsZV9pbmRleDsgICAgICAgICAgICAgIC8qIGN1cnJlbnQgdGFibGUgdG8gZmlsbCBpbiAqLwogICAgY3VyciA9IHJvb3Q7ICAgICAgICAgICAgICAgIC8qIGN1cnJlbnQgdGFibGUgaW5kZXggYml0cyAqLwogICAgZHJvcCA9IDA7ICAgICAgICAgICAgICAgICAgIC8qIGN1cnJlbnQgYml0cyB0byBkcm9wIGZyb20gY29kZSBmb3IgaW5kZXggKi8KICAgIGxvdyA9IC0xOyAgICAgICAgICAgICAgICAgICAvKiB0cmlnZ2VyIG5ldyBzdWItdGFibGUgd2hlbiBsZW4gPiByb290ICovCiAgICB1c2VkID0gMSA8PCByb290OyAgICAgICAgICAvKiB1c2Ugcm9vdCB0YWJsZSBlbnRyaWVzICovCiAgICBtYXNrID0gdXNlZCAtIDE7ICAgICAgICAgICAgLyogbWFzayBmb3IgY29tcGFyaW5nIGxvdyAqLwoKICAgIC8qIGNoZWNrIGF2YWlsYWJsZSB0YWJsZSBzcGFjZSAqLwogICAgaWYgKCh0eXBlID09PSBMRU5TJDEgJiYgdXNlZCA+IEVOT1VHSF9MRU5TJDEpIHx8CiAgICAgICh0eXBlID09PSBESVNUUyQxICYmIHVzZWQgPiBFTk9VR0hfRElTVFMkMSkpIHsKICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgLyogcHJvY2VzcyBhbGwgY29kZXMgYW5kIG1ha2UgdGFibGUgZW50cmllcyAqLwogICAgZm9yICg7OykgewogICAgICAvKiBjcmVhdGUgdGFibGUgZW50cnkgKi8KICAgICAgaGVyZV9iaXRzID0gbGVuIC0gZHJvcDsKICAgICAgaWYgKHdvcmtbc3ltXSA8IGVuZCkgewogICAgICAgIGhlcmVfb3AgPSAwOwogICAgICAgIGhlcmVfdmFsID0gd29ya1tzeW1dOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHdvcmtbc3ltXSA+IGVuZCkgewogICAgICAgIGhlcmVfb3AgPSBleHRyYVtleHRyYV9pbmRleCArIHdvcmtbc3ltXV07CiAgICAgICAgaGVyZV92YWwgPSBiYXNlW2Jhc2VfaW5kZXggKyB3b3JrW3N5bV1dOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIGhlcmVfb3AgPSAzMiArIDY0OyAgICAgICAgIC8qIGVuZCBvZiBibG9jayAqLwogICAgICAgIGhlcmVfdmFsID0gMDsKICAgICAgfQoKICAgICAgLyogcmVwbGljYXRlIGZvciB0aG9zZSBpbmRpY2VzIHdpdGggbG93IGxlbiBiaXRzIGVxdWFsIHRvIGh1ZmYgKi8KICAgICAgaW5jciA9IDEgPDwgKGxlbiAtIGRyb3ApOwogICAgICBmaWxsID0gMSA8PCBjdXJyOwogICAgICBtaW4gPSBmaWxsOyAgICAgICAgICAgICAgICAgLyogc2F2ZSBvZmZzZXQgdG8gbmV4dCB0YWJsZSAqLwogICAgICBkbyB7CiAgICAgICAgZmlsbCAtPSBpbmNyOwogICAgICAgIHRhYmxlW25leHQgKyAoaHVmZiA+PiBkcm9wKSArIGZpbGxdID0gKGhlcmVfYml0cyA8PCAyNCkgfCAoaGVyZV9vcCA8PCAxNikgfCBoZXJlX3ZhbCB8MDsKICAgICAgfSB3aGlsZSAoZmlsbCAhPT0gMCk7CgogICAgICAvKiBiYWNrd2FyZHMgaW5jcmVtZW50IHRoZSBsZW4tYml0IGNvZGUgaHVmZiAqLwogICAgICBpbmNyID0gMSA8PCAobGVuIC0gMSk7CiAgICAgIHdoaWxlIChodWZmICYgaW5jcikgewogICAgICAgIGluY3IgPj49IDE7CiAgICAgIH0KICAgICAgaWYgKGluY3IgIT09IDApIHsKICAgICAgICBodWZmICY9IGluY3IgLSAxOwogICAgICAgIGh1ZmYgKz0gaW5jcjsKICAgICAgfSBlbHNlIHsKICAgICAgICBodWZmID0gMDsKICAgICAgfQoKICAgICAgLyogZ28gdG8gbmV4dCBzeW1ib2wsIHVwZGF0ZSBjb3VudCwgbGVuICovCiAgICAgIHN5bSsrOwogICAgICBpZiAoLS1jb3VudFtsZW5dID09PSAwKSB7CiAgICAgICAgaWYgKGxlbiA9PT0gbWF4KSB7IGJyZWFrOyB9CiAgICAgICAgbGVuID0gbGVuc1tsZW5zX2luZGV4ICsgd29ya1tzeW1dXTsKICAgICAgfQoKICAgICAgLyogY3JlYXRlIG5ldyBzdWItdGFibGUgaWYgbmVlZGVkICovCiAgICAgIGlmIChsZW4gPiByb290ICYmIChodWZmICYgbWFzaykgIT09IGxvdykgewogICAgICAgIC8qIGlmIGZpcnN0IHRpbWUsIHRyYW5zaXRpb24gdG8gc3ViLXRhYmxlcyAqLwogICAgICAgIGlmIChkcm9wID09PSAwKSB7CiAgICAgICAgICBkcm9wID0gcm9vdDsKICAgICAgICB9CgogICAgICAgIC8qIGluY3JlbWVudCBwYXN0IGxhc3QgdGFibGUgKi8KICAgICAgICBuZXh0ICs9IG1pbjsgICAgICAgICAgICAvKiBoZXJlIG1pbiBpcyAxIDw8IGN1cnIgKi8KCiAgICAgICAgLyogZGV0ZXJtaW5lIGxlbmd0aCBvZiBuZXh0IHRhYmxlICovCiAgICAgICAgY3VyciA9IGxlbiAtIGRyb3A7CiAgICAgICAgbGVmdCA9IDEgPDwgY3VycjsKICAgICAgICB3aGlsZSAoY3VyciArIGRyb3AgPCBtYXgpIHsKICAgICAgICAgIGxlZnQgLT0gY291bnRbY3VyciArIGRyb3BdOwogICAgICAgICAgaWYgKGxlZnQgPD0gMCkgeyBicmVhazsgfQogICAgICAgICAgY3VycisrOwogICAgICAgICAgbGVmdCA8PD0gMTsKICAgICAgICB9CgogICAgICAgIC8qIGNoZWNrIGZvciBlbm91Z2ggc3BhY2UgKi8KICAgICAgICB1c2VkICs9IDEgPDwgY3VycjsKICAgICAgICBpZiAoKHR5cGUgPT09IExFTlMkMSAmJiB1c2VkID4gRU5PVUdIX0xFTlMkMSkgfHwKICAgICAgICAgICh0eXBlID09PSBESVNUUyQxICYmIHVzZWQgPiBFTk9VR0hfRElTVFMkMSkpIHsKICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KCiAgICAgICAgLyogcG9pbnQgZW50cnkgaW4gcm9vdCB0YWJsZSB0byBzdWItdGFibGUgKi8KICAgICAgICBsb3cgPSBodWZmICYgbWFzazsKICAgICAgICAvKnRhYmxlLm9wW2xvd10gPSBjdXJyOwogICAgICAgIHRhYmxlLmJpdHNbbG93XSA9IHJvb3Q7CiAgICAgICAgdGFibGUudmFsW2xvd10gPSBuZXh0IC0gb3B0cy50YWJsZV9pbmRleDsqLwogICAgICAgIHRhYmxlW2xvd10gPSAocm9vdCA8PCAyNCkgfCAoY3VyciA8PCAxNikgfCAobmV4dCAtIHRhYmxlX2luZGV4KSB8MDsKICAgICAgfQogICAgfQoKICAgIC8qIGZpbGwgaW4gcmVtYWluaW5nIHRhYmxlIGVudHJ5IGlmIGNvZGUgaXMgaW5jb21wbGV0ZSAoZ3VhcmFudGVlZCB0byBoYXZlCiAgICAgYXQgbW9zdCBvbmUgcmVtYWluaW5nIGVudHJ5LCBzaW5jZSBpZiB0aGUgY29kZSBpcyBpbmNvbXBsZXRlLCB0aGUKICAgICBtYXhpbXVtIGNvZGUgbGVuZ3RoIHRoYXQgd2FzIGFsbG93ZWQgdG8gZ2V0IHRoaXMgZmFyIGlzIG9uZSBiaXQpICovCiAgICBpZiAoaHVmZiAhPT0gMCkgewogICAgICAvL3RhYmxlLm9wW25leHQgKyBodWZmXSA9IDY0OyAgICAgICAgICAgIC8qIGludmFsaWQgY29kZSBtYXJrZXIgKi8KICAgICAgLy90YWJsZS5iaXRzW25leHQgKyBodWZmXSA9IGxlbiAtIGRyb3A7CiAgICAgIC8vdGFibGUudmFsW25leHQgKyBodWZmXSA9IDA7CiAgICAgIHRhYmxlW25leHQgKyBodWZmXSA9ICgobGVuIC0gZHJvcCkgPDwgMjQpIHwgKDY0IDw8IDE2KSB8MDsKICAgIH0KCiAgICAvKiBzZXQgcmV0dXJuIHBhcmFtZXRlcnMgKi8KICAgIC8vb3B0cy50YWJsZV9pbmRleCArPSB1c2VkOwogICAgb3B0cy5iaXRzID0gcm9vdDsKICAgIHJldHVybiAwOwogIH07CgoKICB2YXIgaW5mdHJlZXMgPSBpbmZsYXRlX3RhYmxlOwoKICAvLyAoQykgMTk5NS0yMDEzIEplYW4tbG91cCBHYWlsbHkgYW5kIE1hcmsgQWRsZXIKICAvLyAoQykgMjAxNC0yMDE3IFZpdGFseSBQdXpyaW4gYW5kIEFuZHJleSBUdXBpdHNpbgogIC8vCiAgLy8gVGhpcyBzb2Z0d2FyZSBpcyBwcm92aWRlZCAnYXMtaXMnLCB3aXRob3V0IGFueSBleHByZXNzIG9yIGltcGxpZWQKICAvLyB3YXJyYW50eS4gSW4gbm8gZXZlbnQgd2lsbCB0aGUgYXV0aG9ycyBiZSBoZWxkIGxpYWJsZSBmb3IgYW55IGRhbWFnZXMKICAvLyBhcmlzaW5nIGZyb20gdGhlIHVzZSBvZiB0aGlzIHNvZnR3YXJlLgogIC8vCiAgLy8gUGVybWlzc2lvbiBpcyBncmFudGVkIHRvIGFueW9uZSB0byB1c2UgdGhpcyBzb2Z0d2FyZSBmb3IgYW55IHB1cnBvc2UsCiAgLy8gaW5jbHVkaW5nIGNvbW1lcmNpYWwgYXBwbGljYXRpb25zLCBhbmQgdG8gYWx0ZXIgaXQgYW5kIHJlZGlzdHJpYnV0ZSBpdAogIC8vIGZyZWVseSwgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIHJlc3RyaWN0aW9uczoKICAvLwogIC8vIDEuIFRoZSBvcmlnaW4gb2YgdGhpcyBzb2Z0d2FyZSBtdXN0IG5vdCBiZSBtaXNyZXByZXNlbnRlZDsgeW91IG11c3Qgbm90CiAgLy8gICBjbGFpbSB0aGF0IHlvdSB3cm90ZSB0aGUgb3JpZ2luYWwgc29mdHdhcmUuIElmIHlvdSB1c2UgdGhpcyBzb2Z0d2FyZQogIC8vICAgaW4gYSBwcm9kdWN0LCBhbiBhY2tub3dsZWRnbWVudCBpbiB0aGUgcHJvZHVjdCBkb2N1bWVudGF0aW9uIHdvdWxkIGJlCiAgLy8gICBhcHByZWNpYXRlZCBidXQgaXMgbm90IHJlcXVpcmVkLgogIC8vIDIuIEFsdGVyZWQgc291cmNlIHZlcnNpb25zIG11c3QgYmUgcGxhaW5seSBtYXJrZWQgYXMgc3VjaCwgYW5kIG11c3Qgbm90IGJlCiAgLy8gICBtaXNyZXByZXNlbnRlZCBhcyBiZWluZyB0aGUgb3JpZ2luYWwgc29mdHdhcmUuCiAgLy8gMy4gVGhpcyBub3RpY2UgbWF5IG5vdCBiZSByZW1vdmVkIG9yIGFsdGVyZWQgZnJvbSBhbnkgc291cmNlIGRpc3RyaWJ1dGlvbi4KCgoKCgoKICBjb25zdCBDT0RFUyA9IDA7CiAgY29uc3QgTEVOUyA9IDE7CiAgY29uc3QgRElTVFMgPSAyOwoKICAvKiBQdWJsaWMgY29uc3RhbnRzID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgogIGNvbnN0IHsKICAgIFpfRklOSVNIOiBaX0ZJTklTSCQxLCBaX0JMT0NLLCBaX1RSRUVTLAogICAgWl9PSzogWl9PSyQxLCBaX1NUUkVBTV9FTkQ6IFpfU1RSRUFNX0VORCQxLCBaX05FRURfRElDVDogWl9ORUVEX0RJQ1QkMSwgWl9TVFJFQU1fRVJST1I6IFpfU1RSRUFNX0VSUk9SJDEsIFpfREFUQV9FUlJPUjogWl9EQVRBX0VSUk9SJDEsIFpfTUVNX0VSUk9SOiBaX01FTV9FUlJPUiQxLCBaX0JVRl9FUlJPUiwKICAgIFpfREVGTEFURUQKICB9ID0gY29uc3RhbnRzJDI7CgoKICAvKiBTVEFURVMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwogIC8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSovCgoKICBjb25zdCAgICBIRUFEID0gMTsgICAgICAgLyogaTogd2FpdGluZyBmb3IgbWFnaWMgaGVhZGVyICovCiAgY29uc3QgICAgRkxBR1MgPSAyOyAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIG1ldGhvZCBhbmQgZmxhZ3MgKGd6aXApICovCiAgY29uc3QgICAgVElNRSA9IDM7ICAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIG1vZGlmaWNhdGlvbiB0aW1lIChnemlwKSAqLwogIGNvbnN0ICAgIE9TID0gNDsgICAgICAgICAvKiBpOiB3YWl0aW5nIGZvciBleHRyYSBmbGFncyBhbmQgb3BlcmF0aW5nIHN5c3RlbSAoZ3ppcCkgKi8KICBjb25zdCAgICBFWExFTiA9IDU7ICAgICAgLyogaTogd2FpdGluZyBmb3IgZXh0cmEgbGVuZ3RoIChnemlwKSAqLwogIGNvbnN0ICAgIEVYVFJBID0gNjsgICAgICAvKiBpOiB3YWl0aW5nIGZvciBleHRyYSBieXRlcyAoZ3ppcCkgKi8KICBjb25zdCAgICBOQU1FID0gNzsgICAgICAgLyogaTogd2FpdGluZyBmb3IgZW5kIG9mIGZpbGUgbmFtZSAoZ3ppcCkgKi8KICBjb25zdCAgICBDT01NRU5UID0gODsgICAgLyogaTogd2FpdGluZyBmb3IgZW5kIG9mIGNvbW1lbnQgKGd6aXApICovCiAgY29uc3QgICAgSENSQyA9IDk7ICAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIGhlYWRlciBjcmMgKGd6aXApICovCiAgY29uc3QgICAgRElDVElEID0gMTA7ICAgIC8qIGk6IHdhaXRpbmcgZm9yIGRpY3Rpb25hcnkgY2hlY2sgdmFsdWUgKi8KICBjb25zdCAgICBESUNUID0gMTE7ICAgICAgLyogd2FpdGluZyBmb3IgaW5mbGF0ZVNldERpY3Rpb25hcnkoKSBjYWxsICovCiAgY29uc3QgICAgICAgIFRZUEUgPSAxMjsgICAgICAvKiBpOiB3YWl0aW5nIGZvciB0eXBlIGJpdHMsIGluY2x1ZGluZyBsYXN0LWZsYWcgYml0ICovCiAgY29uc3QgICAgICAgIFRZUEVETyA9IDEzOyAgICAvKiBpOiBzYW1lLCBidXQgc2tpcCBjaGVjayB0byBleGl0IGluZmxhdGUgb24gbmV3IGJsb2NrICovCiAgY29uc3QgICAgICAgIFNUT1JFRCA9IDE0OyAgICAvKiBpOiB3YWl0aW5nIGZvciBzdG9yZWQgc2l6ZSAobGVuZ3RoIGFuZCBjb21wbGVtZW50KSAqLwogIGNvbnN0ICAgICAgICBDT1BZXyA9IDE1OyAgICAgLyogaS9vOiBzYW1lIGFzIENPUFkgYmVsb3csIGJ1dCBvbmx5IGZpcnN0IHRpbWUgaW4gKi8KICBjb25zdCAgICAgICAgQ09QWSA9IDE2OyAgICAgIC8qIGkvbzogd2FpdGluZyBmb3IgaW5wdXQgb3Igb3V0cHV0IHRvIGNvcHkgc3RvcmVkIGJsb2NrICovCiAgY29uc3QgICAgICAgIFRBQkxFID0gMTc7ICAgICAvKiBpOiB3YWl0aW5nIGZvciBkeW5hbWljIGJsb2NrIHRhYmxlIGxlbmd0aHMgKi8KICBjb25zdCAgICAgICAgTEVOTEVOUyA9IDE4OyAgIC8qIGk6IHdhaXRpbmcgZm9yIGNvZGUgbGVuZ3RoIGNvZGUgbGVuZ3RocyAqLwogIGNvbnN0ICAgICAgICBDT0RFTEVOUyA9IDE5OyAgLyogaTogd2FpdGluZyBmb3IgbGVuZ3RoL2xpdCBhbmQgZGlzdGFuY2UgY29kZSBsZW5ndGhzICovCiAgY29uc3QgICAgICAgICAgICBMRU5fID0gMjA7ICAgICAgLyogaTogc2FtZSBhcyBMRU4gYmVsb3csIGJ1dCBvbmx5IGZpcnN0IHRpbWUgaW4gKi8KICBjb25zdCAgICAgICAgICAgIExFTiA9IDIxOyAgICAgICAvKiBpOiB3YWl0aW5nIGZvciBsZW5ndGgvbGl0L2VvYiBjb2RlICovCiAgY29uc3QgICAgICAgICAgICBMRU5FWFQgPSAyMjsgICAgLyogaTogd2FpdGluZyBmb3IgbGVuZ3RoIGV4dHJhIGJpdHMgKi8KICBjb25zdCAgICAgICAgICAgIERJU1QgPSAyMzsgICAgICAvKiBpOiB3YWl0aW5nIGZvciBkaXN0YW5jZSBjb2RlICovCiAgY29uc3QgICAgICAgICAgICBESVNURVhUID0gMjQ7ICAgLyogaTogd2FpdGluZyBmb3IgZGlzdGFuY2UgZXh0cmEgYml0cyAqLwogIGNvbnN0ICAgICAgICAgICAgTUFUQ0ggPSAyNTsgICAgIC8qIG86IHdhaXRpbmcgZm9yIG91dHB1dCBzcGFjZSB0byBjb3B5IHN0cmluZyAqLwogIGNvbnN0ICAgICAgICAgICAgTElUID0gMjY7ICAgICAgIC8qIG86IHdhaXRpbmcgZm9yIG91dHB1dCBzcGFjZSB0byB3cml0ZSBsaXRlcmFsICovCiAgY29uc3QgICAgQ0hFQ0sgPSAyNzsgICAgIC8qIGk6IHdhaXRpbmcgZm9yIDMyLWJpdCBjaGVjayB2YWx1ZSAqLwogIGNvbnN0ICAgIExFTkdUSCA9IDI4OyAgICAvKiBpOiB3YWl0aW5nIGZvciAzMi1iaXQgbGVuZ3RoIChnemlwKSAqLwogIGNvbnN0ICAgIERPTkUgPSAyOTsgICAgICAvKiBmaW5pc2hlZCBjaGVjaywgZG9uZSAtLSByZW1haW4gaGVyZSB1bnRpbCByZXNldCAqLwogIGNvbnN0ICAgIEJBRCA9IDMwOyAgICAgICAvKiBnb3QgYSBkYXRhIGVycm9yIC0tIHJlbWFpbiBoZXJlIHVudGlsIHJlc2V0ICovCiAgY29uc3QgICAgTUVNID0gMzE7ICAgICAgIC8qIGdvdCBhbiBpbmZsYXRlKCkgbWVtb3J5IGVycm9yIC0tIHJlbWFpbiBoZXJlIHVudGlsIHJlc2V0ICovCiAgY29uc3QgICAgU1lOQyA9IDMyOyAgICAgIC8qIGxvb2tpbmcgZm9yIHN5bmNocm9uaXphdGlvbiBieXRlcyB0byByZXN0YXJ0IGluZmxhdGUoKSAqLwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCgogIGNvbnN0IEVOT1VHSF9MRU5TID0gODUyOwogIGNvbnN0IEVOT1VHSF9ESVNUUyA9IDU5MjsKICAvL2NvbnN0IEVOT1VHSCA9ICAoRU5PVUdIX0xFTlMrRU5PVUdIX0RJU1RTKTsKCiAgY29uc3QgTUFYX1dCSVRTID0gMTU7CiAgLyogMzJLIExaNzcgd2luZG93ICovCiAgY29uc3QgREVGX1dCSVRTID0gTUFYX1dCSVRTOwoKCiAgY29uc3QgenN3YXAzMiA9IChxKSA9PiB7CgogICAgcmV0dXJuICAoKChxID4+PiAyNCkgJiAweGZmKSArCiAgICAgICAgICAgICgocSA+Pj4gOCkgJiAweGZmMDApICsKICAgICAgICAgICAgKChxICYgMHhmZjAwKSA8PCA4KSArCiAgICAgICAgICAgICgocSAmIDB4ZmYpIDw8IDI0KSk7CiAgfTsKCgogIGZ1bmN0aW9uIEluZmxhdGVTdGF0ZSgpIHsKICAgIHRoaXMubW9kZSA9IDA7ICAgICAgICAgICAgIC8qIGN1cnJlbnQgaW5mbGF0ZSBtb2RlICovCiAgICB0aGlzLmxhc3QgPSBmYWxzZTsgICAgICAgICAgLyogdHJ1ZSBpZiBwcm9jZXNzaW5nIGxhc3QgYmxvY2sgKi8KICAgIHRoaXMud3JhcCA9IDA7ICAgICAgICAgICAgICAvKiBiaXQgMCB0cnVlIGZvciB6bGliLCBiaXQgMSB0cnVlIGZvciBnemlwICovCiAgICB0aGlzLmhhdmVkaWN0ID0gZmFsc2U7ICAgICAgLyogdHJ1ZSBpZiBkaWN0aW9uYXJ5IHByb3ZpZGVkICovCiAgICB0aGlzLmZsYWdzID0gMDsgICAgICAgICAgICAgLyogZ3ppcCBoZWFkZXIgbWV0aG9kIGFuZCBmbGFncyAoMCBpZiB6bGliKSAqLwogICAgdGhpcy5kbWF4ID0gMDsgICAgICAgICAgICAgIC8qIHpsaWIgaGVhZGVyIG1heCBkaXN0YW5jZSAoSU5GTEFURV9TVFJJQ1QpICovCiAgICB0aGlzLmNoZWNrID0gMDsgICAgICAgICAgICAgLyogcHJvdGVjdGVkIGNvcHkgb2YgY2hlY2sgdmFsdWUgKi8KICAgIHRoaXMudG90YWwgPSAwOyAgICAgICAgICAgICAvKiBwcm90ZWN0ZWQgY29weSBvZiBvdXRwdXQgY291bnQgKi8KICAgIC8vIFRPRE86IG1heSBiZSB7fQogICAgdGhpcy5oZWFkID0gbnVsbDsgICAgICAgICAgIC8qIHdoZXJlIHRvIHNhdmUgZ3ppcCBoZWFkZXIgaW5mb3JtYXRpb24gKi8KCiAgICAvKiBzbGlkaW5nIHdpbmRvdyAqLwogICAgdGhpcy53Yml0cyA9IDA7ICAgICAgICAgICAgIC8qIGxvZyBiYXNlIDIgb2YgcmVxdWVzdGVkIHdpbmRvdyBzaXplICovCiAgICB0aGlzLndzaXplID0gMDsgICAgICAgICAgICAgLyogd2luZG93IHNpemUgb3IgemVybyBpZiBub3QgdXNpbmcgd2luZG93ICovCiAgICB0aGlzLndoYXZlID0gMDsgICAgICAgICAgICAgLyogdmFsaWQgYnl0ZXMgaW4gdGhlIHdpbmRvdyAqLwogICAgdGhpcy53bmV4dCA9IDA7ICAgICAgICAgICAgIC8qIHdpbmRvdyB3cml0ZSBpbmRleCAqLwogICAgdGhpcy53aW5kb3cgPSBudWxsOyAgICAgICAgIC8qIGFsbG9jYXRlZCBzbGlkaW5nIHdpbmRvdywgaWYgbmVlZGVkICovCgogICAgLyogYml0IGFjY3VtdWxhdG9yICovCiAgICB0aGlzLmhvbGQgPSAwOyAgICAgICAgICAgICAgLyogaW5wdXQgYml0IGFjY3VtdWxhdG9yICovCiAgICB0aGlzLmJpdHMgPSAwOyAgICAgICAgICAgICAgLyogbnVtYmVyIG9mIGJpdHMgaW4gImluIiAqLwoKICAgIC8qIGZvciBzdHJpbmcgYW5kIHN0b3JlZCBibG9jayBjb3B5aW5nICovCiAgICB0aGlzLmxlbmd0aCA9IDA7ICAgICAgICAgICAgLyogbGl0ZXJhbCBvciBsZW5ndGggb2YgZGF0YSB0byBjb3B5ICovCiAgICB0aGlzLm9mZnNldCA9IDA7ICAgICAgICAgICAgLyogZGlzdGFuY2UgYmFjayB0byBjb3B5IHN0cmluZyBmcm9tICovCgogICAgLyogZm9yIHRhYmxlIGFuZCBjb2RlIGRlY29kaW5nICovCiAgICB0aGlzLmV4dHJhID0gMDsgICAgICAgICAgICAgLyogZXh0cmEgYml0cyBuZWVkZWQgKi8KCiAgICAvKiBmaXhlZCBhbmQgZHluYW1pYyBjb2RlIHRhYmxlcyAqLwogICAgdGhpcy5sZW5jb2RlID0gbnVsbDsgICAgICAgICAgLyogc3RhcnRpbmcgdGFibGUgZm9yIGxlbmd0aC9saXRlcmFsIGNvZGVzICovCiAgICB0aGlzLmRpc3Rjb2RlID0gbnVsbDsgICAgICAgICAvKiBzdGFydGluZyB0YWJsZSBmb3IgZGlzdGFuY2UgY29kZXMgKi8KICAgIHRoaXMubGVuYml0cyA9IDA7ICAgICAgICAgICAvKiBpbmRleCBiaXRzIGZvciBsZW5jb2RlICovCiAgICB0aGlzLmRpc3RiaXRzID0gMDsgICAgICAgICAgLyogaW5kZXggYml0cyBmb3IgZGlzdGNvZGUgKi8KCiAgICAvKiBkeW5hbWljIHRhYmxlIGJ1aWxkaW5nICovCiAgICB0aGlzLm5jb2RlID0gMDsgICAgICAgICAgICAgLyogbnVtYmVyIG9mIGNvZGUgbGVuZ3RoIGNvZGUgbGVuZ3RocyAqLwogICAgdGhpcy5ubGVuID0gMDsgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBsZW5ndGggY29kZSBsZW5ndGhzICovCiAgICB0aGlzLm5kaXN0ID0gMDsgICAgICAgICAgICAgLyogbnVtYmVyIG9mIGRpc3RhbmNlIGNvZGUgbGVuZ3RocyAqLwogICAgdGhpcy5oYXZlID0gMDsgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBjb2RlIGxlbmd0aHMgaW4gbGVuc1tdICovCiAgICB0aGlzLm5leHQgPSBudWxsOyAgICAgICAgICAgICAgLyogbmV4dCBhdmFpbGFibGUgc3BhY2UgaW4gY29kZXNbXSAqLwoKICAgIHRoaXMubGVucyA9IG5ldyBVaW50MTZBcnJheSgzMjApOyAvKiB0ZW1wb3Jhcnkgc3RvcmFnZSBmb3IgY29kZSBsZW5ndGhzICovCiAgICB0aGlzLndvcmsgPSBuZXcgVWludDE2QXJyYXkoMjg4KTsgLyogd29yayBhcmVhIGZvciBjb2RlIHRhYmxlIGJ1aWxkaW5nICovCgogICAgLyoKICAgICBiZWNhdXNlIHdlIGRvbid0IGhhdmUgcG9pbnRlcnMgaW4ganMsIHdlIHVzZSBsZW5jb2RlIGFuZCBkaXN0Y29kZSBkaXJlY3RseQogICAgIGFzIGJ1ZmZlcnMgc28gd2UgZG9uJ3QgbmVlZCBjb2RlcwogICAgKi8KICAgIC8vdGhpcy5jb2RlcyA9IG5ldyBJbnQzMkFycmF5KEVOT1VHSCk7ICAgICAgIC8qIHNwYWNlIGZvciBjb2RlIHRhYmxlcyAqLwogICAgdGhpcy5sZW5keW4gPSBudWxsOyAgICAgICAgICAgICAgLyogZHluYW1pYyB0YWJsZSBmb3IgbGVuZ3RoL2xpdGVyYWwgY29kZXMgKEpTIHNwZWNpZmljKSAqLwogICAgdGhpcy5kaXN0ZHluID0gbnVsbDsgICAgICAgICAgICAgLyogZHluYW1pYyB0YWJsZSBmb3IgZGlzdGFuY2UgY29kZXMgKEpTIHNwZWNpZmljKSAqLwogICAgdGhpcy5zYW5lID0gMDsgICAgICAgICAgICAgICAgICAgLyogaWYgZmFsc2UsIGFsbG93IGludmFsaWQgZGlzdGFuY2UgdG9vIGZhciAqLwogICAgdGhpcy5iYWNrID0gMDsgICAgICAgICAgICAgICAgICAgLyogYml0cyBiYWNrIG9mIGxhc3QgdW5wcm9jZXNzZWQgbGVuZ3RoL2xpdCAqLwogICAgdGhpcy53YXMgPSAwOyAgICAgICAgICAgICAgICAgICAgLyogaW5pdGlhbCBsZW5ndGggb2YgbWF0Y2ggKi8KICB9CgoKICBjb25zdCBpbmZsYXRlUmVzZXRLZWVwID0gKHN0cm0pID0+IHsKCiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7IH0KICAgIGNvbnN0IHN0YXRlID0gc3RybS5zdGF0ZTsKICAgIHN0cm0udG90YWxfaW4gPSBzdHJtLnRvdGFsX291dCA9IHN0YXRlLnRvdGFsID0gMDsKICAgIHN0cm0ubXNnID0gJyc7IC8qWl9OVUxMKi8KICAgIGlmIChzdGF0ZS53cmFwKSB7ICAgICAgIC8qIHRvIHN1cHBvcnQgaWxsLWNvbmNlaXZlZCBKYXZhIHRlc3Qgc3VpdGUgKi8KICAgICAgc3RybS5hZGxlciA9IHN0YXRlLndyYXAgJiAxOwogICAgfQogICAgc3RhdGUubW9kZSA9IEhFQUQ7CiAgICBzdGF0ZS5sYXN0ID0gMDsKICAgIHN0YXRlLmhhdmVkaWN0ID0gMDsKICAgIHN0YXRlLmRtYXggPSAzMjc2ODsKICAgIHN0YXRlLmhlYWQgPSBudWxsLypaX05VTEwqLzsKICAgIHN0YXRlLmhvbGQgPSAwOwogICAgc3RhdGUuYml0cyA9IDA7CiAgICAvL3N0YXRlLmxlbmNvZGUgPSBzdGF0ZS5kaXN0Y29kZSA9IHN0YXRlLm5leHQgPSBzdGF0ZS5jb2RlczsKICAgIHN0YXRlLmxlbmNvZGUgPSBzdGF0ZS5sZW5keW4gPSBuZXcgSW50MzJBcnJheShFTk9VR0hfTEVOUyk7CiAgICBzdGF0ZS5kaXN0Y29kZSA9IHN0YXRlLmRpc3RkeW4gPSBuZXcgSW50MzJBcnJheShFTk9VR0hfRElTVFMpOwoKICAgIHN0YXRlLnNhbmUgPSAxOwogICAgc3RhdGUuYmFjayA9IC0xOwogICAgLy9UcmFjZXYoKHN0ZGVyciwgImluZmxhdGU6IHJlc2V0XG4iKSk7CiAgICByZXR1cm4gWl9PSyQxOwogIH07CgoKICBjb25zdCBpbmZsYXRlUmVzZXQgPSAoc3RybSkgPT4gewoKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgeyByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsgfQogICAgY29uc3Qgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgc3RhdGUud3NpemUgPSAwOwogICAgc3RhdGUud2hhdmUgPSAwOwogICAgc3RhdGUud25leHQgPSAwOwogICAgcmV0dXJuIGluZmxhdGVSZXNldEtlZXAoc3RybSk7CgogIH07CgoKICBjb25zdCBpbmZsYXRlUmVzZXQyID0gKHN0cm0sIHdpbmRvd0JpdHMpID0+IHsKICAgIGxldCB3cmFwOwoKICAgIC8qIGdldCB0aGUgc3RhdGUgKi8KICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSkgeyByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsgfQogICAgY29uc3Qgc3RhdGUgPSBzdHJtLnN0YXRlOwoKICAgIC8qIGV4dHJhY3Qgd3JhcCByZXF1ZXN0IGZyb20gd2luZG93Qml0cyBwYXJhbWV0ZXIgKi8KICAgIGlmICh3aW5kb3dCaXRzIDwgMCkgewogICAgICB3cmFwID0gMDsKICAgICAgd2luZG93Qml0cyA9IC13aW5kb3dCaXRzOwogICAgfQogICAgZWxzZSB7CiAgICAgIHdyYXAgPSAod2luZG93Qml0cyA+PiA0KSArIDE7CiAgICAgIGlmICh3aW5kb3dCaXRzIDwgNDgpIHsKICAgICAgICB3aW5kb3dCaXRzICY9IDE1OwogICAgICB9CiAgICB9CgogICAgLyogc2V0IG51bWJlciBvZiB3aW5kb3cgYml0cywgZnJlZSB3aW5kb3cgaWYgZGlmZmVyZW50ICovCiAgICBpZiAod2luZG93Qml0cyAmJiAod2luZG93Qml0cyA8IDggfHwgd2luZG93Qml0cyA+IDE1KSkgewogICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsKICAgIH0KICAgIGlmIChzdGF0ZS53aW5kb3cgIT09IG51bGwgJiYgc3RhdGUud2JpdHMgIT09IHdpbmRvd0JpdHMpIHsKICAgICAgc3RhdGUud2luZG93ID0gbnVsbDsKICAgIH0KCiAgICAvKiB1cGRhdGUgc3RhdGUgYW5kIHJlc2V0IHRoZSByZXN0IG9mIGl0ICovCiAgICBzdGF0ZS53cmFwID0gd3JhcDsKICAgIHN0YXRlLndiaXRzID0gd2luZG93Qml0czsKICAgIHJldHVybiBpbmZsYXRlUmVzZXQoc3RybSk7CiAgfTsKCgogIGNvbnN0IGluZmxhdGVJbml0MiA9IChzdHJtLCB3aW5kb3dCaXRzKSA9PiB7CgogICAgaWYgKCFzdHJtKSB7IHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOyB9CiAgICAvL3N0cm0ubXNnID0gWl9OVUxMOyAgICAgICAgICAgICAgICAgLyogaW4gY2FzZSB3ZSByZXR1cm4gYW4gZXJyb3IgKi8KCiAgICBjb25zdCBzdGF0ZSA9IG5ldyBJbmZsYXRlU3RhdGUoKTsKCiAgICAvL2lmIChzdGF0ZSA9PT0gWl9OVUxMKSByZXR1cm4gWl9NRU1fRVJST1I7CiAgICAvL1RyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogYWxsb2NhdGVkXG4iKSk7CiAgICBzdHJtLnN0YXRlID0gc3RhdGU7CiAgICBzdGF0ZS53aW5kb3cgPSBudWxsLypaX05VTEwqLzsKICAgIGNvbnN0IHJldCA9IGluZmxhdGVSZXNldDIoc3RybSwgd2luZG93Qml0cyk7CiAgICBpZiAocmV0ICE9PSBaX09LJDEpIHsKICAgICAgc3RybS5zdGF0ZSA9IG51bGwvKlpfTlVMTCovOwogICAgfQogICAgcmV0dXJuIHJldDsKICB9OwoKCiAgY29uc3QgaW5mbGF0ZUluaXQgPSAoc3RybSkgPT4gewoKICAgIHJldHVybiBpbmZsYXRlSW5pdDIoc3RybSwgREVGX1dCSVRTKTsKICB9OwoKCiAgLyoKICAgUmV0dXJuIHN0YXRlIHdpdGggbGVuZ3RoIGFuZCBkaXN0YW5jZSBkZWNvZGluZyB0YWJsZXMgYW5kIGluZGV4IHNpemVzIHNldCB0bwogICBmaXhlZCBjb2RlIGRlY29kaW5nLiAgTm9ybWFsbHkgdGhpcyByZXR1cm5zIGZpeGVkIHRhYmxlcyBmcm9tIGluZmZpeGVkLmguCiAgIElmIEJVSUxERklYRUQgaXMgZGVmaW5lZCwgdGhlbiBpbnN0ZWFkIHRoaXMgcm91dGluZSBidWlsZHMgdGhlIHRhYmxlcyB0aGUKICAgZmlyc3QgdGltZSBpdCdzIGNhbGxlZCwgYW5kIHJldHVybnMgdGhvc2UgdGFibGVzIHRoZSBmaXJzdCB0aW1lIGFuZAogICB0aGVyZWFmdGVyLiAgVGhpcyByZWR1Y2VzIHRoZSBzaXplIG9mIHRoZSBjb2RlIGJ5IGFib3V0IDJLIGJ5dGVzLCBpbgogICBleGNoYW5nZSBmb3IgYSBsaXR0bGUgZXhlY3V0aW9uIHRpbWUuICBIb3dldmVyLCBCVUlMREZJWEVEIHNob3VsZCBub3QgYmUKICAgdXNlZCBmb3IgdGhyZWFkZWQgYXBwbGljYXRpb25zLCBzaW5jZSB0aGUgcmV3cml0aW5nIG9mIHRoZSB0YWJsZXMgYW5kIHZpcmdpbgogICBtYXkgbm90IGJlIHRocmVhZC1zYWZlLgogICAqLwogIGxldCB2aXJnaW4gPSB0cnVlOwoKICBsZXQgbGVuZml4LCBkaXN0Zml4OyAvLyBXZSBoYXZlIG5vIHBvaW50ZXJzIGluIEpTLCBzbyBrZWVwIHRhYmxlcyBzZXBhcmF0ZQoKCiAgY29uc3QgZml4ZWR0YWJsZXMgPSAoc3RhdGUpID0+IHsKCiAgICAvKiBidWlsZCBmaXhlZCBodWZmbWFuIHRhYmxlcyBpZiBmaXJzdCBjYWxsIChtYXkgbm90IGJlIHRocmVhZCBzYWZlKSAqLwogICAgaWYgKHZpcmdpbikgewogICAgICBsZW5maXggPSBuZXcgSW50MzJBcnJheSg1MTIpOwogICAgICBkaXN0Zml4ID0gbmV3IEludDMyQXJyYXkoMzIpOwoKICAgICAgLyogbGl0ZXJhbC9sZW5ndGggdGFibGUgKi8KICAgICAgbGV0IHN5bSA9IDA7CiAgICAgIHdoaWxlIChzeW0gPCAxNDQpIHsgc3RhdGUubGVuc1tzeW0rK10gPSA4OyB9CiAgICAgIHdoaWxlIChzeW0gPCAyNTYpIHsgc3RhdGUubGVuc1tzeW0rK10gPSA5OyB9CiAgICAgIHdoaWxlIChzeW0gPCAyODApIHsgc3RhdGUubGVuc1tzeW0rK10gPSA3OyB9CiAgICAgIHdoaWxlIChzeW0gPCAyODgpIHsgc3RhdGUubGVuc1tzeW0rK10gPSA4OyB9CgogICAgICBpbmZ0cmVlcyhMRU5TLCAgc3RhdGUubGVucywgMCwgMjg4LCBsZW5maXgsICAgMCwgc3RhdGUud29yaywgeyBiaXRzOiA5IH0pOwoKICAgICAgLyogZGlzdGFuY2UgdGFibGUgKi8KICAgICAgc3ltID0gMDsKICAgICAgd2hpbGUgKHN5bSA8IDMyKSB7IHN0YXRlLmxlbnNbc3ltKytdID0gNTsgfQoKICAgICAgaW5mdHJlZXMoRElTVFMsIHN0YXRlLmxlbnMsIDAsIDMyLCAgIGRpc3RmaXgsIDAsIHN0YXRlLndvcmssIHsgYml0czogNSB9KTsKCiAgICAgIC8qIGRvIHRoaXMganVzdCBvbmNlICovCiAgICAgIHZpcmdpbiA9IGZhbHNlOwogICAgfQoKICAgIHN0YXRlLmxlbmNvZGUgPSBsZW5maXg7CiAgICBzdGF0ZS5sZW5iaXRzID0gOTsKICAgIHN0YXRlLmRpc3Rjb2RlID0gZGlzdGZpeDsKICAgIHN0YXRlLmRpc3RiaXRzID0gNTsKICB9OwoKCiAgLyoKICAgVXBkYXRlIHRoZSB3aW5kb3cgd2l0aCB0aGUgbGFzdCB3c2l6ZSAobm9ybWFsbHkgMzJLKSBieXRlcyB3cml0dGVuIGJlZm9yZQogICByZXR1cm5pbmcuICBJZiB3aW5kb3cgZG9lcyBub3QgZXhpc3QgeWV0LCBjcmVhdGUgaXQuICBUaGlzIGlzIG9ubHkgY2FsbGVkCiAgIHdoZW4gYSB3aW5kb3cgaXMgYWxyZWFkeSBpbiB1c2UsIG9yIHdoZW4gb3V0cHV0IGhhcyBiZWVuIHdyaXR0ZW4gZHVyaW5nIHRoaXMKICAgaW5mbGF0ZSBjYWxsLCBidXQgdGhlIGVuZCBvZiB0aGUgZGVmbGF0ZSBzdHJlYW0gaGFzIG5vdCBiZWVuIHJlYWNoZWQgeWV0LgogICBJdCBpcyBhbHNvIGNhbGxlZCB0byBjcmVhdGUgYSB3aW5kb3cgZm9yIGRpY3Rpb25hcnkgZGF0YSB3aGVuIGEgZGljdGlvbmFyeQogICBpcyBsb2FkZWQuCgogICBQcm92aWRpbmcgb3V0cHV0IGJ1ZmZlcnMgbGFyZ2VyIHRoYW4gMzJLIHRvIGluZmxhdGUoKSBzaG91bGQgcHJvdmlkZSBhIHNwZWVkCiAgIGFkdmFudGFnZSwgc2luY2Ugb25seSB0aGUgbGFzdCAzMksgb2Ygb3V0cHV0IGlzIGNvcGllZCB0byB0aGUgc2xpZGluZyB3aW5kb3cKICAgdXBvbiByZXR1cm4gZnJvbSBpbmZsYXRlKCksIGFuZCBzaW5jZSBhbGwgZGlzdGFuY2VzIGFmdGVyIHRoZSBmaXJzdCAzMksgb2YKICAgb3V0cHV0IHdpbGwgZmFsbCBpbiB0aGUgb3V0cHV0IGRhdGEsIG1ha2luZyBtYXRjaCBjb3BpZXMgc2ltcGxlciBhbmQgZmFzdGVyLgogICBUaGUgYWR2YW50YWdlIG1heSBiZSBkZXBlbmRlbnQgb24gdGhlIHNpemUgb2YgdGhlIHByb2Nlc3NvcidzIGRhdGEgY2FjaGVzLgogICAqLwogIGNvbnN0IHVwZGF0ZXdpbmRvdyA9IChzdHJtLCBzcmMsIGVuZCwgY29weSkgPT4gewoKICAgIGxldCBkaXN0OwogICAgY29uc3Qgc3RhdGUgPSBzdHJtLnN0YXRlOwoKICAgIC8qIGlmIGl0IGhhc24ndCBiZWVuIGRvbmUgYWxyZWFkeSwgYWxsb2NhdGUgc3BhY2UgZm9yIHRoZSB3aW5kb3cgKi8KICAgIGlmIChzdGF0ZS53aW5kb3cgPT09IG51bGwpIHsKICAgICAgc3RhdGUud3NpemUgPSAxIDw8IHN0YXRlLndiaXRzOwogICAgICBzdGF0ZS53bmV4dCA9IDA7CiAgICAgIHN0YXRlLndoYXZlID0gMDsKCiAgICAgIHN0YXRlLndpbmRvdyA9IG5ldyBVaW50OEFycmF5KHN0YXRlLndzaXplKTsKICAgIH0KCiAgICAvKiBjb3B5IHN0YXRlLT53c2l6ZSBvciBsZXNzIG91dHB1dCBieXRlcyBpbnRvIHRoZSBjaXJjdWxhciB3aW5kb3cgKi8KICAgIGlmIChjb3B5ID49IHN0YXRlLndzaXplKSB7CiAgICAgIHN0YXRlLndpbmRvdy5zZXQoc3JjLnN1YmFycmF5KGVuZCAtIHN0YXRlLndzaXplLCBlbmQpLCAwKTsKICAgICAgc3RhdGUud25leHQgPSAwOwogICAgICBzdGF0ZS53aGF2ZSA9IHN0YXRlLndzaXplOwogICAgfQogICAgZWxzZSB7CiAgICAgIGRpc3QgPSBzdGF0ZS53c2l6ZSAtIHN0YXRlLnduZXh0OwogICAgICBpZiAoZGlzdCA+IGNvcHkpIHsKICAgICAgICBkaXN0ID0gY29weTsKICAgICAgfQogICAgICAvL3ptZW1jcHkoc3RhdGUtPndpbmRvdyArIHN0YXRlLT53bmV4dCwgZW5kIC0gY29weSwgZGlzdCk7CiAgICAgIHN0YXRlLndpbmRvdy5zZXQoc3JjLnN1YmFycmF5KGVuZCAtIGNvcHksIGVuZCAtIGNvcHkgKyBkaXN0KSwgc3RhdGUud25leHQpOwogICAgICBjb3B5IC09IGRpc3Q7CiAgICAgIGlmIChjb3B5KSB7CiAgICAgICAgLy96bWVtY3B5KHN0YXRlLT53aW5kb3csIGVuZCAtIGNvcHksIGNvcHkpOwogICAgICAgIHN0YXRlLndpbmRvdy5zZXQoc3JjLnN1YmFycmF5KGVuZCAtIGNvcHksIGVuZCksIDApOwogICAgICAgIHN0YXRlLnduZXh0ID0gY29weTsKICAgICAgICBzdGF0ZS53aGF2ZSA9IHN0YXRlLndzaXplOwogICAgICB9CiAgICAgIGVsc2UgewogICAgICAgIHN0YXRlLnduZXh0ICs9IGRpc3Q7CiAgICAgICAgaWYgKHN0YXRlLnduZXh0ID09PSBzdGF0ZS53c2l6ZSkgeyBzdGF0ZS53bmV4dCA9IDA7IH0KICAgICAgICBpZiAoc3RhdGUud2hhdmUgPCBzdGF0ZS53c2l6ZSkgeyBzdGF0ZS53aGF2ZSArPSBkaXN0OyB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAwOwogIH07CgoKICBjb25zdCBpbmZsYXRlJDIgPSAoc3RybSwgZmx1c2gpID0+IHsKCiAgICBsZXQgc3RhdGU7CiAgICBsZXQgaW5wdXQsIG91dHB1dDsgICAgICAgICAgLy8gaW5wdXQvb3V0cHV0IGJ1ZmZlcnMKICAgIGxldCBuZXh0OyAgICAgICAgICAgICAgICAgICAvKiBuZXh0IGlucHV0IElOREVYICovCiAgICBsZXQgcHV0OyAgICAgICAgICAgICAgICAgICAgLyogbmV4dCBvdXRwdXQgSU5ERVggKi8KICAgIGxldCBoYXZlLCBsZWZ0OyAgICAgICAgICAgICAvKiBhdmFpbGFibGUgaW5wdXQgYW5kIG91dHB1dCAqLwogICAgbGV0IGhvbGQ7ICAgICAgICAgICAgICAgICAgIC8qIGJpdCBidWZmZXIgKi8KICAgIGxldCBiaXRzOyAgICAgICAgICAgICAgICAgICAvKiBiaXRzIGluIGJpdCBidWZmZXIgKi8KICAgIGxldCBfaW4sIF9vdXQ7ICAgICAgICAgICAgICAvKiBzYXZlIHN0YXJ0aW5nIGF2YWlsYWJsZSBpbnB1dCBhbmQgb3V0cHV0ICovCiAgICBsZXQgY29weTsgICAgICAgICAgICAgICAgICAgLyogbnVtYmVyIG9mIHN0b3JlZCBvciBtYXRjaCBieXRlcyB0byBjb3B5ICovCiAgICBsZXQgZnJvbTsgICAgICAgICAgICAgICAgICAgLyogd2hlcmUgdG8gY29weSBtYXRjaCBieXRlcyBmcm9tICovCiAgICBsZXQgZnJvbV9zb3VyY2U7CiAgICBsZXQgaGVyZSA9IDA7ICAgICAgICAgICAgICAgLyogY3VycmVudCBkZWNvZGluZyB0YWJsZSBlbnRyeSAqLwogICAgbGV0IGhlcmVfYml0cywgaGVyZV9vcCwgaGVyZV92YWw7IC8vIHBha2VkICJoZXJlIiBkZW5vcm1hbGl6ZWQgKEpTIHNwZWNpZmljKQogICAgLy9sZXQgbGFzdDsgICAgICAgICAgICAgICAgICAgLyogcGFyZW50IHRhYmxlIGVudHJ5ICovCiAgICBsZXQgbGFzdF9iaXRzLCBsYXN0X29wLCBsYXN0X3ZhbDsgLy8gcGFrZWQgImxhc3QiIGRlbm9ybWFsaXplZCAoSlMgc3BlY2lmaWMpCiAgICBsZXQgbGVuOyAgICAgICAgICAgICAgICAgICAgLyogbGVuZ3RoIHRvIGNvcHkgZm9yIHJlcGVhdHMsIGJpdHMgdG8gZHJvcCAqLwogICAgbGV0IHJldDsgICAgICAgICAgICAgICAgICAgIC8qIHJldHVybiBjb2RlICovCiAgICBjb25zdCBoYnVmID0gbmV3IFVpbnQ4QXJyYXkoNCk7ICAgIC8qIGJ1ZmZlciBmb3IgZ3ppcCBoZWFkZXIgY3JjIGNhbGN1bGF0aW9uICovCiAgICBsZXQgb3B0czsKCiAgICBsZXQgbjsgLy8gdGVtcG9yYXJ5IHZhcmlhYmxlIGZvciBORUVEX0JJVFMKCiAgICBjb25zdCBvcmRlciA9IC8qIHBlcm11dGF0aW9uIG9mIGNvZGUgbGVuZ3RocyAqLwogICAgICBuZXcgVWludDhBcnJheShbIDE2LCAxNywgMTgsIDAsIDgsIDcsIDksIDYsIDEwLCA1LCAxMSwgNCwgMTIsIDMsIDEzLCAyLCAxNCwgMSwgMTUgXSk7CgoKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSB8fCAhc3RybS5vdXRwdXQgfHwKICAgICAgICAoIXN0cm0uaW5wdXQgJiYgc3RybS5hdmFpbF9pbiAhPT0gMCkpIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7CiAgICB9CgogICAgc3RhdGUgPSBzdHJtLnN0YXRlOwogICAgaWYgKHN0YXRlLm1vZGUgPT09IFRZUEUpIHsgc3RhdGUubW9kZSA9IFRZUEVETzsgfSAgICAvKiBza2lwIGNoZWNrICovCgoKICAgIC8vLS0tIExPQUQoKSAtLS0KICAgIHB1dCA9IHN0cm0ubmV4dF9vdXQ7CiAgICBvdXRwdXQgPSBzdHJtLm91dHB1dDsKICAgIGxlZnQgPSBzdHJtLmF2YWlsX291dDsKICAgIG5leHQgPSBzdHJtLm5leHRfaW47CiAgICBpbnB1dCA9IHN0cm0uaW5wdXQ7CiAgICBoYXZlID0gc3RybS5hdmFpbF9pbjsKICAgIGhvbGQgPSBzdGF0ZS5ob2xkOwogICAgYml0cyA9IHN0YXRlLmJpdHM7CiAgICAvLy0tLQoKICAgIF9pbiA9IGhhdmU7CiAgICBfb3V0ID0gbGVmdDsKICAgIHJldCA9IFpfT0skMTsKCiAgICBpbmZfbGVhdmU6IC8vIGdvdG8gZW11bGF0aW9uCiAgICBmb3IgKDs7KSB7CiAgICAgIHN3aXRjaCAoc3RhdGUubW9kZSkgewogICAgICAgIGNhc2UgSEVBRDoKICAgICAgICAgIGlmIChzdGF0ZS53cmFwID09PSAwKSB7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFRE87CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgLy89PT0gTkVFREJJVFMoMTYpOwogICAgICAgICAgd2hpbGUgKGJpdHMgPCAxNikgewogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgfQogICAgICAgICAgLy89PT0vLwogICAgICAgICAgaWYgKChzdGF0ZS53cmFwICYgMikgJiYgaG9sZCA9PT0gMHg4YjFmKSB7ICAvKiBnemlwIGhlYWRlciAqLwogICAgICAgICAgICBzdGF0ZS5jaGVjayA9IDAvKmNyYzMyKDBMLCBaX05VTEwsIDApKi87CiAgICAgICAgICAgIC8vPT09IENSQzIoc3RhdGUuY2hlY2ssIGhvbGQpOwogICAgICAgICAgICBoYnVmWzBdID0gaG9sZCAmIDB4ZmY7CiAgICAgICAgICAgIGhidWZbMV0gPSAoaG9sZCA+Pj4gOCkgJiAweGZmOwogICAgICAgICAgICBzdGF0ZS5jaGVjayA9IGNyYzMyXzEoc3RhdGUuY2hlY2ssIGhidWYsIDIsIDApOwogICAgICAgICAgICAvLz09PS8vCgogICAgICAgICAgICAvLz09PSBJTklUQklUUygpOwogICAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgc3RhdGUubW9kZSA9IEZMQUdTOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHN0YXRlLmZsYWdzID0gMDsgICAgICAgICAgIC8qIGV4cGVjdCB6bGliIGhlYWRlciAqLwogICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC5kb25lID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIShzdGF0ZS53cmFwICYgMSkgfHwgICAvKiBjaGVjayBpZiB6bGliIGhlYWRlciBhbGxvd2VkICovCiAgICAgICAgICAgICgoKGhvbGQgJiAweGZmKS8qQklUUyg4KSovIDw8IDgpICsgKGhvbGQgPj4gOCkpICUgMzEpIHsKICAgICAgICAgICAgc3RybS5tc2cgPSAnaW5jb3JyZWN0IGhlYWRlciBjaGVjayc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKChob2xkICYgMHgwZikvKkJJVFMoNCkqLyAhPT0gWl9ERUZMQVRFRCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICd1bmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgLy8tLS0gRFJPUEJJVFMoNCkgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSA0OwogICAgICAgICAgYml0cyAtPSA0OwogICAgICAgICAgLy8tLS0vLwogICAgICAgICAgbGVuID0gKGhvbGQgJiAweDBmKS8qQklUUyg0KSovICsgODsKICAgICAgICAgIGlmIChzdGF0ZS53Yml0cyA9PT0gMCkgewogICAgICAgICAgICBzdGF0ZS53Yml0cyA9IGxlbjsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgaWYgKGxlbiA+IHN0YXRlLndiaXRzKSB7CiAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgd2luZG93IHNpemUnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyAhISEgcGFrbyBwYXRjaC4gRm9yY2UgdXNlIGBvcHRpb25zLndpbmRvd0JpdHNgIGlmIHBhc3NlZC4KICAgICAgICAgIC8vIFJlcXVpcmVkIHRvIGFsd2F5cyB1c2UgbWF4IHdpbmRvdyBzaXplIGJ5IGRlZmF1bHQuCiAgICAgICAgICBzdGF0ZS5kbWF4ID0gMSA8PCBzdGF0ZS53Yml0czsKICAgICAgICAgIC8vc3RhdGUuZG1heCA9IDEgPDwgbGVuOwoKICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgIHpsaWIgaGVhZGVyIG9rXG4iKSk7CiAgICAgICAgICBzdHJtLmFkbGVyID0gc3RhdGUuY2hlY2sgPSAxLyphZGxlcjMyKDBMLCBaX05VTEwsIDApKi87CiAgICAgICAgICBzdGF0ZS5tb2RlID0gaG9sZCAmIDB4MjAwID8gRElDVElEIDogVFlQRTsKICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgLy89PT0vLwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBGTEFHUzoKICAgICAgICAgIC8vPT09IE5FRURCSVRTKDE2KTsgKi8KICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgIH0KICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIHN0YXRlLmZsYWdzID0gaG9sZDsKICAgICAgICAgIGlmICgoc3RhdGUuZmxhZ3MgJiAweGZmKSAhPT0gWl9ERUZMQVRFRCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICd1bmtub3duIGNvbXByZXNzaW9uIG1ldGhvZCc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMHhlMDAwKSB7CiAgICAgICAgICAgIHN0cm0ubXNnID0gJ3Vua25vd24gaGVhZGVyIGZsYWdzIHNldCc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC50ZXh0ID0gKChob2xkID4+IDgpICYgMSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDAyMDApIHsKICAgICAgICAgICAgLy89PT0gQ1JDMihzdGF0ZS5jaGVjaywgaG9sZCk7CiAgICAgICAgICAgIGhidWZbMF0gPSBob2xkICYgMHhmZjsKICAgICAgICAgICAgaGJ1ZlsxXSA9IChob2xkID4+PiA4KSAmIDB4ZmY7CiAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzJfMShzdGF0ZS5jaGVjaywgaGJ1ZiwgMiwgMCk7CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIH0KICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgLy89PT0vLwogICAgICAgICAgc3RhdGUubW9kZSA9IFRJTUU7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBUSU1FOgogICAgICAgICAgLy89PT0gTkVFREJJVFMoMzIpOyAqLwogICAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgfQogICAgICAgICAgLy89PT0vLwogICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC50aW1lID0gaG9sZDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgICAvLz09PSBDUkM0KHN0YXRlLmNoZWNrLCBob2xkKQogICAgICAgICAgICBoYnVmWzBdID0gaG9sZCAmIDB4ZmY7CiAgICAgICAgICAgIGhidWZbMV0gPSAoaG9sZCA+Pj4gOCkgJiAweGZmOwogICAgICAgICAgICBoYnVmWzJdID0gKGhvbGQgPj4+IDE2KSAmIDB4ZmY7CiAgICAgICAgICAgIGhidWZbM10gPSAoaG9sZCA+Pj4gMjQpICYgMHhmZjsKICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBoYnVmLCA0LCAwKTsKICAgICAgICAgICAgLy89PT0KICAgICAgICAgIH0KICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICBob2xkID0gMDsKICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgLy89PT0vLwogICAgICAgICAgc3RhdGUubW9kZSA9IE9TOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgT1M6CiAgICAgICAgICAvLz09PSBORUVEQklUUygxNik7ICovCiAgICAgICAgICB3aGlsZSAoYml0cyA8IDE2KSB7CiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICBzdGF0ZS5oZWFkLnhmbGFncyA9IChob2xkICYgMHhmZik7CiAgICAgICAgICAgIHN0YXRlLmhlYWQub3MgPSAoaG9sZCA+PiA4KTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgICAvLz09PSBDUkMyKHN0YXRlLmNoZWNrLCBob2xkKTsKICAgICAgICAgICAgaGJ1ZlswXSA9IGhvbGQgJiAweGZmOwogICAgICAgICAgICBoYnVmWzFdID0gKGhvbGQgPj4+IDgpICYgMHhmZjsKICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBoYnVmLCAyLCAwKTsKICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgfQogICAgICAgICAgLy89PT0gSU5JVEJJVFMoKTsKICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBzdGF0ZS5tb2RlID0gRVhMRU47CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBFWExFTjoKICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDQwMCkgewogICAgICAgICAgICAvLz09PSBORUVEQklUUygxNik7ICovCiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgc3RhdGUubGVuZ3RoID0gaG9sZDsKICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmV4dHJhX2xlbiA9IGhvbGQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMHgwMjAwKSB7CiAgICAgICAgICAgICAgLy89PT0gQ1JDMihzdGF0ZS5jaGVjaywgaG9sZCk7CiAgICAgICAgICAgICAgaGJ1ZlswXSA9IGhvbGQgJiAweGZmOwogICAgICAgICAgICAgIGhidWZbMV0gPSAoaG9sZCA+Pj4gOCkgJiAweGZmOwogICAgICAgICAgICAgIHN0YXRlLmNoZWNrID0gY3JjMzJfMShzdGF0ZS5jaGVjaywgaGJ1ZiwgMiwgMCk7CiAgICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICBzdGF0ZS5oZWFkLmV4dHJhID0gbnVsbC8qWl9OVUxMKi87CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5tb2RlID0gRVhUUkE7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBFWFRSQToKICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDQwMCkgewogICAgICAgICAgICBjb3B5ID0gc3RhdGUubGVuZ3RoOwogICAgICAgICAgICBpZiAoY29weSA+IGhhdmUpIHsgY29weSA9IGhhdmU7IH0KICAgICAgICAgICAgaWYgKGNvcHkpIHsKICAgICAgICAgICAgICBpZiAoc3RhdGUuaGVhZCkgewogICAgICAgICAgICAgICAgbGVuID0gc3RhdGUuaGVhZC5leHRyYV9sZW4gLSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICAgICAgICBpZiAoIXN0YXRlLmhlYWQuZXh0cmEpIHsKICAgICAgICAgICAgICAgICAgLy8gVXNlIHVudHlwZWQgYXJyYXkgZm9yIG1vcmUgY29udmVuaWVudCBwcm9jZXNzaW5nIGxhdGVyCiAgICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQuZXh0cmEgPSBuZXcgVWludDhBcnJheShzdGF0ZS5oZWFkLmV4dHJhX2xlbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdGF0ZS5oZWFkLmV4dHJhLnNldCgKICAgICAgICAgICAgICAgICAgaW5wdXQuc3ViYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgbmV4dCwKICAgICAgICAgICAgICAgICAgICAvLyBleHRyYSBmaWVsZCBpcyBsaW1pdGVkIHRvIDY1NTM2IGJ5dGVzCiAgICAgICAgICAgICAgICAgICAgLy8gLSBubyBuZWVkIGZvciBhZGRpdGlvbmFsIHNpemUgY2hlY2sKICAgICAgICAgICAgICAgICAgICBuZXh0ICsgY29weQogICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAvKmxlbiArIGNvcHkgPiBzdGF0ZS5oZWFkLmV4dHJhX21heCAtIGxlbiA/IHN0YXRlLmhlYWQuZXh0cmFfbWF4IDogY29weSwqLwogICAgICAgICAgICAgICAgICBsZW4KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAvL3ptZW1jcHkoc3RhdGUuaGVhZC5leHRyYSArIGxlbiwgbmV4dCwKICAgICAgICAgICAgICAgIC8vICAgICAgICBsZW4gKyBjb3B5ID4gc3RhdGUuaGVhZC5leHRyYV9tYXggPwogICAgICAgICAgICAgICAgLy8gICAgICAgIHN0YXRlLmhlYWQuZXh0cmFfbWF4IC0gbGVuIDogY29weSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBpbnB1dCwgY29weSwgbmV4dCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgICAgICBuZXh0ICs9IGNvcHk7CiAgICAgICAgICAgICAgc3RhdGUubGVuZ3RoIC09IGNvcHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN0YXRlLmxlbmd0aCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgIH0KICAgICAgICAgIHN0YXRlLmxlbmd0aCA9IDA7CiAgICAgICAgICBzdGF0ZS5tb2RlID0gTkFNRTsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIE5BTUU6CiAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDA4MDApIHsKICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIGNvcHkgPSAwOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgLy8gVE9ETzogMiBvciAxIGJ5dGVzPwogICAgICAgICAgICAgIGxlbiA9IGlucHV0W25leHQgKyBjb3B5KytdOwogICAgICAgICAgICAgIC8qIHVzZSBjb25zdGFudCBsaW1pdCBiZWNhdXNlIGluIGpzIHdlIHNob3VsZCBub3QgcHJlYWxsb2NhdGUgbWVtb3J5ICovCiAgICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQgJiYgbGVuICYmCiAgICAgICAgICAgICAgICAgIChzdGF0ZS5sZW5ndGggPCA2NTUzNiAvKnN0YXRlLmhlYWQubmFtZV9tYXgqLykpIHsKICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQubmFtZSArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGxlbik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IHdoaWxlIChsZW4gJiYgY29weSA8IGhhdmUpOwoKICAgICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMHgwMjAwKSB7CiAgICAgICAgICAgICAgc3RhdGUuY2hlY2sgPSBjcmMzMl8xKHN0YXRlLmNoZWNrLCBpbnB1dCwgY29weSwgbmV4dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaGF2ZSAtPSBjb3B5OwogICAgICAgICAgICBuZXh0ICs9IGNvcHk7CiAgICAgICAgICAgIGlmIChsZW4pIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIGlmIChzdGF0ZS5oZWFkKSB7CiAgICAgICAgICAgIHN0YXRlLmhlYWQubmFtZSA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5sZW5ndGggPSAwOwogICAgICAgICAgc3RhdGUubW9kZSA9IENPTU1FTlQ7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBDT01NRU5UOgogICAgICAgICAgaWYgKHN0YXRlLmZsYWdzICYgMHgxMDAwKSB7CiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBjb3B5ID0gMDsKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIGxlbiA9IGlucHV0W25leHQgKyBjb3B5KytdOwogICAgICAgICAgICAgIC8qIHVzZSBjb25zdGFudCBsaW1pdCBiZWNhdXNlIGluIGpzIHdlIHNob3VsZCBub3QgcHJlYWxsb2NhdGUgbWVtb3J5ICovCiAgICAgICAgICAgICAgaWYgKHN0YXRlLmhlYWQgJiYgbGVuICYmCiAgICAgICAgICAgICAgICAgIChzdGF0ZS5sZW5ndGggPCA2NTUzNiAvKnN0YXRlLmhlYWQuY29tbV9tYXgqLykpIHsKICAgICAgICAgICAgICAgIHN0YXRlLmhlYWQuY29tbWVudCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGxlbik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IHdoaWxlIChsZW4gJiYgY29weSA8IGhhdmUpOwogICAgICAgICAgICBpZiAoc3RhdGUuZmxhZ3MgJiAweDAyMDApIHsKICAgICAgICAgICAgICBzdGF0ZS5jaGVjayA9IGNyYzMyXzEoc3RhdGUuY2hlY2ssIGlucHV0LCBjb3B5LCBuZXh0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBoYXZlIC09IGNvcHk7CiAgICAgICAgICAgIG5leHQgKz0gY29weTsKICAgICAgICAgICAgaWYgKGxlbikgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC5jb21tZW50ID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIHN0YXRlLm1vZGUgPSBIQ1JDOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgSENSQzoKICAgICAgICAgIGlmIChzdGF0ZS5mbGFncyAmIDB4MDIwMCkgewogICAgICAgICAgICAvLz09PSBORUVEQklUUygxNik7ICovCiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMTYpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgaWYgKGhvbGQgIT09IChzdGF0ZS5jaGVjayAmIDB4ZmZmZikpIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdoZWFkZXIgY3JjIG1pc21hdGNoJzsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YXRlLmhlYWQpIHsKICAgICAgICAgICAgc3RhdGUuaGVhZC5oY3JjID0gKChzdGF0ZS5mbGFncyA+PiA5KSAmIDEpOwogICAgICAgICAgICBzdGF0ZS5oZWFkLmRvbmUgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgc3RybS5hZGxlciA9IHN0YXRlLmNoZWNrID0gMDsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBESUNUSUQ6CiAgICAgICAgICAvLz09PSBORUVEQklUUygzMik7ICovCiAgICAgICAgICB3aGlsZSAoYml0cyA8IDMyKSB7CiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBzdHJtLmFkbGVyID0gc3RhdGUuY2hlY2sgPSB6c3dhcDMyKGhvbGQpOwogICAgICAgICAgLy89PT0gSU5JVEJJVFMoKTsKICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBzdGF0ZS5tb2RlID0gRElDVDsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIERJQ1Q6CiAgICAgICAgICBpZiAoc3RhdGUuaGF2ZWRpY3QgPT09IDApIHsKICAgICAgICAgICAgLy8tLS0gUkVTVE9SRSgpIC0tLQogICAgICAgICAgICBzdHJtLm5leHRfb3V0ID0gcHV0OwogICAgICAgICAgICBzdHJtLmF2YWlsX291dCA9IGxlZnQ7CiAgICAgICAgICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICAgICAgICAgIHN0cm0uYXZhaWxfaW4gPSBoYXZlOwogICAgICAgICAgICBzdGF0ZS5ob2xkID0gaG9sZDsKICAgICAgICAgICAgc3RhdGUuYml0cyA9IGJpdHM7CiAgICAgICAgICAgIC8vLS0tCiAgICAgICAgICAgIHJldHVybiBaX05FRURfRElDVCQxOwogICAgICAgICAgfQogICAgICAgICAgc3RybS5hZGxlciA9IHN0YXRlLmNoZWNrID0gMS8qYWRsZXIzMigwTCwgWl9OVUxMLCAwKSovOwogICAgICAgICAgc3RhdGUubW9kZSA9IFRZUEU7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBUWVBFOgogICAgICAgICAgaWYgKGZsdXNoID09PSBaX0JMT0NLIHx8IGZsdXNoID09PSBaX1RSRUVTKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgVFlQRURPOgogICAgICAgICAgaWYgKHN0YXRlLmxhc3QpIHsKICAgICAgICAgICAgLy8tLS0gQllURUJJVFMoKSAtLS0vLwogICAgICAgICAgICBob2xkID4+Pj0gYml0cyAmIDc7CiAgICAgICAgICAgIGJpdHMgLT0gYml0cyAmIDc7CiAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgICAgc3RhdGUubW9kZSA9IENIRUNLOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIC8vPT09IE5FRURCSVRTKDMpOyAqLwogICAgICAgICAgd2hpbGUgKGJpdHMgPCAzKSB7CiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICB9CiAgICAgICAgICAvLz09PS8vCiAgICAgICAgICBzdGF0ZS5sYXN0ID0gKGhvbGQgJiAweDAxKS8qQklUUygxKSovOwogICAgICAgICAgLy8tLS0gRFJPUEJJVFMoMSkgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSAxOwogICAgICAgICAgYml0cyAtPSAxOwogICAgICAgICAgLy8tLS0vLwoKICAgICAgICAgIHN3aXRjaCAoKGhvbGQgJiAweDAzKS8qQklUUygyKSovKSB7CiAgICAgICAgICAgIGNhc2UgMDogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIHN0b3JlZCBibG9jayAqLwogICAgICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgc3RvcmVkIGJsb2NrJXNcbiIsCiAgICAgICAgICAgICAgLy8gICAgICAgIHN0YXRlLmxhc3QgPyAiIChsYXN0KSIgOiAiIikpOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBTVE9SRUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGZpeGVkIGJsb2NrICovCiAgICAgICAgICAgICAgZml4ZWR0YWJsZXMoc3RhdGUpOwogICAgICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgZml4ZWQgY29kZXMgYmxvY2slc1xuIiwKICAgICAgICAgICAgICAvLyAgICAgICAgc3RhdGUubGFzdCA/ICIgKGxhc3QpIiA6ICIiKSk7CiAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IExFTl87ICAgICAgICAgICAgIC8qIGRlY29kZSBjb2RlcyAqLwogICAgICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9UUkVFUykgewogICAgICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMoMikgLS0tLy8KICAgICAgICAgICAgICAgIGhvbGQgPj4+PSAyOwogICAgICAgICAgICAgICAgYml0cyAtPSAyOwogICAgICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogZHluYW1pYyBibG9jayAqLwogICAgICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgZHluYW1pYyBjb2RlcyBibG9jayVzXG4iLAogICAgICAgICAgICAgIC8vICAgICAgICBzdGF0ZS5sYXN0ID8gIiAobGFzdCkiIDogIiIpKTsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gVEFCTEU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGJsb2NrIHR5cGUnOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICB9CiAgICAgICAgICAvLy0tLSBEUk9QQklUUygyKSAtLS0vLwogICAgICAgICAgaG9sZCA+Pj49IDI7CiAgICAgICAgICBiaXRzIC09IDI7CiAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFNUT1JFRDoKICAgICAgICAgIC8vLS0tIEJZVEVCSVRTKCkgLS0tLy8gLyogZ28gdG8gYnl0ZSBib3VuZGFyeSAqLwogICAgICAgICAgaG9sZCA+Pj49IGJpdHMgJiA3OwogICAgICAgICAgYml0cyAtPSBiaXRzICYgNzsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIC8vPT09IE5FRURCSVRTKDMyKTsgKi8KICAgICAgICAgIHdoaWxlIChiaXRzIDwgMzIpIHsKICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgIH0KICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIGlmICgoaG9sZCAmIDB4ZmZmZikgIT09ICgoaG9sZCA+Pj4gMTYpIF4gMHhmZmZmKSkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIHN0b3JlZCBibG9jayBsZW5ndGhzJzsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5sZW5ndGggPSBob2xkICYgMHhmZmZmOwogICAgICAgICAgLy9UcmFjZXYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgIHN0b3JlZCBsZW5ndGggJXVcbiIsCiAgICAgICAgICAvLyAgICAgICAgc3RhdGUubGVuZ3RoKSk7CiAgICAgICAgICAvLz09PSBJTklUQklUUygpOwogICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgIHN0YXRlLm1vZGUgPSBDT1BZXzsKICAgICAgICAgIGlmIChmbHVzaCA9PT0gWl9UUkVFUykgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIENPUFlfOgogICAgICAgICAgc3RhdGUubW9kZSA9IENPUFk7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBDT1BZOgogICAgICAgICAgY29weSA9IHN0YXRlLmxlbmd0aDsKICAgICAgICAgIGlmIChjb3B5KSB7CiAgICAgICAgICAgIGlmIChjb3B5ID4gaGF2ZSkgeyBjb3B5ID0gaGF2ZTsgfQogICAgICAgICAgICBpZiAoY29weSA+IGxlZnQpIHsgY29weSA9IGxlZnQ7IH0KICAgICAgICAgICAgaWYgKGNvcHkgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgIC8vLS0tIHptZW1jcHkocHV0LCBuZXh0LCBjb3B5KTsgLS0tCiAgICAgICAgICAgIG91dHB1dC5zZXQoaW5wdXQuc3ViYXJyYXkobmV4dCwgbmV4dCArIGNvcHkpLCBwdXQpOwogICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgIGhhdmUgLT0gY29weTsKICAgICAgICAgICAgbmV4dCArPSBjb3B5OwogICAgICAgICAgICBsZWZ0IC09IGNvcHk7CiAgICAgICAgICAgIHB1dCArPSBjb3B5OwogICAgICAgICAgICBzdGF0ZS5sZW5ndGggLT0gY29weTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICAvL1RyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICAgICAgc3RvcmVkIGVuZFxuIikpOwogICAgICAgICAgc3RhdGUubW9kZSA9IFRZUEU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFRBQkxFOgogICAgICAgICAgLy89PT0gTkVFREJJVFMoMTQpOyAqLwogICAgICAgICAgd2hpbGUgKGJpdHMgPCAxNCkgewogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgfQogICAgICAgICAgLy89PT0vLwogICAgICAgICAgc3RhdGUubmxlbiA9IChob2xkICYgMHgxZikvKkJJVFMoNSkqLyArIDI1NzsKICAgICAgICAgIC8vLS0tIERST1BCSVRTKDUpIC0tLS8vCiAgICAgICAgICBob2xkID4+Pj0gNTsKICAgICAgICAgIGJpdHMgLT0gNTsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLm5kaXN0ID0gKGhvbGQgJiAweDFmKS8qQklUUyg1KSovICsgMTsKICAgICAgICAgIC8vLS0tIERST1BCSVRTKDUpIC0tLS8vCiAgICAgICAgICBob2xkID4+Pj0gNTsKICAgICAgICAgIGJpdHMgLT0gNTsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLm5jb2RlID0gKGhvbGQgJiAweDBmKS8qQklUUyg0KSovICsgNDsKICAgICAgICAgIC8vLS0tIERST1BCSVRTKDQpIC0tLS8vCiAgICAgICAgICBob2xkID4+Pj0gNDsKICAgICAgICAgIGJpdHMgLT0gNDsKICAgICAgICAgIC8vLS0tLy8KICAvLyNpZm5kZWYgUEtaSVBfQlVHX1dPUktBUk9VTkQKICAgICAgICAgIGlmIChzdGF0ZS5ubGVuID4gMjg2IHx8IHN0YXRlLm5kaXN0ID4gMzApIHsKICAgICAgICAgICAgc3RybS5tc2cgPSAndG9vIG1hbnkgbGVuZ3RoIG9yIGRpc3RhbmNlIHN5bWJvbHMnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAvLyNlbmRpZgogICAgICAgICAgLy9UcmFjZXYoKHN0ZGVyciwgImluZmxhdGU6ICAgICAgIHRhYmxlIHNpemVzIG9rXG4iKSk7CiAgICAgICAgICBzdGF0ZS5oYXZlID0gMDsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU5MRU5TOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgTEVOTEVOUzoKICAgICAgICAgIHdoaWxlIChzdGF0ZS5oYXZlIDwgc3RhdGUubmNvZGUpIHsKICAgICAgICAgICAgLy89PT0gTkVFREJJVFMoMyk7CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMykgewogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICBzdGF0ZS5sZW5zW29yZGVyW3N0YXRlLmhhdmUrK11dID0gKGhvbGQgJiAweDA3KTsvL0JJVFMoMyk7CiAgICAgICAgICAgIC8vLS0tIERST1BCSVRTKDMpIC0tLS8vCiAgICAgICAgICAgIGhvbGQgPj4+PSAzOwogICAgICAgICAgICBiaXRzIC09IDM7CiAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIH0KICAgICAgICAgIHdoaWxlIChzdGF0ZS5oYXZlIDwgMTkpIHsKICAgICAgICAgICAgc3RhdGUubGVuc1tvcmRlcltzdGF0ZS5oYXZlKytdXSA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBXZSBoYXZlIHNlcGFyYXRlIHRhYmxlcyAmIG5vIHBvaW50ZXJzLiAyIGNvbW1lbnRlZCBsaW5lcyBiZWxvdyBub3QgbmVlZGVkLgogICAgICAgICAgLy9zdGF0ZS5uZXh0ID0gc3RhdGUuY29kZXM7CiAgICAgICAgICAvL3N0YXRlLmxlbmNvZGUgPSBzdGF0ZS5uZXh0OwogICAgICAgICAgLy8gU3dpdGNoIHRvIHVzZSBkeW5hbWljIHRhYmxlCiAgICAgICAgICBzdGF0ZS5sZW5jb2RlID0gc3RhdGUubGVuZHluOwogICAgICAgICAgc3RhdGUubGVuYml0cyA9IDc7CgogICAgICAgICAgb3B0cyA9IHsgYml0czogc3RhdGUubGVuYml0cyB9OwogICAgICAgICAgcmV0ID0gaW5mdHJlZXMoQ09ERVMsIHN0YXRlLmxlbnMsIDAsIDE5LCBzdGF0ZS5sZW5jb2RlLCAwLCBzdGF0ZS53b3JrLCBvcHRzKTsKICAgICAgICAgIHN0YXRlLmxlbmJpdHMgPSBvcHRzLmJpdHM7CgogICAgICAgICAgaWYgKHJldCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGNvZGUgbGVuZ3RocyBzZXQnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICBjb2RlIGxlbmd0aHMgb2tcbiIpKTsKICAgICAgICAgIHN0YXRlLmhhdmUgPSAwOwogICAgICAgICAgc3RhdGUubW9kZSA9IENPREVMRU5TOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgQ09ERUxFTlM6CiAgICAgICAgICB3aGlsZSAoc3RhdGUuaGF2ZSA8IHN0YXRlLm5sZW4gKyBzdGF0ZS5uZGlzdCkgewogICAgICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICAgICAgaGVyZSA9IHN0YXRlLmxlbmNvZGVbaG9sZCAmICgoMSA8PCBzdGF0ZS5sZW5iaXRzKSAtIDEpXTsvKkJJVFMoc3RhdGUubGVuYml0cykqLwogICAgICAgICAgICAgIGhlcmVfYml0cyA9IGhlcmUgPj4+IDI0OwogICAgICAgICAgICAgIGhlcmVfb3AgPSAoaGVyZSA+Pj4gMTYpICYgMHhmZjsKICAgICAgICAgICAgICBoZXJlX3ZhbCA9IGhlcmUgJiAweGZmZmY7CgogICAgICAgICAgICAgIGlmICgoaGVyZV9iaXRzKSA8PSBiaXRzKSB7IGJyZWFrOyB9CiAgICAgICAgICAgICAgLy8tLS0gUFVMTEJZVEUoKSAtLS0vLwogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoZXJlX3ZhbCA8IDE2KSB7CiAgICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMoaGVyZS5iaXRzKSAtLS0vLwogICAgICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgYml0cyAtPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICAgIHN0YXRlLmxlbnNbc3RhdGUuaGF2ZSsrXSA9IGhlcmVfdmFsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGlmIChoZXJlX3ZhbCA9PT0gMTYpIHsKICAgICAgICAgICAgICAgIC8vPT09IE5FRURCSVRTKGhlcmUuYml0cyArIDIpOwogICAgICAgICAgICAgICAgbiA9IGhlcmVfYml0cyArIDI7CiAgICAgICAgICAgICAgICB3aGlsZSAoYml0cyA8IG4pIHsKICAgICAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICAgICAgaG9sZCArPSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgICAgIC8vLS0tIERST1BCSVRTKGhlcmUuYml0cykgLS0tLy8KICAgICAgICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5oYXZlID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgYml0IGxlbmd0aCByZXBlYXQnOwogICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxlbiA9IHN0YXRlLmxlbnNbc3RhdGUuaGF2ZSAtIDFdOwogICAgICAgICAgICAgICAgY29weSA9IDMgKyAoaG9sZCAmIDB4MDMpOy8vQklUUygyKTsKICAgICAgICAgICAgICAgIC8vLS0tIERST1BCSVRTKDIpIC0tLS8vCiAgICAgICAgICAgICAgICBob2xkID4+Pj0gMjsKICAgICAgICAgICAgICAgIGJpdHMgLT0gMjsKICAgICAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSBpZiAoaGVyZV92YWwgPT09IDE3KSB7CiAgICAgICAgICAgICAgICAvLz09PSBORUVEQklUUyhoZXJlLmJpdHMgKyAzKTsKICAgICAgICAgICAgICAgIG4gPSBoZXJlX2JpdHMgKyAzOwogICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCBuKSB7CiAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLz09PS8vCiAgICAgICAgICAgICAgICAvLy0tLSBEUk9QQklUUyhoZXJlLmJpdHMpIC0tLS8vCiAgICAgICAgICAgICAgICBob2xkID4+Pj0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgYml0cyAtPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgICAgICBsZW4gPSAwOwogICAgICAgICAgICAgICAgY29weSA9IDMgKyAoaG9sZCAmIDB4MDcpOy8vQklUUygzKTsKICAgICAgICAgICAgICAgIC8vLS0tIERST1BCSVRTKDMpIC0tLS8vCiAgICAgICAgICAgICAgICBob2xkID4+Pj0gMzsKICAgICAgICAgICAgICAgIGJpdHMgLT0gMzsKICAgICAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLz09PSBORUVEQklUUyhoZXJlLmJpdHMgKyA3KTsKICAgICAgICAgICAgICAgIG4gPSBoZXJlX2JpdHMgKyA3OwogICAgICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCBuKSB7CiAgICAgICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLz09PS8vCiAgICAgICAgICAgICAgICAvLy0tLSBEUk9QQklUUyhoZXJlLmJpdHMpIC0tLS8vCiAgICAgICAgICAgICAgICBob2xkID4+Pj0gaGVyZV9iaXRzOwogICAgICAgICAgICAgICAgYml0cyAtPSBoZXJlX2JpdHM7CiAgICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgICAgICBsZW4gPSAwOwogICAgICAgICAgICAgICAgY29weSA9IDExICsgKGhvbGQgJiAweDdmKTsvL0JJVFMoNyk7CiAgICAgICAgICAgICAgICAvLy0tLSBEUk9QQklUUyg3KSAtLS0vLwogICAgICAgICAgICAgICAgaG9sZCA+Pj49IDc7CiAgICAgICAgICAgICAgICBiaXRzIC09IDc7CiAgICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzdGF0ZS5oYXZlICsgY29weSA+IHN0YXRlLm5sZW4gKyBzdGF0ZS5uZGlzdCkgewogICAgICAgICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBiaXQgbGVuZ3RoIHJlcGVhdCc7CiAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHdoaWxlIChjb3B5LS0pIHsKICAgICAgICAgICAgICAgIHN0YXRlLmxlbnNbc3RhdGUuaGF2ZSsrXSA9IGxlbjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvKiBoYW5kbGUgZXJyb3IgYnJlYWtzIGluIHdoaWxlICovCiAgICAgICAgICBpZiAoc3RhdGUubW9kZSA9PT0gQkFEKSB7IGJyZWFrOyB9CgogICAgICAgICAgLyogY2hlY2sgZm9yIGVuZC1vZi1ibG9jayBjb2RlIChiZXR0ZXIgaGF2ZSBvbmUpICovCiAgICAgICAgICBpZiAoc3RhdGUubGVuc1syNTZdID09PSAwKSB7CiAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgY29kZSAtLSBtaXNzaW5nIGVuZC1vZi1ibG9jayc7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIC8qIGJ1aWxkIGNvZGUgdGFibGVzIC0tIG5vdGU6IGRvIG5vdCBjaGFuZ2UgdGhlIGxlbmJpdHMgb3IgZGlzdGJpdHMKICAgICAgICAgICAgIHZhbHVlcyBoZXJlICg5IGFuZCA2KSB3aXRob3V0IHJlYWRpbmcgdGhlIGNvbW1lbnRzIGluIGluZnRyZWVzLmgKICAgICAgICAgICAgIGNvbmNlcm5pbmcgdGhlIEVOT1VHSCBjb25zdGFudHMsIHdoaWNoIGRlcGVuZCBvbiB0aG9zZSB2YWx1ZXMgKi8KICAgICAgICAgIHN0YXRlLmxlbmJpdHMgPSA5OwoKICAgICAgICAgIG9wdHMgPSB7IGJpdHM6IHN0YXRlLmxlbmJpdHMgfTsKICAgICAgICAgIHJldCA9IGluZnRyZWVzKExFTlMsIHN0YXRlLmxlbnMsIDAsIHN0YXRlLm5sZW4sIHN0YXRlLmxlbmNvZGUsIDAsIHN0YXRlLndvcmssIG9wdHMpOwogICAgICAgICAgLy8gV2UgaGF2ZSBzZXBhcmF0ZSB0YWJsZXMgJiBubyBwb2ludGVycy4gMiBjb21tZW50ZWQgbGluZXMgYmVsb3cgbm90IG5lZWRlZC4KICAgICAgICAgIC8vIHN0YXRlLm5leHRfaW5kZXggPSBvcHRzLnRhYmxlX2luZGV4OwogICAgICAgICAgc3RhdGUubGVuYml0cyA9IG9wdHMuYml0czsKICAgICAgICAgIC8vIHN0YXRlLmxlbmNvZGUgPSBzdGF0ZS5uZXh0OwoKICAgICAgICAgIGlmIChyZXQpIHsKICAgICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBsaXRlcmFsL2xlbmd0aHMgc2V0JzsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgc3RhdGUuZGlzdGJpdHMgPSA2OwogICAgICAgICAgLy9zdGF0ZS5kaXN0Y29kZS5jb3B5KHN0YXRlLmNvZGVzKTsKICAgICAgICAgIC8vIFN3aXRjaCB0byB1c2UgZHluYW1pYyB0YWJsZQogICAgICAgICAgc3RhdGUuZGlzdGNvZGUgPSBzdGF0ZS5kaXN0ZHluOwogICAgICAgICAgb3B0cyA9IHsgYml0czogc3RhdGUuZGlzdGJpdHMgfTsKICAgICAgICAgIHJldCA9IGluZnRyZWVzKERJU1RTLCBzdGF0ZS5sZW5zLCBzdGF0ZS5ubGVuLCBzdGF0ZS5uZGlzdCwgc3RhdGUuZGlzdGNvZGUsIDAsIHN0YXRlLndvcmssIG9wdHMpOwogICAgICAgICAgLy8gV2UgaGF2ZSBzZXBhcmF0ZSB0YWJsZXMgJiBubyBwb2ludGVycy4gMiBjb21tZW50ZWQgbGluZXMgYmVsb3cgbm90IG5lZWRlZC4KICAgICAgICAgIC8vIHN0YXRlLm5leHRfaW5kZXggPSBvcHRzLnRhYmxlX2luZGV4OwogICAgICAgICAgc3RhdGUuZGlzdGJpdHMgPSBvcHRzLmJpdHM7CiAgICAgICAgICAvLyBzdGF0ZS5kaXN0Y29kZSA9IHN0YXRlLm5leHQ7CgogICAgICAgICAgaWYgKHJldCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGRpc3RhbmNlcyBzZXQnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICdpbmZsYXRlOiAgICAgICBjb2RlcyBva1xuJykpOwogICAgICAgICAgc3RhdGUubW9kZSA9IExFTl87CiAgICAgICAgICBpZiAoZmx1c2ggPT09IFpfVFJFRVMpIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBMRU5fOgogICAgICAgICAgc3RhdGUubW9kZSA9IExFTjsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIExFTjoKICAgICAgICAgIGlmIChoYXZlID49IDYgJiYgbGVmdCA+PSAyNTgpIHsKICAgICAgICAgICAgLy8tLS0gUkVTVE9SRSgpIC0tLQogICAgICAgICAgICBzdHJtLm5leHRfb3V0ID0gcHV0OwogICAgICAgICAgICBzdHJtLmF2YWlsX291dCA9IGxlZnQ7CiAgICAgICAgICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICAgICAgICAgIHN0cm0uYXZhaWxfaW4gPSBoYXZlOwogICAgICAgICAgICBzdGF0ZS5ob2xkID0gaG9sZDsKICAgICAgICAgICAgc3RhdGUuYml0cyA9IGJpdHM7CiAgICAgICAgICAgIC8vLS0tCiAgICAgICAgICAgIGluZmZhc3Qoc3RybSwgX291dCk7CiAgICAgICAgICAgIC8vLS0tIExPQUQoKSAtLS0KICAgICAgICAgICAgcHV0ID0gc3RybS5uZXh0X291dDsKICAgICAgICAgICAgb3V0cHV0ID0gc3RybS5vdXRwdXQ7CiAgICAgICAgICAgIGxlZnQgPSBzdHJtLmF2YWlsX291dDsKICAgICAgICAgICAgbmV4dCA9IHN0cm0ubmV4dF9pbjsKICAgICAgICAgICAgaW5wdXQgPSBzdHJtLmlucHV0OwogICAgICAgICAgICBoYXZlID0gc3RybS5hdmFpbF9pbjsKICAgICAgICAgICAgaG9sZCA9IHN0YXRlLmhvbGQ7CiAgICAgICAgICAgIGJpdHMgPSBzdGF0ZS5iaXRzOwogICAgICAgICAgICAvLy0tLQoKICAgICAgICAgICAgaWYgKHN0YXRlLm1vZGUgPT09IFRZUEUpIHsKICAgICAgICAgICAgICBzdGF0ZS5iYWNrID0gLTE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5iYWNrID0gMDsKICAgICAgICAgIGZvciAoOzspIHsKICAgICAgICAgICAgaGVyZSA9IHN0YXRlLmxlbmNvZGVbaG9sZCAmICgoMSA8PCBzdGF0ZS5sZW5iaXRzKSAtIDEpXTsgIC8qQklUUyhzdGF0ZS5sZW5iaXRzKSovCiAgICAgICAgICAgIGhlcmVfYml0cyA9IGhlcmUgPj4+IDI0OwogICAgICAgICAgICBoZXJlX29wID0gKGhlcmUgPj4+IDE2KSAmIDB4ZmY7CiAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDB4ZmZmZjsKCiAgICAgICAgICAgIGlmIChoZXJlX2JpdHMgPD0gYml0cykgeyBicmVhazsgfQogICAgICAgICAgICAvLy0tLSBQVUxMQllURSgpIC0tLS8vCiAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIH0KICAgICAgICAgIGlmIChoZXJlX29wICYmIChoZXJlX29wICYgMHhmMCkgPT09IDApIHsKICAgICAgICAgICAgbGFzdF9iaXRzID0gaGVyZV9iaXRzOwogICAgICAgICAgICBsYXN0X29wID0gaGVyZV9vcDsKICAgICAgICAgICAgbGFzdF92YWwgPSBoZXJlX3ZhbDsKICAgICAgICAgICAgZm9yICg7OykgewogICAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5sZW5jb2RlW2xhc3RfdmFsICsKICAgICAgICAgICAgICAgICAgICAgICgoaG9sZCAmICgoMSA8PCAobGFzdF9iaXRzICsgbGFzdF9vcCkpIC0gMSkpLypCSVRTKGxhc3QuYml0cyArIGxhc3Qub3ApKi8gPj4gbGFzdF9iaXRzKV07CiAgICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgaGVyZV9vcCA9IChoZXJlID4+PiAxNikgJiAweGZmOwogICAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDB4ZmZmZjsKCiAgICAgICAgICAgICAgaWYgKChsYXN0X2JpdHMgKyBoZXJlX2JpdHMpIDw9IGJpdHMpIHsgYnJlYWs7IH0KICAgICAgICAgICAgICAvLy0tLSBQVUxMQllURSgpIC0tLS8vCiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMobGFzdC5iaXRzKSAtLS0vLwogICAgICAgICAgICBob2xkID4+Pj0gbGFzdF9iaXRzOwogICAgICAgICAgICBiaXRzIC09IGxhc3RfYml0czsKICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICBzdGF0ZS5iYWNrICs9IGxhc3RfYml0czsKICAgICAgICAgIH0KICAgICAgICAgIC8vLS0tIERST1BCSVRTKGhlcmUuYml0cykgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLmJhY2sgKz0gaGVyZV9iaXRzOwogICAgICAgICAgc3RhdGUubGVuZ3RoID0gaGVyZV92YWw7CiAgICAgICAgICBpZiAoaGVyZV9vcCA9PT0gMCkgewogICAgICAgICAgICAvL1RyYWNldnYoKHN0ZGVyciwgaGVyZS52YWwgPj0gMHgyMCAmJiBoZXJlLnZhbCA8IDB4N2YgPwogICAgICAgICAgICAvLyAgICAgICAgImluZmxhdGU6ICAgICAgICAgbGl0ZXJhbCAnJWMnXG4iIDoKICAgICAgICAgICAgLy8gICAgICAgICJpbmZsYXRlOiAgICAgICAgIGxpdGVyYWwgMHglMDJ4XG4iLCBoZXJlLnZhbCkpOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gTElUOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChoZXJlX29wICYgMzIpIHsKICAgICAgICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICAgIGVuZCBvZiBibG9ja1xuIikpOwogICAgICAgICAgICBzdGF0ZS5iYWNrID0gLTE7CiAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBUWVBFOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChoZXJlX29wICYgNjQpIHsKICAgICAgICAgICAgc3RybS5tc2cgPSAnaW52YWxpZCBsaXRlcmFsL2xlbmd0aCBjb2RlJzsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5leHRyYSA9IGhlcmVfb3AgJiAxNTsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBMRU5FWFQ7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBMRU5FWFQ6CiAgICAgICAgICBpZiAoc3RhdGUuZXh0cmEpIHsKICAgICAgICAgICAgLy89PT0gTkVFREJJVFMoc3RhdGUuZXh0cmEpOwogICAgICAgICAgICBuID0gc3RhdGUuZXh0cmE7CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgbikgewogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICBzdGF0ZS5sZW5ndGggKz0gaG9sZCAmICgoMSA8PCBzdGF0ZS5leHRyYSkgLSAxKS8qQklUUyhzdGF0ZS5leHRyYSkqLzsKICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMoc3RhdGUuZXh0cmEpIC0tLS8vCiAgICAgICAgICAgIGhvbGQgPj4+PSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgYml0cyAtPSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICBzdGF0ZS5iYWNrICs9IHN0YXRlLmV4dHJhOwogICAgICAgICAgfQogICAgICAgICAgLy9UcmFjZXZ2KChzdGRlcnIsICJpbmZsYXRlOiAgICAgICAgIGxlbmd0aCAldVxuIiwgc3RhdGUubGVuZ3RoKSk7CiAgICAgICAgICBzdGF0ZS53YXMgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICBzdGF0ZS5tb2RlID0gRElTVDsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIERJU1Q6CiAgICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICAgIGhlcmUgPSBzdGF0ZS5kaXN0Y29kZVtob2xkICYgKCgxIDw8IHN0YXRlLmRpc3RiaXRzKSAtIDEpXTsvKkJJVFMoc3RhdGUuZGlzdGJpdHMpKi8KICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgIGhlcmVfb3AgPSAoaGVyZSA+Pj4gMTYpICYgMHhmZjsKICAgICAgICAgICAgaGVyZV92YWwgPSBoZXJlICYgMHhmZmZmOwoKICAgICAgICAgICAgaWYgKChoZXJlX2JpdHMpIDw9IGJpdHMpIHsgYnJlYWs7IH0KICAgICAgICAgICAgLy8tLS0gUFVMTEJZVEUoKSAtLS0vLwogICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoKGhlcmVfb3AgJiAweGYwKSA9PT0gMCkgewogICAgICAgICAgICBsYXN0X2JpdHMgPSBoZXJlX2JpdHM7CiAgICAgICAgICAgIGxhc3Rfb3AgPSBoZXJlX29wOwogICAgICAgICAgICBsYXN0X3ZhbCA9IGhlcmVfdmFsOwogICAgICAgICAgICBmb3IgKDs7KSB7CiAgICAgICAgICAgICAgaGVyZSA9IHN0YXRlLmRpc3Rjb2RlW2xhc3RfdmFsICsKICAgICAgICAgICAgICAgICAgICAgICgoaG9sZCAmICgoMSA8PCAobGFzdF9iaXRzICsgbGFzdF9vcCkpIC0gMSkpLypCSVRTKGxhc3QuYml0cyArIGxhc3Qub3ApKi8gPj4gbGFzdF9iaXRzKV07CiAgICAgICAgICAgICAgaGVyZV9iaXRzID0gaGVyZSA+Pj4gMjQ7CiAgICAgICAgICAgICAgaGVyZV9vcCA9IChoZXJlID4+PiAxNikgJiAweGZmOwogICAgICAgICAgICAgIGhlcmVfdmFsID0gaGVyZSAmIDB4ZmZmZjsKCiAgICAgICAgICAgICAgaWYgKChsYXN0X2JpdHMgKyBoZXJlX2JpdHMpIDw9IGJpdHMpIHsgYnJlYWs7IH0KICAgICAgICAgICAgICAvLy0tLSBQVUxMQllURSgpIC0tLS8vCiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8tLS0gRFJPUEJJVFMobGFzdC5iaXRzKSAtLS0vLwogICAgICAgICAgICBob2xkID4+Pj0gbGFzdF9iaXRzOwogICAgICAgICAgICBiaXRzIC09IGxhc3RfYml0czsKICAgICAgICAgICAgLy8tLS0vLwogICAgICAgICAgICBzdGF0ZS5iYWNrICs9IGxhc3RfYml0czsKICAgICAgICAgIH0KICAgICAgICAgIC8vLS0tIERST1BCSVRTKGhlcmUuYml0cykgLS0tLy8KICAgICAgICAgIGhvbGQgPj4+PSBoZXJlX2JpdHM7CiAgICAgICAgICBiaXRzIC09IGhlcmVfYml0czsKICAgICAgICAgIC8vLS0tLy8KICAgICAgICAgIHN0YXRlLmJhY2sgKz0gaGVyZV9iaXRzOwogICAgICAgICAgaWYgKGhlcmVfb3AgJiA2NCkgewogICAgICAgICAgICBzdHJtLm1zZyA9ICdpbnZhbGlkIGRpc3RhbmNlIGNvZGUnOwogICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHN0YXRlLm9mZnNldCA9IGhlcmVfdmFsOwogICAgICAgICAgc3RhdGUuZXh0cmEgPSAoaGVyZV9vcCkgJiAxNTsKICAgICAgICAgIHN0YXRlLm1vZGUgPSBESVNURVhUOwogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGNhc2UgRElTVEVYVDoKICAgICAgICAgIGlmIChzdGF0ZS5leHRyYSkgewogICAgICAgICAgICAvLz09PSBORUVEQklUUyhzdGF0ZS5leHRyYSk7CiAgICAgICAgICAgIG4gPSBzdGF0ZS5leHRyYTsKICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCBuKSB7CiAgICAgICAgICAgICAgaWYgKGhhdmUgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICAgICAgaGF2ZS0tOwogICAgICAgICAgICAgIGhvbGQgKz0gaW5wdXRbbmV4dCsrXSA8PCBiaXRzOwogICAgICAgICAgICAgIGJpdHMgKz0gODsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLz09PS8vCiAgICAgICAgICAgIHN0YXRlLm9mZnNldCArPSBob2xkICYgKCgxIDw8IHN0YXRlLmV4dHJhKSAtIDEpLypCSVRTKHN0YXRlLmV4dHJhKSovOwogICAgICAgICAgICAvLy0tLSBEUk9QQklUUyhzdGF0ZS5leHRyYSkgLS0tLy8KICAgICAgICAgICAgaG9sZCA+Pj49IHN0YXRlLmV4dHJhOwogICAgICAgICAgICBiaXRzIC09IHN0YXRlLmV4dHJhOwogICAgICAgICAgICAvLy0tLS8vCiAgICAgICAgICAgIHN0YXRlLmJhY2sgKz0gc3RhdGUuZXh0cmE7CiAgICAgICAgICB9CiAgLy8jaWZkZWYgSU5GTEFURV9TVFJJQ1QKICAgICAgICAgIGlmIChzdGF0ZS5vZmZzZXQgPiBzdGF0ZS5kbWF4KSB7CiAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrJzsKICAgICAgICAgICAgc3RhdGUubW9kZSA9IEJBRDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgLy8jZW5kaWYKICAgICAgICAgIC8vVHJhY2V2digoc3RkZXJyLCAiaW5mbGF0ZTogICAgICAgICBkaXN0YW5jZSAldVxuIiwgc3RhdGUub2Zmc2V0KSk7CiAgICAgICAgICBzdGF0ZS5tb2RlID0gTUFUQ0g7CiAgICAgICAgICAvKiBmYWxscyB0aHJvdWdoICovCiAgICAgICAgY2FzZSBNQVRDSDoKICAgICAgICAgIGlmIChsZWZ0ID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgY29weSA9IF9vdXQgLSBsZWZ0OwogICAgICAgICAgaWYgKHN0YXRlLm9mZnNldCA+IGNvcHkpIHsgICAgICAgICAvKiBjb3B5IGZyb20gd2luZG93ICovCiAgICAgICAgICAgIGNvcHkgPSBzdGF0ZS5vZmZzZXQgLSBjb3B5OwogICAgICAgICAgICBpZiAoY29weSA+IHN0YXRlLndoYXZlKSB7CiAgICAgICAgICAgICAgaWYgKHN0YXRlLnNhbmUpIHsKICAgICAgICAgICAgICAgIHN0cm0ubXNnID0gJ2ludmFsaWQgZGlzdGFuY2UgdG9vIGZhciBiYWNrJzsKICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgLy8gKCEpIFRoaXMgYmxvY2sgaXMgZGlzYWJsZWQgaW4gemxpYiBkZWZhdWx0cywKICAvLyBkb24ndCBlbmFibGUgaXQgZm9yIGJpbmFyeSBjb21wYXRpYmlsaXR5CiAgLy8jaWZkZWYgSU5GTEFURV9BTExPV19JTlZBTElEX0RJU1RBTkNFX1RPT0ZBUl9BUlJSCiAgLy8gICAgICAgICAgVHJhY2UoKHN0ZGVyciwgImluZmxhdGUuYyB0b28gZmFyXG4iKSk7CiAgLy8gICAgICAgICAgY29weSAtPSBzdGF0ZS53aGF2ZTsKICAvLyAgICAgICAgICBpZiAoY29weSA+IHN0YXRlLmxlbmd0aCkgeyBjb3B5ID0gc3RhdGUubGVuZ3RoOyB9CiAgLy8gICAgICAgICAgaWYgKGNvcHkgPiBsZWZ0KSB7IGNvcHkgPSBsZWZ0OyB9CiAgLy8gICAgICAgICAgbGVmdCAtPSBjb3B5OwogIC8vICAgICAgICAgIHN0YXRlLmxlbmd0aCAtPSBjb3B5OwogIC8vICAgICAgICAgIGRvIHsKICAvLyAgICAgICAgICAgIG91dHB1dFtwdXQrK10gPSAwOwogIC8vICAgICAgICAgIH0gd2hpbGUgKC0tY29weSk7CiAgLy8gICAgICAgICAgaWYgKHN0YXRlLmxlbmd0aCA9PT0gMCkgeyBzdGF0ZS5tb2RlID0gTEVOOyB9CiAgLy8gICAgICAgICAgYnJlYWs7CiAgLy8jZW5kaWYKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY29weSA+IHN0YXRlLnduZXh0KSB7CiAgICAgICAgICAgICAgY29weSAtPSBzdGF0ZS53bmV4dDsKICAgICAgICAgICAgICBmcm9tID0gc3RhdGUud3NpemUgLSBjb3B5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGZyb20gPSBzdGF0ZS53bmV4dCAtIGNvcHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNvcHkgPiBzdGF0ZS5sZW5ndGgpIHsgY29weSA9IHN0YXRlLmxlbmd0aDsgfQogICAgICAgICAgICBmcm9tX3NvdXJjZSA9IHN0YXRlLndpbmRvdzsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qIGNvcHkgZnJvbSBvdXRwdXQgKi8KICAgICAgICAgICAgZnJvbV9zb3VyY2UgPSBvdXRwdXQ7CiAgICAgICAgICAgIGZyb20gPSBwdXQgLSBzdGF0ZS5vZmZzZXQ7CiAgICAgICAgICAgIGNvcHkgPSBzdGF0ZS5sZW5ndGg7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY29weSA+IGxlZnQpIHsgY29weSA9IGxlZnQ7IH0KICAgICAgICAgIGxlZnQgLT0gY29weTsKICAgICAgICAgIHN0YXRlLmxlbmd0aCAtPSBjb3B5OwogICAgICAgICAgZG8gewogICAgICAgICAgICBvdXRwdXRbcHV0KytdID0gZnJvbV9zb3VyY2VbZnJvbSsrXTsKICAgICAgICAgIH0gd2hpbGUgKC0tY29weSk7CiAgICAgICAgICBpZiAoc3RhdGUubGVuZ3RoID09PSAwKSB7IHN0YXRlLm1vZGUgPSBMRU47IH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgTElUOgogICAgICAgICAgaWYgKGxlZnQgPT09IDApIHsgYnJlYWsgaW5mX2xlYXZlOyB9CiAgICAgICAgICBvdXRwdXRbcHV0KytdID0gc3RhdGUubGVuZ3RoOwogICAgICAgICAgbGVmdC0tOwogICAgICAgICAgc3RhdGUubW9kZSA9IExFTjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQ0hFQ0s6CiAgICAgICAgICBpZiAoc3RhdGUud3JhcCkgewogICAgICAgICAgICAvLz09PSBORUVEQklUUygzMik7CiAgICAgICAgICAgIHdoaWxlIChiaXRzIDwgMzIpIHsKICAgICAgICAgICAgICBpZiAoaGF2ZSA9PT0gMCkgeyBicmVhayBpbmZfbGVhdmU7IH0KICAgICAgICAgICAgICBoYXZlLS07CiAgICAgICAgICAgICAgLy8gVXNlICd8JyBpbnN0ZWFkIG9mICcrJyB0byBtYWtlIHN1cmUgdGhhdCByZXN1bHQgaXMgc2lnbmVkCiAgICAgICAgICAgICAgaG9sZCB8PSBpbnB1dFtuZXh0KytdIDw8IGJpdHM7CiAgICAgICAgICAgICAgYml0cyArPSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09Ly8KICAgICAgICAgICAgX291dCAtPSBsZWZ0OwogICAgICAgICAgICBzdHJtLnRvdGFsX291dCArPSBfb3V0OwogICAgICAgICAgICBzdGF0ZS50b3RhbCArPSBfb3V0OwogICAgICAgICAgICBpZiAoX291dCkgewogICAgICAgICAgICAgIHN0cm0uYWRsZXIgPSBzdGF0ZS5jaGVjayA9CiAgICAgICAgICAgICAgICAgIC8qVVBEQVRFKHN0YXRlLmNoZWNrLCBwdXQgLSBfb3V0LCBfb3V0KTsqLwogICAgICAgICAgICAgICAgICAoc3RhdGUuZmxhZ3MgPyBjcmMzMl8xKHN0YXRlLmNoZWNrLCBvdXRwdXQsIF9vdXQsIHB1dCAtIF9vdXQpIDogYWRsZXIzMl8xKHN0YXRlLmNoZWNrLCBvdXRwdXQsIF9vdXQsIHB1dCAtIF9vdXQpKTsKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgX291dCA9IGxlZnQ7CiAgICAgICAgICAgIC8vIE5COiBjcmMzMiBzdG9yZWQgYXMgc2lnbmVkIDMyLWJpdCBpbnQsIHpzd2FwMzIgcmV0dXJucyBzaWduZWQgdG9vCiAgICAgICAgICAgIGlmICgoc3RhdGUuZmxhZ3MgPyBob2xkIDogenN3YXAzMihob2xkKSkgIT09IHN0YXRlLmNoZWNrKSB7CiAgICAgICAgICAgICAgc3RybS5tc2cgPSAnaW5jb3JyZWN0IGRhdGEgY2hlY2snOwogICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBCQUQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy89PT0gSU5JVEJJVFMoKTsKICAgICAgICAgICAgaG9sZCA9IDA7CiAgICAgICAgICAgIGJpdHMgPSAwOwogICAgICAgICAgICAvLz09PS8vCiAgICAgICAgICAgIC8vVHJhY2V2KChzdGRlcnIsICJpbmZsYXRlOiAgIGNoZWNrIG1hdGNoZXMgdHJhaWxlclxuIikpOwogICAgICAgICAgfQogICAgICAgICAgc3RhdGUubW9kZSA9IExFTkdUSDsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIExFTkdUSDoKICAgICAgICAgIGlmIChzdGF0ZS53cmFwICYmIHN0YXRlLmZsYWdzKSB7CiAgICAgICAgICAgIC8vPT09IE5FRURCSVRTKDMyKTsKICAgICAgICAgICAgd2hpbGUgKGJpdHMgPCAzMikgewogICAgICAgICAgICAgIGlmIChoYXZlID09PSAwKSB7IGJyZWFrIGluZl9sZWF2ZTsgfQogICAgICAgICAgICAgIGhhdmUtLTsKICAgICAgICAgICAgICBob2xkICs9IGlucHV0W25leHQrK10gPDwgYml0czsKICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICBpZiAoaG9sZCAhPT0gKHN0YXRlLnRvdGFsICYgMHhmZmZmZmZmZikpIHsKICAgICAgICAgICAgICBzdHJtLm1zZyA9ICdpbmNvcnJlY3QgbGVuZ3RoIGNoZWNrJzsKICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gQkFEOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vPT09IElOSVRCSVRTKCk7CiAgICAgICAgICAgIGhvbGQgPSAwOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgICAgLy89PT0vLwogICAgICAgICAgICAvL1RyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICBsZW5ndGggbWF0Y2hlcyB0cmFpbGVyXG4iKSk7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZS5tb2RlID0gRE9ORTsKICAgICAgICAgIC8qIGZhbGxzIHRocm91Z2ggKi8KICAgICAgICBjYXNlIERPTkU6CiAgICAgICAgICByZXQgPSBaX1NUUkVBTV9FTkQkMTsKICAgICAgICAgIGJyZWFrIGluZl9sZWF2ZTsKICAgICAgICBjYXNlIEJBRDoKICAgICAgICAgIHJldCA9IFpfREFUQV9FUlJPUiQxOwogICAgICAgICAgYnJlYWsgaW5mX2xlYXZlOwogICAgICAgIGNhc2UgTUVNOgogICAgICAgICAgcmV0dXJuIFpfTUVNX0VSUk9SJDE7CiAgICAgICAgY2FzZSBTWU5DOgogICAgICAgICAgLyogZmFsbHMgdGhyb3VnaCAqLwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsKICAgICAgfQogICAgfQoKICAgIC8vIGluZl9sZWF2ZSA8LSBoZXJlIGlzIHJlYWwgcGxhY2UgZm9yICJnb3RvIGluZl9sZWF2ZSIsIGVtdWxhdGVkIHZpYSAiYnJlYWsgaW5mX2xlYXZlIgoKICAgIC8qCiAgICAgICBSZXR1cm4gZnJvbSBpbmZsYXRlKCksIHVwZGF0aW5nIHRoZSB0b3RhbCBjb3VudHMgYW5kIHRoZSBjaGVjayB2YWx1ZS4KICAgICAgIElmIHRoZXJlIHdhcyBubyBwcm9ncmVzcyBkdXJpbmcgdGhlIGluZmxhdGUoKSBjYWxsLCByZXR1cm4gYSBidWZmZXIKICAgICAgIGVycm9yLiAgQ2FsbCB1cGRhdGV3aW5kb3coKSB0byBjcmVhdGUgYW5kL29yIHVwZGF0ZSB0aGUgd2luZG93IHN0YXRlLgogICAgICAgTm90ZTogYSBtZW1vcnkgZXJyb3IgZnJvbSBpbmZsYXRlKCkgaXMgbm9uLXJlY292ZXJhYmxlLgogICAgICovCgogICAgLy8tLS0gUkVTVE9SRSgpIC0tLQogICAgc3RybS5uZXh0X291dCA9IHB1dDsKICAgIHN0cm0uYXZhaWxfb3V0ID0gbGVmdDsKICAgIHN0cm0ubmV4dF9pbiA9IG5leHQ7CiAgICBzdHJtLmF2YWlsX2luID0gaGF2ZTsKICAgIHN0YXRlLmhvbGQgPSBob2xkOwogICAgc3RhdGUuYml0cyA9IGJpdHM7CiAgICAvLy0tLQoKICAgIGlmIChzdGF0ZS53c2l6ZSB8fCAoX291dCAhPT0gc3RybS5hdmFpbF9vdXQgJiYgc3RhdGUubW9kZSA8IEJBRCAmJgogICAgICAgICAgICAgICAgICAgICAgICAoc3RhdGUubW9kZSA8IENIRUNLIHx8IGZsdXNoICE9PSBaX0ZJTklTSCQxKSkpIHsKICAgICAgaWYgKHVwZGF0ZXdpbmRvdyhzdHJtLCBzdHJtLm91dHB1dCwgc3RybS5uZXh0X291dCwgX291dCAtIHN0cm0uYXZhaWxfb3V0KSkgOwogICAgfQogICAgX2luIC09IHN0cm0uYXZhaWxfaW47CiAgICBfb3V0IC09IHN0cm0uYXZhaWxfb3V0OwogICAgc3RybS50b3RhbF9pbiArPSBfaW47CiAgICBzdHJtLnRvdGFsX291dCArPSBfb3V0OwogICAgc3RhdGUudG90YWwgKz0gX291dDsKICAgIGlmIChzdGF0ZS53cmFwICYmIF9vdXQpIHsKICAgICAgc3RybS5hZGxlciA9IHN0YXRlLmNoZWNrID0gLypVUERBVEUoc3RhdGUuY2hlY2ssIHN0cm0ubmV4dF9vdXQgLSBfb3V0LCBfb3V0KTsqLwogICAgICAgIChzdGF0ZS5mbGFncyA/IGNyYzMyXzEoc3RhdGUuY2hlY2ssIG91dHB1dCwgX291dCwgc3RybS5uZXh0X291dCAtIF9vdXQpIDogYWRsZXIzMl8xKHN0YXRlLmNoZWNrLCBvdXRwdXQsIF9vdXQsIHN0cm0ubmV4dF9vdXQgLSBfb3V0KSk7CiAgICB9CiAgICBzdHJtLmRhdGFfdHlwZSA9IHN0YXRlLmJpdHMgKyAoc3RhdGUubGFzdCA/IDY0IDogMCkgKwogICAgICAgICAgICAgICAgICAgICAgKHN0YXRlLm1vZGUgPT09IFRZUEUgPyAxMjggOiAwKSArCiAgICAgICAgICAgICAgICAgICAgICAoc3RhdGUubW9kZSA9PT0gTEVOXyB8fCBzdGF0ZS5tb2RlID09PSBDT1BZXyA/IDI1NiA6IDApOwogICAgaWYgKCgoX2luID09PSAwICYmIF9vdXQgPT09IDApIHx8IGZsdXNoID09PSBaX0ZJTklTSCQxKSAmJiByZXQgPT09IFpfT0skMSkgewogICAgICByZXQgPSBaX0JVRl9FUlJPUjsKICAgIH0KICAgIHJldHVybiByZXQ7CiAgfTsKCgogIGNvbnN0IGluZmxhdGVFbmQgPSAoc3RybSkgPT4gewoKICAgIGlmICghc3RybSB8fCAhc3RybS5zdGF0ZSAvKnx8IHN0cm0tPnpmcmVlID09IChmcmVlX2Z1bmMpMCovKSB7CiAgICAgIHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOwogICAgfQoKICAgIGxldCBzdGF0ZSA9IHN0cm0uc3RhdGU7CiAgICBpZiAoc3RhdGUud2luZG93KSB7CiAgICAgIHN0YXRlLndpbmRvdyA9IG51bGw7CiAgICB9CiAgICBzdHJtLnN0YXRlID0gbnVsbDsKICAgIHJldHVybiBaX09LJDE7CiAgfTsKCgogIGNvbnN0IGluZmxhdGVHZXRIZWFkZXIgPSAoc3RybSwgaGVhZCkgPT4gewoKICAgIC8qIGNoZWNrIHN0YXRlICovCiAgICBpZiAoIXN0cm0gfHwgIXN0cm0uc3RhdGUpIHsgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7IH0KICAgIGNvbnN0IHN0YXRlID0gc3RybS5zdGF0ZTsKICAgIGlmICgoc3RhdGUud3JhcCAmIDIpID09PSAwKSB7IHJldHVybiBaX1NUUkVBTV9FUlJPUiQxOyB9CgogICAgLyogc2F2ZSBoZWFkZXIgc3RydWN0dXJlICovCiAgICBzdGF0ZS5oZWFkID0gaGVhZDsKICAgIGhlYWQuZG9uZSA9IGZhbHNlOwogICAgcmV0dXJuIFpfT0skMTsKICB9OwoKCiAgY29uc3QgaW5mbGF0ZVNldERpY3Rpb25hcnkgPSAoc3RybSwgZGljdGlvbmFyeSkgPT4gewogICAgY29uc3QgZGljdExlbmd0aCA9IGRpY3Rpb25hcnkubGVuZ3RoOwoKICAgIGxldCBzdGF0ZTsKICAgIGxldCBkaWN0aWQ7CiAgICBsZXQgcmV0OwoKICAgIC8qIGNoZWNrIHN0YXRlICovCiAgICBpZiAoIXN0cm0gLyogPT0gWl9OVUxMICovIHx8ICFzdHJtLnN0YXRlIC8qID09IFpfTlVMTCAqLykgeyByZXR1cm4gWl9TVFJFQU1fRVJST1IkMTsgfQogICAgc3RhdGUgPSBzdHJtLnN0YXRlOwoKICAgIGlmIChzdGF0ZS53cmFwICE9PSAwICYmIHN0YXRlLm1vZGUgIT09IERJQ1QpIHsKICAgICAgcmV0dXJuIFpfU1RSRUFNX0VSUk9SJDE7CiAgICB9CgogICAgLyogY2hlY2sgZm9yIGNvcnJlY3QgZGljdGlvbmFyeSBpZGVudGlmaWVyICovCiAgICBpZiAoc3RhdGUubW9kZSA9PT0gRElDVCkgewogICAgICBkaWN0aWQgPSAxOyAvKiBhZGxlcjMyKDAsIG51bGwsIDApKi8KICAgICAgLyogZGljdGlkID0gYWRsZXIzMihkaWN0aWQsIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgpOyAqLwogICAgICBkaWN0aWQgPSBhZGxlcjMyXzEoZGljdGlkLCBkaWN0aW9uYXJ5LCBkaWN0TGVuZ3RoLCAwKTsKICAgICAgaWYgKGRpY3RpZCAhPT0gc3RhdGUuY2hlY2spIHsKICAgICAgICByZXR1cm4gWl9EQVRBX0VSUk9SJDE7CiAgICAgIH0KICAgIH0KICAgIC8qIGNvcHkgZGljdGlvbmFyeSB0byB3aW5kb3cgdXNpbmcgdXBkYXRld2luZG93KCksIHdoaWNoIHdpbGwgYW1lbmQgdGhlCiAgICAgZXhpc3RpbmcgZGljdGlvbmFyeSBpZiBhcHByb3ByaWF0ZSAqLwogICAgcmV0ID0gdXBkYXRld2luZG93KHN0cm0sIGRpY3Rpb25hcnksIGRpY3RMZW5ndGgsIGRpY3RMZW5ndGgpOwogICAgaWYgKHJldCkgewogICAgICBzdGF0ZS5tb2RlID0gTUVNOwogICAgICByZXR1cm4gWl9NRU1fRVJST1IkMTsKICAgIH0KICAgIHN0YXRlLmhhdmVkaWN0ID0gMTsKICAgIC8vIFRyYWNldigoc3RkZXJyLCAiaW5mbGF0ZTogICBkaWN0aW9uYXJ5IHNldFxuIikpOwogICAgcmV0dXJuIFpfT0skMTsKICB9OwoKCiAgdmFyIGluZmxhdGVSZXNldF8xID0gaW5mbGF0ZVJlc2V0OwogIHZhciBpbmZsYXRlUmVzZXQyXzEgPSBpbmZsYXRlUmVzZXQyOwogIHZhciBpbmZsYXRlUmVzZXRLZWVwXzEgPSBpbmZsYXRlUmVzZXRLZWVwOwogIHZhciBpbmZsYXRlSW5pdF8xID0gaW5mbGF0ZUluaXQ7CiAgdmFyIGluZmxhdGVJbml0Ml8xID0gaW5mbGF0ZUluaXQyOwogIHZhciBpbmZsYXRlXzIkMSA9IGluZmxhdGUkMjsKICB2YXIgaW5mbGF0ZUVuZF8xID0gaW5mbGF0ZUVuZDsKICB2YXIgaW5mbGF0ZUdldEhlYWRlcl8xID0gaW5mbGF0ZUdldEhlYWRlcjsKICB2YXIgaW5mbGF0ZVNldERpY3Rpb25hcnlfMSA9IGluZmxhdGVTZXREaWN0aW9uYXJ5OwogIHZhciBpbmZsYXRlSW5mbyA9ICdwYWtvIGluZmxhdGUgKGZyb20gTm9kZWNhIHByb2plY3QpJzsKCiAgLyogTm90IGltcGxlbWVudGVkCiAgbW9kdWxlLmV4cG9ydHMuaW5mbGF0ZUNvcHkgPSBpbmZsYXRlQ29weTsKICBtb2R1bGUuZXhwb3J0cy5pbmZsYXRlR2V0RGljdGlvbmFyeSA9IGluZmxhdGVHZXREaWN0aW9uYXJ5OwogIG1vZHVsZS5leHBvcnRzLmluZmxhdGVNYXJrID0gaW5mbGF0ZU1hcms7CiAgbW9kdWxlLmV4cG9ydHMuaW5mbGF0ZVByaW1lID0gaW5mbGF0ZVByaW1lOwogIG1vZHVsZS5leHBvcnRzLmluZmxhdGVTeW5jID0gaW5mbGF0ZVN5bmM7CiAgbW9kdWxlLmV4cG9ydHMuaW5mbGF0ZVN5bmNQb2ludCA9IGluZmxhdGVTeW5jUG9pbnQ7CiAgbW9kdWxlLmV4cG9ydHMuaW5mbGF0ZVVuZGVybWluZSA9IGluZmxhdGVVbmRlcm1pbmU7CiAgKi8KCiAgdmFyIGluZmxhdGVfMSQyID0gewogIAlpbmZsYXRlUmVzZXQ6IGluZmxhdGVSZXNldF8xLAogIAlpbmZsYXRlUmVzZXQyOiBpbmZsYXRlUmVzZXQyXzEsCiAgCWluZmxhdGVSZXNldEtlZXA6IGluZmxhdGVSZXNldEtlZXBfMSwKICAJaW5mbGF0ZUluaXQ6IGluZmxhdGVJbml0XzEsCiAgCWluZmxhdGVJbml0MjogaW5mbGF0ZUluaXQyXzEsCiAgCWluZmxhdGU6IGluZmxhdGVfMiQxLAogIAlpbmZsYXRlRW5kOiBpbmZsYXRlRW5kXzEsCiAgCWluZmxhdGVHZXRIZWFkZXI6IGluZmxhdGVHZXRIZWFkZXJfMSwKICAJaW5mbGF0ZVNldERpY3Rpb25hcnk6IGluZmxhdGVTZXREaWN0aW9uYXJ5XzEsCiAgCWluZmxhdGVJbmZvOiBpbmZsYXRlSW5mbwogIH07CgogIC8vIChDKSAxOTk1LTIwMTMgSmVhbi1sb3VwIEdhaWxseSBhbmQgTWFyayBBZGxlcgogIC8vIChDKSAyMDE0LTIwMTcgVml0YWx5IFB1enJpbiBhbmQgQW5kcmV5IFR1cGl0c2luCiAgLy8KICAvLyBUaGlzIHNvZnR3YXJlIGlzIHByb3ZpZGVkICdhcy1pcycsIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAogIC8vIHdhcnJhbnR5LiBJbiBubyBldmVudCB3aWxsIHRoZSBhdXRob3JzIGJlIGhlbGQgbGlhYmxlIGZvciBhbnkgZGFtYWdlcwogIC8vIGFyaXNpbmcgZnJvbSB0aGUgdXNlIG9mIHRoaXMgc29mdHdhcmUuCiAgLy8KICAvLyBQZXJtaXNzaW9uIGlzIGdyYW50ZWQgdG8gYW55b25lIHRvIHVzZSB0aGlzIHNvZnR3YXJlIGZvciBhbnkgcHVycG9zZSwKICAvLyBpbmNsdWRpbmcgY29tbWVyY2lhbCBhcHBsaWNhdGlvbnMsIGFuZCB0byBhbHRlciBpdCBhbmQgcmVkaXN0cmlidXRlIGl0CiAgLy8gZnJlZWx5LCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgcmVzdHJpY3Rpb25zOgogIC8vCiAgLy8gMS4gVGhlIG9yaWdpbiBvZiB0aGlzIHNvZnR3YXJlIG11c3Qgbm90IGJlIG1pc3JlcHJlc2VudGVkOyB5b3UgbXVzdCBub3QKICAvLyAgIGNsYWltIHRoYXQgeW91IHdyb3RlIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4gSWYgeW91IHVzZSB0aGlzIHNvZnR3YXJlCiAgLy8gICBpbiBhIHByb2R1Y3QsIGFuIGFja25vd2xlZGdtZW50IGluIHRoZSBwcm9kdWN0IGRvY3VtZW50YXRpb24gd291bGQgYmUKICAvLyAgIGFwcHJlY2lhdGVkIGJ1dCBpcyBub3QgcmVxdWlyZWQuCiAgLy8gMi4gQWx0ZXJlZCBzb3VyY2UgdmVyc2lvbnMgbXVzdCBiZSBwbGFpbmx5IG1hcmtlZCBhcyBzdWNoLCBhbmQgbXVzdCBub3QgYmUKICAvLyAgIG1pc3JlcHJlc2VudGVkIGFzIGJlaW5nIHRoZSBvcmlnaW5hbCBzb2Z0d2FyZS4KICAvLyAzLiBUaGlzIG5vdGljZSBtYXkgbm90IGJlIHJlbW92ZWQgb3IgYWx0ZXJlZCBmcm9tIGFueSBzb3VyY2UgZGlzdHJpYnV0aW9uLgoKICBmdW5jdGlvbiBHWmhlYWRlcigpIHsKICAgIC8qIHRydWUgaWYgY29tcHJlc3NlZCBkYXRhIGJlbGlldmVkIHRvIGJlIHRleHQgKi8KICAgIHRoaXMudGV4dCAgICAgICA9IDA7CiAgICAvKiBtb2RpZmljYXRpb24gdGltZSAqLwogICAgdGhpcy50aW1lICAgICAgID0gMDsKICAgIC8qIGV4dHJhIGZsYWdzIChub3QgdXNlZCB3aGVuIHdyaXRpbmcgYSBnemlwIGZpbGUpICovCiAgICB0aGlzLnhmbGFncyAgICAgPSAwOwogICAgLyogb3BlcmF0aW5nIHN5c3RlbSAqLwogICAgdGhpcy5vcyAgICAgICAgID0gMDsKICAgIC8qIHBvaW50ZXIgdG8gZXh0cmEgZmllbGQgb3IgWl9OVUxMIGlmIG5vbmUgKi8KICAgIHRoaXMuZXh0cmEgICAgICA9IG51bGw7CiAgICAvKiBleHRyYSBmaWVsZCBsZW5ndGggKHZhbGlkIGlmIGV4dHJhICE9IFpfTlVMTCkgKi8KICAgIHRoaXMuZXh0cmFfbGVuICA9IDA7IC8vIEFjdHVhbGx5LCB3ZSBkb24ndCBuZWVkIGl0IGluIEpTLAogICAgICAgICAgICAgICAgICAgICAgICAgLy8gYnV0IGxlYXZlIGZvciBmZXcgY29kZSBtb2RpZmljYXRpb25zCgogICAgLy8KICAgIC8vIFNldHVwIGxpbWl0cyBpcyBub3QgbmVjZXNzYXJ5IGJlY2F1c2UgaW4ganMgd2Ugc2hvdWxkIG5vdCBwcmVhbGxvY2F0ZSBtZW1vcnkKICAgIC8vIGZvciBpbmZsYXRlIHVzZSBjb25zdGFudCBsaW1pdCBpbiA2NTUzNiBieXRlcwogICAgLy8KCiAgICAvKiBzcGFjZSBhdCBleHRyYSAob25seSB3aGVuIHJlYWRpbmcgaGVhZGVyKSAqLwogICAgLy8gdGhpcy5leHRyYV9tYXggID0gMDsKICAgIC8qIHBvaW50ZXIgdG8gemVyby10ZXJtaW5hdGVkIGZpbGUgbmFtZSBvciBaX05VTEwgKi8KICAgIHRoaXMubmFtZSAgICAgICA9ICcnOwogICAgLyogc3BhY2UgYXQgbmFtZSAob25seSB3aGVuIHJlYWRpbmcgaGVhZGVyKSAqLwogICAgLy8gdGhpcy5uYW1lX21heCAgID0gMDsKICAgIC8qIHBvaW50ZXIgdG8gemVyby10ZXJtaW5hdGVkIGNvbW1lbnQgb3IgWl9OVUxMICovCiAgICB0aGlzLmNvbW1lbnQgICAgPSAnJzsKICAgIC8qIHNwYWNlIGF0IGNvbW1lbnQgKG9ubHkgd2hlbiByZWFkaW5nIGhlYWRlcikgKi8KICAgIC8vIHRoaXMuY29tbV9tYXggICA9IDA7CiAgICAvKiB0cnVlIGlmIHRoZXJlIHdhcyBvciB3aWxsIGJlIGEgaGVhZGVyIGNyYyAqLwogICAgdGhpcy5oY3JjICAgICAgID0gMDsKICAgIC8qIHRydWUgd2hlbiBkb25lIHJlYWRpbmcgZ3ppcCBoZWFkZXIgKG5vdCB1c2VkIHdoZW4gd3JpdGluZyBhIGd6aXAgZmlsZSkgKi8KICAgIHRoaXMuZG9uZSAgICAgICA9IGZhbHNlOwogIH0KCiAgdmFyIGd6aGVhZGVyID0gR1poZWFkZXI7CgogIGNvbnN0IHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKCiAgLyogUHVibGljIGNvbnN0YW50cyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki8KICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKICBjb25zdCB7CiAgICBaX05PX0ZMVVNILCBaX0ZJTklTSCwKICAgIFpfT0ssIFpfU1RSRUFNX0VORCwgWl9ORUVEX0RJQ1QsIFpfU1RSRUFNX0VSUk9SLCBaX0RBVEFfRVJST1IsIFpfTUVNX0VSUk9SCiAgfSA9IGNvbnN0YW50cyQyOwoKICAvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qLwoKCiAgLyoqCiAgICogY2xhc3MgSW5mbGF0ZQogICAqCiAgICogR2VuZXJpYyBKUy1zdHlsZSB3cmFwcGVyIGZvciB6bGliIGNhbGxzLiBJZiB5b3UgZG9uJ3QgbmVlZAogICAqIHN0cmVhbWluZyBiZWhhdmlvdXIgLSB1c2UgbW9yZSBzaW1wbGUgZnVuY3Rpb25zOiBbW2luZmxhdGVdXQogICAqIGFuZCBbW2luZmxhdGVSYXddXS4KICAgKiovCgogIC8qIGludGVybmFsCiAgICogaW5mbGF0ZS5jaHVua3MgLT4gQXJyYXkKICAgKgogICAqIENodW5rcyBvZiBvdXRwdXQgZGF0YSwgaWYgW1tJbmZsYXRlI29uRGF0YV1dIG5vdCBvdmVycmlkZGVuLgogICAqKi8KCiAgLyoqCiAgICogSW5mbGF0ZS5yZXN1bHQgLT4gVWludDhBcnJheXxTdHJpbmcKICAgKgogICAqIFVuY29tcHJlc3NlZCByZXN1bHQsIGdlbmVyYXRlZCBieSBkZWZhdWx0IFtbSW5mbGF0ZSNvbkRhdGFdXQogICAqIGFuZCBbW0luZmxhdGUjb25FbmRdXSBoYW5kbGVycy4gRmlsbGVkIGFmdGVyIHlvdSBwdXNoIGxhc3QgY2h1bmsKICAgKiAoY2FsbCBbW0luZmxhdGUjcHVzaF1dIHdpdGggYFpfRklOSVNIYCAvIGB0cnVlYCBwYXJhbSkuCiAgICoqLwoKICAvKioKICAgKiBJbmZsYXRlLmVyciAtPiBOdW1iZXIKICAgKgogICAqIEVycm9yIGNvZGUgYWZ0ZXIgaW5mbGF0ZSBmaW5pc2hlZC4gMCAoWl9PSykgb24gc3VjY2Vzcy4KICAgKiBTaG91bGQgYmUgY2hlY2tlZCBpZiBicm9rZW4gZGF0YSBwb3NzaWJsZS4KICAgKiovCgogIC8qKgogICAqIEluZmxhdGUubXNnIC0+IFN0cmluZwogICAqCiAgICogRXJyb3IgbWVzc2FnZSwgaWYgW1tJbmZsYXRlLmVycl1dICE9IDAKICAgKiovCgoKICAvKioKICAgKiBuZXcgSW5mbGF0ZShvcHRpb25zKQogICAqIC0gb3B0aW9ucyAoT2JqZWN0KTogemxpYiBpbmZsYXRlIG9wdGlvbnMuCiAgICoKICAgKiBDcmVhdGVzIG5ldyBpbmZsYXRvciBpbnN0YW5jZSB3aXRoIHNwZWNpZmllZCBwYXJhbXMuIFRocm93cyBleGNlcHRpb24KICAgKiBvbiBiYWQgcGFyYW1zLiBTdXBwb3J0ZWQgb3B0aW9uczoKICAgKgogICAqIC0gYHdpbmRvd0JpdHNgCiAgICogLSBgZGljdGlvbmFyeWAKICAgKgogICAqIFtodHRwOi8vemxpYi5uZXQvbWFudWFsLmh0bWwjQWR2YW5jZWRdKGh0dHA6Ly96bGliLm5ldC9tYW51YWwuaHRtbCNBZHZhbmNlZCkKICAgKiBmb3IgbW9yZSBpbmZvcm1hdGlvbiBvbiB0aGVzZS4KICAgKgogICAqIEFkZGl0aW9uYWwgb3B0aW9ucywgZm9yIGludGVybmFsIG5lZWRzOgogICAqCiAgICogLSBgY2h1bmtTaXplYCAtIHNpemUgb2YgZ2VuZXJhdGVkIGRhdGEgY2h1bmtzICgxNksgYnkgZGVmYXVsdCkKICAgKiAtIGByYXdgIChCb29sZWFuKSAtIGRvIHJhdyBpbmZsYXRlCiAgICogLSBgdG9gIChTdHJpbmcpIC0gaWYgZXF1YWwgdG8gJ3N0cmluZycsIHRoZW4gcmVzdWx0IHdpbGwgYmUgY29udmVydGVkCiAgICogICBmcm9tIHV0ZjggdG8gdXRmMTYgKGphdmFzY3JpcHQpIHN0cmluZy4gV2hlbiBzdHJpbmcgb3V0cHV0IHJlcXVlc3RlZCwKICAgKiAgIGNodW5rIGxlbmd0aCBjYW4gZGlmZmVyIGZyb20gYGNodW5rU2l6ZWAsIGRlcGVuZGluZyBvbiBjb250ZW50LgogICAqCiAgICogQnkgZGVmYXVsdCwgd2hlbiBubyBvcHRpb25zIHNldCwgYXV0b2RldGVjdCBkZWZsYXRlL2d6aXAgZGF0YSBmb3JtYXQgdmlhCiAgICogd3JhcHBlciBoZWFkZXIuCiAgICoKICAgKiAjIyMjIyBFeGFtcGxlOgogICAqCiAgICogYGBgamF2YXNjcmlwdAogICAqIGNvbnN0IHBha28gPSByZXF1aXJlKCdwYWtvJykKICAgKiBjb25zdCBjaHVuazEgPSBuZXcgVWludDhBcnJheShbMSwyLDMsNCw1LDYsNyw4LDldKQogICAqIGNvbnN0IGNodW5rMiA9IG5ldyBVaW50OEFycmF5KFsxMCwxMSwxMiwxMywxNCwxNSwxNiwxNywxOCwxOV0pOwogICAqCiAgICogY29uc3QgaW5mbGF0ZSA9IG5ldyBwYWtvLkluZmxhdGUoeyBsZXZlbDogM30pOwogICAqCiAgICogaW5mbGF0ZS5wdXNoKGNodW5rMSwgZmFsc2UpOwogICAqIGluZmxhdGUucHVzaChjaHVuazIsIHRydWUpOyAgLy8gdHJ1ZSAtPiBsYXN0IGNodW5rCiAgICoKICAgKiBpZiAoaW5mbGF0ZS5lcnIpIHsgdGhyb3cgbmV3IEVycm9yKGluZmxhdGUuZXJyKTsgfQogICAqCiAgICogY29uc29sZS5sb2coaW5mbGF0ZS5yZXN1bHQpOwogICAqIGBgYAogICAqKi8KICBmdW5jdGlvbiBJbmZsYXRlJDEob3B0aW9ucykgewogICAgdGhpcy5vcHRpb25zID0gY29tbW9uLmFzc2lnbih7CiAgICAgIGNodW5rU2l6ZTogMTAyNCAqIDY0LAogICAgICB3aW5kb3dCaXRzOiAxNSwKICAgICAgdG86ICcnCiAgICB9LCBvcHRpb25zIHx8IHt9KTsKCiAgICBjb25zdCBvcHQgPSB0aGlzLm9wdGlvbnM7CgogICAgLy8gRm9yY2Ugd2luZG93IHNpemUgZm9yIGByYXdgIGRhdGEsIGlmIG5vdCBzZXQgZGlyZWN0bHksCiAgICAvLyBiZWNhdXNlIHdlIGhhdmUgbm8gaGVhZGVyIGZvciBhdXRvZGV0ZWN0LgogICAgaWYgKG9wdC5yYXcgJiYgKG9wdC53aW5kb3dCaXRzID49IDApICYmIChvcHQud2luZG93Qml0cyA8IDE2KSkgewogICAgICBvcHQud2luZG93Qml0cyA9IC1vcHQud2luZG93Qml0czsKICAgICAgaWYgKG9wdC53aW5kb3dCaXRzID09PSAwKSB7IG9wdC53aW5kb3dCaXRzID0gLTE1OyB9CiAgICB9CgogICAgLy8gSWYgYHdpbmRvd0JpdHNgIG5vdCBkZWZpbmVkIChhbmQgbW9kZSBub3QgcmF3KSAtIHNldCBhdXRvZGV0ZWN0IGZsYWcgZm9yIGd6aXAvZGVmbGF0ZQogICAgaWYgKChvcHQud2luZG93Qml0cyA+PSAwKSAmJiAob3B0LndpbmRvd0JpdHMgPCAxNikgJiYKICAgICAgICAhKG9wdGlvbnMgJiYgb3B0aW9ucy53aW5kb3dCaXRzKSkgewogICAgICBvcHQud2luZG93Qml0cyArPSAzMjsKICAgIH0KCiAgICAvLyBHemlwIGhlYWRlciBoYXMgbm8gaW5mbyBhYm91dCB3aW5kb3dzIHNpemUsIHdlIGNhbiBkbyBhdXRvZGV0ZWN0IG9ubHkKICAgIC8vIGZvciBkZWZsYXRlLiBTbywgaWYgd2luZG93IHNpemUgbm90IHNldCwgZm9yY2UgaXQgdG8gbWF4IHdoZW4gZ3ppcCBwb3NzaWJsZQogICAgaWYgKChvcHQud2luZG93Qml0cyA+IDE1KSAmJiAob3B0LndpbmRvd0JpdHMgPCA0OCkpIHsKICAgICAgLy8gYml0IDMgKDE2KSAtPiBnemlwcGVkIGRhdGEKICAgICAgLy8gYml0IDQgKDMyKSAtPiBhdXRvZGV0ZWN0IGd6aXAvZGVmbGF0ZQogICAgICBpZiAoKG9wdC53aW5kb3dCaXRzICYgMTUpID09PSAwKSB7CiAgICAgICAgb3B0LndpbmRvd0JpdHMgfD0gMTU7CiAgICAgIH0KICAgIH0KCiAgICB0aGlzLmVyciAgICA9IDA7ICAgICAgLy8gZXJyb3IgY29kZSwgaWYgaGFwcGVucyAoMCA9IFpfT0spCiAgICB0aGlzLm1zZyAgICA9ICcnOyAgICAgLy8gZXJyb3IgbWVzc2FnZQogICAgdGhpcy5lbmRlZCAgPSBmYWxzZTsgIC8vIHVzZWQgdG8gYXZvaWQgbXVsdGlwbGUgb25FbmQoKSBjYWxscwogICAgdGhpcy5jaHVua3MgPSBbXTsgICAgIC8vIGNodW5rcyBvZiBjb21wcmVzc2VkIGRhdGEKCiAgICB0aGlzLnN0cm0gICA9IG5ldyB6c3RyZWFtKCk7CiAgICB0aGlzLnN0cm0uYXZhaWxfb3V0ID0gMDsKCiAgICBsZXQgc3RhdHVzICA9IGluZmxhdGVfMSQyLmluZmxhdGVJbml0MigKICAgICAgdGhpcy5zdHJtLAogICAgICBvcHQud2luZG93Qml0cwogICAgKTsKCiAgICBpZiAoc3RhdHVzICE9PSBaX09LKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlc1tzdGF0dXNdKTsKICAgIH0KCiAgICB0aGlzLmhlYWRlciA9IG5ldyBnemhlYWRlcigpOwoKICAgIGluZmxhdGVfMSQyLmluZmxhdGVHZXRIZWFkZXIodGhpcy5zdHJtLCB0aGlzLmhlYWRlcik7CgogICAgLy8gU2V0dXAgZGljdGlvbmFyeQogICAgaWYgKG9wdC5kaWN0aW9uYXJ5KSB7CiAgICAgIC8vIENvbnZlcnQgZGF0YSBpZiBuZWVkZWQKICAgICAgaWYgKHR5cGVvZiBvcHQuZGljdGlvbmFyeSA9PT0gJ3N0cmluZycpIHsKICAgICAgICBvcHQuZGljdGlvbmFyeSA9IHN0cmluZ3Muc3RyaW5nMmJ1ZihvcHQuZGljdGlvbmFyeSk7CiAgICAgIH0gZWxzZSBpZiAodG9TdHJpbmcuY2FsbChvcHQuZGljdGlvbmFyeSkgPT09ICdbb2JqZWN0IEFycmF5QnVmZmVyXScpIHsKICAgICAgICBvcHQuZGljdGlvbmFyeSA9IG5ldyBVaW50OEFycmF5KG9wdC5kaWN0aW9uYXJ5KTsKICAgICAgfQogICAgICBpZiAob3B0LnJhdykgeyAvL0luIHJhdyBtb2RlIHdlIG5lZWQgdG8gc2V0IHRoZSBkaWN0aW9uYXJ5IGVhcmx5CiAgICAgICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZVNldERpY3Rpb25hcnkodGhpcy5zdHJtLCBvcHQuZGljdGlvbmFyeSk7CiAgICAgICAgaWYgKHN0YXR1cyAhPT0gWl9PSykgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2VzW3N0YXR1c10pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogSW5mbGF0ZSNwdXNoKGRhdGFbLCBmbHVzaF9tb2RlXSkgLT4gQm9vbGVhbgogICAqIC0gZGF0YSAoVWludDhBcnJheXxBcnJheUJ1ZmZlcik6IGlucHV0IGRhdGEKICAgKiAtIGZsdXNoX21vZGUgKE51bWJlcnxCb29sZWFuKTogMC4uNiBmb3IgY29ycmVzcG9uZGluZyBaX05PX0ZMVVNILi5aX1RSRUUKICAgKiAgIGZsdXNoIG1vZGVzLiBTZWUgY29uc3RhbnRzLiBTa2lwcGVkIG9yIGBmYWxzZWAgbWVhbnMgWl9OT19GTFVTSCwKICAgKiAgIGB0cnVlYCBtZWFucyBaX0ZJTklTSC4KICAgKgogICAqIFNlbmRzIGlucHV0IGRhdGEgdG8gaW5mbGF0ZSBwaXBlLCBnZW5lcmF0aW5nIFtbSW5mbGF0ZSNvbkRhdGFdXSBjYWxscyB3aXRoCiAgICogbmV3IG91dHB1dCBjaHVua3MuIFJldHVybnMgYHRydWVgIG9uIHN1Y2Nlc3MuIElmIGVuZCBvZiBzdHJlYW0gZGV0ZWN0ZWQsCiAgICogW1tJbmZsYXRlI29uRW5kXV0gd2lsbCBiZSBjYWxsZWQuCiAgICoKICAgKiBgZmx1c2hfbW9kZWAgaXMgbm90IG5lZWRlZCBmb3Igbm9ybWFsIG9wZXJhdGlvbiwgYmVjYXVzZSBlbmQgb2Ygc3RyZWFtCiAgICogZGV0ZWN0ZWQgYXV0b21hdGljYWxseS4gWW91IG1heSB0cnkgdG8gdXNlIGl0IGZvciBhZHZhbmNlZCB0aGluZ3MsIGJ1dAogICAqIHRoaXMgZnVuY3Rpb25hbGl0eSB3YXMgbm90IHRlc3RlZC4KICAgKgogICAqIE9uIGZhaWwgY2FsbCBbW0luZmxhdGUjb25FbmRdXSB3aXRoIGVycm9yIGNvZGUgYW5kIHJldHVybiBmYWxzZS4KICAgKgogICAqICMjIyMjIEV4YW1wbGUKICAgKgogICAqIGBgYGphdmFzY3JpcHQKICAgKiBwdXNoKGNodW5rLCBmYWxzZSk7IC8vIHB1c2ggb25lIG9mIGRhdGEgY2h1bmtzCiAgICogLi4uCiAgICogcHVzaChjaHVuaywgdHJ1ZSk7ICAvLyBwdXNoIGxhc3QgY2h1bmsKICAgKiBgYGAKICAgKiovCiAgSW5mbGF0ZSQxLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gKGRhdGEsIGZsdXNoX21vZGUpIHsKICAgIGNvbnN0IHN0cm0gPSB0aGlzLnN0cm07CiAgICBjb25zdCBjaHVua1NpemUgPSB0aGlzLm9wdGlvbnMuY2h1bmtTaXplOwogICAgY29uc3QgZGljdGlvbmFyeSA9IHRoaXMub3B0aW9ucy5kaWN0aW9uYXJ5OwogICAgbGV0IHN0YXR1cywgX2ZsdXNoX21vZGUsIGxhc3RfYXZhaWxfb3V0OwoKICAgIGlmICh0aGlzLmVuZGVkKSByZXR1cm4gZmFsc2U7CgogICAgaWYgKGZsdXNoX21vZGUgPT09IH5+Zmx1c2hfbW9kZSkgX2ZsdXNoX21vZGUgPSBmbHVzaF9tb2RlOwogICAgZWxzZSBfZmx1c2hfbW9kZSA9IGZsdXNoX21vZGUgPT09IHRydWUgPyBaX0ZJTklTSCA6IFpfTk9fRkxVU0g7CgogICAgLy8gQ29udmVydCBkYXRhIGlmIG5lZWRlZAogICAgaWYgKHRvU3RyaW5nLmNhbGwoZGF0YSkgPT09ICdbb2JqZWN0IEFycmF5QnVmZmVyXScpIHsKICAgICAgc3RybS5pbnB1dCA9IG5ldyBVaW50OEFycmF5KGRhdGEpOwogICAgfSBlbHNlIHsKICAgICAgc3RybS5pbnB1dCA9IGRhdGE7CiAgICB9CgogICAgc3RybS5uZXh0X2luID0gMDsKICAgIHN0cm0uYXZhaWxfaW4gPSBzdHJtLmlucHV0Lmxlbmd0aDsKCiAgICBmb3IgKDs7KSB7CiAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCkgewogICAgICAgIHN0cm0ub3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkoY2h1bmtTaXplKTsKICAgICAgICBzdHJtLm5leHRfb3V0ID0gMDsKICAgICAgICBzdHJtLmF2YWlsX291dCA9IGNodW5rU2l6ZTsKICAgICAgfQoKICAgICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZShzdHJtLCBfZmx1c2hfbW9kZSk7CgogICAgICBpZiAoc3RhdHVzID09PSBaX05FRURfRElDVCAmJiBkaWN0aW9uYXJ5KSB7CiAgICAgICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZVNldERpY3Rpb25hcnkoc3RybSwgZGljdGlvbmFyeSk7CgogICAgICAgIGlmIChzdGF0dXMgPT09IFpfT0spIHsKICAgICAgICAgIHN0YXR1cyA9IGluZmxhdGVfMSQyLmluZmxhdGUoc3RybSwgX2ZsdXNoX21vZGUpOwogICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSBaX0RBVEFfRVJST1IpIHsKICAgICAgICAgIC8vIFJlcGxhY2UgY29kZSB3aXRoIG1vcmUgdmVyYm9zZQogICAgICAgICAgc3RhdHVzID0gWl9ORUVEX0RJQ1Q7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBTa2lwIHNueWMgbWFya2VycyBpZiBtb3JlIGRhdGEgZm9sbG93cyBhbmQgbm90IHJhdyBtb2RlCiAgICAgIHdoaWxlIChzdHJtLmF2YWlsX2luID4gMCAmJgogICAgICAgICAgICAgc3RhdHVzID09PSBaX1NUUkVBTV9FTkQgJiYKICAgICAgICAgICAgIHN0cm0uc3RhdGUud3JhcCA+IDAgJiYKICAgICAgICAgICAgIGRhdGFbc3RybS5uZXh0X2luXSAhPT0gMCkKICAgICAgewogICAgICAgIGluZmxhdGVfMSQyLmluZmxhdGVSZXNldChzdHJtKTsKICAgICAgICBzdGF0dXMgPSBpbmZsYXRlXzEkMi5pbmZsYXRlKHN0cm0sIF9mbHVzaF9tb2RlKTsKICAgICAgfQoKICAgICAgc3dpdGNoIChzdGF0dXMpIHsKICAgICAgICBjYXNlIFpfU1RSRUFNX0VSUk9SOgogICAgICAgIGNhc2UgWl9EQVRBX0VSUk9SOgogICAgICAgIGNhc2UgWl9ORUVEX0RJQ1Q6CiAgICAgICAgY2FzZSBaX01FTV9FUlJPUjoKICAgICAgICAgIHRoaXMub25FbmQoc3RhdHVzKTsKICAgICAgICAgIHRoaXMuZW5kZWQgPSB0cnVlOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICAvLyBSZW1lbWJlciByZWFsIGBhdmFpbF9vdXRgIHZhbHVlLCBiZWNhdXNlIHdlIG1heSBwYXRjaCBvdXQgYnVmZmVyIGNvbnRlbnQKICAgICAgLy8gdG8gYWxpZ24gdXRmOCBzdHJpbmdzIGJvdW5kYXJpZXMuCiAgICAgIGxhc3RfYXZhaWxfb3V0ID0gc3RybS5hdmFpbF9vdXQ7CgogICAgICBpZiAoc3RybS5uZXh0X291dCkgewogICAgICAgIGlmIChzdHJtLmF2YWlsX291dCA9PT0gMCB8fCBzdGF0dXMgPT09IFpfU1RSRUFNX0VORCkgewoKICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMudG8gPT09ICdzdHJpbmcnKSB7CgogICAgICAgICAgICBsZXQgbmV4dF9vdXRfdXRmOCA9IHN0cmluZ3MudXRmOGJvcmRlcihzdHJtLm91dHB1dCwgc3RybS5uZXh0X291dCk7CgogICAgICAgICAgICBsZXQgdGFpbCA9IHN0cm0ubmV4dF9vdXQgLSBuZXh0X291dF91dGY4OwogICAgICAgICAgICBsZXQgdXRmOHN0ciA9IHN0cmluZ3MuYnVmMnN0cmluZyhzdHJtLm91dHB1dCwgbmV4dF9vdXRfdXRmOCk7CgogICAgICAgICAgICAvLyBtb3ZlIHRhaWwgJiByZWFsaWduIGNvdW50ZXJzCiAgICAgICAgICAgIHN0cm0ubmV4dF9vdXQgPSB0YWlsOwogICAgICAgICAgICBzdHJtLmF2YWlsX291dCA9IGNodW5rU2l6ZSAtIHRhaWw7CiAgICAgICAgICAgIGlmICh0YWlsKSBzdHJtLm91dHB1dC5zZXQoc3RybS5vdXRwdXQuc3ViYXJyYXkobmV4dF9vdXRfdXRmOCwgbmV4dF9vdXRfdXRmOCArIHRhaWwpLCAwKTsKCiAgICAgICAgICAgIHRoaXMub25EYXRhKHV0ZjhzdHIpOwoKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMub25EYXRhKHN0cm0ub3V0cHV0Lmxlbmd0aCA9PT0gc3RybS5uZXh0X291dCA/IHN0cm0ub3V0cHV0IDogc3RybS5vdXRwdXQuc3ViYXJyYXkoMCwgc3RybS5uZXh0X291dCkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gTXVzdCByZXBlYXQgaXRlcmF0aW9uIGlmIG91dCBidWZmZXIgaXMgZnVsbAogICAgICBpZiAoc3RhdHVzID09PSBaX09LICYmIGxhc3RfYXZhaWxfb3V0ID09PSAwKSBjb250aW51ZTsKCiAgICAgIC8vIEZpbmFsaXplIGlmIGVuZCBvZiBzdHJlYW0gcmVhY2hlZC4KICAgICAgaWYgKHN0YXR1cyA9PT0gWl9TVFJFQU1fRU5EKSB7CiAgICAgICAgc3RhdHVzID0gaW5mbGF0ZV8xJDIuaW5mbGF0ZUVuZCh0aGlzLnN0cm0pOwogICAgICAgIHRoaXMub25FbmQoc3RhdHVzKTsKICAgICAgICB0aGlzLmVuZGVkID0gdHJ1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKHN0cm0uYXZhaWxfaW4gPT09IDApIGJyZWFrOwogICAgfQoKICAgIHJldHVybiB0cnVlOwogIH07CgoKICAvKioKICAgKiBJbmZsYXRlI29uRGF0YShjaHVuaykgLT4gVm9pZAogICAqIC0gY2h1bmsgKFVpbnQ4QXJyYXl8U3RyaW5nKTogb3V0cHV0IGRhdGEuIFdoZW4gc3RyaW5nIG91dHB1dCByZXF1ZXN0ZWQsCiAgICogICBlYWNoIGNodW5rIHdpbGwgYmUgc3RyaW5nLgogICAqCiAgICogQnkgZGVmYXVsdCwgc3RvcmVzIGRhdGEgYmxvY2tzIGluIGBjaHVua3NbXWAgcHJvcGVydHkgYW5kIGdsdWUKICAgKiB0aG9zZSBpbiBgb25FbmRgLiBPdmVycmlkZSB0aGlzIGhhbmRsZXIsIGlmIHlvdSBuZWVkIGFub3RoZXIgYmVoYXZpb3VyLgogICAqKi8KICBJbmZsYXRlJDEucHJvdG90eXBlLm9uRGF0YSA9IGZ1bmN0aW9uIChjaHVuaykgewogICAgdGhpcy5jaHVua3MucHVzaChjaHVuayk7CiAgfTsKCgogIC8qKgogICAqIEluZmxhdGUjb25FbmQoc3RhdHVzKSAtPiBWb2lkCiAgICogLSBzdGF0dXMgKE51bWJlcik6IGluZmxhdGUgc3RhdHVzLiAwIChaX09LKSBvbiBzdWNjZXNzLAogICAqICAgb3RoZXIgaWYgbm90LgogICAqCiAgICogQ2FsbGVkIGVpdGhlciBhZnRlciB5b3UgdGVsbCBpbmZsYXRlIHRoYXQgdGhlIGlucHV0IHN0cmVhbSBpcwogICAqIGNvbXBsZXRlIChaX0ZJTklTSCkuIEJ5IGRlZmF1bHQgLSBqb2luIGNvbGxlY3RlZCBjaHVua3MsCiAgICogZnJlZSBtZW1vcnkgYW5kIGZpbGwgYHJlc3VsdHNgIC8gYGVycmAgcHJvcGVydGllcy4KICAgKiovCiAgSW5mbGF0ZSQxLnByb3RvdHlwZS5vbkVuZCA9IGZ1bmN0aW9uIChzdGF0dXMpIHsKICAgIC8vIE9uIHN1Y2Nlc3MgLSBqb2luCiAgICBpZiAoc3RhdHVzID09PSBaX09LKSB7CiAgICAgIGlmICh0aGlzLm9wdGlvbnMudG8gPT09ICdzdHJpbmcnKSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSB0aGlzLmNodW5rcy5qb2luKCcnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJlc3VsdCA9IGNvbW1vbi5mbGF0dGVuQ2h1bmtzKHRoaXMuY2h1bmtzKTsKICAgICAgfQogICAgfQogICAgdGhpcy5jaHVua3MgPSBbXTsKICAgIHRoaXMuZXJyID0gc3RhdHVzOwogICAgdGhpcy5tc2cgPSB0aGlzLnN0cm0ubXNnOwogIH07CgoKICAvKioKICAgKiBpbmZsYXRlKGRhdGFbLCBvcHRpb25zXSkgLT4gVWludDhBcnJheXxTdHJpbmcKICAgKiAtIGRhdGEgKFVpbnQ4QXJyYXkpOiBpbnB1dCBkYXRhIHRvIGRlY29tcHJlc3MuCiAgICogLSBvcHRpb25zIChPYmplY3QpOiB6bGliIGluZmxhdGUgb3B0aW9ucy4KICAgKgogICAqIERlY29tcHJlc3MgYGRhdGFgIHdpdGggaW5mbGF0ZS91bmd6aXAgYW5kIGBvcHRpb25zYC4gQXV0b2RldGVjdAogICAqIGZvcm1hdCB2aWEgd3JhcHBlciBoZWFkZXIgYnkgZGVmYXVsdC4gVGhhdCdzIHdoeSB3ZSBkb24ndCBwcm92aWRlCiAgICogc2VwYXJhdGUgYHVuZ3ppcGAgbWV0aG9kLgogICAqCiAgICogU3VwcG9ydGVkIG9wdGlvbnMgYXJlOgogICAqCiAgICogLSB3aW5kb3dCaXRzCiAgICoKICAgKiBbaHR0cDovL3psaWIubmV0L21hbnVhbC5odG1sI0FkdmFuY2VkXShodHRwOi8vemxpYi5uZXQvbWFudWFsLmh0bWwjQWR2YW5jZWQpCiAgICogZm9yIG1vcmUgaW5mb3JtYXRpb24uCiAgICoKICAgKiBTdWdhciAob3B0aW9ucyk6CiAgICoKICAgKiAtIGByYXdgIChCb29sZWFuKSAtIHNheSB0aGF0IHdlIHdvcmsgd2l0aCByYXcgc3RyZWFtLCBpZiB5b3UgZG9uJ3Qgd2lzaCB0byBzcGVjaWZ5CiAgICogICBuZWdhdGl2ZSB3aW5kb3dCaXRzIGltcGxpY2l0bHkuCiAgICogLSBgdG9gIChTdHJpbmcpIC0gaWYgZXF1YWwgdG8gJ3N0cmluZycsIHRoZW4gcmVzdWx0IHdpbGwgYmUgY29udmVydGVkCiAgICogICBmcm9tIHV0ZjggdG8gdXRmMTYgKGphdmFzY3JpcHQpIHN0cmluZy4gV2hlbiBzdHJpbmcgb3V0cHV0IHJlcXVlc3RlZCwKICAgKiAgIGNodW5rIGxlbmd0aCBjYW4gZGlmZmVyIGZyb20gYGNodW5rU2l6ZWAsIGRlcGVuZGluZyBvbiBjb250ZW50LgogICAqCiAgICoKICAgKiAjIyMjIyBFeGFtcGxlOgogICAqCiAgICogYGBgamF2YXNjcmlwdAogICAqIGNvbnN0IHBha28gPSByZXF1aXJlKCdwYWtvJyk7CiAgICogY29uc3QgaW5wdXQgPSBwYWtvLmRlZmxhdGUobmV3IFVpbnQ4QXJyYXkoWzEsMiwzLDQsNSw2LDcsOCw5XSkpOwogICAqIGxldCBvdXRwdXQ7CiAgICoKICAgKiB0cnkgewogICAqICAgb3V0cHV0ID0gcGFrby5pbmZsYXRlKGlucHV0KTsKICAgKiB9IGNhdGNoIChlcnIpIHsKICAgKiAgIGNvbnNvbGUubG9nKGVycik7CiAgICogfQogICAqIGBgYAogICAqKi8KICBmdW5jdGlvbiBpbmZsYXRlJDEoaW5wdXQsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGluZmxhdG9yID0gbmV3IEluZmxhdGUkMShvcHRpb25zKTsKCiAgICBpbmZsYXRvci5wdXNoKGlucHV0KTsKCiAgICAvLyBUaGF0IHdpbGwgbmV2ZXIgaGFwcGVucywgaWYgeW91IGRvbid0IGNoZWF0IHdpdGggb3B0aW9ucyA6KQogICAgaWYgKGluZmxhdG9yLmVycikgdGhyb3cgaW5mbGF0b3IubXNnIHx8IG1lc3NhZ2VzW2luZmxhdG9yLmVycl07CgogICAgcmV0dXJuIGluZmxhdG9yLnJlc3VsdDsKICB9CgoKICAvKioKICAgKiBpbmZsYXRlUmF3KGRhdGFbLCBvcHRpb25zXSkgLT4gVWludDhBcnJheXxTdHJpbmcKICAgKiAtIGRhdGEgKFVpbnQ4QXJyYXkpOiBpbnB1dCBkYXRhIHRvIGRlY29tcHJlc3MuCiAgICogLSBvcHRpb25zIChPYmplY3QpOiB6bGliIGluZmxhdGUgb3B0aW9ucy4KICAgKgogICAqIFRoZSBzYW1lIGFzIFtbaW5mbGF0ZV1dLCBidXQgY3JlYXRlcyByYXcgZGF0YSwgd2l0aG91dCB3cmFwcGVyCiAgICogKGhlYWRlciBhbmQgYWRsZXIzMiBjcmMpLgogICAqKi8KICBmdW5jdGlvbiBpbmZsYXRlUmF3JDEoaW5wdXQsIG9wdGlvbnMpIHsKICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgb3B0aW9ucy5yYXcgPSB0cnVlOwogICAgcmV0dXJuIGluZmxhdGUkMShpbnB1dCwgb3B0aW9ucyk7CiAgfQoKCiAgLyoqCiAgICogdW5nemlwKGRhdGFbLCBvcHRpb25zXSkgLT4gVWludDhBcnJheXxTdHJpbmcKICAgKiAtIGRhdGEgKFVpbnQ4QXJyYXkpOiBpbnB1dCBkYXRhIHRvIGRlY29tcHJlc3MuCiAgICogLSBvcHRpb25zIChPYmplY3QpOiB6bGliIGluZmxhdGUgb3B0aW9ucy4KICAgKgogICAqIEp1c3Qgc2hvcnRjdXQgdG8gW1tpbmZsYXRlXV0sIGJlY2F1c2UgaXQgYXV0b2RldGVjdHMgZm9ybWF0CiAgICogYnkgaGVhZGVyLmNvbnRlbnQuIERvbmUgZm9yIGNvbnZlbmllbmNlLgogICAqKi8KCgogIHZhciBJbmZsYXRlXzEkMSA9IEluZmxhdGUkMTsKICB2YXIgaW5mbGF0ZV8yID0gaW5mbGF0ZSQxOwogIHZhciBpbmZsYXRlUmF3XzEkMSA9IGluZmxhdGVSYXckMTsKICB2YXIgdW5nemlwJDEgPSBpbmZsYXRlJDE7CiAgdmFyIGNvbnN0YW50cyA9IGNvbnN0YW50cyQyOwoKICB2YXIgaW5mbGF0ZV8xJDEgPSB7CiAgCUluZmxhdGU6IEluZmxhdGVfMSQxLAogIAlpbmZsYXRlOiBpbmZsYXRlXzIsCiAgCWluZmxhdGVSYXc6IGluZmxhdGVSYXdfMSQxLAogIAl1bmd6aXA6IHVuZ3ppcCQxLAogIAljb25zdGFudHM6IGNvbnN0YW50cwogIH07CgogIGNvbnN0IHsgSW5mbGF0ZSwgaW5mbGF0ZSwgaW5mbGF0ZVJhdywgdW5nemlwIH0gPSBpbmZsYXRlXzEkMTsKICB2YXIgaW5mbGF0ZV8xID0gaW5mbGF0ZTsKCiAgY2xhc3MgRGVmbGF0ZURlY29kZXIgZXh0ZW5kcyBCYXNlRGVjb2RlciB7CiAgICBkZWNvZGVCbG9jayhidWZmZXIpIHsKICAgICAgcmV0dXJuIGluZmxhdGVfMShuZXcgVWludDhBcnJheShidWZmZXIpKS5idWZmZXI7CiAgICB9CiAgfQoKICBjbGFzcyBQYWNrYml0c0RlY29kZXIgZXh0ZW5kcyBCYXNlRGVjb2RlciB7CiAgICBkZWNvZGVCbG9jayhidWZmZXIpIHsKICAgICAgY29uc3QgZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcoYnVmZmVyKTsKICAgICAgY29uc3Qgb3V0ID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJ1ZmZlci5ieXRlTGVuZ3RoOyArK2kpIHsKICAgICAgICBsZXQgaGVhZGVyID0gZGF0YVZpZXcuZ2V0SW50OChpKTsKICAgICAgICBpZiAoaGVhZGVyIDwgMCkgewogICAgICAgICAgY29uc3QgbmV4dCA9IGRhdGFWaWV3LmdldFVpbnQ4KGkgKyAxKTsKICAgICAgICAgIGhlYWRlciA9IC1oZWFkZXI7CiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8PSBoZWFkZXI7ICsraikgewogICAgICAgICAgICBvdXQucHVzaChuZXh0KTsKICAgICAgICAgIH0KICAgICAgICAgIGkgKz0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPD0gaGVhZGVyOyArK2opIHsKICAgICAgICAgICAgb3V0LnB1c2goZGF0YVZpZXcuZ2V0VWludDgoaSArIGogKyAxKSk7CiAgICAgICAgICB9CiAgICAgICAgICBpICs9IGhlYWRlciArIDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBuZXcgVWludDhBcnJheShvdXQpLmJ1ZmZlcjsKICAgIH0KICB9CgogIHZhciBMZXJjRGVjb2RlID0ge2V4cG9ydHM6IHt9fTsKCiAgLyoganNoaW50IGZvcmluOiBmYWxzZSwgYml0d2lzZTogZmFsc2UgKi8KCiAgKGZ1bmN0aW9uIChtb2R1bGUpIHsKICAvKgogIENvcHlyaWdodCAyMDE1LTIwMTggRXNyaQoKICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CgogIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAoKICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCgogIEEgY29weSBvZiB0aGUgbGljZW5zZSBhbmQgYWRkaXRpb25hbCBub3RpY2VzIGFyZSBsb2NhdGVkIHdpdGggdGhlCiAgc291cmNlIGRpc3RyaWJ1dGlvbiBhdDoKCiAgaHR0cDovL2dpdGh1Yi5jb20vRXNyaS9sZXJjLwoKICBDb250cmlidXRvcnM6ICBKb2hhbm5lcyBTY2htaWQsIChMRVJDIHYxKQogICAgICAgICAgICAgICAgIENoYXlhbmlrYSBLaGF0dWEsIChMRVJDIHYxKQogICAgICAgICAgICAgICAgIFdlbnh1ZSBKdSAoTEVSQyB2MSwgdjIueCkKICAqLwoKICAvKiBDb3B5cmlnaHQgMjAxNS0yMDE4IEVzcmkuIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdCBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAgQHByZXNlcnZlICovCgogIC8qKgogICAqIGEgbW9kdWxlIGZvciBkZWNvZGluZyBMRVJDIGJsb2JzCiAgICogQG1vZHVsZSBMZXJjCiAgICovCiAgKGZ1bmN0aW9uKCkgewogICAgLy90aGUgb3JpZ2luYWwgTGVyY0RlY29kZSBmb3IgVmVyc2lvbiAxCiAgICB2YXIgTGVyY0RlY29kZSA9IChmdW5jdGlvbigpIHsKCiAgICAgIC8vIFdBUk5JTkc6IFRoaXMgZGVjb2RlciB2ZXJzaW9uIGNhbiBvbmx5IHJlYWQgb2xkIHZlcnNpb24gMSBMZXJjIGJsb2JzLiBVc2Ugd2l0aCBjYXV0aW9uLgoKICAgICAgLy8gTm90ZTogY3VycmVudGx5LCB0aGlzIG1vZHVsZSBvbmx5IGhhcyBhbiBpbXBsZW1lbnRhdGlvbiBmb3IgZGVjb2RpbmcgTEVSQyBkYXRhLCBub3QgZW5jb2RpbmcuIFRoZSBuYW1lIG9mCiAgICAgIC8vIHRoZSBjbGFzcyB3YXMgY2hvc2VuIHRvIGJlIGZ1dHVyZSBwcm9vZi4KCiAgICAgIHZhciBDbnRaSW1hZ2UgPSB7fTsKCiAgICAgIENudFpJbWFnZS5kZWZhdWx0Tm9EYXRhVmFsdWUgPSAtMy40MDI3OTk5Mzg3OTAxNDg0ZSszODsgLy8gc21hbGxlc3QgRmxvYXQzMiB2YWx1ZQoKICAgICAgLyoqCiAgICAgICAqIERlY29kZSBhIExFUkMgYnl0ZSBzdHJlYW0gYW5kIHJldHVybiBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgcGl4ZWwgZGF0YSBhbmQgc29tZSByZXF1aXJlZCBhbmQgb3B0aW9uYWwKICAgICAgICogaW5mb3JtYXRpb24gYWJvdXQgaXQsIHN1Y2ggYXMgdGhlIGltYWdlJ3Mgd2lkdGggYW5kIGhlaWdodC4KICAgICAgICoKICAgICAgICogQHBhcmFtIHtBcnJheUJ1ZmZlcn0gaW5wdXQgVGhlIExFUkMgaW5wdXQgYnl0ZSBzdHJlYW0KICAgICAgICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zXSBEZWNvZGluZyBvcHRpb25zLCBjb250YWluaW5nIGFueSBvZiB0aGUgZm9sbG93aW5nIHByb3BlcnRpZXM6CiAgICAgICAqIEBjb25maWcge251bWJlcn0gW2lucHV0T2Zmc2V0ID0gMF0KICAgICAgICogICAgICAgIFNraXAgdGhlIGZpcnN0IGlucHV0T2Zmc2V0IGJ5dGVzIG9mIHRoZSBpbnB1dCBieXRlIHN0cmVhbS4gQSB2YWxpZCBMRVJDIGZpbGUgaXMgZXhwZWN0ZWQgYXQgdGhhdCBwb3NpdGlvbi4KICAgICAgICogQGNvbmZpZyB7VWludDhBcnJheX0gW2VuY29kZWRNYXNrID0gbnVsbF0KICAgICAgICogICAgICAgIElmIHNwZWNpZmllZCwgdGhlIGRlY29kZXIgd2lsbCBub3QgcmVhZCBtYXNrIGluZm9ybWF0aW9uIGZyb20gdGhlIGlucHV0IGFuZCB1c2UgdGhlIHNwZWNpZmllZCBlbmNvZGVkCiAgICAgICAqICAgICAgICBtYXNrIGRhdGEgaW5zdGVhZC4gTWFzayBoZWFkZXIvZGF0YSBtdXN0IG5vdCBiZSBwcmVzZW50IGluIHRoZSBMRVJDIGJ5dGUgc3RyZWFtIGluIHRoaXMgY2FzZS4KICAgICAgICogQGNvbmZpZyB7bnVtYmVyfSBbbm9EYXRhVmFsdWUgPSBMZXJjQ29kZS5kZWZhdWx0Tm9EYXRhVmFsdWVdCiAgICAgICAqICAgICAgICBQaXhlbCB2YWx1ZSB0byB1c2UgZm9yIG1hc2tlZCBwaXhlbHMuCiAgICAgICAqIEBjb25maWcge0FycmF5QnVmZmVyVmlld3xBcnJheX0gW3BpeGVsVHlwZSA9IEZsb2F0MzJBcnJheV0KICAgICAgICogICAgICAgIFRoZSBkZXNpcmVkIHR5cGUgb2YgdGhlIHBpeGVsRGF0YSBhcnJheSBpbiB0aGUgcmV0dXJuIHZhbHVlLiBOb3RlIHRoYXQgaXQgaXMgdGhlIGNhbGxlcidzIHJlc3BvbnNpYmlsaXR5IHRvCiAgICAgICAqICAgICAgICBwcm92aWRlIGFuIGFwcHJvcHJpYXRlIG5vRGF0YVZhbHVlIGlmIHRoZSBkZWZhdWx0IHBpeGVsVHlwZSBpcyBvdmVycmlkZGVuLgogICAgICAgKiBAY29uZmlnIHtib29sZWFufSBbcmV0dXJuTWFzayA9IGZhbHNlXQogICAgICAgKiAgICAgICAgSWYgdHJ1ZSwgdGhlIHJldHVybiB2YWx1ZSB3aWxsIGNvbnRhaW4gYSBtYXNrRGF0YSBwcm9wZXJ0eSBvZiB0eXBlIFVpbnQ4QXJyYXkgd2hpY2ggaGFzIG9uZSBlbGVtZW50IHBlcgogICAgICAgKiAgICAgICAgcGl4ZWwsIHRoZSB2YWx1ZSBvZiB3aGljaCBpcyAxIG9yIDAgZGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhhdCBwaXhlbCdzIGRhdGEgaXMgcHJlc2VudCBvciBtYXNrZWQuIElmIHRoZQogICAgICAgKiAgICAgICAgaW5wdXQgTEVSQyBkYXRhIGRvZXMgbm90IGNvbnRhaW4gYSBtYXNrLCBtYXNrRGF0YSB3aWxsIG5vdCBiZSByZXR1cm5lZC4KICAgICAgICogQGNvbmZpZyB7Ym9vbGVhbn0gW3JldHVybkVuY29kZWRNYXNrID0gZmFsc2VdCiAgICAgICAqICAgICAgICBJZiB0cnVlLCB0aGUgcmV0dXJuIHZhbHVlIHdpbGwgY29udGFpbiBhIGVuY29kZWRNYXNrRGF0YSBwcm9wZXJ0eSwgd2hpY2ggY2FuIGJlIHBhc3NlZCBpbnRvIGVuY29kZSgpIGFzCiAgICAgICAqICAgICAgICBlbmNvZGVkTWFzay4KICAgICAgICogQGNvbmZpZyB7Ym9vbGVhbn0gW3JldHVybkZpbGVJbmZvID0gZmFsc2VdCiAgICAgICAqICAgICAgICBJZiB0cnVlLCB0aGUgcmV0dXJuIHZhbHVlIHdpbGwgaGF2ZSBhIGZpbGVJbmZvIHByb3BlcnR5IHRoYXQgY29udGFpbnMgbWV0YWRhdGEgb2J0YWluZWQgZnJvbSB0aGUKICAgICAgICogICAgICAgIExFUkMgaGVhZGVycyBhbmQgdGhlIGRlY29kaW5nIHByb2Nlc3MuCiAgICAgICAqIEBjb25maWcge2Jvb2xlYW59IFtjb21wdXRlVXNlZEJpdERlcHRocyA9IGZhbHNlXQogICAgICAgKiAgICAgICAgSWYgdHJ1ZSwgdGhlIGZpbGVJbmZvIHByb3BlcnR5IGluIHRoZSByZXR1cm4gdmFsdWUgd2lsbCBjb250YWluIHRoZSBzZXQgb2YgYWxsIGJsb2NrIGJpdCBkZXB0aHMKICAgICAgICogICAgICAgIGVuY291bnRlcmVkIGR1cmluZyBkZWNvZGluZy4gV2lsbCBvbmx5IGhhdmUgYW4gZWZmZWN0IGlmIHJldHVybkZpbGVJbmZvIG9wdGlvbiBpcyB0cnVlLgogICAgICAgKiBAcmV0dXJucyB7e3dpZHRoLCBoZWlnaHQsIHBpeGVsRGF0YSwgbWluVmFsdWUsIG1heFZhbHVlLCBub0RhdGFWYWx1ZSwgbWFza0RhdGEsIGVuY29kZWRNYXNrRGF0YSwgZmlsZUluZm99fQogICAgICAgKi8KICAgICAgQ250WkltYWdlLmRlY29kZSA9IGZ1bmN0aW9uKGlucHV0LCBvcHRpb25zKSB7CiAgICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgogICAgICAgIHZhciBza2lwTWFzayA9IG9wdGlvbnMuZW5jb2RlZE1hc2tEYXRhIHx8IChvcHRpb25zLmVuY29kZWRNYXNrRGF0YSA9PT0gbnVsbCk7CiAgICAgICAgdmFyIHBhcnNlZERhdGEgPSBwYXJzZShpbnB1dCwgb3B0aW9ucy5pbnB1dE9mZnNldCB8fCAwLCBza2lwTWFzayk7CgogICAgICAgIHZhciBub0RhdGFWYWx1ZSA9IChvcHRpb25zLm5vRGF0YVZhbHVlICE9PSBudWxsKSA/IG9wdGlvbnMubm9EYXRhVmFsdWUgOiBDbnRaSW1hZ2UuZGVmYXVsdE5vRGF0YVZhbHVlOwoKICAgICAgICB2YXIgdW5jb21wcmVzc2VkRGF0YSA9IHVuY29tcHJlc3NQaXhlbFZhbHVlcyhwYXJzZWREYXRhLCBvcHRpb25zLnBpeGVsVHlwZSB8fCBGbG9hdDMyQXJyYXksCiAgICAgICAgICBvcHRpb25zLmVuY29kZWRNYXNrRGF0YSwgbm9EYXRhVmFsdWUsIG9wdGlvbnMucmV0dXJuTWFzayk7CgogICAgICAgIHZhciByZXN1bHQgPSB7CiAgICAgICAgICB3aWR0aDogcGFyc2VkRGF0YS53aWR0aCwKICAgICAgICAgIGhlaWdodDogcGFyc2VkRGF0YS5oZWlnaHQsCiAgICAgICAgICBwaXhlbERhdGE6IHVuY29tcHJlc3NlZERhdGEucmVzdWx0UGl4ZWxzLAogICAgICAgICAgbWluVmFsdWU6IHVuY29tcHJlc3NlZERhdGEubWluVmFsdWUsCiAgICAgICAgICBtYXhWYWx1ZTogcGFyc2VkRGF0YS5waXhlbHMubWF4VmFsdWUsCiAgICAgICAgICBub0RhdGFWYWx1ZTogbm9EYXRhVmFsdWUKICAgICAgICB9OwoKICAgICAgICBpZiAodW5jb21wcmVzc2VkRGF0YS5yZXN1bHRNYXNrKSB7CiAgICAgICAgICByZXN1bHQubWFza0RhdGEgPSB1bmNvbXByZXNzZWREYXRhLnJlc3VsdE1hc2s7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy5yZXR1cm5FbmNvZGVkTWFzayAmJiBwYXJzZWREYXRhLm1hc2spIHsKICAgICAgICAgIHJlc3VsdC5lbmNvZGVkTWFza0RhdGEgPSBwYXJzZWREYXRhLm1hc2suYml0c2V0ID8gcGFyc2VkRGF0YS5tYXNrLmJpdHNldCA6IG51bGw7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy5yZXR1cm5GaWxlSW5mbykgewogICAgICAgICAgcmVzdWx0LmZpbGVJbmZvID0gZm9ybWF0RmlsZUluZm8ocGFyc2VkRGF0YSk7CiAgICAgICAgICBpZiAob3B0aW9ucy5jb21wdXRlVXNlZEJpdERlcHRocykgewogICAgICAgICAgICByZXN1bHQuZmlsZUluZm8uYml0RGVwdGhzID0gY29tcHV0ZVVzZWRCaXREZXB0aHMocGFyc2VkRGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwoKICAgICAgdmFyIHVuY29tcHJlc3NQaXhlbFZhbHVlcyA9IGZ1bmN0aW9uKGRhdGEsIFR5cGVkQXJyYXlDbGFzcywgbWFza0JpdHNldCwgbm9EYXRhVmFsdWUsIHN0b3JlRGVjb2RlZE1hc2spIHsKICAgICAgICB2YXIgYmxvY2tJZHggPSAwOwogICAgICAgIHZhciBudW1YID0gZGF0YS5waXhlbHMubnVtQmxvY2tzWDsKICAgICAgICB2YXIgbnVtWSA9IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1k7CiAgICAgICAgdmFyIGJsb2NrV2lkdGggPSBNYXRoLmZsb29yKGRhdGEud2lkdGggLyBudW1YKTsKICAgICAgICB2YXIgYmxvY2tIZWlnaHQgPSBNYXRoLmZsb29yKGRhdGEuaGVpZ2h0IC8gbnVtWSk7CiAgICAgICAgdmFyIHNjYWxlID0gMiAqIGRhdGEubWF4WkVycm9yOwogICAgICAgIHZhciBtaW5WYWx1ZSA9IE51bWJlci5NQVhfVkFMVUUsIGN1cnJlbnRWYWx1ZTsKICAgICAgICBtYXNrQml0c2V0ID0gbWFza0JpdHNldCB8fCAoKGRhdGEubWFzaykgPyBkYXRhLm1hc2suYml0c2V0IDogbnVsbCk7CgogICAgICAgIHZhciByZXN1bHRQaXhlbHMsIHJlc3VsdE1hc2s7CiAgICAgICAgcmVzdWx0UGl4ZWxzID0gbmV3IFR5cGVkQXJyYXlDbGFzcyhkYXRhLndpZHRoICogZGF0YS5oZWlnaHQpOwogICAgICAgIGlmIChzdG9yZURlY29kZWRNYXNrICYmIG1hc2tCaXRzZXQpIHsKICAgICAgICAgIHJlc3VsdE1hc2sgPSBuZXcgVWludDhBcnJheShkYXRhLndpZHRoICogZGF0YS5oZWlnaHQpOwogICAgICAgIH0KICAgICAgICB2YXIgYmxvY2tEYXRhQnVmZmVyID0gbmV3IEZsb2F0MzJBcnJheShibG9ja1dpZHRoICogYmxvY2tIZWlnaHQpOwoKICAgICAgICB2YXIgeHgsIHl5OwogICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDw9IG51bVk7IHkrKykgewogICAgICAgICAgdmFyIHRoaXNCbG9ja0hlaWdodCA9ICh5ICE9PSBudW1ZKSA/IGJsb2NrSGVpZ2h0IDogKGRhdGEuaGVpZ2h0ICUgbnVtWSk7CiAgICAgICAgICBpZiAodGhpc0Jsb2NrSGVpZ2h0ID09PSAwKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPD0gbnVtWDsgeCsrKSB7CiAgICAgICAgICAgIHZhciB0aGlzQmxvY2tXaWR0aCA9ICh4ICE9PSBudW1YKSA/IGJsb2NrV2lkdGggOiAoZGF0YS53aWR0aCAlIG51bVgpOwogICAgICAgICAgICBpZiAodGhpc0Jsb2NrV2lkdGggPT09IDApIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIG91dFB0ciA9IHkgKiBkYXRhLndpZHRoICogYmxvY2tIZWlnaHQgKyB4ICogYmxvY2tXaWR0aDsKICAgICAgICAgICAgdmFyIG91dFN0cmlkZSA9IGRhdGEud2lkdGggLSB0aGlzQmxvY2tXaWR0aDsKCiAgICAgICAgICAgIHZhciBibG9jayA9IGRhdGEucGl4ZWxzLmJsb2Nrc1tibG9ja0lkeF07CgogICAgICAgICAgICB2YXIgYmxvY2tEYXRhLCBibG9ja1B0ciwgY29uc3RWYWx1ZTsKICAgICAgICAgICAgaWYgKGJsb2NrLmVuY29kaW5nIDwgMikgewogICAgICAgICAgICAgIC8vIGJsb2NrIGlzIGVpdGhlciB1bmNvbXByZXNzZWQgb3IgYml0LXN0dWZmZWQgKGVuY29kaW5ncyAwIGFuZCAxKQogICAgICAgICAgICAgIGlmIChibG9jay5lbmNvZGluZyA9PT0gMCkgewogICAgICAgICAgICAgICAgLy8gYmxvY2sgaXMgdW5jb21wcmVzc2VkCiAgICAgICAgICAgICAgICBibG9ja0RhdGEgPSBibG9jay5yYXdEYXRhOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBibG9jayBpcyBiaXQtc3R1ZmZlZAogICAgICAgICAgICAgICAgdW5zdHVmZihibG9jay5zdHVmZmVkRGF0YSwgYmxvY2suYml0c1BlclBpeGVsLCBibG9jay5udW1WYWxpZFBpeGVscywgYmxvY2sub2Zmc2V0LCBzY2FsZSwgYmxvY2tEYXRhQnVmZmVyLCBkYXRhLnBpeGVscy5tYXhWYWx1ZSk7CiAgICAgICAgICAgICAgICBibG9ja0RhdGEgPSBibG9ja0RhdGFCdWZmZXI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJsb2NrUHRyID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmIChibG9jay5lbmNvZGluZyA9PT0gMikgewogICAgICAgICAgICAgIC8vIGJsb2NrIGlzIGFsbCAwCiAgICAgICAgICAgICAgY29uc3RWYWx1ZSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgLy8gYmxvY2sgaGFzIGNvbnN0YW50IHZhbHVlIChlbmNvZGluZyA9PT0gMykKICAgICAgICAgICAgICBjb25zdFZhbHVlID0gYmxvY2sub2Zmc2V0OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbWFza0J5dGU7CiAgICAgICAgICAgIGlmIChtYXNrQml0c2V0KSB7CiAgICAgICAgICAgICAgZm9yICh5eSA9IDA7IHl5IDwgdGhpc0Jsb2NrSGVpZ2h0OyB5eSsrKSB7CiAgICAgICAgICAgICAgICBpZiAob3V0UHRyICYgNykgewogICAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgICBtYXNrQnl0ZSA9IG1hc2tCaXRzZXRbb3V0UHRyID4+IDNdOwogICAgICAgICAgICAgICAgICBtYXNrQnl0ZSA8PD0gb3V0UHRyICYgNzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAoeHggPSAwOyB4eCA8IHRoaXNCbG9ja1dpZHRoOyB4eCsrKSB7CiAgICAgICAgICAgICAgICAgIGlmICghKG91dFB0ciAmIDcpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gcmVhZCBuZXh0IGJ5dGUgZnJvbSBtYXNrCiAgICAgICAgICAgICAgICAgICAgbWFza0J5dGUgPSBtYXNrQml0c2V0W291dFB0ciA+PiAzXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAobWFza0J5dGUgJiAxMjgpIHsKICAgICAgICAgICAgICAgICAgICAvLyBwaXhlbCBkYXRhIHByZXNlbnQKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0TWFzaykgewogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0TWFza1tvdXRQdHJdID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gKGJsb2NrLmVuY29kaW5nIDwgMikgPyBibG9ja0RhdGFbYmxvY2tQdHIrK10gOiBjb25zdFZhbHVlOwogICAgICAgICAgICAgICAgICAgIG1pblZhbHVlID0gbWluVmFsdWUgPiBjdXJyZW50VmFsdWUgPyBjdXJyZW50VmFsdWUgOiBtaW5WYWx1ZTsKICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNbb3V0UHRyKytdID0gY3VycmVudFZhbHVlOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIHBpeGVsIGRhdGEgbm90IHByZXNlbnQKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0TWFzaykgewogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0TWFza1tvdXRQdHJdID0gMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW291dFB0cisrXSA9IG5vRGF0YVZhbHVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIG1hc2tCeXRlIDw8PSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gbWFzayBub3QgcHJlc2VudCwgc2ltcGx5IGNvcHkgYmxvY2sgb3ZlcgogICAgICAgICAgICAgIGlmIChibG9jay5lbmNvZGluZyA8IDIpIHsKICAgICAgICAgICAgICAgIC8vIGR1cGxpY2F0aW5nIHRoaXMgY29kZSBibG9jayBmb3IgcGVyZm9ybWFuY2UgcmVhc29ucwogICAgICAgICAgICAgICAgLy8gYmxvY2tEYXRhIGNhc2U6CiAgICAgICAgICAgICAgICBmb3IgKHl5ID0gMDsgeXkgPCB0aGlzQmxvY2tIZWlnaHQ7IHl5KyspIHsKICAgICAgICAgICAgICAgICAgZm9yICh4eCA9IDA7IHh4IDwgdGhpc0Jsb2NrV2lkdGg7IHh4KyspIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50VmFsdWUgPSBibG9ja0RhdGFbYmxvY2tQdHIrK107CiAgICAgICAgICAgICAgICAgICAgbWluVmFsdWUgPSBtaW5WYWx1ZSA+IGN1cnJlbnRWYWx1ZSA/IGN1cnJlbnRWYWx1ZSA6IG1pblZhbHVlOwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHIrK10gPSBjdXJyZW50VmFsdWU7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBjb25zdFZhbHVlIGNhc2U6CiAgICAgICAgICAgICAgICBtaW5WYWx1ZSA9IG1pblZhbHVlID4gY29uc3RWYWx1ZSA/IGNvbnN0VmFsdWUgOiBtaW5WYWx1ZTsKICAgICAgICAgICAgICAgIGZvciAoeXkgPSAwOyB5eSA8IHRoaXNCbG9ja0hlaWdodDsgeXkrKykgewogICAgICAgICAgICAgICAgICBmb3IgKHh4ID0gMDsgeHggPCB0aGlzQmxvY2tXaWR0aDsgeHgrKykgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHIrK10gPSBjb25zdFZhbHVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIG91dFB0ciArPSBvdXRTdHJpZGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoYmxvY2suZW5jb2RpbmcgPT09IDEpICYmIChibG9ja1B0ciAhPT0gYmxvY2subnVtVmFsaWRQaXhlbHMpKSB7CiAgICAgICAgICAgICAgdGhyb3cgIkJsb2NrIGFuZCBNYXNrIGRvIG5vdCBtYXRjaCI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYmxvY2tJZHgrKzsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICByZXN1bHRQaXhlbHM6IHJlc3VsdFBpeGVscywKICAgICAgICAgIHJlc3VsdE1hc2s6IHJlc3VsdE1hc2ssCiAgICAgICAgICBtaW5WYWx1ZTogbWluVmFsdWUKICAgICAgICB9OwogICAgICB9OwoKICAgICAgdmFyIGZvcm1hdEZpbGVJbmZvID0gZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAiZmlsZUlkZW50aWZpZXJTdHJpbmciOiBkYXRhLmZpbGVJZGVudGlmaWVyU3RyaW5nLAogICAgICAgICAgImZpbGVWZXJzaW9uIjogZGF0YS5maWxlVmVyc2lvbiwKICAgICAgICAgICJpbWFnZVR5cGUiOiBkYXRhLmltYWdlVHlwZSwKICAgICAgICAgICJoZWlnaHQiOiBkYXRhLmhlaWdodCwKICAgICAgICAgICJ3aWR0aCI6IGRhdGEud2lkdGgsCiAgICAgICAgICAibWF4WkVycm9yIjogZGF0YS5tYXhaRXJyb3IsCiAgICAgICAgICAiZW9mT2Zmc2V0IjogZGF0YS5lb2ZPZmZzZXQsCiAgICAgICAgICAibWFzayI6IGRhdGEubWFzayA/IHsKICAgICAgICAgICAgIm51bUJsb2Nrc1giOiBkYXRhLm1hc2subnVtQmxvY2tzWCwKICAgICAgICAgICAgIm51bUJsb2Nrc1kiOiBkYXRhLm1hc2subnVtQmxvY2tzWSwKICAgICAgICAgICAgIm51bUJ5dGVzIjogZGF0YS5tYXNrLm51bUJ5dGVzLAogICAgICAgICAgICAibWF4VmFsdWUiOiBkYXRhLm1hc2subWF4VmFsdWUKICAgICAgICAgIH0gOiBudWxsLAogICAgICAgICAgInBpeGVscyI6IHsKICAgICAgICAgICAgIm51bUJsb2Nrc1giOiBkYXRhLnBpeGVscy5udW1CbG9ja3NYLAogICAgICAgICAgICAibnVtQmxvY2tzWSI6IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1ksCiAgICAgICAgICAgICJudW1CeXRlcyI6IGRhdGEucGl4ZWxzLm51bUJ5dGVzLAogICAgICAgICAgICAibWF4VmFsdWUiOiBkYXRhLnBpeGVscy5tYXhWYWx1ZSwKICAgICAgICAgICAgIm5vRGF0YVZhbHVlIjogZGF0YS5ub0RhdGFWYWx1ZQogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH07CgogICAgICB2YXIgY29tcHV0ZVVzZWRCaXREZXB0aHMgPSBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgdmFyIG51bUJsb2NrcyA9IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1ggKiBkYXRhLnBpeGVscy5udW1CbG9ja3NZOwogICAgICAgIHZhciBiaXREZXB0aHMgPSB7fTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bUJsb2NrczsgaSsrKSB7CiAgICAgICAgICB2YXIgYmxvY2sgPSBkYXRhLnBpeGVscy5ibG9ja3NbaV07CiAgICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPT09IDApIHsKICAgICAgICAgICAgYml0RGVwdGhzLmZsb2F0MzIgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChibG9jay5lbmNvZGluZyA9PT0gMSkgewogICAgICAgICAgICBiaXREZXB0aHNbYmxvY2suYml0c1BlclBpeGVsXSA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiaXREZXB0aHNbMF0gPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKGJpdERlcHRocyk7CiAgICAgIH07CgogICAgICB2YXIgcGFyc2UgPSBmdW5jdGlvbihpbnB1dCwgZnAsIHNraXBNYXNrKSB7CiAgICAgICAgdmFyIGRhdGEgPSB7fTsKCiAgICAgICAgLy8gRmlsZSBoZWFkZXIKICAgICAgICB2YXIgZmlsZUlkVmlldyA9IG5ldyBVaW50OEFycmF5KGlucHV0LCBmcCwgMTApOwogICAgICAgIGRhdGEuZmlsZUlkZW50aWZpZXJTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGZpbGVJZFZpZXcpOwogICAgICAgIGlmIChkYXRhLmZpbGVJZGVudGlmaWVyU3RyaW5nLnRyaW0oKSAhPT0gIkNudFpJbWFnZSIpIHsKICAgICAgICAgIHRocm93ICJVbmV4cGVjdGVkIGZpbGUgaWRlbnRpZmllciBzdHJpbmc6ICIgKyBkYXRhLmZpbGVJZGVudGlmaWVyU3RyaW5nOwogICAgICAgIH0KICAgICAgICBmcCArPSAxMDsKICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZnAsIDI0KTsKICAgICAgICBkYXRhLmZpbGVWZXJzaW9uID0gdmlldy5nZXRJbnQzMigwLCB0cnVlKTsKICAgICAgICBkYXRhLmltYWdlVHlwZSA9IHZpZXcuZ2V0SW50MzIoNCwgdHJ1ZSk7CiAgICAgICAgZGF0YS5oZWlnaHQgPSB2aWV3LmdldFVpbnQzMig4LCB0cnVlKTsKICAgICAgICBkYXRhLndpZHRoID0gdmlldy5nZXRVaW50MzIoMTIsIHRydWUpOwogICAgICAgIGRhdGEubWF4WkVycm9yID0gdmlldy5nZXRGbG9hdDY0KDE2LCB0cnVlKTsKICAgICAgICBmcCArPSAyNDsKCiAgICAgICAgLy8gTWFzayBIZWFkZXIKICAgICAgICBpZiAoIXNraXBNYXNrKSB7CiAgICAgICAgICB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBmcCwgMTYpOwogICAgICAgICAgZGF0YS5tYXNrID0ge307CiAgICAgICAgICBkYXRhLm1hc2subnVtQmxvY2tzWSA9IHZpZXcuZ2V0VWludDMyKDAsIHRydWUpOwogICAgICAgICAgZGF0YS5tYXNrLm51bUJsb2Nrc1ggPSB2aWV3LmdldFVpbnQzMig0LCB0cnVlKTsKICAgICAgICAgIGRhdGEubWFzay5udW1CeXRlcyA9IHZpZXcuZ2V0VWludDMyKDgsIHRydWUpOwogICAgICAgICAgZGF0YS5tYXNrLm1heFZhbHVlID0gdmlldy5nZXRGbG9hdDMyKDEyLCB0cnVlKTsKICAgICAgICAgIGZwICs9IDE2OwoKICAgICAgICAgIC8vIE1hc2sgRGF0YQogICAgICAgICAgaWYgKGRhdGEubWFzay5udW1CeXRlcyA+IDApIHsKICAgICAgICAgICAgdmFyIGJpdHNldCA9IG5ldyBVaW50OEFycmF5KE1hdGguY2VpbChkYXRhLndpZHRoICogZGF0YS5oZWlnaHQgLyA4KSk7CiAgICAgICAgICAgIHZpZXcgPSBuZXcgRGF0YVZpZXcoaW5wdXQsIGZwLCBkYXRhLm1hc2subnVtQnl0ZXMpOwogICAgICAgICAgICB2YXIgY250ID0gdmlldy5nZXRJbnQxNigwLCB0cnVlKTsKICAgICAgICAgICAgdmFyIGlwID0gMiwgb3AgPSAwOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgaWYgKGNudCA+IDApIHsKICAgICAgICAgICAgICAgIHdoaWxlIChjbnQtLSkgeyBiaXRzZXRbb3ArK10gPSB2aWV3LmdldFVpbnQ4KGlwKyspOyB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciB2YWwgPSB2aWV3LmdldFVpbnQ4KGlwKyspOwogICAgICAgICAgICAgICAgY250ID0gLWNudDsKICAgICAgICAgICAgICAgIHdoaWxlIChjbnQtLSkgeyBiaXRzZXRbb3ArK10gPSB2YWw7IH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY250ID0gdmlldy5nZXRJbnQxNihpcCwgdHJ1ZSk7CiAgICAgICAgICAgICAgaXAgKz0gMjsKICAgICAgICAgICAgfSB3aGlsZSAoaXAgPCBkYXRhLm1hc2subnVtQnl0ZXMpOwogICAgICAgICAgICBpZiAoKGNudCAhPT0gLTMyNzY4KSB8fCAob3AgPCBiaXRzZXQubGVuZ3RoKSkgewogICAgICAgICAgICAgIHRocm93ICJVbmV4cGVjdGVkIGVuZCBvZiBtYXNrIFJMRSBlbmNvZGluZyI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YS5tYXNrLmJpdHNldCA9IGJpdHNldDsKICAgICAgICAgICAgZnAgKz0gZGF0YS5tYXNrLm51bUJ5dGVzOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSBpZiAoKGRhdGEubWFzay5udW1CeXRlcyB8IGRhdGEubWFzay5udW1CbG9ja3NZIHwgZGF0YS5tYXNrLm1heFZhbHVlKSA9PT0gMCkgeyAgLy8gU3BlY2lhbCBjYXNlLCBhbGwgbm9kYXRhCiAgICAgICAgICAgIGRhdGEubWFzay5iaXRzZXQgPSBuZXcgVWludDhBcnJheShNYXRoLmNlaWwoZGF0YS53aWR0aCAqIGRhdGEuaGVpZ2h0IC8gOCkpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUGl4ZWwgSGVhZGVyCiAgICAgICAgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZnAsIDE2KTsKICAgICAgICBkYXRhLnBpeGVscyA9IHt9OwogICAgICAgIGRhdGEucGl4ZWxzLm51bUJsb2Nrc1kgPSB2aWV3LmdldFVpbnQzMigwLCB0cnVlKTsKICAgICAgICBkYXRhLnBpeGVscy5udW1CbG9ja3NYID0gdmlldy5nZXRVaW50MzIoNCwgdHJ1ZSk7CiAgICAgICAgZGF0YS5waXhlbHMubnVtQnl0ZXMgPSB2aWV3LmdldFVpbnQzMig4LCB0cnVlKTsKICAgICAgICBkYXRhLnBpeGVscy5tYXhWYWx1ZSA9IHZpZXcuZ2V0RmxvYXQzMigxMiwgdHJ1ZSk7CiAgICAgICAgZnAgKz0gMTY7CgogICAgICAgIHZhciBudW1CbG9ja3NYID0gZGF0YS5waXhlbHMubnVtQmxvY2tzWDsKICAgICAgICB2YXIgbnVtQmxvY2tzWSA9IGRhdGEucGl4ZWxzLm51bUJsb2Nrc1k7CiAgICAgICAgLy8gdGhlIG51bWJlciBvZiBibG9ja3Mgc3BlY2lmaWVkIGluIHRoZSBoZWFkZXIgZG9lcyBub3QgdGFrZSBpbnRvIGFjY291bnQgdGhlIGJsb2NrcyBhdCB0aGUgZW5kIG9mCiAgICAgICAgLy8gZWFjaCByb3cvY29sdW1uIHdpdGggYSBzcGVjaWFsIHdpZHRoL2hlaWdodCB0aGF0IG1ha2UgdGhlIGltYWdlIGNvbXBsZXRlIGluIGNhc2UgdGhlIHdpZHRoIGlzIG5vdAogICAgICAgIC8vIGV2ZW5seSBkaXZpc2libGUgYnkgdGhlIG51bWJlciBvZiBibG9ja3MuCiAgICAgICAgdmFyIGFjdHVhbE51bUJsb2Nrc1ggPSBudW1CbG9ja3NYICsgKChkYXRhLndpZHRoICUgbnVtQmxvY2tzWCkgPiAwID8gMSA6IDApOwogICAgICAgIHZhciBhY3R1YWxOdW1CbG9ja3NZID0gbnVtQmxvY2tzWSArICgoZGF0YS5oZWlnaHQgJSBudW1CbG9ja3NZKSA+IDAgPyAxIDogMCk7CiAgICAgICAgZGF0YS5waXhlbHMuYmxvY2tzID0gbmV3IEFycmF5KGFjdHVhbE51bUJsb2Nrc1ggKiBhY3R1YWxOdW1CbG9ja3NZKTsKICAgICAgICB2YXIgYmxvY2tJID0gMDsKICAgICAgICBmb3IgKHZhciBibG9ja1kgPSAwOyBibG9ja1kgPCBhY3R1YWxOdW1CbG9ja3NZOyBibG9ja1krKykgewogICAgICAgICAgZm9yICh2YXIgYmxvY2tYID0gMDsgYmxvY2tYIDwgYWN0dWFsTnVtQmxvY2tzWDsgYmxvY2tYKyspIHsKCiAgICAgICAgICAgIC8vIEJsb2NrCiAgICAgICAgICAgIHZhciBzaXplID0gMDsKICAgICAgICAgICAgdmFyIGJ5dGVzTGVmdCA9IGlucHV0LmJ5dGVMZW5ndGggLSBmcDsKICAgICAgICAgICAgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZnAsIE1hdGgubWluKDEwLCBieXRlc0xlZnQpKTsKICAgICAgICAgICAgdmFyIGJsb2NrID0ge307CiAgICAgICAgICAgIGRhdGEucGl4ZWxzLmJsb2Nrc1tibG9ja0krK10gPSBibG9jazsKICAgICAgICAgICAgdmFyIGhlYWRlckJ5dGUgPSB2aWV3LmdldFVpbnQ4KDApOyBzaXplKys7CiAgICAgICAgICAgIGJsb2NrLmVuY29kaW5nID0gaGVhZGVyQnl0ZSAmIDYzOwogICAgICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPiAzKSB7CiAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgYmxvY2sgZW5jb2RpbmcgKCIgKyBibG9jay5lbmNvZGluZyArICIpIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPT09IDIpIHsKICAgICAgICAgICAgICBmcCsrOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoaGVhZGVyQnl0ZSAhPT0gMCkgJiYgKGhlYWRlckJ5dGUgIT09IDIpKSB7CiAgICAgICAgICAgICAgaGVhZGVyQnl0ZSA+Pj0gNjsKICAgICAgICAgICAgICBibG9jay5vZmZzZXRUeXBlID0gaGVhZGVyQnl0ZTsKICAgICAgICAgICAgICBpZiAoaGVhZGVyQnl0ZSA9PT0gMikgewogICAgICAgICAgICAgICAgYmxvY2sub2Zmc2V0ID0gdmlldy5nZXRJbnQ4KDEpOyBzaXplKys7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkZXJCeXRlID09PSAxKSB7CiAgICAgICAgICAgICAgICBibG9jay5vZmZzZXQgPSB2aWV3LmdldEludDE2KDEsIHRydWUpOyBzaXplICs9IDI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkZXJCeXRlID09PSAwKSB7CiAgICAgICAgICAgICAgICBibG9jay5vZmZzZXQgPSB2aWV3LmdldEZsb2F0MzIoMSwgdHJ1ZSk7IHNpemUgKz0gNDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgYmxvY2sgb2Zmc2V0IHR5cGUiOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGJsb2NrLmVuY29kaW5nID09PSAxKSB7CiAgICAgICAgICAgICAgICBoZWFkZXJCeXRlID0gdmlldy5nZXRVaW50OChzaXplKTsgc2l6ZSsrOwogICAgICAgICAgICAgICAgYmxvY2suYml0c1BlclBpeGVsID0gaGVhZGVyQnl0ZSAmIDYzOwogICAgICAgICAgICAgICAgaGVhZGVyQnl0ZSA+Pj0gNjsKICAgICAgICAgICAgICAgIGJsb2NrLm51bVZhbGlkUGl4ZWxzVHlwZSA9IGhlYWRlckJ5dGU7CiAgICAgICAgICAgICAgICBpZiAoaGVhZGVyQnl0ZSA9PT0gMikgewogICAgICAgICAgICAgICAgICBibG9jay5udW1WYWxpZFBpeGVscyA9IHZpZXcuZ2V0VWludDgoc2l6ZSk7IHNpemUrKzsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGVhZGVyQnl0ZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICBibG9jay5udW1WYWxpZFBpeGVscyA9IHZpZXcuZ2V0VWludDE2KHNpemUsIHRydWUpOyBzaXplICs9IDI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWRlckJ5dGUgPT09IDApIHsKICAgICAgICAgICAgICAgICAgYmxvY2subnVtVmFsaWRQaXhlbHMgPSB2aWV3LmdldFVpbnQzMihzaXplLCB0cnVlKTsgc2l6ZSArPSA0OwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgdmFsaWQgcGl4ZWwgY291bnQgdHlwZSI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZwICs9IHNpemU7CgogICAgICAgICAgICBpZiAoYmxvY2suZW5jb2RpbmcgPT09IDMpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGFycmF5QnVmLCBzdG9yZTg7CiAgICAgICAgICAgIGlmIChibG9jay5lbmNvZGluZyA9PT0gMCkgewogICAgICAgICAgICAgIHZhciBudW1QaXhlbHMgPSAoZGF0YS5waXhlbHMubnVtQnl0ZXMgLSAxKSAvIDQ7CiAgICAgICAgICAgICAgaWYgKG51bVBpeGVscyAhPT0gTWF0aC5mbG9vcihudW1QaXhlbHMpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyAidW5jb21wcmVzc2VkIGJsb2NrIGhhcyBpbnZhbGlkIGxlbmd0aCI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGFycmF5QnVmID0gbmV3IEFycmF5QnVmZmVyKG51bVBpeGVscyAqIDQpOwogICAgICAgICAgICAgIHN0b3JlOCA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmKTsKICAgICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBmcCwgbnVtUGl4ZWxzICogNCkpOwogICAgICAgICAgICAgIHZhciByYXdEYXRhID0gbmV3IEZsb2F0MzJBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgYmxvY2sucmF3RGF0YSA9IHJhd0RhdGE7CiAgICAgICAgICAgICAgZnAgKz0gbnVtUGl4ZWxzICogNDsKICAgICAgICAgICAgfSBlbHNlIGlmIChibG9jay5lbmNvZGluZyA9PT0gMSkgewogICAgICAgICAgICAgIHZhciBkYXRhQnl0ZXMgPSBNYXRoLmNlaWwoYmxvY2subnVtVmFsaWRQaXhlbHMgKiBibG9jay5iaXRzUGVyUGl4ZWwgLyA4KTsKICAgICAgICAgICAgICB2YXIgZGF0YVdvcmRzID0gTWF0aC5jZWlsKGRhdGFCeXRlcyAvIDQpOwogICAgICAgICAgICAgIGFycmF5QnVmID0gbmV3IEFycmF5QnVmZmVyKGRhdGFXb3JkcyAqIDQpOwogICAgICAgICAgICAgIHN0b3JlOCA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmKTsKICAgICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBmcCwgZGF0YUJ5dGVzKSk7CiAgICAgICAgICAgICAgYmxvY2suc3R1ZmZlZERhdGEgPSBuZXcgVWludDMyQXJyYXkoYXJyYXlCdWYpOwogICAgICAgICAgICAgIGZwICs9IGRhdGFCeXRlczsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBkYXRhLmVvZk9mZnNldCA9IGZwOwogICAgICAgIHJldHVybiBkYXRhOwogICAgICB9OwoKICAgICAgdmFyIHVuc3R1ZmYgPSBmdW5jdGlvbihzcmMsIGJpdHNQZXJQaXhlbCwgbnVtUGl4ZWxzLCBvZmZzZXQsIHNjYWxlLCBkZXN0LCBtYXhWYWx1ZSkgewogICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgdmFyIGkgPSAwLCBvOwogICAgICAgIHZhciBiaXRzTGVmdCA9IDA7CiAgICAgICAgdmFyIG4sIGJ1ZmZlcjsKICAgICAgICB2YXIgbm1heCA9IE1hdGguY2VpbCgobWF4VmFsdWUgLSBvZmZzZXQpIC8gc2NhbGUpOwogICAgICAgIC8vIGdldCByaWQgb2YgdHJhaWxpbmcgYnl0ZXMgdGhhdCBhcmUgYWxyZWFkeSBwYXJ0IG9mIG5leHQgYmxvY2sKICAgICAgICB2YXIgbnVtSW52YWxpZFRhaWxCeXRlcyA9IHNyYy5sZW5ndGggKiA0IC0gTWF0aC5jZWlsKGJpdHNQZXJQaXhlbCAqIG51bVBpeGVscyAvIDgpOwogICAgICAgIHNyY1tzcmMubGVuZ3RoIC0gMV0gPDw9IDggKiBudW1JbnZhbGlkVGFpbEJ5dGVzOwoKICAgICAgICBmb3IgKG8gPSAwOyBvIDwgbnVtUGl4ZWxzOyBvKyspIHsKICAgICAgICAgIGlmIChiaXRzTGVmdCA9PT0gMCkgewogICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgYml0c0xlZnQgPSAzMjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChiaXRzTGVmdCA+PSBiaXRzUGVyUGl4ZWwpIHsKICAgICAgICAgICAgbiA9IChidWZmZXIgPj4+IChiaXRzTGVmdCAtIGJpdHNQZXJQaXhlbCkpICYgYml0TWFzazsKICAgICAgICAgICAgYml0c0xlZnQgLT0gYml0c1BlclBpeGVsOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgbiA9ICgoYnVmZmVyICYgYml0TWFzaykgPDwgbWlzc2luZ0JpdHMpICYgYml0TWFzazsKICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzIgLSBtaXNzaW5nQml0czsKICAgICAgICAgICAgbiArPSAoYnVmZmVyID4+PiBiaXRzTGVmdCk7CiAgICAgICAgICB9CiAgICAgICAgICAvL3BpeGVsIHZhbHVlcyBtYXkgZXhjZWVkIG1heCBkdWUgdG8gcXVhbnRpemF0aW9uCiAgICAgICAgICBkZXN0W29dID0gbiA8IG5tYXggPyBvZmZzZXQgKyBuICogc2NhbGUgOiBtYXhWYWx1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRlc3Q7CiAgICAgIH07CgogICAgICByZXR1cm4gQ250WkltYWdlOwogICAgfSkoKTsKCiAgICAvL3ZlcnNpb24gMi4gU3VwcG9ydHMgMi4xLCAyLjIsIDIuMwogICAgdmFyIExlcmMyRGVjb2RlID0gKGZ1bmN0aW9uKCkgewogICAgICAvLyBOb3RlOiBjdXJyZW50bHksIHRoaXMgbW9kdWxlIG9ubHkgaGFzIGFuIGltcGxlbWVudGF0aW9uIGZvciBkZWNvZGluZyBMRVJDIGRhdGEsIG5vdCBlbmNvZGluZy4gVGhlIG5hbWUgb2YKICAgICAgLy8gdGhlIGNsYXNzIHdhcyBjaG9zZW4gdG8gYmUgZnV0dXJlIHByb29mLCBmb2xsb3dpbmcgTGVyY0RlY29kZS4KCiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAqIHByaXZhdGUgc3RhdGljIGNsYXNzIGJpdHN1dGZmZXIgdXNlZCBieSBMZXJjMkRlY29kZQogICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgICB2YXIgQml0U3R1ZmZlciA9IHsKICAgICAgICAvL21ldGhvZHMgZW5kaW5nIHdpdGggMiBhcmUgZm9yIHRoZSBuZXcgYnl0ZSBvcmRlciB1c2VkIGJ5IExlcmMyLjMgYW5kIGFib3ZlLgogICAgICAgIC8vb3JpZ2luYWxVbnN0dWZmIGlzIHVzZWQgdG8gdW5wYWNrIEh1ZmZtYW4gY29kZSB0YWJsZS4gY29kZSBpcyBkdXBsaWNhdGVkIHRvIHVuc3R1ZmZ4IGZvciBwZXJmb3JtYW5jZSByZWFzb25zLgogICAgICAgIHVuc3R1ZmY6IGZ1bmN0aW9uKHNyYywgZGVzdCwgYml0c1BlclBpeGVsLCBudW1QaXhlbHMsIGx1dEFyciwgb2Zmc2V0LCBzY2FsZSwgbWF4VmFsdWUpIHsKICAgICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgICB2YXIgaSA9IDAsIG87CiAgICAgICAgICB2YXIgYml0c0xlZnQgPSAwOwogICAgICAgICAgdmFyIG4sIGJ1ZmZlciwgbWlzc2luZ0JpdHMsIG5tYXg7CgogICAgICAgICAgLy8gZ2V0IHJpZCBvZiB0cmFpbGluZyBieXRlcyB0aGF0IGFyZSBhbHJlYWR5IHBhcnQgb2YgbmV4dCBibG9jawogICAgICAgICAgdmFyIG51bUludmFsaWRUYWlsQnl0ZXMgPSBzcmMubGVuZ3RoICogNCAtIE1hdGguY2VpbChiaXRzUGVyUGl4ZWwgKiBudW1QaXhlbHMgLyA4KTsKICAgICAgICAgIHNyY1tzcmMubGVuZ3RoIC0gMV0gPDw9IDggKiBudW1JbnZhbGlkVGFpbEJ5dGVzOwogICAgICAgICAgaWYgKGx1dEFycikgewogICAgICAgICAgICBmb3IgKG8gPSAwOyBvIDwgbnVtUGl4ZWxzOyBvKyspIHsKICAgICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgICAgbiA9IChidWZmZXIgPj4+IChiaXRzTGVmdCAtIGJpdHNQZXJQaXhlbCkpICYgYml0TWFzazsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICAgICAgICBuID0gKChidWZmZXIgJiBiaXRNYXNrKSA8PCBtaXNzaW5nQml0cykgJiBiaXRNYXNrOwogICAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyIC0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgICAgICBuICs9IChidWZmZXIgPj4+IGJpdHNMZWZ0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZGVzdFtvXSA9IGx1dEFycltuXTsvL29mZnNldCArIGx1dEFycltuXSAqIHNjYWxlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbm1heCA9IE1hdGguY2VpbCgobWF4VmFsdWUgLSBvZmZzZXQpIC8gc2NhbGUpOwogICAgICAgICAgICBmb3IgKG8gPSAwOyBvIDwgbnVtUGl4ZWxzOyBvKyspIHsKICAgICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgICAgbiA9IChidWZmZXIgPj4+IChiaXRzTGVmdCAtIGJpdHNQZXJQaXhlbCkpICYgYml0TWFzazsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICAgICAgICBuID0gKChidWZmZXIgJiBiaXRNYXNrKSA8PCBtaXNzaW5nQml0cykgJiBiaXRNYXNrOwogICAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyIC0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgICAgICBuICs9IChidWZmZXIgPj4+IGJpdHNMZWZ0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLy9waXhlbCB2YWx1ZXMgbWF5IGV4Y2VlZCBtYXggZHVlIHRvIHF1YW50aXphdGlvbgogICAgICAgICAgICAgIGRlc3Rbb10gPSBuIDwgbm1heCA/IG9mZnNldCArIG4gKiBzY2FsZSA6IG1heFZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgdW5zdHVmZkxVVDogZnVuY3Rpb24oc3JjLCBiaXRzUGVyUGl4ZWwsIG51bVBpeGVscywgb2Zmc2V0LCBzY2FsZSwgbWF4VmFsdWUpIHsKICAgICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgICB2YXIgaSA9IDAsIG8gPSAwLCBtaXNzaW5nQml0cyA9IDAsIGJpdHNMZWZ0ID0gMCwgbiA9IDA7CiAgICAgICAgICB2YXIgYnVmZmVyOwogICAgICAgICAgdmFyIGRlc3QgPSBbXTsKCiAgICAgICAgICAvLyBnZXQgcmlkIG9mIHRyYWlsaW5nIGJ5dGVzIHRoYXQgYXJlIGFscmVhZHkgcGFydCBvZiBuZXh0IGJsb2NrCiAgICAgICAgICB2YXIgbnVtSW52YWxpZFRhaWxCeXRlcyA9IHNyYy5sZW5ndGggKiA0IC0gTWF0aC5jZWlsKGJpdHNQZXJQaXhlbCAqIG51bVBpeGVscyAvIDgpOwogICAgICAgICAgc3JjW3NyYy5sZW5ndGggLSAxXSA8PD0gOCAqIG51bUludmFsaWRUYWlsQnl0ZXM7CgogICAgICAgICAgdmFyIG5tYXggPSBNYXRoLmNlaWwoKG1heFZhbHVlIC0gb2Zmc2V0KSAvIHNjYWxlKTsKICAgICAgICAgIGZvciAobyA9IDA7IG8gPCBudW1QaXhlbHM7IG8rKykgewogICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChiaXRzTGVmdCA+PSBiaXRzUGVyUGl4ZWwpIHsKICAgICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gKGJpdHNMZWZ0IC0gYml0c1BlclBpeGVsKSkgJiBiaXRNYXNrOwogICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICAgICAgbiA9ICgoYnVmZmVyICYgYml0TWFzaykgPDwgbWlzc2luZ0JpdHMpICYgYml0TWFzazsKICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyIC0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgICAgbiArPSAoYnVmZmVyID4+PiBiaXRzTGVmdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy9kZXN0LnB1c2gobik7CiAgICAgICAgICAgIGRlc3Rbb10gPSBuIDwgbm1heCA/IG9mZnNldCArIG4gKiBzY2FsZSA6IG1heFZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgZGVzdC51bnNoaWZ0KG9mZnNldCk7Ly8xc3Qgb25lCiAgICAgICAgICByZXR1cm4gZGVzdDsKICAgICAgICB9LAoKICAgICAgICB1bnN0dWZmMjogZnVuY3Rpb24oc3JjLCBkZXN0LCBiaXRzUGVyUGl4ZWwsIG51bVBpeGVscywgbHV0QXJyLCBvZmZzZXQsIHNjYWxlLCBtYXhWYWx1ZSkgewogICAgICAgICAgdmFyIGJpdE1hc2sgPSAoMSA8PCBiaXRzUGVyUGl4ZWwpIC0gMTsKICAgICAgICAgIHZhciBpID0gMCwgbzsKICAgICAgICAgIHZhciBiaXRzTGVmdCA9IDAsIGJpdFBvcyA9IDA7CiAgICAgICAgICB2YXIgbiwgYnVmZmVyLCBtaXNzaW5nQml0czsKICAgICAgICAgIGlmIChsdXRBcnIpIHsKICAgICAgICAgICAgZm9yIChvID0gMDsgbyA8IG51bVBpeGVsczsgbysrKSB7CiAgICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID09PSAwKSB7CiAgICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzI7CiAgICAgICAgICAgICAgICBiaXRQb3MgPSAwOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoYml0c0xlZnQgPj0gYml0c1BlclBpeGVsKSB7CiAgICAgICAgICAgICAgICBuID0gKChidWZmZXIgPj4+IGJpdFBvcykgJiBiaXRNYXNrKTsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICAgIGJpdFBvcyArPSBiaXRzUGVyUGl4ZWw7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgICAgIG4gPSAoYnVmZmVyID4+PiBiaXRQb3MpICYgYml0TWFzazsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMiAtIG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgICAgbiB8PSAoYnVmZmVyICYgKCgxIDw8IG1pc3NpbmdCaXRzKSAtIDEpKSA8PCAoYml0c1BlclBpeGVsIC0gbWlzc2luZ0JpdHMpOwogICAgICAgICAgICAgICAgYml0UG9zID0gbWlzc2luZ0JpdHM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGRlc3Rbb10gPSBsdXRBcnJbbl07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICB2YXIgbm1heCA9IE1hdGguY2VpbCgobWF4VmFsdWUgLSBvZmZzZXQpIC8gc2NhbGUpOwogICAgICAgICAgICBmb3IgKG8gPSAwOyBvIDwgbnVtUGl4ZWxzOyBvKyspIHsKICAgICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMjsKICAgICAgICAgICAgICAgIGJpdFBvcyA9IDA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChiaXRzTGVmdCA+PSBiaXRzUGVyUGl4ZWwpIHsKICAgICAgICAgICAgICAgIC8vbm8gdW5zaWduZWQgbGVmdCBzaGlmdAogICAgICAgICAgICAgICAgbiA9ICgoYnVmZmVyID4+PiBiaXRQb3MpICYgYml0TWFzayk7CiAgICAgICAgICAgICAgICBiaXRzTGVmdCAtPSBiaXRzUGVyUGl4ZWw7CiAgICAgICAgICAgICAgICBiaXRQb3MgKz0gYml0c1BlclBpeGVsOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtaXNzaW5nQml0cyA9IChiaXRzUGVyUGl4ZWwgLSBiaXRzTGVmdCk7CiAgICAgICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2s7Ly8oKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzIgLSBtaXNzaW5nQml0czsKICAgICAgICAgICAgICAgIG4gfD0gKGJ1ZmZlciAmICgoMSA8PCBtaXNzaW5nQml0cykgLSAxKSkgPDwgKGJpdHNQZXJQaXhlbCAtIG1pc3NpbmdCaXRzKTsKICAgICAgICAgICAgICAgIGJpdFBvcyA9IG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAvL3BpeGVsIHZhbHVlcyBtYXkgZXhjZWVkIG1heCBkdWUgdG8gcXVhbnRpemF0aW9uCiAgICAgICAgICAgICAgZGVzdFtvXSA9IG4gPCBubWF4ID8gb2Zmc2V0ICsgbiAqIHNjYWxlIDogbWF4VmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBkZXN0OwogICAgICAgIH0sCgogICAgICAgIHVuc3R1ZmZMVVQyOiBmdW5jdGlvbihzcmMsIGJpdHNQZXJQaXhlbCwgbnVtUGl4ZWxzLCBvZmZzZXQsIHNjYWxlLCBtYXhWYWx1ZSkgewogICAgICAgICAgdmFyIGJpdE1hc2sgPSAoMSA8PCBiaXRzUGVyUGl4ZWwpIC0gMTsKICAgICAgICAgIHZhciBpID0gMCwgbyA9IDAsIG1pc3NpbmdCaXRzID0gMCwgYml0c0xlZnQgPSAwLCBuID0gMCwgYml0UG9zID0gMDsKICAgICAgICAgIHZhciBidWZmZXI7CiAgICAgICAgICB2YXIgZGVzdCA9IFtdOwogICAgICAgICAgdmFyIG5tYXggPSBNYXRoLmNlaWwoKG1heFZhbHVlIC0gb2Zmc2V0KSAvIHNjYWxlKTsKICAgICAgICAgIGZvciAobyA9IDA7IG8gPCBudW1QaXhlbHM7IG8rKykgewogICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyOwogICAgICAgICAgICAgIGJpdFBvcyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgIC8vbm8gdW5zaWduZWQgbGVmdCBzaGlmdAogICAgICAgICAgICAgIG4gPSAoKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2spOwogICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICBiaXRQb3MgKz0gYml0c1BlclBpeGVsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2s7Ly8oKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMiAtIG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgIG4gfD0gKGJ1ZmZlciAmICgoMSA8PCBtaXNzaW5nQml0cykgLSAxKSkgPDwgKGJpdHNQZXJQaXhlbCAtIG1pc3NpbmdCaXRzKTsKICAgICAgICAgICAgICBiaXRQb3MgPSBtaXNzaW5nQml0czsKICAgICAgICAgICAgfQogICAgICAgICAgICAvL2Rlc3QucHVzaChuKTsKICAgICAgICAgICAgZGVzdFtvXSA9IG4gPCBubWF4ID8gb2Zmc2V0ICsgbiAqIHNjYWxlIDogbWF4VmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBkZXN0LnVuc2hpZnQob2Zmc2V0KTsKICAgICAgICAgIHJldHVybiBkZXN0OwogICAgICAgIH0sCgogICAgICAgIG9yaWdpbmFsVW5zdHVmZjogZnVuY3Rpb24oc3JjLCBkZXN0LCBiaXRzUGVyUGl4ZWwsIG51bVBpeGVscykgewogICAgICAgICAgdmFyIGJpdE1hc2sgPSAoMSA8PCBiaXRzUGVyUGl4ZWwpIC0gMTsKICAgICAgICAgIHZhciBpID0gMCwgbzsKICAgICAgICAgIHZhciBiaXRzTGVmdCA9IDA7CiAgICAgICAgICB2YXIgbiwgYnVmZmVyLCBtaXNzaW5nQml0czsKCiAgICAgICAgICAvLyBnZXQgcmlkIG9mIHRyYWlsaW5nIGJ5dGVzIHRoYXQgYXJlIGFscmVhZHkgcGFydCBvZiBuZXh0IGJsb2NrCiAgICAgICAgICB2YXIgbnVtSW52YWxpZFRhaWxCeXRlcyA9IHNyYy5sZW5ndGggKiA0IC0gTWF0aC5jZWlsKGJpdHNQZXJQaXhlbCAqIG51bVBpeGVscyAvIDgpOwogICAgICAgICAgc3JjW3NyYy5sZW5ndGggLSAxXSA8PD0gOCAqIG51bUludmFsaWRUYWlsQnl0ZXM7CgogICAgICAgICAgZm9yIChvID0gMDsgbyA8IG51bVBpeGVsczsgbysrKSB7CiAgICAgICAgICAgIGlmIChiaXRzTGVmdCA9PT0gMCkgewogICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgIG4gPSAoYnVmZmVyID4+PiAoYml0c0xlZnQgLSBiaXRzUGVyUGl4ZWwpKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgYml0c0xlZnQgLT0gYml0c1BlclBpeGVsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgICBuID0gKChidWZmZXIgJiBiaXRNYXNrKSA8PCBtaXNzaW5nQml0cykgJiBiaXRNYXNrOwogICAgICAgICAgICAgIGJ1ZmZlciA9IHNyY1tpKytdOwogICAgICAgICAgICAgIGJpdHNMZWZ0ID0gMzIgLSBtaXNzaW5nQml0czsKICAgICAgICAgICAgICBuICs9IChidWZmZXIgPj4+IGJpdHNMZWZ0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZXN0W29dID0gbjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBkZXN0OwogICAgICAgIH0sCgogICAgICAgIG9yaWdpbmFsVW5zdHVmZjI6IGZ1bmN0aW9uKHNyYywgZGVzdCwgYml0c1BlclBpeGVsLCBudW1QaXhlbHMpIHsKICAgICAgICAgIHZhciBiaXRNYXNrID0gKDEgPDwgYml0c1BlclBpeGVsKSAtIDE7CiAgICAgICAgICB2YXIgaSA9IDAsIG87CiAgICAgICAgICB2YXIgYml0c0xlZnQgPSAwLCBiaXRQb3MgPSAwOwogICAgICAgICAgdmFyIG4sIGJ1ZmZlciwgbWlzc2luZ0JpdHM7CiAgICAgICAgICAvL21pY3JvLW9wdGltaXphdGlvbnMKICAgICAgICAgIGZvciAobyA9IDA7IG8gPCBudW1QaXhlbHM7IG8rKykgewogICAgICAgICAgICBpZiAoYml0c0xlZnQgPT09IDApIHsKICAgICAgICAgICAgICBidWZmZXIgPSBzcmNbaSsrXTsKICAgICAgICAgICAgICBiaXRzTGVmdCA9IDMyOwogICAgICAgICAgICAgIGJpdFBvcyA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJpdHNMZWZ0ID49IGJpdHNQZXJQaXhlbCkgewogICAgICAgICAgICAgIC8vbm8gdW5zaWduZWQgbGVmdCBzaGlmdAogICAgICAgICAgICAgIG4gPSAoKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2spOwogICAgICAgICAgICAgIGJpdHNMZWZ0IC09IGJpdHNQZXJQaXhlbDsKICAgICAgICAgICAgICBiaXRQb3MgKz0gYml0c1BlclBpeGVsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1pc3NpbmdCaXRzID0gKGJpdHNQZXJQaXhlbCAtIGJpdHNMZWZ0KTsKICAgICAgICAgICAgICBuID0gKGJ1ZmZlciA+Pj4gYml0UG9zKSAmIGJpdE1hc2s7Ly8oKGJ1ZmZlciAmIGJpdE1hc2spIDw8IG1pc3NpbmdCaXRzKSAmIGJpdE1hc2s7CiAgICAgICAgICAgICAgYnVmZmVyID0gc3JjW2krK107CiAgICAgICAgICAgICAgYml0c0xlZnQgPSAzMiAtIG1pc3NpbmdCaXRzOwogICAgICAgICAgICAgIG4gfD0gKGJ1ZmZlciAmICgoMSA8PCBtaXNzaW5nQml0cykgLSAxKSkgPDwgKGJpdHNQZXJQaXhlbCAtIG1pc3NpbmdCaXRzKTsKICAgICAgICAgICAgICBiaXRQb3MgPSBtaXNzaW5nQml0czsKICAgICAgICAgICAgfQogICAgICAgICAgICBkZXN0W29dID0gbjsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBkZXN0OwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICAqcHJpdmF0ZSBzdGF0aWMgY2xhc3MgdXNlZCBieSBMZXJjMkRlY29kZQogICAgICAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgIHZhciBMZXJjMkhlbHBlcnMgPSB7CiAgICAgICAgSFVGRk1BTl9MVVRfQklUU19NQVg6IDEyLCAvL3VzZSAyXjEyIGx1dCwgdHJlYXQgaXQgbGlrZSBjb25zdGFudAogICAgICAgIGNvbXB1dGVDaGVja3N1bUZsZXRjaGVyMzI6IGZ1bmN0aW9uKGlucHV0KSB7CgogICAgICAgICAgdmFyIHN1bTEgPSAweGZmZmYsIHN1bTIgPSAweGZmZmY7CiAgICAgICAgICB2YXIgbGVuID0gaW5wdXQubGVuZ3RoOwogICAgICAgICAgdmFyIHdvcmRzID0gTWF0aC5mbG9vcihsZW4gLyAyKTsKICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgIHdoaWxlICh3b3JkcykgewogICAgICAgICAgICB2YXIgdGxlbiA9ICh3b3JkcyA+PSAzNTkpID8gMzU5IDogd29yZHM7CiAgICAgICAgICAgIHdvcmRzIC09IHRsZW47CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBzdW0xICs9IChpbnB1dFtpKytdIDw8IDgpOwogICAgICAgICAgICAgIHN1bTIgKz0gc3VtMSArPSBpbnB1dFtpKytdOwogICAgICAgICAgICB9IHdoaWxlICgtLXRsZW4pOwoKICAgICAgICAgICAgc3VtMSA9IChzdW0xICYgMHhmZmZmKSArIChzdW0xID4+PiAxNik7CiAgICAgICAgICAgIHN1bTIgPSAoc3VtMiAmIDB4ZmZmZikgKyAoc3VtMiA+Pj4gMTYpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIGFkZCB0aGUgc3RyYWdnbGVyIGJ5dGUgaWYgaXQgZXhpc3RzCiAgICAgICAgICBpZiAobGVuICYgMSkgewogICAgICAgICAgICBzdW0yICs9IHN1bTEgKz0gKGlucHV0W2ldIDw8IDgpOwogICAgICAgICAgfQogICAgICAgICAgLy8gc2Vjb25kIHJlZHVjdGlvbiBzdGVwIHRvIHJlZHVjZSBzdW1zIHRvIDE2IGJpdHMKICAgICAgICAgIHN1bTEgPSAoc3VtMSAmIDB4ZmZmZikgKyAoc3VtMSA+Pj4gMTYpOwogICAgICAgICAgc3VtMiA9IChzdW0yICYgMHhmZmZmKSArIChzdW0yID4+PiAxNik7CgogICAgICAgICAgcmV0dXJuIChzdW0yIDw8IDE2IHwgc3VtMSkgPj4+IDA7CiAgICAgICAgfSwKCiAgICAgICAgcmVhZEhlYWRlckluZm86IGZ1bmN0aW9uKGlucHV0LCBkYXRhKSB7CiAgICAgICAgICB2YXIgcHRyID0gZGF0YS5wdHI7CiAgICAgICAgICB2YXIgZmlsZUlkVmlldyA9IG5ldyBVaW50OEFycmF5KGlucHV0LCBwdHIsIDYpOwogICAgICAgICAgdmFyIGhlYWRlckluZm8gPSB7fTsKICAgICAgICAgIGhlYWRlckluZm8uZmlsZUlkZW50aWZpZXJTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGZpbGVJZFZpZXcpOwogICAgICAgICAgaWYgKGhlYWRlckluZm8uZmlsZUlkZW50aWZpZXJTdHJpbmcubGFzdEluZGV4T2YoIkxlcmMyIiwgMCkgIT09IDApIHsKICAgICAgICAgICAgdGhyb3cgIlVuZXhwZWN0ZWQgZmlsZSBpZGVudGlmaWVyIHN0cmluZyAoZXhwZWN0IExlcmMyICk6ICIgKyBoZWFkZXJJbmZvLmZpbGVJZGVudGlmaWVyU3RyaW5nOwogICAgICAgICAgfQogICAgICAgICAgcHRyICs9IDY7CiAgICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgcHRyLCA4KTsKICAgICAgICAgIHZhciBmaWxlVmVyc2lvbiA9IHZpZXcuZ2V0SW50MzIoMCwgdHJ1ZSk7CiAgICAgICAgICBoZWFkZXJJbmZvLmZpbGVWZXJzaW9uID0gZmlsZVZlcnNpb247CiAgICAgICAgICBwdHIgKz0gNDsKICAgICAgICAgIGlmIChmaWxlVmVyc2lvbiA+PSAzKSB7CiAgICAgICAgICAgIGhlYWRlckluZm8uY2hlY2tzdW0gPSB2aWV3LmdldFVpbnQzMig0LCB0cnVlKTsgLy9ucm93cwogICAgICAgICAgICBwdHIgKz0gNDsKICAgICAgICAgIH0KCiAgICAgICAgICAvL2tleXMgc3RhcnQgZnJvbSBoZXJlCiAgICAgICAgICB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBwdHIsIDEyKTsKICAgICAgICAgIGhlYWRlckluZm8uaGVpZ2h0ID0gdmlldy5nZXRVaW50MzIoMCwgdHJ1ZSk7IC8vbnJvd3MKICAgICAgICAgIGhlYWRlckluZm8ud2lkdGggPSB2aWV3LmdldFVpbnQzMig0LCB0cnVlKTsgLy9uY29scwogICAgICAgICAgcHRyICs9IDg7CiAgICAgICAgICBpZiAoZmlsZVZlcnNpb24gPj0gNCkgewogICAgICAgICAgICBoZWFkZXJJbmZvLm51bURpbXMgPSB2aWV3LmdldFVpbnQzMig4LCB0cnVlKTsKICAgICAgICAgICAgcHRyICs9IDQ7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaGVhZGVySW5mby5udW1EaW1zID0gMTsKICAgICAgICAgIH0KCiAgICAgICAgICB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBwdHIsIDQwKTsKICAgICAgICAgIGhlYWRlckluZm8ubnVtVmFsaWRQaXhlbCA9IHZpZXcuZ2V0VWludDMyKDAsIHRydWUpOwogICAgICAgICAgaGVhZGVySW5mby5taWNyb0Jsb2NrU2l6ZSA9IHZpZXcuZ2V0SW50MzIoNCwgdHJ1ZSk7CiAgICAgICAgICBoZWFkZXJJbmZvLmJsb2JTaXplID0gdmlldy5nZXRJbnQzMig4LCB0cnVlKTsKICAgICAgICAgIGhlYWRlckluZm8uaW1hZ2VUeXBlID0gdmlldy5nZXRJbnQzMigxMiwgdHJ1ZSk7CgogICAgICAgICAgaGVhZGVySW5mby5tYXhaRXJyb3IgPSB2aWV3LmdldEZsb2F0NjQoMTYsIHRydWUpOwogICAgICAgICAgaGVhZGVySW5mby56TWluID0gdmlldy5nZXRGbG9hdDY0KDI0LCB0cnVlKTsKICAgICAgICAgIGhlYWRlckluZm8uek1heCA9IHZpZXcuZ2V0RmxvYXQ2NCgzMiwgdHJ1ZSk7CiAgICAgICAgICBwdHIgKz0gNDA7CiAgICAgICAgICBkYXRhLmhlYWRlckluZm8gPSBoZWFkZXJJbmZvOwogICAgICAgICAgZGF0YS5wdHIgPSBwdHI7CgogICAgICAgICAgdmFyIGNoZWNrc3VtLCBrZXlMZW5ndGg7CiAgICAgICAgICBpZiAoZmlsZVZlcnNpb24gPj0gMykgewogICAgICAgICAgICBrZXlMZW5ndGggPSBmaWxlVmVyc2lvbiA+PSA0ID8gNTIgOiA0ODsKICAgICAgICAgICAgY2hlY2tzdW0gPSB0aGlzLmNvbXB1dGVDaGVja3N1bUZsZXRjaGVyMzIobmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciAtIGtleUxlbmd0aCwgaGVhZGVySW5mby5ibG9iU2l6ZSAtIDE0KSk7CiAgICAgICAgICAgIGlmIChjaGVja3N1bSAhPT0gaGVhZGVySW5mby5jaGVja3N1bSkgewogICAgICAgICAgICAgIHRocm93ICJDaGVja3N1bSBmYWlsZWQuIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKCiAgICAgICAgY2hlY2tNaW5NYXhSYW5nZXM6IGZ1bmN0aW9uKGlucHV0LCBkYXRhKSB7CiAgICAgICAgICB2YXIgaGVhZGVySW5mbyA9IGRhdGEuaGVhZGVySW5mbzsKICAgICAgICAgIHZhciBPdXRQaXhlbFR5cGVBcnJheSA9IHRoaXMuZ2V0RGF0YVR5cGVBcnJheShoZWFkZXJJbmZvLmltYWdlVHlwZSk7CiAgICAgICAgICB2YXIgcmFuZ2VCeXRlcyA9IGhlYWRlckluZm8ubnVtRGltcyAqIHRoaXMuZ2V0RGF0YVR5cGVTaXplKGhlYWRlckluZm8uaW1hZ2VUeXBlKTsKICAgICAgICAgIHZhciBtaW5WYWx1ZXMgPSB0aGlzLnJlYWRTdWJBcnJheShpbnB1dCwgZGF0YS5wdHIsIE91dFBpeGVsVHlwZUFycmF5LCByYW5nZUJ5dGVzKTsKICAgICAgICAgIHZhciBtYXhWYWx1ZXMgPSB0aGlzLnJlYWRTdWJBcnJheShpbnB1dCwgZGF0YS5wdHIgKyByYW5nZUJ5dGVzLCBPdXRQaXhlbFR5cGVBcnJheSwgcmFuZ2VCeXRlcyk7CiAgICAgICAgICBkYXRhLnB0ciArPSAoMiAqIHJhbmdlQnl0ZXMpOwogICAgICAgICAgdmFyIGksIGVxdWFsID0gdHJ1ZTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBoZWFkZXJJbmZvLm51bURpbXM7IGkrKykgewogICAgICAgICAgICBpZiAobWluVmFsdWVzW2ldICE9PSBtYXhWYWx1ZXNbaV0pIHsKICAgICAgICAgICAgICBlcXVhbCA9IGZhbHNlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBoZWFkZXJJbmZvLm1pblZhbHVlcyA9IG1pblZhbHVlczsKICAgICAgICAgIGhlYWRlckluZm8ubWF4VmFsdWVzID0gbWF4VmFsdWVzOwogICAgICAgICAgcmV0dXJuIGVxdWFsOwogICAgICAgIH0sCgogICAgICAgIHJlYWRTdWJBcnJheTogZnVuY3Rpb24oaW5wdXQsIHB0ciwgT3V0UGl4ZWxUeXBlQXJyYXksIG51bUJ5dGVzKSB7CiAgICAgICAgICB2YXIgcmF3RGF0YTsKICAgICAgICAgIGlmIChPdXRQaXhlbFR5cGVBcnJheSA9PT0gVWludDhBcnJheSkgewogICAgICAgICAgICByYXdEYXRhID0gbmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciwgbnVtQnl0ZXMpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBhcnJheUJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihudW1CeXRlcyk7CiAgICAgICAgICAgIHZhciBzdG9yZTggPSBuZXcgVWludDhBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgIHN0b3JlOC5zZXQobmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciwgbnVtQnl0ZXMpKTsKICAgICAgICAgICAgcmF3RGF0YSA9IG5ldyBPdXRQaXhlbFR5cGVBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmF3RGF0YTsKICAgICAgICB9LAoKICAgICAgICByZWFkTWFzazogZnVuY3Rpb24oaW5wdXQsIGRhdGEpIHsKICAgICAgICAgIHZhciBwdHIgPSBkYXRhLnB0cjsKICAgICAgICAgIHZhciBoZWFkZXJJbmZvID0gZGF0YS5oZWFkZXJJbmZvOwogICAgICAgICAgdmFyIG51bVBpeGVscyA9IGhlYWRlckluZm8ud2lkdGggKiBoZWFkZXJJbmZvLmhlaWdodDsKICAgICAgICAgIHZhciBudW1WYWxpZFBpeGVsID0gaGVhZGVySW5mby5udW1WYWxpZFBpeGVsOwoKICAgICAgICAgIHZhciB2aWV3ID0gbmV3IERhdGFWaWV3KGlucHV0LCBwdHIsIDQpOwogICAgICAgICAgdmFyIG1hc2sgPSB7fTsKICAgICAgICAgIG1hc2subnVtQnl0ZXMgPSB2aWV3LmdldFVpbnQzMigwLCB0cnVlKTsKICAgICAgICAgIHB0ciArPSA0OwoKICAgICAgICAgIC8vIE1hc2sgRGF0YQogICAgICAgICAgaWYgKCgwID09PSBudW1WYWxpZFBpeGVsIHx8IG51bVBpeGVscyA9PT0gbnVtVmFsaWRQaXhlbCkgJiYgMCAhPT0gbWFzay5udW1CeXRlcykgewogICAgICAgICAgICB0aHJvdyAoImludmFsaWQgbWFzayIpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGJpdHNldCwgcmVzdWx0TWFzazsKICAgICAgICAgIGlmIChudW1WYWxpZFBpeGVsID09PSAwKSB7CiAgICAgICAgICAgIGJpdHNldCA9IG5ldyBVaW50OEFycmF5KE1hdGguY2VpbChudW1QaXhlbHMgLyA4KSk7CiAgICAgICAgICAgIG1hc2suYml0c2V0ID0gYml0c2V0OwogICAgICAgICAgICByZXN1bHRNYXNrID0gbmV3IFVpbnQ4QXJyYXkobnVtUGl4ZWxzKTsKICAgICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0TWFzayA9IHJlc3VsdE1hc2s7CiAgICAgICAgICAgIHB0ciArPSBtYXNrLm51bUJ5dGVzOwogICAgICAgICAgfS8vID8/Pz8/IGVsc2UgaWYgKGRhdGEubWFzay5udW1CeXRlcyA+IDAgJiYgZGF0YS5tYXNrLm51bUJ5dGVzPCBkYXRhLm51bVZhbGlkUGl4ZWwpIHsKICAgICAgICAgIGVsc2UgaWYgKG1hc2subnVtQnl0ZXMgPiAwKSB7CiAgICAgICAgICAgIGJpdHNldCA9IG5ldyBVaW50OEFycmF5KE1hdGguY2VpbChudW1QaXhlbHMgLyA4KSk7CiAgICAgICAgICAgIHZpZXcgPSBuZXcgRGF0YVZpZXcoaW5wdXQsIHB0ciwgbWFzay5udW1CeXRlcyk7CiAgICAgICAgICAgIHZhciBjbnQgPSB2aWV3LmdldEludDE2KDAsIHRydWUpOwogICAgICAgICAgICB2YXIgaXAgPSAyLCBvcCA9IDAsIHZhbCA9IDA7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBpZiAoY250ID4gMCkgewogICAgICAgICAgICAgICAgd2hpbGUgKGNudC0tKSB7IGJpdHNldFtvcCsrXSA9IHZpZXcuZ2V0VWludDgoaXArKyk7IH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFsID0gdmlldy5nZXRVaW50OChpcCsrKTsKICAgICAgICAgICAgICAgIGNudCA9IC1jbnQ7CiAgICAgICAgICAgICAgICB3aGlsZSAoY250LS0pIHsgYml0c2V0W29wKytdID0gdmFsOyB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNudCA9IHZpZXcuZ2V0SW50MTYoaXAsIHRydWUpOwogICAgICAgICAgICAgIGlwICs9IDI7CiAgICAgICAgICAgIH0gd2hpbGUgKGlwIDwgbWFzay5udW1CeXRlcyk7CiAgICAgICAgICAgIGlmICgoY250ICE9PSAtMzI3NjgpIHx8IChvcCA8IGJpdHNldC5sZW5ndGgpKSB7CiAgICAgICAgICAgICAgdGhyb3cgIlVuZXhwZWN0ZWQgZW5kIG9mIG1hc2sgUkxFIGVuY29kaW5nIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVzdWx0TWFzayA9IG5ldyBVaW50OEFycmF5KG51bVBpeGVscyk7CiAgICAgICAgICAgIHZhciBtYiA9IDAsIGsgPSAwOwoKICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG51bVBpeGVsczsgaysrKSB7CiAgICAgICAgICAgICAgaWYgKGsgJiA3KSB7CiAgICAgICAgICAgICAgICBtYiA9IGJpdHNldFtrID4+IDNdOwogICAgICAgICAgICAgICAgbWIgPDw9IGsgJiA3OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIG1iID0gYml0c2V0W2sgPj4gM107CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChtYiAmIDEyOCkgewogICAgICAgICAgICAgICAgcmVzdWx0TWFza1trXSA9IDE7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdE1hc2sgPSByZXN1bHRNYXNrOwoKICAgICAgICAgICAgbWFzay5iaXRzZXQgPSBiaXRzZXQ7CiAgICAgICAgICAgIHB0ciArPSBtYXNrLm51bUJ5dGVzOwogICAgICAgICAgfQogICAgICAgICAgZGF0YS5wdHIgPSBwdHI7CiAgICAgICAgICBkYXRhLm1hc2sgPSBtYXNrOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKCiAgICAgICAgcmVhZERhdGFPbmVTd2VlcDogZnVuY3Rpb24oaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KSB7CiAgICAgICAgICB2YXIgcHRyID0gZGF0YS5wdHI7CiAgICAgICAgICB2YXIgaGVhZGVySW5mbyA9IGRhdGEuaGVhZGVySW5mbzsKICAgICAgICAgIHZhciBudW1EaW1zID0gaGVhZGVySW5mby5udW1EaW1zOwogICAgICAgICAgdmFyIG51bVBpeGVscyA9IGhlYWRlckluZm8ud2lkdGggKiBoZWFkZXJJbmZvLmhlaWdodDsKICAgICAgICAgIHZhciBpbWFnZVR5cGUgPSBoZWFkZXJJbmZvLmltYWdlVHlwZTsKICAgICAgICAgIHZhciBudW1CeXRlcyA9IGhlYWRlckluZm8ubnVtVmFsaWRQaXhlbCAqIExlcmMySGVscGVycy5nZXREYXRhVHlwZVNpemUoaW1hZ2VUeXBlKSAqIG51bURpbXM7CiAgICAgICAgICAvL2RhdGEucGl4ZWxzLm51bUJ5dGVzID0gbnVtQnl0ZXM7CiAgICAgICAgICB2YXIgcmF3RGF0YTsKICAgICAgICAgIHZhciBtYXNrID0gZGF0YS5waXhlbHMucmVzdWx0TWFzazsKICAgICAgICAgIGlmIChPdXRQaXhlbFR5cGVBcnJheSA9PT0gVWludDhBcnJheSkgewogICAgICAgICAgICByYXdEYXRhID0gbmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciwgbnVtQnl0ZXMpOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBhcnJheUJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihudW1CeXRlcyk7CiAgICAgICAgICAgIHZhciBzdG9yZTggPSBuZXcgVWludDhBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgIHN0b3JlOC5zZXQobmV3IFVpbnQ4QXJyYXkoaW5wdXQsIHB0ciwgbnVtQnl0ZXMpKTsKICAgICAgICAgICAgcmF3RGF0YSA9IG5ldyBPdXRQaXhlbFR5cGVBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocmF3RGF0YS5sZW5ndGggPT09IG51bVBpeGVscyAqIG51bURpbXMpIHsKICAgICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzID0gcmF3RGF0YTsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgIC8vbWFzawogICAgICAgICAgewogICAgICAgICAgICBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHMgPSBuZXcgT3V0UGl4ZWxUeXBlQXJyYXkobnVtUGl4ZWxzICogbnVtRGltcyk7CiAgICAgICAgICAgIHZhciB6ID0gMCwgayA9IDAsIGkgPSAwLCBuU3RhcnQgPSAwOwogICAgICAgICAgICBpZiAobnVtRGltcyA+IDEpIHsKICAgICAgICAgICAgICBmb3IgKGk9MDsgaSA8IG51bURpbXM7IGkrKykgewogICAgICAgICAgICAgICAgblN0YXJ0ID0gaSAqIG51bVBpeGVsczsKICAgICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBudW1QaXhlbHM7IGsrKykgewogICAgICAgICAgICAgICAgICBpZiAobWFza1trXSkgewogICAgICAgICAgICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVsc1tuU3RhcnQgKyBrXSA9IHJhd0RhdGFbeisrXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgbnVtUGl4ZWxzOyBrKyspIHsKICAgICAgICAgICAgICAgIGlmIChtYXNrW2tdKSB7CiAgICAgICAgICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVsc1trXSA9IHJhd0RhdGFbeisrXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHB0ciArPSBudW1CeXRlczsKICAgICAgICAgIGRhdGEucHRyID0gcHRyOyAgICAgICAvL3JldHVybiBkYXRhOwogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKCiAgICAgICAgcmVhZEh1ZmZtYW5UcmVlOiBmdW5jdGlvbihpbnB1dCwgZGF0YSkgewogICAgICAgICAgdmFyIEJJVFNfTUFYID0gdGhpcy5IVUZGTUFOX0xVVF9CSVRTX01BWDsgLy84IGlzIHNsb3cgZm9yIHRoZSBsYXJnZSB0ZXN0IGltYWdlCiAgICAgICAgICAvL3ZhciBzaXplX21heCA9IDEgPDwgQklUU19NQVg7CiAgICAgICAgICAvKiAqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgICAqIHJlYWRpbmcgY29kZSB0YWJsZQogICAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZGF0YS5wdHIsIDE2KTsKICAgICAgICAgIGRhdGEucHRyICs9IDE2OwogICAgICAgICAgdmFyIHZlcnNpb24gPSB2aWV3LmdldEludDMyKDAsIHRydWUpOwogICAgICAgICAgaWYgKHZlcnNpb24gPCAyKSB7CiAgICAgICAgICAgIHRocm93ICJ1bnN1cHBvcnRlZCBIdWZmbWFuIHZlcnNpb24iOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHNpemUgPSB2aWV3LmdldEludDMyKDQsIHRydWUpOwogICAgICAgICAgdmFyIGkwID0gdmlldy5nZXRJbnQzMig4LCB0cnVlKTsKICAgICAgICAgIHZhciBpMSA9IHZpZXcuZ2V0SW50MzIoMTIsIHRydWUpOwogICAgICAgICAgaWYgKGkwID49IGkxKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBibG9ja0RhdGFCdWZmZXIgPSBuZXcgVWludDMyQXJyYXkoaTEgLSBpMCk7CiAgICAgICAgICBMZXJjMkhlbHBlcnMuZGVjb2RlQml0cyhpbnB1dCwgZGF0YSwgYmxvY2tEYXRhQnVmZmVyKTsKICAgICAgICAgIHZhciBjb2RlVGFibGUgPSBbXTsgLy9zaXplCiAgICAgICAgICB2YXIgaSwgaiwgaywgbGVuOwoKICAgICAgICAgIGZvciAoaSA9IGkwOyBpIDwgaTE7IGkrKykgewogICAgICAgICAgICBqID0gaSAtIChpIDwgc2l6ZSA/IDAgOiBzaXplKTsvL3dyYXAgYXJvdW5kCiAgICAgICAgICAgIGNvZGVUYWJsZVtqXSA9IHsgZmlyc3Q6IGJsb2NrRGF0YUJ1ZmZlcltpIC0gaTBdLCBzZWNvbmQ6IG51bGwgfTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGF0YUJ5dGVzID0gaW5wdXQuYnl0ZUxlbmd0aCAtIGRhdGEucHRyOwogICAgICAgICAgdmFyIGRhdGFXb3JkcyA9IE1hdGguY2VpbChkYXRhQnl0ZXMgLyA0KTsKICAgICAgICAgIHZhciBhcnJheUJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcihkYXRhV29yZHMgKiA0KTsKICAgICAgICAgIHZhciBzdG9yZTggPSBuZXcgVWludDhBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBkYXRhLnB0ciwgZGF0YUJ5dGVzKSk7CiAgICAgICAgICB2YXIgc3R1ZmZlZERhdGEgPSBuZXcgVWludDMyQXJyYXkoYXJyYXlCdWYpOyAvL211c3Qgc3RhcnQgZnJvbSB4KjQKICAgICAgICAgIHZhciBiaXRQb3MgPSAwLCB3b3JkLCBzcmNQdHIgPSAwOwogICAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhWzBdOwogICAgICAgICAgZm9yIChpID0gaTA7IGkgPCBpMTsgaSsrKSB7CiAgICAgICAgICAgIGogPSBpIC0gKGkgPCBzaXplID8gMCA6IHNpemUpOy8vd3JhcCBhcm91bmQKICAgICAgICAgICAgbGVuID0gY29kZVRhYmxlW2pdLmZpcnN0OwogICAgICAgICAgICBpZiAobGVuID4gMCkgewogICAgICAgICAgICAgIGNvZGVUYWJsZVtqXS5zZWNvbmQgPSAod29yZCA8PCBiaXRQb3MpID4+PiAoMzIgLSBsZW4pOwoKICAgICAgICAgICAgICBpZiAoMzIgLSBiaXRQb3MgPj0gbGVuKSB7CiAgICAgICAgICAgICAgICBiaXRQb3MgKz0gbGVuOwogICAgICAgICAgICAgICAgaWYgKGJpdFBvcyA9PT0gMzIpIHsKICAgICAgICAgICAgICAgICAgYml0UG9zID0gMDsKICAgICAgICAgICAgICAgICAgc3JjUHRyKys7CiAgICAgICAgICAgICAgICAgIHdvcmQgPSBzdHVmZmVkRGF0YVtzcmNQdHJdOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGJpdFBvcyArPSBsZW4gLSAzMjsKICAgICAgICAgICAgICAgIHNyY1B0cisrOwogICAgICAgICAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhW3NyY1B0cl07CiAgICAgICAgICAgICAgICBjb2RlVGFibGVbal0uc2Vjb25kIHw9IHdvcmQgPj4+ICgzMiAtIGJpdFBvcyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy9maW5pc2hlZCByZWFkaW5nIGNvZGUgdGFibGUKCiAgICAgICAgICAvKiAqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgICAqIGJ1aWxkaW5nIGx1dAogICAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgICAgICB2YXIgbnVtQml0c0xVVCA9IDAsIG51bUJpdHNMVVRRaWNrID0gMDsKICAgICAgICAgIHZhciB0cmVlID0gbmV3IFRyZWVOb2RlKCk7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29kZVRhYmxlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChjb2RlVGFibGVbaV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIG51bUJpdHNMVVQgPSBNYXRoLm1heChudW1CaXRzTFVULCBjb2RlVGFibGVbaV0uZmlyc3QpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobnVtQml0c0xVVCA+PSBCSVRTX01BWCkgewogICAgICAgICAgICBudW1CaXRzTFVUUWljayA9IEJJVFNfTUFYOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIG51bUJpdHNMVVRRaWNrID0gbnVtQml0c0xVVDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChudW1CaXRzTFVUID49IDMwKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJXQVJuaW5nLCBsYXJnZSBOVU0gTFVUIEJJVFMgSVMgIiArIG51bUJpdHNMVVQpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGRlY29kZUx1dCA9IFtdLCBlbnRyeSwgY29kZSwgbnVtRW50cmllcywgamosIGN1cnJlbnRCaXQsIG5vZGU7CiAgICAgICAgICBmb3IgKGkgPSBpMDsgaSA8IGkxOyBpKyspIHsKICAgICAgICAgICAgaiA9IGkgLSAoaSA8IHNpemUgPyAwIDogc2l6ZSk7Ly93cmFwIGFyb3VuZAogICAgICAgICAgICBsZW4gPSBjb2RlVGFibGVbal0uZmlyc3Q7CiAgICAgICAgICAgIGlmIChsZW4gPiAwKSB7CiAgICAgICAgICAgICAgZW50cnkgPSBbbGVuLCBqXTsKICAgICAgICAgICAgICBpZiAobGVuIDw9IG51bUJpdHNMVVRRaWNrKSB7CiAgICAgICAgICAgICAgICBjb2RlID0gY29kZVRhYmxlW2pdLnNlY29uZCA8PCAobnVtQml0c0xVVFFpY2sgLSBsZW4pOwogICAgICAgICAgICAgICAgbnVtRW50cmllcyA9IDEgPDwgKG51bUJpdHNMVVRRaWNrIC0gbGVuKTsKICAgICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBudW1FbnRyaWVzOyBrKyspIHsKICAgICAgICAgICAgICAgICAgZGVjb2RlTHV0W2NvZGUgfCBrXSA9IGVudHJ5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vYnVpbGQgdHJlZQogICAgICAgICAgICAgICAgY29kZSA9IGNvZGVUYWJsZVtqXS5zZWNvbmQ7CiAgICAgICAgICAgICAgICBub2RlID0gdHJlZTsKICAgICAgICAgICAgICAgIGZvciAoamogPSBsZW4gLSAxOyBqaiA+PSAwOyBqai0tKSB7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRCaXQgPSBjb2RlID4+PiBqaiAmIDE7IC8vbm8gbGVmdCBzaGlmdCBhcyBsZW5ndGggY291bGQgYmUgMzAsMzEKICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRCaXQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIW5vZGUucmlnaHQpIHsKICAgICAgICAgICAgICAgICAgICAgIG5vZGUucmlnaHQgPSBuZXcgVHJlZU5vZGUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucmlnaHQ7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFub2RlLmxlZnQpIHsKICAgICAgICAgICAgICAgICAgICAgIG5vZGUubGVmdCA9IG5ldyBUcmVlTm9kZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5sZWZ0OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChqaiA9PT0gMCAmJiAhbm9kZS52YWwpIHsKICAgICAgICAgICAgICAgICAgICBub2RlLnZhbCA9IGVudHJ5WzFdOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBkZWNvZGVMdXQ6IGRlY29kZUx1dCwKICAgICAgICAgICAgbnVtQml0c0xVVFFpY2s6IG51bUJpdHNMVVRRaWNrLAogICAgICAgICAgICBudW1CaXRzTFVUOiBudW1CaXRzTFVULAogICAgICAgICAgICB0cmVlOiB0cmVlLAogICAgICAgICAgICBzdHVmZmVkRGF0YTogc3R1ZmZlZERhdGEsCiAgICAgICAgICAgIHNyY1B0cjogc3JjUHRyLAogICAgICAgICAgICBiaXRQb3M6IGJpdFBvcwogICAgICAgICAgfTsKICAgICAgICB9LAoKICAgICAgICByZWFkSHVmZm1hbjogZnVuY3Rpb24oaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KSB7CiAgICAgICAgICB2YXIgaGVhZGVySW5mbyA9IGRhdGEuaGVhZGVySW5mbzsKICAgICAgICAgIHZhciBudW1EaW1zID0gaGVhZGVySW5mby5udW1EaW1zOwogICAgICAgICAgdmFyIGhlaWdodCA9IGRhdGEuaGVhZGVySW5mby5oZWlnaHQ7CiAgICAgICAgICB2YXIgd2lkdGggPSBkYXRhLmhlYWRlckluZm8ud2lkdGg7CiAgICAgICAgICB2YXIgbnVtUGl4ZWxzID0gd2lkdGggKiBoZWlnaHQ7CiAgICAgICAgICAvL3ZhciBzaXplX21heCA9IDEgPDwgQklUU19NQVg7CiAgICAgICAgICAvKiAqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgICAgICAqIHJlYWRpbmcgaHVmZm1hbiBzdHJ1Y3R1cmUgaW5mbwogICAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgICAgICB2YXIgaHVmZm1hbkluZm8gPSB0aGlzLnJlYWRIdWZmbWFuVHJlZShpbnB1dCwgZGF0YSk7CiAgICAgICAgICB2YXIgZGVjb2RlTHV0ID0gaHVmZm1hbkluZm8uZGVjb2RlTHV0OwogICAgICAgICAgdmFyIHRyZWUgPSBodWZmbWFuSW5mby50cmVlOwogICAgICAgICAgLy9zdHVmZmVkRGF0YSBpbmNsdWRlcyBodWZmbWFuIGhlYWRlcnMKICAgICAgICAgIHZhciBzdHVmZmVkRGF0YSA9IGh1ZmZtYW5JbmZvLnN0dWZmZWREYXRhOwogICAgICAgICAgdmFyIHNyY1B0ciA9IGh1ZmZtYW5JbmZvLnNyY1B0cjsKICAgICAgICAgIHZhciBiaXRQb3MgPSBodWZmbWFuSW5mby5iaXRQb3M7CiAgICAgICAgICB2YXIgbnVtQml0c0xVVFFpY2sgPSBodWZmbWFuSW5mby5udW1CaXRzTFVUUWljazsKICAgICAgICAgIHZhciBudW1CaXRzTFVUID0gaHVmZm1hbkluZm8ubnVtQml0c0xVVDsKICAgICAgICAgIHZhciBvZmZzZXQgPSBkYXRhLmhlYWRlckluZm8uaW1hZ2VUeXBlID09PSAwID8gMTI4IDogMDsKICAgICAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgICAgICAqICBkZWNvZGUKICAgICAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgICAgIHZhciBub2RlLCB2YWwsIGRlbHRhLCBtYXNrID0gZGF0YS5waXhlbHMucmVzdWx0TWFzaywgdmFsVG1wLCB2YWxUbXBRdWljaywgY3VycmVudEJpdDsKICAgICAgICAgIHZhciBpLCBqLCBrLCBpaTsKICAgICAgICAgIHZhciBwcmV2VmFsID0gMDsKICAgICAgICAgIGlmIChiaXRQb3MgPiAwKSB7CiAgICAgICAgICAgIHNyY1B0cisrOwogICAgICAgICAgICBiaXRQb3MgPSAwOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHdvcmQgPSBzdHVmZmVkRGF0YVtzcmNQdHJdOwogICAgICAgICAgdmFyIGRlbHRhRW5jb2RlID0gZGF0YS5lbmNvZGVNb2RlID09PSAxOwogICAgICAgICAgdmFyIHJlc3VsdFBpeGVsc0FsbERpbSA9IG5ldyBPdXRQaXhlbFR5cGVBcnJheShudW1QaXhlbHMgKiBudW1EaW1zKTsKICAgICAgICAgIHZhciByZXN1bHRQaXhlbHMgPSByZXN1bHRQaXhlbHNBbGxEaW07CiAgICAgICAgICB2YXIgaURpbTsKICAgICAgICAgIGZvciAoaURpbSA9IDA7IGlEaW0gPCBoZWFkZXJJbmZvLm51bURpbXM7IGlEaW0rKykgewogICAgICAgICAgICBpZiAobnVtRGltcyA+IDEpIHsKICAgICAgICAgICAgICAvL2dldCB0aGUgbWVtIGJsb2NrIG9mIGN1cnJlbnQgZGltZW5zaW9uCiAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzID0gbmV3IE91dFBpeGVsVHlwZUFycmF5KHJlc3VsdFBpeGVsc0FsbERpbS5idWZmZXIsIG51bVBpeGVscyAqIGlEaW0sIG51bVBpeGVscyk7CiAgICAgICAgICAgICAgcHJldlZhbCA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRhdGEuaGVhZGVySW5mby5udW1WYWxpZFBpeGVsID09PSB3aWR0aCAqIGhlaWdodCkgeyAvL2FsbCB2YWxpZAogICAgICAgICAgICAgIGZvciAoayA9IDAsIGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB3aWR0aDsgaisrLCBrKyspIHsKICAgICAgICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgICAgICAgICAgdmFsVG1wID0gKHdvcmQgPDwgYml0UG9zKSA+Pj4gKDMyIC0gbnVtQml0c0xVVFFpY2spOwogICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICBpZiAoMzIgLSBiaXRQb3MgPCBudW1CaXRzTFVUUWljaykgewogICAgICAgICAgICAgICAgICAgIHZhbFRtcCB8PSAoKHN0dWZmZWREYXRhW3NyY1B0ciArIDFdKSA+Pj4gKDY0IC0gYml0UG9zIC0gbnVtQml0c0xVVFFpY2spKTsKICAgICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChkZWNvZGVMdXRbdmFsVG1wUXVpY2tdKSAgICAvLyBpZiB0aGVyZSwgbW92ZSB0aGUgY29ycmVjdCBudW1iZXIgb2YgYml0cyBhbmQgZG9uZQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gZGVjb2RlTHV0W3ZhbFRtcFF1aWNrXVsxXTsKICAgICAgICAgICAgICAgICAgICBiaXRQb3MgKz0gZGVjb2RlTHV0W3ZhbFRtcFF1aWNrXVswXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YWxUbXAgPSAod29yZCA8PCBiaXRQb3MpID4+PiAoMzIgLSBudW1CaXRzTFVUKTsKICAgICAgICAgICAgICAgICAgICB2YWxUbXBRdWljayA9IHZhbFRtcDsvLyA+Pj4gZGVsdGFCaXRzOwogICAgICAgICAgICAgICAgICAgIGlmICgzMiAtIGJpdFBvcyA8IG51bUJpdHNMVVQpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhbFRtcCB8PSAoKHN0dWZmZWREYXRhW3NyY1B0ciArIDFdKSA+Pj4gKDY0IC0gYml0UG9zIC0gbnVtQml0c0xVVCkpOwogICAgICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7Ly8gPj4+IGRlbHRhQml0czsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IHRyZWU7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpaSA9IDA7IGlpIDwgbnVtQml0c0xVVDsgaWkrKykgewogICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJpdCA9IHZhbFRtcCA+Pj4gKG51bUJpdHNMVVQgLSBpaSAtIDEpICYgMTsKICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSBjdXJyZW50Qml0ID8gbm9kZS5yaWdodCA6IG5vZGUubGVmdDsKICAgICAgICAgICAgICAgICAgICAgIGlmICghKG5vZGUubGVmdCB8fCBub2RlLnJpZ2h0KSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBub2RlLnZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgYml0UG9zID0gYml0UG9zICsgaWkgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmIChiaXRQb3MgPj0gMzIpIHsKICAgICAgICAgICAgICAgICAgICBiaXRQb3MgLT0gMzI7CiAgICAgICAgICAgICAgICAgICAgc3JjUHRyKys7CiAgICAgICAgICAgICAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhW3NyY1B0cl07CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGRlbHRhID0gdmFsIC0gb2Zmc2V0OwogICAgICAgICAgICAgICAgICBpZiAoZGVsdGFFbmNvZGUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaiA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgIGRlbHRhICs9IHByZXZWYWw7ICAgIC8vIHVzZSBvdmVyZmxvdwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgZGVsdGEgKz0gcmVzdWx0UGl4ZWxzW2sgLSB3aWR0aF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgZGVsdGEgKz0gcHJldlZhbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZGVsdGEgJj0gMHhGRjsgLy9vdmVyZmxvdwogICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1trXSA9IGRlbHRhOy8vb3ZlcmZsb3cKICAgICAgICAgICAgICAgICAgICBwcmV2VmFsID0gZGVsdGE7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzW2tdID0gZGVsdGE7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7IC8vbm90IGFsbCB2YWxpZCwgdXNlIG1hc2sKICAgICAgICAgICAgICBmb3IgKGsgPSAwLCBpID0gMDsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgd2lkdGg7IGorKywgaysrKSB7CiAgICAgICAgICAgICAgICAgIGlmIChtYXNrW2tdKSB7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gMDsKICAgICAgICAgICAgICAgICAgICB2YWxUbXAgPSAod29yZCA8PCBiaXRQb3MpID4+PiAoMzIgLSBudW1CaXRzTFVUUWljayk7CiAgICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7Ly8gPj4+IGRlbHRhQml0czsKICAgICAgICAgICAgICAgICAgICBpZiAoMzIgLSBiaXRQb3MgPCBudW1CaXRzTFVUUWljaykgewogICAgICAgICAgICAgICAgICAgICAgdmFsVG1wIHw9ICgoc3R1ZmZlZERhdGFbc3JjUHRyICsgMV0pID4+PiAoNjQgLSBiaXRQb3MgLSBudW1CaXRzTFVUUWljaykpOwogICAgICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7Ly8gPj4+IGRlbHRhQml0czsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGRlY29kZUx1dFt2YWxUbXBRdWlja10pICAgIC8vIGlmIHRoZXJlLCBtb3ZlIHRoZSBjb3JyZWN0IG51bWJlciBvZiBiaXRzIGFuZCBkb25lCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgdmFsID0gZGVjb2RlTHV0W3ZhbFRtcFF1aWNrXVsxXTsKICAgICAgICAgICAgICAgICAgICAgIGJpdFBvcyArPSBkZWNvZGVMdXRbdmFsVG1wUXVpY2tdWzBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIHZhbFRtcCA9ICh3b3JkIDw8IGJpdFBvcykgPj4+ICgzMiAtIG51bUJpdHNMVVQpOwogICAgICAgICAgICAgICAgICAgICAgdmFsVG1wUXVpY2sgPSB2YWxUbXA7Ly8gPj4+IGRlbHRhQml0czsKICAgICAgICAgICAgICAgICAgICAgIGlmICgzMiAtIGJpdFBvcyA8IG51bUJpdHNMVVQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFsVG1wIHw9ICgoc3R1ZmZlZERhdGFbc3JjUHRyICsgMV0pID4+PiAoNjQgLSBiaXRQb3MgLSBudW1CaXRzTFVUKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbFRtcFF1aWNrID0gdmFsVG1wOy8vID4+PiBkZWx0YUJpdHM7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBub2RlID0gdHJlZTsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoaWkgPSAwOyBpaSA8IG51bUJpdHNMVVQ7IGlpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEJpdCA9IHZhbFRtcCA+Pj4gKG51bUJpdHNMVVQgLSBpaSAtIDEpICYgMTsKICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IGN1cnJlbnRCaXQgPyBub2RlLnJpZ2h0IDogbm9kZS5sZWZ0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShub2RlLmxlZnQgfHwgbm9kZS5yaWdodCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwgPSBub2RlLnZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgICBiaXRQb3MgPSBiaXRQb3MgKyBpaSArIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChiaXRQb3MgPj0gMzIpIHsKICAgICAgICAgICAgICAgICAgICAgIGJpdFBvcyAtPSAzMjsKICAgICAgICAgICAgICAgICAgICAgIHNyY1B0cisrOwogICAgICAgICAgICAgICAgICAgICAgd29yZCA9IHN0dWZmZWREYXRhW3NyY1B0cl07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBkZWx0YSA9IHZhbCAtIG9mZnNldDsKICAgICAgICAgICAgICAgICAgICBpZiAoZGVsdGFFbmNvZGUpIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChqID4gMCAmJiBtYXNrW2sgLSAxXSkgewogICAgICAgICAgICAgICAgICAgICAgICBkZWx0YSArPSBwcmV2VmFsOyAgICAvLyB1c2Ugb3ZlcmZsb3cKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGkgPiAwICYmIG1hc2tbayAtIHdpZHRoXSkgewogICAgICAgICAgICAgICAgICAgICAgICBkZWx0YSArPSByZXN1bHRQaXhlbHNbayAtIHdpZHRoXTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBkZWx0YSArPSBwcmV2VmFsOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGRlbHRhICY9IDB4RkY7IC8vb3ZlcmZsb3cKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1trXSA9IGRlbHRhOy8vb3ZlcmZsb3cKICAgICAgICAgICAgICAgICAgICAgIHByZXZWYWwgPSBkZWx0YTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNba10gPSBkZWx0YTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YS5wdHIgPSBkYXRhLnB0ciArIChzcmNQdHIgKyAxKSAqIDQgKyAoYml0UG9zID4gMCA/IDQgOiAwKTsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVscyA9IHJlc3VsdFBpeGVsc0FsbERpbTsKICAgICAgICB9LAoKICAgICAgICBkZWNvZGVCaXRzOiBmdW5jdGlvbihpbnB1dCwgZGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBvZmZzZXQsIGlEaW0pIHsKICAgICAgICAgIHsKICAgICAgICAgICAgLy9iaXRzdHVmZiBlbmNvZGluZyBpcyAzCiAgICAgICAgICAgIHZhciBoZWFkZXJJbmZvID0gZGF0YS5oZWFkZXJJbmZvOwogICAgICAgICAgICB2YXIgZmlsZVZlcnNpb24gPSBoZWFkZXJJbmZvLmZpbGVWZXJzaW9uOwogICAgICAgICAgICAvL3ZhciBibG9jayA9IHt9OwogICAgICAgICAgICB2YXIgYmxvY2tQdHIgPSAwOwogICAgICAgICAgICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZGF0YS5wdHIsIDUpOy8vdG8gZG8KICAgICAgICAgICAgdmFyIGhlYWRlckJ5dGUgPSB2aWV3LmdldFVpbnQ4KDApOwogICAgICAgICAgICBibG9ja1B0cisrOwogICAgICAgICAgICB2YXIgYml0czY3ID0gaGVhZGVyQnl0ZSA+PiA2OwogICAgICAgICAgICB2YXIgbiA9IChiaXRzNjcgPT09IDApID8gNCA6IDMgLSBiaXRzNjc7CiAgICAgICAgICAgIHZhciBkb0x1dCA9IChoZWFkZXJCeXRlICYgMzIpID4gMCA/IHRydWUgOiBmYWxzZTsvLzV0aCBiaXQKICAgICAgICAgICAgdmFyIG51bUJpdHMgPSBoZWFkZXJCeXRlICYgMzE7CiAgICAgICAgICAgIHZhciBudW1FbGVtZW50cyA9IDA7CiAgICAgICAgICAgIGlmIChuID09PSAxKSB7CiAgICAgICAgICAgICAgbnVtRWxlbWVudHMgPSB2aWV3LmdldFVpbnQ4KGJsb2NrUHRyKTsgYmxvY2tQdHIrKzsKICAgICAgICAgICAgfSBlbHNlIGlmIChuID09PSAyKSB7CiAgICAgICAgICAgICAgbnVtRWxlbWVudHMgPSB2aWV3LmdldFVpbnQxNihibG9ja1B0ciwgdHJ1ZSk7IGJsb2NrUHRyICs9IDI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobiA9PT0gNCkgewogICAgICAgICAgICAgIG51bUVsZW1lbnRzID0gdmlldy5nZXRVaW50MzIoYmxvY2tQdHIsIHRydWUpOyBibG9ja1B0ciArPSA0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93ICJJbnZhbGlkIHZhbGlkIHBpeGVsIGNvdW50IHR5cGUiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vZml4OiBodWZmbWFuIGNvZGVzIGFyZSBiaXQgc3R1ZmZlZCwgYnV0IG5vdCBib3VuZCBieSBkYXRhJ3MgbWF4IHZhbHVlLCBzbyBuZWVkIHRvIHVzZSBvcmlnaW5hbFVuc3R1ZmYKICAgICAgICAgICAgLy9vZmZzZXQgPSBvZmZzZXQgfHwgMDsKICAgICAgICAgICAgdmFyIHNjYWxlID0gMiAqIGhlYWRlckluZm8ubWF4WkVycm9yOwogICAgICAgICAgICB2YXIgc3R1ZmZlZERhdGEsIGFycmF5QnVmLCBzdG9yZTgsIGRhdGFCeXRlcywgZGF0YVdvcmRzOwogICAgICAgICAgICB2YXIgbHV0QXJyLCBsdXREYXRhLCBsdXRCeXRlcywgYml0c1BlclBpeGVsOwogICAgICAgICAgICB2YXIgek1heCA9IGhlYWRlckluZm8ubnVtRGltcyA+IDEgPyBoZWFkZXJJbmZvLm1heFZhbHVlc1tpRGltXSA6IGhlYWRlckluZm8uek1heDsKICAgICAgICAgICAgaWYgKGRvTHV0KSB7CiAgICAgICAgICAgICAgZGF0YS5jb3VudGVyLmx1dCsrOwogICAgICAgICAgICAgIGx1dEJ5dGVzID0gdmlldy5nZXRVaW50OChibG9ja1B0cik7CiAgICAgICAgICAgICAgYmxvY2tQdHIrKzsKICAgICAgICAgICAgICBkYXRhQnl0ZXMgPSBNYXRoLmNlaWwoKGx1dEJ5dGVzIC0gMSkgKiBudW1CaXRzIC8gOCk7CiAgICAgICAgICAgICAgZGF0YVdvcmRzID0gTWF0aC5jZWlsKGRhdGFCeXRlcyAvIDQpOwogICAgICAgICAgICAgIGFycmF5QnVmID0gbmV3IEFycmF5QnVmZmVyKGRhdGFXb3JkcyAqIDQpOwogICAgICAgICAgICAgIHN0b3JlOCA9IG5ldyBVaW50OEFycmF5KGFycmF5QnVmKTsKCiAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gYmxvY2tQdHI7CiAgICAgICAgICAgICAgc3RvcmU4LnNldChuZXcgVWludDhBcnJheShpbnB1dCwgZGF0YS5wdHIsIGRhdGFCeXRlcykpOwoKICAgICAgICAgICAgICBsdXREYXRhID0gbmV3IFVpbnQzMkFycmF5KGFycmF5QnVmKTsKICAgICAgICAgICAgICBkYXRhLnB0ciArPSBkYXRhQnl0ZXM7CgogICAgICAgICAgICAgIGJpdHNQZXJQaXhlbCA9IDA7CiAgICAgICAgICAgICAgd2hpbGUgKChsdXRCeXRlcyAtIDEpID4+PiBiaXRzUGVyUGl4ZWwpIHsKICAgICAgICAgICAgICAgIGJpdHNQZXJQaXhlbCsrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBkYXRhQnl0ZXMgPSBNYXRoLmNlaWwobnVtRWxlbWVudHMgKiBiaXRzUGVyUGl4ZWwgLyA4KTsKICAgICAgICAgICAgICBkYXRhV29yZHMgPSBNYXRoLmNlaWwoZGF0YUJ5dGVzIC8gNCk7CiAgICAgICAgICAgICAgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIoZGF0YVdvcmRzICogNCk7CiAgICAgICAgICAgICAgc3RvcmU4ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWYpOwogICAgICAgICAgICAgIHN0b3JlOC5zZXQobmV3IFVpbnQ4QXJyYXkoaW5wdXQsIGRhdGEucHRyLCBkYXRhQnl0ZXMpKTsKICAgICAgICAgICAgICBzdHVmZmVkRGF0YSA9IG5ldyBVaW50MzJBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gZGF0YUJ5dGVzOwogICAgICAgICAgICAgIGlmIChmaWxlVmVyc2lvbiA+PSAzKSB7CiAgICAgICAgICAgICAgICBsdXRBcnIgPSBCaXRTdHVmZmVyLnVuc3R1ZmZMVVQyKGx1dERhdGEsIG51bUJpdHMsIGx1dEJ5dGVzIC0gMSwgb2Zmc2V0LCBzY2FsZSwgek1heCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgbHV0QXJyID0gQml0U3R1ZmZlci51bnN0dWZmTFVUKGx1dERhdGEsIG51bUJpdHMsIGx1dEJ5dGVzIC0gMSwgb2Zmc2V0LCBzY2FsZSwgek1heCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vbHV0QXJyLnVuc2hpZnQoMCk7CiAgICAgICAgICAgICAgaWYgKGZpbGVWZXJzaW9uID49IDMpIHsKICAgICAgICAgICAgICAgIC8vQml0U3R1ZmZlci51bnN0dWZmMihibG9jaywgYmxvY2tEYXRhQnVmZmVyLCBoZWFkZXJJbmZvLnpNYXgpOwogICAgICAgICAgICAgICAgQml0U3R1ZmZlci51bnN0dWZmMihzdHVmZmVkRGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBiaXRzUGVyUGl4ZWwsIG51bUVsZW1lbnRzLCBsdXRBcnIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIEJpdFN0dWZmZXIudW5zdHVmZihzdHVmZmVkRGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBiaXRzUGVyUGl4ZWwsIG51bUVsZW1lbnRzLCBsdXRBcnIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAvL2NvbnNvbGUuZGVidWcoImJpdHN0dWZmZXIiKTsKICAgICAgICAgICAgICBkYXRhLmNvdW50ZXIuYml0c3R1ZmZlcisrOwogICAgICAgICAgICAgIGJpdHNQZXJQaXhlbCA9IG51bUJpdHM7CiAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gYmxvY2tQdHI7CiAgICAgICAgICAgICAgaWYgKGJpdHNQZXJQaXhlbCA+IDApIHsKICAgICAgICAgICAgICAgIGRhdGFCeXRlcyA9IE1hdGguY2VpbChudW1FbGVtZW50cyAqIGJpdHNQZXJQaXhlbCAvIDgpOwogICAgICAgICAgICAgICAgZGF0YVdvcmRzID0gTWF0aC5jZWlsKGRhdGFCeXRlcyAvIDQpOwogICAgICAgICAgICAgICAgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIoZGF0YVdvcmRzICogNCk7CiAgICAgICAgICAgICAgICBzdG9yZTggPSBuZXcgVWludDhBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBkYXRhLnB0ciwgZGF0YUJ5dGVzKSk7CiAgICAgICAgICAgICAgICBzdHVmZmVkRGF0YSA9IG5ldyBVaW50MzJBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgICBkYXRhLnB0ciArPSBkYXRhQnl0ZXM7CiAgICAgICAgICAgICAgICBpZiAoZmlsZVZlcnNpb24gPj0gMykgewogICAgICAgICAgICAgICAgICBpZiAob2Zmc2V0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBCaXRTdHVmZmVyLm9yaWdpbmFsVW5zdHVmZjIoc3R1ZmZlZERhdGEsIGJsb2NrRGF0YUJ1ZmZlciwgYml0c1BlclBpeGVsLCBudW1FbGVtZW50cyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgQml0U3R1ZmZlci51bnN0dWZmMihzdHVmZmVkRGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBiaXRzUGVyUGl4ZWwsIG51bUVsZW1lbnRzLCBmYWxzZSwgb2Zmc2V0LCBzY2FsZSwgek1heCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICBpZiAob2Zmc2V0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBCaXRTdHVmZmVyLm9yaWdpbmFsVW5zdHVmZihzdHVmZmVkRGF0YSwgYmxvY2tEYXRhQnVmZmVyLCBiaXRzUGVyUGl4ZWwsIG51bUVsZW1lbnRzKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBCaXRTdHVmZmVyLnVuc3R1ZmYoc3R1ZmZlZERhdGEsIGJsb2NrRGF0YUJ1ZmZlciwgYml0c1BlclBpeGVsLCBudW1FbGVtZW50cywgZmFsc2UsIG9mZnNldCwgc2NhbGUsIHpNYXgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgIH0sCgogICAgICAgIHJlYWRUaWxlczogZnVuY3Rpb24oaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KSB7CiAgICAgICAgICB2YXIgaGVhZGVySW5mbyA9IGRhdGEuaGVhZGVySW5mbzsKICAgICAgICAgIHZhciB3aWR0aCA9IGhlYWRlckluZm8ud2lkdGg7CiAgICAgICAgICB2YXIgaGVpZ2h0ID0gaGVhZGVySW5mby5oZWlnaHQ7CiAgICAgICAgICB2YXIgbWljcm9CbG9ja1NpemUgPSBoZWFkZXJJbmZvLm1pY3JvQmxvY2tTaXplOwogICAgICAgICAgdmFyIGltYWdlVHlwZSA9IGhlYWRlckluZm8uaW1hZ2VUeXBlOwogICAgICAgICAgdmFyIGRhdGFUeXBlU2l6ZSA9IExlcmMySGVscGVycy5nZXREYXRhVHlwZVNpemUoaW1hZ2VUeXBlKTsKICAgICAgICAgIHZhciBudW1CbG9ja3NYID0gTWF0aC5jZWlsKHdpZHRoIC8gbWljcm9CbG9ja1NpemUpOwogICAgICAgICAgdmFyIG51bUJsb2Nrc1kgPSBNYXRoLmNlaWwoaGVpZ2h0IC8gbWljcm9CbG9ja1NpemUpOwogICAgICAgICAgZGF0YS5waXhlbHMubnVtQmxvY2tzWSA9IG51bUJsb2Nrc1k7CiAgICAgICAgICBkYXRhLnBpeGVscy5udW1CbG9ja3NYID0gbnVtQmxvY2tzWDsKICAgICAgICAgIGRhdGEucGl4ZWxzLnB0ciA9IDA7CiAgICAgICAgICB2YXIgcm93ID0gMCwgY29sID0gMCwgYmxvY2tZID0gMCwgYmxvY2tYID0gMCwgdGhpc0Jsb2NrSGVpZ2h0ID0gMCwgdGhpc0Jsb2NrV2lkdGggPSAwLCBieXRlc0xlZnQgPSAwLCBoZWFkZXJCeXRlID0gMCwgYml0czY3ID0gMCwgdGVzdENvZGUgPSAwLCBvdXRQdHIgPSAwLCBvdXRTdHJpZGUgPSAwLCBudW1CeXRlcyA9IDAsIGJ5dGVzbGVmdCA9IDAsIHogPSAwLCBibG9ja1B0ciA9IDA7CiAgICAgICAgICB2YXIgdmlldywgYmxvY2ssIGFycmF5QnVmLCBzdG9yZTgsIHJhd0RhdGE7CiAgICAgICAgICB2YXIgYmxvY2tFbmNvZGluZzsKICAgICAgICAgIHZhciBibG9ja0RhdGFCdWZmZXIgPSBuZXcgT3V0UGl4ZWxUeXBlQXJyYXkobWljcm9CbG9ja1NpemUgKiBtaWNyb0Jsb2NrU2l6ZSk7CiAgICAgICAgICB2YXIgbGFzdEJsb2NrSGVpZ2h0ID0gKGhlaWdodCAlIG1pY3JvQmxvY2tTaXplKSB8fCBtaWNyb0Jsb2NrU2l6ZTsKICAgICAgICAgIHZhciBsYXN0QmxvY2tXaWR0aCA9ICh3aWR0aCAlIG1pY3JvQmxvY2tTaXplKSB8fCBtaWNyb0Jsb2NrU2l6ZTsKICAgICAgICAgIHZhciBvZmZzZXRUeXBlLCBvZmZzZXQ7CiAgICAgICAgICB2YXIgbnVtRGltcyA9IGhlYWRlckluZm8ubnVtRGltcywgaURpbTsKICAgICAgICAgIHZhciBtYXNrID0gZGF0YS5waXhlbHMucmVzdWx0TWFzazsKICAgICAgICAgIHZhciByZXN1bHRQaXhlbHMgPSBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHM7CiAgICAgICAgICBmb3IgKGJsb2NrWSA9IDA7IGJsb2NrWSA8IG51bUJsb2Nrc1k7IGJsb2NrWSsrKSB7CiAgICAgICAgICAgIHRoaXNCbG9ja0hlaWdodCA9IChibG9ja1kgIT09IG51bUJsb2Nrc1kgLSAxKSA/IG1pY3JvQmxvY2tTaXplIDogbGFzdEJsb2NrSGVpZ2h0OwogICAgICAgICAgICBmb3IgKGJsb2NrWCA9IDA7IGJsb2NrWCA8IG51bUJsb2Nrc1g7IGJsb2NrWCsrKSB7CiAgICAgICAgICAgICAgLy9jb25zb2xlLmRlYnVnKCJ5IiArIGJsb2NrWSArICIgeCIgKyBibG9ja1gpOwogICAgICAgICAgICAgIHRoaXNCbG9ja1dpZHRoID0gKGJsb2NrWCAhPT0gbnVtQmxvY2tzWCAtIDEpID8gbWljcm9CbG9ja1NpemUgOiBsYXN0QmxvY2tXaWR0aDsKCiAgICAgICAgICAgICAgb3V0UHRyID0gYmxvY2tZICogd2lkdGggKiBtaWNyb0Jsb2NrU2l6ZSArIGJsb2NrWCAqIG1pY3JvQmxvY2tTaXplOwogICAgICAgICAgICAgIG91dFN0cmlkZSA9IHdpZHRoIC0gdGhpc0Jsb2NrV2lkdGg7CgoKICAgICAgICAgICAgICBmb3IgKGlEaW0gPSAwOyBpRGltIDwgbnVtRGltczsgaURpbSsrKSB7CiAgICAgICAgICAgICAgICBpZiAobnVtRGltcyA+IDEpIHsKICAgICAgICAgICAgICAgICAgcmVzdWx0UGl4ZWxzID0gbmV3IE91dFBpeGVsVHlwZUFycmF5KGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVscy5idWZmZXIsIHdpZHRoICogaGVpZ2h0ICogaURpbSAqIGRhdGFUeXBlU2l6ZSwgd2lkdGggKiBoZWlnaHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnl0ZXNMZWZ0ID0gaW5wdXQuYnl0ZUxlbmd0aCAtIGRhdGEucHRyOwogICAgICAgICAgICAgICAgdmlldyA9IG5ldyBEYXRhVmlldyhpbnB1dCwgZGF0YS5wdHIsIE1hdGgubWluKDEwLCBieXRlc0xlZnQpKTsKICAgICAgICAgICAgICAgIGJsb2NrID0ge307CiAgICAgICAgICAgICAgICBibG9ja1B0ciA9IDA7CiAgICAgICAgICAgICAgICBoZWFkZXJCeXRlID0gdmlldy5nZXRVaW50OCgwKTsKICAgICAgICAgICAgICAgIGJsb2NrUHRyKys7CiAgICAgICAgICAgICAgICBiaXRzNjcgPSAoaGVhZGVyQnl0ZSA+PiA2KSAmIDB4RkY7CiAgICAgICAgICAgICAgICB0ZXN0Q29kZSA9IChoZWFkZXJCeXRlID4+IDIpICYgMTU7ICAgIC8vIHVzZSBiaXRzIDIzNDUgZm9yIGludGVncml0eSBjaGVjawogICAgICAgICAgICAgICAgaWYgKHRlc3RDb2RlICE9PSAoKChibG9ja1ggKiBtaWNyb0Jsb2NrU2l6ZSkgPj4gMykgJiAxNSkpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgImludGVncml0eSBpc3N1ZSI7CiAgICAgICAgICAgICAgICAgIC8vcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGJsb2NrRW5jb2RpbmcgPSBoZWFkZXJCeXRlICYgMzsKICAgICAgICAgICAgICAgIGlmIChibG9ja0VuY29kaW5nID4gMykgewogICAgICAgICAgICAgICAgICBkYXRhLnB0ciArPSBibG9ja1B0cjsKICAgICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgYmxvY2sgZW5jb2RpbmcgKCIgKyBibG9ja0VuY29kaW5nICsgIikiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSBpZiAoYmxvY2tFbmNvZGluZyA9PT0gMikgeyAvL2NvbnN0YW50IDAKICAgICAgICAgICAgICAgICAgZGF0YS5jb3VudGVyLmNvbnN0YW50Kys7CiAgICAgICAgICAgICAgICAgIGRhdGEucHRyICs9IGJsb2NrUHRyOwogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJsb2NrRW5jb2RpbmcgPT09IDApIHsgIC8vdW5jb21wcmVzc2VkCiAgICAgICAgICAgICAgICAgIGRhdGEuY291bnRlci51bmNvbXByZXNzZWQrKzsKICAgICAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gYmxvY2tQdHI7CiAgICAgICAgICAgICAgICAgIG51bUJ5dGVzID0gdGhpc0Jsb2NrSGVpZ2h0ICogdGhpc0Jsb2NrV2lkdGggKiBkYXRhVHlwZVNpemU7CiAgICAgICAgICAgICAgICAgIGJ5dGVzbGVmdCA9IGlucHV0LmJ5dGVMZW5ndGggLSBkYXRhLnB0cjsKICAgICAgICAgICAgICAgICAgbnVtQnl0ZXMgPSBudW1CeXRlcyA8IGJ5dGVzbGVmdCA/IG51bUJ5dGVzIDogYnl0ZXNsZWZ0OwogICAgICAgICAgICAgICAgICAvL2JpdCBhbGlnbm1lbnQKICAgICAgICAgICAgICAgICAgYXJyYXlCdWYgPSBuZXcgQXJyYXlCdWZmZXIoKG51bUJ5dGVzICUgZGF0YVR5cGVTaXplKSA9PT0gMCA/IG51bUJ5dGVzIDogKG51bUJ5dGVzICsgZGF0YVR5cGVTaXplIC0gbnVtQnl0ZXMgJSBkYXRhVHlwZVNpemUpKTsKICAgICAgICAgICAgICAgICAgc3RvcmU4ID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWYpOwogICAgICAgICAgICAgICAgICBzdG9yZTguc2V0KG5ldyBVaW50OEFycmF5KGlucHV0LCBkYXRhLnB0ciwgbnVtQnl0ZXMpKTsKICAgICAgICAgICAgICAgICAgcmF3RGF0YSA9IG5ldyBPdXRQaXhlbFR5cGVBcnJheShhcnJheUJ1Zik7CiAgICAgICAgICAgICAgICAgIHogPSAwOwogICAgICAgICAgICAgICAgICBpZiAobWFzaykgewogICAgICAgICAgICAgICAgICAgIGZvciAocm93ID0gMDsgcm93IDwgdGhpc0Jsb2NrSGVpZ2h0OyByb3crKykgewogICAgICAgICAgICAgICAgICAgICAgZm9yIChjb2wgPSAwOyBjb2wgPCB0aGlzQmxvY2tXaWR0aDsgY29sKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hc2tbb3V0UHRyXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHJdID0gcmF3RGF0YVt6KytdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG91dFB0cisrOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7Ly9hbGwgdmFsaWQKICAgICAgICAgICAgICAgICAgICBmb3IgKHJvdyA9IDA7IHJvdyA8IHRoaXNCbG9ja0hlaWdodDsgcm93KyspIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29sID0gMDsgY29sIDwgdGhpc0Jsb2NrV2lkdGg7IGNvbCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHIrK10gPSByYXdEYXRhW3orK107CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBvdXRQdHIgKz0gb3V0U3RyaWRlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBkYXRhLnB0ciArPSB6ICogZGF0YVR5cGVTaXplOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7IC8vMSBvciAzCiAgICAgICAgICAgICAgICAgIG9mZnNldFR5cGUgPSBMZXJjMkhlbHBlcnMuZ2V0RGF0YVR5cGVVc2VkKGltYWdlVHlwZSwgYml0czY3KTsKICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gTGVyYzJIZWxwZXJzLmdldE9uZVBpeGVsKGJsb2NrLCBibG9ja1B0ciwgb2Zmc2V0VHlwZSwgdmlldyk7CiAgICAgICAgICAgICAgICAgIGJsb2NrUHRyICs9IExlcmMySGVscGVycy5nZXREYXRhVHlwZVNpemUob2Zmc2V0VHlwZSk7CiAgICAgICAgICAgICAgICAgIGlmIChibG9ja0VuY29kaW5nID09PSAzKSAvL2NvbnN0YW50IG9mZnNldCB2YWx1ZQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdHIgKz0gYmxvY2tQdHI7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5jb3VudGVyLmNvbnN0YW50b2Zmc2V0Kys7CiAgICAgICAgICAgICAgICAgICAgLy95b3UgY2FuIGRlbGV0ZSB0aGUgZm9sbG93aW5nIHJlc3VsdE1hc2sgY2FzZSBpbiBmYXZvciBvZiBwZXJmb3JtYW5jZSBiZWNhdXNlIHZhbCBpcyBjb25zdGFudCBhbmQgdXNlcnMgdXNlIG5vZGF0YSBtYXNrLCBvdGhlcndpc2Ugbm9kYXRhdmFsdWUgcG9zdCBwcm9jZXNzaW5nIGhhbmRsZXMgaXQgdG9vLgogICAgICAgICAgICAgICAgICAgIC8vd2hpbGUgdGhlIGFib3ZlIHN0YXRlbWVudCBpcyB0cnVlLCB3ZSdyZSBub3QgZG9pbmcgaXQgYXMgd2Ugd2FudCB0byBrZWVwIGludmFsaWQgcGl4ZWwgdmFsdWUgYXQgMCByYXRoZXIgdGhhbiBhcmJpdHJhcnkgdmFsdWVzCiAgICAgICAgICAgICAgICAgICAgaWYgKG1hc2spIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAocm93ID0gMDsgcm93IDwgdGhpc0Jsb2NrSGVpZ2h0OyByb3crKykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbCA9IDA7IGNvbCA8IHRoaXNCbG9ja1dpZHRoOyBjb2wrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXNrW291dFB0cl0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHJdID0gb2Zmc2V0OwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRQdHIrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBvdXRQdHIgKz0gb3V0U3RyaWRlOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIGZvciAocm93ID0gMDsgcm93IDwgdGhpc0Jsb2NrSGVpZ2h0OyByb3crKykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbCA9IDA7IGNvbCA8IHRoaXNCbG9ja1dpZHRoOyBjb2wrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFBpeGVsc1tvdXRQdHIrK10gPSBvZmZzZXQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgZWxzZSB7IC8vYml0c3R1ZmYgZW5jb2RpbmcgaXMgMwogICAgICAgICAgICAgICAgICAgIGRhdGEucHRyICs9IGJsb2NrUHRyOwogICAgICAgICAgICAgICAgICAgIC8vaGVhdnkgbGlmdGluZwogICAgICAgICAgICAgICAgICAgIExlcmMySGVscGVycy5kZWNvZGVCaXRzKGlucHV0LCBkYXRhLCBibG9ja0RhdGFCdWZmZXIsIG9mZnNldCwgaURpbSk7CiAgICAgICAgICAgICAgICAgICAgYmxvY2tQdHIgPSAwOwogICAgICAgICAgICAgICAgICAgIGlmIChtYXNrKSB7CiAgICAgICAgICAgICAgICAgICAgICBmb3IgKHJvdyA9IDA7IHJvdyA8IHRoaXNCbG9ja0hlaWdodDsgcm93KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb2wgPSAwOyBjb2wgPCB0aGlzQmxvY2tXaWR0aDsgY29sKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFza1tvdXRQdHJdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNbb3V0UHRyXSA9IGJsb2NrRGF0YUJ1ZmZlcltibG9ja1B0cisrXTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0UHRyKys7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgb3V0UHRyICs9IG91dFN0cmlkZTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBmb3IgKHJvdyA9IDA7IHJvdyA8IHRoaXNCbG9ja0hlaWdodDsgcm93KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb2wgPSAwOyBjb2wgPCB0aGlzQmxvY2tXaWR0aDsgY29sKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRQaXhlbHNbb3V0UHRyKytdID0gYmxvY2tEYXRhQnVmZmVyW2Jsb2NrUHRyKytdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG91dFB0ciArPSBvdXRTdHJpZGU7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqCiAgICAgICAgKiAgcHJpdmF0ZSBtZXRob2RzIChoZWxwZXIgbWV0aG9kcykKICAgICAgICAqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgZm9ybWF0RmlsZUluZm86IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJmaWxlSWRlbnRpZmllclN0cmluZyI6IGRhdGEuaGVhZGVySW5mby5maWxlSWRlbnRpZmllclN0cmluZywKICAgICAgICAgICAgImZpbGVWZXJzaW9uIjogZGF0YS5oZWFkZXJJbmZvLmZpbGVWZXJzaW9uLAogICAgICAgICAgICAiaW1hZ2VUeXBlIjogZGF0YS5oZWFkZXJJbmZvLmltYWdlVHlwZSwKICAgICAgICAgICAgImhlaWdodCI6IGRhdGEuaGVhZGVySW5mby5oZWlnaHQsCiAgICAgICAgICAgICJ3aWR0aCI6IGRhdGEuaGVhZGVySW5mby53aWR0aCwKICAgICAgICAgICAgIm51bVZhbGlkUGl4ZWwiOiBkYXRhLmhlYWRlckluZm8ubnVtVmFsaWRQaXhlbCwKICAgICAgICAgICAgIm1pY3JvQmxvY2tTaXplIjogZGF0YS5oZWFkZXJJbmZvLm1pY3JvQmxvY2tTaXplLAogICAgICAgICAgICAiYmxvYlNpemUiOiBkYXRhLmhlYWRlckluZm8uYmxvYlNpemUsCiAgICAgICAgICAgICJtYXhaRXJyb3IiOiBkYXRhLmhlYWRlckluZm8ubWF4WkVycm9yLAogICAgICAgICAgICAicGl4ZWxUeXBlIjogTGVyYzJIZWxwZXJzLmdldFBpeGVsVHlwZShkYXRhLmhlYWRlckluZm8uaW1hZ2VUeXBlKSwKICAgICAgICAgICAgImVvZk9mZnNldCI6IGRhdGEuZW9mT2Zmc2V0LAogICAgICAgICAgICAibWFzayI6IGRhdGEubWFzayA/IHsKICAgICAgICAgICAgICAibnVtQnl0ZXMiOiBkYXRhLm1hc2subnVtQnl0ZXMKICAgICAgICAgICAgfSA6IG51bGwsCiAgICAgICAgICAgICJwaXhlbHMiOiB7CiAgICAgICAgICAgICAgIm51bUJsb2Nrc1giOiBkYXRhLnBpeGVscy5udW1CbG9ja3NYLAogICAgICAgICAgICAgICJudW1CbG9ja3NZIjogZGF0YS5waXhlbHMubnVtQmxvY2tzWSwKICAgICAgICAgICAgICAvLyJudW1CeXRlcyI6IGRhdGEucGl4ZWxzLm51bUJ5dGVzLAogICAgICAgICAgICAgICJtYXhWYWx1ZSI6IGRhdGEuaGVhZGVySW5mby56TWF4LAogICAgICAgICAgICAgICJtaW5WYWx1ZSI6IGRhdGEuaGVhZGVySW5mby56TWluLAogICAgICAgICAgICAgICJub0RhdGFWYWx1ZSI6IGRhdGEubm9EYXRhVmFsdWUKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9LAoKICAgICAgICBjb25zdHJ1Y3RDb25zdGFudFN1cmZhY2U6IGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgIHZhciB2YWwgPSBkYXRhLmhlYWRlckluZm8uek1heDsKICAgICAgICAgIHZhciBudW1EaW1zID0gIGRhdGEuaGVhZGVySW5mby5udW1EaW1zOwogICAgICAgICAgdmFyIG51bVBpeGVscyA9IGRhdGEuaGVhZGVySW5mby5oZWlnaHQgKiBkYXRhLmhlYWRlckluZm8ud2lkdGg7CiAgICAgICAgICB2YXIgbnVtUGl4ZWxBbGxEaW1zID0gbnVtUGl4ZWxzICogbnVtRGltczsKICAgICAgICAgIHZhciBpPTAsIGsgPSAwLCBuU3RhcnQ9MDsKICAgICAgICAgIHZhciBtYXNrID0gZGF0YS5waXhlbHMucmVzdWx0TWFzazsKICAgICAgICAgIGlmIChtYXNrKSB7CiAgICAgICAgICAgIGlmIChudW1EaW1zID4gMSkgewogICAgICAgICAgICAgIGZvciAoaT0wOyBpIDwgbnVtRGltczsgaSsrKSB7CiAgICAgICAgICAgICAgICBuU3RhcnQgPSBpICogbnVtUGl4ZWxzOwogICAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG51bVBpeGVsczsgaysrKSB7CiAgICAgICAgICAgICAgICAgIGlmIChtYXNrW2tdKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzW25TdGFydCArIGtdID0gdmFsOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBudW1QaXhlbHM7IGsrKykgewogICAgICAgICAgICAgICAgaWYgKG1hc2tba10pIHsKICAgICAgICAgICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzW2tdID0gdmFsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmIChkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHMuZmlsbCkgewogICAgICAgICAgICAgIGRhdGEucGl4ZWxzLnJlc3VsdFBpeGVscy5maWxsKHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IG51bVBpeGVsQWxsRGltczsgaysrKSB7CiAgICAgICAgICAgICAgICBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHNba10gPSB2YWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSwKCiAgICAgICAgZ2V0RGF0YVR5cGVBcnJheTogZnVuY3Rpb24odCkgewogICAgICAgICAgdmFyIHRwOwogICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgIGNhc2UgMDogLy9jaGFyCiAgICAgICAgICAgICAgdHAgPSBJbnQ4QXJyYXk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlCiAgICAgICAgICAgICAgdHAgPSBVaW50OEFycmF5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6IC8vc2hvcnQKICAgICAgICAgICAgICB0cCA9IEludDE2QXJyYXk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzogLy91c2hvcnQKICAgICAgICAgICAgICB0cCA9IFVpbnQxNkFycmF5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgdHAgPSBJbnQzMkFycmF5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgdHAgPSBVaW50MzJBcnJheTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIHRwID0gRmxvYXQzMkFycmF5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgdHAgPSBGbG9hdDY0QXJyYXk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdHAgPSBGbG9hdDMyQXJyYXk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdHA7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0UGl4ZWxUeXBlOiBmdW5jdGlvbih0KSB7CiAgICAgICAgICB2YXIgdHA7CiAgICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgICAgY2FzZSAwOiAvL2NoYXIKICAgICAgICAgICAgICB0cCA9ICJTOCI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlCiAgICAgICAgICAgICAgdHAgPSAiVTgiOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6IC8vc2hvcnQKICAgICAgICAgICAgICB0cCA9ICJTMTYiOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6IC8vdXNob3J0CiAgICAgICAgICAgICAgdHAgPSAiVTE2IjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIHRwID0gIlMzMiI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICB0cCA9ICJVMzIiOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgdHAgPSAiRjMyIjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIHRwID0gIkY2NCI7IC8vbm90IHN1cHBvcnRlZAogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRwID0gIkYzMiI7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdHA7CiAgICAgICAgfSwKCiAgICAgICAgaXNWYWxpZFBpeGVsVmFsdWU6IGZ1bmN0aW9uKHQsIHZhbCkgewogICAgICAgICAgaWYgKHZhbCA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBpc1ZhbGlkOwogICAgICAgICAgc3dpdGNoICh0KSB7CiAgICAgICAgICAgIGNhc2UgMDogLy9jaGFyCiAgICAgICAgICAgICAgaXNWYWxpZCA9IHZhbCA+PSAtMTI4ICYmIHZhbCA8PSAxMjc7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlICAodW5zaWduZWQgY2hhcikKICAgICAgICAgICAgICBpc1ZhbGlkID0gdmFsID49IDAgJiYgdmFsIDw9IDI1NTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOiAvL3Nob3J0CiAgICAgICAgICAgICAgaXNWYWxpZCA9IHZhbCA+PSAtMzI3NjggJiYgdmFsIDw9IDMyNzY3OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6IC8vdXNob3J0CiAgICAgICAgICAgICAgaXNWYWxpZCA9IHZhbCA+PSAwICYmIHZhbCA8PSA2NTUzNjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OiAvL2ludCAzMgogICAgICAgICAgICAgIGlzVmFsaWQgPSB2YWwgPj0gLTIxNDc0ODM2NDggJiYgdmFsIDw9IDIxNDc0ODM2NDc7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNTogLy91aW5pdCAzMgogICAgICAgICAgICAgIGlzVmFsaWQgPSB2YWwgPj0gMCAmJiB2YWwgPD0gNDI5NDk2NzI5NjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGlzVmFsaWQgPSB2YWwgPj0gLTMuNDAyNzk5OTM4NzkwMTQ4NGUrMzggJiYgdmFsIDw9IDMuNDAyNzk5OTM4NzkwMTQ4NGUrMzg7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBpc1ZhbGlkID0gdmFsID49IDVlLTMyNCAmJiB2YWwgPD0gMS43OTc2OTMxMzQ4NjIzMTU3ZSszMDg7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgaXNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGlzVmFsaWQ7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0RGF0YVR5cGVTaXplOiBmdW5jdGlvbih0KSB7CiAgICAgICAgICB2YXIgcyA9IDA7CiAgICAgICAgICBzd2l0Y2ggKHQpIHsKICAgICAgICAgICAgY2FzZSAwOiAvL3VieXRlCiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlCiAgICAgICAgICAgICAgcyA9IDE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMjogLy9zaG9ydAogICAgICAgICAgICBjYXNlIDM6IC8vdXNob3J0CiAgICAgICAgICAgICAgcyA9IDI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgcyA9IDQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBzID0gODsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBzID0gdDsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBzOwogICAgICAgIH0sCgogICAgICAgIGdldERhdGFUeXBlVXNlZDogZnVuY3Rpb24oZHQsIHRjKSB7CiAgICAgICAgICB2YXIgdCA9IGR0OwogICAgICAgICAgc3dpdGNoIChkdCkgewogICAgICAgICAgICBjYXNlIDI6IC8vc2hvcnQKICAgICAgICAgICAgY2FzZSA0OiAvL2xvbmcKICAgICAgICAgICAgICB0ID0gZHQgLSB0YzsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOiAvL3VzaG9ydAogICAgICAgICAgICBjYXNlIDU6IC8vdWxvbmcKICAgICAgICAgICAgICB0ID0gZHQgLSAyICogdGM7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNjogLy9mbG9hdAogICAgICAgICAgICAgIGlmICgwID09PSB0YykgewogICAgICAgICAgICAgICAgdCA9IGR0OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIGlmICgxID09PSB0YykgewogICAgICAgICAgICAgICAgdCA9IDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdCA9IDE7Ly9ieXRlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDc6IC8vZG91YmxlCiAgICAgICAgICAgICAgaWYgKDAgPT09IHRjKSB7CiAgICAgICAgICAgICAgICB0ID0gZHQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdCA9IGR0IC0gMiAqIHRjICsgMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgdCA9IGR0OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0T25lUGl4ZWw6IGZ1bmN0aW9uKGJsb2NrLCBibG9ja1B0ciwgb2Zmc2V0VHlwZSwgdmlldykgewogICAgICAgICAgdmFyIHRlbXAgPSAwOwogICAgICAgICAgc3dpdGNoIChvZmZzZXRUeXBlKSB7CiAgICAgICAgICAgIGNhc2UgMDogLy9jaGFyCiAgICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0SW50OChibG9ja1B0cik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMTogLy9ieXRlCiAgICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0VWludDgoYmxvY2tQdHIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0SW50MTYoYmxvY2tQdHIsIHRydWUpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgdGVtcCA9IHZpZXcuZ2V0VWludDE2KGJsb2NrUHRyLCB0cnVlKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIHRlbXAgPSB2aWV3LmdldEludDMyKGJsb2NrUHRyLCB0cnVlKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIHRlbXAgPSB2aWV3LmdldFVJbnQzMihibG9ja1B0ciwgdHJ1ZSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICB0ZW1wID0gdmlldy5nZXRGbG9hdDMyKGJsb2NrUHRyLCB0cnVlKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIC8vdGVtcCA9IHZpZXcuZ2V0RmxvYXQ2NChibG9ja1B0ciwgdHJ1ZSk7CiAgICAgICAgICAgICAgLy9ibG9ja1B0ciArPSA4OwogICAgICAgICAgICAgIC8vbGVyYzIgZW5jb2RpbmcgZG9lc250IGhhbmRsZSBmbG9hdCA2NCwgZm9yY2UgdG8gZmxvYXQzMj8/PwogICAgICAgICAgICAgIHRlbXAgPSB2aWV3LmdldEZsb2F0NjQoYmxvY2tQdHIsIHRydWUpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93ICgidGhlIGRlY29kZXIgZG9lcyBub3QgdW5kZXJzdGFuZCB0aGlzIHBpeGVsIHR5cGUiKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0ZW1wOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAgICAgKnByaXZhdGUgY2xhc3MgZm9yIGEgdHJlZSBub2RlLiBIdWZmbWFuIGNvZGUgaXMgaW4gTGVyYzJIZWxwZXJzCiAgICAgICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgIHZhciBUcmVlTm9kZSA9IGZ1bmN0aW9uKHZhbCwgbGVmdCwgcmlnaHQpIHsKICAgICAgICB0aGlzLnZhbCA9IHZhbDsKICAgICAgICB0aGlzLmxlZnQgPSBsZWZ0OwogICAgICAgIHRoaXMucmlnaHQgPSByaWdodDsKICAgICAgfTsKCiAgICAgIHZhciBMZXJjMkRlY29kZSA9IHsKICAgICAgICAvKgogICAgICAgICogKioqKioqKipyZW1vdmVkIG9wdGlvbnMgY29tcGFyZWQgdG8gTEVSQzEuIFdlIGNhbiBicmluZyBzb21lIG9mIHRoZW0gYmFjayBpZiBuZWVkZWQuCiAgICAgICAgICogcmVtb3ZlZCBwaXhlbCB0eXBlLiBMRVJDMiBpcyB0eXBlZCBhbmQgZG9lc24ndCByZXF1aXJlIHVzZXIgdG8gZ2l2ZSBwaXhlbCB0eXBlCiAgICAgICAgICogY2hhbmdlZCBlbmNvZGVkTWFza0RhdGEgdG8gbWFza0RhdGEuIExFUkMyICdzIGpzIHZlcnNpb24gbWFrZSBpdCBmYXN0ZXIgdG8gdXNlIG1hc2tEYXRhIGRpcmVjdGx5LgogICAgICAgICAqIHJlbW92ZWQgcmV0dXJuTWFzay4gbWFzayBpcyB1c2VkIGJ5IExFUkMyIGludGVybmFsbHkgYW5kIGlzIGNvc3QgZnJlZS4gSW4gY2FzZSBvZiB1c2VyIGlucHV0IG1hc2ssIGl0J3MgcmV0dXJuZWQgYXMgd2VsbCBhbmQgaGFzIG5lZ2xpYmxlIGNvc3QuCiAgICAgICAgICogcmVtb3ZlZCBub2RhdGF2YWx1ZS4gQmVjYXVzZSBMRVJDMiBwaXhlbHMgYXJlIHR5cGVkLCBub2RhdGF2YWx1ZSB3aWxsIHNhY3JpZnkgYSB1c2VmdWwgdmFsdWUgZm9yIG1hbnkgdHlwZXMgKDhiaXQsIDE2Yml0KSBldGMsCiAgICAgICAgICogICAgICAgdXNlciBoYXMgdG8gYmUga25vd2xlZGdhYmxlIGVub3VnaCBhYm91dCByYXN0ZXIgYW5kIHRoZWlyIGRhdGEgdG8gYXZvaWQgdXNhYmlsaXR5IGlzc3Vlcy4gc28gbm9kYXRhIHZhbHVlIGlzIHNpbXBseSByZW1vdmVkIG5vdy4KICAgICAgICAgKiAgICAgICBXZSBjYW4gYWRkIGl0IGJhY2sgbGF0ZXIgaWYgdGhlaXIncyBhIGNsZWFyIHJlcXVpcmVtZW50LgogICAgICAgICAqIHJlbW92ZWQgZW5jb2RlZE1hc2suIFRoaXMgb3B0aW9uIHdhcyBub3QgaW1wbGVtZW50ZWQgaW4gTGVyY0RlY29kZS4gSXQgY2FuIGJlIGRvbmUgYWZ0ZXIgZGVjb2RpbmcgKGxlc3MgZWZmaWNpZW50KQogICAgICAgICAqIHJlbW92ZWQgY29tcHV0ZVVzZWRCaXREZXB0aHMuCiAgICAgICAgICoKICAgICAgICAgKgogICAgICAgICAqIHJlc3BvbnNlIGNoYW5nZXMgY29tcGFyZWQgdG8gTEVSQzEKICAgICAgICAgKiAxLiBlbmNvZGVkTWFza0RhdGEgaXMgbm90IGF2YWlsYWJsZQogICAgICAgICAqIDIuIG5vRGF0YVZhbHVlIGlzIG9wdGlvbmFsIChyZXR1cm5zIG9ubHkgaWYgdXNlcidzIG5vRGF0YVZhbHVlIGlzIHdpdGggaW4gdGhlIHZhbGlkIGRhdGEgdHlwZSByYW5nZSkKICAgICAgICAgKiAzLiBtYXNrRGF0YSBpcyBhbHdheXMgYXZhaWxhYmxlCiAgICAgICAgKi8KICAgICAgICAvKioqKioqKioqKioqKioqKioKICAgICAgICAqICBwdWJsaWMgcHJvcGVydGllcwogICAgICAgICoqKioqKioqKioqKioqKioqKi8KICAgICAgICAvL0hVRkZNQU5fTFVUX0JJVFNfTUFYOiAxMiwgLy91c2UgMl4xMiBsdXQsIG5vdCBjb25maWd1cmFibGUKCiAgICAgICAgLyoqKioqKioqKioqKioqKioqCiAgICAgICAgKiAgcHVibGljIG1ldGhvZHMKICAgICAgICAqKioqKioqKioqKioqKioqKi8KCiAgICAgICAgLyoqCiAgICAgICAgICogRGVjb2RlIGEgTEVSQzIgYnl0ZSBzdHJlYW0gYW5kIHJldHVybiBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgcGl4ZWwgZGF0YSBhbmQgb3B0aW9uYWwgbWV0YWRhdGEuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0ge0FycmF5QnVmZmVyfSBpbnB1dCBUaGUgTEVSQyBpbnB1dCBieXRlIHN0cmVhbQogICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gb3B0aW9ucyBEZWNvZGluZyBvcHRpb25zCiAgICAgICAgICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLmlucHV0T2Zmc2V0XSBUaGUgbnVtYmVyIG9mIGJ5dGVzIHRvIHNraXAgaW4gdGhlIGlucHV0IGJ5dGUgc3RyZWFtLiBBIHZhbGlkIExFUkMgZmlsZSBpcyBleHBlY3RlZCBhdCB0aGF0IHBvc2l0aW9uCiAgICAgICAgICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5yZXR1cm5GaWxlSW5mb10gSWYgdHJ1ZSwgdGhlIHJldHVybiB2YWx1ZSB3aWxsIGhhdmUgYSBmaWxlSW5mbyBwcm9wZXJ0eSB0aGF0IGNvbnRhaW5zIG1ldGFkYXRhIG9idGFpbmVkIGZyb20gdGhlIExFUkMgaGVhZGVycyBhbmQgdGhlIGRlY29kaW5nIHByb2Nlc3MKICAgICAgICAgKi8KICAgICAgICBkZWNvZGU6IGZ1bmN0aW9uKC8qYnl0ZSBhcnJheSovIGlucHV0LCAvKm9iamVjdCovIG9wdGlvbnMpIHsKICAgICAgICAgIC8vY3VycmVudGx5IHRoZXJlJ3MgYSBidWcgaW4gdGhlIHNwYXJzZSBhcnJheSwgc28gcGxlYXNlIGRvIG5vdCBzZXQgdG8gZmFsc2UKICAgICAgICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogICAgICAgICAgdmFyIG5vRGF0YVZhbHVlID0gb3B0aW9ucy5ub0RhdGFWYWx1ZTsKCiAgICAgICAgICAvL2luaXRpYWxpemUKICAgICAgICAgIHZhciBpID0gMCwgZGF0YSA9IHt9OwogICAgICAgICAgZGF0YS5wdHIgPSBvcHRpb25zLmlucHV0T2Zmc2V0IHx8IDA7CiAgICAgICAgICBkYXRhLnBpeGVscyA9IHt9OwoKICAgICAgICAgIC8vIEZpbGUgaGVhZGVyCiAgICAgICAgICBpZiAoIUxlcmMySGVscGVycy5yZWFkSGVhZGVySW5mbyhpbnB1dCwgZGF0YSkpIDsKICAgICAgICAgIHZhciBoZWFkZXJJbmZvID0gZGF0YS5oZWFkZXJJbmZvOwogICAgICAgICAgdmFyIGZpbGVWZXJzaW9uID0gaGVhZGVySW5mby5maWxlVmVyc2lvbjsKICAgICAgICAgIHZhciBPdXRQaXhlbFR5cGVBcnJheSA9IExlcmMySGVscGVycy5nZXREYXRhVHlwZUFycmF5KGhlYWRlckluZm8uaW1hZ2VUeXBlKTsKCiAgICAgICAgICAvLyBNYXNrIEhlYWRlcgogICAgICAgICAgTGVyYzJIZWxwZXJzLnJlYWRNYXNrKGlucHV0LCBkYXRhKTsKICAgICAgICAgIGlmIChoZWFkZXJJbmZvLm51bVZhbGlkUGl4ZWwgIT09IGhlYWRlckluZm8ud2lkdGggKiBoZWFkZXJJbmZvLmhlaWdodCAmJiAhZGF0YS5waXhlbHMucmVzdWx0TWFzaykgewogICAgICAgICAgICBkYXRhLnBpeGVscy5yZXN1bHRNYXNrID0gb3B0aW9ucy5tYXNrRGF0YTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgbnVtUGl4ZWxzID0gaGVhZGVySW5mby53aWR0aCAqIGhlYWRlckluZm8uaGVpZ2h0OwogICAgICAgICAgZGF0YS5waXhlbHMucmVzdWx0UGl4ZWxzID0gbmV3IE91dFBpeGVsVHlwZUFycmF5KG51bVBpeGVscyAqIGhlYWRlckluZm8ubnVtRGltcyk7CgogICAgICAgICAgZGF0YS5jb3VudGVyID0gewogICAgICAgICAgICBvbmVzd2VlcDogMCwKICAgICAgICAgICAgdW5jb21wcmVzc2VkOiAwLAogICAgICAgICAgICBsdXQ6IDAsCiAgICAgICAgICAgIGJpdHN0dWZmZXI6IDAsCiAgICAgICAgICAgIGNvbnN0YW50OiAwLAogICAgICAgICAgICBjb25zdGFudG9mZnNldDogMAogICAgICAgICAgfTsKICAgICAgICAgIGlmIChoZWFkZXJJbmZvLm51bVZhbGlkUGl4ZWwgIT09IDApIHsKICAgICAgICAgICAgLy9ub3QgdGVzdGVkCiAgICAgICAgICAgIGlmIChoZWFkZXJJbmZvLnpNYXggPT09IGhlYWRlckluZm8uek1pbikgLy9jb25zdGFudCBzdXJmYWNlCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBMZXJjMkhlbHBlcnMuY29uc3RydWN0Q29uc3RhbnRTdXJmYWNlKGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKGZpbGVWZXJzaW9uID49IDQgJiYgTGVyYzJIZWxwZXJzLmNoZWNrTWluTWF4UmFuZ2VzKGlucHV0LCBkYXRhKSkgewogICAgICAgICAgICAgIExlcmMySGVscGVycy5jb25zdHJ1Y3RDb25zdGFudFN1cmZhY2UoZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgdmFyIHZpZXcgPSBuZXcgRGF0YVZpZXcoaW5wdXQsIGRhdGEucHRyLCAyKTsKICAgICAgICAgICAgICB2YXIgYlJlYWREYXRhT25lU3dlZXAgPSB2aWV3LmdldFVpbnQ4KDApOwogICAgICAgICAgICAgIGRhdGEucHRyKys7CiAgICAgICAgICAgICAgaWYgKGJSZWFkRGF0YU9uZVN3ZWVwKSB7CiAgICAgICAgICAgICAgICAvL2NvbnNvbGUuZGVidWcoIk9uZVN3ZWVwIik7CiAgICAgICAgICAgICAgICBMZXJjMkhlbHBlcnMucmVhZERhdGFPbmVTd2VlcChpbnB1dCwgZGF0YSwgT3V0UGl4ZWxUeXBlQXJyYXkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIC8vbGVyYzIuMTogLy9iaXRzdHVmZmluZyArIGx1dAogICAgICAgICAgICAgICAgLy9sZXJjMi4yOiAvL2JpdHN0dWZmaW5nICsgbHV0ICsgaHVmZm1hbgogICAgICAgICAgICAgICAgLy9sZXJjMi4zOiBuZXcgYml0c3R1ZmZlcgogICAgICAgICAgICAgICAgaWYgKGZpbGVWZXJzaW9uID4gMSAmJiBoZWFkZXJJbmZvLmltYWdlVHlwZSA8PSAxICYmIE1hdGguYWJzKGhlYWRlckluZm8ubWF4WkVycm9yIC0gMC41KSA8IDAuMDAwMDEpIHsKICAgICAgICAgICAgICAgICAgLy90aGlzIGlzIDIueCBwbHVzIDggYml0ICh1bnNpZ25lZCBhbmQgc2lnbmVkKSBkYXRhLCBwb3NzaWJsaXR5IG9mIEh1ZmZtYW4KICAgICAgICAgICAgICAgICAgdmFyIGZsYWdIdWZmbWFuID0gdmlldy5nZXRVaW50OCgxKTsKICAgICAgICAgICAgICAgICAgZGF0YS5wdHIrKzsKICAgICAgICAgICAgICAgICAgZGF0YS5lbmNvZGVNb2RlID0gZmxhZ0h1ZmZtYW47CiAgICAgICAgICAgICAgICAgIGlmIChmbGFnSHVmZm1hbiA+IDIgfHwgKGZpbGVWZXJzaW9uIDwgNCAmJiBmbGFnSHVmZm1hbiA+IDEpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgIkludmFsaWQgSHVmZm1hbiBmbGFnICIgKyBmbGFnSHVmZm1hbjsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoZmxhZ0h1ZmZtYW4pIHsvLzEgLSBkZWx0YSBIdWZmbWFuLCAyIC0gSHVmZm1hbgogICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIkh1ZmZtYW4iKTsKICAgICAgICAgICAgICAgICAgICBMZXJjMkhlbHBlcnMucmVhZEh1ZmZtYW4oaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJUaWxlcyIpOwogICAgICAgICAgICAgICAgICAgIExlcmMySGVscGVycy5yZWFkVGlsZXMoaW5wdXQsIGRhdGEsIE91dFBpeGVsVHlwZUFycmF5KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7IC8vbGVyYzIueCBub24tOCBiaXQgZGF0YQogICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJUaWxlcyIpOwogICAgICAgICAgICAgICAgICBMZXJjMkhlbHBlcnMucmVhZFRpbGVzKGlucHV0LCBkYXRhLCBPdXRQaXhlbFR5cGVBcnJheSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZGF0YS5lb2ZPZmZzZXQgPSBkYXRhLnB0cjsKICAgICAgICAgIHZhciBkaWZmOwogICAgICAgICAgaWYgKG9wdGlvbnMuaW5wdXRPZmZzZXQpIHsKICAgICAgICAgICAgZGlmZiA9IGRhdGEuaGVhZGVySW5mby5ibG9iU2l6ZSArIG9wdGlvbnMuaW5wdXRPZmZzZXQgLSBkYXRhLnB0cjsKICAgICAgICAgICAgaWYgKE1hdGguYWJzKGRpZmYpID49IDEpIHsKICAgICAgICAgICAgICAvL2NvbnNvbGUuZGVidWcoImluY29ycmVjdCBlb2Y6IGRhdGFwdHIgIiArIGRhdGEucHRyICsgIiBvZmZzZXQgIiArIG9wdGlvbnMuaW5wdXRPZmZzZXQgKyAiIGJsb2JzaXplICIgKyBkYXRhLmhlYWRlckluZm8uYmxvYlNpemUgKyAiIGRpZmY6ICIgKyBkaWZmKTsKICAgICAgICAgICAgICBkYXRhLmVvZk9mZnNldCA9IG9wdGlvbnMuaW5wdXRPZmZzZXQgKyBkYXRhLmhlYWRlckluZm8uYmxvYlNpemU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICBkaWZmID0gZGF0YS5oZWFkZXJJbmZvLmJsb2JTaXplIC0gZGF0YS5wdHI7CiAgICAgICAgICAgIGlmIChNYXRoLmFicyhkaWZmKSA+PSAxKSB7CiAgICAgICAgICAgICAgLy9jb25zb2xlLmRlYnVnKCJpbmNvcnJlY3QgZmlyc3QgYmFuZCBlb2Y6IGRhdGFwdHIgIiArIGRhdGEucHRyICsgIiBibG9ic2l6ZSAiICsgZGF0YS5oZWFkZXJJbmZvLmJsb2JTaXplICsgIiBkaWZmOiAiICsgZGlmZik7CiAgICAgICAgICAgICAgZGF0YS5lb2ZPZmZzZXQgPSBkYXRhLmhlYWRlckluZm8uYmxvYlNpemU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVzdWx0ID0gewogICAgICAgICAgICB3aWR0aDogaGVhZGVySW5mby53aWR0aCwKICAgICAgICAgICAgaGVpZ2h0OiBoZWFkZXJJbmZvLmhlaWdodCwKICAgICAgICAgICAgcGl4ZWxEYXRhOiBkYXRhLnBpeGVscy5yZXN1bHRQaXhlbHMsCiAgICAgICAgICAgIG1pblZhbHVlOiBoZWFkZXJJbmZvLnpNaW4sCiAgICAgICAgICAgIG1heFZhbHVlOiBoZWFkZXJJbmZvLnpNYXgsCiAgICAgICAgICAgIHZhbGlkUGl4ZWxDb3VudDogaGVhZGVySW5mby5udW1WYWxpZFBpeGVsLAogICAgICAgICAgICBkaW1Db3VudDogaGVhZGVySW5mby5udW1EaW1zLAogICAgICAgICAgICBkaW1TdGF0czogewogICAgICAgICAgICAgIG1pblZhbHVlczogaGVhZGVySW5mby5taW5WYWx1ZXMsCiAgICAgICAgICAgICAgbWF4VmFsdWVzOiBoZWFkZXJJbmZvLm1heFZhbHVlcwogICAgICAgICAgICB9LAogICAgICAgICAgICBtYXNrRGF0YTogZGF0YS5waXhlbHMucmVzdWx0TWFzawogICAgICAgICAgICAvL25vRGF0YVZhbHVlOiBub0RhdGFWYWx1ZQogICAgICAgICAgfTsKCiAgICAgICAgICAvL3dlIHNob3VsZCByZW1vdmUgdGhpcyBpZiB0aGVyZSdzIG5vIGV4aXN0aW5nIGNsaWVudAogICAgICAgICAgLy9vcHRpb25hbCBub0RhdGFWYWx1ZSBwcm9jZXNzaW5nLCBpdCdzIHVzZXIncyByZXNwb25zaWJsaXR5CiAgICAgICAgICBpZiAoZGF0YS5waXhlbHMucmVzdWx0TWFzayAmJiBMZXJjMkhlbHBlcnMuaXNWYWxpZFBpeGVsVmFsdWUoaGVhZGVySW5mby5pbWFnZVR5cGUsIG5vRGF0YVZhbHVlKSkgewogICAgICAgICAgICB2YXIgbWFzayA9IGRhdGEucGl4ZWxzLnJlc3VsdE1hc2s7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1QaXhlbHM7IGkrKykgewogICAgICAgICAgICAgIGlmICghbWFza1tpXSkgewogICAgICAgICAgICAgICAgcmVzdWx0LnBpeGVsRGF0YVtpXSA9IG5vRGF0YVZhbHVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXN1bHQubm9EYXRhVmFsdWUgPSBub0RhdGFWYWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGRhdGEubm9EYXRhVmFsdWUgPSBub0RhdGFWYWx1ZTsKICAgICAgICAgIGlmIChvcHRpb25zLnJldHVybkZpbGVJbmZvKSB7CiAgICAgICAgICAgIHJlc3VsdC5maWxlSW5mbyA9IExlcmMySGVscGVycy5mb3JtYXRGaWxlSW5mbyhkYXRhKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0QmFuZENvdW50OiBmdW5jdGlvbigvKmJ5dGUgYXJyYXkqLyBpbnB1dCkgewogICAgICAgICAgdmFyIGNvdW50ID0gMDsKICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgIHZhciB0ZW1wID0ge307CiAgICAgICAgICB0ZW1wLnB0ciA9IDA7CiAgICAgICAgICB0ZW1wLnBpeGVscyA9IHt9OwogICAgICAgICAgd2hpbGUgKGkgPCBpbnB1dC5ieXRlTGVuZ3RoIC0gNTgpIHsKICAgICAgICAgICAgTGVyYzJIZWxwZXJzLnJlYWRIZWFkZXJJbmZvKGlucHV0LCB0ZW1wKTsKICAgICAgICAgICAgaSArPSB0ZW1wLmhlYWRlckluZm8uYmxvYlNpemU7CiAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgIHRlbXAucHRyID0gaTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBjb3VudDsKICAgICAgICB9CiAgICAgIH07CgogICAgICByZXR1cm4gTGVyYzJEZWNvZGU7CiAgICB9KSgpOwoKICAgIHZhciBpc1BsYXRmb3JtTGl0dGxlRW5kaWFuID0gKGZ1bmN0aW9uKCkgewogICAgICB2YXIgYSA9IG5ldyBBcnJheUJ1ZmZlcig0KTsKICAgICAgdmFyIGIgPSBuZXcgVWludDhBcnJheShhKTsKICAgICAgdmFyIGMgPSBuZXcgVWludDMyQXJyYXkoYSk7CiAgICAgIGNbMF0gPSAxOwogICAgICByZXR1cm4gYlswXSA9PT0gMTsKICAgIH0pKCk7CgogICAgdmFyIExlcmMgPSB7CiAgICAgIC8qKioqKioqKioqKip3cmFwcGVyKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgLyoqCiAgICAgICAqIEEgd3JhcHBlciBmb3IgZGVjb2RpbmcgYm90aCBMRVJDMSBhbmQgTEVSQzIgYnl0ZSBzdHJlYW1zIGNhcGFibGUgb2YgaGFuZGxpbmcgbXVsdGliYW5kIHBpeGVsIGJsb2NrcyBmb3IgdmFyaW91cyBwaXhlbCB0eXBlcy4KICAgICAgICoKICAgICAgICogQGFsaWFzIG1vZHVsZTpMZXJjCiAgICAgICAqIEBwYXJhbSB7QXJyYXlCdWZmZXJ9IGlucHV0IFRoZSBMRVJDIGlucHV0IGJ5dGUgc3RyZWFtCiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gVGhlIGRlY29kaW5nIG9wdGlvbnMgYmVsb3cgYXJlIG9wdGlvbmFsLgogICAgICAgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMuaW5wdXRPZmZzZXRdIFRoZSBudW1iZXIgb2YgYnl0ZXMgdG8gc2tpcCBpbiB0aGUgaW5wdXQgYnl0ZSBzdHJlYW0uIEEgdmFsaWQgTGVyYyBmaWxlIGlzIGV4cGVjdGVkIGF0IHRoYXQgcG9zaXRpb24uCiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5waXhlbFR5cGVdIChMRVJDMSBvbmx5KSBEZWZhdWx0IHZhbHVlIGlzIEYzMi4gVmFsaWQgcGl4ZWwgdHlwZXMgZm9yIGlucHV0IGFyZSBVOC9TOC9TMTYvVTE2L1MzMi9VMzIvRjMyLgogICAgICAgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMubm9EYXRhVmFsdWVdIChMRVJDMSBvbmx5KS4gSXQgaXMgcmVjb21tZW5kZWQgdG8gdXNlIHRoZSByZXR1cm5lZCBtYXNrIGluc3RlYWQgb2Ygc2V0dGluZyB0aGlzIHZhbHVlLgogICAgICAgKiBAcmV0dXJucyB7e3dpZHRoLCBoZWlnaHQsIHBpeGVscywgcGl4ZWxUeXBlLCBtYXNrLCBzdGF0aXN0aWNzfX0KICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gd2lkdGggV2lkdGggb2YgZGVjb2RlZCBpbWFnZS4KICAgICAgICAgKiBAcHJvcGVydHkge251bWJlcn0gaGVpZ2h0IEhlaWdodCBvZiBkZWNvZGVkIGltYWdlLgogICAgICAgICAqIEBwcm9wZXJ0eSB7YXJyYXl9IHBpeGVscyBbYmFuZDEsIGJhbmQyLCDigKZdIEVhY2ggYmFuZCBpcyBhIHR5cGVkIGFycmF5IG9mIHdpZHRoKmhlaWdodC4KICAgICAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gcGl4ZWxUeXBlIFRoZSB0eXBlIG9mIHBpeGVscyByZXByZXNlbnRlZCBpbiB0aGUgb3V0cHV0LgogICAgICAgICAqIEBwcm9wZXJ0eSB7bWFza30gbWFzayBUeXBlZCBhcnJheSB3aXRoIGEgc2l6ZSBvZiB3aWR0aCpoZWlnaHQsIG9yIG51bGwgaWYgYWxsIHBpeGVscyBhcmUgdmFsaWQuCiAgICAgICAgICogQHByb3BlcnR5IHthcnJheX0gc3RhdGlzdGljcyBbc3RhdGlzdGljc19iYW5kMSwgc3RhdGlzdGljc19iYW5kMiwg4oCmXSBFYWNoIGVsZW1lbnQgaXMgYSBzdGF0aXN0aWNzIG9iamVjdCByZXByZXNlbnRpbmcgbWluIGFuZCBtYXggdmFsdWVzCiAgICAgICoqLwogICAgICBkZWNvZGU6IGZ1bmN0aW9uKGVuY29kZWREYXRhLCBvcHRpb25zKSB7CiAgICAgICAgaWYgKCFpc1BsYXRmb3JtTGl0dGxlRW5kaWFuKSB7CiAgICAgICAgICB0aHJvdyAiQmlnIGVuZGlhbiBzeXN0ZW0gaXMgbm90IHN1cHBvcnRlZC4iOwogICAgICAgIH0KICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICAgICAgICB2YXIgaW5wdXRPZmZzZXQgPSBvcHRpb25zLmlucHV0T2Zmc2V0IHx8IDA7CiAgICAgICAgdmFyIGZpbGVJZFZpZXcgPSBuZXcgVWludDhBcnJheShlbmNvZGVkRGF0YSwgaW5wdXRPZmZzZXQsIDEwKTsKICAgICAgICB2YXIgZmlsZUlkZW50aWZpZXJTdHJpbmcgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGZpbGVJZFZpZXcpOwogICAgICAgIHZhciBsZXJjLCBtYWpvclZlcnNpb247CiAgICAgICAgaWYgKGZpbGVJZGVudGlmaWVyU3RyaW5nLnRyaW0oKSA9PT0gIkNudFpJbWFnZSIpIHsKICAgICAgICAgIGxlcmMgPSBMZXJjRGVjb2RlOwogICAgICAgICAgbWFqb3JWZXJzaW9uID0gMTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoZmlsZUlkZW50aWZpZXJTdHJpbmcuc3Vic3RyaW5nKDAsIDUpID09PSAiTGVyYzIiKSB7CiAgICAgICAgICBsZXJjID0gTGVyYzJEZWNvZGU7CiAgICAgICAgICBtYWpvclZlcnNpb24gPSAyOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgIHRocm93ICJVbmV4cGVjdGVkIGZpbGUgaWRlbnRpZmllciBzdHJpbmc6ICIgKyBmaWxlSWRlbnRpZmllclN0cmluZzsKICAgICAgICB9CgogICAgICAgIHZhciBpUGxhbmUgPSAwLCBlb2YgPSBlbmNvZGVkRGF0YS5ieXRlTGVuZ3RoIC0gMTAsIGVuY29kZWRNYXNrRGF0YSwgYmFuZE1hc2tzID0gW10sIGJhbmRNYXNrLCBtYXNrRGF0YTsKICAgICAgICB2YXIgZGVjb2RlZFBpeGVsQmxvY2sgPSB7CiAgICAgICAgICB3aWR0aDogMCwKICAgICAgICAgIGhlaWdodDogMCwKICAgICAgICAgIHBpeGVsczogW10sCiAgICAgICAgICBwaXhlbFR5cGU6IG9wdGlvbnMucGl4ZWxUeXBlLAogICAgICAgICAgbWFzazogbnVsbCwKICAgICAgICAgIHN0YXRpc3RpY3M6IFtdCiAgICAgICAgfTsKCiAgICAgICAgd2hpbGUgKGlucHV0T2Zmc2V0IDwgZW9mKSB7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gbGVyYy5kZWNvZGUoZW5jb2RlZERhdGEsIHsKICAgICAgICAgICAgaW5wdXRPZmZzZXQ6IGlucHV0T2Zmc2V0LC8vZm9yIGJvdGggbGVyYzEgYW5kIGxlcmMyCiAgICAgICAgICAgIGVuY29kZWRNYXNrRGF0YTogZW5jb2RlZE1hc2tEYXRhLC8vbGVyYzEgb25seQogICAgICAgICAgICBtYXNrRGF0YTogbWFza0RhdGEsLy9sZXJjMiBvbmx5CiAgICAgICAgICAgIHJldHVybk1hc2s6IGlQbGFuZSA9PT0gMCA/IHRydWUgOiBmYWxzZSwvL2xlcmMxIG9ubHkKICAgICAgICAgICAgcmV0dXJuRW5jb2RlZE1hc2s6IGlQbGFuZSA9PT0gMCA/IHRydWUgOiBmYWxzZSwvL2xlcmMxIG9ubHkKICAgICAgICAgICAgcmV0dXJuRmlsZUluZm86IHRydWUsLy9mb3IgYm90aCBsZXJjMSBhbmQgbGVyYzIKICAgICAgICAgICAgcGl4ZWxUeXBlOiBvcHRpb25zLnBpeGVsVHlwZSB8fCBudWxsLC8vbGVyYzEgb25seQogICAgICAgICAgICBub0RhdGFWYWx1ZTogb3B0aW9ucy5ub0RhdGFWYWx1ZSB8fCBudWxsLy9sZXJjMSBvbmx5CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpbnB1dE9mZnNldCA9IHJlc3VsdC5maWxlSW5mby5lb2ZPZmZzZXQ7CiAgICAgICAgICBpZiAoaVBsYW5lID09PSAwKSB7CiAgICAgICAgICAgIGVuY29kZWRNYXNrRGF0YSA9IHJlc3VsdC5lbmNvZGVkTWFza0RhdGE7Ly9sZXJjMQogICAgICAgICAgICBtYXNrRGF0YSA9IHJlc3VsdC5tYXNrRGF0YTsvL2xlcmMyCiAgICAgICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLndpZHRoID0gcmVzdWx0LndpZHRoOwogICAgICAgICAgICBkZWNvZGVkUGl4ZWxCbG9jay5oZWlnaHQgPSByZXN1bHQuaGVpZ2h0OwogICAgICAgICAgICBkZWNvZGVkUGl4ZWxCbG9jay5kaW1Db3VudCA9IHJlc3VsdC5kaW1Db3VudCB8fCAxOwogICAgICAgICAgICAvL2RlY29kZWRQaXhlbEJsb2NrLmRpbVN0YXRzID0gZGVjb2RlZFBpeGVsQmxvY2suZGltU3RhdHM7CiAgICAgICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLnBpeGVsVHlwZSA9IHJlc3VsdC5waXhlbFR5cGUgfHwgcmVzdWx0LmZpbGVJbmZvLnBpeGVsVHlwZTsKICAgICAgICAgICAgZGVjb2RlZFBpeGVsQmxvY2subWFzayA9IHJlc3VsdC5tYXNrRGF0YTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChtYWpvclZlcnNpb24gPjEgJiYgcmVzdWx0LmZpbGVJbmZvLm1hc2sgJiYgcmVzdWx0LmZpbGVJbmZvLm1hc2subnVtQnl0ZXMgPiAwKSB7CiAgICAgICAgICAgIGJhbmRNYXNrcy5wdXNoKHJlc3VsdC5tYXNrRGF0YSk7CiAgICAgICAgICB9CgogICAgICAgICAgaVBsYW5lKys7CiAgICAgICAgICBkZWNvZGVkUGl4ZWxCbG9jay5waXhlbHMucHVzaChyZXN1bHQucGl4ZWxEYXRhKTsKICAgICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLnN0YXRpc3RpY3MucHVzaCh7CiAgICAgICAgICAgIG1pblZhbHVlOiByZXN1bHQubWluVmFsdWUsCiAgICAgICAgICAgIG1heFZhbHVlOiByZXN1bHQubWF4VmFsdWUsCiAgICAgICAgICAgIG5vRGF0YVZhbHVlOiByZXN1bHQubm9EYXRhVmFsdWUsCiAgICAgICAgICAgIGRpbVN0YXRzOiByZXN1bHQuZGltU3RhdHMKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICB2YXIgaSwgaiwgbnVtUGl4ZWxzOwogICAgICAgIGlmIChtYWpvclZlcnNpb24gPiAxICYmIGJhbmRNYXNrcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICBudW1QaXhlbHMgPSBkZWNvZGVkUGl4ZWxCbG9jay53aWR0aCAqIGRlY29kZWRQaXhlbEJsb2NrLmhlaWdodDsKICAgICAgICAgIGRlY29kZWRQaXhlbEJsb2NrLmJhbmRNYXNrcyA9IGJhbmRNYXNrczsKICAgICAgICAgIG1hc2tEYXRhID0gbmV3IFVpbnQ4QXJyYXkobnVtUGl4ZWxzKTsKICAgICAgICAgIG1hc2tEYXRhLnNldChiYW5kTWFza3NbMF0pOwogICAgICAgICAgZm9yIChpID0gMTsgaSA8IGJhbmRNYXNrcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBiYW5kTWFzayA9IGJhbmRNYXNrc1tpXTsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IG51bVBpeGVsczsgaisrKSB7CiAgICAgICAgICAgICAgbWFza0RhdGFbal0gPSBtYXNrRGF0YVtqXSAmIGJhbmRNYXNrW2pdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBkZWNvZGVkUGl4ZWxCbG9jay5tYXNrRGF0YSA9IG1hc2tEYXRhOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRlY29kZWRQaXhlbEJsb2NrOwogICAgICB9CiAgICB9OwoKICAgIGlmIChtb2R1bGUuZXhwb3J0cykgey8qIGpzaGludCBpZ25vcmU6bGluZSAqLwogICAgICAvL2NvbW1vbkpTIG1vZHVsZSAxLjAvMS4xLzEuMS4xIHN5c3RlbXMsIHN1Y2ggYXMgbm9kZUpTCiAgICAgIC8vaHR0cDovL3dpa2kuY29tbW9uanMub3JnL3dpa2kvTW9kdWxlcwogICAgICBtb2R1bGUuZXhwb3J0cyA9IExlcmM7LyoganNoaW50IGlnbm9yZTpsaW5lICovCiAgICB9CiAgICBlbHNlIHsKICAgICAgLy9hc3NpZ24gdG8gdGhpcywgbW9zdCBsaWtlbHkgd2luZG93CiAgICAgIHRoaXMuTGVyYyA9IExlcmM7CiAgICB9CgogIH0pKCk7CiAgfShMZXJjRGVjb2RlKSk7CgogIHZhciBMZXJjID0gTGVyY0RlY29kZS5leHBvcnRzOwoKICBjb25zdCBmaWVsZFRhZ05hbWVzID0gewogICAgLy8gVElGRiBCYXNlbGluZQogICAgMHgwMTNCOiAnQXJ0aXN0JywKICAgIDB4MDEwMjogJ0JpdHNQZXJTYW1wbGUnLAogICAgMHgwMTA5OiAnQ2VsbExlbmd0aCcsCiAgICAweDAxMDg6ICdDZWxsV2lkdGgnLAogICAgMHgwMTQwOiAnQ29sb3JNYXAnLAogICAgMHgwMTAzOiAnQ29tcHJlc3Npb24nLAogICAgMHg4Mjk4OiAnQ29weXJpZ2h0JywKICAgIDB4MDEzMjogJ0RhdGVUaW1lJywKICAgIDB4MDE1MjogJ0V4dHJhU2FtcGxlcycsCiAgICAweDAxMEE6ICdGaWxsT3JkZXInLAogICAgMHgwMTIxOiAnRnJlZUJ5dGVDb3VudHMnLAogICAgMHgwMTIwOiAnRnJlZU9mZnNldHMnLAogICAgMHgwMTIzOiAnR3JheVJlc3BvbnNlQ3VydmUnLAogICAgMHgwMTIyOiAnR3JheVJlc3BvbnNlVW5pdCcsCiAgICAweDAxM0M6ICdIb3N0Q29tcHV0ZXInLAogICAgMHgwMTBFOiAnSW1hZ2VEZXNjcmlwdGlvbicsCiAgICAweDAxMDE6ICdJbWFnZUxlbmd0aCcsCiAgICAweDAxMDA6ICdJbWFnZVdpZHRoJywKICAgIDB4MDEwRjogJ01ha2UnLAogICAgMHgwMTE5OiAnTWF4U2FtcGxlVmFsdWUnLAogICAgMHgwMTE4OiAnTWluU2FtcGxlVmFsdWUnLAogICAgMHgwMTEwOiAnTW9kZWwnLAogICAgMHgwMEZFOiAnTmV3U3ViZmlsZVR5cGUnLAogICAgMHgwMTEyOiAnT3JpZW50YXRpb24nLAogICAgMHgwMTA2OiAnUGhvdG9tZXRyaWNJbnRlcnByZXRhdGlvbicsCiAgICAweDAxMUM6ICdQbGFuYXJDb25maWd1cmF0aW9uJywKICAgIDB4MDEyODogJ1Jlc29sdXRpb25Vbml0JywKICAgIDB4MDExNjogJ1Jvd3NQZXJTdHJpcCcsCiAgICAweDAxMTU6ICdTYW1wbGVzUGVyUGl4ZWwnLAogICAgMHgwMTMxOiAnU29mdHdhcmUnLAogICAgMHgwMTE3OiAnU3RyaXBCeXRlQ291bnRzJywKICAgIDB4MDExMTogJ1N0cmlwT2Zmc2V0cycsCiAgICAweDAwRkY6ICdTdWJmaWxlVHlwZScsCiAgICAweDAxMDc6ICdUaHJlc2hob2xkaW5nJywKICAgIDB4MDExQTogJ1hSZXNvbHV0aW9uJywKICAgIDB4MDExQjogJ1lSZXNvbHV0aW9uJywKCiAgICAvLyBUSUZGIEV4dGVuZGVkCiAgICAweDAxNDY6ICdCYWRGYXhMaW5lcycsCiAgICAweDAxNDc6ICdDbGVhbkZheERhdGEnLAogICAgMHgwMTU3OiAnQ2xpcFBhdGgnLAogICAgMHgwMTQ4OiAnQ29uc2VjdXRpdmVCYWRGYXhMaW5lcycsCiAgICAweDAxQjE6ICdEZWNvZGUnLAogICAgMHgwMUIyOiAnRGVmYXVsdEltYWdlQ29sb3InLAogICAgMHgwMTBEOiAnRG9jdW1lbnROYW1lJywKICAgIDB4MDE1MDogJ0RvdFJhbmdlJywKICAgIDB4MDE0MTogJ0hhbGZ0b25lSGludHMnLAogICAgMHgwMTVBOiAnSW5kZXhlZCcsCiAgICAweDAxNUI6ICdKUEVHVGFibGVzJywKICAgIDB4MDExRDogJ1BhZ2VOYW1lJywKICAgIDB4MDEyOTogJ1BhZ2VOdW1iZXInLAogICAgMHgwMTNEOiAnUHJlZGljdG9yJywKICAgIDB4MDEzRjogJ1ByaW1hcnlDaHJvbWF0aWNpdGllcycsCiAgICAweDAyMTQ6ICdSZWZlcmVuY2VCbGFja1doaXRlJywKICAgIDB4MDE1MzogJ1NhbXBsZUZvcm1hdCcsCiAgICAweDAxNTQ6ICdTTWluU2FtcGxlVmFsdWUnLAogICAgMHgwMTU1OiAnU01heFNhbXBsZVZhbHVlJywKICAgIDB4MDIyRjogJ1N0cmlwUm93Q291bnRzJywKICAgIDB4MDE0QTogJ1N1YklGRHMnLAogICAgMHgwMTI0OiAnVDRPcHRpb25zJywKICAgIDB4MDEyNTogJ1Q2T3B0aW9ucycsCiAgICAweDAxNDU6ICdUaWxlQnl0ZUNvdW50cycsCiAgICAweDAxNDM6ICdUaWxlTGVuZ3RoJywKICAgIDB4MDE0NDogJ1RpbGVPZmZzZXRzJywKICAgIDB4MDE0MjogJ1RpbGVXaWR0aCcsCiAgICAweDAxMkQ6ICdUcmFuc2ZlckZ1bmN0aW9uJywKICAgIDB4MDEzRTogJ1doaXRlUG9pbnQnLAogICAgMHgwMTU4OiAnWENsaXBQYXRoVW5pdHMnLAogICAgMHgwMTFFOiAnWFBvc2l0aW9uJywKICAgIDB4MDIxMTogJ1lDYkNyQ29lZmZpY2llbnRzJywKICAgIDB4MDIxMzogJ1lDYkNyUG9zaXRpb25pbmcnLAogICAgMHgwMjEyOiAnWUNiQ3JTdWJTYW1wbGluZycsCiAgICAweDAxNTk6ICdZQ2xpcFBhdGhVbml0cycsCiAgICAweDAxMUY6ICdZUG9zaXRpb24nLAoKICAgIC8vIEVYSUYKICAgIDB4OTIwMjogJ0FwZXJ0dXJlVmFsdWUnLAogICAgMHhBMDAxOiAnQ29sb3JTcGFjZScsCiAgICAweDkwMDQ6ICdEYXRlVGltZURpZ2l0aXplZCcsCiAgICAweDkwMDM6ICdEYXRlVGltZU9yaWdpbmFsJywKICAgIDB4ODc2OTogJ0V4aWYgSUZEJywKICAgIDB4OTAwMDogJ0V4aWZWZXJzaW9uJywKICAgIDB4ODI5QTogJ0V4cG9zdXJlVGltZScsCiAgICAweEEzMDA6ICdGaWxlU291cmNlJywKICAgIDB4OTIwOTogJ0ZsYXNoJywKICAgIDB4QTAwMDogJ0ZsYXNocGl4VmVyc2lvbicsCiAgICAweDgyOUQ6ICdGTnVtYmVyJywKICAgIDB4QTQyMDogJ0ltYWdlVW5pcXVlSUQnLAogICAgMHg5MjA4OiAnTGlnaHRTb3VyY2UnLAogICAgMHg5MjdDOiAnTWFrZXJOb3RlJywKICAgIDB4OTIwMTogJ1NodXR0ZXJTcGVlZFZhbHVlJywKICAgIDB4OTI4NjogJ1VzZXJDb21tZW50JywKCiAgICAvLyBJUFRDCiAgICAweDgzQkI6ICdJUFRDJywKCiAgICAvLyBJQ0MKICAgIDB4ODc3MzogJ0lDQyBQcm9maWxlJywKCiAgICAvLyBYTVAKICAgIDB4MDJCQzogJ1hNUCcsCgogICAgLy8gR0RBTAogICAgMHhBNDgwOiAnR0RBTF9NRVRBREFUQScsCiAgICAweEE0ODE6ICdHREFMX05PREFUQScsCgogICAgLy8gUGhvdG9zaG9wCiAgICAweDg2NDk6ICdQaG90b3Nob3AnLAoKICAgIC8vIEdlb1RpZmYKICAgIDB4ODMwRTogJ01vZGVsUGl4ZWxTY2FsZScsCiAgICAweDg0ODI6ICdNb2RlbFRpZXBvaW50JywKICAgIDB4ODVEODogJ01vZGVsVHJhbnNmb3JtYXRpb24nLAogICAgMHg4N0FGOiAnR2VvS2V5RGlyZWN0b3J5JywKICAgIDB4ODdCMDogJ0dlb0RvdWJsZVBhcmFtcycsCiAgICAweDg3QjE6ICdHZW9Bc2NpaVBhcmFtcycsCgogICAgLy8gTEVSQwogICAgMHhDNUYyOiAnTGVyY1BhcmFtZXRlcnMnLAogIH07CgogIGNvbnN0IGZpZWxkVGFncyA9IHt9OwogIGZvciAoY29uc3Qga2V5IGluIGZpZWxkVGFnTmFtZXMpIHsKICAgIGlmIChmaWVsZFRhZ05hbWVzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgZmllbGRUYWdzW2ZpZWxkVGFnTmFtZXNba2V5XV0gPSBwYXJzZUludChrZXksIDEwKTsKICAgIH0KICB9CgogIFsKICAgIGZpZWxkVGFncy5CaXRzUGVyU2FtcGxlLAogICAgZmllbGRUYWdzLkV4dHJhU2FtcGxlcywKICAgIGZpZWxkVGFncy5TYW1wbGVGb3JtYXQsCiAgICBmaWVsZFRhZ3MuU3RyaXBCeXRlQ291bnRzLAogICAgZmllbGRUYWdzLlN0cmlwT2Zmc2V0cywKICAgIGZpZWxkVGFncy5TdHJpcFJvd0NvdW50cywKICAgIGZpZWxkVGFncy5UaWxlQnl0ZUNvdW50cywKICAgIGZpZWxkVGFncy5UaWxlT2Zmc2V0cywKICAgIGZpZWxkVGFncy5TdWJJRkRzLAogIF07CgogIGNvbnN0IGZpZWxkVHlwZU5hbWVzID0gewogICAgMHgwMDAxOiAnQllURScsCiAgICAweDAwMDI6ICdBU0NJSScsCiAgICAweDAwMDM6ICdTSE9SVCcsCiAgICAweDAwMDQ6ICdMT05HJywKICAgIDB4MDAwNTogJ1JBVElPTkFMJywKICAgIDB4MDAwNjogJ1NCWVRFJywKICAgIDB4MDAwNzogJ1VOREVGSU5FRCcsCiAgICAweDAwMDg6ICdTU0hPUlQnLAogICAgMHgwMDA5OiAnU0xPTkcnLAogICAgMHgwMDBBOiAnU1JBVElPTkFMJywKICAgIDB4MDAwQjogJ0ZMT0FUJywKICAgIDB4MDAwQzogJ0RPVUJMRScsCiAgICAvLyBJRkQgb2Zmc2V0LCBzdWdnZXN0ZWQgYnkgaHR0cHM6Ly9vd2wucGh5LnF1ZWVuc3UuY2EvfnBoaWwvZXhpZnRvb2wvc3RhbmRhcmRzLmh0bWwKICAgIDB4MDAwRDogJ0lGRCcsCiAgICAvLyBpbnRyb2R1Y2VkIGJ5IEJpZ1RJRkYKICAgIDB4MDAxMDogJ0xPTkc4JywKICAgIDB4MDAxMTogJ1NMT05HOCcsCiAgICAweDAwMTI6ICdJRkQ4JywKICB9OwoKICBjb25zdCBmaWVsZFR5cGVzID0ge307CiAgZm9yIChjb25zdCBrZXkgaW4gZmllbGRUeXBlTmFtZXMpIHsKICAgIGlmIChmaWVsZFR5cGVOYW1lcy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgIGZpZWxkVHlwZXNbZmllbGRUeXBlTmFtZXNba2V5XV0gPSBwYXJzZUludChrZXksIDEwKTsKICAgIH0KICB9CgogIGNvbnN0IExlcmNQYXJhbWV0ZXJzID0gewogICAgVmVyc2lvbjogMCwKICAgIEFkZENvbXByZXNzaW9uOiAxLAogIH07CgogIGNvbnN0IExlcmNBZGRDb21wcmVzc2lvbiA9IHsKICAgIE5vbmU6IDAsCiAgICBEZWZsYXRlOiAxLAogIH07CgoKICBjb25zdCBnZW9LZXlOYW1lcyA9IHsKICAgIDEwMjQ6ICdHVE1vZGVsVHlwZUdlb0tleScsCiAgICAxMDI1OiAnR1RSYXN0ZXJUeXBlR2VvS2V5JywKICAgIDEwMjY6ICdHVENpdGF0aW9uR2VvS2V5JywKICAgIDIwNDg6ICdHZW9ncmFwaGljVHlwZUdlb0tleScsCiAgICAyMDQ5OiAnR2VvZ0NpdGF0aW9uR2VvS2V5JywKICAgIDIwNTA6ICdHZW9nR2VvZGV0aWNEYXR1bUdlb0tleScsCiAgICAyMDUxOiAnR2VvZ1ByaW1lTWVyaWRpYW5HZW9LZXknLAogICAgMjA1MjogJ0dlb2dMaW5lYXJVbml0c0dlb0tleScsCiAgICAyMDUzOiAnR2VvZ0xpbmVhclVuaXRTaXplR2VvS2V5JywKICAgIDIwNTQ6ICdHZW9nQW5ndWxhclVuaXRzR2VvS2V5JywKICAgIDIwNTU6ICdHZW9nQW5ndWxhclVuaXRTaXplR2VvS2V5JywKICAgIDIwNTY6ICdHZW9nRWxsaXBzb2lkR2VvS2V5JywKICAgIDIwNTc6ICdHZW9nU2VtaU1ham9yQXhpc0dlb0tleScsCiAgICAyMDU4OiAnR2VvZ1NlbWlNaW5vckF4aXNHZW9LZXknLAogICAgMjA1OTogJ0dlb2dJbnZGbGF0dGVuaW5nR2VvS2V5JywKICAgIDIwNjA6ICdHZW9nQXppbXV0aFVuaXRzR2VvS2V5JywKICAgIDIwNjE6ICdHZW9nUHJpbWVNZXJpZGlhbkxvbmdHZW9LZXknLAogICAgMjA2MjogJ0dlb2dUT1dHUzg0R2VvS2V5JywKICAgIDMwNzI6ICdQcm9qZWN0ZWRDU1R5cGVHZW9LZXknLAogICAgMzA3MzogJ1BDU0NpdGF0aW9uR2VvS2V5JywKICAgIDMwNzQ6ICdQcm9qZWN0aW9uR2VvS2V5JywKICAgIDMwNzU6ICdQcm9qQ29vcmRUcmFuc0dlb0tleScsCiAgICAzMDc2OiAnUHJvakxpbmVhclVuaXRzR2VvS2V5JywKICAgIDMwNzc6ICdQcm9qTGluZWFyVW5pdFNpemVHZW9LZXknLAogICAgMzA3ODogJ1Byb2pTdGRQYXJhbGxlbDFHZW9LZXknLAogICAgMzA3OTogJ1Byb2pTdGRQYXJhbGxlbDJHZW9LZXknLAogICAgMzA4MDogJ1Byb2pOYXRPcmlnaW5Mb25nR2VvS2V5JywKICAgIDMwODE6ICdQcm9qTmF0T3JpZ2luTGF0R2VvS2V5JywKICAgIDMwODI6ICdQcm9qRmFsc2VFYXN0aW5nR2VvS2V5JywKICAgIDMwODM6ICdQcm9qRmFsc2VOb3J0aGluZ0dlb0tleScsCiAgICAzMDg0OiAnUHJvakZhbHNlT3JpZ2luTG9uZ0dlb0tleScsCiAgICAzMDg1OiAnUHJvakZhbHNlT3JpZ2luTGF0R2VvS2V5JywKICAgIDMwODY6ICdQcm9qRmFsc2VPcmlnaW5FYXN0aW5nR2VvS2V5JywKICAgIDMwODc6ICdQcm9qRmFsc2VPcmlnaW5Ob3J0aGluZ0dlb0tleScsCiAgICAzMDg4OiAnUHJvakNlbnRlckxvbmdHZW9LZXknLAogICAgMzA4OTogJ1Byb2pDZW50ZXJMYXRHZW9LZXknLAogICAgMzA5MDogJ1Byb2pDZW50ZXJFYXN0aW5nR2VvS2V5JywKICAgIDMwOTE6ICdQcm9qQ2VudGVyTm9ydGhpbmdHZW9LZXknLAogICAgMzA5MjogJ1Byb2pTY2FsZUF0TmF0T3JpZ2luR2VvS2V5JywKICAgIDMwOTM6ICdQcm9qU2NhbGVBdENlbnRlckdlb0tleScsCiAgICAzMDk0OiAnUHJvakF6aW11dGhBbmdsZUdlb0tleScsCiAgICAzMDk1OiAnUHJvalN0cmFpZ2h0VmVydFBvbGVMb25nR2VvS2V5JywKICAgIDMwOTY6ICdQcm9qUmVjdGlmaWVkR3JpZEFuZ2xlR2VvS2V5JywKICAgIDQwOTY6ICdWZXJ0aWNhbENTVHlwZUdlb0tleScsCiAgICA0MDk3OiAnVmVydGljYWxDaXRhdGlvbkdlb0tleScsCiAgICA0MDk4OiAnVmVydGljYWxEYXR1bUdlb0tleScsCiAgICA0MDk5OiAnVmVydGljYWxVbml0c0dlb0tleScsCiAgfTsKCiAgY29uc3QgZ2VvS2V5cyA9IHt9OwogIGZvciAoY29uc3Qga2V5IGluIGdlb0tleU5hbWVzKSB7CiAgICBpZiAoZ2VvS2V5TmFtZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICBnZW9LZXlzW2dlb0tleU5hbWVzW2tleV1dID0gcGFyc2VJbnQoa2V5LCAxMCk7CiAgICB9CiAgfQoKICBjbGFzcyBMZXJjRGVjb2RlciBleHRlbmRzIEJhc2VEZWNvZGVyIHsKICAgIGNvbnN0cnVjdG9yKGZpbGVEaXJlY3RvcnkpIHsKICAgICAgc3VwZXIoKTsKCiAgICAgIHRoaXMucGxhbmFyQ29uZmlndXJhdGlvbiA9IHR5cGVvZiBmaWxlRGlyZWN0b3J5LlBsYW5hckNvbmZpZ3VyYXRpb24gIT09ICd1bmRlZmluZWQnID8gZmlsZURpcmVjdG9yeS5QbGFuYXJDb25maWd1cmF0aW9uIDogMTsKICAgICAgdGhpcy5zYW1wbGVzUGVyUGl4ZWwgPSB0eXBlb2YgZmlsZURpcmVjdG9yeS5TYW1wbGVzUGVyUGl4ZWwgIT09ICd1bmRlZmluZWQnID8gZmlsZURpcmVjdG9yeS5TYW1wbGVzUGVyUGl4ZWwgOiAxOwoKICAgICAgdGhpcy5hZGRDb21wcmVzc2lvbiA9IGZpbGVEaXJlY3RvcnkuTGVyY1BhcmFtZXRlcnNbTGVyY1BhcmFtZXRlcnMuQWRkQ29tcHJlc3Npb25dOwogICAgfQoKICAgIGludGVybGVhdmVQaXhlbHMoYmFuZEludGVybGVhdmVkRGF0YSkgewogICAgICBjb25zdCBwaXhlbEludGVybGVhdmVkRGF0YSA9IG5ldyBiYW5kSW50ZXJsZWF2ZWREYXRhLmNvbnN0cnVjdG9yKGJhbmRJbnRlcmxlYXZlZERhdGEubGVuZ3RoKTsKICAgICAgY29uc3QgbGVuZ3RoUGVyU2FtcGxlID0gYmFuZEludGVybGVhdmVkRGF0YS5sZW5ndGggLyB0aGlzLnNhbXBsZXNQZXJQaXhlbDsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGhQZXJTYW1wbGU7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5zYW1wbGVzUGVyUGl4ZWw7IGorKykgewogICAgICAgICAgcGl4ZWxJbnRlcmxlYXZlZERhdGFbaSAqIHRoaXMuc2FtcGxlc1BlclBpeGVsICsgal0gPSBiYW5kSW50ZXJsZWF2ZWREYXRhW2kgKyBqICogbGVuZ3RoUGVyU2FtcGxlXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHBpeGVsSW50ZXJsZWF2ZWREYXRhOwogICAgfQoKICAgIGRlY29kZUJsb2NrKGJ1ZmZlcikgewogICAgICBzd2l0Y2ggKHRoaXMuYWRkQ29tcHJlc3Npb24pIHsKICAgICAgICBjYXNlIExlcmNBZGRDb21wcmVzc2lvbi5Ob25lOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBMZXJjQWRkQ29tcHJlc3Npb24uRGVmbGF0ZToKICAgICAgICAgIGJ1ZmZlciA9IGluZmxhdGVfMShuZXcgVWludDhBcnJheShidWZmZXIpKS5idWZmZXI7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBMRVJDIGFkZGl0aW9uYWwgY29tcHJlc3Npb24gbWV0aG9kIGlkZW50aWZpZXI6ICR7dGhpcy5hZGRDb21wcmVzc2lvbn1gKTsKICAgICAgfQoKICAgICAgY29uc3QgbGVyY1Jlc3VsdCA9IExlcmMuZGVjb2RlKGJ1ZmZlcik7CiAgICAgIGNvbnN0IGxlcmNEYXRhID0gbGVyY1Jlc3VsdC5waXhlbHNbMF07IC8vIGFsd2F5cyBiYW5kLWludGVybGVhdmVkCiAgICAgIGNvbnN0IGRlY29kZWREYXRhID0gdGhpcy5wbGFuYXJDb25maWd1cmF0aW9uID09PSAxID8gdGhpcy5pbnRlcmxlYXZlUGl4ZWxzKGxlcmNEYXRhKSA6IGxlcmNEYXRhOyAvLyB0cmFuc2Zvcm0gdG8gcGl4ZWwtaW50ZXJsZWF2ZWQgaWYgZXhwZWN0ZWQKICAgICAgcmV0dXJuIGRlY29kZWREYXRhLmJ1ZmZlcjsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdldERlY29kZXIoZmlsZURpcmVjdG9yeSkgewogICAgc3dpdGNoIChmaWxlRGlyZWN0b3J5LkNvbXByZXNzaW9uKSB7CiAgICAgIGNhc2UgdW5kZWZpbmVkOgogICAgICBjYXNlIDE6IC8vIG5vIGNvbXByZXNzaW9uCiAgICAgICAgcmV0dXJuIG5ldyBSYXdEZWNvZGVyKCk7CiAgICAgIGNhc2UgNTogLy8gTFpXCiAgICAgICAgcmV0dXJuIG5ldyBMWldEZWNvZGVyKGZpbGVEaXJlY3RvcnkpOwogICAgICBjYXNlIDY6IC8vIEpQRUcKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ29sZCBzdHlsZSBKUEVHIGNvbXByZXNzaW9uIGlzIG5vdCBzdXBwb3J0ZWQuJyk7CiAgICAgIGNhc2UgNzogLy8gSlBFRwogICAgICAgIHJldHVybiBuZXcgSnBlZ0RlY29kZXIoZmlsZURpcmVjdG9yeSk7CiAgICAgIGNhc2UgODogLy8gRGVmbGF0ZSBhcyByZWNvZ25pemVkIGJ5IEFkb2JlCiAgICAgIGNhc2UgMzI5NDY6IC8vIERlZmxhdGUgR0RBTCBkZWZhdWx0CiAgICAgICAgcmV0dXJuIG5ldyBEZWZsYXRlRGVjb2RlcigpOwogICAgICBjYXNlIDMyNzczOiAvLyBwYWNrYml0cwogICAgICAgIHJldHVybiBuZXcgUGFja2JpdHNEZWNvZGVyKCk7CiAgICAgIGNhc2UgMzQ4ODc6IC8vIExFUkMKICAgICAgICByZXR1cm4gbmV3IExlcmNEZWNvZGVyKGZpbGVEaXJlY3RvcnkpOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBjb21wcmVzc2lvbiBtZXRob2QgaWRlbnRpZmllcjogJHtmaWxlRGlyZWN0b3J5LkNvbXByZXNzaW9ufWApOwogICAgfQogIH0KCiAgYXN5bmMgZnVuY3Rpb24gZGVjb2RlKGZpbGVEaXJlY3RvcnksIGJ1ZmZlcikgewogICAgY29uc3QgZGVjb2RlciA9IGdldERlY29kZXIoZmlsZURpcmVjdG9yeSk7CiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkZWNvZGVyLmRlY29kZShmaWxlRGlyZWN0b3J5LCBidWZmZXIpOwogICAgc2VsZi5wb3N0TWVzc2FnZShyZXN1bHQsIFtyZXN1bHRdKTsKICB9CiAgaWYgKHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIikgewogICAgc2VsZi5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgKGV2ZW50KSA9PiB7CiAgICAgIGNvbnN0IFtuYW1lLCAuLi5hcmdzXSA9IGV2ZW50LmRhdGE7CiAgICAgIHN3aXRjaCAobmFtZSkgewogICAgICAgIGNhc2UgImRlY29kZSI6CiAgICAgICAgICBkZWNvZGUoYXJnc1swXSwgYXJnc1sxXSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSk7CiAgfQoKfSkoKTsK";typeof window!="undefined"&&window.Blob&&new Blob([atob(eP)],{type:"text/javascript;charset=utf-8"});function tP(t){const e=t.length,n=VM(t);return i=>{if(Array.isArray(i))return[...i];const g=Array(e).fill(0);for(const[s,o]of Object.entries(i))g[n(s)]=o;return g}}const AR={u1:"Uint8",u2:"Uint16",u4:"Uint32",f4:"Float32",f8:"Float64",i1:"Int8",i2:"Int16",i4:"Int32"};class OD{constructor(e,n,i){ua(this,"_data");ua(this,"_indexer");ua(this,"_readChunks");this.labels=n,this.tileSize=i,this._indexer=tP(n),this._data=e;const g=e.chunks[this._xIndex],s=e.chunks[this._xIndex-1];this._readChunks=i===g&&i===s}get shape(){return this._data.shape}get dtype(){const e=this._data.dtype.slice(1);if(!(e in AR))throw Error(`Zarr dtype not supported, got ${e}.`);return AR[e]}get _xIndex(){const e=Yo(this._data.shape);return this._data.shape.length-(e?2:1)}_chunkIndex(e,n,i){const g=this._indexer(e);return g[this._xIndex]=n,g[this._xIndex-1]=i,g}_getSlices(e,n){const{height:i,width:g}=sa(this),[s,o]=[e*this.tileSize,Math.min((e+1)*this.tileSize,g)],[r,I]=[n*this.tileSize,Math.min((n+1)*this.tileSize,i)];if(s===o||r===I)throw new ds("Tile slice is zero-sized.");return[Ni(s,o),Ni(r,I)]}async getRaster({selection:e}){const n=this._chunkIndex(e,null,null),{data:i,shape:g}=await this._data.getRaw(n),[s,o]=g;return{data:i,width:o,height:s}}async getTile(e){const{x:n,y:i,selection:g,signal:s}=e;let o;if(this._readChunks){const l=this._chunkIndex(g,n,i);o=await this._data.getRawChunk(l,{storeOptions:{signal:s}})}else{const[l,C]=this._getSlices(n,i),c=this._chunkIndex(g,l,C);o=await this._data.getRaw(c)}const{data:r,shape:[I,a]}=o;return{data:r,width:a,height:I}}onTileError(e){if(!(e instanceof ds))throw e}}var nP=(t,e=1,n)=>{if(n=S({indent:" ",includeEmptyLines:!1},n),typeof t!="string")throw new TypeError(`Expected \`input\` to be a \`string\`, got \`${typeof t}\``);if(typeof e!="number")throw new TypeError(`Expected \`count\` to be a \`number\`, got \`${typeof e}\``);if(typeof n.indent!="string")throw new TypeError(`Expected \`options.indent\` to be a \`string\`, got \`${typeof n.indent}\``);if(e===0)return t;const i=n.includeEmptyLines?/^/gm:/^(?!\s*$)/gm;return t.replace(i,n.indent.repeat(e))},iP=Tm(X9);const dR=iP,uR=/\s+at.*(?:\(|\s)(.*)\)?/,gP=/^(?:(?:(?:node|(?:internal\/[\w/]*|.*node_modules\/(?:babel-polyfill|pirates)\/.*)?\w+)\.js:\d+:\d+)|native)/,sP=typeof dR.homedir=="undefined"?"":dR.homedir();var oP=(t,e)=>(e=Object.assign({pretty:!1},e),t.replace(/\\/g,"/").split(`
`).filter(n=>{const i=n.match(uR);if(i===null||!i[1])return!0;const g=i[1];return g.includes(".app/Contents/Resources/electron.asar")||g.includes(".app/Contents/Resources/default_app.asar")?!1:!gP.test(g)}).filter(n=>n.trim()!=="").map(n=>e.pretty?n.replace(uR,(i,g)=>i.replace(g,g.replace(sP,"~"))):n).join(`
`));const rP=nP,IP=oP,aP=t=>t.replace(/\s+at .*aggregate-error\/index.js:\d+:\d+\)?/g,"");class lP extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError(`Expected input to be an Array, got ${typeof e}`);e=[...e].map(i=>i instanceof Error?i:i!==null&&typeof i=="object"?Object.assign(new Error(i.message),i):new Error(i));let n=e.map(i=>typeof i.stack=="string"?aP(IP(i.stack)):String(i)).join(`
`);n=`
`+rP(n,4);super(n);this.name="AggregateError",Object.defineProperty(this,"_errors",{value:e})}*[Symbol.iterator](){for(const e of this._errors)yield e}}var CP=lP;const cP=CP;var jD=async(t,e,{concurrency:n=1/0,stopOnError:i=!0}={})=>new Promise((g,s)=>{if(typeof e!="function")throw new TypeError("Mapper function is required");if(!((Number.isSafeInteger(n)||n===1/0)&&n>=1))throw new TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${n}\` (${typeof n})`);const o=[],r=[],I=t[Symbol.iterator]();let a=!1,l=!1,C=0,c=0;const A=()=>{if(a)return;const d=I.next(),m=c;if(c++,d.done){l=!0,C===0&&(!i&&r.length!==0?s(new cP(r)):g(o));return}C++,(async()=>{try{const u=await d.value;o[m]=await e(u,m),C--,A()}catch(u){i?(a=!0,s(u)):(r.push(u),C--,A())}})()};for(let d=0;d<n&&(A(),!l);d++);});class qD{constructor(e={}){if(!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[n,i]of e)this.onEviction(n,i.value)}_deleteIfExpired(e,n){return typeof n.expiry=="number"&&n.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,n.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,n){if(this._deleteIfExpired(e,n)===!1)return n.value}_getItemValue(e,n){return n.expiry?this._getOrDeleteIfExpired(e,n):n.value}_peek(e,n){const i=n.get(e);return this._getItemValue(e,i)}_set(e,n){this.cache.set(e,n),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,n){this.oldCache.delete(e),this._set(e,n)}*_entriesAscending(){for(const e of this.oldCache){const[n,i]=e;this.cache.has(n)||this._deleteIfExpired(n,i)===!1&&(yield e)}for(const e of this.cache){const[n,i]=e;this._deleteIfExpired(n,i)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const n=this.cache.get(e);return this._getItemValue(e,n)}if(this.oldCache.has(e)){const n=this.oldCache.get(e);if(this._deleteIfExpired(e,n)===!1)return this._moveToRecent(e,n),n.value}}set(e,n,{maxAge:i=this.maxAge}={}){const g=typeof i=="number"&&i!==Number.POSITIVE_INFINITY?Date.now()+i:void 0;this.cache.has(e)?this.cache.set(e,{value:n,expiry:g}):this._set(e,{value:n,expiry:g})}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const n=this.cache.delete(e);return n&&this._size--,this.oldCache.delete(e)||n}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const n=[...this._entriesAscending()],i=n.length-e;i<0?(this.cache=new Map(n),this.oldCache=new Map,this._size=n.length):(i>0&&this._emitEvictions(n.slice(0,i)),this.oldCache=new Map(n.slice(i)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[n,i]=e;this._deleteIfExpired(n,i)===!1&&(yield[n,i.value])}for(const e of this.oldCache){const[n,i]=e;this.cache.has(n)||this._deleteIfExpired(n,i)===!1&&(yield[n,i.value])}}*entriesDescending(){let e=[...this.cache];for(let n=e.length-1;n>=0;--n){const i=e[n],[g,s]=i;this._deleteIfExpired(g,s)===!1&&(yield[g,s.value])}e=[...this.oldCache];for(let n=e.length-1;n>=0;--n){const i=e[n],[g,s]=i;this.cache.has(g)||this._deleteIfExpired(g,s)===!1&&(yield[g,s.value])}}*entriesAscending(){for(const[e,n]of this._entriesAscending())yield[e,n.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const n of this.oldCache.keys())this.cache.has(n)||e++;return Math.min(this._size+e,this.maxSize)}}var AP={black:"#000",white:"#fff"},pc=AP,dP={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},im=dP,uP={50:"#fce4ec",100:"#f8bbd0",200:"#f48fb1",300:"#f06292",400:"#ec407a",500:"#e91e63",600:"#d81b60",700:"#c2185b",800:"#ad1457",900:"#880e4f",A100:"#ff80ab",A200:"#ff4081",A400:"#f50057",A700:"#c51162"},gm=uP,hP={50:"#e8eaf6",100:"#c5cae9",200:"#9fa8da",300:"#7986cb",400:"#5c6bc0",500:"#3f51b5",600:"#3949ab",700:"#303f9f",800:"#283593",900:"#1a237e",A100:"#8c9eff",A200:"#536dfe",A400:"#3d5afe",A700:"#304ffe"},sm=hP,mP={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},om=mP,fP={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},rm=fP,pP={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},Im=pP,BP={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#d5d5d5",A200:"#aaaaaa",A400:"#303030",A700:"#616161"},am=BP;function lm(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.min(Math.max(e,t),n)}function bP(t){t=t.substr(1);var e=new RegExp(".{1,".concat(t.length>=6?2:1,"}"),"g"),n=t.match(e);return n&&n[0].length===1&&(n=n.map(function(i){return i+i})),n?"rgb".concat(n.length===4?"a":"","(").concat(n.map(function(i,g){return g<3?parseInt(i,16):Math.round(parseInt(i,16)/255*1e3)/1e3}).join(", "),")"):""}function yP(t){t=ms(t);var e=t,n=e.values,i=n[0],g=n[1]/100,s=n[2]/100,o=g*Math.min(s,1-s),r=function(C){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(C+i/30)%12;return s-o*Math.max(Math.min(c-3,9-c,1),-1)},I="rgb",a=[Math.round(r(0)*255),Math.round(r(8)*255),Math.round(r(4)*255)];return t.type==="hsla"&&(I+="a",a.push(n[3])),Bc({type:I,values:a})}function ms(t){if(t.type)return t;if(t.charAt(0)==="#")return ms(bP(t));var e=t.indexOf("("),n=t.substring(0,e);if(["rgb","rgba","hsl","hsla"].indexOf(n)===-1)throw new Error(Pr(3,t));var i=t.substring(e+1,t.length-1).split(",");return i=i.map(function(g){return parseFloat(g)}),{type:n,values:i}}function Bc(t){var e=t.type,n=t.values;return e.indexOf("rgb")!==-1?n=n.map(function(i,g){return g<3?parseInt(i,10):i}):e.indexOf("hsl")!==-1&&(n[1]="".concat(n[1],"%"),n[2]="".concat(n[2],"%")),"".concat(e,"(").concat(n.join(", "),")")}function vP(t,e){var n=hR(t),i=hR(e);return(Math.max(n,i)+.05)/(Math.min(n,i)+.05)}function hR(t){t=ms(t);var e=t.type==="hsl"?ms(yP(t)).values:t.values;return e=e.map(function(n){return n/=255,n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4)}),Number((.2126*e[0]+.7152*e[1]+.0722*e[2]).toFixed(3))}function Wg(t,e){return t=ms(t),e=lm(e),(t.type==="rgb"||t.type==="hsl")&&(t.type+="a"),t.values[3]=e,Bc(t)}function mR(t,e){if(t=ms(t),e=lm(e),t.type.indexOf("hsl")!==-1)t.values[2]*=1-e;else if(t.type.indexOf("rgb")!==-1)for(var n=0;n<3;n+=1)t.values[n]*=1-e;return Bc(t)}function fR(t,e){if(t=ms(t),e=lm(e),t.type.indexOf("hsl")!==-1)t.values[2]+=(100-t.values[2])*e;else if(t.type.indexOf("rgb")!==-1)for(var n=0;n<3;n+=1)t.values[n]+=(255-t.values[n])*e;return Bc(t)}var Ng=["xs","sm","md","lg","xl"];function GP(t){var e=t.values,n=e===void 0?{xs:0,sm:600,md:960,lg:1280,xl:1920}:e,i=t.unit,g=i===void 0?"px":i,s=t.step,o=s===void 0?5:s,r=Ve(t,["values","unit","step"]);function I(A){var d=typeof n[A]=="number"?n[A]:A;return"@media (min-width:".concat(d).concat(g,")")}function a(A){var d=Ng.indexOf(A)+1,m=n[Ng[d]];if(d===Ng.length)return I("xs");var u=typeof m=="number"&&d>0?m:A;return"@media (max-width:".concat(u-o/100).concat(g,")")}function l(A,d){var m=Ng.indexOf(d);return m===Ng.length-1?I(A):"@media (min-width:".concat(typeof n[A]=="number"?n[A]:A).concat(g,") and ")+"(max-width:".concat((m!==-1&&typeof n[Ng[m+1]]=="number"?n[Ng[m+1]]:d)-o/100).concat(g,")")}function C(A){return l(A,A)}function c(A){return n[A]}return L({keys:Ng,values:n,up:I,down:a,between:l,only:C,width:c},r)}function ZP(t,e,n){var i;return L({gutters:function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return console.warn(["Material-UI: theme.mixins.gutters() is deprecated.","You can use the source of the mixin directly:",`
      paddingLeft: theme.spacing(2),
      paddingRight: theme.spacing(2),
      [theme.breakpoints.up('sm')]: {
        paddingLeft: theme.spacing(3),
        paddingRight: theme.spacing(3),
      },
      `].join(`
`)),L({paddingLeft:e(2),paddingRight:e(2)},s,te({},t.up("sm"),L({paddingLeft:e(3),paddingRight:e(3)},s[t.up("sm")])))},toolbar:(i={minHeight:56},te(i,"".concat(t.up("xs")," and (orientation: landscape)"),{minHeight:48}),te(i,t.up("sm"),{minHeight:64}),i)},n)}var pR={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.54)",disabled:"rgba(0, 0, 0, 0.38)",hint:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:pc.white,default:am[50]},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},Cm={text:{primary:pc.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",hint:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:am[800],default:"#303030"},action:{active:pc.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function BR(t,e,n,i){var g=i.light||i,s=i.dark||i*1.5;t[e]||(t.hasOwnProperty(n)?t[e]=t[n]:e==="light"?t.light=fR(t.main,g):e==="dark"&&(t.dark=mR(t.main,s)))}function RP(t){var e=t.primary,n=e===void 0?{light:sm[300],main:sm[500],dark:sm[700]}:e,i=t.secondary,g=i===void 0?{light:gm.A200,main:gm.A400,dark:gm.A700}:i,s=t.error,o=s===void 0?{light:im[300],main:im[500],dark:im[700]}:s,r=t.warning,I=r===void 0?{light:Im[300],main:Im[500],dark:Im[700]}:r,a=t.info,l=a===void 0?{light:om[300],main:om[500],dark:om[700]}:a,C=t.success,c=C===void 0?{light:rm[300],main:rm[500],dark:rm[700]}:C,A=t.type,d=A===void 0?"light":A,m=t.contrastThreshold,u=m===void 0?3:m,h=t.tonalOffset,f=h===void 0?.2:h,p=Ve(t,["primary","secondary","error","warning","info","success","type","contrastThreshold","tonalOffset"]);function b(x){var V=vP(x,Cm.text.primary)>=u?Cm.text.primary:pR.text.primary;return V}var Z=function(V){var E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:500,D=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,_=arguments.length>3&&arguments[3]!==void 0?arguments[3]:700;if(V=L({},V),!V.main&&V[E]&&(V.main=V[E]),!V.main)throw new Error(Pr(4,E));if(typeof V.main!="string")throw new Error(Pr(5,JSON.stringify(V.main)));return BR(V,"light",D,f),BR(V,"dark",_,f),V.contrastText||(V.contrastText=b(V.main)),V},v={dark:Cm,light:pR},N=no(L({common:pc,type:d,primary:Z(n),secondary:Z(g,"A400","A200","A700"),error:Z(o),warning:Z(I),info:Z(l),success:Z(c),grey:am,contrastThreshold:u,getContrastText:b,augmentColor:Z,tonalOffset:f},v[d]),p);return N}function bR(t){return Math.round(t*1e5)/1e5}function FP(t){return bR(t)}var yR={textTransform:"uppercase"},vR='"Roboto", "Helvetica", "Arial", sans-serif';function SP(t,e){var n=typeof e=="function"?e(t):e,i=n.fontFamily,g=i===void 0?vR:i,s=n.fontSize,o=s===void 0?14:s,r=n.fontWeightLight,I=r===void 0?300:r,a=n.fontWeightRegular,l=a===void 0?400:a,C=n.fontWeightMedium,c=C===void 0?500:C,A=n.fontWeightBold,d=A===void 0?700:A,m=n.htmlFontSize,u=m===void 0?16:m,h=n.allVariants,f=n.pxToRem,p=Ve(n,["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"]),b=o/14,Z=f||function(x){return"".concat(x/u*b,"rem")},v=function(V,E,D,_,k){return L({fontFamily:g,fontWeight:V,fontSize:Z(E),lineHeight:D},g===vR?{letterSpacing:"".concat(bR(_/E),"em")}:{},k,h)},N={h1:v(I,96,1.167,-1.5),h2:v(I,60,1.2,-.5),h3:v(l,48,1.167,0),h4:v(l,34,1.235,.25),h5:v(l,24,1.334,0),h6:v(c,20,1.6,.15),subtitle1:v(l,16,1.75,.15),subtitle2:v(c,14,1.57,.1),body1:v(l,16,1.5,.15),body2:v(l,14,1.43,.15),button:v(c,14,1.75,.4,yR),caption:v(l,12,1.66,.4),overline:v(l,12,2.66,1,yR)};return no(L({htmlFontSize:u,pxToRem:Z,round:FP,fontFamily:g,fontSize:o,fontWeightLight:I,fontWeightRegular:l,fontWeightMedium:c,fontWeightBold:d},N),p,{clone:!1})}var VP=.2,UP=.14,xP=.12;function Oe(){return["".concat(arguments.length<=0?void 0:arguments[0],"px ").concat(arguments.length<=1?void 0:arguments[1],"px ").concat(arguments.length<=2?void 0:arguments[2],"px ").concat(arguments.length<=3?void 0:arguments[3],"px rgba(0,0,0,").concat(VP,")"),"".concat(arguments.length<=4?void 0:arguments[4],"px ").concat(arguments.length<=5?void 0:arguments[5],"px ").concat(arguments.length<=6?void 0:arguments[6],"px ").concat(arguments.length<=7?void 0:arguments[7],"px rgba(0,0,0,").concat(UP,")"),"".concat(arguments.length<=8?void 0:arguments[8],"px ").concat(arguments.length<=9?void 0:arguments[9],"px ").concat(arguments.length<=10?void 0:arguments[10],"px ").concat(arguments.length<=11?void 0:arguments[11],"px rgba(0,0,0,").concat(xP,")")].join(",")}var WP=["none",Oe(0,2,1,-1,0,1,1,0,0,1,3,0),Oe(0,3,1,-2,0,2,2,0,0,1,5,0),Oe(0,3,3,-2,0,3,4,0,0,1,8,0),Oe(0,2,4,-1,0,4,5,0,0,1,10,0),Oe(0,3,5,-1,0,5,8,0,0,1,14,0),Oe(0,3,5,-1,0,6,10,0,0,1,18,0),Oe(0,4,5,-2,0,7,10,1,0,2,16,1),Oe(0,5,5,-3,0,8,10,1,0,3,14,2),Oe(0,5,6,-3,0,9,12,1,0,3,16,2),Oe(0,6,6,-3,0,10,14,1,0,4,18,3),Oe(0,6,7,-4,0,11,15,1,0,4,20,3),Oe(0,7,8,-4,0,12,17,2,0,5,22,4),Oe(0,7,8,-4,0,13,19,2,0,5,24,4),Oe(0,7,9,-4,0,14,21,2,0,5,26,4),Oe(0,8,9,-5,0,15,22,2,0,6,28,5),Oe(0,8,10,-5,0,16,24,2,0,6,30,5),Oe(0,8,11,-5,0,17,26,2,0,6,32,5),Oe(0,9,11,-5,0,18,28,2,0,7,34,6),Oe(0,9,12,-6,0,19,29,2,0,7,36,6),Oe(0,10,13,-6,0,20,31,3,0,8,38,7),Oe(0,10,13,-6,0,21,33,3,0,8,40,7),Oe(0,10,14,-6,0,22,35,3,0,8,42,7),Oe(0,11,14,-7,0,23,36,3,0,9,44,8),Oe(0,11,15,-7,0,24,38,3,0,9,46,8)],NP=WP,wP={borderRadius:4},TP=wP;function GR(t){if(Array.isArray(t))return t}function EP(t,e){var n=t==null?null:typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var i=[],g=!0,s=!1,o,r;try{for(n=n.call(t);!(g=(o=n.next()).done)&&(i.push(o.value),!(e&&i.length===e));g=!0);}catch(I){s=!0,r=I}finally{try{!g&&n.return!=null&&n.return()}finally{if(s)throw r}}return i}}function ZR(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bc(t,e){return GR(t)||EP(t,e)||bu(t,e)||ZR()}function QP(t){var e=t.spacing||8;return typeof e=="number"?function(n){return e*n}:Array.isArray(e)?function(n){return e[n]}:typeof e=="function"?e:function(){}}function XP(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:8;if(t.mui)return t;var e=QP({spacing:t}),n=function(){for(var g=arguments.length,s=new Array(g),o=0;o<g;o++)s[o]=arguments[o];return s.length===0?e(1):s.length===1?e(s[0]):s.map(function(r){if(typeof r=="string")return r;var I=e(r);return typeof I=="number"?"".concat(I,"px"):I}).join(" ")};return Object.defineProperty(n,"unit",{get:function(){return t}}),n.mui=!0,n}var RR={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},cm={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function FR(t){return"".concat(Math.round(t),"ms")}var YP={easing:RR,duration:cm,create:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:["all"],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.duration,g=i===void 0?cm.standard:i,s=n.easing,o=s===void 0?RR.easeInOut:s,r=n.delay,I=r===void 0?0:r;return Ve(n,["duration","easing","delay"]),(Array.isArray(e)?e:[e]).map(function(a){return"".concat(a," ").concat(typeof g=="string"?g:FR(g)," ").concat(o," ").concat(typeof I=="string"?I:FR(I))}).join(",")},getAutoHeightDuration:function(e){if(!e)return 0;var n=e/36;return Math.round((4+15*Math.pow(n,.25)+n/5)*10)}},_P={mobileStepper:1e3,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},SR=_P;function HP(){for(var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.breakpoints,n=e===void 0?{}:e,i=t.mixins,g=i===void 0?{}:i,s=t.palette,o=s===void 0?{}:s,r=t.spacing,I=t.typography,a=I===void 0?{}:I,l=Ve(t,["breakpoints","mixins","palette","spacing","typography"]),C=RP(o),c=GP(n),A=XP(r),d=no({breakpoints:c,direction:"ltr",mixins:ZP(c,A,g),overrides:{},palette:C,props:{},shadows:NP,typography:SP(C,a),spacing:A,shape:TP,transitions:YP,zIndex:SR},l),m=arguments.length,u=new Array(m>1?m-1:0),h=1;h<m;h++)u[h-1]=arguments[h];return d=u.reduce(function(f,p){return no(f,p)},d),d}var kP=HP(),VR=kP;function Am(){var t=aI()||VR;return t}function Bt(t,e){return a9(t,L({defaultTheme:VR},e))}function Ln(t){if(typeof t!="string")throw new Error(Pr(7));return t.charAt(0).toUpperCase()+t.slice(1)}function dm(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.reduce(function(i,g){return g==null?i:function(){for(var o=arguments.length,r=new Array(o),I=0;I<o;I++)r[I]=arguments[I];i.apply(this,r),g.apply(this,r)}},function(){})}var KP=function(e){return{root:{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:"currentColor",flexShrink:0,fontSize:e.typography.pxToRem(24),transition:e.transitions.create("fill",{duration:e.transitions.duration.shorter})},colorPrimary:{color:e.palette.primary.main},colorSecondary:{color:e.palette.secondary.main},colorAction:{color:e.palette.action.active},colorError:{color:e.palette.error.main},colorDisabled:{color:e.palette.action.disabled},fontSizeInherit:{fontSize:"inherit"},fontSizeSmall:{fontSize:e.typography.pxToRem(20)},fontSizeLarge:{fontSize:e.typography.pxToRem(35)}}},UR=G.exports.forwardRef(function(e,n){var i=e.children,g=e.classes,s=e.className,o=e.color,r=o===void 0?"inherit":o,I=e.component,a=I===void 0?"svg":I,l=e.fontSize,C=l===void 0?"medium":l,c=e.htmlColor,A=e.titleAccess,d=e.viewBox,m=d===void 0?"0 0 24 24":d,u=Ve(e,["children","classes","className","color","component","fontSize","htmlColor","titleAccess","viewBox"]);return G.exports.createElement(a,L({className:Ue(g.root,s,r!=="inherit"&&g["color".concat(Ln(r))],C!=="default"&&C!=="medium"&&g["fontSize".concat(Ln(C))]),focusable:"false",viewBox:m,color:c,"aria-hidden":A?void 0:!0,role:A?"img":void 0,ref:n},u),i,A?G.exports.createElement("title",null,A):null)});UR.muiName="SvgIcon";var xR=Bt(KP,{name:"MuiSvgIcon"})(UR);function Qi(t,e){var n=function(g,s){return we.createElement(xR,L({ref:s},g),t)};return n.muiName=xR.muiName,we.memo(we.forwardRef(n))}function WR(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:166,n;function i(){for(var g=arguments.length,s=new Array(g),o=0;o<g;o++)s[o]=arguments[o];var r=this,I=function(){t.apply(r,s)};clearTimeout(n),n=setTimeout(I,e)}return i.clear=function(){clearTimeout(n)},i}function Mn(t){return t&&t.ownerDocument||document}function NR(t){var e=Mn(t);return e.defaultView||window}function yc(t,e){typeof t=="function"?t(e):t&&(t.current=e)}function wR(t){var e=t.controlled,n=t.default;t.name,t.state;var i=G.exports.useRef(e!==void 0),g=i.current,s=G.exports.useState(n),o=s[0],r=s[1],I=g?e:o,a=G.exports.useCallback(function(l){g||r(l)},[]);return[I,a]}var LP=typeof window!="undefined"?G.exports.useLayoutEffect:G.exports.useEffect;function Yt(t){var e=G.exports.useRef(t);return LP(function(){e.current=t}),G.exports.useCallback(function(){return e.current.apply(void 0,arguments)},[])}function Jt(t,e){return G.exports.useMemo(function(){return t==null&&e==null?null:function(n){yc(t,n),yc(e,n)}},[t,e])}var vc=!0,um=!1,TR=null,MP={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function PP(t){var e=t.type,n=t.tagName;return!!(n==="INPUT"&&MP[e]&&!t.readOnly||n==="TEXTAREA"&&!t.readOnly||t.isContentEditable)}function JP(t){t.metaKey||t.altKey||t.ctrlKey||(vc=!0)}function hm(){vc=!1}function DP(){this.visibilityState==="hidden"&&um&&(vc=!0)}function zP(t){t.addEventListener("keydown",JP,!0),t.addEventListener("mousedown",hm,!0),t.addEventListener("pointerdown",hm,!0),t.addEventListener("touchstart",hm,!0),t.addEventListener("visibilitychange",DP,!0)}function OP(t){var e=t.target;try{return e.matches(":focus-visible")}catch{}return vc||PP(e)}function jP(){um=!0,window.clearTimeout(TR),TR=window.setTimeout(function(){um=!1},100)}function ER(){var t=G.exports.useCallback(function(e){var n=hi.exports.findDOMNode(e);n!=null&&zP(n.ownerDocument)},[]);return{isFocusVisible:OP,onBlurVisible:jP,ref:t}}function qP(t){return GR(t)||Ub(t)||bu(t)||ZR()}var QR={disabled:!1},Gc=we.createContext(null),oa="unmounted",fs="exited",ps="entering",Ho="entered",mm="exiting",Xi=function(t){Rl(e,t);function e(i,g){var s;s=t.call(this,i,g)||this;var o=g,r=o&&!o.isMounting?i.enter:i.appear,I;return s.appearStatus=null,i.in?r?(I=fs,s.appearStatus=ps):I=Ho:i.unmountOnExit||i.mountOnEnter?I=oa:I=fs,s.state={status:I},s.nextCallback=null,s}e.getDerivedStateFromProps=function(g,s){var o=g.in;return o&&s.status===oa?{status:fs}:null};var n=e.prototype;return n.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},n.componentDidUpdate=function(g){var s=null;if(g!==this.props){var o=this.state.status;this.props.in?o!==ps&&o!==Ho&&(s=ps):(o===ps||o===Ho)&&(s=mm)}this.updateStatus(!1,s)},n.componentWillUnmount=function(){this.cancelNextCallback()},n.getTimeouts=function(){var g=this.props.timeout,s,o,r;return s=o=r=g,g!=null&&typeof g!="number"&&(s=g.exit,o=g.enter,r=g.appear!==void 0?g.appear:o),{exit:s,enter:o,appear:r}},n.updateStatus=function(g,s){g===void 0&&(g=!1),s!==null?(this.cancelNextCallback(),s===ps?this.performEnter(g):this.performExit()):this.props.unmountOnExit&&this.state.status===fs&&this.setState({status:oa})},n.performEnter=function(g){var s=this,o=this.props.enter,r=this.context?this.context.isMounting:g,I=this.props.nodeRef?[r]:[Dd.findDOMNode(this),r],a=I[0],l=I[1],C=this.getTimeouts(),c=r?C.appear:C.enter;if(!g&&!o||QR.disabled){this.safeSetState({status:Ho},function(){s.props.onEntered(a)});return}this.props.onEnter(a,l),this.safeSetState({status:ps},function(){s.props.onEntering(a,l),s.onTransitionEnd(c,function(){s.safeSetState({status:Ho},function(){s.props.onEntered(a,l)})})})},n.performExit=function(){var g=this,s=this.props.exit,o=this.getTimeouts(),r=this.props.nodeRef?void 0:Dd.findDOMNode(this);if(!s||QR.disabled){this.safeSetState({status:fs},function(){g.props.onExited(r)});return}this.props.onExit(r),this.safeSetState({status:mm},function(){g.props.onExiting(r),g.onTransitionEnd(o.exit,function(){g.safeSetState({status:fs},function(){g.props.onExited(r)})})})},n.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},n.safeSetState=function(g,s){s=this.setNextCallback(s),this.setState(g,s)},n.setNextCallback=function(g){var s=this,o=!0;return this.nextCallback=function(r){o&&(o=!1,s.nextCallback=null,g(r))},this.nextCallback.cancel=function(){o=!1},this.nextCallback},n.onTransitionEnd=function(g,s){this.setNextCallback(s);var o=this.props.nodeRef?this.props.nodeRef.current:Dd.findDOMNode(this),r=g==null&&!this.props.addEndListener;if(!o||r){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var I=this.props.nodeRef?[this.nextCallback]:[o,this.nextCallback],a=I[0],l=I[1];this.props.addEndListener(a,l)}g!=null&&setTimeout(this.nextCallback,g)},n.render=function(){var g=this.state.status;if(g===oa)return null;var s=this.props,o=s.children;s.in,s.mountOnEnter,s.unmountOnExit,s.appear,s.enter,s.exit,s.timeout,s.addEndListener,s.onEnter,s.onEntering,s.onEntered,s.onExit,s.onExiting,s.onExited,s.nodeRef;var r=Fl(s,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return we.createElement(Gc.Provider,{value:null},typeof o=="function"?o(g,r):we.cloneElement(we.Children.only(o),r))},e}(we.Component);Xi.contextType=Gc;Xi.propTypes={};function ko(){}Xi.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:ko,onEntering:ko,onEntered:ko,onExit:ko,onExiting:ko,onExited:ko};Xi.UNMOUNTED=oa;Xi.EXITED=fs;Xi.ENTERING=ps;Xi.ENTERED=Ho;Xi.EXITING=mm;var XR=Xi;function fm(t,e){var n=function(s){return e&&G.exports.isValidElement(s)?e(s):s},i=Object.create(null);return t&&G.exports.Children.map(t,function(g){return g}).forEach(function(g){i[g.key]=n(g)}),i}function $P(t,e){t=t||{},e=e||{};function n(l){return l in e?e[l]:t[l]}var i=Object.create(null),g=[];for(var s in t)s in e?g.length&&(i[s]=g,g=[]):g.push(s);var o,r={};for(var I in e){if(i[I])for(o=0;o<i[I].length;o++){var a=i[I][o];r[i[I][o]]=n(a)}r[I]=n(I)}for(o=0;o<g.length;o++)r[g[o]]=n(g[o]);return r}function Bs(t,e,n){return n[e]!=null?n[e]:t.props[e]}function eJ(t,e){return fm(t.children,function(n){return G.exports.cloneElement(n,{onExited:e.bind(null,n),in:!0,appear:Bs(n,"appear",t),enter:Bs(n,"enter",t),exit:Bs(n,"exit",t)})})}function tJ(t,e,n){var i=fm(t.children),g=$P(e,i);return Object.keys(g).forEach(function(s){var o=g[s];if(!!G.exports.isValidElement(o)){var r=s in e,I=s in i,a=e[s],l=G.exports.isValidElement(a)&&!a.props.in;I&&(!r||l)?g[s]=G.exports.cloneElement(o,{onExited:n.bind(null,o),in:!0,exit:Bs(o,"exit",t),enter:Bs(o,"enter",t)}):!I&&r&&!l?g[s]=G.exports.cloneElement(o,{in:!1}):I&&r&&G.exports.isValidElement(a)&&(g[s]=G.exports.cloneElement(o,{onExited:n.bind(null,o),in:a.props.in,exit:Bs(o,"exit",t),enter:Bs(o,"enter",t)}))}}),g}var nJ=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})},iJ={component:"div",childFactory:function(e){return e}},pm=function(t){Rl(e,t);function e(i,g){var s;s=t.call(this,i,g)||this;var o=s.handleExited.bind(gu(s));return s.state={contextValue:{isMounting:!0},handleExited:o,firstRender:!0},s}var n=e.prototype;return n.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},n.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(g,s){var o=s.children,r=s.handleExited,I=s.firstRender;return{children:I?eJ(g,r):tJ(g,o,r),firstRender:!1}},n.handleExited=function(g,s){var o=fm(this.props.children);g.key in o||(g.props.onExited&&g.props.onExited(s),this.mounted&&this.setState(function(r){var I=L({},r.children);return delete I[g.key],{children:I}}))},n.render=function(){var g=this.props,s=g.component,o=g.childFactory,r=Fl(g,["component","childFactory"]),I=this.state.contextValue,a=nJ(this.state.children).map(o);return delete r.appear,delete r.enter,delete r.exit,s===null?we.createElement(Gc.Provider,{value:I},a):we.createElement(Gc.Provider,{value:I},we.createElement(s,r,a))},e}(we.Component);pm.propTypes={};pm.defaultProps=iJ;var gJ=pm,sJ=function(e){return e.scrollTop};function Zc(t,e){var n=t.timeout,i=t.style,g=i===void 0?{}:i;return{duration:g.transitionDuration||typeof n=="number"?n:n[e.mode]||0,delay:g.transitionDelay}}var oJ=function(e){return{root:{height:0,overflow:"hidden",transition:e.transitions.create("height")},entered:{height:"auto",overflow:"visible"},hidden:{visibility:"hidden"},wrapper:{display:"flex"},wrapperInner:{width:"100%"}}},YR=G.exports.forwardRef(function(e,n){var i=e.children,g=e.classes,s=e.className,o=e.collapsedHeight,r=e.collapsedSize,I=r===void 0?"0px":r,a=e.component,l=a===void 0?"div":a,C=e.disableStrictModeCompat,c=C===void 0?!1:C,A=e.in,d=e.onEnter,m=e.onEntered,u=e.onEntering,h=e.onExit,f=e.onExited,p=e.onExiting,b=e.style,Z=e.timeout,v=Z===void 0?cm.standard:Z,N=e.TransitionComponent,x=N===void 0?XR:N,V=Ve(e,["children","classes","className","collapsedHeight","collapsedSize","component","disableStrictModeCompat","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"]),E=Am(),D=G.exports.useRef(),_=G.exports.useRef(null),k=G.exports.useRef(),z=typeof(o||I)=="number"?"".concat(o||I,"px"):o||I;G.exports.useEffect(function(){return function(){clearTimeout(D.current)}},[]);var ee=E.unstable_strictMode&&!c,Ie=G.exports.useRef(null),he=Jt(n,ee?Ie:void 0),ge=function(P){return function(oe,ne){if(P){var me=ee?[Ie.current,oe]:[oe,ne],ae=bc(me,2),be=ae[0],Ze=ae[1];Ze===void 0?P(be):P(be,Ze)}}},Ae=ge(function(H,P){H.style.height=z,d&&d(H,P)}),U=ge(function(H,P){var oe=_.current?_.current.clientHeight:0,ne=Zc({style:b,timeout:v},{mode:"enter"}),me=ne.duration;if(v==="auto"){var ae=E.transitions.getAutoHeightDuration(oe);H.style.transitionDuration="".concat(ae,"ms"),k.current=ae}else H.style.transitionDuration=typeof me=="string"?me:"".concat(me,"ms");H.style.height="".concat(oe,"px"),u&&u(H,P)}),F=ge(function(H,P){H.style.height="auto",m&&m(H,P)}),W=ge(function(H){var P=_.current?_.current.clientHeight:0;H.style.height="".concat(P,"px"),h&&h(H)}),T=ge(f),Y=ge(function(H){var P=_.current?_.current.clientHeight:0,oe=Zc({style:b,timeout:v},{mode:"exit"}),ne=oe.duration;if(v==="auto"){var me=E.transitions.getAutoHeightDuration(P);H.style.transitionDuration="".concat(me,"ms"),k.current=me}else H.style.transitionDuration=typeof ne=="string"?ne:"".concat(ne,"ms");H.style.height=z,p&&p(H)}),Q=function(P,oe){var ne=ee?P:oe;v==="auto"&&(D.current=setTimeout(ne,k.current||0))};return G.exports.createElement(x,L({in:A,onEnter:Ae,onEntered:F,onEntering:U,onExit:W,onExited:T,onExiting:Y,addEndListener:Q,nodeRef:ee?Ie:void 0,timeout:v==="auto"?null:v},V),function(H,P){return G.exports.createElement(l,L({className:Ue(g.root,g.container,s,{entered:g.entered,exited:!A&&z==="0px"&&g.hidden}[H]),style:L({minHeight:z},b),ref:he},P),G.exports.createElement("div",{className:g.wrapper,ref:_},G.exports.createElement("div",{className:g.wrapperInner},i)))})});YR.muiSupportAuto=!0;var rJ=Bt(oJ,{name:"MuiCollapse"})(YR),IJ=function(e){var n={};return e.shadows.forEach(function(i,g){n["elevation".concat(g)]={boxShadow:i}}),L({root:{backgroundColor:e.palette.background.paper,color:e.palette.text.primary,transition:e.transitions.create("box-shadow")},rounded:{borderRadius:e.shape.borderRadius},outlined:{border:"1px solid ".concat(e.palette.divider)}},n)},aJ=G.exports.forwardRef(function(e,n){var i=e.classes,g=e.className,s=e.component,o=s===void 0?"div":s,r=e.square,I=r===void 0?!1:r,a=e.elevation,l=a===void 0?1:a,C=e.variant,c=C===void 0?"elevation":C,A=Ve(e,["classes","className","component","square","elevation","variant"]);return G.exports.createElement(o,L({className:Ue(i.root,g,c==="outlined"?i.outlined:i["elevation".concat(l)],!I&&i.rounded),ref:n},A))}),_R=Bt(IJ,{name:"MuiPaper"})(aJ),lJ=G.exports.createContext({}),HR=lJ,CJ=function(e){var n={duration:e.transitions.duration.shortest};return{root:{position:"relative",transition:e.transitions.create(["margin"],n),"&:before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:e.palette.divider,transition:e.transitions.create(["opacity","background-color"],n)},"&:first-child":{"&:before":{display:"none"}},"&$expanded":{margin:"16px 0","&:first-child":{marginTop:0},"&:last-child":{marginBottom:0},"&:before":{opacity:0}},"&$expanded + &":{"&:before":{display:"none"}},"&$disabled":{backgroundColor:e.palette.action.disabledBackground}},rounded:{borderRadius:0,"&:first-child":{borderTopLeftRadius:e.shape.borderRadius,borderTopRightRadius:e.shape.borderRadius},"&:last-child":{borderBottomLeftRadius:e.shape.borderRadius,borderBottomRightRadius:e.shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}},expanded:{},disabled:{}}},cJ=G.exports.forwardRef(function(e,n){var i=e.children,g=e.classes,s=e.className,o=e.defaultExpanded,r=o===void 0?!1:o,I=e.disabled,a=I===void 0?!1:I,l=e.expanded,C=e.onChange,c=e.square,A=c===void 0?!1:c,d=e.TransitionComponent,m=d===void 0?rJ:d,u=e.TransitionProps,h=Ve(e,["children","classes","className","defaultExpanded","disabled","expanded","onChange","square","TransitionComponent","TransitionProps"]),f=wR({controlled:l,default:r,name:"Accordion",state:"expanded"}),p=bc(f,2),b=p[0],Z=p[1],v=G.exports.useCallback(function(_){Z(!b),C&&C(_,!b)},[b,C,Z]),N=G.exports.Children.toArray(i),x=qP(N),V=x[0],E=x.slice(1),D=G.exports.useMemo(function(){return{expanded:b,disabled:a,toggle:v}},[b,a,v]);return G.exports.createElement(_R,L({className:Ue(g.root,s,b&&g.expanded,a&&g.disabled,!A&&g.rounded),ref:n,square:A},h),G.exports.createElement(HR.Provider,{value:D},V),G.exports.createElement(m,L({in:b,timeout:"auto"},u),G.exports.createElement("div",{"aria-labelledby":V.props.id,id:V.props["aria-controls"],role:"region"},E)))}),$D=Bt(CJ,{name:"MuiAccordion"})(cJ),AJ=function(e){return{root:{display:"flex",padding:e.spacing(1,2,2)}}},dJ=G.exports.forwardRef(function(e,n){var i=e.classes,g=e.className,s=Ve(e,["classes","className"]);return G.exports.createElement("div",L({className:Ue(i.root,g),ref:n},s))}),ez=Bt(AJ,{name:"MuiAccordionDetails"})(dJ),uJ=typeof window=="undefined"?G.exports.useEffect:G.exports.useLayoutEffect;function hJ(t){var e=t.classes,n=t.pulsate,i=n===void 0?!1:n,g=t.rippleX,s=t.rippleY,o=t.rippleSize,r=t.in,I=t.onExited,a=I===void 0?function(){}:I,l=t.timeout,C=G.exports.useState(!1),c=C[0],A=C[1],d=Ue(e.ripple,e.rippleVisible,i&&e.ripplePulsate),m={width:o,height:o,top:-(o/2)+s,left:-(o/2)+g},u=Ue(e.child,c&&e.childLeaving,i&&e.childPulsate),h=Yt(a);return uJ(function(){if(!r){A(!0);var f=setTimeout(h,l);return function(){clearTimeout(f)}}},[h,r,l]),G.exports.createElement("span",{className:d,style:m},G.exports.createElement("span",{className:u}))}var Bm=550,mJ=80,fJ=function(e){return{root:{overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"},ripple:{opacity:0,position:"absolute"},rippleVisible:{opacity:.3,transform:"scale(1)",animation:"$enter ".concat(Bm,"ms ").concat(e.transitions.easing.easeInOut)},ripplePulsate:{animationDuration:"".concat(e.transitions.duration.shorter,"ms")},child:{opacity:1,display:"block",width:"100%",height:"100%",borderRadius:"50%",backgroundColor:"currentColor"},childLeaving:{opacity:0,animation:"$exit ".concat(Bm,"ms ").concat(e.transitions.easing.easeInOut)},childPulsate:{position:"absolute",left:0,top:0,animation:"$pulsate 2500ms ".concat(e.transitions.easing.easeInOut," 200ms infinite")},"@keyframes enter":{"0%":{transform:"scale(0)",opacity:.1},"100%":{transform:"scale(1)",opacity:.3}},"@keyframes exit":{"0%":{opacity:1},"100%":{opacity:0}},"@keyframes pulsate":{"0%":{transform:"scale(1)"},"50%":{transform:"scale(0.92)"},"100%":{transform:"scale(1)"}}}},pJ=G.exports.forwardRef(function(e,n){var i=e.center,g=i===void 0?!1:i,s=e.classes,o=e.className,r=Ve(e,["center","classes","className"]),I=G.exports.useState([]),a=I[0],l=I[1],C=G.exports.useRef(0),c=G.exports.useRef(null);G.exports.useEffect(function(){c.current&&(c.current(),c.current=null)},[a]);var A=G.exports.useRef(!1),d=G.exports.useRef(null),m=G.exports.useRef(null),u=G.exports.useRef(null);G.exports.useEffect(function(){return function(){clearTimeout(d.current)}},[]);var h=G.exports.useCallback(function(Z){var v=Z.pulsate,N=Z.rippleX,x=Z.rippleY,V=Z.rippleSize,E=Z.cb;l(function(D){return[].concat(xl(D),[G.exports.createElement(hJ,{key:C.current,classes:s,timeout:Bm,pulsate:v,rippleX:N,rippleY:x,rippleSize:V})])}),C.current+=1,c.current=E},[s]),f=G.exports.useCallback(function(){var Z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},N=arguments.length>2?arguments[2]:void 0,x=v.pulsate,V=x===void 0?!1:x,E=v.center,D=E===void 0?g||v.pulsate:E,_=v.fakeElement,k=_===void 0?!1:_;if(Z.type==="mousedown"&&A.current){A.current=!1;return}Z.type==="touchstart"&&(A.current=!0);var z=k?null:u.current,ee=z?z.getBoundingClientRect():{width:0,height:0,left:0,top:0},Ie,he,ge;if(D||Z.clientX===0&&Z.clientY===0||!Z.clientX&&!Z.touches)Ie=Math.round(ee.width/2),he=Math.round(ee.height/2);else{var Ae=Z.touches?Z.touches[0]:Z,U=Ae.clientX,F=Ae.clientY;Ie=Math.round(U-ee.left),he=Math.round(F-ee.top)}if(D)ge=Math.sqrt((2*Math.pow(ee.width,2)+Math.pow(ee.height,2))/3),ge%2==0&&(ge+=1);else{var W=Math.max(Math.abs((z?z.clientWidth:0)-Ie),Ie)*2+2,T=Math.max(Math.abs((z?z.clientHeight:0)-he),he)*2+2;ge=Math.sqrt(Math.pow(W,2)+Math.pow(T,2))}Z.touches?m.current===null&&(m.current=function(){h({pulsate:V,rippleX:Ie,rippleY:he,rippleSize:ge,cb:N})},d.current=setTimeout(function(){m.current&&(m.current(),m.current=null)},mJ)):h({pulsate:V,rippleX:Ie,rippleY:he,rippleSize:ge,cb:N})},[g,h]),p=G.exports.useCallback(function(){f({},{pulsate:!0})},[f]),b=G.exports.useCallback(function(Z,v){if(clearTimeout(d.current),Z.type==="touchend"&&m.current){Z.persist(),m.current(),m.current=null,d.current=setTimeout(function(){b(Z,v)});return}m.current=null,l(function(N){return N.length>0?N.slice(1):N}),c.current=v},[]);return G.exports.useImperativeHandle(n,function(){return{pulsate:p,start:f,stop:b}},[p,f,b]),G.exports.createElement("span",L({className:Ue(s.root,o),ref:u},r),G.exports.createElement(gJ,{component:null,exit:!0},a))}),BJ=Bt(fJ,{flip:!1,name:"MuiTouchRipple"})(G.exports.memo(pJ)),bJ={root:{display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle","-moz-appearance":"none","-webkit-appearance":"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},"&$disabled":{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}},disabled:{},focusVisible:{}},yJ=G.exports.forwardRef(function(e,n){var i=e.action,g=e.buttonRef,s=e.centerRipple,o=s===void 0?!1:s,r=e.children,I=e.classes,a=e.className,l=e.component,C=l===void 0?"button":l,c=e.disabled,A=c===void 0?!1:c,d=e.disableRipple,m=d===void 0?!1:d,u=e.disableTouchRipple,h=u===void 0?!1:u,f=e.focusRipple,p=f===void 0?!1:f,b=e.focusVisibleClassName,Z=e.onBlur,v=e.onClick,N=e.onFocus,x=e.onFocusVisible,V=e.onKeyDown,E=e.onKeyUp,D=e.onMouseDown,_=e.onMouseLeave,k=e.onMouseUp,z=e.onTouchEnd,ee=e.onTouchMove,Ie=e.onTouchStart,he=e.onDragLeave,ge=e.tabIndex,Ae=ge===void 0?0:ge,U=e.TouchRippleProps,F=e.type,W=F===void 0?"button":F,T=Ve(e,["action","buttonRef","centerRipple","children","classes","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","onBlur","onClick","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","onDragLeave","tabIndex","TouchRippleProps","type"]),Y=G.exports.useRef(null);function Q(){return hi.exports.findDOMNode(Y.current)}var H=G.exports.useRef(null),P=G.exports.useState(!1),oe=P[0],ne=P[1];A&&oe&&ne(!1);var me=ER(),ae=me.isFocusVisible,be=me.onBlurVisible,Ze=me.ref;G.exports.useImperativeHandle(i,function(){return{focusVisible:function(){ne(!0),Y.current.focus()}}},[]),G.exports.useEffect(function(){oe&&p&&!m&&H.current.pulsate()},[m,p,oe]);function Be(ue,Dt){var Po=arguments.length>2&&arguments[2]!==void 0?arguments[2]:h;return Yt(function(wg){Dt&&Dt(wg);var hn=Po;return!hn&&H.current&&H.current[ue](wg),!0})}var rt=Be("start",D),le=Be("stop",he),Re=Be("stop",k),Vt=Be("stop",function(ue){oe&&ue.preventDefault(),_&&_(ue)}),$e=Be("start",Ie),et=Be("stop",z),xe=Be("stop",ee),Ge=Be("stop",function(ue){oe&&(be(ue),ne(!1)),Z&&Z(ue)},!1),Qe=Yt(function(ue){Y.current||(Y.current=ue.currentTarget),ae(ue)&&(ne(!0),x&&x(ue)),N&&N(ue)}),Je=function(){var Dt=Q();return C&&C!=="button"&&!(Dt.tagName==="A"&&Dt.href)},_t=G.exports.useRef(!1),Ut=Yt(function(ue){p&&!_t.current&&oe&&H.current&&ue.key===" "&&(_t.current=!0,ue.persist(),H.current.stop(ue,function(){H.current.start(ue)})),ue.target===ue.currentTarget&&Je()&&ue.key===" "&&ue.preventDefault(),V&&V(ue),ue.target===ue.currentTarget&&Je()&&ue.key==="Enter"&&!A&&(ue.preventDefault(),v&&v(ue))}),Yi=Yt(function(ue){p&&ue.key===" "&&H.current&&oe&&!ue.defaultPrevented&&(_t.current=!1,ue.persist(),H.current.stop(ue,function(){H.current.pulsate(ue)})),E&&E(ue),v&&ue.target===ue.currentTarget&&Je()&&ue.key===" "&&!ue.defaultPrevented&&v(ue)}),at=C;at==="button"&&T.href&&(at="a");var Se={};at==="button"?(Se.type=W,Se.disabled=A):((at!=="a"||!T.href)&&(Se.role="button"),Se["aria-disabled"]=A);var Sn=Jt(g,n),gt=Jt(Ze,Y),Vn=Jt(Sn,gt),Un=G.exports.useState(!1),Ko=Un[0],Lo=Un[1];G.exports.useEffect(function(){Lo(!0)},[]);var Mo=Ko&&!m&&!A;return G.exports.createElement(at,L({className:Ue(I.root,a,oe&&[I.focusVisible,b],A&&I.disabled),onBlur:Ge,onClick:v,onFocus:Qe,onKeyDown:Ut,onKeyUp:Yi,onMouseDown:rt,onMouseLeave:Vt,onMouseUp:Re,onDragLeave:le,onTouchEnd:et,onTouchMove:xe,onTouchStart:$e,ref:Vn,tabIndex:A?-1:Ae},Se,T),r,Mo?G.exports.createElement(BJ,L({ref:H,center:o},U)):null)}),kR=Bt(bJ,{name:"MuiButtonBase"})(yJ),vJ=function(e){return{root:{textAlign:"center",flex:"0 0 auto",fontSize:e.typography.pxToRem(24),padding:12,borderRadius:"50%",overflow:"visible",color:e.palette.action.active,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{backgroundColor:Wg(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"&$disabled":{backgroundColor:"transparent",color:e.palette.action.disabled}},edgeStart:{marginLeft:-12,"$sizeSmall&":{marginLeft:-3}},edgeEnd:{marginRight:-12,"$sizeSmall&":{marginRight:-3}},colorInherit:{color:"inherit"},colorPrimary:{color:e.palette.primary.main,"&:hover":{backgroundColor:Wg(e.palette.primary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},colorSecondary:{color:e.palette.secondary.main,"&:hover":{backgroundColor:Wg(e.palette.secondary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},disabled:{},sizeSmall:{padding:3,fontSize:e.typography.pxToRem(18)},label:{width:"100%",display:"flex",alignItems:"inherit",justifyContent:"inherit"}}},GJ=G.exports.forwardRef(function(e,n){var i=e.edge,g=i===void 0?!1:i,s=e.children,o=e.classes,r=e.className,I=e.color,a=I===void 0?"default":I,l=e.disabled,C=l===void 0?!1:l,c=e.disableFocusRipple,A=c===void 0?!1:c,d=e.size,m=d===void 0?"medium":d,u=Ve(e,["edge","children","classes","className","color","disabled","disableFocusRipple","size"]);return G.exports.createElement(kR,L({className:Ue(o.root,r,a!=="default"&&o["color".concat(Ln(a))],C&&o.disabled,m==="small"&&o["size".concat(Ln(m))],{start:o.edgeStart,end:o.edgeEnd}[g]),centerRipple:!0,focusRipple:!A,disabled:C,ref:n},u),G.exports.createElement("span",{className:o.label},s))}),ZJ=Bt(vJ,{name:"MuiIconButton"})(GJ),RJ=function(e){var n={duration:e.transitions.duration.shortest};return{root:{display:"flex",minHeight:8*6,transition:e.transitions.create(["min-height","background-color"],n),padding:e.spacing(0,2),"&:hover:not($disabled)":{cursor:"pointer"},"&$expanded":{minHeight:64},"&$focused, &$focusVisible":{backgroundColor:e.palette.action.focus},"&$disabled":{opacity:e.palette.action.disabledOpacity}},expanded:{},focused:{},focusVisible:{},disabled:{},content:{display:"flex",flexGrow:1,transition:e.transitions.create(["margin"],n),margin:"12px 0","&$expanded":{margin:"20px 0"}},expandIcon:{transform:"rotate(0deg)",transition:e.transitions.create("transform",n),"&:hover":{backgroundColor:"transparent"},"&$expanded":{transform:"rotate(180deg)"}}}},FJ=G.exports.forwardRef(function(e,n){var i=e.children,g=e.classes,s=e.className,o=e.expandIcon,r=e.focusVisibleClassName,I=e.IconButtonProps,a=I===void 0?{}:I,l=e.onClick,C=Ve(e,["children","classes","className","expandIcon","focusVisibleClassName","IconButtonProps","onClick"]),c=G.exports.useContext(HR),A=c.disabled,d=A===void 0?!1:A,m=c.expanded,u=c.toggle,h=function(p){u&&u(p),l&&l(p)};return G.exports.createElement(kR,L({focusRipple:!1,disableRipple:!0,disabled:d,component:"div","aria-expanded":m,className:Ue(g.root,s,d&&g.disabled,m&&g.expanded),focusVisibleClassName:Ue(g.focusVisible,g.focused,r),onClick:h,ref:n},C),G.exports.createElement("div",{className:Ue(g.content,m&&g.expanded)},i),o&&G.exports.createElement(ZJ,L({className:Ue(g.expandIcon,m&&g.expanded),edge:"end",component:"div",tabIndex:null,role:null,"aria-hidden":!0},a),o))}),tz=Bt(RJ,{name:"MuiAccordionSummary"})(FJ),SJ=function(e){return{root:{margin:0},body2:e.typography.body2,body1:e.typography.body1,caption:e.typography.caption,button:e.typography.button,h1:e.typography.h1,h2:e.typography.h2,h3:e.typography.h3,h4:e.typography.h4,h5:e.typography.h5,h6:e.typography.h6,subtitle1:e.typography.subtitle1,subtitle2:e.typography.subtitle2,overline:e.typography.overline,srOnly:{position:"absolute",height:1,width:1,overflow:"hidden"},alignLeft:{textAlign:"left"},alignCenter:{textAlign:"center"},alignRight:{textAlign:"right"},alignJustify:{textAlign:"justify"},noWrap:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},gutterBottom:{marginBottom:"0.35em"},paragraph:{marginBottom:16},colorInherit:{color:"inherit"},colorPrimary:{color:e.palette.primary.main},colorSecondary:{color:e.palette.secondary.main},colorTextPrimary:{color:e.palette.text.primary},colorTextSecondary:{color:e.palette.text.secondary},colorError:{color:e.palette.error.main},displayInline:{display:"inline"},displayBlock:{display:"block"}}},KR={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p"},VJ=G.exports.forwardRef(function(e,n){var i=e.align,g=i===void 0?"inherit":i,s=e.classes,o=e.className,r=e.color,I=r===void 0?"initial":r,a=e.component,l=e.display,C=l===void 0?"initial":l,c=e.gutterBottom,A=c===void 0?!1:c,d=e.noWrap,m=d===void 0?!1:d,u=e.paragraph,h=u===void 0?!1:u,f=e.variant,p=f===void 0?"body1":f,b=e.variantMapping,Z=b===void 0?KR:b,v=Ve(e,["align","classes","className","color","component","display","gutterBottom","noWrap","paragraph","variant","variantMapping"]),N=a||(h?"p":Z[p]||KR[p])||"span";return G.exports.createElement(N,L({className:Ue(s.root,o,p!=="inherit"&&s[p],I!=="initial"&&s["color".concat(Ln(I))],m&&s.noWrap,A&&s.gutterBottom,h&&s.paragraph,g!=="inherit"&&s["align".concat(Ln(g))],C!=="initial"&&s["display".concat(Ln(C))]),ref:n},v))}),nz=Bt(SJ,{name:"MuiTypography"})(VJ),LR=G.exports.createContext();function UJ(){return G.exports.useContext(LR)}var MR=LR;function xJ(){return G.exports.useContext(MR)}function WJ(t){return t=typeof t=="function"?t():t,hi.exports.findDOMNode(t)}var bm=typeof window!="undefined"?G.exports.useLayoutEffect:G.exports.useEffect,NJ=G.exports.forwardRef(function(e,n){var i=e.children,g=e.container,s=e.disablePortal,o=s===void 0?!1:s,r=e.onRendered,I=G.exports.useState(null),a=I[0],l=I[1],C=Jt(G.exports.isValidElement(i)?i.ref:null,n);return bm(function(){o||l(WJ(g)||document.body)},[g,o]),bm(function(){if(a&&!o)return yc(n,a),function(){yc(n,null)}},[n,a,o]),bm(function(){r&&(a||o)&&r()},[r,a,o]),o?G.exports.isValidElement(i)?G.exports.cloneElement(i,{ref:C}):i:a&&hi.exports.createPortal(i,a)}),wJ=NJ;function TJ(){var t=document.createElement("div");t.style.width="99px",t.style.height="99px",t.style.position="absolute",t.style.top="-9999px",t.style.overflow="scroll",document.body.appendChild(t);var e=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),e}function EJ(t){var e=Mn(t);return e.body===t?NR(e).innerWidth>e.documentElement.clientWidth:t.scrollHeight>t.clientHeight}function ra(t,e){e?t.setAttribute("aria-hidden","true"):t.removeAttribute("aria-hidden")}function PR(t){return parseInt(window.getComputedStyle(t)["padding-right"],10)||0}function JR(t,e,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],g=arguments.length>4?arguments[4]:void 0,s=[e,n].concat(xl(i)),o=["TEMPLATE","SCRIPT","STYLE"];[].forEach.call(t.children,function(r){r.nodeType===1&&s.indexOf(r)===-1&&o.indexOf(r.tagName)===-1&&ra(r,g)})}function ym(t,e){var n=-1;return t.some(function(i,g){return e(i)?(n=g,!0):!1}),n}function QJ(t,e){var n=[],i=[],g=t.container,s;if(!e.disableScrollLock){if(EJ(g)){var o=TJ();n.push({value:g.style.paddingRight,key:"padding-right",el:g}),g.style["padding-right"]="".concat(PR(g)+o,"px"),s=Mn(g).querySelectorAll(".mui-fixed"),[].forEach.call(s,function(l){i.push(l.style.paddingRight),l.style.paddingRight="".concat(PR(l)+o,"px")})}var r=g.parentElement,I=r.nodeName==="HTML"&&window.getComputedStyle(r)["overflow-y"]==="scroll"?r:g;n.push({value:I.style.overflow,key:"overflow",el:I}),I.style.overflow="hidden"}var a=function(){s&&[].forEach.call(s,function(C,c){i[c]?C.style.paddingRight=i[c]:C.style.removeProperty("padding-right")}),n.forEach(function(C){var c=C.value,A=C.el,d=C.key;c?A.style.setProperty(d,c):A.style.removeProperty(d)})};return a}function XJ(t){var e=[];return[].forEach.call(t.children,function(n){n.getAttribute&&n.getAttribute("aria-hidden")==="true"&&e.push(n)}),e}var YJ=function(){function t(){JU(this,t),this.modals=[],this.containers=[]}return nu(t,[{key:"add",value:function(n,i){var g=this.modals.indexOf(n);if(g!==-1)return g;g=this.modals.length,this.modals.push(n),n.modalRef&&ra(n.modalRef,!1);var s=XJ(i);JR(i,n.mountNode,n.modalRef,s,!0);var o=ym(this.containers,function(r){return r.container===i});return o!==-1?(this.containers[o].modals.push(n),g):(this.containers.push({modals:[n],container:i,restore:null,hiddenSiblingNodes:s}),g)}},{key:"mount",value:function(n,i){var g=ym(this.containers,function(o){return o.modals.indexOf(n)!==-1}),s=this.containers[g];s.restore||(s.restore=QJ(s,i))}},{key:"remove",value:function(n){var i=this.modals.indexOf(n);if(i===-1)return i;var g=ym(this.containers,function(r){return r.modals.indexOf(n)!==-1}),s=this.containers[g];if(s.modals.splice(s.modals.indexOf(n),1),this.modals.splice(i,1),s.modals.length===0)s.restore&&s.restore(),n.modalRef&&ra(n.modalRef,!0),JR(s.container,n.mountNode,n.modalRef,s.hiddenSiblingNodes,!1),this.containers.splice(g,1);else{var o=s.modals[s.modals.length-1];o.modalRef&&ra(o.modalRef,!1)}return i}},{key:"isTopModal",value:function(n){return this.modals.length>0&&this.modals[this.modals.length-1]===n}}]),t}();function _J(t){var e=t.children,n=t.disableAutoFocus,i=n===void 0?!1:n,g=t.disableEnforceFocus,s=g===void 0?!1:g,o=t.disableRestoreFocus,r=o===void 0?!1:o,I=t.getDoc,a=t.isEnabled,l=t.open,C=G.exports.useRef(),c=G.exports.useRef(null),A=G.exports.useRef(null),d=G.exports.useRef(),m=G.exports.useRef(null),u=G.exports.useCallback(function(p){m.current=hi.exports.findDOMNode(p)},[]),h=Jt(e.ref,u),f=G.exports.useRef();return G.exports.useEffect(function(){f.current=l},[l]),!f.current&&l&&typeof window!="undefined"&&(d.current=I().activeElement),G.exports.useEffect(function(){if(!!l){var p=Mn(m.current);!i&&m.current&&!m.current.contains(p.activeElement)&&(m.current.hasAttribute("tabIndex")||m.current.setAttribute("tabIndex",-1),m.current.focus());var b=function(){var x=m.current;if(x!==null){if(!p.hasFocus()||s||!a()||C.current){C.current=!1;return}m.current&&!m.current.contains(p.activeElement)&&m.current.focus()}},Z=function(x){s||!a()||x.keyCode!==9||p.activeElement===m.current&&(C.current=!0,x.shiftKey?A.current.focus():c.current.focus())};p.addEventListener("focus",b,!0),p.addEventListener("keydown",Z,!0);var v=setInterval(function(){b()},50);return function(){clearInterval(v),p.removeEventListener("focus",b,!0),p.removeEventListener("keydown",Z,!0),r||(d.current&&d.current.focus&&d.current.focus(),d.current=null)}}},[i,s,r,a,l]),G.exports.createElement(G.exports.Fragment,null,G.exports.createElement("div",{tabIndex:0,ref:c,"data-test":"sentinelStart"}),G.exports.cloneElement(e,{ref:h}),G.exports.createElement("div",{tabIndex:0,ref:A,"data-test":"sentinelEnd"}))}var DR={root:{zIndex:-1,position:"fixed",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},invisible:{backgroundColor:"transparent"}},HJ=G.exports.forwardRef(function(e,n){var i=e.invisible,g=i===void 0?!1:i,s=e.open,o=Ve(e,["invisible","open"]);return s?G.exports.createElement("div",L({"aria-hidden":!0,ref:n},o,{style:L({},DR.root,g?DR.invisible:{},o.style)})):null}),kJ=HJ;function KJ(t){return t=typeof t=="function"?t():t,hi.exports.findDOMNode(t)}function LJ(t){return t.children?t.children.props.hasOwnProperty("in"):!1}var MJ=new YJ,PJ=function(e){return{root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}}},JJ=G.exports.forwardRef(function(e,n){var i=aI(),g=rb({name:"MuiModal",props:L({},e),theme:i}),s=g.BackdropComponent,o=s===void 0?kJ:s,r=g.BackdropProps,I=g.children,a=g.closeAfterTransition,l=a===void 0?!1:a,C=g.container,c=g.disableAutoFocus,A=c===void 0?!1:c,d=g.disableBackdropClick,m=d===void 0?!1:d,u=g.disableEnforceFocus,h=u===void 0?!1:u,f=g.disableEscapeKeyDown,p=f===void 0?!1:f,b=g.disablePortal,Z=b===void 0?!1:b,v=g.disableRestoreFocus,N=v===void 0?!1:v,x=g.disableScrollLock,V=x===void 0?!1:x,E=g.hideBackdrop,D=E===void 0?!1:E,_=g.keepMounted,k=_===void 0?!1:_,z=g.manager,ee=z===void 0?MJ:z,Ie=g.onBackdropClick,he=g.onClose,ge=g.onEscapeKeyDown,Ae=g.onRendered,U=g.open,F=Ve(g,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","onRendered","open"]),W=G.exports.useState(!0),T=W[0],Y=W[1],Q=G.exports.useRef({}),H=G.exports.useRef(null),P=G.exports.useRef(null),oe=Jt(P,n),ne=LJ(g),me=function(){return Mn(H.current)},ae=function(){return Q.current.modalRef=P.current,Q.current.mountNode=H.current,Q.current},be=function(){ee.mount(ae(),{disableScrollLock:V}),P.current.scrollTop=0},Ze=Yt(function(){var Qe=KJ(C)||me().body;ee.add(ae(),Qe),P.current&&be()}),Be=G.exports.useCallback(function(){return ee.isTopModal(ae())},[ee]),rt=Yt(function(Qe){H.current=Qe,!!Qe&&(Ae&&Ae(),U&&Be()?be():ra(P.current,!0))}),le=G.exports.useCallback(function(){ee.remove(ae())},[ee]);if(G.exports.useEffect(function(){return function(){le()}},[le]),G.exports.useEffect(function(){U?Ze():(!ne||!l)&&le()},[U,le,ne,l,Ze]),!k&&!U&&(!ne||T))return null;var Re=function(){Y(!1)},Vt=function(){Y(!0),l&&le()},$e=function(Je){Je.target===Je.currentTarget&&(Ie&&Ie(Je),!m&&he&&he(Je,"backdropClick"))},et=function(Je){Je.key!=="Escape"||!Be()||(ge&&ge(Je),p||(Je.stopPropagation(),he&&he(Je,"escapeKeyDown")))},xe=PJ(i||{zIndex:SR}),Ge={};return I.props.tabIndex===void 0&&(Ge.tabIndex=I.props.tabIndex||"-1"),ne&&(Ge.onEnter=dm(Re,I.props.onEnter),Ge.onExited=dm(Vt,I.props.onExited)),G.exports.createElement(wJ,{ref:rt,container:C,disablePortal:Z},G.exports.createElement("div",L({ref:oe,onKeyDown:et,role:"presentation"},F,{style:L({},xe.root,!U&&T?xe.hidden:{},F.style)}),D?null:G.exports.createElement(o,L({open:U,onClick:$e},r)),G.exports.createElement(_J,{disableEnforceFocus:h,disableAutoFocus:A,disableRestoreFocus:N,getDoc:me,isEnabled:Be,open:U},G.exports.cloneElement(I,Ge))))}),DJ=JJ,zJ=function(e){return{root:{height:1,margin:0,border:"none",flexShrink:0,backgroundColor:e.palette.divider},absolute:{position:"absolute",bottom:0,left:0,width:"100%"},inset:{marginLeft:72},light:{backgroundColor:Wg(e.palette.divider,.08)},middle:{marginLeft:e.spacing(2),marginRight:e.spacing(2)},vertical:{height:"100%",width:1},flexItem:{alignSelf:"stretch",height:"auto"}}},OJ=G.exports.forwardRef(function(e,n){var i=e.absolute,g=i===void 0?!1:i,s=e.classes,o=e.className,r=e.component,I=r===void 0?"hr":r,a=e.flexItem,l=a===void 0?!1:a,C=e.light,c=C===void 0?!1:C,A=e.orientation,d=A===void 0?"horizontal":A,m=e.role,u=m===void 0?I!=="hr"?"separator":void 0:m,h=e.variant,f=h===void 0?"fullWidth":h,p=Ve(e,["absolute","classes","className","component","flexItem","light","orientation","role","variant"]);return G.exports.createElement(I,L({className:Ue(s.root,o,f!=="fullWidth"&&s[f],g&&s.absolute,l&&s.flexItem,c&&s.light,d==="vertical"&&s.vertical),role:u,ref:n},p))}),iz=Bt(zJ,{name:"MuiDivider"})(OJ);function zR(t){var e=t.props,n=t.states,i=t.muiFormControl;return n.reduce(function(g,s){return g[s]=e[s],i&&typeof e[s]=="undefined"&&(g[s]=i[s]),g},{})}function Rc(t,e){return parseInt(t[e],10)||0}var jJ=typeof window!="undefined"?G.exports.useLayoutEffect:G.exports.useEffect,qJ={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}},$J=G.exports.forwardRef(function(e,n){var i=e.onChange,g=e.rows,s=e.rowsMax,o=e.rowsMin,r=e.maxRows,I=e.minRows,a=I===void 0?1:I,l=e.style,C=e.value,c=Ve(e,["onChange","rows","rowsMax","rowsMin","maxRows","minRows","style","value"]),A=r||s,d=g||o||a,m=G.exports.useRef(C!=null),u=m.current,h=G.exports.useRef(null),f=Jt(n,h),p=G.exports.useRef(null),b=G.exports.useRef(0),Z=G.exports.useState({}),v=Z[0],N=Z[1],x=G.exports.useCallback(function(){var E=h.current,D=window.getComputedStyle(E),_=p.current;_.style.width=D.width,_.value=E.value||e.placeholder||"x",_.value.slice(-1)===`
`&&(_.value+=" ");var k=D["box-sizing"],z=Rc(D,"padding-bottom")+Rc(D,"padding-top"),ee=Rc(D,"border-bottom-width")+Rc(D,"border-top-width"),Ie=_.scrollHeight-z;_.value="x";var he=_.scrollHeight-z,ge=Ie;d&&(ge=Math.max(Number(d)*he,ge)),A&&(ge=Math.min(Number(A)*he,ge)),ge=Math.max(ge,he);var Ae=ge+(k==="border-box"?z+ee:0),U=Math.abs(ge-Ie)<=1;N(function(F){return b.current<20&&(Ae>0&&Math.abs((F.outerHeightStyle||0)-Ae)>1||F.overflow!==U)?(b.current+=1,{overflow:U,outerHeightStyle:Ae}):F})},[A,d,e.placeholder]);G.exports.useEffect(function(){var E=WR(function(){b.current=0,x()});return window.addEventListener("resize",E),function(){E.clear(),window.removeEventListener("resize",E)}},[x]),jJ(function(){x()}),G.exports.useEffect(function(){b.current=0},[C]);var V=function(D){b.current=0,u||x(),i&&i(D)};return G.exports.createElement(G.exports.Fragment,null,G.exports.createElement("textarea",L({value:C,onChange:V,ref:f,rows:d,style:L({height:v.outerHeightStyle,overflow:v.overflow?"hidden":null},l)},c)),G.exports.createElement("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:p,tabIndex:-1,style:L({},qJ.shadow,l)}))}),eD=$J;function OR(t){return t!=null&&!(Array.isArray(t)&&t.length===0)}function tD(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return t&&(OR(t.value)&&t.value!==""||e&&OR(t.defaultValue)&&t.defaultValue!=="")}var nD=function(e){var n=e.palette.type==="light",i={color:"currentColor",opacity:n?.42:.5,transition:e.transitions.create("opacity",{duration:e.transitions.duration.shorter})},g={opacity:"0 !important"},s={opacity:n?.42:.5};return{"@global":{"@keyframes mui-auto-fill":{},"@keyframes mui-auto-fill-cancel":{}},root:L({},e.typography.body1,{color:e.palette.text.primary,lineHeight:"1.1876em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center","&$disabled":{color:e.palette.text.disabled,cursor:"default"}}),formControl:{},focused:{},disabled:{},adornedStart:{},adornedEnd:{},error:{},marginDense:{},multiline:{padding:"".concat(8-2,"px 0 ").concat(8-1,"px"),"&$marginDense":{paddingTop:4-1}},colorSecondary:{},fullWidth:{width:"100%"},input:{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"".concat(8-2,"px 0 ").concat(8-1,"px"),border:0,boxSizing:"content-box",background:"none",height:"1.1876em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%",animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&::-webkit-input-placeholder":i,"&::-moz-placeholder":i,"&:-ms-input-placeholder":i,"&::-ms-input-placeholder":i,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{"-webkit-appearance":"none"},"label[data-shrink=false] + $formControl &":{"&::-webkit-input-placeholder":g,"&::-moz-placeholder":g,"&:-ms-input-placeholder":g,"&::-ms-input-placeholder":g,"&:focus::-webkit-input-placeholder":s,"&:focus::-moz-placeholder":s,"&:focus:-ms-input-placeholder":s,"&:focus::-ms-input-placeholder":s},"&$disabled":{opacity:1},"&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}},inputMarginDense:{paddingTop:4-1},inputMultiline:{height:"auto",resize:"none",padding:0},inputTypeSearch:{"-moz-appearance":"textfield","-webkit-appearance":"textfield"},inputAdornedStart:{},inputAdornedEnd:{},inputHiddenLabel:{}}},iD=typeof window=="undefined"?G.exports.useEffect:G.exports.useLayoutEffect,gD=G.exports.forwardRef(function(e,n){var i=e["aria-describedby"],g=e.autoComplete,s=e.autoFocus,o=e.classes,r=e.className;e.color;var I=e.defaultValue,a=e.disabled,l=e.endAdornment;e.error;var C=e.fullWidth,c=C===void 0?!1:C,A=e.id,d=e.inputComponent,m=d===void 0?"input":d,u=e.inputProps,h=u===void 0?{}:u,f=e.inputRef;e.margin;var p=e.multiline,b=p===void 0?!1:p,Z=e.name,v=e.onBlur,N=e.onChange,x=e.onClick,V=e.onFocus,E=e.onKeyDown,D=e.onKeyUp,_=e.placeholder,k=e.readOnly,z=e.renderSuffix,ee=e.rows,Ie=e.rowsMax,he=e.rowsMin,ge=e.maxRows,Ae=e.minRows,U=e.startAdornment,F=e.type,W=F===void 0?"text":F,T=e.value,Y=Ve(e,["aria-describedby","autoComplete","autoFocus","classes","className","color","defaultValue","disabled","endAdornment","error","fullWidth","id","inputComponent","inputProps","inputRef","margin","multiline","name","onBlur","onChange","onClick","onFocus","onKeyDown","onKeyUp","placeholder","readOnly","renderSuffix","rows","rowsMax","rowsMin","maxRows","minRows","startAdornment","type","value"]),Q=h.value!=null?h.value:T,H=G.exports.useRef(Q!=null),P=H.current,oe=G.exports.useRef(),ne=G.exports.useCallback(function(at){},[]),me=Jt(h.ref,ne),ae=Jt(f,me),be=Jt(oe,ae),Ze=G.exports.useState(!1),Be=Ze[0],rt=Ze[1],le=UJ(),Re=zR({props:e,muiFormControl:le,states:["color","disabled","error","hiddenLabel","margin","required","filled"]});Re.focused=le?le.focused:Be,G.exports.useEffect(function(){!le&&a&&Be&&(rt(!1),v&&v())},[le,a,Be,v]);var Vt=le&&le.onFilled,$e=le&&le.onEmpty,et=G.exports.useCallback(function(at){tD(at)?Vt&&Vt():$e&&$e()},[Vt,$e]);iD(function(){P&&et({value:Q})},[Q,et,P]);var xe=function(Se){if(Re.disabled){Se.stopPropagation();return}V&&V(Se),h.onFocus&&h.onFocus(Se),le&&le.onFocus?le.onFocus(Se):rt(!0)},Ge=function(Se){v&&v(Se),h.onBlur&&h.onBlur(Se),le&&le.onBlur?le.onBlur(Se):rt(!1)},Qe=function(Se){if(!P){var Sn=Se.target||oe.current;if(Sn==null)throw new Error(Pr(1));et({value:Sn.value})}for(var gt=arguments.length,Vn=new Array(gt>1?gt-1:0),Un=1;Un<gt;Un++)Vn[Un-1]=arguments[Un];h.onChange&&h.onChange.apply(h,[Se].concat(Vn)),N&&N.apply(void 0,[Se].concat(Vn))};G.exports.useEffect(function(){et(oe.current)},[]);var Je=function(Se){oe.current&&Se.currentTarget===Se.target&&oe.current.focus(),x&&x(Se)},_t=m,Ut=L({},h,{ref:be});typeof _t!="string"?Ut=L({inputRef:be,type:W},Ut,{ref:null}):b?ee&&!ge&&!Ae&&!Ie&&!he?_t="textarea":(Ut=L({minRows:ee||Ae,rowsMax:Ie,maxRows:ge},Ut),_t=eD):Ut=L({type:W},Ut);var Yi=function(Se){et(Se.animationName==="mui-auto-fill-cancel"?oe.current:{value:"x"})};return G.exports.useEffect(function(){le&&le.setAdornedStart(Boolean(U))},[le,U]),G.exports.createElement("div",L({className:Ue(o.root,o["color".concat(Ln(Re.color||"primary"))],r,Re.disabled&&o.disabled,Re.error&&o.error,c&&o.fullWidth,Re.focused&&o.focused,le&&o.formControl,b&&o.multiline,U&&o.adornedStart,l&&o.adornedEnd,Re.margin==="dense"&&o.marginDense),onClick:Je,ref:n},Y),U,G.exports.createElement(MR.Provider,{value:null},G.exports.createElement(_t,L({"aria-invalid":Re.error,"aria-describedby":i,autoComplete:g,autoFocus:s,defaultValue:I,disabled:Re.disabled,id:A,onAnimationStart:Yi,name:Z,placeholder:_,readOnly:k,required:Re.required,rows:ee,value:Q,onKeyDown:E,onKeyUp:D},Ut,{className:Ue(o.input,h.className,Re.disabled&&o.disabled,b&&o.inputMultiline,Re.hiddenLabel&&o.inputHiddenLabel,U&&o.inputAdornedStart,l&&o.inputAdornedEnd,W==="search"&&o.inputTypeSearch,Re.margin==="dense"&&o.inputMarginDense),onBlur:Ge,onChange:Qe,onFocus:xe}))),l,z?z(L({},Re,{startAdornment:U})):null)}),sD=Bt(nD,{name:"MuiInputBase"})(gD),oD=[0,1,2,3,4,5,6,7,8,9,10],rD=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12];function ID(t,e,n){var i={};rD.forEach(function(g){var s="grid-".concat(n,"-").concat(g);if(g===!0){i[s]={flexBasis:0,flexGrow:1,maxWidth:"100%"};return}if(g==="auto"){i[s]={flexBasis:"auto",flexGrow:0,maxWidth:"none"};return}var o="".concat(Math.round(g/12*1e8)/1e6,"%");i[s]={flexBasis:o,flexGrow:0,maxWidth:o}}),n==="xs"?L(t,i):t[e.breakpoints.up(n)]=i}function vm(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=parseFloat(t);return"".concat(n/e).concat(String(t).replace(String(n),"")||"px")}function aD(t,e){var n={};return oD.forEach(function(i){var g=t.spacing(i);g!==0&&(n["spacing-".concat(e,"-").concat(i)]={margin:"-".concat(vm(g,2)),width:"calc(100% + ".concat(vm(g),")"),"& > $item":{padding:vm(g,2)}})}),n}var lD=function(e){return L({root:{},container:{boxSizing:"border-box",display:"flex",flexWrap:"wrap",width:"100%"},item:{boxSizing:"border-box",margin:"0"},zeroMinWidth:{minWidth:0},"direction-xs-column":{flexDirection:"column"},"direction-xs-column-reverse":{flexDirection:"column-reverse"},"direction-xs-row-reverse":{flexDirection:"row-reverse"},"wrap-xs-nowrap":{flexWrap:"nowrap"},"wrap-xs-wrap-reverse":{flexWrap:"wrap-reverse"},"align-items-xs-center":{alignItems:"center"},"align-items-xs-flex-start":{alignItems:"flex-start"},"align-items-xs-flex-end":{alignItems:"flex-end"},"align-items-xs-baseline":{alignItems:"baseline"},"align-content-xs-center":{alignContent:"center"},"align-content-xs-flex-start":{alignContent:"flex-start"},"align-content-xs-flex-end":{alignContent:"flex-end"},"align-content-xs-space-between":{alignContent:"space-between"},"align-content-xs-space-around":{alignContent:"space-around"},"justify-content-xs-center":{justifyContent:"center"},"justify-content-xs-flex-end":{justifyContent:"flex-end"},"justify-content-xs-space-between":{justifyContent:"space-between"},"justify-content-xs-space-around":{justifyContent:"space-around"},"justify-content-xs-space-evenly":{justifyContent:"space-evenly"}},aD(e,"xs"),e.breakpoints.keys.reduce(function(n,i){return ID(n,e,i),n},{}))},CD=G.exports.forwardRef(function(e,n){var i=e.alignContent,g=i===void 0?"stretch":i,s=e.alignItems,o=s===void 0?"stretch":s,r=e.classes,I=e.className,a=e.component,l=a===void 0?"div":a,C=e.container,c=C===void 0?!1:C,A=e.direction,d=A===void 0?"row":A,m=e.item,u=m===void 0?!1:m,h=e.justify,f=e.justifyContent,p=f===void 0?"flex-start":f,b=e.lg,Z=b===void 0?!1:b,v=e.md,N=v===void 0?!1:v,x=e.sm,V=x===void 0?!1:x,E=e.spacing,D=E===void 0?0:E,_=e.wrap,k=_===void 0?"wrap":_,z=e.xl,ee=z===void 0?!1:z,Ie=e.xs,he=Ie===void 0?!1:Ie,ge=e.zeroMinWidth,Ae=ge===void 0?!1:ge,U=Ve(e,["alignContent","alignItems","classes","className","component","container","direction","item","justify","justifyContent","lg","md","sm","spacing","wrap","xl","xs","zeroMinWidth"]),F=Ue(r.root,I,c&&[r.container,D!==0&&r["spacing-xs-".concat(String(D))]],u&&r.item,Ae&&r.zeroMinWidth,d!=="row"&&r["direction-xs-".concat(String(d))],k!=="wrap"&&r["wrap-xs-".concat(String(k))],o!=="stretch"&&r["align-items-xs-".concat(String(o))],g!=="stretch"&&r["align-content-xs-".concat(String(g))],(h||p)!=="flex-start"&&r["justify-content-xs-".concat(String(h||p))],he!==!1&&r["grid-xs-".concat(String(he))],V!==!1&&r["grid-sm-".concat(String(V))],N!==!1&&r["grid-md-".concat(String(N))],Z!==!1&&r["grid-lg-".concat(String(Z))],ee!==!1&&r["grid-xl-".concat(String(ee))]);return G.exports.createElement(l,L({className:F,ref:n},U))}),cD=Bt(lD,{name:"MuiGrid"})(CD),gz=cD;function Gm(t){return"scale(".concat(t,", ").concat(Math.pow(t,2),")")}var AD={entering:{opacity:1,transform:Gm(1)},entered:{opacity:1,transform:"none"}},jR=G.exports.forwardRef(function(e,n){var i=e.children,g=e.disableStrictModeCompat,s=g===void 0?!1:g,o=e.in,r=e.onEnter,I=e.onEntered,a=e.onEntering,l=e.onExit,C=e.onExited,c=e.onExiting,A=e.style,d=e.timeout,m=d===void 0?"auto":d,u=e.TransitionComponent,h=u===void 0?XR:u,f=Ve(e,["children","disableStrictModeCompat","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"]),p=G.exports.useRef(),b=G.exports.useRef(),Z=Am(),v=Z.unstable_strictMode&&!s,N=G.exports.useRef(null),x=Jt(i.ref,n),V=Jt(v?N:void 0,x),E=function(Ae){return function(U,F){if(Ae){var W=v?[N.current,U]:[U,F],T=bc(W,2),Y=T[0],Q=T[1];Q===void 0?Ae(Y):Ae(Y,Q)}}},D=E(a),_=E(function(ge,Ae){sJ(ge);var U=Zc({style:A,timeout:m},{mode:"enter"}),F=U.duration,W=U.delay,T;m==="auto"?(T=Z.transitions.getAutoHeightDuration(ge.clientHeight),b.current=T):T=F,ge.style.transition=[Z.transitions.create("opacity",{duration:T,delay:W}),Z.transitions.create("transform",{duration:T*.666,delay:W})].join(","),r&&r(ge,Ae)}),k=E(I),z=E(c),ee=E(function(ge){var Ae=Zc({style:A,timeout:m},{mode:"exit"}),U=Ae.duration,F=Ae.delay,W;m==="auto"?(W=Z.transitions.getAutoHeightDuration(ge.clientHeight),b.current=W):W=U,ge.style.transition=[Z.transitions.create("opacity",{duration:W,delay:F}),Z.transitions.create("transform",{duration:W*.666,delay:F||W*.333})].join(","),ge.style.opacity="0",ge.style.transform=Gm(.75),l&&l(ge)}),Ie=E(C),he=function(Ae,U){var F=v?Ae:U;m==="auto"&&(p.current=setTimeout(F,b.current||0))};return G.exports.useEffect(function(){return function(){clearTimeout(p.current)}},[]),G.exports.createElement(h,L({appear:!0,in:o,nodeRef:v?N:void 0,onEnter:_,onEntered:k,onEntering:D,onExit:ee,onExited:Ie,onExiting:z,addEndListener:he,timeout:m==="auto"?null:m},f),function(ge,Ae){return G.exports.cloneElement(i,L({style:L({opacity:0,transform:Gm(.75),visibility:ge==="exited"&&!o?"hidden":void 0},AD[ge],A,i.props.style),ref:V},Ae))})});jR.muiSupportAuto=!0;var dD=jR,uD=function(e){var n=e.palette.type==="light",i=n?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return{root:{position:"relative"},formControl:{"label + &":{marginTop:16}},focused:{},disabled:{},colorSecondary:{"&$underline:after":{borderBottomColor:e.palette.secondary.main}},underline:{"&:after":{borderBottom:"2px solid ".concat(e.palette.primary.main),left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),pointerEvents:"none"},"&$focused:after":{transform:"scaleX(1)"},"&$error:after":{borderBottomColor:e.palette.error.main,transform:"scaleX(1)"},"&:before":{borderBottom:"1px solid ".concat(i),left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:e.transitions.create("border-bottom-color",{duration:e.transitions.duration.shorter}),pointerEvents:"none"},"&:hover:not($disabled):before":{borderBottom:"2px solid ".concat(e.palette.text.primary),"@media (hover: none)":{borderBottom:"1px solid ".concat(i)}},"&$disabled:before":{borderBottomStyle:"dotted"}},error:{},marginDense:{},multiline:{},fullWidth:{},input:{},inputMarginDense:{},inputMultiline:{},inputTypeSearch:{}}},qR=G.exports.forwardRef(function(e,n){var i=e.disableUnderline,g=e.classes,s=e.fullWidth,o=s===void 0?!1:s,r=e.inputComponent,I=r===void 0?"input":r,a=e.multiline,l=a===void 0?!1:a,C=e.type,c=C===void 0?"text":C,A=Ve(e,["disableUnderline","classes","fullWidth","inputComponent","multiline","type"]);return G.exports.createElement(sD,L({classes:L({},g,{root:Ue(g.root,!i&&g.underline),underline:null}),fullWidth:o,inputComponent:I,multiline:l,ref:n,type:c},A))});qR.muiName="Input";var hD=Bt(uD,{name:"MuiInput"})(qR);function $R(t,e){var n=0;return typeof e=="number"?n=e:e==="center"?n=t.height/2:e==="bottom"&&(n=t.height),n}function eF(t,e){var n=0;return typeof e=="number"?n=e:e==="center"?n=t.width/2:e==="right"&&(n=t.width),n}function tF(t){return[t.horizontal,t.vertical].map(function(e){return typeof e=="number"?"".concat(e,"px"):e}).join(" ")}function mD(t,e){for(var n=e,i=0;n&&n!==t;)n=n.parentElement,i+=n.scrollTop;return i}function Zm(t){return typeof t=="function"?t():t}var fD={root:{},paper:{position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}},pD=G.exports.forwardRef(function(e,n){var i=e.action,g=e.anchorEl,s=e.anchorOrigin,o=s===void 0?{vertical:"top",horizontal:"left"}:s,r=e.anchorPosition,I=e.anchorReference,a=I===void 0?"anchorEl":I,l=e.children,C=e.classes,c=e.className,A=e.container,d=e.elevation,m=d===void 0?8:d,u=e.getContentAnchorEl,h=e.marginThreshold,f=h===void 0?16:h,p=e.onEnter,b=e.onEntered,Z=e.onEntering,v=e.onExit,N=e.onExited,x=e.onExiting,V=e.open,E=e.PaperProps,D=E===void 0?{}:E,_=e.transformOrigin,k=_===void 0?{vertical:"top",horizontal:"left"}:_,z=e.TransitionComponent,ee=z===void 0?dD:z,Ie=e.transitionDuration,he=Ie===void 0?"auto":Ie,ge=e.TransitionProps,Ae=ge===void 0?{}:ge,U=Ve(e,["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","classes","className","container","elevation","getContentAnchorEl","marginThreshold","onEnter","onEntered","onEntering","onExit","onExited","onExiting","open","PaperProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"]),F=G.exports.useRef(),W=G.exports.useCallback(function(ae){if(a==="anchorPosition")return r;var be=Zm(g),Ze=be&&be.nodeType===1?be:Mn(F.current).body,Be=Ze.getBoundingClientRect(),rt=ae===0?o.vertical:"center";return{top:Be.top+$R(Be,rt),left:Be.left+eF(Be,o.horizontal)}},[g,o.horizontal,o.vertical,r,a]),T=G.exports.useCallback(function(ae){var be=0;if(u&&a==="anchorEl"){var Ze=u(ae);if(Ze&&ae.contains(Ze)){var Be=mD(ae,Ze);be=Ze.offsetTop+Ze.clientHeight/2-Be||0}}return be},[o.vertical,a,u]),Y=G.exports.useCallback(function(ae){var be=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return{vertical:$R(ae,k.vertical)+be,horizontal:eF(ae,k.horizontal)}},[k.horizontal,k.vertical]),Q=G.exports.useCallback(function(ae){var be=T(ae),Ze={width:ae.offsetWidth,height:ae.offsetHeight},Be=Y(Ze,be);if(a==="none")return{top:null,left:null,transformOrigin:tF(Be)};var rt=W(be),le=rt.top-Be.vertical,Re=rt.left-Be.horizontal,Vt=le+Ze.height,$e=Re+Ze.width,et=NR(Zm(g)),xe=et.innerHeight-f,Ge=et.innerWidth-f;if(le<f){var Qe=le-f;le-=Qe,Be.vertical+=Qe}else if(Vt>xe){var Je=Vt-xe;le-=Je,Be.vertical+=Je}if(Re<f){var _t=Re-f;Re-=_t,Be.horizontal+=_t}else if($e>Ge){var Ut=$e-Ge;Re-=Ut,Be.horizontal+=Ut}return{top:"".concat(Math.round(le),"px"),left:"".concat(Math.round(Re),"px"),transformOrigin:tF(Be)}},[g,a,W,T,Y,f]),H=G.exports.useCallback(function(){var ae=F.current;if(!!ae){var be=Q(ae);be.top!==null&&(ae.style.top=be.top),be.left!==null&&(ae.style.left=be.left),ae.style.transformOrigin=be.transformOrigin}},[Q]),P=function(be,Ze){Z&&Z(be,Ze),H()},oe=G.exports.useCallback(function(ae){F.current=hi.exports.findDOMNode(ae)},[]);G.exports.useEffect(function(){V&&H()}),G.exports.useImperativeHandle(i,function(){return V?{updatePosition:function(){H()}}:null},[V,H]),G.exports.useEffect(function(){if(!!V){var ae=WR(function(){H()});return window.addEventListener("resize",ae),function(){ae.clear(),window.removeEventListener("resize",ae)}}},[V,H]);var ne=he;he==="auto"&&!ee.muiSupportAuto&&(ne=void 0);var me=A||(g?Mn(Zm(g)).body:void 0);return G.exports.createElement(DJ,L({container:me,open:V,ref:n,BackdropProps:{invisible:!0},className:Ue(C.root,c)},U),G.exports.createElement(ee,L({appear:!0,in:V,onEnter:p,onEntered:b,onExit:v,onExited:N,onExiting:x,timeout:ne},Ae,{onEntering:dm(P,Ae.onEntering)}),G.exports.createElement(_R,L({elevation:m,ref:oe},D,{className:Ue(C.paper,D.className)}),l)))}),sz=Bt(fD,{name:"MuiPopover"})(pD),BD=G.exports.forwardRef(function(e,n){var i=e.classes,g=e.className,s=e.disabled,o=e.IconComponent,r=e.inputRef,I=e.variant,a=I===void 0?"standard":I,l=Ve(e,["classes","className","disabled","IconComponent","inputRef","variant"]);return G.exports.createElement(G.exports.Fragment,null,G.exports.createElement("select",L({className:Ue(i.root,i.select,i[a],g,s&&i.disabled),disabled:s,ref:r||n},l)),e.multiple?null:G.exports.createElement(o,{className:Ue(i.icon,i["icon".concat(Ln(a))],s&&i.disabled)}))}),bD=BD,yD=Qi(G.exports.createElement("path",{d:"M7 10l5 5 5-5z"})),vD=function(e){return{root:{},select:{"-moz-appearance":"none","-webkit-appearance":"none",userSelect:"none",borderRadius:0,minWidth:16,cursor:"pointer","&:focus":{backgroundColor:e.palette.type==="light"?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)",borderRadius:0},"&::-ms-expand":{display:"none"},"&$disabled":{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:e.palette.background.paper},"&&":{paddingRight:24}},filled:{"&&":{paddingRight:32}},outlined:{borderRadius:e.shape.borderRadius,"&&":{paddingRight:32}},selectMenu:{height:"auto",minHeight:"1.1876em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},disabled:{},icon:{position:"absolute",right:0,top:"calc(50% - 12px)",pointerEvents:"none",color:e.palette.action.active,"&$disabled":{color:e.palette.action.disabled}},iconOpen:{transform:"rotate(180deg)"},iconFilled:{right:7},iconOutlined:{right:7},nativeInput:{bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%"}}},GD=G.exports.createElement(hD,null),nF=G.exports.forwardRef(function(e,n){var i=e.children,g=e.classes,s=e.IconComponent,o=s===void 0?yD:s,r=e.input,I=r===void 0?GD:r,a=e.inputProps;e.variant;var l=Ve(e,["children","classes","IconComponent","input","inputProps","variant"]),C=xJ(),c=zR({props:e,muiFormControl:C,states:["variant"]});return G.exports.cloneElement(I,L({inputComponent:bD,inputProps:L({children:i,classes:g,IconComponent:o,variant:c.variant,type:void 0},a,I?I.props.inputProps:{}),ref:n},l))});nF.muiName="Select";var oz=Bt(vD,{name:"MuiNativeSelect"})(nF),ZD=function(e){return{thumb:{"&$open":{"& $offset":{transform:"scale(1) translateY(-10px)"}}},open:{},offset:L({zIndex:1},e.typography.body2,{fontSize:e.typography.pxToRem(12),lineHeight:1.2,transition:e.transitions.create(["transform"],{duration:e.transitions.duration.shortest}),top:-34,transformOrigin:"bottom center",transform:"scale(0)",position:"absolute"}),circle:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:"50% 50% 50% 0",backgroundColor:"currentColor",transform:"rotate(-45deg)"},label:{color:e.palette.primary.contrastText,transform:"rotate(45deg)"}}};function RD(t){var e=t.children,n=t.classes,i=t.className,g=t.open,s=t.value,o=t.valueLabelDisplay;return o==="off"?e:G.exports.cloneElement(e,{className:Ue(e.props.className,(g||o==="on")&&n.open,n.thumb)},G.exports.createElement("span",{className:Ue(n.offset,i)},G.exports.createElement("span",{className:n.circle},G.exports.createElement("span",{className:n.label},s))))}var FD=Bt(ZD,{name:"PrivateValueLabel"})(RD);function Rm(t,e){return t-e}function Fm(t,e,n){return Math.min(Math.max(e,t),n)}function iF(t,e){var n=t.reduce(function(g,s,o){var r=Math.abs(e-s);return g===null||r<g.distance||r===g.distance?{distance:r,index:o}:g},null),i=n.index;return i}function Fc(t,e){if(e.current!==void 0&&t.changedTouches){for(var n=0;n<t.changedTouches.length;n+=1){var i=t.changedTouches[n];if(i.identifier===e.current)return{x:i.clientX,y:i.clientY}}return!1}return{x:t.clientX,y:t.clientY}}function Sc(t,e,n){return(t-e)*100/(n-e)}function SD(t,e,n){return(n-e)*t+e}function VD(t){if(Math.abs(t)<1){var e=t.toExponential().split("e-"),n=e[0].split(".")[1];return(n?n.length:0)+parseInt(e[1],10)}var i=t.toString().split(".")[1];return i?i.length:0}function gF(t,e,n){var i=Math.round((t-n)/e)*e+n;return Number(i.toFixed(VD(e)))}function sF(t){var e=t.values,n=t.source,i=t.newValue,g=t.index;if(e[g]===i)return n;var s=e.slice();return s[g]=i,s}function Vc(t){var e=t.sliderRef,n=t.activeIndex,i=t.setActive;(!e.current.contains(document.activeElement)||Number(document.activeElement.getAttribute("data-index"))!==n)&&e.current.querySelector('[role="slider"][data-index="'.concat(n,'"]')).focus(),i&&i(n)}var Uc={horizontal:{offset:function(e){return{left:"".concat(e,"%")}},leap:function(e){return{width:"".concat(e,"%")}}},"horizontal-reverse":{offset:function(e){return{right:"".concat(e,"%")}},leap:function(e){return{width:"".concat(e,"%")}}},vertical:{offset:function(e){return{bottom:"".concat(e,"%")}},leap:function(e){return{height:"".concat(e,"%")}}}},oF=function(e){return e},UD=function(e){return{root:{height:2,width:"100%",boxSizing:"content-box",padding:"13px 0",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",color:e.palette.primary.main,WebkitTapHighlightColor:"transparent","&$disabled":{pointerEvents:"none",cursor:"default",color:e.palette.grey[400]},"&$vertical":{width:2,height:"100%",padding:"0 13px"},"@media (pointer: coarse)":{padding:"20px 0","&$vertical":{padding:"0 20px"}},"@media print":{colorAdjust:"exact"}},colorPrimary:{},colorSecondary:{color:e.palette.secondary.main},marked:{marginBottom:20,"&$vertical":{marginBottom:"auto",marginRight:20}},vertical:{},disabled:{},rail:{display:"block",position:"absolute",width:"100%",height:2,borderRadius:1,backgroundColor:"currentColor",opacity:.38,"$vertical &":{height:"100%",width:2}},track:{display:"block",position:"absolute",height:2,borderRadius:1,backgroundColor:"currentColor","$vertical &":{width:2}},trackFalse:{"& $track":{display:"none"}},trackInverted:{"& $track":{backgroundColor:e.palette.type==="light"?fR(e.palette.primary.main,.62):mR(e.palette.primary.main,.5)},"& $rail":{opacity:1}},thumb:{position:"absolute",width:12,height:12,marginLeft:-6,marginTop:-5,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow"],{duration:e.transitions.duration.shortest}),"&::after":{position:"absolute",content:'""',borderRadius:"50%",left:-15,top:-15,right:-15,bottom:-15},"&$focusVisible,&:hover":{boxShadow:"0px 0px 0px 8px ".concat(Wg(e.palette.primary.main,.16)),"@media (hover: none)":{boxShadow:"none"}},"&$active":{boxShadow:"0px 0px 0px 14px ".concat(Wg(e.palette.primary.main,.16))},"&$disabled":{width:8,height:8,marginLeft:-4,marginTop:-3,"&:hover":{boxShadow:"none"}},"$vertical &":{marginLeft:-5,marginBottom:-6},"$vertical &$disabled":{marginLeft:-3,marginBottom:-4}},thumbColorPrimary:{},thumbColorSecondary:{"&$focusVisible,&:hover":{boxShadow:"0px 0px 0px 8px ".concat(Wg(e.palette.secondary.main,.16))},"&$active":{boxShadow:"0px 0px 0px 14px ".concat(Wg(e.palette.secondary.main,.16))}},active:{},focusVisible:{},valueLabel:{left:"calc(-50% - 4px)"},mark:{position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor"},markActive:{backgroundColor:e.palette.background.paper,opacity:.8},markLabel:L({},e.typography.body2,{color:e.palette.text.secondary,position:"absolute",top:26,transform:"translateX(-50%)",whiteSpace:"nowrap","$vertical &":{top:"auto",left:26,transform:"translateY(50%)"},"@media (pointer: coarse)":{top:40,"$vertical &":{left:31}}}),markLabelActive:{color:e.palette.text.primary}}},xD=G.exports.forwardRef(function(e,n){var i=e["aria-label"],g=e["aria-labelledby"],s=e["aria-valuetext"],o=e.classes,r=e.className,I=e.color,a=I===void 0?"primary":I,l=e.component,C=l===void 0?"span":l,c=e.defaultValue,A=e.disabled,d=A===void 0?!1:A,m=e.getAriaLabel,u=e.getAriaValueText,h=e.marks,f=h===void 0?!1:h,p=e.max,b=p===void 0?100:p,Z=e.min,v=Z===void 0?0:Z,N=e.name,x=e.onChange,V=e.onChangeCommitted,E=e.onMouseDown,D=e.orientation,_=D===void 0?"horizontal":D,k=e.scale,z=k===void 0?oF:k,ee=e.step,Ie=ee===void 0?1:ee,he=e.ThumbComponent,ge=he===void 0?"span":he,Ae=e.track,U=Ae===void 0?"normal":Ae,F=e.value,W=e.ValueLabelComponent,T=W===void 0?FD:W,Y=e.valueLabelDisplay,Q=Y===void 0?"off":Y,H=e.valueLabelFormat,P=H===void 0?oF:H,oe=Ve(e,["aria-label","aria-labelledby","aria-valuetext","classes","className","color","component","defaultValue","disabled","getAriaLabel","getAriaValueText","marks","max","min","name","onChange","onChangeCommitted","onMouseDown","orientation","scale","step","ThumbComponent","track","value","ValueLabelComponent","valueLabelDisplay","valueLabelFormat"]),ne=Am(),me=G.exports.useRef(),ae=G.exports.useState(-1),be=ae[0],Ze=ae[1],Be=G.exports.useState(-1),rt=Be[0],le=Be[1],Re=wR({controlled:F,default:c,name:"Slider"}),Vt=bc(Re,2),$e=Vt[0],et=Vt[1],xe=Array.isArray($e),Ge=xe?$e.slice().sort(Rm):[$e];Ge=Ge.map(function(re){return Fm(re,v,b)});var Qe=f===!0&&Ie!==null?xl(Array(Math.floor((b-v)/Ie)+1)).map(function(re,Ce){return{value:v+Ie*Ce}}):f||[],Je=ER(),_t=Je.isFocusVisible,Ut=Je.onBlurVisible,Yi=Je.ref,at=G.exports.useState(-1),Se=at[0],Sn=at[1],gt=G.exports.useRef(),Vn=Jt(Yi,gt),Un=Jt(n,Vn),Ko=Yt(function(re){var Ce=Number(re.currentTarget.getAttribute("data-index"));_t(re)&&Sn(Ce),le(Ce)}),Lo=Yt(function(){Se!==-1&&(Sn(-1),Ut()),le(-1)}),Mo=Yt(function(re){var Ce=Number(re.currentTarget.getAttribute("data-index"));le(Ce)}),ue=Yt(function(){le(-1)}),Dt=ne.direction==="rtl",Po=Yt(function(re){var Ce=Number(re.currentTarget.getAttribute("data-index")),De=Ge[Ce],je=(b-v)/10,Ne=Qe.map(function(vs){return vs.value}),zt=Ne.indexOf(De),Xe,bs=Dt?"ArrowLeft":"ArrowRight",_i=Dt?"ArrowRight":"ArrowLeft";switch(re.key){case"Home":Xe=v;break;case"End":Xe=b;break;case"PageUp":Ie&&(Xe=De+je);break;case"PageDown":Ie&&(Xe=De-je);break;case bs:case"ArrowUp":Ie?Xe=De+Ie:Xe=Ne[zt+1]||Ne[Ne.length-1];break;case _i:case"ArrowDown":Ie?Xe=De-Ie:Xe=Ne[zt-1]||Ne[0];break;default:return}if(re.preventDefault(),Ie&&(Xe=gF(Xe,Ie,v)),Xe=Fm(Xe,v,b),xe){var ys=Xe;Xe=sF({values:Ge,source:$e,newValue:Xe,index:Ce}).sort(Rm),Vc({sliderRef:gt,activeIndex:Xe.indexOf(ys)})}et(Xe),Sn(Ce),x&&x(re,Xe),V&&V(re,Xe)}),wg=G.exports.useRef(),hn=_;Dt&&_!=="vertical"&&(hn+="-reverse");var Tg=function(Ce){var De=Ce.finger,je=Ce.move,Ne=je===void 0?!1:je,zt=Ce.values,Xe=Ce.source,bs=gt.current,_i=bs.getBoundingClientRect(),ys=_i.width,vs=_i.height,Ia=_i.bottom,aa=_i.left,Ci;hn.indexOf("vertical")===0?Ci=(Ia-De.y)/vs:Ci=(De.x-aa)/ys,hn.indexOf("-reverse")!==-1&&(Ci=1-Ci);var st;if(st=SD(Ci,v,b),Ie)st=gF(st,Ie,v);else{var Hi=Qe.map(function(wc){return wc.value}),Eg=iF(Hi,st);st=Hi[Eg]}st=Fm(st,v,b);var Wn=0;if(xe){Ne?Wn=wg.current:Wn=iF(zt,st);var zo=st;st=sF({values:zt,source:Xe,newValue:st,index:Wn}).sort(Rm),Wn=st.indexOf(zo),wg.current=Wn}return{newValue:st,activeIndex:Wn}},xn=Yt(function(re){var Ce=Fc(re,me);if(!!Ce){var De=Tg({finger:Ce,move:!0,values:Ge,source:$e}),je=De.newValue,Ne=De.activeIndex;Vc({sliderRef:gt,activeIndex:Ne,setActive:Ze}),et(je),x&&x(re,je)}}),li=Yt(function(re){var Ce=Fc(re,me);if(!!Ce){var De=Tg({finger:Ce,values:Ge,source:$e}),je=De.newValue;Ze(-1),re.type==="touchend"&&le(-1),V&&V(re,je),me.current=void 0;var Ne=Mn(gt.current);Ne.removeEventListener("mousemove",xn),Ne.removeEventListener("mouseup",li),Ne.removeEventListener("touchmove",xn),Ne.removeEventListener("touchend",li)}}),Jo=Yt(function(re){re.preventDefault();var Ce=re.changedTouches[0];Ce!=null&&(me.current=Ce.identifier);var De=Fc(re,me),je=Tg({finger:De,values:Ge,source:$e}),Ne=je.newValue,zt=je.activeIndex;Vc({sliderRef:gt,activeIndex:zt,setActive:Ze}),et(Ne),x&&x(re,Ne);var Xe=Mn(gt.current);Xe.addEventListener("touchmove",xn),Xe.addEventListener("touchend",li)});G.exports.useEffect(function(){var re=gt.current;re.addEventListener("touchstart",Jo);var Ce=Mn(re);return function(){re.removeEventListener("touchstart",Jo),Ce.removeEventListener("mousemove",xn),Ce.removeEventListener("mouseup",li),Ce.removeEventListener("touchmove",xn),Ce.removeEventListener("touchend",li)}},[li,xn,Jo]);var xc=Yt(function(re){E&&E(re),re.preventDefault();var Ce=Fc(re,me),De=Tg({finger:Ce,values:Ge,source:$e}),je=De.newValue,Ne=De.activeIndex;Vc({sliderRef:gt,activeIndex:Ne,setActive:Ze}),et(je),x&&x(re,je);var zt=Mn(gt.current);zt.addEventListener("mousemove",xn),zt.addEventListener("mouseup",li)}),Do=Sc(xe?Ge[0]:v,v,b),Wc=Sc(Ge[Ge.length-1],v,b)-Do,Nc=L({},Uc[hn].offset(Do),Uc[hn].leap(Wc));return G.exports.createElement(C,L({ref:Un,className:Ue(o.root,o["color".concat(Ln(a))],r,d&&o.disabled,Qe.length>0&&Qe.some(function(re){return re.label})&&o.marked,U===!1&&o.trackFalse,_==="vertical"&&o.vertical,U==="inverted"&&o.trackInverted),onMouseDown:xc},oe),G.exports.createElement("span",{className:o.rail}),G.exports.createElement("span",{className:o.track,style:Nc}),G.exports.createElement("input",{value:Ge.join(","),name:N,type:"hidden"}),Qe.map(function(re,Ce){var De=Sc(re.value,v,b),je=Uc[hn].offset(De),Ne;return U===!1?Ne=Ge.indexOf(re.value)!==-1:Ne=U==="normal"&&(xe?re.value>=Ge[0]&&re.value<=Ge[Ge.length-1]:re.value<=Ge[0])||U==="inverted"&&(xe?re.value<=Ge[0]||re.value>=Ge[Ge.length-1]:re.value>=Ge[0]),G.exports.createElement(G.exports.Fragment,{key:re.value},G.exports.createElement("span",{style:je,"data-index":Ce,className:Ue(o.mark,Ne&&o.markActive)}),re.label!=null?G.exports.createElement("span",{"aria-hidden":!0,"data-index":Ce,style:je,className:Ue(o.markLabel,Ne&&o.markLabelActive)},re.label):null)}),Ge.map(function(re,Ce){var De=Sc(re,v,b),je=Uc[hn].offset(De);return G.exports.createElement(T,{key:Ce,valueLabelFormat:P,valueLabelDisplay:Q,className:o.valueLabel,value:typeof P=="function"?P(z(re),Ce):P,index:Ce,open:rt===Ce||be===Ce||Q==="on",disabled:d},G.exports.createElement(ge,{className:Ue(o.thumb,o["thumbColor".concat(Ln(a))],be===Ce&&o.active,d&&o.disabled,Se===Ce&&o.focusVisible),tabIndex:d?null:0,role:"slider",style:je,"data-index":Ce,"aria-label":m?m(Ce):i,"aria-labelledby":g,"aria-orientation":_,"aria-valuemax":z(b),"aria-valuemin":z(v),"aria-valuenow":z(re),"aria-valuetext":u?u(z(re),Ce):s,onKeyDown:Po,onFocus:Ko,onBlur:Lo,onMouseOver:Mo,onMouseLeave:ue}))}))}),rz=Bt(UD,{name:"MuiSlider"})(xD),Iz=Qi(G.exports.createElement("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})),az=Qi(G.exports.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"})),lz=Qi(G.exports.createElement("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})),Cz=Qi(G.exports.createElement("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),cz=Qi(G.exports.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),Az=Qi(G.exports.createElement("path",{d:"M19 13H5v-2h14v2z"})),dz=Qi(G.exports.createElement("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})),uz=Qi(G.exports.createElement("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"})),Sm={};Object.defineProperty(Sm,"__esModule",{value:!0});var WD=Sm.default=void 0,ND={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#d5d5d5",A200:"#aaaaaa",A400:"#303030",A700:"#616161"},wD=ND;WD=Sm.default=wD;export{WD as $,tz as A,lz as B,kn as C,KD as D,PU as E,zD as F,Xo as G,rM as H,fc as I,Cz as J,cz as K,az as L,Pe as M,oz as N,DZ as O,sz as P,qD as Q,Az as R,LC as S,JI as T,ez as U,dz as V,$D as W,dc as X,XD as Y,ta as Z,HP as _,hc as a,LD as a0,Dd as a1,QD as a2,ED as a3,xi as b,MD as c,OD as d,sR as e,jg as f,_D as g,VV as h,ZJ as i,JD as j,uz as k,a9 as l,DD as m,nz as n,PD as o,jD as p,gz as q,G as r,HD as s,Iz as t,YD as u,_R as v,kD as w,iz as x,rz as y,hD as z};
